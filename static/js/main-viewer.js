/* pako 1.0.4 nodeca/pako */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.pako=e()}}(function(){return function e(t,i,n){function a(o,s){if(!i[o]){if(!t[o]){var f="function"==typeof require&&require;if(!s&&f)return f(o,!0);if(r)return r(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var d=i[o]={exports:{}};t[o][0].call(d.exports,function(e){var i=t[o][1][e];return a(i?i:e)},d,d.exports,e,t,i,n)}return i[o].exports}for(var r="function"==typeof require&&require,o=0;o<n.length;o++)a(n[o]);return a}({1:[function(e,t,i){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;i.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])}}return e},i.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,i,n,a){if(t.subarray&&e.subarray)return void e.set(t.subarray(i,i+n),a);for(var r=0;r<n;r++)e[a+r]=t[i+r]},flattenChunks:function(e){var t,i,n,a,r,o;for(n=0,t=0,i=e.length;t<i;t++)n+=e[t].length;for(o=new Uint8Array(n),a=0,t=0,i=e.length;t<i;t++)r=e[t],o.set(r,a),a+=r.length;return o}},r={arraySet:function(e,t,i,n,a){for(var r=0;r<n;r++)e[a+r]=t[i+r]},flattenChunks:function(e){return[].concat.apply([],e)}};i.setTyped=function(e){e?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,a)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,r))},i.setTyped(n)},{}],2:[function(e,t,i){"use strict";function n(e,t){if(t<65537&&(e.subarray&&o||!e.subarray&&r))return String.fromCharCode.apply(null,a.shrinkBuf(e,t));for(var i="",n=0;n<t;n++)i+=String.fromCharCode(e[n]);return i}var a=e("./common"),r=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var s=new a.Buf8(256),f=0;f<256;f++)s[f]=f>=252?6:f>=248?5:f>=240?4:f>=224?3:f>=192?2:1;s[254]=s[254]=1,i.string2buf=function(e){var t,i,n,r,o,s=e.length,f=0;for(r=0;r<s;r++)i=e.charCodeAt(r),55296===(64512&i)&&r+1<s&&(n=e.charCodeAt(r+1),56320===(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),r++)),f+=i<128?1:i<2048?2:i<65536?3:4;for(t=new a.Buf8(f),o=0,r=0;o<f;r++)i=e.charCodeAt(r),55296===(64512&i)&&r+1<s&&(n=e.charCodeAt(r+1),56320===(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),r++)),i<128?t[o++]=i:i<2048?(t[o++]=192|i>>>6,t[o++]=128|63&i):i<65536?(t[o++]=224|i>>>12,t[o++]=128|i>>>6&63,t[o++]=128|63&i):(t[o++]=240|i>>>18,t[o++]=128|i>>>12&63,t[o++]=128|i>>>6&63,t[o++]=128|63&i);return t},i.buf2binstring=function(e){return n(e,e.length)},i.binstring2buf=function(e){for(var t=new a.Buf8(e.length),i=0,n=t.length;i<n;i++)t[i]=e.charCodeAt(i);return t},i.buf2string=function(e,t){var i,a,r,o,f=t||e.length,l=new Array(2*f);for(a=0,i=0;i<f;)if(r=e[i++],r<128)l[a++]=r;else if(o=s[r],o>4)l[a++]=65533,i+=o-1;else{for(r&=2===o?31:3===o?15:7;o>1&&i<f;)r=r<<6|63&e[i++],o--;o>1?l[a++]=65533:r<65536?l[a++]=r:(r-=65536,l[a++]=55296|r>>10&1023,l[a++]=56320|1023&r)}return n(l,a)},i.utf8border=function(e,t){var i;for(t=t||e.length,t>e.length&&(t=e.length),i=t-1;i>=0&&128===(192&e[i]);)i--;return i<0?t:0===i?t:i+s[e[i]]>t?i:t}},{"./common":1}],3:[function(e,t,i){"use strict";function n(e,t,i,n){for(var a=65535&e|0,r=e>>>16&65535|0,o=0;0!==i;){o=i>2e3?2e3:i,i-=o;do a=a+t[n++]|0,r=r+a|0;while(--o);a%=65521,r%=65521}return a|r<<16|0}t.exports=n},{}],4:[function(e,t,i){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],5:[function(e,t,i){"use strict";function n(){for(var e,t=[],i=0;i<256;i++){e=i;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t}function a(e,t,i,n){var a=r,o=n+i;e^=-1;for(var s=n;s<o;s++)e=e>>>8^a[255&(e^t[s])];return e^-1}var r=n();t.exports=a},{}],6:[function(e,t,i){"use strict";function n(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}t.exports=n},{}],7:[function(e,t,i){"use strict";var n=30,a=12;t.exports=function(e,t){var i,r,o,s,f,l,d,u,c,h,b,w,m,k,_,g,v,p,x,y,S,E,B,Z,A;i=e.state,r=e.next_in,Z=e.input,o=r+(e.avail_in-5),s=e.next_out,A=e.output,f=s-(t-e.avail_out),l=s+(e.avail_out-257),d=i.dmax,u=i.wsize,c=i.whave,h=i.wnext,b=i.window,w=i.hold,m=i.bits,k=i.lencode,_=i.distcode,g=(1<<i.lenbits)-1,v=(1<<i.distbits)-1;e:do{m<15&&(w+=Z[r++]<<m,m+=8,w+=Z[r++]<<m,m+=8),p=k[w&g];t:for(;;){if(x=p>>>24,w>>>=x,m-=x,x=p>>>16&255,0===x)A[s++]=65535&p;else{if(!(16&x)){if(0===(64&x)){p=k[(65535&p)+(w&(1<<x)-1)];continue t}if(32&x){i.mode=a;break e}e.msg="invalid literal/length code",i.mode=n;break e}y=65535&p,x&=15,x&&(m<x&&(w+=Z[r++]<<m,m+=8),y+=w&(1<<x)-1,w>>>=x,m-=x),m<15&&(w+=Z[r++]<<m,m+=8,w+=Z[r++]<<m,m+=8),p=_[w&v];i:for(;;){if(x=p>>>24,w>>>=x,m-=x,x=p>>>16&255,!(16&x)){if(0===(64&x)){p=_[(65535&p)+(w&(1<<x)-1)];continue i}e.msg="invalid distance code",i.mode=n;break e}if(S=65535&p,x&=15,m<x&&(w+=Z[r++]<<m,m+=8,m<x&&(w+=Z[r++]<<m,m+=8)),S+=w&(1<<x)-1,S>d){e.msg="invalid distance too far back",i.mode=n;break e}if(w>>>=x,m-=x,x=s-f,S>x){if(x=S-x,x>c&&i.sane){e.msg="invalid distance too far back",i.mode=n;break e}if(E=0,B=b,0===h){if(E+=u-x,x<y){y-=x;do A[s++]=b[E++];while(--x);E=s-S,B=A}}else if(h<x){if(E+=u+h-x,x-=h,x<y){y-=x;do A[s++]=b[E++];while(--x);if(E=0,h<y){x=h,y-=x;do A[s++]=b[E++];while(--x);E=s-S,B=A}}}else if(E+=h-x,x<y){y-=x;do A[s++]=b[E++];while(--x);E=s-S,B=A}for(;y>2;)A[s++]=B[E++],A[s++]=B[E++],A[s++]=B[E++],y-=3;y&&(A[s++]=B[E++],y>1&&(A[s++]=B[E++]))}else{E=s-S;do A[s++]=A[E++],A[s++]=A[E++],A[s++]=A[E++],y-=3;while(y>2);y&&(A[s++]=A[E++],y>1&&(A[s++]=A[E++]))}break}}break}}while(r<o&&s<l);y=m>>3,r-=y,m-=y<<3,w&=(1<<m)-1,e.next_in=r,e.next_out=s,e.avail_in=r<o?5+(o-r):5-(r-o),e.avail_out=s<l?257+(l-s):257-(s-l),i.hold=w,i.bits=m}},{}],8:[function(e,t,i){"use strict";function n(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function a(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new _.Buf16(320),this.work=new _.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function r(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=D,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new _.Buf32(we),t.distcode=t.distdyn=new _.Buf32(me),t.sane=1,t.back=-1,z):C}function o(e){var t;return e&&e.state?(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,r(e)):C}function s(e,t){var i,n;return e&&e.state?(n=e.state,t<0?(i=0,t=-t):(i=(t>>4)+1,t<48&&(t&=15)),t&&(t<8||t>15)?C:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=i,n.wbits=t,o(e))):C}function f(e,t){var i,n;return e?(n=new a,e.state=n,n.window=null,i=s(e,t),i!==z&&(e.state=null),i):C}function l(e){return f(e,_e)}function d(e){if(ge){var t;for(m=new _.Buf32(512),k=new _.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(x(S,e.lens,0,288,m,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;x(E,e.lens,0,32,k,0,e.work,{bits:5}),ge=!1}e.lencode=m,e.lenbits=9,e.distcode=k,e.distbits=5}function u(e,t,i,n){var a,r=e.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new _.Buf8(r.wsize)),n>=r.wsize?(_.arraySet(r.window,t,i-r.wsize,r.wsize,0),r.wnext=0,r.whave=r.wsize):(a=r.wsize-r.wnext,a>n&&(a=n),_.arraySet(r.window,t,i-n,a,r.wnext),n-=a,n?(_.arraySet(r.window,t,i-n,n,0),r.wnext=n,r.whave=r.wsize):(r.wnext+=a,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=a))),0}function c(e,t){var i,a,r,o,s,f,l,c,h,b,w,m,k,we,me,ke,_e,ge,ve,pe,xe,ye,Se,Ee,Be=0,Ze=new _.Buf8(4),Ae=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return C;i=e.state,i.mode===X&&(i.mode=W),s=e.next_out,r=e.output,l=e.avail_out,o=e.next_in,a=e.input,f=e.avail_in,c=i.hold,h=i.bits,b=f,w=l,ye=z;e:for(;;)switch(i.mode){case D:if(0===i.wrap){i.mode=W;break}for(;h<16;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(2&i.wrap&&35615===c){i.check=0,Ze[0]=255&c,Ze[1]=c>>>8&255,i.check=v(i.check,Ze,2,0),c=0,h=0,i.mode=F;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",i.mode=ce;break}if((15&c)!==U){e.msg="unknown compression method",i.mode=ce;break}if(c>>>=4,h-=4,xe=(15&c)+8,0===i.wbits)i.wbits=xe;else if(xe>i.wbits){e.msg="invalid window size",i.mode=ce;break}i.dmax=1<<xe,e.adler=i.check=1,i.mode=512&c?q:X,c=0,h=0;break;case F:for(;h<16;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(i.flags=c,(255&i.flags)!==U){e.msg="unknown compression method",i.mode=ce;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=ce;break}i.head&&(i.head.text=c>>8&1),512&i.flags&&(Ze[0]=255&c,Ze[1]=c>>>8&255,i.check=v(i.check,Ze,2,0)),c=0,h=0,i.mode=L;case L:for(;h<32;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}i.head&&(i.head.time=c),512&i.flags&&(Ze[0]=255&c,Ze[1]=c>>>8&255,Ze[2]=c>>>16&255,Ze[3]=c>>>24&255,i.check=v(i.check,Ze,4,0)),c=0,h=0,i.mode=H;case H:for(;h<16;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}i.head&&(i.head.xflags=255&c,i.head.os=c>>8),512&i.flags&&(Ze[0]=255&c,Ze[1]=c>>>8&255,i.check=v(i.check,Ze,2,0)),c=0,h=0,i.mode=M;case M:if(1024&i.flags){for(;h<16;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}i.length=c,i.head&&(i.head.extra_len=c),512&i.flags&&(Ze[0]=255&c,Ze[1]=c>>>8&255,i.check=v(i.check,Ze,2,0)),c=0,h=0}else i.head&&(i.head.extra=null);i.mode=j;case j:if(1024&i.flags&&(m=i.length,m>f&&(m=f),m&&(i.head&&(xe=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),_.arraySet(i.head.extra,a,o,m,xe)),512&i.flags&&(i.check=v(i.check,a,m,o)),f-=m,o+=m,i.length-=m),i.length))break e;i.length=0,i.mode=K;case K:if(2048&i.flags){if(0===f)break e;m=0;do xe=a[o+m++],i.head&&xe&&i.length<65536&&(i.head.name+=String.fromCharCode(xe));while(xe&&m<f);if(512&i.flags&&(i.check=v(i.check,a,m,o)),f-=m,o+=m,xe)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=P;case P:if(4096&i.flags){if(0===f)break e;m=0;do xe=a[o+m++],i.head&&xe&&i.length<65536&&(i.head.comment+=String.fromCharCode(xe));while(xe&&m<f);if(512&i.flags&&(i.check=v(i.check,a,m,o)),f-=m,o+=m,xe)break e}else i.head&&(i.head.comment=null);i.mode=Y;case Y:if(512&i.flags){for(;h<16;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(c!==(65535&i.check)){e.msg="header crc mismatch",i.mode=ce;break}c=0,h=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=X;break;case q:for(;h<32;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}e.adler=i.check=n(c),c=0,h=0,i.mode=G;case G:if(0===i.havedict)return e.next_out=s,e.avail_out=l,e.next_in=o,e.avail_in=f,i.hold=c,i.bits=h,N;e.adler=i.check=1,i.mode=X;case X:if(t===Z||t===A)break e;case W:if(i.last){c>>>=7&h,h-=7&h,i.mode=le;break}for(;h<3;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}switch(i.last=1&c,c>>>=1,h-=1,3&c){case 0:i.mode=J;break;case 1:if(d(i),i.mode=ie,t===A){c>>>=2,h-=2;break e}break;case 2:i.mode=$;break;case 3:e.msg="invalid block type",i.mode=ce}c>>>=2,h-=2;break;case J:for(c>>>=7&h,h-=7&h;h<32;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if((65535&c)!==(c>>>16^65535)){e.msg="invalid stored block lengths",i.mode=ce;break}if(i.length=65535&c,c=0,h=0,i.mode=Q,t===A)break e;case Q:i.mode=V;case V:if(m=i.length){if(m>f&&(m=f),m>l&&(m=l),0===m)break e;_.arraySet(r,a,o,m,s),f-=m,o+=m,l-=m,s+=m,i.length-=m;break}i.mode=X;break;case $:for(;h<14;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(i.nlen=(31&c)+257,c>>>=5,h-=5,i.ndist=(31&c)+1,c>>>=5,h-=5,i.ncode=(15&c)+4,c>>>=4,h-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=ce;break}i.have=0,i.mode=ee;case ee:for(;i.have<i.ncode;){for(;h<3;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}i.lens[Ae[i.have++]]=7&c,c>>>=3,h-=3}for(;i.have<19;)i.lens[Ae[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,Se={bits:i.lenbits},ye=x(y,i.lens,0,19,i.lencode,0,i.work,Se),i.lenbits=Se.bits,ye){e.msg="invalid code lengths set",i.mode=ce;break}i.have=0,i.mode=te;case te:for(;i.have<i.nlen+i.ndist;){for(;Be=i.lencode[c&(1<<i.lenbits)-1],me=Be>>>24,ke=Be>>>16&255,_e=65535&Be,!(me<=h);){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(_e<16)c>>>=me,h-=me,i.lens[i.have++]=_e;else{if(16===_e){for(Ee=me+2;h<Ee;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(c>>>=me,h-=me,0===i.have){e.msg="invalid bit length repeat",i.mode=ce;break}xe=i.lens[i.have-1],m=3+(3&c),c>>>=2,h-=2}else if(17===_e){for(Ee=me+3;h<Ee;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}c>>>=me,h-=me,xe=0,m=3+(7&c),c>>>=3,h-=3}else{for(Ee=me+7;h<Ee;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}c>>>=me,h-=me,xe=0,m=11+(127&c),c>>>=7,h-=7}if(i.have+m>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=ce;break}for(;m--;)i.lens[i.have++]=xe}}if(i.mode===ce)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=ce;break}if(i.lenbits=9,Se={bits:i.lenbits},ye=x(S,i.lens,0,i.nlen,i.lencode,0,i.work,Se),i.lenbits=Se.bits,ye){e.msg="invalid literal/lengths set",i.mode=ce;break}if(i.distbits=6,i.distcode=i.distdyn,Se={bits:i.distbits},ye=x(E,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,Se),i.distbits=Se.bits,ye){e.msg="invalid distances set",i.mode=ce;break}if(i.mode=ie,t===A)break e;case ie:i.mode=ne;case ne:if(f>=6&&l>=258){e.next_out=s,e.avail_out=l,e.next_in=o,e.avail_in=f,i.hold=c,i.bits=h,p(e,w),s=e.next_out,r=e.output,l=e.avail_out,o=e.next_in,a=e.input,f=e.avail_in,c=i.hold,h=i.bits,i.mode===X&&(i.back=-1);break}for(i.back=0;Be=i.lencode[c&(1<<i.lenbits)-1],me=Be>>>24,ke=Be>>>16&255,_e=65535&Be,!(me<=h);){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(ke&&0===(240&ke)){for(ge=me,ve=ke,pe=_e;Be=i.lencode[pe+((c&(1<<ge+ve)-1)>>ge)],me=Be>>>24,ke=Be>>>16&255,_e=65535&Be,!(ge+me<=h);){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}c>>>=ge,h-=ge,i.back+=ge}if(c>>>=me,h-=me,i.back+=me,i.length=_e,0===ke){i.mode=fe;break}if(32&ke){i.back=-1,i.mode=X;break}if(64&ke){e.msg="invalid literal/length code",i.mode=ce;break}i.extra=15&ke,i.mode=ae;case ae:if(i.extra){for(Ee=i.extra;h<Ee;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}i.length+=c&(1<<i.extra)-1,c>>>=i.extra,h-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=re;case re:for(;Be=i.distcode[c&(1<<i.distbits)-1],me=Be>>>24,ke=Be>>>16&255,_e=65535&Be,!(me<=h);){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(0===(240&ke)){for(ge=me,ve=ke,pe=_e;Be=i.distcode[pe+((c&(1<<ge+ve)-1)>>ge)],me=Be>>>24,ke=Be>>>16&255,_e=65535&Be,!(ge+me<=h);){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}c>>>=ge,h-=ge,i.back+=ge}if(c>>>=me,h-=me,i.back+=me,64&ke){e.msg="invalid distance code",i.mode=ce;break}i.offset=_e,i.extra=15&ke,i.mode=oe;case oe:if(i.extra){for(Ee=i.extra;h<Ee;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}i.offset+=c&(1<<i.extra)-1,c>>>=i.extra,h-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=ce;break}i.mode=se;case se:if(0===l)break e;if(m=w-l,i.offset>m){if(m=i.offset-m,m>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=ce;break}m>i.wnext?(m-=i.wnext,k=i.wsize-m):k=i.wnext-m,m>i.length&&(m=i.length),we=i.window}else we=r,k=s-i.offset,m=i.length;m>l&&(m=l),l-=m,i.length-=m;do r[s++]=we[k++];while(--m);0===i.length&&(i.mode=ne);break;case fe:if(0===l)break e;r[s++]=i.length,l--,i.mode=ne;break;case le:if(i.wrap){for(;h<32;){if(0===f)break e;f--,c|=a[o++]<<h,h+=8}if(w-=l,e.total_out+=w,i.total+=w,w&&(e.adler=i.check=i.flags?v(i.check,r,w,s-w):g(i.check,r,w,s-w)),w=l,(i.flags?c:n(c))!==i.check){e.msg="incorrect data check",i.mode=ce;break}c=0,h=0}i.mode=de;case de:if(i.wrap&&i.flags){for(;h<32;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(c!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=ce;break}c=0,h=0}i.mode=ue;case ue:ye=R;break e;case ce:ye=O;break e;case he:return I;case be:default:return C}return e.next_out=s,e.avail_out=l,e.next_in=o,e.avail_in=f,i.hold=c,i.bits=h,(i.wsize||w!==e.avail_out&&i.mode<ce&&(i.mode<le||t!==B))&&u(e,e.output,e.next_out,w-e.avail_out)?(i.mode=he,I):(b-=e.avail_in,w-=e.avail_out,e.total_in+=b,e.total_out+=w,i.total+=w,i.wrap&&w&&(e.adler=i.check=i.flags?v(i.check,r,w,e.next_out-w):g(i.check,r,w,e.next_out-w)),e.data_type=i.bits+(i.last?64:0)+(i.mode===X?128:0)+(i.mode===ie||i.mode===Q?256:0),(0===b&&0===w||t===B)&&ye===z&&(ye=T),ye)}function h(e){if(!e||!e.state)return C;var t=e.state;return t.window&&(t.window=null),e.state=null,z}function b(e,t){var i;return e&&e.state?(i=e.state,0===(2&i.wrap)?C:(i.head=t,t.done=!1,z)):C}function w(e,t){var i,n,a,r=t.length;return e&&e.state?(i=e.state,0!==i.wrap&&i.mode!==G?C:i.mode===G&&(n=1,n=g(n,t,r,0),n!==i.check)?O:(a=u(e,t,r,r))?(i.mode=he,I):(i.havedict=1,z)):C}var m,k,_=e("../utils/common"),g=e("./adler32"),v=e("./crc32"),p=e("./inffast"),x=e("./inftrees"),y=0,S=1,E=2,B=4,Z=5,A=6,z=0,R=1,N=2,C=-2,O=-3,I=-4,T=-5,U=8,D=1,F=2,L=3,H=4,M=5,j=6,K=7,P=8,Y=9,q=10,G=11,X=12,W=13,J=14,Q=15,V=16,$=17,ee=18,te=19,ie=20,ne=21,ae=22,re=23,oe=24,se=25,fe=26,le=27,de=28,ue=29,ce=30,he=31,be=32,we=852,me=592,ke=15,_e=ke,ge=!0;i.inflateReset=o,i.inflateReset2=s,i.inflateResetKeep=r,i.inflateInit=l,i.inflateInit2=f,i.inflate=c,i.inflateEnd=h,i.inflateGetHeader=b,i.inflateSetDictionary=w,i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":1,"./adler32":3,"./crc32":5,"./inffast":7,"./inftrees":9}],9:[function(e,t,i){"use strict";var n=e("../utils/common"),a=15,r=852,o=592,s=0,f=1,l=2,d=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],u=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,i,b,w,m,k,_){var g,v,p,x,y,S,E,B,Z,A=_.bits,z=0,R=0,N=0,C=0,O=0,I=0,T=0,U=0,D=0,F=0,L=null,H=0,M=new n.Buf16(a+1),j=new n.Buf16(a+1),K=null,P=0;for(z=0;z<=a;z++)M[z]=0;for(R=0;R<b;R++)M[t[i+R]]++;for(O=A,C=a;C>=1&&0===M[C];C--);if(O>C&&(O=C),0===C)return w[m++]=20971520,w[m++]=20971520,_.bits=1,0;for(N=1;N<C&&0===M[N];N++);for(O<N&&(O=N),U=1,z=1;z<=a;z++)if(U<<=1,U-=M[z],U<0)return-1;if(U>0&&(e===s||1!==C))return-1;for(j[1]=0,z=1;z<a;z++)j[z+1]=j[z]+M[z];for(R=0;R<b;R++)0!==t[i+R]&&(k[j[t[i+R]]++]=R);if(e===s?(L=K=k,S=19):e===f?(L=d,H-=257,K=u,P-=257,S=256):(L=c,K=h,S=-1),F=0,R=0,z=N,y=m,I=O,T=0,p=-1,D=1<<O,x=D-1,e===f&&D>r||e===l&&D>o)return 1;for(;;){E=z-T,k[R]<S?(B=0,Z=k[R]):k[R]>S?(B=K[P+k[R]],Z=L[H+k[R]]):(B=96,Z=0),g=1<<z-T,v=1<<I,N=v;do v-=g,w[y+(F>>T)+v]=E<<24|B<<16|Z|0;while(0!==v);for(g=1<<z-1;F&g;)g>>=1;if(0!==g?(F&=g-1,F+=g):F=0,R++,0===--M[z]){if(z===C)break;z=t[i+k[R]]}if(z>O&&(F&x)!==p){for(0===T&&(T=O),y+=N,I=z-T,U=1<<I;I+T<C&&(U-=M[I+T],!(U<=0));)I++,U<<=1;if(D+=1<<I,e===f&&D>r||e===l&&D>o)return 1;p=F&x,w[p]=O<<24|I<<16|y-m|0}}return 0!==F&&(w[y+F]=z-T<<24|64<<16|0),_.bits=O,0}},{"../utils/common":1}],10:[function(e,t,i){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],11:[function(e,t,i){"use strict";function n(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}t.exports=n},{}],"/lib/inflate.js":[function(e,t,i){"use strict";function n(e){if(!(this instanceof n))return new n(e);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0===(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var i=o.inflateInit2(this.strm,t.windowBits);if(i!==l.Z_OK)throw new Error(d[i]);this.header=new c,o.inflateGetHeader(this.strm,this.header)}function a(e,t){var i=new n(t);if(i.push(e,!0),i.err)throw i.msg||d[i.err];return i.result}function r(e,t){return t=t||{},t.raw=!0,a(e,t)}var o=e("./zlib/inflate"),s=e("./utils/common"),f=e("./utils/strings"),l=e("./zlib/constants"),d=e("./zlib/messages"),u=e("./zlib/zstream"),c=e("./zlib/gzheader"),h=Object.prototype.toString;n.prototype.push=function(e,t){var i,n,a,r,d,u,c=this.strm,b=this.options.chunkSize,w=this.options.dictionary,m=!1;if(this.ended)return!1;n=t===~~t?t:t===!0?l.Z_FINISH:l.Z_NO_FLUSH,"string"==typeof e?c.input=f.binstring2buf(e):"[object ArrayBuffer]"===h.call(e)?c.input=new Uint8Array(e):c.input=e,c.next_in=0,c.avail_in=c.input.length;do{if(0===c.avail_out&&(c.output=new s.Buf8(b),c.next_out=0,c.avail_out=b),i=o.inflate(c,l.Z_NO_FLUSH),i===l.Z_NEED_DICT&&w&&(u="string"==typeof w?f.string2buf(w):"[object ArrayBuffer]"===h.call(w)?new Uint8Array(w):w,i=o.inflateSetDictionary(this.strm,u)),i===l.Z_BUF_ERROR&&m===!0&&(i=l.Z_OK,m=!1),i!==l.Z_STREAM_END&&i!==l.Z_OK)return this.onEnd(i),this.ended=!0,!1;c.next_out&&(0!==c.avail_out&&i!==l.Z_STREAM_END&&(0!==c.avail_in||n!==l.Z_FINISH&&n!==l.Z_SYNC_FLUSH)||("string"===this.options.to?(a=f.utf8border(c.output,c.next_out),r=c.next_out-a,d=f.buf2string(c.output,a),c.next_out=r,c.avail_out=b-r,r&&s.arraySet(c.output,c.output,a,r,0),this.onData(d)):this.onData(s.shrinkBuf(c.output,c.next_out)))),0===c.avail_in&&0===c.avail_out&&(m=!0)}while((c.avail_in>0||0===c.avail_out)&&i!==l.Z_STREAM_END);return i===l.Z_STREAM_END&&(n=l.Z_FINISH),n===l.Z_FINISH?(i=o.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===l.Z_OK):n!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),c.avail_out=0,!0)},n.prototype.onData=function(e){this.chunks.push(e)},n.prototype.onEnd=function(e){e===l.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},i.Inflate=n,i.inflate=a,i.inflateRaw=r,i.ungzip=a},{"./utils/common":1,"./utils/strings":2,"./zlib/constants":4,"./zlib/gzheader":6,"./zlib/inflate":8,"./zlib/messages":10,"./zlib/zstream":11}]},{},[])("/lib/inflate.js")});
(function(a,e){"object"===typeof exports&&"undefined"!==typeof module?e(exports):"function"===typeof define&&define.amd?define(["exports"],e):(a="undefined"!==typeof globalThis?globalThis:a||self,e(a.THREE={}))})(this,function(a){function e(c,f,b,d,g,l,r){try{var v=c[l](r),x=v.value}catch(w){b(w);return}v.done?f(x):Promise.resolve(x).then(d,g)}function h(c){return function(){var f=this,b=arguments;return new Promise(function(d,g){function l(x){e(v,d,g,l,r,"next",x)}function r(x){e(v,d,g,l,r,"throw",
x)}var v=c.apply(f,b);l(void 0)})}}function m(c,f){for(var b=0;b<f.length;b++){var d=f[b];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(c,d.key,d)}}function t(c,f,b){f&&m(c.prototype,f);b&&m(c,b);return c}function y(c,f){c.prototype=Object.create(f.prototype);c.prototype.constructor=c;c.__proto__=f}function C(c){if(void 0===c)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return c}function I(c,f){if(c){if("string"===
typeof c)return E(c,f);var b=Object.prototype.toString.call(c).slice(8,-1);"Object"===b&&c.constructor&&(b=c.constructor.name);if("Map"===b||"Set"===b)return Array.from(c);if("Arguments"===b||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(b))return E(c,f)}}function E(c,f){if(null==f||f>c.length)f=c.length;for(var b=0,d=Array(f);b<f;b++)d[b]=c[b];return d}function H(c,f){var b;if("undefined"===typeof Symbol||null==c[Symbol.iterator]){if(Array.isArray(c)||(b=I(c))||f&&c&&"number"===typeof c.length){b&&
(c=b);var d=0;return function(){return d>=c.length?{done:!0}:{done:!1,value:c[d++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}b=c[Symbol.iterator]();return b.next.bind(b)}function O(){}function R(c,f,b,d,g,l,r,v,x,w){void 0===c&&(c=R.DEFAULT_IMAGE);void 0===f&&(f=R.DEFAULT_MAPPING);void 0===b&&(b=1001);void 0===d&&(d=1001);void 0===g&&(g=1006);void 0===l&&(l=1008);void 0===r&&(r=1023);
void 0===v&&(v=1009);void 0===x&&(x=1);void 0===w&&(w=3E3);Object.defineProperty(this,"id",{value:fl++});this.uuid=Qb.generateUUID();this.name="";this.image=c;this.mipmaps=[];this.mapping=f;this.wrapS=b;this.wrapT=d;this.magFilter=g;this.minFilter=l;this.anisotropy=x;this.format=r;this.internalFormat=null;this.type=v;this.offset=new ib(0,0);this.repeat=new ib(1,1);this.center=new ib(0,0);this.rotation=0;this.matrixAutoUpdate=!0;this.matrix=new fd;this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=
!0;this.unpackAlignment=4;this.encoding=w;this.version=0;this.onUpdate=null}function W(c){if("undefined"!==typeof HTMLImageElement&&c instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&c instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&c instanceof ImageBitmap)return Ge.getDataURL(c);if(c.data)return{data:Array.prototype.slice.call(c.data),width:c.width,height:c.height,type:c.data.constructor.name};console.warn("THREE.Texture: Unable to serialize Texture.");return{}}
function ea(c,f,b,d,g){for(var l=0,r=c.length-3;l<=r;l+=3){He.fromArray(c,l);var v=g.x*Math.abs(He.x)+g.y*Math.abs(He.y)+g.z*Math.abs(He.z),x=f.dot(He),w=b.dot(He),A=d.dot(He);if(Math.max(-Math.max(x,w,A),Math.min(x,w,A))>v)return!1}return!0}function T(){Object.defineProperty(this,"id",{value:gl++});this.uuid=Qb.generateUUID();this.name="";this.type="Object3D";this.parent=null;this.children=[];this.up=T.DefaultUp.clone();var c=new da,f=new wg,b=new Oc,d=new da(1,1,1);f._onChange(function(){b.setFromEuler(f,
!1)});b._onChange(function(){f.setFromQuaternion(b,void 0,!1)});Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:c},rotation:{configurable:!0,enumerable:!0,value:f},quaternion:{configurable:!0,enumerable:!0,value:b},scale:{configurable:!0,enumerable:!0,value:d},modelViewMatrix:{value:new ec},normalMatrix:{value:new fd}});this.matrix=new ec;this.matrixWorld=new ec;this.matrixAutoUpdate=T.DefaultMatrixAutoUpdate;this.matrixWorldNeedsUpdate=!1;this.layers=new Vh;this.visible=
!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.renderOrder=0;this.animations=[];this.userData={}}function fa(c,f,b){0>b&&(b+=1);1<b&&--b;return b<1/6?c+6*(f-c)*b:.5>b?f:b<2/3?c+6*(f-c)*(2/3-b):c}function sa(c){return.04045>c?.0773993808*c:Math.pow(.9478672986*c+.0521327014,2.4)}function wa(c){return.0031308>c?12.92*c:1.055*Math.pow(c,.41666)-.055}function U(){Object.defineProperty(this,"id",{value:hl++});this.uuid=Qb.generateUUID();this.name="";this.type="Material";this.fog=!0;
this.blending=1;this.side=0;this.vertexColors=this.flatShading=!1;this.opacity=1;this.transparent=!1;this.blendSrc=204;this.blendDst=205;this.blendEquation=100;this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null;this.depthFunc=3;this.depthWrite=this.depthTest=!0;this.stencilWriteMask=255;this.stencilFunc=519;this.stencilRef=0;this.stencilFuncMask=255;this.stencilZPass=this.stencilZFail=this.stencilFail=7680;this.stencilWrite=!1;this.clippingPlanes=null;this.clipShadows=this.clipIntersection=
!1;this.shadowSide=null;this.colorWrite=!0;this.precision=null;this.polygonOffset=!1;this.polygonOffsetUnits=this.polygonOffsetFactor=0;this.dithering=!1;this.alphaTest=0;this.premultipliedAlpha=!1;this.toneMapped=this.visible=!0;this.userData={};this.version=0}function qa(c){U.call(this);this.type="MeshBasicMaterial";this.color=new Cb(16777215);this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.envMap=this.alphaMap=this.specularMap=null;this.combine=0;
this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphTargets=this.skinning=!1;this.setValues(c)}function M(c,f,b){if(Array.isArray(c))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="";this.array=c;this.itemSize=f;this.count=void 0!==c?c.length/f:0;this.normalized=!0===b;this.usage=35044;this.updateRange={offset:0,count:-1};this.version=0}function Q(c,f,b){M.call(this,
new Int8Array(c),f,b)}function V(c,f,b){M.call(this,new Uint8Array(c),f,b)}function ca(c,f,b){M.call(this,new Uint8ClampedArray(c),f,b)}function za(c,f,b){M.call(this,new Int16Array(c),f,b)}function ta(c,f,b){M.call(this,new Uint16Array(c),f,b)}function Ka(c,f,b){M.call(this,new Int32Array(c),f,b)}function cb(c,f,b){M.call(this,new Uint32Array(c),f,b)}function gb(c,f,b){M.call(this,new Uint16Array(c),f,b)}function Ya(c,f,b){M.call(this,new Float32Array(c),f,b)}function na(c,f,b){M.call(this,new Float64Array(c),
f,b)}function Ia(c){if(0===c.length)return-Infinity;for(var f=c[0],b=1,d=c.length;b<d;++b)c[b]>f&&(f=c[b]);return f}function Na(){Object.defineProperty(this,"id",{value:il++});this.uuid=Qb.generateUUID();this.name="";this.type="BufferGeometry";this.index=null;this.attributes={};this.morphAttributes={};this.morphTargetsRelative=!1;this.groups=[];this.boundingSphere=this.boundingBox=null;this.drawRange={start:0,count:Infinity};this.userData={}}function $a(c,f){void 0===c&&(c=new Na);void 0===f&&(f=
new qa);T.call(this);this.type="Mesh";this.geometry=c;this.material=f;this.updateMorphTargets()}function rb(c,f,b,d,g,l,r,v,x,w,A,D){ie.fromBufferAttribute(g,w);je.fromBufferAttribute(g,A);ke.fromBufferAttribute(g,D);g=c.morphTargetInfluences;if(f.morphTargets&&l&&g){xg.set(0,0,0);yg.set(0,0,0);zg.set(0,0,0);for(var J=0,N=l.length;J<N;J++){var L=g[J],S=l[J];0!==L&&(Wh.fromBufferAttribute(S,w),Xh.fromBufferAttribute(S,A),Yh.fromBufferAttribute(S,D),r?(xg.addScaledVector(Wh,L),yg.addScaledVector(Xh,
L),zg.addScaledVector(Yh,L)):(xg.addScaledVector(Wh.sub(ie),L),yg.addScaledVector(Xh.sub(je),L),zg.addScaledVector(Yh.sub(ke),L)))}ie.add(xg);je.add(yg);ke.add(zg)}c.isSkinnedMesh&&(c.boneTransform(w,ie),c.boneTransform(A,je),c.boneTransform(D,ke));l=ie;r=je;g=ke;J=Zh;null===(1===f.side?d.intersectTriangle(g,r,l,!0,J):d.intersectTriangle(l,r,g,2!==f.side,J))?c=null:(Ag.copy(J),Ag.applyMatrix4(c.matrixWorld),f=b.ray.origin.distanceTo(Ag),c=f<b.near||f>b.far?null:{distance:f,point:Ag.clone(),object:c});
c&&(v&&(Bg.fromBufferAttribute(v,w),Cg.fromBufferAttribute(v,A),Dg.fromBufferAttribute(v,D),c.uv=xd.getUV(Zh,ie,je,ke,Bg,Cg,Dg,new ib)),x&&(Bg.fromBufferAttribute(x,w),Cg.fromBufferAttribute(x,A),Dg.fromBufferAttribute(x,D),c.uv2=xd.getUV(Zh,ie,je,ke,Bg,Cg,Dg,new ib)),v=new $h(w,A,D),xd.getNormal(ie,je,ke,v.normal),c.face=v);return c}function lb(c){var f={},b;for(b in c){f[b]={};for(var d in c[b]){var g=c[b][d];g&&(g.isColor||g.isMatrix3||g.isMatrix4||g.isVector2||g.isVector3||g.isVector4||g.isTexture)?
f[b][d]=g.clone():Array.isArray(g)?f[b][d]=g.slice():f[b][d]=g}}return f}function jb(c){for(var f={},b=0;b<c.length;b++){var d=lb(c[b]),g;for(g in d)f[g]=d[g]}return f}function yb(c){U.call(this);this.type="ShaderMaterial";this.defines={};this.uniforms={};this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.linewidth=1;this.wireframe=!1;this.wireframeLinewidth=
1;this.morphNormals=this.morphTargets=this.skinning=this.clipping=this.lights=this.fog=!1;this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1};this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=void 0;this.uniformsNeedUpdate=!1;this.glslVersion=null;void 0!==c&&(void 0!==c.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(c))}function wb(){T.call(this);
this.type="Camera";this.matrixWorldInverse=new ec;this.projectionMatrix=new ec;this.projectionMatrixInverse=new ec}function Bb(c,f,b,d){void 0===c&&(c=50);void 0===f&&(f=1);void 0===b&&(b=.1);void 0===d&&(d=2E3);wb.call(this);this.type="PerspectiveCamera";this.fov=c;this.zoom=1;this.near=b;this.far=d;this.focus=10;this.aspect=f;this.view=null;this.filmGauge=35;this.filmOffset=0;this.updateProjectionMatrix()}function Tb(c,f,b){T.call(this);this.type="CubeCamera";if(!0!==b.isWebGLCubeRenderTarget)console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");
else{this.renderTarget=b;var d=new Bb(90,1,c,f);d.layers=this.layers;d.up.set(0,-1,0);d.lookAt(new da(1,0,0));this.add(d);var g=new Bb(90,1,c,f);g.layers=this.layers;g.up.set(0,-1,0);g.lookAt(new da(-1,0,0));this.add(g);var l=new Bb(90,1,c,f);l.layers=this.layers;l.up.set(0,0,1);l.lookAt(new da(0,1,0));this.add(l);var r=new Bb(90,1,c,f);r.layers=this.layers;r.up.set(0,0,-1);r.lookAt(new da(0,-1,0));this.add(r);var v=new Bb(90,1,c,f);v.layers=this.layers;v.up.set(0,-1,0);v.lookAt(new da(0,0,1));this.add(v);
var x=new Bb(90,1,c,f);x.layers=this.layers;x.up.set(0,-1,0);x.lookAt(new da(0,0,-1));this.add(x);this.update=function(w,A){null===this.parent&&this.updateMatrixWorld();var D=w.xr.enabled,J=w.getRenderTarget();w.xr.enabled=!1;var N=b.texture.generateMipmaps,L=A.onAfterRender;A.onAfterRender=function(){};b.texture.generateMipmaps=!1;w.setRenderTarget(b,0);w.render(A,d);w.setRenderTarget(b,1);w.render(A,g);w.setRenderTarget(b,2);w.render(A,l);w.setRenderTarget(b,3);w.render(A,r);w.setRenderTarget(b,
4);w.render(A,v);b.texture.generateMipmaps=N;w.setRenderTarget(b,5);w.render(A,x);A.onAfterRender=L;w.setRenderTarget(J);w.xr.enabled=D}}}function Ob(c,f,b,d,g,l,r,v,x,w){c=void 0!==c?c:[];R.call(this,c,void 0!==f?f:301,b,d,g,l,void 0!==r?r:1022,v,x,w);this.flipY=!1;this._needsFlipEnvMap=!0}function Ab(c,f,b,d,g,l,r,v,x,w,A,D){R.call(this,null,l,r,v,x,w,d,g,A,D);this.image={data:c||null,width:f||1,height:b||1};this.magFilter=void 0!==x?x:1003;this.minFilter=void 0!==w?w:1003;this.flipY=this.generateMipmaps=
!1;this.unpackAlignment=1;this.needsUpdate=!0}function mc(){function c(l,r){d(l,r);g=f.requestAnimationFrame(c)}var f=null,b=!1,d=null,g=null;return{start:function(){!0!==b&&null!==d&&(g=f.requestAnimationFrame(c),b=!0)},stop:function(){f.cancelAnimationFrame(g);b=!1},setAnimationLoop:function(l){d=l},setContext:function(l){f=l}}}function Ec(c,f){var b=f.isWebGL2,d=new WeakMap;return{get:function(g){g.isInterleavedBufferAttribute&&(g=g.data);return d.get(g)},remove:function(g){g.isInterleavedBufferAttribute&&
(g=g.data);var l=d.get(g);l&&(c.deleteBuffer(l.buffer),d.delete(g))},update:function(g,l){if(g.isGLBufferAttribute)l=d.get(g),(!l||l.version<g.version)&&d.set(g,{buffer:g.buffer,type:g.type,bytesPerElement:g.elementSize,version:g.version});else{g.isInterleavedBufferAttribute&&(g=g.data);var r=d.get(g);if(void 0===r){r=d.set;var v=g,x=g.array,w=g.usage,A=c.createBuffer();c.bindBuffer(l,A);c.bufferData(l,x,w);g.onUploadCallback();l=5126;x instanceof Float32Array?l=5126:x instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):
x instanceof Uint16Array?g.isFloat16BufferAttribute?b?l=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):l=5123:x instanceof Int16Array?l=5122:x instanceof Uint32Array?l=5125:x instanceof Int32Array?l=5124:x instanceof Int8Array?l=5120:x instanceof Uint8Array&&(l=5121);r.call(d,v,{buffer:A,type:l,bytesPerElement:x.BYTES_PER_ELEMENT,version:g.version})}else r.version<g.version&&(v=g.array,x=g.updateRange,c.bindBuffer(l,r.buffer),-1===x.count?c.bufferSubData(l,
0,v):(b?c.bufferSubData(l,x.offset*v.BYTES_PER_ELEMENT,v,x.offset,x.count):c.bufferSubData(l,x.offset*v.BYTES_PER_ELEMENT,v.subarray(x.offset,x.offset+x.count)),x.count=-1),r.version=g.version)}}}}function Sc(c,f,b,d,g){function l(N,L){b.buffers.color.setClear(N.r,N.g,N.b,L,g)}var r=new Cb(0),v=0,x,w,A=null,D=0,J=null;return{getClearColor:function(){return r},setClearColor:function(N,L){void 0===L&&(L=1);r.set(N);v=L;l(r,v)},getClearAlpha:function(){return v},setClearAlpha:function(N){v=N;l(r,v)},
render:function(N,L,S,P){(L=!0===L.isScene?L.background:null)&&L.isTexture&&(L=f.get(L));S=c.xr;(S=S.getSession&&S.getSession())&&"additive"===S.environmentBlendMode&&(L=null);null===L?l(r,v):L&&L.isColor&&(l(L,1),P=!0);(c.autoClear||P)&&c.clear(c.autoClearColor,c.autoClearDepth,c.autoClearStencil);if(L&&(L.isCubeTexture||L.isWebGLCubeRenderTarget||306===L.mapping)){void 0===w&&(w=new $a(new Ie(1,1,1),new yb({name:"BackgroundCubeMaterial",uniforms:lb(md.cube.uniforms),vertexShader:md.cube.vertexShader,
fragmentShader:md.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),w.geometry.deleteAttribute("normal"),w.geometry.deleteAttribute("uv"),w.onBeforeRender=function(ka,ia,la){this.matrixWorld.copyPosition(la.matrixWorld)},Object.defineProperty(w.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),d.update(w));L.isWebGLCubeRenderTarget&&(L=L.texture);w.material.uniforms.envMap.value=L;w.material.uniforms.flipEnvMap.value=L.isCubeTexture&&L._needsFlipEnvMap?-1:1;if(A!==
L||D!==L.version||J!==c.toneMapping)w.material.needsUpdate=!0,A=L,D=L.version,J=c.toneMapping;N.unshift(w,w.geometry,w.material,0,0,null)}else if(L&&L.isTexture){void 0===x&&(x=new $a(new Qf(2,2),new yb({name:"BackgroundMaterial",uniforms:lb(md.background.uniforms),vertexShader:md.background.vertexShader,fragmentShader:md.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),x.geometry.deleteAttribute("normal"),Object.defineProperty(x.material,"map",{get:function(){return this.uniforms.t2D.value}}),
d.update(x));x.material.uniforms.t2D.value=L;!0===L.matrixAutoUpdate&&L.updateMatrix();x.material.uniforms.uvTransform.value.copy(L.matrix);if(A!==L||D!==L.version||J!==c.toneMapping)x.material.needsUpdate=!0,A=L,D=L.version,J=c.toneMapping;N.unshift(x,x.geometry,x.material,0,0,null)}}}}function Je(c,f,b,d){function g(la){return d.isWebGL2?c.bindVertexArray(la):L.bindVertexArrayOES(la)}function l(la){return d.isWebGL2?c.deleteVertexArray(la):L.deleteVertexArrayOES(la)}function r(la){for(var oa=[],
Ca=[],Aa=[],ra=0;ra<N;ra++)oa[ra]=0,Ca[ra]=0,Aa[ra]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:oa,enabledAttributes:Ca,attributeDivisors:Aa,object:la,attributes:{},index:null}}function v(){for(var la=ia.newAttributes,oa=0,Ca=la.length;oa<Ca;oa++)la[oa]=0}function x(la){w(la,0)}function w(la,oa){var Ca=ia.enabledAttributes,Aa=ia.attributeDivisors;ia.newAttributes[la]=1;0===Ca[la]&&(c.enableVertexAttribArray(la),Ca[la]=1);Aa[la]!==oa&&((d.isWebGL2?c:f.get("ANGLE_instanced_arrays"))[d.isWebGL2?
"vertexAttribDivisor":"vertexAttribDivisorANGLE"](la,oa),Aa[la]=oa)}function A(){for(var la=ia.newAttributes,oa=ia.enabledAttributes,Ca=0,Aa=oa.length;Ca<Aa;Ca++)oa[Ca]!==la[Ca]&&(c.disableVertexAttribArray(Ca),oa[Ca]=0)}function D(){J();ia!==ka&&(ia=ka,g(ia.object))}function J(){ka.geometry=null;ka.program=null;ka.wireframe=!1}var N=c.getParameter(34921),L=d.isWebGL2?null:f.get("OES_vertex_array_object"),S=d.isWebGL2||null!==L,P={},ka=r(null),ia=ka;return{setup:function(la,oa,Ca,Aa,ra){var Ja=!1;
if(S){Ja=!0===oa.wireframe;var Ra=P[Aa.id];void 0===Ra&&(Ra={},P[Aa.id]=Ra);var xa=Ra[Ca.id];void 0===xa&&(xa={},Ra[Ca.id]=xa);Ra=xa[Ja];void 0===Ra&&(Ra=r(d.isWebGL2?c.createVertexArray():L.createVertexArrayOES()),xa[Ja]=Ra);Ja=Ra;ia!==Ja&&(ia=Ja,g(ia.object));a:{Ja=ia.attributes;xa=Aa.attributes;Ra=0;for(var Ga in xa){var Oa=Ja[Ga],nb=xa[Ga];if(void 0===Oa||Oa.attribute!==nb||Oa.data!==nb.data){Ja=!0;break a}Ra++}Ja=ia.attributesNum!==Ra||ia.index!==ra?!0:!1}if(Ja){Ga={};xa=Aa.attributes;Ra=0;for(var Ba in xa)Oa=
xa[Ba],nb={},nb.attribute=Oa,Oa.data&&(nb.data=Oa.data),Ga[Ba]=nb,Ra++;ia.attributes=Ga;ia.attributesNum=Ra;ia.index=ra}}else if(Ba=!0===oa.wireframe,ia.geometry!==Aa.id||ia.program!==Ca.id||ia.wireframe!==Ba)ia.geometry=Aa.id,ia.program=Ca.id,ia.wireframe=Ba,Ja=!0;!0===la.isInstancedMesh&&(Ja=!0);null!==ra&&b.update(ra,34963);if(Ja){if(!1!==d.isWebGL2||!la.isInstancedMesh&&!Aa.isInstancedBufferGeometry||null!==f.get("ANGLE_instanced_arrays")){v();Ba=Aa.attributes;Ca=Ca.getAttributes();oa=oa.defaultAttributeValues;
for(var Ea in Ca)if(Ja=Ca[Ea],0<=Ja){var Pa=Ba[Ea];if(void 0!==Pa){if(Ga=Pa.normalized,Oa=Pa.itemSize,Ra=b.get(Pa),void 0!==Ra){var qb=Ra.buffer;xa=Ra.type;Ra=Ra.bytesPerElement;if(Pa.isInterleavedBufferAttribute){var Va=Pa.data;nb=Va.stride;Pa=Pa.offset;Va&&Va.isInstancedInterleavedBuffer?(w(Ja,Va.meshPerAttribute),void 0===Aa._maxInstanceCount&&(Aa._maxInstanceCount=Va.meshPerAttribute*Va.count)):x(Ja);c.bindBuffer(34962,qb);nb*=Ra;Ra*=Pa;!0!==d.isWebGL2||5124!==xa&&5125!==xa?c.vertexAttribPointer(Ja,
Oa,xa,Ga,nb,Ra):c.vertexAttribIPointer(Ja,Oa,xa,nb,Ra)}else Pa.isInstancedBufferAttribute?(w(Ja,Pa.meshPerAttribute),void 0===Aa._maxInstanceCount&&(Aa._maxInstanceCount=Pa.meshPerAttribute*Pa.count)):x(Ja),c.bindBuffer(34962,qb),Ra=Oa,!0!==d.isWebGL2||5124!==xa&&5125!==xa?c.vertexAttribPointer(Ja,Ra,xa,Ga,0,0):c.vertexAttribIPointer(Ja,Ra,xa,0,0)}}else if("instanceMatrix"===Ea)xa=b.get(la.instanceMatrix),void 0!==xa&&(Ga=xa.buffer,xa=xa.type,w(Ja+0,1),w(Ja+1,1),w(Ja+2,1),w(Ja+3,1),c.bindBuffer(34962,
Ga),c.vertexAttribPointer(Ja+0,4,xa,!1,64,0),c.vertexAttribPointer(Ja+1,4,xa,!1,64,16),c.vertexAttribPointer(Ja+2,4,xa,!1,64,32),c.vertexAttribPointer(Ja+3,4,xa,!1,64,48));else if("instanceColor"===Ea)xa=b.get(la.instanceColor),void 0!==xa&&(Ga=xa.buffer,xa=xa.type,w(Ja,1),c.bindBuffer(34962,Ga),c.vertexAttribPointer(Ja,3,xa,!1,12,0));else if(void 0!==oa&&(Ga=oa[Ea],void 0!==Ga))switch(Ga.length){case 2:c.vertexAttrib2fv(Ja,Ga);break;case 3:c.vertexAttrib3fv(Ja,Ga);break;case 4:c.vertexAttrib4fv(Ja,
Ga);break;default:c.vertexAttrib1fv(Ja,Ga)}}A()}null!==ra&&c.bindBuffer(34963,b.get(ra).buffer)}},reset:D,resetDefaultState:J,dispose:function(){D();for(var la in P){var oa=P[la],Ca;for(Ca in oa){var Aa=oa[Ca],ra;for(ra in Aa)l(Aa[ra].object),delete Aa[ra];delete oa[Ca]}delete P[la]}},releaseStatesOfGeometry:function(la){if(void 0!==P[la.id]){var oa=P[la.id],Ca;for(Ca in oa){var Aa=oa[Ca],ra;for(ra in Aa)l(Aa[ra].object),delete Aa[ra];delete oa[Ca]}delete P[la.id]}},releaseStatesOfProgram:function(la){for(var oa in P){var Ca=
P[oa];if(void 0!==Ca[la.id]){var Aa=Ca[la.id],ra;for(ra in Aa)l(Aa[ra].object),delete Aa[ra];delete Ca[la.id]}}},initAttributes:v,enableAttribute:x,disableUnusedAttributes:A}}function lf(c,f,b,d){var g=d.isWebGL2,l;this.setMode=function(r){l=r};this.render=function(r,v){c.drawArrays(l,r,v);b.update(v,l,1)};this.renderInstances=function(r,v,x){if(0!==x){if(g){var w=c;var A="drawArraysInstanced"}else if(w=f.get("ANGLE_instanced_arrays"),A="drawArraysInstancedANGLE",null===w){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");
return}w[A](l,r,v,x);b.update(v,l,x)}}}function Ma(c,f,b){function d(la){if("highp"===la){if(0<c.getShaderPrecisionFormat(35633,36338).precision&&0<c.getShaderPrecisionFormat(35632,36338).precision)return"highp";la="mediump"}return"mediump"===la&&0<c.getShaderPrecisionFormat(35633,36337).precision&&0<c.getShaderPrecisionFormat(35632,36337).precision?"mediump":"lowp"}var g,l="undefined"!==typeof WebGL2RenderingContext&&c instanceof WebGL2RenderingContext||"undefined"!==typeof WebGL2ComputeRenderingContext&&
c instanceof WebGL2ComputeRenderingContext,r=void 0!==b.precision?b.precision:"highp",v=d(r);v!==r&&(console.warn("THREE.WebGLRenderer:",r,"not supported, using",v,"instead."),r=v);b=!0===b.logarithmicDepthBuffer;v=c.getParameter(34930);var x=c.getParameter(35660),w=c.getParameter(3379),A=c.getParameter(34076),D=c.getParameter(34921),J=c.getParameter(36347),N=c.getParameter(36348),L=c.getParameter(36349),S=0<x,P=l||!!f.get("OES_texture_float"),ka=S&&P,ia=l?c.getParameter(36183):0;return{isWebGL2:l,
getMaxAnisotropy:function(){if(void 0!==g)return g;var la=f.get("EXT_texture_filter_anisotropic");return g=null!==la?c.getParameter(la.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:d,precision:r,logarithmicDepthBuffer:b,maxTextures:v,maxVertexTextures:x,maxTextureSize:w,maxCubemapSize:A,maxAttributes:D,maxVertexUniforms:J,maxVaryings:N,maxFragmentUniforms:L,vertexTextures:S,floatFragmentTextures:P,floatVertexTextures:ka,maxSamples:ia}}function va(c){function f(){A.value!==g&&(A.value=g,A.needsUpdate=
0<l);d.numPlanes=l;d.numIntersection=0}function b(D,J,N,L){var S=null!==D?D.length:0,P=null;if(0!==S){P=A.value;if(!0!==L||null===P){L=N+4*S;J=J.matrixWorldInverse;w.getNormalMatrix(J);if(null===P||P.length<L)P=new Float32Array(L);for(L=0;L!==S;++L,N+=4)x.copy(D[L]).applyMatrix4(J,w),x.normal.toArray(P,N),P[N+3]=x.constant}A.value=P;A.needsUpdate=!0}d.numPlanes=S;d.numIntersection=0;return P}var d=this,g=null,l=0,r=!1,v=!1,x=new yd,w=new fd,A={value:null,needsUpdate:!1};this.uniform=A;this.numIntersection=
this.numPlanes=0;this.init=function(D,J,N){var L=0!==D.length||J||0!==l||r;r=J;g=b(D,N,0);l=D.length;return L};this.beginShadows=function(){v=!0;b(null)};this.endShadows=function(){v=!1;f()};this.setState=function(D,J,N){var L=D.clippingPlanes,S=D.clipIntersection,P=D.clipShadows;D=c.get(D);if(!r||null===L||0===L.length||v&&!P)v?b(null):f();else{P=v?0:l;var ka=4*P,ia=D.clippingState||null;A.value=ia;ia=b(L,J,ka,N);for(J=0;J!==ka;++J)ia[J]=g[J];D.clippingState=ia;this.numIntersection=S?this.numPlanes:
0;this.numPlanes+=P}}}function X(c){function f(g,l){303===l?g.mapping=301:304===l&&(g.mapping=302);return g}function b(g){g=g.target;g.removeEventListener("dispose",b);var l=d.get(g);void 0!==l&&(d.delete(g),l.dispose())}var d=new WeakMap;return{get:function(g){if(g&&g.isTexture){var l=g.mapping;if(303===l||304===l){if(d.has(g))return l=d.get(g).texture,f(l,g.mapping);var r=g.image;if(r&&0<r.height){l=c.getRenderList();var v=c.getRenderTarget();r=new ai(r.height/2);r.fromEquirectangularTexture(c,
g);d.set(g,r);c.setRenderTarget(v);c.setRenderList(l);g.addEventListener("dispose",b);return f(r.texture,g.mapping)}return null}}return g},dispose:function(){d=new WeakMap}}}function aa(c){function f(d){if(void 0!==b[d])return b[d];switch(d){case "WEBGL_depth_texture":var g=c.getExtension("WEBGL_depth_texture")||c.getExtension("MOZ_WEBGL_depth_texture")||c.getExtension("WEBKIT_WEBGL_depth_texture");break;case "EXT_texture_filter_anisotropic":g=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||
c.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case "WEBGL_compressed_texture_s3tc":g=c.getExtension("WEBGL_compressed_texture_s3tc")||c.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||c.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case "WEBGL_compressed_texture_pvrtc":g=c.getExtension("WEBGL_compressed_texture_pvrtc")||c.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:g=c.getExtension(d)}return b[d]=g}var b={};return{has:function(d){return null!==
f(d)},init:function(d){d.isWebGL2?f("EXT_color_buffer_float"):(f("WEBGL_depth_texture"),f("OES_texture_float"),f("OES_texture_half_float"),f("OES_texture_half_float_linear"),f("OES_standard_derivatives"),f("OES_element_index_uint"),f("OES_vertex_array_object"),f("ANGLE_instanced_arrays"));f("OES_texture_float_linear");f("EXT_color_buffer_half_float")},get:function(d){var g=f(d);null===g&&console.warn("THREE.WebGLRenderer: "+d+" extension not supported.");return g}}}function ma(c,f,b,d){function g(x){x=
x.target;null!==x.index&&f.remove(x.index);for(var w in x.attributes)f.remove(x.attributes[w]);x.removeEventListener("dispose",g);delete r[x.id];if(w=v.get(x))f.remove(w),v.delete(x);d.releaseStatesOfGeometry(x);!0===x.isInstancedBufferGeometry&&delete x._maxInstanceCount;b.memory.geometries--}function l(x){var w=[],A=x.index,D=x.attributes.position;if(null!==A){D=A.array;A=A.version;for(var J=0,N=D.length;J<N;J+=3){var L=D[J+0],S=D[J+1],P=D[J+2];w.push(L,S,S,P,P,L)}}else for(J=D.array,A=D.version,
D=0,J=J.length/3-1;D<J;D+=3)N=D+0,L=D+1,S=D+2,w.push(N,L,L,S,S,N);w=new (65535<Ia(w)?cb:ta)(w,1);w.version=A;(A=v.get(x))&&f.remove(A);v.set(x,w)}var r={},v=new WeakMap;return{get:function(x,w){if(!0===r[w.id])return w;w.addEventListener("dispose",g);r[w.id]=!0;b.memory.geometries++;return w},update:function(x){var w=x.attributes;for(D in w)f.update(w[D],34962);x=x.morphAttributes;for(var A in x){w=x[A];var D=0;for(var J=w.length;D<J;D++)f.update(w[D],34962)}},getWireframeAttribute:function(x){var w=
v.get(x);if(w){var A=x.index;null!==A&&w.version<A.version&&l(x)}else l(x);return v.get(x)}}}function Da(c,f,b,d){var g=d.isWebGL2,l,r,v;this.setMode=function(x){l=x};this.setIndex=function(x){r=x.type;v=x.bytesPerElement};this.render=function(x,w){c.drawElements(l,w,r,x*v);b.update(w,l,1)};this.renderInstances=function(x,w,A){if(0!==A){if(g){var D=c;var J="drawElementsInstanced"}else if(D=f.get("ANGLE_instanced_arrays"),J="drawElementsInstancedANGLE",null===D){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");
return}D[J](l,w,r,x*v,A);b.update(w,l,A)}}}function Ha(c){var f={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:f,programs:null,autoReset:!0,reset:function(){f.frame++;f.calls=0;f.triangles=0;f.points=0;f.lines=0},update:function(b,d,g){f.calls++;switch(d){case 4:f.triangles+=b/3*g;break;case 1:f.lines+=b/2*g;break;case 3:f.lines+=g*(b-1);break;case 2:f.lines+=g*b;break;case 0:f.points+=g*b;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",
d)}}}}function Sa(c,f){return c[0]-f[0]}function Fa(c,f){return Math.abs(f[1])-Math.abs(c[1])}function ob(c){for(var f={},b=new Float32Array(8),d=[],g=0;8>g;g++)d[g]=[g,0];return{update:function(l,r,v,x){var w=l.morphTargetInfluences;l=void 0===w?0:w.length;var A=f[r.id];if(void 0===A){A=[];for(var D=0;D<l;D++)A[D]=[D,0];f[r.id]=A}for(D=0;D<l;D++){var J=A[D];J[0]=D;J[1]=w[D]}A.sort(Fa);for(w=0;8>w;w++)w<l&&A[w][1]?(d[w][0]=A[w][0],d[w][1]=A[w][1]):(d[w][0]=Number.MAX_SAFE_INTEGER,d[w][1]=0);d.sort(Sa);
l=v.morphTargets&&r.morphAttributes.position;v=v.morphNormals&&r.morphAttributes.normal;for(w=A=0;8>w;w++)J=d[w],D=J[0],J=J[1],D!==Number.MAX_SAFE_INTEGER&&J?(l&&r.getAttribute("morphTarget"+w)!==l[D]&&r.setAttribute("morphTarget"+w,l[D]),v&&r.getAttribute("morphNormal"+w)!==v[D]&&r.setAttribute("morphNormal"+w,v[D]),b[w]=J,A+=J):(l&&!0===r.hasAttribute("morphTarget"+w)&&r.deleteAttribute("morphTarget"+w),v&&!0===r.hasAttribute("morphNormal"+w)&&r.deleteAttribute("morphNormal"+w),b[w]=0);r=r.morphTargetsRelative?
1:1-A;x.getUniforms().setValue(c,"morphTargetBaseInfluence",r);x.getUniforms().setValue(c,"morphTargetInfluences",b)}}}function mb(c,f,b,d){function g(r){r=r.target;r.removeEventListener("dispose",g);b.remove(r.instanceMatrix);null!==r.instanceColor&&b.remove(r.instanceColor)}var l=new WeakMap;return{update:function(r){var v=d.render.frame,x=f.get(r,r.geometry);l.get(x)!==v&&(f.update(x),l.set(x,v));r.isInstancedMesh&&(!1===r.hasEventListener("dispose",g)&&r.addEventListener("dispose",g),b.update(r.instanceMatrix,
34962),null!==r.instanceColor&&b.update(r.instanceColor,34962));return x},dispose:function(){l=new WeakMap}}}function pb(c,f,b,d){void 0===c&&(c=null);void 0===f&&(f=1);void 0===b&&(b=1);void 0===d&&(d=1);R.call(this,null);this.image={data:c,width:f,height:b,depth:d};this.minFilter=this.magFilter=1003;this.wrapR=1001;this.flipY=this.generateMipmaps=!1;this.needsUpdate=!0}function Kb(c,f,b,d){void 0===c&&(c=null);void 0===f&&(f=1);void 0===b&&(b=1);void 0===d&&(d=1);R.call(this,null);this.image={data:c,
width:f,height:b,depth:d};this.minFilter=this.magFilter=1003;this.wrapR=1001;this.flipY=this.generateMipmaps=!1;this.needsUpdate=!0}function Mb(c,f,b){var d=c[0];if(0>=d||0<d)return c;var g=f*b,l=uj[g];void 0===l&&(l=new Float32Array(g),uj[g]=l);if(0!==f)for(d.toArray(l,0),d=1,g=0;d!==f;++d)g+=b,c[d].toArray(l,g);return l}function Gb(c,f){if(c.length!==f.length)return!1;for(var b=0,d=c.length;b<d;b++)if(c[b]!==f[b])return!1;return!0}function Ub(c,f){for(var b=0,d=f.length;b<d;b++)c[b]=f[b]}function Cc(c,
f){var b=vj[f];void 0===b&&(b=new Int32Array(f),vj[f]=b);for(var d=0;d!==f;++d)b[d]=c.allocateTextureUnit();return b}function id(c,f){var b=this.cache;b[0]!==f&&(c.uniform1f(this.addr,f),b[0]=f)}function Yc(c,f){var b=this.cache;if(void 0!==f.x){if(b[0]!==f.x||b[1]!==f.y)c.uniform2f(this.addr,f.x,f.y),b[0]=f.x,b[1]=f.y}else Gb(b,f)||(c.uniform2fv(this.addr,f),Ub(b,f))}function zd(c,f){var b=this.cache;if(void 0!==f.x){if(b[0]!==f.x||b[1]!==f.y||b[2]!==f.z)c.uniform3f(this.addr,f.x,f.y,f.z),b[0]=f.x,
b[1]=f.y,b[2]=f.z}else if(void 0!==f.r){if(b[0]!==f.r||b[1]!==f.g||b[2]!==f.b)c.uniform3f(this.addr,f.r,f.g,f.b),b[0]=f.r,b[1]=f.g,b[2]=f.b}else Gb(b,f)||(c.uniform3fv(this.addr,f),Ub(b,f))}function Zc(c,f){var b=this.cache;if(void 0!==f.x){if(b[0]!==f.x||b[1]!==f.y||b[2]!==f.z||b[3]!==f.w)c.uniform4f(this.addr,f.x,f.y,f.z,f.w),b[0]=f.x,b[1]=f.y,b[2]=f.z,b[3]=f.w}else Gb(b,f)||(c.uniform4fv(this.addr,f),Ub(b,f))}function oc(c,f){var b=this.cache,d=f.elements;void 0===d?Gb(b,f)||(c.uniformMatrix2fv(this.addr,
!1,f),Ub(b,f)):Gb(b,d)||(wj.set(d),c.uniformMatrix2fv(this.addr,!1,wj),Ub(b,d))}function pc(c,f){var b=this.cache,d=f.elements;void 0===d?Gb(b,f)||(c.uniformMatrix3fv(this.addr,!1,f),Ub(b,f)):Gb(b,d)||(xj.set(d),c.uniformMatrix3fv(this.addr,!1,xj),Ub(b,d))}function le(c,f){var b=this.cache,d=f.elements;void 0===d?Gb(b,f)||(c.uniformMatrix4fv(this.addr,!1,f),Ub(b,f)):Gb(b,d)||(yj.set(d),c.uniformMatrix4fv(this.addr,!1,yj),Ub(b,d))}function kc(c,f,b){var d=this.cache,g=b.allocateTextureUnit();d[0]!==
g&&(c.uniform1i(this.addr,g),d[0]=g);b.safeSetTexture2D(f||zj,g)}function mf(c,f,b){var d=this.cache,g=b.allocateTextureUnit();d[0]!==g&&(c.uniform1i(this.addr,g),d[0]=g);b.setTexture2DArray(f||jl,g)}function Lc(c,f,b){var d=this.cache,g=b.allocateTextureUnit();d[0]!==g&&(c.uniform1i(this.addr,g),d[0]=g);b.setTexture3D(f||kl,g)}function nf(c,f,b){var d=this.cache,g=b.allocateTextureUnit();d[0]!==g&&(c.uniform1i(this.addr,g),d[0]=g);b.safeSetTextureCube(f||Aj,g)}function Pd(c,f){var b=this.cache;b[0]!==
f&&(c.uniform1i(this.addr,f),b[0]=f)}function bi(c,f){var b=this.cache;Gb(b,f)||(c.uniform2iv(this.addr,f),Ub(b,f))}function Eg(c,f){var b=this.cache;Gb(b,f)||(c.uniform3iv(this.addr,f),Ub(b,f))}function Fg(c,f){var b=this.cache;Gb(b,f)||(c.uniform4iv(this.addr,f),Ub(b,f))}function Gg(c,f){var b=this.cache;b[0]!==f&&(c.uniform1ui(this.addr,f),b[0]=f)}function Hg(c){switch(c){case 5126:return id;case 35664:return Yc;case 35665:return zd;case 35666:return Zc;case 35674:return oc;case 35675:return pc;
case 35676:return le;case 5124:case 35670:return Pd;case 35667:case 35671:return bi;case 35668:case 35672:return Eg;case 35669:case 35673:return Fg;case 5125:return Gg;case 35678:case 36198:case 36298:case 36306:case 35682:return kc;case 35679:case 36299:case 36307:return Lc;case 35680:case 36300:case 36308:case 36293:return nf;case 36289:case 36303:case 36311:case 36292:return mf}}function Rf(c,f){c.uniform1fv(this.addr,f)}function Zb(c,f){c.uniform1iv(this.addr,f)}function Y(c,f){c.uniform2iv(this.addr,
f)}function hb(c,f){c.uniform3iv(this.addr,f)}function Ua(c,f){c.uniform4iv(this.addr,f)}function Sf(c,f){f=Mb(f,this.size,2);c.uniform2fv(this.addr,f)}function Gc(c,f){f=Mb(f,this.size,3);c.uniform3fv(this.addr,f)}function ci(c,f){f=Mb(f,this.size,4);c.uniform4fv(this.addr,f)}function di(c,f){f=Mb(f,this.size,4);c.uniformMatrix2fv(this.addr,!1,f)}function ei(c,f){f=Mb(f,this.size,9);c.uniformMatrix3fv(this.addr,!1,f)}function Ig(c,f){f=Mb(f,this.size,16);c.uniformMatrix4fv(this.addr,!1,f)}function Pc(c,
f,b){var d=f.length,g=Cc(b,d);c.uniform1iv(this.addr,g);for(c=0;c!==d;++c)b.safeSetTexture2D(f[c]||zj,g[c])}function fi(c,f,b){var d=f.length,g=Cc(b,d);c.uniform1iv(this.addr,g);for(c=0;c!==d;++c)b.safeSetTextureCube(f[c]||Aj,g[c])}function Jg(c){switch(c){case 5126:return Rf;case 35664:return Sf;case 35665:return Gc;case 35666:return ci;case 35674:return di;case 35675:return ei;case 35676:return Ig;case 5124:case 35670:return Zb;case 35667:case 35671:return Y;case 35668:case 35672:return hb;case 35669:case 35673:return Ua;
case 35678:case 36198:case 36298:case 36306:case 35682:return Pc;case 35680:case 36300:case 36308:case 36293:return fi}}function Kg(c,f,b){this.id=c;this.addr=b;this.cache=[];this.setValue=Hg(f.type)}function Tf(c,f,b){this.id=c;this.addr=b;this.cache=[];this.size=f.size;this.setValue=Jg(f.type)}function Lg(c){this.id=c;this.seq=[];this.map={}}function Ad(c,f){this.seq=[];this.map={};for(var b=c.getProgramParameter(f,35718),d=0;d<b;++d){var g=c.getActiveUniform(f,d),l=c.getUniformLocation(f,g.name),
r=this,v=g.name,x=v.length;for(gi.lastIndex=0;;){var w=gi.exec(v),A=gi.lastIndex,D=w[1],J=w[3];"]"===w[2]&&(D|=0);if(void 0===J||"["===J&&A+2===x){v=r;g=void 0===J?new Kg(D,g,l):new Tf(D,g,l);v.seq.push(g);v.map[g.id]=g;break}else J=r.map[D],void 0===J&&(J=new Lg(D),D=r,r=J,D.seq.push(r),D.map[r.id]=r),r=J}}}function me(c,f,b){f=c.createShader(f);c.shaderSource(f,b);c.compileShader(f);return f}function Hb(c){switch(c){case 3E3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE",
"( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",c),["Linear","( value )"]}}function Mg(c,f,b){var d=c.getShaderParameter(f,35713),g=c.getShaderInfoLog(f).trim();if(d&&""===g)return"";c=c.getShaderSource(f).split("\n");for(f=0;f<c.length;f++)c[f]=
f+1+": "+c[f];c=c.join("\n");return"THREE.WebGLShader: gl.getShaderInfoLog() "+b+"\n"+g+c}function Ke(c,f){f=Hb(f);return"vec4 "+c+"( vec4 value ) { return "+f[0]+"ToLinear"+f[1]+"; }"}function of(c,f){f=Hb(f);return"vec4 "+c+"( vec4 value ) { return LinearTo"+f[0]+f[1]+"; }"}function hi(c,f){switch(f){case 1:f="Linear";break;case 2:f="Reinhard";break;case 3:f="OptimizedCineon";break;case 4:f="ACESFilmic";break;case 5:f="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",
f),f="Linear"}return"vec3 "+c+"( vec3 color ) { return "+f+"ToneMapping( color ); }"}function ne(c){var f=[],b;for(b in c){var d=c[b];!1!==d&&f.push("#define "+b+" "+d)}return f.join("\n")}function Le(c){return""!==c}function Uf(c,f){return c.replace(/NUM_DIR_LIGHTS/g,f.numDirLights).replace(/NUM_SPOT_LIGHTS/g,f.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,f.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,f.numPointLights).replace(/NUM_HEMI_LIGHTS/g,f.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,
f.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,f.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,f.numPointLightShadows)}function pf(c,f){return c.replace(/NUM_CLIPPING_PLANES/g,f.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,f.numClippingPlanes-f.numClipIntersection)}function Me(c,f){c=cc[f];if(void 0===c)throw Error("Can not resolve #include <"+f+">");return c.replace(ii,Me)}function zc(c,f,b,d){console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead.");
return Vf(c,f,b,d)}function Vf(c,f,b,d){c="";for(f=parseInt(f);f<parseInt(b);f++)c+=d.replace(/\[\s*i\s*\]/g,"[ "+f+" ]").replace(/UNROLLED_LOOP_INDEX/g,f);return c}function Ng(c){var f="precision "+c.precision+" float;\nprecision "+c.precision+" int;";"highp"===c.precision?f+="\n#define HIGH_PRECISION":"mediump"===c.precision?f+="\n#define MEDIUM_PRECISION":"lowp"===c.precision&&(f+="\n#define LOW_PRECISION");return f}function ji(c){var f="SHADOWMAP_TYPE_BASIC";1===c.shadowMapType?f="SHADOWMAP_TYPE_PCF":
2===c.shadowMapType?f="SHADOWMAP_TYPE_PCF_SOFT":3===c.shadowMapType&&(f="SHADOWMAP_TYPE_VSM");return f}function ki(c){var f="ENVMAP_TYPE_CUBE";if(c.envMap)switch(c.envMapMode){case 301:case 302:f="ENVMAP_TYPE_CUBE";break;case 306:case 307:f="ENVMAP_TYPE_CUBE_UV"}return f}function li(c){var f="ENVMAP_MODE_REFLECTION";if(c.envMap)switch(c.envMapMode){case 302:case 307:f="ENVMAP_MODE_REFRACTION"}return f}function xc(c){var f="ENVMAP_BLENDING_NONE";if(c.envMap)switch(c.combine){case 0:f="ENVMAP_BLENDING_MULTIPLY";
break;case 1:f="ENVMAP_BLENDING_MIX";break;case 2:f="ENVMAP_BLENDING_ADD"}return f}function Wf(c,f,b,d){var g=c.getContext(),l=b.defines,r=b.vertexShader,v=b.fragmentShader,x=ji(b),w=ki(b),A=li(b),D=xc(b),J=0<c.gammaFactor?c.gammaFactor:1,N=b.isWebGL2?"":[b.extensionDerivatives||b.envMapCubeUV||b.bumpMap||b.tangentSpaceNormalMap||b.clearcoatNormalMap||b.flatShading||"physical"===b.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(b.extensionFragDepth||b.logarithmicDepthBuffer)&&b.rendererExtensionFragDepth?
"#extension GL_EXT_frag_depth : enable":"",b.extensionDrawBuffers&&b.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(b.extensionShaderTextureLOD||b.envMap)&&b.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Le).join("\n"),L=ne(l),S=g.createProgram(),P=b.glslVersion?"#version "+b.glslVersion+"\n":"";b.isRawShaderMaterial?(l=[L].filter(Le).join("\n"),0<l.length&&(l+="\n"),x=[N,L].filter(Le).join("\n"),0<x.length&&(x+="\n")):(l=
[Ng(b),"#define SHADER_NAME "+b.shaderName,L,b.instancing?"#define USE_INSTANCING":"",b.instancingColor?"#define USE_INSTANCING_COLOR":"",b.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+J,"#define MAX_BONES "+b.maxBones,b.useFog&&b.fog?"#define USE_FOG":"",b.useFog&&b.fogExp2?"#define FOG_EXP2":"",b.map?"#define USE_MAP":"",b.envMap?"#define USE_ENVMAP":"",b.envMap?"#define "+A:"",b.lightMap?"#define USE_LIGHTMAP":"",b.aoMap?"#define USE_AOMAP":"",b.emissiveMap?"#define USE_EMISSIVEMAP":
"",b.bumpMap?"#define USE_BUMPMAP":"",b.normalMap?"#define USE_NORMALMAP":"",b.normalMap&&b.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",b.normalMap&&b.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",b.clearcoatMap?"#define USE_CLEARCOATMAP":"",b.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",b.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",b.displacementMap&&b.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",b.specularMap?"#define USE_SPECULARMAP":
"",b.roughnessMap?"#define USE_ROUGHNESSMAP":"",b.metalnessMap?"#define USE_METALNESSMAP":"",b.alphaMap?"#define USE_ALPHAMAP":"",b.transmissionMap?"#define USE_TRANSMISSIONMAP":"",b.vertexTangents?"#define USE_TANGENT":"",b.vertexColors?"#define USE_COLOR":"",b.vertexUvs?"#define USE_UV":"",b.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",b.flatShading?"#define FLAT_SHADED":"",b.skinning?"#define USE_SKINNING":"",b.useVertexTexture?"#define BONE_TEXTURE":"",b.morphTargets?"#define USE_MORPHTARGETS":
"",b.morphNormals&&!1===b.flatShading?"#define USE_MORPHNORMALS":"",b.doubleSided?"#define DOUBLE_SIDED":"",b.flipSided?"#define FLIP_SIDED":"",b.shadowMapEnabled?"#define USE_SHADOWMAP":"",b.shadowMapEnabled?"#define "+x:"",b.sizeAttenuation?"#define USE_SIZEATTENUATION":"",b.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",b.logarithmicDepthBuffer&&b.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;",
"uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;",
"\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;",
"#endif","\n"].filter(Le).join("\n"),x=[N,Ng(b),"#define SHADER_NAME "+b.shaderName,L,b.alphaTest?"#define ALPHATEST "+b.alphaTest+(b.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+J,b.useFog&&b.fog?"#define USE_FOG":"",b.useFog&&b.fogExp2?"#define FOG_EXP2":"",b.map?"#define USE_MAP":"",b.matcap?"#define USE_MATCAP":"",b.envMap?"#define USE_ENVMAP":"",b.envMap?"#define "+w:"",b.envMap?"#define "+A:"",b.envMap?"#define "+D:"",b.lightMap?"#define USE_LIGHTMAP":"",b.aoMap?"#define USE_AOMAP":"",b.emissiveMap?
"#define USE_EMISSIVEMAP":"",b.bumpMap?"#define USE_BUMPMAP":"",b.normalMap?"#define USE_NORMALMAP":"",b.normalMap&&b.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",b.normalMap&&b.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",b.clearcoatMap?"#define USE_CLEARCOATMAP":"",b.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",b.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",b.specularMap?"#define USE_SPECULARMAP":"",b.roughnessMap?"#define USE_ROUGHNESSMAP":"",
b.metalnessMap?"#define USE_METALNESSMAP":"",b.alphaMap?"#define USE_ALPHAMAP":"",b.sheen?"#define USE_SHEEN":"",b.transmissionMap?"#define USE_TRANSMISSIONMAP":"",b.vertexTangents?"#define USE_TANGENT":"",b.vertexColors||b.instancingColor?"#define USE_COLOR":"",b.vertexUvs?"#define USE_UV":"",b.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",b.gradientMap?"#define USE_GRADIENTMAP":"",b.flatShading?"#define FLAT_SHADED":"",b.doubleSided?"#define DOUBLE_SIDED":"",b.flipSided?"#define FLIP_SIDED":"",b.shadowMapEnabled?
"#define USE_SHADOWMAP":"",b.shadowMapEnabled?"#define "+x:"",b.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",b.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",b.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",b.logarithmicDepthBuffer&&b.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(b.extensionShaderTextureLOD||b.envMap)&&b.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",
0!==b.toneMapping?"#define TONE_MAPPING":"",0!==b.toneMapping?cc.tonemapping_pars_fragment:"",0!==b.toneMapping?hi("toneMapping",b.toneMapping):"",b.dithering?"#define DITHERING":"",cc.encodings_pars_fragment,b.map?Ke("mapTexelToLinear",b.mapEncoding):"",b.matcap?Ke("matcapTexelToLinear",b.matcapEncoding):"",b.envMap?Ke("envMapTexelToLinear",b.envMapEncoding):"",b.emissiveMap?Ke("emissiveMapTexelToLinear",b.emissiveMapEncoding):"",b.lightMap?Ke("lightMapTexelToLinear",b.lightMapEncoding):"",of("linearToOutputTexel",
b.outputEncoding),b.depthPacking?"#define DEPTH_PACKING "+b.depthPacking:"","\n"].filter(Le).join("\n"));r=r.replace(ii,Me);r=Uf(r,b);r=pf(r,b);v=v.replace(ii,Me);v=Uf(v,b);v=pf(v,b);r=r.replace(Bj,Vf).replace(Cj,zc);v=v.replace(Bj,Vf).replace(Cj,zc);b.isWebGL2&&!0!==b.isRawShaderMaterial&&(P="#version 300 es\n",l="#define attribute in\n#define varying out\n#define texture2D texture\n"+l,x=["#define varying in","300 es"===b.glslVersion?"":"out highp vec4 pc_fragColor;","300 es"===b.glslVersion?"":
"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth\n#define texture2D texture\n#define textureCube texture\n#define texture2DProj textureProj\n#define texture2DLodEXT textureLod\n#define texture2DProjLodEXT textureProjLod\n#define textureCubeLodEXT textureLod\n#define texture2DGradEXT textureGrad\n#define texture2DProjGradEXT textureProjGrad\n#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+x);v=P+x+v;r=me(g,35633,P+l+r);v=me(g,35632,v);g.attachShader(S,r);g.attachShader(S,
v);void 0!==b.index0AttributeName?g.bindAttribLocation(S,0,b.index0AttributeName):!0===b.morphTargets&&g.bindAttribLocation(S,0,"position");g.linkProgram(S);if(c.debug.checkShaderErrors){c=g.getProgramInfoLog(S).trim();P=g.getShaderInfoLog(r).trim();w=g.getShaderInfoLog(v).trim();D=A=!0;if(!1===g.getProgramParameter(S,35714))A=!1,J=Mg(g,r,"vertex"),N=Mg(g,v,"fragment"),console.error("THREE.WebGLProgram: shader error: ",g.getError(),"35715",g.getProgramParameter(S,35715),"gl.getProgramInfoLog",c,J,
N);else if(""!==c)console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",c);else if(""===P||""===w)D=!1;D&&(this.diagnostics={runnable:A,programLog:c,vertexShader:{log:P,prefix:l},fragmentShader:{log:w,prefix:x}})}g.deleteShader(r);g.deleteShader(v);var ka;this.getUniforms=function(){void 0===ka&&(ka=new Ad(g,S));return ka};var ia;this.getAttributes=function(){if(void 0===ia){for(var la={},oa=g.getProgramParameter(S,35721),Ca=0;Ca<oa;Ca++){var Aa=g.getActiveAttrib(S,Ca).name;la[Aa]=g.getAttribLocation(S,
Aa)}ia=la}return ia};this.destroy=function(){d.releaseStatesOfProgram(this);g.deleteProgram(S);this.program=void 0};this.name=b.shaderName;this.id=ll++;this.cacheKey=f;this.usedTimes=1;this.program=S;this.vertexShader=r;this.fragmentShader=v;return this}function Og(c,f,b,d,g,l){function r(P){P&&P.isTexture?P=P.encoding:P&&P.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),P=P.texture.encoding):
P=3E3;return P}var v=[],x=d.isWebGL2,w=d.logarithmicDepthBuffer,A=d.floatVertexTextures,D=d.maxVertexUniforms,J=d.vertexTextures,N=d.precision,L={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",
ShadowMaterial:"shadow",SpriteMaterial:"sprite"},S="precision isWebGL2 supportsVertexTextures outputEncoding instancing instancingColor map mapEncoding matcap matcapEncoding envMap envMapMode envMapEncoding envMapCubeUV lightMap lightMapEncoding aoMap emissiveMap emissiveMapEncoding bumpMap normalMap objectSpaceNormalMap tangentSpaceNormalMap clearcoatMap clearcoatRoughnessMap clearcoatNormalMap displacementMap specularMap roughnessMap metalnessMap gradientMap alphaMap combine vertexColors vertexTangents vertexUvs uvsVertexOnly fog useFog fogExp2 flatShading sizeAttenuation logarithmicDepthBuffer skinning maxBones useVertexTexture morphTargets morphNormals maxMorphTargets maxMorphNormals premultipliedAlpha numDirLights numPointLights numSpotLights numHemiLights numRectAreaLights numDirLightShadows numPointLightShadows numSpotLightShadows shadowMapEnabled shadowMapType toneMapping physicallyCorrectLights alphaTest doubleSided flipSided numClippingPlanes numClipIntersection depthPacking dithering sheen transmissionMap".split(" ");
return{getParameters:function(P,ka,ia,la,oa){var Ca=la.fog;la=P.isMeshStandardMaterial?la.environment:null;la=f.get(P.envMap||la);var Aa=L[P.type];if(oa.isSkinnedMesh){var ra=oa.skeleton.bones;if(A)ra=1024;else{var Ja=Math.min(Math.floor((D-20)/4),ra.length);Ja<ra.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+ra.length+" bones. This GPU supports "+Ja+"."),ra=0):ra=Ja}}else ra=0;null!==P.precision&&(N=d.getMaxPrecision(P.precision),N!==P.precision&&console.warn("THREE.WebGLProgram.getParameters:",
P.precision,"not supported, using",N,"instead."));if(Aa){var Ra=md[Aa];Ja=Ra.vertexShader;Ra=Ra.fragmentShader}else Ja=P.vertexShader,Ra=P.fragmentShader;var xa=c.getRenderTarget();return{isWebGL2:x,shaderID:Aa,shaderName:P.type,vertexShader:Ja,fragmentShader:Ra,defines:P.defines,isRawShaderMaterial:!0===P.isRawShaderMaterial,glslVersion:P.glslVersion,precision:N,instancing:!0===oa.isInstancedMesh,instancingColor:!0===oa.isInstancedMesh&&null!==oa.instanceColor,supportsVertexTextures:J,outputEncoding:null!==
xa?r(xa.texture):c.outputEncoding,map:!!P.map,mapEncoding:r(P.map),matcap:!!P.matcap,matcapEncoding:r(P.matcap),envMap:!!la,envMapMode:la&&la.mapping,envMapEncoding:r(la),envMapCubeUV:!!la&&(306===la.mapping||307===la.mapping),lightMap:!!P.lightMap,lightMapEncoding:r(P.lightMap),aoMap:!!P.aoMap,emissiveMap:!!P.emissiveMap,emissiveMapEncoding:r(P.emissiveMap),bumpMap:!!P.bumpMap,normalMap:!!P.normalMap,objectSpaceNormalMap:1===P.normalMapType,tangentSpaceNormalMap:0===P.normalMapType,clearcoatMap:!!P.clearcoatMap,
clearcoatRoughnessMap:!!P.clearcoatRoughnessMap,clearcoatNormalMap:!!P.clearcoatNormalMap,displacementMap:!!P.displacementMap,roughnessMap:!!P.roughnessMap,metalnessMap:!!P.metalnessMap,specularMap:!!P.specularMap,alphaMap:!!P.alphaMap,gradientMap:!!P.gradientMap,sheen:!!P.sheen,transmissionMap:!!P.transmissionMap,combine:P.combine,vertexTangents:P.normalMap&&P.vertexTangents,vertexColors:P.vertexColors,vertexUvs:!!P.map||!!P.bumpMap||!!P.normalMap||!!P.specularMap||!!P.alphaMap||!!P.emissiveMap||
!!P.roughnessMap||!!P.metalnessMap||!!P.clearcoatMap||!!P.clearcoatRoughnessMap||!!P.clearcoatNormalMap||!!P.displacementMap||!!P.transmissionMap,uvsVertexOnly:!(P.map||P.bumpMap||P.normalMap||P.specularMap||P.alphaMap||P.emissiveMap||P.roughnessMap||P.metalnessMap||P.clearcoatNormalMap||P.transmissionMap)&&!!P.displacementMap,fog:!!Ca,useFog:P.fog,fogExp2:Ca&&Ca.isFogExp2,flatShading:P.flatShading,sizeAttenuation:P.sizeAttenuation,logarithmicDepthBuffer:w,skinning:P.skinning&&0<ra,maxBones:ra,useVertexTexture:A,
morphTargets:P.morphTargets,morphNormals:P.morphNormals,maxMorphTargets:c.maxMorphTargets,maxMorphNormals:c.maxMorphNormals,numDirLights:ka.directional.length,numPointLights:ka.point.length,numSpotLights:ka.spot.length,numRectAreaLights:ka.rectArea.length,numHemiLights:ka.hemi.length,numDirLightShadows:ka.directionalShadowMap.length,numPointLightShadows:ka.pointShadowMap.length,numSpotLightShadows:ka.spotShadowMap.length,numClippingPlanes:l.numPlanes,numClipIntersection:l.numIntersection,dithering:P.dithering,
shadowMapEnabled:c.shadowMap.enabled&&0<ia.length,shadowMapType:c.shadowMap.type,toneMapping:P.toneMapped?c.toneMapping:0,physicallyCorrectLights:c.physicallyCorrectLights,premultipliedAlpha:P.premultipliedAlpha,alphaTest:P.alphaTest,doubleSided:2===P.side,flipSided:1===P.side,depthPacking:void 0!==P.depthPacking?P.depthPacking:!1,index0AttributeName:P.index0AttributeName,extensionDerivatives:P.extensions&&P.extensions.derivatives,extensionFragDepth:P.extensions&&P.extensions.fragDepth,extensionDrawBuffers:P.extensions&&
P.extensions.drawBuffers,extensionShaderTextureLOD:P.extensions&&P.extensions.shaderTextureLOD,rendererExtensionFragDepth:x||b.has("EXT_frag_depth"),rendererExtensionDrawBuffers:x||b.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:x||b.has("EXT_shader_texture_lod"),customProgramCacheKey:P.customProgramCacheKey()}},getProgramCacheKey:function(P){var ka=[];P.shaderID?ka.push(P.shaderID):(ka.push(P.fragmentShader),ka.push(P.vertexShader));if(void 0!==P.defines)for(var ia in P.defines)ka.push(ia),
ka.push(P.defines[ia]);if(!1===P.isRawShaderMaterial){for(ia=0;ia<S.length;ia++)ka.push(P[S[ia]]);ka.push(c.outputEncoding);ka.push(c.gammaFactor)}ka.push(P.customProgramCacheKey);return ka.join()},getUniforms:function(P){var ka=L[P.type];return ka?Dj.clone(md[ka].uniforms):P.uniforms},acquireProgram:function(P,ka){for(var ia,la=0,oa=v.length;la<oa;la++){var Ca=v[la];if(Ca.cacheKey===ka){ia=Ca;++ia.usedTimes;break}}void 0===ia&&(ia=new Wf(c,ka,P,g),v.push(ia));return ia},releaseProgram:function(P){if(0===
--P.usedTimes){var ka=v.indexOf(P);v[ka]=v[v.length-1];v.pop();P.destroy()}},programs:v}}function Pg(){var c=new WeakMap;return{get:function(f){var b=c.get(f);void 0===b&&(b={},c.set(f,b));return b},remove:function(f){c.delete(f)},update:function(f,b,d){c.get(f)[b]=d},dispose:function(){c=new WeakMap}}}function mi(c,f){return c.groupOrder!==f.groupOrder?c.groupOrder-f.groupOrder:c.renderOrder!==f.renderOrder?c.renderOrder-f.renderOrder:c.program!==f.program?c.program.id-f.program.id:c.material.id!==
f.material.id?c.material.id-f.material.id:c.z!==f.z?c.z-f.z:c.id-f.id}function Qd(c,f){return c.groupOrder!==f.groupOrder?c.groupOrder-f.groupOrder:c.renderOrder!==f.renderOrder?c.renderOrder-f.renderOrder:c.z!==f.z?f.z-c.z:c.id-f.id}function Qg(c){function f(v,x,w,A,D,J){var N=b[d],L=c.get(w);void 0===N?(N={id:v.id,object:v,geometry:x,material:w,program:L.program||r,groupOrder:A,renderOrder:v.renderOrder,z:D,group:J},b[d]=N):(N.id=v.id,N.object=v,N.geometry=x,N.material=w,N.program=L.program||r,
N.groupOrder=A,N.renderOrder=v.renderOrder,N.z=D,N.group=J);d++;return N}var b=[],d=0,g=[],l=[],r={id:-1};return{opaque:g,transparent:l,init:function(){d=0;g.length=0;l.length=0},push:function(v,x,w,A,D,J){v=f(v,x,w,A,D,J);(!0===w.transparent?l:g).push(v)},unshift:function(v,x,w,A,D,J){v=f(v,x,w,A,D,J);(!0===w.transparent?l:g).unshift(v)},finish:function(){for(var v=d,x=b.length;v<x;v++){var w=b[v];if(null===w.id)break;w.id=null;w.object=null;w.geometry=null;w.material=null;w.program=null;w.group=
null}},sort:function(v,x){1<g.length&&g.sort(v||mi);1<l.length&&l.sort(x||Qd)}}}function ni(c){var f=new WeakMap;return{get:function(b,d){var g=f.get(b);if(void 0===g){var l=new Qg(c);f.set(b,new WeakMap);f.get(b).set(d,l)}else l=g.get(d),void 0===l&&(l=new Qg(c),g.set(d,l));return l},dispose:function(){f=new WeakMap}}}function Xf(){var c={};return{get:function(f){if(void 0!==c[f.id])return c[f.id];switch(f.type){case "DirectionalLight":var b={direction:new da,color:new Cb};break;case "SpotLight":b=
{position:new da,direction:new da,color:new Cb,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case "PointLight":b={position:new da,color:new Cb,distance:0,decay:0};break;case "HemisphereLight":b={direction:new da,skyColor:new Cb,groundColor:new Cb};break;case "RectAreaLight":b={color:new Cb,position:new da,halfWidth:new da,halfHeight:new da}}return c[f.id]=b}}}function oi(){var c={};return{get:function(f){if(void 0!==c[f.id])return c[f.id];switch(f.type){case "DirectionalLight":var b={shadowBias:0,
shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ib};break;case "SpotLight":b={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ib};break;case "PointLight":b={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ib,shadowCameraNear:1,shadowCameraFar:1E3}}return c[f.id]=b}}}function oe(c,f){return(f.castShadow?1:0)-(c.castShadow?1:0)}function Rg(c,f){for(var b=new Xf,d=oi(),g={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,
numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},l=0;9>l;l++)g.probe.push(new da);var r=new da,v=new ec,x=new ec;return{setup:function(w){for(var A=0,D=0,J=0,N=0;9>N;N++)g.probe[N].set(0,0,0);var L=
N=0,S=0,P=0,ka=0,ia=0,la=0,oa=0;w.sort(oe);for(var Ca=0,Aa=w.length;Ca<Aa;Ca++){var ra=w[Ca],Ja=ra.color,Ra=ra.intensity,xa=ra.distance,Ga=ra.shadow&&ra.shadow.map?ra.shadow.map.texture:null;if(ra.isAmbientLight)A+=Ja.r*Ra,D+=Ja.g*Ra,J+=Ja.b*Ra;else if(ra.isLightProbe)for(Ga=0;9>Ga;Ga++)g.probe[Ga].addScaledVector(ra.sh.coefficients[Ga],Ra);else if(ra.isDirectionalLight){Ra=b.get(ra);Ra.color.copy(ra.color).multiplyScalar(ra.intensity);if(ra.castShadow){var Oa=ra.shadow;Ja=d.get(ra);Ja.shadowBias=
Oa.bias;Ja.shadowNormalBias=Oa.normalBias;Ja.shadowRadius=Oa.radius;Ja.shadowMapSize=Oa.mapSize;g.directionalShadow[N]=Ja;g.directionalShadowMap[N]=Ga;g.directionalShadowMatrix[N]=ra.shadow.matrix;ia++}g.directional[N]=Ra;N++}else ra.isSpotLight?(Oa=b.get(ra),Oa.position.setFromMatrixPosition(ra.matrixWorld),Oa.color.copy(Ja).multiplyScalar(Ra),Oa.distance=xa,Oa.coneCos=Math.cos(ra.angle),Oa.penumbraCos=Math.cos(ra.angle*(1-ra.penumbra)),Oa.decay=ra.decay,ra.castShadow&&(Ra=ra.shadow,Ja=d.get(ra),
Ja.shadowBias=Ra.bias,Ja.shadowNormalBias=Ra.normalBias,Ja.shadowRadius=Ra.radius,Ja.shadowMapSize=Ra.mapSize,g.spotShadow[S]=Ja,g.spotShadowMap[S]=Ga,g.spotShadowMatrix[S]=ra.shadow.matrix,oa++),g.spot[S]=Oa,S++):ra.isRectAreaLight?(Ga=b.get(ra),Ga.color.copy(Ja).multiplyScalar(Ra),Ga.halfWidth.set(.5*ra.width,0,0),Ga.halfHeight.set(0,.5*ra.height,0),g.rectArea[P]=Ga,P++):ra.isPointLight?(Ra=b.get(ra),Ra.color.copy(ra.color).multiplyScalar(ra.intensity),Ra.distance=ra.distance,Ra.decay=ra.decay,
ra.castShadow&&(Oa=ra.shadow,Ja=d.get(ra),Ja.shadowBias=Oa.bias,Ja.shadowNormalBias=Oa.normalBias,Ja.shadowRadius=Oa.radius,Ja.shadowMapSize=Oa.mapSize,Ja.shadowCameraNear=Oa.camera.near,Ja.shadowCameraFar=Oa.camera.far,g.pointShadow[L]=Ja,g.pointShadowMap[L]=Ga,g.pointShadowMatrix[L]=ra.shadow.matrix,la++),g.point[L]=Ra,L++):ra.isHemisphereLight&&(Ga=b.get(ra),Ga.skyColor.copy(ra.color).multiplyScalar(Ra),Ga.groundColor.copy(ra.groundColor).multiplyScalar(Ra),g.hemi[ka]=Ga,ka++)}0<P&&(f.isWebGL2?
(g.rectAreaLTC1=zb.LTC_FLOAT_1,g.rectAreaLTC2=zb.LTC_FLOAT_2):!0===c.has("OES_texture_float_linear")?(g.rectAreaLTC1=zb.LTC_FLOAT_1,g.rectAreaLTC2=zb.LTC_FLOAT_2):!0===c.has("OES_texture_half_float_linear")?(g.rectAreaLTC1=zb.LTC_HALF_1,g.rectAreaLTC2=zb.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions."));g.ambient[0]=A;g.ambient[1]=D;g.ambient[2]=J;w=g.hash;if(w.directionalLength!==N||w.pointLength!==L||w.spotLength!==S||w.rectAreaLength!==P||
w.hemiLength!==ka||w.numDirectionalShadows!==ia||w.numPointShadows!==la||w.numSpotShadows!==oa)g.directional.length=N,g.spot.length=S,g.rectArea.length=P,g.point.length=L,g.hemi.length=ka,g.directionalShadow.length=ia,g.directionalShadowMap.length=ia,g.pointShadow.length=la,g.pointShadowMap.length=la,g.spotShadow.length=oa,g.spotShadowMap.length=oa,g.directionalShadowMatrix.length=ia,g.pointShadowMatrix.length=la,g.spotShadowMatrix.length=oa,w.directionalLength=N,w.pointLength=L,w.spotLength=S,w.rectAreaLength=
P,w.hemiLength=ka,w.numDirectionalShadows=ia,w.numPointShadows=la,w.numSpotShadows=oa,g.version=ml++},setupView:function(w,A){var D=0,J=0,N=0,L=0,S=0;A=A.matrixWorldInverse;for(var P=0,ka=w.length;P<ka;P++){var ia=w[P];if(ia.isDirectionalLight){var la=g.directional[D];la.direction.setFromMatrixPosition(ia.matrixWorld);r.setFromMatrixPosition(ia.target.matrixWorld);la.direction.sub(r);la.direction.transformDirection(A);D++}else ia.isSpotLight?(la=g.spot[N],la.position.setFromMatrixPosition(ia.matrixWorld),
la.position.applyMatrix4(A),la.direction.setFromMatrixPosition(ia.matrixWorld),r.setFromMatrixPosition(ia.target.matrixWorld),la.direction.sub(r),la.direction.transformDirection(A),N++):ia.isRectAreaLight?(la=g.rectArea[L],la.position.setFromMatrixPosition(ia.matrixWorld),la.position.applyMatrix4(A),x.identity(),v.copy(ia.matrixWorld),v.premultiply(A),x.extractRotation(v),la.halfWidth.set(.5*ia.width,0,0),la.halfHeight.set(0,.5*ia.height,0),la.halfWidth.applyMatrix4(x),la.halfHeight.applyMatrix4(x),
L++):ia.isPointLight?(la=g.point[J],la.position.setFromMatrixPosition(ia.matrixWorld),la.position.applyMatrix4(A),J++):ia.isHemisphereLight&&(la=g.hemi[S],la.direction.setFromMatrixPosition(ia.matrixWorld),la.direction.transformDirection(A),la.direction.normalize(),S++)}},state:g}}function qf(c,f){var b=new Rg(c,f),d=[],g=[];return{init:function(){d.length=0;g.length=0},state:{lightsArray:d,shadowsArray:g,lights:b},setupLights:function(){b.setup(d)},setupLightsView:function(l){b.setupView(d,l)},pushLight:function(l){d.push(l)},
pushShadow:function(l){g.push(l)}}}function Sg(c,f){var b=new WeakMap;return{get:function(d,g){void 0===g&&(g=0);!1===b.has(d)?(g=new qf(c,f),b.set(d,[]),b.get(d).push(g)):g>=b.get(d).length?(g=new qf(c,f),b.get(d).push(g)):g=b.get(d)[g];return g},dispose:function(){b=new WeakMap}}}function Bd(c){U.call(this);this.type="MeshDepthMaterial";this.depthPacking=3200;this.morphTargets=this.skinning=!1;this.displacementMap=this.alphaMap=this.map=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=
!1;this.wireframeLinewidth=1;this.fog=!1;this.setValues(c)}function Cd(c){U.call(this);this.type="MeshDistanceMaterial";this.referencePosition=new da;this.nearDistance=1;this.farDistance=1E3;this.morphTargets=this.skinning=!1;this.displacementMap=this.alphaMap=this.map=null;this.displacementScale=1;this.displacementBias=0;this.fog=!1;this.setValues(c)}function Ne(c,f,b){function d(oa,Ca,Aa){Aa=oa<<0|Ca<<1|Aa<<2;var ra=D[Aa];void 0===ra&&(ra=new Bd({depthPacking:3201,morphTargets:oa,skinning:Ca}),
D[Aa]=ra);return ra}function g(oa,Ca,Aa){Aa=oa<<0|Ca<<1|Aa<<2;var ra=J[Aa];void 0===ra&&(ra=new Cd({morphTargets:oa,skinning:Ca}),J[Aa]=ra);return ra}function l(oa,Ca,Aa,ra,Ja,Ra,xa){var Ga=d,Oa=oa.customDepthMaterial;!0===ra.isPointLight&&(Ga=g,Oa=oa.customDistanceMaterial);void 0===Oa?(Oa=!1,!0===Aa.morphTargets&&(Oa=Ca.morphAttributes&&Ca.morphAttributes.position&&0<Ca.morphAttributes.position.length),Ca=!1,!0===oa.isSkinnedMesh&&(!0===Aa.skinning?Ca=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",
oa)),oa=Ga(Oa,Ca,!0===oa.isInstancedMesh)):oa=Oa;c.localClippingEnabled&&!0===Aa.clipShadows&&0!==Aa.clippingPlanes.length&&(Oa=oa.uuid,Ga=Aa.uuid,Ca=N[Oa],void 0===Ca&&(Ca={},N[Oa]=Ca),Oa=Ca[Ga],void 0===Oa&&(Oa=oa.clone(),Ca[Ga]=Oa),oa=Oa);oa.visible=Aa.visible;oa.wireframe=Aa.wireframe;oa.side=3===xa?null!==Aa.shadowSide?Aa.shadowSide:Aa.side:null!==Aa.shadowSide?Aa.shadowSide:L[Aa.side];oa.clipShadows=Aa.clipShadows;oa.clippingPlanes=Aa.clippingPlanes;oa.clipIntersection=Aa.clipIntersection;oa.wireframeLinewidth=
Aa.wireframeLinewidth;oa.linewidth=Aa.linewidth;!0===ra.isPointLight&&!0===oa.isMeshDistanceMaterial&&(oa.referencePosition.setFromMatrixPosition(ra.matrixWorld),oa.nearDistance=Ja,oa.farDistance=Ra);return oa}function r(oa,Ca,Aa,ra,Ja){if(!1!==oa.visible){if(oa.layers.test(Ca.layers)&&(oa.isMesh||oa.isLine||oa.isPoints)&&(oa.castShadow||oa.receiveShadow&&3===Ja)&&(!oa.frustumCulled||v.intersectsObject(oa))){oa.modelViewMatrix.multiplyMatrices(Aa.matrixWorldInverse,oa.matrixWorld);var Ra=f.update(oa),
xa=oa.material;if(Array.isArray(xa))for(var Ga=Ra.groups,Oa=0,nb=Ga.length;Oa<nb;Oa++){var Ba=Ga[Oa],Ea=xa[Ba.materialIndex];Ea&&Ea.visible&&(Ea=l(oa,Ra,Ea,ra,Aa.near,Aa.far,Ja),c.renderBufferDirect(Aa,null,Ra,Ea,oa,Ba))}else xa.visible&&(xa=l(oa,Ra,xa,ra,Aa.near,Aa.far,Ja),c.renderBufferDirect(Aa,null,Ra,xa,oa,null))}oa=oa.children;Ra=0;for(xa=oa.length;Ra<xa;Ra++)r(oa[Ra],Ca,Aa,ra,Ja)}}var v=new Yf,x=new ib,w=new ib,A=new qc,D=[],J=[],N={},L={0:1,1:0,2:2},S=new yb({defines:{SAMPLE_RATE:.25,HALF_SAMPLE_RATE:.125},
uniforms:{shadow_pass:{value:null},resolution:{value:new ib},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),
P=S.clone();P.defines.HORIZONTAL_PASS=1;var ka=new Na;ka.setAttribute("position",new M(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var ia=new $a(ka,S),la=this;this.enabled=!1;this.autoUpdate=!0;this.needsUpdate=!1;this.type=1;this.render=function(oa,Ca,Aa){if(!1!==la.enabled&&(!1!==la.autoUpdate||!1!==la.needsUpdate)&&0!==oa.length){var ra=c.getRenderTarget(),Ja=c.getActiveCubeFace(),Ra=c.getActiveMipmapLevel(),xa=c.state;xa.setBlending(0);xa.buffers.color.setClear(1,1,1,1);xa.buffers.depth.setTest(!0);
xa.setScissorTest(!1);for(var Ga=0,Oa=oa.length;Ga<Oa;Ga++){var nb=oa[Ga],Ba=nb.shadow;if(void 0===Ba)console.warn("THREE.WebGLShadowMap:",nb,"has no shadow.");else if(!1!==Ba.autoUpdate||!1!==Ba.needsUpdate){x.copy(Ba.mapSize);var Ea=Ba.getFrameExtents();x.multiply(Ea);w.copy(Ba.mapSize);if(x.x>b||x.y>b)x.x>b&&(w.x=Math.floor(b/Ea.x),x.x=w.x*Ea.x,Ba.mapSize.x=w.x),x.y>b&&(w.y=Math.floor(b/Ea.y),x.y=w.y*Ea.y,Ba.mapSize.y=w.y);null!==Ba.map||Ba.isPointLightShadow||3!==this.type||(Ea={minFilter:1006,
magFilter:1006,format:1023},Ba.map=new pe(x.x,x.y,Ea),Ba.map.texture.name=nb.name+".shadowMap",Ba.mapPass=new pe(x.x,x.y,Ea),Ba.camera.updateProjectionMatrix());null===Ba.map&&(Ba.map=new pe(x.x,x.y,{minFilter:1003,magFilter:1003,format:1023}),Ba.map.texture.name=nb.name+".shadowMap",Ba.camera.updateProjectionMatrix());c.setRenderTarget(Ba.map);c.clear();Ea=Ba.getViewportCount();for(var Pa=0;Pa<Ea;Pa++){var qb=Ba.getViewport(Pa);A.set(w.x*qb.x,w.y*qb.y,w.x*qb.z,w.y*qb.w);xa.viewport(A);Ba.updateMatrices(nb,
Pa);v=Ba.getFrustum();r(Ca,Aa,Ba.camera,nb,this.type)}Ba.isPointLightShadow||3!==this.type||(nb=Ba,Ea=Aa,Pa=f.update(ia),S.uniforms.shadow_pass.value=nb.map.texture,S.uniforms.resolution.value=nb.mapSize,S.uniforms.radius.value=nb.radius,c.setRenderTarget(nb.mapPass),c.clear(),c.renderBufferDirect(Ea,null,Pa,S,ia,null),P.uniforms.shadow_pass.value=nb.mapPass.texture,P.uniforms.resolution.value=nb.mapSize,P.uniforms.radius.value=nb.radius,c.setRenderTarget(nb.map),c.clear(),c.renderBufferDirect(Ea,
null,Pa,P,ia,null));Ba.needsUpdate=!1}}la.needsUpdate=!1;c.setRenderTarget(ra,Ja,Ra)}}}function pi(c,f,b){function d(ua,fb,kb){var Ib=new Uint8Array(4),vb=c.createTexture();c.bindTexture(ua,vb);c.texParameteri(ua,10241,9728);c.texParameteri(ua,10240,9728);for(ua=0;ua<kb;ua++)c.texImage2D(fb+ua,0,6408,1,1,0,6408,5121,Ib);return vb}function g(ua){!0!==P[ua]&&(c.enable(ua),P[ua]=!0)}function l(ua){!1!==P[ua]&&(c.disable(ua),P[ua]=!1)}function r(ua,fb,kb,Ib,vb,Vb,Rb,Yb){if(0===ua)ia&&(l(3042),ia=!1);
else if(ia||(g(3042),ia=!0),5!==ua){if(ua!==la||Yb!==xa){if(100!==oa||100!==ra)c.blendEquation(32774),ra=oa=100;if(Yb)switch(ua){case 1:c.blendFuncSeparate(1,771,1,771);break;case 2:c.blendFunc(1,1);break;case 3:c.blendFuncSeparate(0,0,769,771);break;case 4:c.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",ua)}else switch(ua){case 1:c.blendFuncSeparate(770,771,1,771);break;case 2:c.blendFunc(770,1);break;case 3:c.blendFunc(0,769);break;case 4:c.blendFunc(0,
768);break;default:console.error("THREE.WebGLState: Invalid blending: ",ua)}Ra=Ja=Aa=Ca=null;la=ua;xa=Yb}}else{vb=vb||fb;Vb=Vb||kb;Rb=Rb||Ib;if(fb!==oa||vb!==ra)c.blendEquationSeparate(pa[fb],pa[vb]),oa=fb,ra=vb;if(kb!==Ca||Ib!==Aa||Vb!==Ja||Rb!==Ra)c.blendFuncSeparate(ab[kb],ab[Ib],ab[Vb],ab[Rb]),Ca=kb,Aa=Ib,Ja=Vb,Ra=Rb;la=ua;xa=null}}function v(ua){Ga!==ua&&(ua?c.frontFace(2304):c.frontFace(2305),Ga=ua)}function x(ua){0!==ua?(g(2884),ua!==Oa&&(1===ua?c.cullFace(1029):2===ua?c.cullFace(1028):c.cullFace(1032))):
l(2884);Oa=ua}function w(ua,fb,kb){if(ua){if(g(32823),Ba!==fb||Ea!==kb)c.polygonOffset(fb,kb),Ba=fb,Ea=kb}else l(32823)}function A(ua){void 0===ua&&(ua=33984+Pa-1);Db!==ua&&(c.activeTexture(ua),Db=ua)}var D,J;b=b.isWebGL2;var N=new function(){var ua=!1,fb=new qc,kb=null,Ib=new qc(0,0,0,0);return{setMask:function(vb){kb===vb||ua||(c.colorMask(vb,vb,vb,vb),kb=vb)},setLocked:function(vb){ua=vb},setClear:function(vb,Vb,Rb,Yb,Xb){!0===Xb&&(vb*=Yb,Vb*=Yb,Rb*=Yb);fb.set(vb,Vb,Rb,Yb);!1===Ib.equals(fb)&&
(c.clearColor(vb,Vb,Rb,Yb),Ib.copy(fb))},reset:function(){ua=!1;kb=null;Ib.set(-1,0,0,0)}}},L=new function(){var ua=!1,fb=null,kb=null,Ib=null;return{setTest:function(vb){vb?g(2929):l(2929)},setMask:function(vb){fb===vb||ua||(c.depthMask(vb),fb=vb)},setFunc:function(vb){if(kb!==vb){if(vb)switch(vb){case 0:c.depthFunc(512);break;case 1:c.depthFunc(519);break;case 2:c.depthFunc(513);break;case 3:c.depthFunc(515);break;case 4:c.depthFunc(514);break;case 5:c.depthFunc(518);break;case 6:c.depthFunc(516);
break;case 7:c.depthFunc(517);break;default:c.depthFunc(515)}else c.depthFunc(515);kb=vb}},setLocked:function(vb){ua=vb},setClear:function(vb){Ib!==vb&&(c.clearDepth(vb),Ib=vb)},reset:function(){ua=!1;Ib=kb=fb=null}}},S=new function(){var ua=!1,fb=null,kb=null,Ib=null,vb=null,Vb=null,Rb=null,Yb=null,Xb=null;return{setTest:function(nc){ua||(nc?g(2960):l(2960))},setMask:function(nc){fb===nc||ua||(c.stencilMask(nc),fb=nc)},setFunc:function(nc,Za,Fb){if(kb!==nc||Ib!==Za||vb!==Fb)c.stencilFunc(nc,Za,Fb),
kb=nc,Ib=Za,vb=Fb},setOp:function(nc,Za,Fb){if(Vb!==nc||Rb!==Za||Yb!==Fb)c.stencilOp(nc,Za,Fb),Vb=nc,Rb=Za,Yb=Fb},setLocked:function(nc){ua=nc},setClear:function(nc){Xb!==nc&&(c.clearStencil(nc),Xb=nc)},reset:function(){ua=!1;Xb=Yb=Rb=Vb=vb=Ib=kb=fb=null}}},P={},ka=null,ia=null,la=null,oa=null,Ca=null,Aa=null,ra=null,Ja=null,Ra=null,xa=!1,Ga=null,Oa=null,nb=null,Ba=null,Ea=null,Pa=c.getParameter(35661),qb=!1,Va=0;Va=c.getParameter(7938);-1!==Va.indexOf("WebGL")?(Va=parseFloat(/^WebGL (\d)/.exec(Va)[1]),
qb=1<=Va):-1!==Va.indexOf("OpenGL ES")&&(Va=parseFloat(/^OpenGL ES (\d)/.exec(Va)[1]),qb=2<=Va);var Db=null,Sb={},$b=new qc,lc=new qc,ha={};ha[3553]=d(3553,3553,1);ha[34067]=d(34067,34069,6);N.setClear(0,0,0,1);L.setClear(1);S.setClear(0);g(2929);L.setFunc(3);v(!1);x(1);g(2884);r(0);var pa=(D={},D[100]=32774,D[101]=32778,D[102]=32779,D);b?(pa[103]=32775,pa[104]=32776):(f=f.get("EXT_blend_minmax"),null!==f&&(pa[103]=f.MIN_EXT,pa[104]=f.MAX_EXT));var ab=(J={},J[200]=0,J[201]=1,J[202]=768,J[204]=770,
J[210]=776,J[208]=774,J[206]=772,J[203]=769,J[205]=771,J[209]=775,J[207]=773,J);return{buffers:{color:N,depth:L,stencil:S},enable:g,disable:l,useProgram:function(ua){return ka!==ua?(c.useProgram(ua),ka=ua,!0):!1},setBlending:r,setMaterial:function(ua,fb){2===ua.side?l(2884):g(2884);var kb=1===ua.side;fb&&(kb=!kb);v(kb);1===ua.blending&&!1===ua.transparent?r(0):r(ua.blending,ua.blendEquation,ua.blendSrc,ua.blendDst,ua.blendEquationAlpha,ua.blendSrcAlpha,ua.blendDstAlpha,ua.premultipliedAlpha);L.setFunc(ua.depthFunc);
L.setTest(ua.depthTest);L.setMask(ua.depthWrite);N.setMask(ua.colorWrite);fb=ua.stencilWrite;S.setTest(fb);fb&&(S.setMask(ua.stencilWriteMask),S.setFunc(ua.stencilFunc,ua.stencilRef,ua.stencilFuncMask),S.setOp(ua.stencilFail,ua.stencilZFail,ua.stencilZPass));w(ua.polygonOffset,ua.polygonOffsetFactor,ua.polygonOffsetUnits)},setFlipSided:v,setCullFace:x,setLineWidth:function(ua){ua!==nb&&(qb&&c.lineWidth(ua),nb=ua)},setPolygonOffset:w,setScissorTest:function(ua){ua?g(3089):l(3089)},activeTexture:A,
bindTexture:function(ua,fb){null===Db&&A();var kb=Sb[Db];void 0===kb&&(kb={type:void 0,texture:void 0},Sb[Db]=kb);if(kb.type!==ua||kb.texture!==fb)c.bindTexture(ua,fb||ha[ua]),kb.type=ua,kb.texture=fb},unbindTexture:function(){var ua=Sb[Db];void 0!==ua&&void 0!==ua.type&&(c.bindTexture(ua.type,null),ua.type=void 0,ua.texture=void 0)},compressedTexImage2D:function(){try{c.compressedTexImage2D.apply(c,arguments)}catch(ua){console.error("THREE.WebGLState:",ua)}},texImage2D:function(){try{c.texImage2D.apply(c,
arguments)}catch(ua){console.error("THREE.WebGLState:",ua)}},texImage3D:function(){try{c.texImage3D.apply(c,arguments)}catch(ua){console.error("THREE.WebGLState:",ua)}},scissor:function(ua){!1===$b.equals(ua)&&(c.scissor(ua.x,ua.y,ua.z,ua.w),$b.copy(ua))},viewport:function(ua){!1===lc.equals(ua)&&(c.viewport(ua.x,ua.y,ua.z,ua.w),lc.copy(ua))},reset:function(){P={};Db=null;Sb={};Ra=Ja=ra=Aa=Ca=oa=la=ia=ka=null;xa=!1;Ea=Ba=nb=Oa=Ga=null;N.reset();L.reset();S.reset()}}}function qi(c,f,b,d,g,l,r){function v(ha,
pa){return qb?new OffscreenCanvas(ha,pa):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function x(ha,pa,ab,ua){var fb=1;if(ha.width>ua||ha.height>ua)fb=ua/Math.max(ha.width,ha.height);if(1>fb||!0===pa){if("undefined"!==typeof HTMLImageElement&&ha instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&ha instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&ha instanceof ImageBitmap)return ua=pa?Qb.floorPowerOfTwo:Math.floor,pa=ua(fb*ha.width),fb=ua(fb*ha.height),
void 0===Pa&&(Pa=v(pa,fb)),ab=ab?v(pa,fb):Pa,ab.width=pa,ab.height=fb,ab.getContext("2d").drawImage(ha,0,0,pa,fb),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+ha.width+"x"+ha.height+") to ("+pa+"x"+fb+")."),ab;"data"in ha&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+ha.width+"x"+ha.height+").")}return ha}function w(ha){return Qb.isPowerOfTwo(ha.width)&&Qb.isPowerOfTwo(ha.height)}function A(ha,pa){return ha.generateMipmaps&&pa&&1003!==ha.minFilter&&
1006!==ha.minFilter}function D(ha,pa,ab,ua){c.generateMipmap(ha);d.get(pa).__maxMipLevel=Math.log(Math.max(ab,ua))*Math.LOG2E}function J(ha,pa,ab){if(!1===xa)return pa;if(null!==ha){if(void 0!==c[ha])return c[ha];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+ha+"'")}ha=pa;6403===pa&&(5126===ab&&(ha=33326),5131===ab&&(ha=33325),5121===ab&&(ha=33321));6407===pa&&(5126===ab&&(ha=34837),5131===ab&&(ha=34843),5121===ab&&(ha=32849));6408===pa&&(5126===ab&&(ha=34836),
5131===ab&&(ha=34842),5121===ab&&(ha=32856));33325!==ha&&33326!==ha&&34842!==ha&&34836!==ha||f.get("EXT_color_buffer_float");return ha}function N(ha){return 1003===ha||1004===ha||1005===ha?9728:9729}function L(ha){ha=ha.target;ha.removeEventListener("dispose",L);var pa=d.get(ha);void 0!==pa.__webglInit&&(c.deleteTexture(pa.__webglTexture),d.remove(ha));ha.isVideoTexture&&Ea.delete(ha);r.memory.textures--}function S(ha){ha=ha.target;ha.removeEventListener("dispose",S);var pa=d.get(ha),ab=d.get(ha.texture);
if(ha){void 0!==ab.__webglTexture&&c.deleteTexture(ab.__webglTexture);ha.depthTexture&&ha.depthTexture.dispose();if(ha.isWebGLCubeRenderTarget)for(ab=0;6>ab;ab++)c.deleteFramebuffer(pa.__webglFramebuffer[ab]),pa.__webglDepthbuffer&&c.deleteRenderbuffer(pa.__webglDepthbuffer[ab]);else c.deleteFramebuffer(pa.__webglFramebuffer),pa.__webglDepthbuffer&&c.deleteRenderbuffer(pa.__webglDepthbuffer),pa.__webglMultisampledFramebuffer&&c.deleteFramebuffer(pa.__webglMultisampledFramebuffer),pa.__webglColorRenderbuffer&&
c.deleteRenderbuffer(pa.__webglColorRenderbuffer),pa.__webglDepthRenderbuffer&&c.deleteRenderbuffer(pa.__webglDepthRenderbuffer);d.remove(ha.texture);d.remove(ha)}r.memory.textures--}function P(ha,pa){var ab=d.get(ha);if(ha.isVideoTexture){var ua=r.render.frame;Ea.get(ha)!==ua&&(Ea.set(ha,ua),ha.update())}if(0<ha.version&&ab.__version!==ha.version)if(ua=ha.image,void 0===ua)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if(!1===ua.complete)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");
else{oa(ab,ha,pa);return}b.activeTexture(33984+pa);b.bindTexture(3553,ab.__webglTexture)}function ka(ha,pa){var ab=d.get(ha);if(0<ha.version&&ab.__version!==ha.version){if(6===ha.image.length){la(ab,ha);b.activeTexture(33984+pa);b.bindTexture(34067,ab.__webglTexture);c.pixelStorei(37440,ha.flipY);c.pixelStorei(37441,ha.premultiplyAlpha);c.pixelStorei(3317,ha.unpackAlignment);var ua=ha&&(ha.isCompressedTexture||ha.image[0].isCompressedTexture),fb=ha.image[0]&&ha.image[0].isDataTexture;pa=[];for(var kb=
0;6>kb;kb++)pa[kb]=ua||fb?fb?ha.image[kb].image:ha.image[kb]:x(ha.image[kb],!1,!0,Oa);kb=pa[0];var Ib=w(kb)||xa,vb=l.convert(ha.format),Vb=l.convert(ha.type),Rb=J(ha.internalFormat,vb,Vb);ia(34067,ha,Ib);if(ua){for(fb=0;6>fb;fb++){var Yb=pa[fb].mipmaps;for(ua=0;ua<Yb.length;ua++){var Xb=Yb[ua];1023!==ha.format&&1022!==ha.format?null!==vb?b.compressedTexImage2D(34069+fb,ua,Rb,Xb.width,Xb.height,0,Xb.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):
b.texImage2D(34069+fb,ua,Rb,Xb.width,Xb.height,0,vb,Vb,Xb.data)}}ab.__maxMipLevel=Yb.length-1}else{Yb=ha.mipmaps;for(ua=0;6>ua;ua++)if(fb)for(b.texImage2D(34069+ua,0,Rb,pa[ua].width,pa[ua].height,0,vb,Vb,pa[ua].data),Xb=0;Xb<Yb.length;Xb++){var nc=Yb[Xb].image[ua].image;b.texImage2D(34069+ua,Xb+1,Rb,nc.width,nc.height,0,vb,Vb,nc.data)}else for(b.texImage2D(34069+ua,0,Rb,vb,Vb,pa[ua]),Xb=0;Xb<Yb.length;Xb++)b.texImage2D(34069+ua,Xb+1,Rb,vb,Vb,Yb[Xb].image[ua]);ab.__maxMipLevel=Yb.length}A(ha,Ib)&&
D(34067,ha,kb.width,kb.height);ab.__version=ha.version;if(ha.onUpdate)ha.onUpdate(ha)}}else b.activeTexture(33984+pa),b.bindTexture(34067,ab.__webglTexture)}function ia(ha,pa,ab){ab?(c.texParameteri(ha,10242,Db[pa.wrapS]),c.texParameteri(ha,10243,Db[pa.wrapT]),32879!==ha&&35866!==ha||c.texParameteri(ha,32882,Db[pa.wrapR]),c.texParameteri(ha,10240,Sb[pa.magFilter]),c.texParameteri(ha,10241,Sb[pa.minFilter])):(c.texParameteri(ha,10242,33071),c.texParameteri(ha,10243,33071),32879!==ha&&35866!==ha||c.texParameteri(ha,
32882,33071),1001===pa.wrapS&&1001===pa.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),c.texParameteri(ha,10240,N(pa.magFilter)),c.texParameteri(ha,10241,N(pa.minFilter)),1003!==pa.minFilter&&1006!==pa.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));!(ab=f.get("EXT_texture_filter_anisotropic"))||
1015===pa.type&&null===f.get("OES_texture_float_linear")||1016===pa.type&&null===(xa||f.get("OES_texture_half_float_linear"))||!(1<pa.anisotropy||d.get(pa).__currentAnisotropy)||(c.texParameterf(ha,ab.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(pa.anisotropy,g.getMaxAnisotropy())),d.get(pa).__currentAnisotropy=pa.anisotropy)}function la(ha,pa){void 0===ha.__webglInit&&(ha.__webglInit=!0,pa.addEventListener("dispose",L),ha.__webglTexture=c.createTexture(),r.memory.textures++)}function oa(ha,pa,ab){var ua=
3553;pa.isDataTexture2DArray&&(ua=35866);pa.isDataTexture3D&&(ua=32879);la(ha,pa);b.activeTexture(33984+ab);b.bindTexture(ua,ha.__webglTexture);c.pixelStorei(37440,pa.flipY);c.pixelStorei(37441,pa.premultiplyAlpha);c.pixelStorei(3317,pa.unpackAlignment);ab=xa?!1:1001!==pa.wrapS||1001!==pa.wrapT||1003!==pa.minFilter&&1006!==pa.minFilter;ab=ab&&!1===w(pa.image);ab=x(pa.image,ab,!1,nb);var fb=w(ab)||xa,kb=l.convert(pa.format),Ib=l.convert(pa.type),vb=J(pa.internalFormat,kb,Ib);ia(ua,pa,fb);var Vb=pa.mipmaps;
if(pa.isDepthTexture)vb=6402,xa?vb=1015===pa.type?36012:1014===pa.type?33190:1020===pa.type?35056:33189:1015===pa.type&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),1026===pa.format&&6402===vb&&1012!==pa.type&&1014!==pa.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),pa.type=1012,Ib=l.convert(pa.type)),1027===pa.format&&6402===vb&&(vb=34041,1020!==pa.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),
pa.type=1020,Ib=l.convert(pa.type))),b.texImage2D(3553,0,vb,ab.width,ab.height,0,kb,Ib,null);else if(pa.isDataTexture)if(0<Vb.length&&fb){for(var Rb=0,Yb=Vb.length;Rb<Yb;Rb++){var Xb=Vb[Rb];b.texImage2D(3553,Rb,vb,Xb.width,Xb.height,0,kb,Ib,Xb.data)}pa.generateMipmaps=!1;ha.__maxMipLevel=Vb.length-1}else b.texImage2D(3553,0,vb,ab.width,ab.height,0,kb,Ib,ab.data),ha.__maxMipLevel=0;else if(pa.isCompressedTexture){Rb=0;for(Yb=Vb.length;Rb<Yb;Rb++)Xb=Vb[Rb],1023!==pa.format&&1022!==pa.format?null!==
kb?b.compressedTexImage2D(3553,Rb,vb,Xb.width,Xb.height,0,Xb.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):b.texImage2D(3553,Rb,vb,Xb.width,Xb.height,0,kb,Ib,Xb.data);ha.__maxMipLevel=Vb.length-1}else if(pa.isDataTexture2DArray)b.texImage3D(35866,0,vb,ab.width,ab.height,ab.depth,0,kb,Ib,ab.data),ha.__maxMipLevel=0;else if(pa.isDataTexture3D)b.texImage3D(32879,0,vb,ab.width,ab.height,ab.depth,0,kb,Ib,ab.data),ha.__maxMipLevel=0;
else if(0<Vb.length&&fb){Rb=0;for(Yb=Vb.length;Rb<Yb;Rb++)Xb=Vb[Rb],b.texImage2D(3553,Rb,vb,kb,Ib,Xb);pa.generateMipmaps=!1;ha.__maxMipLevel=Vb.length-1}else b.texImage2D(3553,0,vb,kb,Ib,ab),ha.__maxMipLevel=0;A(pa,fb)&&D(ua,pa,ab.width,ab.height);ha.__version=pa.version;if(pa.onUpdate)pa.onUpdate(pa)}function Ca(ha,pa,ab,ua){var fb=l.convert(pa.texture.format),kb=l.convert(pa.texture.type),Ib=J(pa.texture.internalFormat,fb,kb);b.texImage2D(ua,0,Ib,pa.width,pa.height,0,fb,kb,null);c.bindFramebuffer(36160,
ha);c.framebufferTexture2D(36160,ab,ua,d.get(pa.texture).__webglTexture,0);c.bindFramebuffer(36160,null)}function Aa(ha,pa,ab){c.bindRenderbuffer(36161,ha);if(pa.depthBuffer&&!pa.stencilBuffer){var ua=33189;ab?((ab=pa.depthTexture)&&ab.isDepthTexture&&(1015===ab.type?ua=36012:1014===ab.type&&(ua=33190)),ab=ra(pa),c.renderbufferStorageMultisample(36161,ab,ua,pa.width,pa.height)):c.renderbufferStorage(36161,ua,pa.width,pa.height);c.framebufferRenderbuffer(36160,36096,36161,ha)}else pa.depthBuffer&&
pa.stencilBuffer?(ab?(ab=ra(pa),c.renderbufferStorageMultisample(36161,ab,35056,pa.width,pa.height)):c.renderbufferStorage(36161,34041,pa.width,pa.height),c.framebufferRenderbuffer(36160,33306,36161,ha)):(ha=l.convert(pa.texture.format),ua=l.convert(pa.texture.type),ha=J(pa.texture.internalFormat,ha,ua),ab?(ab=ra(pa),c.renderbufferStorageMultisample(36161,ab,ha,pa.width,pa.height)):c.renderbufferStorage(36161,ha,pa.width,pa.height));c.bindRenderbuffer(36161,null)}function ra(ha){return xa&&ha.isWebGLMultisampleRenderTarget?
Math.min(Ba,ha.samples):0}var Ja,Ra,xa=g.isWebGL2,Ga=g.maxTextures,Oa=g.maxCubemapSize,nb=g.maxTextureSize,Ba=g.maxSamples,Ea=new WeakMap,Pa,qb=!1;try{qb="undefined"!==typeof OffscreenCanvas&&null!==(new OffscreenCanvas(1,1)).getContext("2d")}catch(ha){}var Va=0,Db=(Ja={},Ja[1E3]=10497,Ja[1001]=33071,Ja[1002]=33648,Ja),Sb=(Ra={},Ra[1003]=9728,Ra[1004]=9984,Ra[1005]=9986,Ra[1006]=9729,Ra[1007]=9985,Ra[1008]=9987,Ra),$b=!1,lc=!1;this.allocateTextureUnit=function(){var ha=Va;ha>=Ga&&console.warn("THREE.WebGLTextures: Trying to use "+
ha+" texture units while this GPU supports only "+Ga);Va+=1;return ha};this.resetTextureUnits=function(){Va=0};this.setTexture2D=P;this.setTexture2DArray=function(ha,pa){var ab=d.get(ha);0<ha.version&&ab.__version!==ha.version?oa(ab,ha,pa):(b.activeTexture(33984+pa),b.bindTexture(35866,ab.__webglTexture))};this.setTexture3D=function(ha,pa){var ab=d.get(ha);0<ha.version&&ab.__version!==ha.version?oa(ab,ha,pa):(b.activeTexture(33984+pa),b.bindTexture(32879,ab.__webglTexture))};this.setTextureCube=ka;
this.setupRenderTarget=function(ha){var pa=d.get(ha),ab=d.get(ha.texture);ha.addEventListener("dispose",S);ab.__webglTexture=c.createTexture();r.memory.textures++;var ua=!0===ha.isWebGLCubeRenderTarget,fb=!0===ha.isWebGLMultisampleRenderTarget,kb=w(ha)||xa;!xa||1022!==ha.texture.format||1015!==ha.texture.type&&1016!==ha.texture.type||(ha.texture.format=1023,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead."));if(ua)for(pa.__webglFramebuffer=
[],fb=0;6>fb;fb++)pa.__webglFramebuffer[fb]=c.createFramebuffer();else if(pa.__webglFramebuffer=c.createFramebuffer(),fb)if(xa){pa.__webglMultisampledFramebuffer=c.createFramebuffer();pa.__webglColorRenderbuffer=c.createRenderbuffer();c.bindRenderbuffer(36161,pa.__webglColorRenderbuffer);fb=l.convert(ha.texture.format);var Ib=l.convert(ha.texture.type);fb=J(ha.texture.internalFormat,fb,Ib);Ib=ra(ha);c.renderbufferStorageMultisample(36161,Ib,fb,ha.width,ha.height);c.bindFramebuffer(36160,pa.__webglMultisampledFramebuffer);
c.framebufferRenderbuffer(36160,36064,36161,pa.__webglColorRenderbuffer);c.bindRenderbuffer(36161,null);ha.depthBuffer&&(pa.__webglDepthRenderbuffer=c.createRenderbuffer(),Aa(pa.__webglDepthRenderbuffer,ha,!0));c.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(ua){b.bindTexture(34067,ab.__webglTexture);ia(34067,ha.texture,kb);for(ab=0;6>ab;ab++)Ca(pa.__webglFramebuffer[ab],ha,36064,34069+ab);A(ha.texture,kb)&&D(34067,
ha.texture,ha.width,ha.height);b.bindTexture(34067,null)}else b.bindTexture(3553,ab.__webglTexture),ia(3553,ha.texture,kb),Ca(pa.__webglFramebuffer,ha,36064,3553),A(ha.texture,kb)&&D(3553,ha.texture,ha.width,ha.height),b.bindTexture(3553,null);if(ha.depthBuffer){pa=d.get(ha);kb=!0===ha.isWebGLCubeRenderTarget;if(ha.depthTexture){if(kb)throw Error("target.depthTexture not supported in Cube render targets");if(ha&&ha.isWebGLCubeRenderTarget)throw Error("Depth Texture with cube render targets is not supported");
c.bindFramebuffer(36160,pa.__webglFramebuffer);if(!ha.depthTexture||!ha.depthTexture.isDepthTexture)throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");d.get(ha.depthTexture).__webglTexture&&ha.depthTexture.image.width===ha.width&&ha.depthTexture.image.height===ha.height||(ha.depthTexture.image.width=ha.width,ha.depthTexture.image.height=ha.height,ha.depthTexture.needsUpdate=!0);P(ha.depthTexture,0);pa=d.get(ha.depthTexture).__webglTexture;if(1026===ha.depthTexture.format)c.framebufferTexture2D(36160,
36096,3553,pa,0);else if(1027===ha.depthTexture.format)c.framebufferTexture2D(36160,33306,3553,pa,0);else throw Error("Unknown depthTexture format");}else if(kb)for(pa.__webglDepthbuffer=[],kb=0;6>kb;kb++)c.bindFramebuffer(36160,pa.__webglFramebuffer[kb]),pa.__webglDepthbuffer[kb]=c.createRenderbuffer(),Aa(pa.__webglDepthbuffer[kb],ha,!1);else c.bindFramebuffer(36160,pa.__webglFramebuffer),pa.__webglDepthbuffer=c.createRenderbuffer(),Aa(pa.__webglDepthbuffer,ha,!1);c.bindFramebuffer(36160,null)}};
this.updateRenderTargetMipmap=function(ha){var pa=ha.texture,ab=w(ha)||xa;if(A(pa,ab)){ab=ha.isWebGLCubeRenderTarget?34067:3553;var ua=d.get(pa).__webglTexture;b.bindTexture(ab,ua);D(ab,pa,ha.width,ha.height);b.bindTexture(ab,null)}};this.updateMultisampleRenderTarget=function(ha){if(ha.isWebGLMultisampleRenderTarget)if(xa){var pa=d.get(ha);c.bindFramebuffer(36008,pa.__webglMultisampledFramebuffer);c.bindFramebuffer(36009,pa.__webglFramebuffer);var ab=ha.width,ua=ha.height,fb=16384;ha.depthBuffer&&
(fb|=256);ha.stencilBuffer&&(fb|=1024);c.blitFramebuffer(0,0,ab,ua,0,0,ab,ua,fb,9728);c.bindFramebuffer(36160,pa.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")};this.safeSetTexture2D=function(ha,pa){ha&&ha.isWebGLRenderTarget&&(!1===$b&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),$b=!0),ha=ha.texture);P(ha,pa)};this.safeSetTextureCube=
function(ha,pa){ha&&ha.isWebGLCubeRenderTarget&&(!1===lc&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),lc=!0),ha=ha.texture);ka(ha,pa)}}function Zf(c,f,b){var d=b.isWebGL2;return{convert:function(g){if(1009===g)return 5121;if(1017===g)return 32819;if(1018===g)return 32820;if(1019===g)return 33635;if(1010===g)return 5120;if(1011===g)return 5122;if(1012===g)return 5123;if(1013===g)return 5124;if(1014===g)return 5125;
if(1015===g)return 5126;if(1016===g){if(d)return 5131;var l=f.get("OES_texture_half_float");return null!==l?l.HALF_FLOAT_OES:null}if(1021===g)return 6406;if(1022===g)return 6407;if(1023===g)return 6408;if(1024===g)return 6409;if(1025===g)return 6410;if(1026===g)return 6402;if(1027===g)return 34041;if(1028===g)return 6403;if(1029===g)return 36244;if(1030===g)return 33319;if(1031===g)return 33320;if(1032===g)return 36248;if(1033===g)return 36249;if(33776===g||33777===g||33778===g||33779===g)if(l=f.get("WEBGL_compressed_texture_s3tc"),
null!==l){if(33776===g)return l.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===g)return l.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===g)return l.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===g)return l.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(35840===g||35841===g||35842===g||35843===g)if(l=f.get("WEBGL_compressed_texture_pvrtc"),null!==l){if(35840===g)return l.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===g)return l.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===g)return l.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===
g)return l.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(36196===g)return l=f.get("WEBGL_compressed_texture_etc1"),null!==l?l.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===g||37496===g)if(l=f.get("WEBGL_compressed_texture_etc"),null!==l){if(37492===g)return l.COMPRESSED_RGB8_ETC2;if(37496===g)return l.COMPRESSED_RGBA8_ETC2_EAC}if(37808===g||37809===g||37810===g||37811===g||37812===g||37813===g||37814===g||37815===g||37816===g||37817===g||37818===g||37819===g||37820===g||37821===g||37840===g||37841===
g||37842===g||37843===g||37844===g||37845===g||37846===g||37847===g||37848===g||37849===g||37850===g||37851===g||37852===g||37853===g)return l=f.get("WEBGL_compressed_texture_astc"),null!==l?g:null;if(36492===g)return l=f.get("EXT_texture_compression_bptc"),null!==l?g:null;if(1020===g){if(d)return 34042;l=f.get("WEBGL_depth_texture");return null!==l?l.UNSIGNED_INT_24_8_WEBGL:null}}}}function rf(c){void 0===c&&(c=[]);Bb.call(this);this.cameras=c}function Dd(){T.call(this);this.type="Group"}function Oe(){this._hand=
this._grip=this._targetRay=null}function ac(c,f){function b(xa){var Ga=S.get(xa.inputSource);Ga&&Ga.dispatchEvent({type:xa.type,data:xa.inputSource})}function d(){S.forEach(function(xa,Ga){xa.disconnect(Ga)});S.clear();Ca=oa=null;c.setDrawingBufferSize(r.width,r.height,v);c.setFramebuffer(null);c.setRenderTarget(c.getRenderTarget());Ra.stop();x.isPresenting=!1;x.dispatchEvent({type:"sessionend"})}function g(xa){for(var Ga=w.inputSources,Oa=0;Oa<L.length;Oa++)S.set(Ga[Oa],L[Oa]);for(Ga=0;Ga<xa.removed.length;Ga++){Oa=
xa.removed[Ga];var nb=S.get(Oa);nb&&(nb.dispatchEvent({type:"disconnected",data:Oa}),S.delete(Oa))}for(Ga=0;Ga<xa.added.length;Ga++)Oa=xa.added[Ga],(nb=S.get(Oa))&&nb.dispatchEvent({type:"connected",data:Oa})}function l(xa,Ga){null===Ga?xa.matrixWorld.copy(xa.matrix):xa.matrixWorld.multiplyMatrices(Ga.matrixWorld,xa.matrix);xa.matrixWorldInverse.copy(xa.matrixWorld).invert()}var r=new ib,v,x=this,w=null,A=1,D=null,J="local-floor",N=null,L=[],S=new Map,P=new Bb;P.layers.enable(1);P.viewport=new qc;
var ka=new Bb;ka.layers.enable(2);ka.viewport=new qc;var ia=[P,ka],la=new rf;la.layers.enable(1);la.layers.enable(2);var oa=null,Ca=null;this.isPresenting=this.enabled=!1;this.getController=function(xa){var Ga=L[xa];void 0===Ga&&(Ga=new Oe,L[xa]=Ga);return Ga.getTargetRaySpace()};this.getControllerGrip=function(xa){var Ga=L[xa];void 0===Ga&&(Ga=new Oe,L[xa]=Ga);return Ga.getGripSpace()};this.getHand=function(xa){var Ga=L[xa];void 0===Ga&&(Ga=new Oe,L[xa]=Ga);return Ga.getHandSpace()};this.setFramebufferScaleFactor=
function(xa){A=xa;!0===x.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")};this.setReferenceSpaceType=function(xa){J=xa;!0===x.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")};this.getReferenceSpace=function(){return D};this.getSession=function(){return w};this.setSession=function(){var xa=h(regeneratorRuntime.mark(function nb(Oa){var Ba,Ea,Pa;return regeneratorRuntime.wrap(function(qb){for(;;)switch(qb.prev=
qb.next){case 0:w=Oa;if(null===w){qb.next=24;break}w.addEventListener("select",b);w.addEventListener("selectstart",b);w.addEventListener("selectend",b);w.addEventListener("squeeze",b);w.addEventListener("squeezestart",b);w.addEventListener("squeezeend",b);w.addEventListener("end",d);w.addEventListener("inputsourceschange",g);Ba=f.getContextAttributes();if(!0===Ba.xrCompatible){qb.next=14;break}qb.next=14;return f.makeXRCompatible();case 14:return Ea={antialias:Ba.antialias,alpha:Ba.alpha,depth:Ba.depth,
stencil:Ba.stencil,framebufferScaleFactor:A},Pa=new XRWebGLLayer(w,f,Ea),w.updateRenderState({baseLayer:Pa}),c.setDrawingBufferSize(Pa.framebufferWidth,Pa.framebufferHeight,1),qb.next=19,w.requestReferenceSpace(J);case 19:D=qb.sent,v=c.getPixelRatio(),c.getSize(r),Ra.setContext(w),Ra.start(),x.isPresenting=!0,x.dispatchEvent({type:"sessionstart"});case 24:case "end":return qb.stop()}},nb)}));return function(Oa){return xa.apply(this,arguments)}}();var Aa=new da,ra=new da;this.getCamera=function(xa){la.near=
ka.near=P.near=xa.near;la.far=ka.far=P.far=xa.far;if(oa!==la.near||Ca!==la.far)w.updateRenderState({depthNear:la.near,depthFar:la.far}),oa=la.near,Ca=la.far;var Ga=xa.parent,Oa=la.cameras;l(la,Ga);for(var nb=0;nb<Oa.length;nb++)l(Oa[nb],Ga);xa.matrixWorld.copy(la.matrixWorld);xa.matrix.copy(la.matrix);xa.matrix.decompose(xa.position,xa.quaternion,xa.scale);xa=xa.children;Ga=0;for(nb=xa.length;Ga<nb;Ga++)xa[Ga].updateMatrixWorld(!0);if(2===Oa.length){Aa.setFromMatrixPosition(P.matrixWorld);ra.setFromMatrixPosition(ka.matrixWorld);
Oa=Aa.distanceTo(ra);var Ba=P.projectionMatrix.elements,Ea=ka.projectionMatrix.elements,Pa=Ba[14]/(Ba[10]-1);xa=Ba[14]/(Ba[10]+1);Ga=(Ba[9]+1)/Ba[5];nb=(Ba[9]-1)/Ba[5];var qb=(Ba[8]-1)/Ba[0],Va=(Ea[8]+1)/Ea[0];Ea=Pa*qb;Ba=Pa*Va;Va=Oa/(-qb+Va);qb=Va*-qb;P.matrixWorld.decompose(la.position,la.quaternion,la.scale);la.translateX(qb);la.translateZ(Va);la.matrixWorld.compose(la.position,la.quaternion,la.scale);la.matrixWorldInverse.copy(la.matrixWorld).invert();Pa+=Va;Va=xa+Va;la.projectionMatrix.makePerspective(Ea-
qb,Ba+(Oa-qb),Ga*xa/Va*Pa,nb*xa/Va*Pa,Pa,Va)}else la.projectionMatrix.copy(P.projectionMatrix);return la};var Ja=null,Ra=new mc;Ra.setAnimationLoop(function(xa,Ga){N=Ga.getViewerPose(D);if(null!==N){var Oa=N.views,nb=w.renderState.baseLayer;c.setFramebuffer(nb.framebuffer);var Ba=!1;Oa.length!==la.cameras.length&&(la.cameras.length=0,Ba=!0);for(var Ea=0;Ea<Oa.length;Ea++){var Pa=Oa[Ea],qb=nb.getViewport(Pa),Va=ia[Ea];Va.matrix.fromArray(Pa.transform.matrix);Va.projectionMatrix.fromArray(Pa.projectionMatrix);
Va.viewport.set(qb.x,qb.y,qb.width,qb.height);0===Ea&&la.matrix.copy(Va.matrix);!0===Ba&&la.cameras.push(Va)}}Oa=w.inputSources;for(nb=0;nb<L.length;nb++)L[nb].update(Oa[nb],Ga,D);Ja&&Ja(xa,Ga)});this.setAnimationLoop=function(xa){Ja=xa};this.dispose=function(){}}function ri(c){function f(d,g){d.opacity.value=g.opacity;g.color&&d.diffuse.value.copy(g.color);g.emissive&&d.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity);g.map&&(d.map.value=g.map);g.alphaMap&&(d.alphaMap.value=g.alphaMap);
g.specularMap&&(d.specularMap.value=g.specularMap);var l=c.get(g).envMap;l&&(d.envMap.value=l,d.flipEnvMap.value=l.isCubeTexture&&l._needsFlipEnvMap?-1:1,d.reflectivity.value=g.reflectivity,d.refractionRatio.value=g.refractionRatio,l=c.get(l).__maxMipLevel,void 0!==l&&(d.maxMipLevel.value=l));g.lightMap&&(d.lightMap.value=g.lightMap,d.lightMapIntensity.value=g.lightMapIntensity);g.aoMap&&(d.aoMap.value=g.aoMap,d.aoMapIntensity.value=g.aoMapIntensity);if(g.map)var r=g.map;else g.specularMap?r=g.specularMap:
g.displacementMap?r=g.displacementMap:g.normalMap?r=g.normalMap:g.bumpMap?r=g.bumpMap:g.roughnessMap?r=g.roughnessMap:g.metalnessMap?r=g.metalnessMap:g.alphaMap?r=g.alphaMap:g.emissiveMap?r=g.emissiveMap:g.clearcoatMap?r=g.clearcoatMap:g.clearcoatNormalMap?r=g.clearcoatNormalMap:g.clearcoatRoughnessMap&&(r=g.clearcoatRoughnessMap);void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),d.uvTransform.value.copy(r.matrix));if(g.aoMap)var v=g.aoMap;else g.lightMap&&
(v=g.lightMap);void 0!==v&&(v.isWebGLRenderTarget&&(v=v.texture),!0===v.matrixAutoUpdate&&v.updateMatrix(),d.uv2Transform.value.copy(v.matrix))}function b(d,g){d.roughness.value=g.roughness;d.metalness.value=g.metalness;g.roughnessMap&&(d.roughnessMap.value=g.roughnessMap);g.metalnessMap&&(d.metalnessMap.value=g.metalnessMap);g.emissiveMap&&(d.emissiveMap.value=g.emissiveMap);g.bumpMap&&(d.bumpMap.value=g.bumpMap,d.bumpScale.value=g.bumpScale,1===g.side&&(d.bumpScale.value*=-1));g.normalMap&&(d.normalMap.value=
g.normalMap,d.normalScale.value.copy(g.normalScale),1===g.side&&d.normalScale.value.negate());g.displacementMap&&(d.displacementMap.value=g.displacementMap,d.displacementScale.value=g.displacementScale,d.displacementBias.value=g.displacementBias);c.get(g).envMap&&(d.envMapIntensity.value=g.envMapIntensity)}return{refreshFogUniforms:function(d,g){d.fogColor.value.copy(g.color);g.isFog?(d.fogNear.value=g.near,d.fogFar.value=g.far):g.isFogExp2&&(d.fogDensity.value=g.density)},refreshMaterialUniforms:function(d,
g,l,r){if(g.isMeshBasicMaterial)f(d,g);else if(g.isMeshLambertMaterial)f(d,g),g.emissiveMap&&(d.emissiveMap.value=g.emissiveMap);else if(g.isMeshToonMaterial)f(d,g),g.gradientMap&&(d.gradientMap.value=g.gradientMap),g.emissiveMap&&(d.emissiveMap.value=g.emissiveMap),g.bumpMap&&(d.bumpMap.value=g.bumpMap,d.bumpScale.value=g.bumpScale,1===g.side&&(d.bumpScale.value*=-1)),g.normalMap&&(d.normalMap.value=g.normalMap,d.normalScale.value.copy(g.normalScale),1===g.side&&d.normalScale.value.negate()),g.displacementMap&&
(d.displacementMap.value=g.displacementMap,d.displacementScale.value=g.displacementScale,d.displacementBias.value=g.displacementBias);else if(g.isMeshPhongMaterial)f(d,g),d.specular.value.copy(g.specular),d.shininess.value=Math.max(g.shininess,1E-4),g.emissiveMap&&(d.emissiveMap.value=g.emissiveMap),g.bumpMap&&(d.bumpMap.value=g.bumpMap,d.bumpScale.value=g.bumpScale,1===g.side&&(d.bumpScale.value*=-1)),g.normalMap&&(d.normalMap.value=g.normalMap,d.normalScale.value.copy(g.normalScale),1===g.side&&
d.normalScale.value.negate()),g.displacementMap&&(d.displacementMap.value=g.displacementMap,d.displacementScale.value=g.displacementScale,d.displacementBias.value=g.displacementBias);else if(g.isMeshStandardMaterial)f(d,g),g.isMeshPhysicalMaterial?(b(d,g),d.reflectivity.value=g.reflectivity,d.clearcoat.value=g.clearcoat,d.clearcoatRoughness.value=g.clearcoatRoughness,g.sheen&&d.sheen.value.copy(g.sheen),g.clearcoatMap&&(d.clearcoatMap.value=g.clearcoatMap),g.clearcoatRoughnessMap&&(d.clearcoatRoughnessMap.value=
g.clearcoatRoughnessMap),g.clearcoatNormalMap&&(d.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),d.clearcoatNormalMap.value=g.clearcoatNormalMap,1===g.side&&d.clearcoatNormalScale.value.negate()),d.transmission.value=g.transmission,g.transmissionMap&&(d.transmissionMap.value=g.transmissionMap)):b(d,g);else if(g.isMeshMatcapMaterial)f(d,g),g.matcap&&(d.matcap.value=g.matcap),g.bumpMap&&(d.bumpMap.value=g.bumpMap,d.bumpScale.value=g.bumpScale,1===g.side&&(d.bumpScale.value*=-1)),g.normalMap&&
(d.normalMap.value=g.normalMap,d.normalScale.value.copy(g.normalScale),1===g.side&&d.normalScale.value.negate()),g.displacementMap&&(d.displacementMap.value=g.displacementMap,d.displacementScale.value=g.displacementScale,d.displacementBias.value=g.displacementBias);else if(g.isMeshDepthMaterial)f(d,g),g.displacementMap&&(d.displacementMap.value=g.displacementMap,d.displacementScale.value=g.displacementScale,d.displacementBias.value=g.displacementBias);else if(g.isMeshDistanceMaterial)f(d,g),g.displacementMap&&
(d.displacementMap.value=g.displacementMap,d.displacementScale.value=g.displacementScale,d.displacementBias.value=g.displacementBias),d.referencePosition.value.copy(g.referencePosition),d.nearDistance.value=g.nearDistance,d.farDistance.value=g.farDistance;else if(g.isMeshNormalMaterial)f(d,g),g.bumpMap&&(d.bumpMap.value=g.bumpMap,d.bumpScale.value=g.bumpScale,1===g.side&&(d.bumpScale.value*=-1)),g.normalMap&&(d.normalMap.value=g.normalMap,d.normalScale.value.copy(g.normalScale),1===g.side&&d.normalScale.value.negate()),
g.displacementMap&&(d.displacementMap.value=g.displacementMap,d.displacementScale.value=g.displacementScale,d.displacementBias.value=g.displacementBias);else if(g.isLineBasicMaterial)d.diffuse.value.copy(g.color),d.opacity.value=g.opacity,g.isLineDashedMaterial&&(d.dashSize.value=g.dashSize,d.totalSize.value=g.dashSize+g.gapSize,d.scale.value=g.scale);else if(g.isPointsMaterial){d.diffuse.value.copy(g.color);d.opacity.value=g.opacity;d.size.value=g.size*l;d.scale.value=.5*r;g.map&&(d.map.value=g.map);
g.alphaMap&&(d.alphaMap.value=g.alphaMap);if(g.map)var v=g.map;else g.alphaMap&&(v=g.alphaMap);void 0!==v&&(!0===v.matrixAutoUpdate&&v.updateMatrix(),d.uvTransform.value.copy(v.matrix))}else if(g.isSpriteMaterial){d.diffuse.value.copy(g.color);d.opacity.value=g.opacity;d.rotation.value=g.rotation;g.map&&(d.map.value=g.map);g.alphaMap&&(d.alphaMap.value=g.alphaMap);if(g.map)var x=g.map;else g.alphaMap&&(x=g.alphaMap);void 0!==x&&(!0===x.matrixAutoUpdate&&x.updateMatrix(),d.uvTransform.value.copy(x.matrix))}else g.isShadowMaterial?
(d.color.value.copy(g.color),d.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}}}function si(){var c=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");c.style.display="block";return c}function qe(c){function f(ba,Ta){for(var Qa=0;Qa<ba.length;Qa++){var eb=N.getContext(ba[Qa],Ta);if(null!==eb)return eb}return null}function b(){Fb=new aa(Za);Pb=new Ma(Za,Fb,c);Fb.init(Pb);Rd=new Zf(Za,Fb,Pb);Nb=new pi(Za,Fb,Pb);Nb.scissor(Sb.copy(kb).multiplyScalar(pa).floor());
Nb.viewport(Db.copy(fb).multiplyScalar(pa).floor());gc=new Ha(Za);dc=new Pg;yc=new qi(Za,Fb,Nb,dc,Pb,Rd,gc);rc=new X(xa);$c=new Ec(Za,Pb);ad=new Je(Za,Fb,$c,Pb);Sd=new ma(Za,$c,gc,ad);re=new mb(Za,Sd,$c,gc);Ej=new ob(Za);nd=new va(dc);Pe=new Og(xa,rc,Fb,Pb,ad,nd);ti=new ri(dc);Tg=new ni(dc);Ug=new Sg(Fb,Pb);se=new Sc(xa,rc,Nb,re,la);Fj=new lf(Za,Fb,gc,Pb);Gj=new Da(Za,Fb,gc,Pb);gc.programs=Pe.programs;xa.capabilities=Pb;xa.extensions=Fb;xa.properties=dc;xa.renderLists=Tg;xa.state=Nb;xa.info=gc}function d(ba){ba.preventDefault();
console.log("THREE.WebGLRenderer: Context Lost.");Ga=!0}function g(){console.log("THREE.WebGLRenderer: Context Restored.");Ga=!1;b()}function l(ba){ba=ba.target;ba.removeEventListener("dispose",l);r(ba);dc.remove(ba)}function r(ba){ba=dc.get(ba).program;void 0!==ba&&Pe.releaseProgram(ba)}function v(ba,Ta){ba.render(function(Qa){xa.renderBufferImmediate(Qa,Ta)})}function x(ba,Ta,Qa,eb){if(!1!==ba.visible){if(ba.layers.test(Ta.layers))if(ba.isGroup)Qa=ba.renderOrder;else if(ba.isLOD)!0===ba.autoUpdate&&
ba.update(Ta);else if(ba.isLight)Ja.pushLight(ba),ba.castShadow&&Ja.pushShadow(ba);else if(ba.isSprite){if(!ba.frustumCulled||vb.intersectsSprite(ba)){eb&&Xb.setFromMatrixPosition(ba.matrixWorld).applyMatrix4(Yb);var xb=re.update(ba),Jb=ba.material;Jb.visible&&ra.push(ba,xb,Jb,Qa,Xb.z,null)}}else if(ba.isImmediateRenderObject)eb&&Xb.setFromMatrixPosition(ba.matrixWorld).applyMatrix4(Yb),ra.push(ba,null,ba.material,Qa,Xb.z,null);else if(ba.isMesh||ba.isLine||ba.isPoints)if(ba.isSkinnedMesh&&ba.skeleton.frame!==
gc.render.frame&&(ba.skeleton.update(),ba.skeleton.frame=gc.render.frame),!ba.frustumCulled||vb.intersectsObject(ba))if(eb&&Xb.setFromMatrixPosition(ba.matrixWorld).applyMatrix4(Yb),xb=re.update(ba),Jb=ba.material,Array.isArray(Jb))for(var Lb=xb.groups,ic=0,hc=Lb.length;ic<hc;ic++){var Ic=Lb[ic],jc=Jb[Ic.materialIndex];jc&&jc.visible&&ra.push(ba,xb,jc,Qa,Xb.z,Ic)}else Jb.visible&&ra.push(ba,xb,Jb,Qa,Xb.z,null);ba=ba.children;xb=0;for(Jb=ba.length;xb<Jb;xb++)x(ba[xb],Ta,Qa,eb)}}function w(ba,Ta,Qa){for(var eb=
!0===Ta.isScene?Ta.overrideMaterial:null,xb=0,Jb=ba.length;xb<Jb;xb++){var Lb=ba[xb],ic=Lb.object,hc=Lb.geometry,Ic=null===eb?Lb.material:eb;Lb=Lb.group;if(Qa.isArrayCamera)for(var jc=Qa.cameras,Td=0,ui=jc.length;Td<ui;Td++){var Vg=jc[Td];ic.layers.test(Vg.layers)&&(Nb.viewport(Db.copy(Vg.viewport)),Ja.setupLightsView(Vg),A(ic,Ta,Vg,hc,Ic,Lb))}else A(ic,Ta,Qa,hc,Ic,Lb)}}function A(ba,Ta,Qa,eb,xb,Jb){ba.onBeforeRender(xa,Ta,Qa,eb,xb,Jb);ba.modelViewMatrix.multiplyMatrices(Qa.matrixWorldInverse,ba.matrixWorld);
ba.normalMatrix.getNormalMatrix(ba.modelViewMatrix);if(ba.isImmediateRenderObject){var Lb=J(Qa,Ta,xb,ba);Nb.setMaterial(xb);ad.reset();v(ba,Lb)}else xa.renderBufferDirect(Qa,Ta,eb,xb,ba,Jb);ba.onAfterRender(xa,Ta,Qa,eb,xb,Jb)}function D(ba,Ta,Qa){!0!==Ta.isScene&&(Ta=nc);var eb=dc.get(ba),xb=Ja.state.lights,Jb=xb.state.version;Qa=Pe.getParameters(ba,xb.state,Ja.state.shadowsArray,Ta,Qa);var Lb=Pe.getProgramCacheKey(Qa),ic=eb.program,hc=!0;eb.environment=ba.isMeshStandardMaterial?Ta.environment:null;
eb.fog=Ta.fog;eb.envMap=rc.get(ba.envMap||eb.environment);if(void 0===ic)ba.addEventListener("dispose",l);else if(ic.cacheKey!==Lb)r(ba);else{if(eb.lightsStateVersion===Jb&&void 0!==Qa.shaderID)return;hc=!1}hc&&(Qa.uniforms=Pe.getUniforms(ba),ba.onBeforeCompile(Qa,xa),ic=Pe.acquireProgram(Qa,Lb),eb.program=ic,eb.uniforms=Qa.uniforms,eb.outputEncoding=Qa.outputEncoding);Ta=eb.uniforms;if(!ba.isShaderMaterial&&!ba.isRawShaderMaterial||!0===ba.clipping)eb.numClippingPlanes=nd.numPlanes,eb.numIntersection=
nd.numIntersection,Ta.clippingPlanes=nd.uniform;eb.needsLights=ba.isMeshLambertMaterial||ba.isMeshToonMaterial||ba.isMeshPhongMaterial||ba.isMeshStandardMaterial||ba.isShadowMaterial||ba.isShaderMaterial&&!0===ba.lights;eb.lightsStateVersion=Jb;eb.needsLights&&(Ta.ambientLightColor.value=xb.state.ambient,Ta.lightProbe.value=xb.state.probe,Ta.directionalLights.value=xb.state.directional,Ta.directionalLightShadows.value=xb.state.directionalShadow,Ta.spotLights.value=xb.state.spot,Ta.spotLightShadows.value=
xb.state.spotShadow,Ta.rectAreaLights.value=xb.state.rectArea,Ta.ltc_1.value=xb.state.rectAreaLTC1,Ta.ltc_2.value=xb.state.rectAreaLTC2,Ta.pointLights.value=xb.state.point,Ta.pointLightShadows.value=xb.state.pointShadow,Ta.hemisphereLights.value=xb.state.hemi,Ta.directionalShadowMap.value=xb.state.directionalShadowMap,Ta.directionalShadowMatrix.value=xb.state.directionalShadowMatrix,Ta.spotShadowMap.value=xb.state.spotShadowMap,Ta.spotShadowMatrix.value=xb.state.spotShadowMatrix,Ta.pointShadowMap.value=
xb.state.pointShadowMap,Ta.pointShadowMatrix.value=xb.state.pointShadowMatrix);ba=eb.program.getUniforms();ba=Ad.seqWithValue(ba.seq,Ta);eb.uniformsList=ba}function J(ba,Ta,Qa,eb){!0!==Ta.isScene&&(Ta=nc);yc.resetTextureUnits();var xb=Ta.fog,Jb=Qa.isMeshStandardMaterial?Ta.environment:null,Lb=null===Ea?xa.outputEncoding:Ea.texture.encoding,ic=rc.get(Qa.envMap||Jb),hc=dc.get(Qa),Ic=Ja.state.lights;!0!==Vb||!0!==Rb&&ba===Va||nd.setState(Qa,ba,ba===Va&&Qa.id===qb);Qa.version===hc.__version?Qa.fog&&hc.fog!==
xb?D(Qa,Ta,eb):hc.environment!==Jb?D(Qa,Ta,eb):hc.needsLights&&hc.lightsStateVersion!==Ic.state.version?D(Qa,Ta,eb):void 0===hc.numClippingPlanes||hc.numClippingPlanes===nd.numPlanes&&hc.numIntersection===nd.numIntersection?hc.outputEncoding!==Lb?D(Qa,Ta,eb):hc.envMap!==ic&&D(Qa,Ta,eb):D(Qa,Ta,eb):(D(Qa,Ta,eb),hc.__version=Qa.version);var jc=!1;Ic=ic=!1;Ta=hc.program;Jb=Ta.getUniforms();Lb=hc.uniforms;Nb.useProgram(Ta.program)&&(Ic=ic=jc=!0);Qa.id!==qb&&(qb=Qa.id,ic=!0);if(jc||Va!==ba){Jb.setValue(Za,
"projectionMatrix",ba.projectionMatrix);Pb.logarithmicDepthBuffer&&Jb.setValue(Za,"logDepthBufFC",2/(Math.log(ba.far+1)/Math.LN2));Va!==ba&&(Va=ba,Ic=ic=!0);if(Qa.isShaderMaterial||Qa.isMeshPhongMaterial||Qa.isMeshToonMaterial||Qa.isMeshStandardMaterial||Qa.envMap)jc=Jb.map.cameraPosition,void 0!==jc&&jc.setValue(Za,Xb.setFromMatrixPosition(ba.matrixWorld));(Qa.isMeshPhongMaterial||Qa.isMeshToonMaterial||Qa.isMeshLambertMaterial||Qa.isMeshBasicMaterial||Qa.isMeshStandardMaterial||Qa.isShaderMaterial)&&
Jb.setValue(Za,"isOrthographic",!0===ba.isOrthographicCamera);(Qa.isMeshPhongMaterial||Qa.isMeshToonMaterial||Qa.isMeshLambertMaterial||Qa.isMeshBasicMaterial||Qa.isMeshStandardMaterial||Qa.isShaderMaterial||Qa.isShadowMaterial||Qa.skinning)&&Jb.setValue(Za,"viewMatrix",ba.matrixWorldInverse)}if(Qa.skinning&&(Jb.setOptional(Za,eb,"bindMatrix"),Jb.setOptional(Za,eb,"bindMatrixInverse"),ba=eb.skeleton))if(jc=ba.bones,Pb.floatVertexTextures){if(null===ba.boneTexture){jc=Math.sqrt(4*jc.length);jc=Qb.ceilPowerOfTwo(jc);
jc=Math.max(jc,4);var Td=new Float32Array(jc*jc*4);Td.set(ba.boneMatrices);var ui=new Ab(Td,jc,jc,1023,1015);ba.boneMatrices=Td;ba.boneTexture=ui;ba.boneTextureSize=jc}Jb.setValue(Za,"boneTexture",ba.boneTexture,yc);Jb.setValue(Za,"boneTextureSize",ba.boneTextureSize)}else Jb.setOptional(Za,ba,"boneMatrices");if(ic||hc.receiveShadow!==eb.receiveShadow)hc.receiveShadow=eb.receiveShadow,Jb.setValue(Za,"receiveShadow",eb.receiveShadow);ic&&(Jb.setValue(Za,"toneMappingExposure",xa.toneMappingExposure),
hc.needsLights&&(ba=Ic,Lb.ambientLightColor.needsUpdate=ba,Lb.lightProbe.needsUpdate=ba,Lb.directionalLights.needsUpdate=ba,Lb.directionalLightShadows.needsUpdate=ba,Lb.pointLights.needsUpdate=ba,Lb.pointLightShadows.needsUpdate=ba,Lb.spotLights.needsUpdate=ba,Lb.spotLightShadows.needsUpdate=ba,Lb.rectAreaLights.needsUpdate=ba,Lb.hemisphereLights.needsUpdate=ba),xb&&Qa.fog&&ti.refreshFogUniforms(Lb,xb),ti.refreshMaterialUniforms(Lb,Qa,pa,ha),Ad.upload(Za,hc.uniformsList,Lb,yc));Qa.isShaderMaterial&&
!0===Qa.uniformsNeedUpdate&&(Ad.upload(Za,hc.uniformsList,Lb,yc),Qa.uniformsNeedUpdate=!1);Qa.isSpriteMaterial&&Jb.setValue(Za,"center",eb.center);Jb.setValue(Za,"modelViewMatrix",eb.modelViewMatrix);Jb.setValue(Za,"normalMatrix",eb.normalMatrix);Jb.setValue(Za,"modelMatrix",eb.matrixWorld);return Ta}this.setXR=function(ba){this.xr=Ud=ba};c=c||{};var N=void 0!==c.canvas?c.canvas:si(),L=void 0!==c.context?c.context:null,S=void 0!==c.alpha?c.alpha:!1,P=void 0!==c.depth?c.depth:!0,ka=void 0!==c.stencil?
c.stencil:!0,ia=void 0!==c.antialias?c.antialias:!1,la=void 0!==c.premultipliedAlpha?c.premultipliedAlpha:!0,oa=void 0!==c.preserveDrawingBuffer?c.preserveDrawingBuffer:!1,Ca=void 0!==c.powerPreference?c.powerPreference:"default",Aa=void 0!==c.failIfMajorPerformanceCaveat?c.failIfMajorPerformanceCaveat:!1,ra=null,Ja=null,Ra=[];this.domElement=N;this.debug={checkShaderErrors:!0};this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;this.clippingPlanes=[];
this.localClippingEnabled=!1;this.gammaFactor=2;this.outputEncoding=3E3;this.physicallyCorrectLights=!1;this.toneMapping=0;this.toneMappingExposure=1;this.maxMorphTargets=8;this.maxMorphNormals=4;var xa=this,Ga=!1,Oa=null,nb=0,Ba=0,Ea=null,Pa=null,qb=-1,Va=null,Db=new qc,Sb=new qc,$b=null,lc=N.width,ha=N.height,pa=1,ab=null,ua=null,fb=new qc(0,0,lc,ha),kb=new qc(0,0,lc,ha),Ib=!1,vb=new Yf,Vb=!1,Rb=!1,Yb=new ec,Xb=new da,nc={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0},
Za=L;try{L={alpha:S,depth:P,stencil:ka,antialias:ia,premultipliedAlpha:la,preserveDrawingBuffer:oa,powerPreference:Ca,failIfMajorPerformanceCaveat:Aa};N.addEventListener("webglcontextlost",d,!1);N.addEventListener("webglcontextrestored",g,!1);if(null===Za&&(S=["webgl2","webgl","experimental-webgl"],!0===xa.isWebGL1Renderer&&S.shift(),Za=f(S,L),null===Za)){if(f(S))throw Error("Error creating WebGL context with your selected attributes.");throw Error("Error creating WebGL context.");}void 0===Za.getShaderPrecisionFormat&&
(Za.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(ba){throw console.error("THREE.WebGLRenderer: "+ba.message),ba;}var Fb,Pb,Nb,gc,dc,yc,rc,$c,Sd,re,Pe,ti,Tg,Ug,nd,se,Ej,Fj,Gj,Rd,ad;b();var Ud=new ac(xa,Za);this.xr=Ud;var Hj=new Ne(xa,re,Pb.maxTextureSize);this.shadowMap=Hj;this.getContext=function(){return Za};this.getContextAttributes=function(){return Za.getContextAttributes()};this.forceContextLoss=function(){var ba=Fb.get("WEBGL_lose_context");ba&&ba.loseContext()};
this.forceContextRestore=function(){var ba=Fb.get("WEBGL_lose_context");ba&&ba.restoreContext()};this.getPixelRatio=function(){return pa};this.setPixelRatio=function(ba){void 0!==ba&&(pa=ba,this.setSize(lc,ha,!1))};this.getSize=function(ba){void 0===ba&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),ba=new ib);return ba.set(lc,ha)};this.setSize=function(ba,Ta,Qa){Ud.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):
(lc=ba,ha=Ta,N.width=Math.floor(ba*pa),N.height=Math.floor(Ta*pa),!1!==Qa&&(N.style.width=ba+"px",N.style.height=Ta+"px"),this.setViewport(0,0,ba,Ta))};this.getDrawingBufferSize=function(ba){void 0===ba&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),ba=new ib);return ba.set(lc*pa,ha*pa).floor()};this.setDrawingBufferSize=function(ba,Ta,Qa){lc=ba;ha=Ta;pa=Qa;N.width=Math.floor(ba*Qa);N.height=Math.floor(Ta*Qa);this.setViewport(0,0,ba,Ta)};this.getCurrentViewport=
function(ba){void 0===ba&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),ba=new qc);return ba.copy(Db)};this.getViewport=function(ba){return ba.copy(fb)};this.setViewport=function(ba,Ta,Qa,eb){ba.isVector4?fb.set(ba.x,ba.y,ba.z,ba.w):fb.set(ba,Ta,Qa,eb);Nb.viewport(Db.copy(fb).multiplyScalar(pa).floor())};this.getScissor=function(ba){return ba.copy(kb)};this.setScissor=function(ba,Ta,Qa,eb){ba.isVector4?kb.set(ba.x,ba.y,ba.z,ba.w):kb.set(ba,Ta,Qa,eb);Nb.scissor(Sb.copy(kb).multiplyScalar(pa).floor())};
this.getScissorTest=function(){return Ib};this.setScissorTest=function(ba){Nb.setScissorTest(Ib=ba)};this.setOpaqueSort=function(ba){ab=ba};this.setTransparentSort=function(ba){ua=ba};this.getClearColor=function(ba){void 0===ba&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),ba=new Cb);return ba.copy(se.getClearColor())};this.setClearColor=function(){se.setClearColor.apply(se,arguments)};this.getClearAlpha=function(){return se.getClearAlpha()};this.setClearAlpha=
function(){se.setClearAlpha.apply(se,arguments)};this.clear=function(ba,Ta,Qa){var eb=0;if(void 0===ba||ba)eb|=16384;if(void 0===Ta||Ta)eb|=256;if(void 0===Qa||Qa)eb|=1024;Za.clear(eb)};this.clearColor=function(){this.clear(!0,!1,!1)};this.clearDepth=function(){this.clear(!1,!0,!1)};this.clearStencil=function(){this.clear(!1,!1,!0)};this.dispose=function(){N.removeEventListener("webglcontextlost",d,!1);N.removeEventListener("webglcontextrestored",g,!1);Tg.dispose();Ug.dispose();dc.dispose();rc.dispose();
re.dispose();ad.dispose();Ud.dispose();$f.stop()};this.renderBufferImmediate=function(ba,Ta){ad.initAttributes();var Qa=dc.get(ba);ba.hasPositions&&!Qa.position&&(Qa.position=Za.createBuffer());ba.hasNormals&&!Qa.normal&&(Qa.normal=Za.createBuffer());ba.hasUvs&&!Qa.uv&&(Qa.uv=Za.createBuffer());ba.hasColors&&!Qa.color&&(Qa.color=Za.createBuffer());Ta=Ta.getAttributes();ba.hasPositions&&(Za.bindBuffer(34962,Qa.position),Za.bufferData(34962,ba.positionArray,35048),ad.enableAttribute(Ta.position),Za.vertexAttribPointer(Ta.position,
3,5126,!1,0,0));ba.hasNormals&&(Za.bindBuffer(34962,Qa.normal),Za.bufferData(34962,ba.normalArray,35048),ad.enableAttribute(Ta.normal),Za.vertexAttribPointer(Ta.normal,3,5126,!1,0,0));ba.hasUvs&&(Za.bindBuffer(34962,Qa.uv),Za.bufferData(34962,ba.uvArray,35048),ad.enableAttribute(Ta.uv),Za.vertexAttribPointer(Ta.uv,2,5126,!1,0,0));ba.hasColors&&(Za.bindBuffer(34962,Qa.color),Za.bufferData(34962,ba.colorArray,35048),ad.enableAttribute(Ta.color),Za.vertexAttribPointer(Ta.color,3,5126,!1,0,0));ad.disableUnusedAttributes();
Za.drawArrays(4,0,ba.count);ba.count=0};this.renderBufferDirect=function(ba,Ta,Qa,eb,xb,Jb){null===Ta&&(Ta=nc);var Lb=xb.isMesh&&0>xb.matrixWorld.determinant();ba=J(ba,Ta,eb,xb);Nb.setMaterial(eb,Lb);Lb=Qa.index;Ta=Qa.attributes.position;if(null===Lb){if(void 0===Ta||0===Ta.count)return}else if(0===Lb.count)return;var ic=1;!0===eb.wireframe&&(Lb=Sd.getWireframeAttribute(Qa),ic=2);(eb.morphTargets||eb.morphNormals)&&Ej.update(xb,Qa,eb,ba);ad.setup(xb,eb,ba,Qa,Lb);ba=Fj;if(null!==Lb){var hc=$c.get(Lb);
ba=Gj;ba.setIndex(hc)}var Ic=Qa.drawRange.start*ic,jc=null!==Jb?Jb.start*ic:0;hc=Math.max(Ic,jc);Jb=Math.max(0,Math.min(null!==Lb?Lb.count:Ta.count,Ic+Qa.drawRange.count*ic,jc+(null!==Jb?Jb.count*ic:Infinity))-1-hc+1);0!==Jb&&(xb.isMesh?!0===eb.wireframe?(Nb.setLineWidth(eb.wireframeLinewidth*(null===Ea?pa:1)),ba.setMode(1)):ba.setMode(4):xb.isLine?(eb=eb.linewidth,void 0===eb&&(eb=1),Nb.setLineWidth(eb*(null===Ea?pa:1)),xb.isLineSegments?ba.setMode(1):xb.isLineLoop?ba.setMode(2):ba.setMode(3)):xb.isPoints?
ba.setMode(0):xb.isSprite&&ba.setMode(4),xb.isInstancedMesh?ba.renderInstances(hc,Jb,xb.count):Qa.isInstancedBufferGeometry?ba.renderInstances(hc,Jb,Math.min(Qa.instanceCount,Qa._maxInstanceCount)):ba.render(hc,Jb))};this.compile=function(ba,Ta){Ja=Ug.get(ba);Ja.init();ba.traverseVisible(function(eb){eb.isLight&&eb.layers.test(Ta.layers)&&(Ja.pushLight(eb),eb.castShadow&&Ja.pushShadow(eb))});Ja.setupLights();var Qa=new WeakMap;ba.traverse(function(eb){var xb=eb.material;if(xb)if(Array.isArray(xb))for(var Jb=
0;Jb<xb.length;Jb++){var Lb=xb[Jb];!1===Qa.has(Lb)&&(D(Lb,ba,eb),Qa.set(Lb))}else!1===Qa.has(xb)&&(D(xb,ba,eb),Qa.set(xb))})};var vi=null,$f=new mc;$f.setAnimationLoop(function(ba){Ud.isPresenting||vi&&vi(ba)});"undefined"!==typeof window&&$f.setContext(window);this.setAnimationLoop=function(ba){vi=ba;Ud.setAnimationLoop(ba);null===ba?$f.stop():$f.start()};this.render=function(ba,Ta,Qa,eb){if(void 0!==Qa){console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead.");
var xb=Qa}if(void 0!==eb){console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead.");var Jb=eb}if(void 0!==Ta&&!0!==Ta.isCamera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else if(!0!==Ga){ad.resetDefaultState();qb=-1;Va=null;!0===ba.autoUpdate&&ba.updateMatrixWorld();null===Ta.parent&&Ta.updateMatrixWorld();!0===Ud.enabled&&!0===Ud.isPresenting&&(Ta=Ud.getCamera(Ta));if(!0===ba.isScene)ba.onBeforeRender(xa,
ba,Ta,xb||Ea);Ja=Ug.get(ba,Ra.length);Ja.init();Ra.push(Ja);Yb.multiplyMatrices(Ta.projectionMatrix,Ta.matrixWorldInverse);vb.setFromProjectionMatrix(Yb);Rb=this.localClippingEnabled;Vb=nd.init(this.clippingPlanes,Rb,Ta);ra=Tg.get(ba,Ta);ra.init();x(ba,Ta,0,xa.sortObjects);ra.finish();!0===xa.sortObjects&&ra.sort(ab,ua);!0===Vb&&nd.beginShadows();Hj.render(Ja.state.shadowsArray,ba,Ta);Ja.setupLights();Ja.setupLightsView(Ta);!0===Vb&&nd.endShadows();!0===this.info.autoReset&&this.info.reset();void 0!==
xb&&this.setRenderTarget(xb);se.render(ra,ba,Ta,Jb);Qa=ra.opaque;eb=ra.transparent;0<Qa.length&&w(Qa,ba,Ta);0<eb.length&&w(eb,ba,Ta);if(!0===ba.isScene)ba.onAfterRender(xa,ba,Ta);null!==Ea&&(yc.updateRenderTargetMipmap(Ea),yc.updateMultisampleRenderTarget(Ea));Nb.buffers.depth.setTest(!0);Nb.buffers.depth.setMask(!0);Nb.buffers.color.setMask(!0);Nb.setPolygonOffset(!1);Ra.pop();Ja=0<Ra.length?Ra[Ra.length-1]:null;ra=null}};this.setFramebuffer=function(ba){Oa!==ba&&null===Ea&&Za.bindFramebuffer(36160,
ba);Oa=ba};this.getActiveCubeFace=function(){return nb};this.getActiveMipmapLevel=function(){return Ba};this.getRenderList=function(){return ra};this.setRenderList=function(ba){ra=ba};this.getRenderTarget=function(){return Ea};this.setRenderTarget=function(ba,Ta,Qa){void 0===Ta&&(Ta=0);void 0===Qa&&(Qa=0);Ea=ba;nb=Ta;Ba=Qa;ba&&void 0===dc.get(ba).__webglFramebuffer&&yc.setupRenderTarget(ba);var eb=Oa,xb=!1;ba?(eb=dc.get(ba).__webglFramebuffer,ba.isWebGLCubeRenderTarget?(eb=eb[Ta],xb=!0):eb=ba.isWebGLMultisampleRenderTarget?
dc.get(ba).__webglMultisampledFramebuffer:eb,Db.copy(ba.viewport),Sb.copy(ba.scissor),$b=ba.scissorTest):(Db.copy(fb).multiplyScalar(pa).floor(),Sb.copy(kb).multiplyScalar(pa).floor(),$b=Ib);Pa!==eb&&(Za.bindFramebuffer(36160,eb),Pa=eb);Nb.viewport(Db);Nb.scissor(Sb);Nb.setScissorTest($b);xb&&(ba=dc.get(ba.texture),Za.framebufferTexture2D(36160,36064,34069+Ta,ba.__webglTexture,Qa))};this.readRenderTargetPixels=function(ba,Ta,Qa,eb,xb,Jb,Lb){if(ba&&ba.isWebGLRenderTarget){var ic=dc.get(ba).__webglFramebuffer;
ba.isWebGLCubeRenderTarget&&void 0!==Lb&&(ic=ic[Lb]);if(ic){Lb=!1;ic!==Pa&&(Za.bindFramebuffer(36160,ic),Lb=!0);try{var hc=ba.texture,Ic=hc.format,jc=hc.type;if(1023!==Ic&&Rd.convert(Ic)!==Za.getParameter(35739))console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");else{var Td=1016===jc&&(Fb.has("EXT_color_buffer_half_float")||Pb.isWebGL2&&Fb.has("EXT_color_buffer_float"));1009===jc||Rd.convert(jc)===Za.getParameter(35738)||1015===
jc&&(Pb.isWebGL2||Fb.has("OES_texture_float")||Fb.has("WEBGL_color_buffer_float"))||Td?36053===Za.checkFramebufferStatus(36160)?0<=Ta&&Ta<=ba.width-eb&&0<=Qa&&Qa<=ba.height-xb&&Za.readPixels(Ta,Qa,eb,xb,Rd.convert(Ic),Rd.convert(jc),Jb):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."):console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.")}}finally{Lb&&
Za.bindFramebuffer(36160,Pa)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")};this.copyFramebufferToTexture=function(ba,Ta,Qa){void 0===Qa&&(Qa=0);var eb=Math.pow(2,-Qa),xb=Math.floor(Ta.image.width*eb);eb=Math.floor(Ta.image.height*eb);var Jb=Rd.convert(Ta.format);yc.setTexture2D(Ta,0);Za.copyTexImage2D(3553,Qa,Jb,ba.x,ba.y,xb,eb,0);Nb.unbindTexture()};this.copyTextureToTexture=function(ba,Ta,Qa,eb){void 0===eb&&(eb=0);var xb=Ta.image.width,
Jb=Ta.image.height,Lb=Rd.convert(Qa.format),ic=Rd.convert(Qa.type);yc.setTexture2D(Qa,0);Za.pixelStorei(37440,Qa.flipY);Za.pixelStorei(37441,Qa.premultiplyAlpha);Za.pixelStorei(3317,Qa.unpackAlignment);Ta.isDataTexture?Za.texSubImage2D(3553,eb,ba.x,ba.y,xb,Jb,Lb,ic,Ta.image.data):Ta.isCompressedTexture?Za.compressedTexSubImage2D(3553,eb,ba.x,ba.y,Ta.mipmaps[0].width,Ta.mipmaps[0].height,Lb,Ta.mipmaps[0].data):Za.texSubImage2D(3553,eb,ba.x,ba.y,Lb,ic,Ta.image);0===eb&&Qa.generateMipmaps&&Za.generateMipmap(3553);
Nb.unbindTexture()};this.initTexture=function(ba){yc.setTexture2D(ba,0);Nb.unbindTexture()};this.resetState=function(){Nb.reset();ad.reset()};"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function sf(c){qe.call(this,c)}function Tc(c,f){this.array=c;this.stride=f;this.count=void 0!==c?c.length/f:0;this.usage=35044;this.updateRange={offset:0,count:-1};this.version=0;this.uuid=Qb.generateUUID()}function od(c,f,b,d){this.name="";this.data=
c;this.itemSize=f;this.offset=b;this.normalized=!0===d}function pd(c){U.call(this);this.type="SpriteMaterial";this.color=new Cb(16777215);this.alphaMap=this.map=null;this.rotation=0;this.transparent=this.sizeAttenuation=!0;this.setValues(c)}function Qe(c){T.call(this);this.type="Sprite";if(void 0===tf){tf=new Na;var f=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]);f=new Tc(f,5);tf.setIndex([0,1,2,0,2,3]);tf.setAttribute("position",new od(f,3,0,!1));tf.setAttribute("uv",new od(f,
2,3,!1))}this.geometry=tf;this.material=void 0!==c?c:new pd;this.center=new ib(.5,.5)}function uf(c,f,b,d,g,l){vf.subVectors(c,b).addScalar(.5).multiply(d);void 0!==g?(ag.x=l*vf.x-g*vf.y,ag.y=g*vf.x+l*vf.y):ag.copy(vf);c.copy(f);c.x+=ag.x;c.y+=ag.y;c.applyMatrix4(Ij)}function Re(){T.call(this);this._currentLevel=0;this.type="LOD";Object.defineProperties(this,{levels:{enumerable:!0,value:[]}});this.autoUpdate=!0}function Se(c,f){c&&c.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");
$a.call(this,c,f);this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new ec;this.bindMatrixInverse=new ec}function Te(){T.call(this);this.type="Bone"}function Ue(c,f){void 0===c&&(c=[]);void 0===f&&(f=[]);this.uuid=Qb.generateUUID();this.bones=c.slice(0);this.boneInverses=f;this.boneTexture=this.boneMatrices=null;this.boneTextureSize=0;this.frame=-1;this.init()}function jd(c,f,b){$a.call(this,c,f);this.instanceMatrix=new M(new Float32Array(16*b),16);this.instanceColor=null;this.count=
b;this.frustumCulled=!1}function sc(c){U.call(this);this.type="LineBasicMaterial";this.color=new Cb(16777215);this.linewidth=1;this.linejoin=this.linecap="round";this.morphTargets=!1;this.setValues(c)}function bd(c,f){void 0===c&&(c=new Na);void 0===f&&(f=new sc);T.call(this);this.type="Line";this.geometry=c;this.material=f;this.updateMorphTargets()}function Mc(c,f){bd.call(this,c,f);this.type="LineSegments"}function te(c,f){bd.call(this,c,f);this.type="LineLoop"}function cd(c){U.call(this);this.type=
"PointsMaterial";this.color=new Cb(16777215);this.alphaMap=this.map=null;this.size=1;this.sizeAttenuation=!0;this.morphTargets=!1;this.setValues(c)}function Vd(c,f){void 0===c&&(c=new Na);void 0===f&&(f=new cd);T.call(this);this.type="Points";this.geometry=c;this.material=f;this.updateMorphTargets()}function Ve(c,f,b,d,g,l,r){var v=wi.distanceSqToPoint(c);v<b&&(b=new da,wi.closestPointToPoint(c,b),b.applyMatrix4(d),c=g.ray.origin.distanceTo(b),c<g.near||c>g.far||l.push({distance:c,distanceToRay:Math.sqrt(v),
point:b,index:f,face:null,object:r}))}function We(c,f,b,d,g,l,r,v,x){function w(){A.needsUpdate=!0;c.requestVideoFrameCallback(w)}R.call(this,c,f,b,d,g,l,r,v,x);this.format=void 0!==r?r:1022;this.minFilter=void 0!==l?l:1006;this.magFilter=void 0!==g?g:1006;this.generateMipmaps=!1;var A=this;"requestVideoFrameCallback"in c&&c.requestVideoFrameCallback(w)}function ue(c,f,b,d,g,l,r,v,x,w,A,D){R.call(this,null,l,r,v,x,w,d,g,A,D);this.image={width:f,height:b};this.mipmaps=c;this.generateMipmaps=this.flipY=
!1}function Xe(c,f,b,d,g,l,r,v,x){R.call(this,c,f,b,d,g,l,r,v,x);this.needsUpdate=!0}function Wd(c,f,b,d,g,l,r,v,x,w){w=void 0!==w?w:1026;if(1026!==w&&1027!==w)throw Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===b&&1026===w&&(b=1012);void 0===b&&1027===w&&(b=1020);R.call(this,null,d,g,l,r,v,w,b,x);this.image={width:c,height:f};this.magFilter=void 0!==r?r:1003;this.minFilter=void 0!==v?v:1003;this.generateMipmaps=this.flipY=!1}function Ye(c,f,b,
d,g){for(var l,r=0,v=f,x=b-d;v<b;v+=d)r+=(c[x]-c[v])*(c[v+1]+c[x+1]),x=v;if(g===0<r)for(g=f;g<b;g+=d)l=Jc(g,c[g],c[g+1],l);else for(g=b-d;g>=f;g-=d)l=Jc(g,c[g],c[g+1],l);l&&wf(l,l.next)&&(ve(l),l=l.next);return l}function Ed(c,f){if(!c)return c;f||=c;do{var b=!1;if(c.steiner||!wf(c,c.next)&&0!==tc(c.prev,c,c.next))c=c.next;else{ve(c);c=f=c.prev;if(c===c.next)break;b=!0}}while(b||c!==f);return f}function we(c,f,b,d,g,l,r){if(c){if(!r&&l){var v=c,x=v;do null===x.z&&(x.z=Ze(x.x,x.y,d,g,l)),x.prevZ=x.prev,
x=x.nextZ=x.next;while(x!==v);x.prevZ.nextZ=null;x.prevZ=null;v=x;var w,A,D,J,N=1;do{x=v;var L=v=null;for(A=0;x;){A++;var S=x;for(w=D=0;w<N&&(D++,S=S.nextZ,S);w++);for(J=N;0<D||0<J&&S;)0!==D&&(0===J||!S||x.z<=S.z)?(w=x,x=x.nextZ,D--):(w=S,S=S.nextZ,J--),L?L.nextZ=w:v=w,w.prevZ=L,L=w;x=S}L.nextZ=null;N*=2}while(1<A)}for(v=c;c.prev!==c.next;){x=c.prev;S=c.next;if(l)L=xi(c,d,g,l);else a:if(L=c,A=L.prev,D=L,N=L.next,0<=tc(A,D,N))L=!1;else{for(w=L.next.next;w!==L.prev;){if(Xd(A.x,A.y,D.x,D.y,N.x,N.y,w.x,
w.y)&&0<=tc(w.prev,w,w.next)){L=!1;break a}w=w.next}L=!0}if(L)f.push(x.i/b),f.push(c.i/b),f.push(S.i/b),ve(c),v=c=S.next;else if(c=S,c===v){if(!r)we(Ed(c),f,b,d,g,l,1);else if(1===r){c=Ed(c);r=f;v=b;x=c;do S=x.prev,L=x.next.next,!wf(S,L)&&Wg(S,x,x.next,L)&&$e(S,L)&&$e(L,S)&&(r.push(S.i/v),r.push(x.i/v),r.push(L.i/v),ve(x),ve(x.next),x=c=L),x=x.next;while(x!==c);c=Ed(x);we(c,f,b,d,g,l,2)}else if(2===r)a:{r=c;do{for(v=r.next.next;v!==r.prev;){if(x=r.i!==v.i){x=r;S=v;if(L=x.next.i!==S.i&&x.prev.i!==
S.i){b:{L=x;do{if(L.i!==x.i&&L.next.i!==x.i&&L.i!==S.i&&L.next.i!==S.i&&Wg(L,L.next,x,S)){L=!0;break b}L=L.next}while(L!==x);L=!1}L=!L}if(L){if(L=$e(x,S)&&$e(S,x)){L=x;A=!1;D=(x.x+S.x)/2;N=(x.y+S.y)/2;do L.y>N!==L.next.y>N&&L.next.y!==L.y&&D<(L.next.x-L.x)*(N-L.y)/(L.next.y-L.y)+L.x&&(A=!A),L=L.next;while(L!==x);L=A}L=L&&(tc(x.prev,x,S.prev)||tc(x,S.prev,S))||wf(x,S)&&0<tc(x.prev,x,x.next)&&0<tc(S.prev,S,S.next)}x=L}if(x){c=Xg(r,v);r=Ed(r,r.next);c=Ed(c,c.next);we(r,f,b,d,g,l);we(c,f,b,d,g,l);break a}v=
v.next}r=r.next}while(r!==c)}break}}}}function xi(c,f,b,d){var g=c.prev,l=c.next;if(0<=tc(g,c,l))return!1;var r=g.x>c.x?g.x>l.x?g.x:l.x:c.x>l.x?c.x:l.x,v=g.y>c.y?g.y>l.y?g.y:l.y:c.y>l.y?c.y:l.y,x=Ze(g.x<c.x?g.x<l.x?g.x:l.x:c.x<l.x?c.x:l.x,g.y<c.y?g.y<l.y?g.y:l.y:c.y<l.y?c.y:l.y,f,b,d);f=Ze(r,v,f,b,d);b=c.prevZ;for(d=c.nextZ;b&&b.z>=x&&d&&d.z<=f;){if(b!==c.prev&&b!==c.next&&Xd(g.x,g.y,c.x,c.y,l.x,l.y,b.x,b.y)&&0<=tc(b.prev,b,b.next))return!1;b=b.prevZ;if(d!==c.prev&&d!==c.next&&Xd(g.x,g.y,c.x,c.y,
l.x,l.y,d.x,d.y)&&0<=tc(d.prev,d,d.next))return!1;d=d.nextZ}for(;b&&b.z>=x;){if(b!==c.prev&&b!==c.next&&Xd(g.x,g.y,c.x,c.y,l.x,l.y,b.x,b.y)&&0<=tc(b.prev,b,b.next))return!1;b=b.prevZ}for(;d&&d.z<=f;){if(d!==c.prev&&d!==c.next&&Xd(g.x,g.y,c.x,c.y,l.x,l.y,d.x,d.y)&&0<=tc(d.prev,d,d.next))return!1;d=d.nextZ}return!0}function yi(c,f){return c.x-f.x}function bg(c,f){var b=f,d=c.x,g=c.y,l=-Infinity;do{if(g<=b.y&&g>=b.next.y&&b.next.y!==b.y){var r=b.x+(g-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(r<=d&&r>l){l=
r;if(r===d){if(g===b.y)return b;if(g===b.next.y)return b.next}var v=b.x<b.next.x?b:b.next}}b=b.next}while(b!==f);if(!v)return null;if(d===l)return v;f=v;r=v.x;var x=v.y,w=Infinity;b=v;do{if(d>=b.x&&b.x>=r&&d!==b.x&&Xd(g<x?d:l,g,r,x,g<x?l:d,g,b.x,b.y)){var A=Math.abs(g-b.y)/(d-b.x);var D;if((D=$e(b,c))&&!(D=A<w)&&(D=A===w)&&!(D=b.x>v.x)&&(D=b.x===v.x)){D=v;var J=b;D=0>tc(D.prev,D,J.prev)&&0>tc(J.next,D,D.next)}D&&(v=b,w=A)}b=b.next}while(b!==f);return v}function Ze(c,f,b,d,g){c=32767*(c-b)*g;f=32767*
(f-d)*g;c=(c|c<<8)&16711935;c=(c|c<<4)&252645135;c=(c|c<<2)&858993459;f=(f|f<<8)&16711935;f=(f|f<<4)&252645135;f=(f|f<<2)&858993459;return(c|c<<1)&1431655765|((f|f<<1)&1431655765)<<1}function Xd(c,f,b,d,g,l,r,v){return 0<=(g-r)*(f-v)-(c-r)*(l-v)&&0<=(c-r)*(d-v)-(b-r)*(f-v)&&0<=(b-r)*(l-v)-(g-r)*(d-v)}function tc(c,f,b){return(f.y-c.y)*(b.x-f.x)-(f.x-c.x)*(b.y-f.y)}function wf(c,f){return c.x===f.x&&c.y===f.y}function Wg(c,f,b,d){var g=xf(tc(c,f,b)),l=xf(tc(c,f,d)),r=xf(tc(b,d,c)),v=xf(tc(b,d,f));
return g!==l&&r!==v||0===g&&Fd(c,b,f)||0===l&&Fd(c,d,f)||0===r&&Fd(b,c,d)||0===v&&Fd(b,f,d)?!0:!1}function Fd(c,f,b){return f.x<=Math.max(c.x,b.x)&&f.x>=Math.min(c.x,b.x)&&f.y<=Math.max(c.y,b.y)&&f.y>=Math.min(c.y,b.y)}function xf(c){return 0<c?1:0>c?-1:0}function $e(c,f){return 0>tc(c.prev,c,c.next)?0<=tc(c,f,c.next)&&0<=tc(c,c.prev,f):0>tc(c,f,c.prev)||0>tc(c,c.next,f)}function Xg(c,f){var b=new cg(c.i,c.x,c.y),d=new cg(f.i,f.x,f.y),g=c.next,l=f.prev;c.next=f;f.prev=c;b.next=g;g.prev=b;d.next=b;
b.prev=d;l.next=d;d.prev=l;return d}function Jc(c,f,b,d){c=new cg(c,f,b);d?(c.next=d.next,c.prev=d,d.next.prev=c,d.next=c):(c.prev=c,c.next=c);return c}function ve(c){c.next.prev=c.prev;c.prev.next=c.next;c.prevZ&&(c.prevZ.nextZ=c.nextZ);c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function cg(c,f,b){this.i=c;this.x=f;this.y=b;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function Yg(c){var f=c.length;2<f&&c[f-1].equals(c[0])&&c.pop()}function Zg(c,f){for(var b=0;b<f.length;b++)c.push(f[b].x),
c.push(f[b].y)}function Gd(c,f,b){Na.call(this);this.type="ParametricGeometry";this.parameters={func:c,slices:f,stacks:b};var d=[],g=[],l=[],r=[],v=new da,x=new da,w=new da,A=new da,D=new da;3>c.length&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");for(var J=f+1,N=0;N<=b;N++)for(var L=N/b,S=0;S<=f;S++){var P=S/f;c(P,L,x);g.push(x.x,x.y,x.z);0<=P-1E-5?(c(P-1E-5,L,w),A.subVectors(x,w)):(c(P+1E-5,L,w),A.subVectors(w,x));0<=L-1E-5?(c(P,L-1E-5,w),D.subVectors(x,
w)):(c(P,L+1E-5,w),D.subVectors(w,x));v.crossVectors(A,D).normalize();l.push(v.x,v.y,v.z);r.push(P,L)}for(c=0;c<b;c++)for(v=0;v<f;v++)x=c*J+v+1,w=(c+1)*J+v+1,A=(c+1)*J+v,d.push(c*J+v,x,A),d.push(x,w,A);this.setIndex(d);this.setAttribute("position",new Ya(g,3));this.setAttribute("normal",new Ya(l,3));this.setAttribute("uv",new Ya(r,2))}function Yd(c){U.call(this);this.type="ShadowMaterial";this.color=new Cb(0);this.transparent=!0;this.setValues(c)}function kd(c){yb.call(this,c);this.type="RawShaderMaterial"}
function gd(c){U.call(this);this.defines={STANDARD:""};this.type="MeshStandardMaterial";this.color=new Cb(16777215);this.roughness=1;this.metalness=0;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new Cb(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalMapType=0;this.normalScale=new ib(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.envMap=this.alphaMap=
this.metalnessMap=this.roughnessMap=null;this.envMapIntensity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.vertexTangents=this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(c)}function Hd(c){gd.call(this);this.defines={STANDARD:"",PHYSICAL:""};this.type="MeshPhysicalMaterial";this.clearcoat=0;this.clearcoatMap=null;this.clearcoatRoughness=0;this.clearcoatRoughnessMap=null;this.clearcoatNormalScale=
new ib(1,1);this.clearcoatNormalMap=null;this.reflectivity=.5;Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(f){this.reflectivity=Qb.clamp(2.5*(f-1)/(f+1),0,1)}});this.sheen=null;this.transmission=0;this.transmissionMap=null;this.setValues(c)}function Id(c){U.call(this);this.type="MeshPhongMaterial";this.color=new Cb(16777215);this.specular=new Cb(1118481);this.shininess=30;this.lightMap=this.map=null;this.lightMapIntensity=1;
this.aoMap=null;this.aoMapIntensity=1;this.emissive=new Cb(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalMapType=0;this.normalScale=new ib(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.envMap=this.alphaMap=this.specularMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=
this.morphTargets=this.skinning=!1;this.setValues(c)}function Zd(c){U.call(this);this.defines={TOON:""};this.type="MeshToonMaterial";this.color=new Cb(16777215);this.lightMap=this.gradientMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new Cb(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalMapType=0;this.normalScale=new ib(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=
0;this.alphaMap=null;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(c)}function Jd(c){U.call(this);this.type="MeshNormalMaterial";this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalMapType=0;this.normalScale=new ib(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=1;this.morphNormals=this.morphTargets=
this.skinning=this.fog=!1;this.setValues(c)}function G(c){U.call(this);this.type="MeshLambertMaterial";this.color=new Cb(16777215);this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new Cb(0);this.emissiveIntensity=1;this.envMap=this.alphaMap=this.specularMap=this.emissiveMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=
this.morphTargets=this.skinning=!1;this.setValues(c)}function z(c){U.call(this);this.defines={MATCAP:""};this.type="MeshMatcapMaterial";this.color=new Cb(16777215);this.bumpMap=this.map=this.matcap=null;this.bumpScale=1;this.normalMap=null;this.normalMapType=0;this.normalScale=new ib(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.alphaMap=null;this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(c)}function p(c){sc.call(this);this.type="LineDashedMaterial";
this.scale=1;this.dashSize=3;this.gapSize=1;this.setValues(c)}function n(c,f,b,d){this.parameterPositions=c;this._cachedIndex=0;this.resultBuffer=void 0!==d?d:new f.constructor(b);this.sampleValues=f;this.valueSize=b}function k(c,f,b,d){n.call(this,c,f,b,d);this._offsetNext=this._weightNext=this._offsetPrev=this._weightPrev=-0}function q(c,f,b,d){n.call(this,c,f,b,d)}function u(c,f,b,d){n.call(this,c,f,b,d)}function B(c,f,b,d){if(void 0===c)throw Error("THREE.KeyframeTrack: track name is undefined");
if(void 0===f||0===f.length)throw Error("THREE.KeyframeTrack: no keyframes in track named "+c);this.name=c;this.times=wc.convertArray(f,this.TimeBufferType);this.values=wc.convertArray(b,this.ValueBufferType);this.setInterpolation(d||this.DefaultInterpolation)}function F(c,f,b){B.call(this,c,f,b)}function K(c,f,b,d){B.call(this,c,f,b,d)}function Z(c,f,b,d){B.call(this,c,f,b,d)}function ja(c,f,b,d){n.call(this,c,f,b,d)}function ya(c,f,b,d){B.call(this,c,f,b,d)}function Xa(c,f,b,d){B.call(this,c,f,
b,d)}function La(c,f,b,d){B.call(this,c,f,b,d)}function Wa(c,f,b,d){void 0===f&&(f=-1);void 0===d&&(d=2500);this.name=c;this.tracks=b;this.duration=f;this.blendMode=d;this.uuid=Qb.generateUUID();0>this.duration&&this.resetDuration()}function db(c){switch(c.toLowerCase()){case "scalar":case "double":case "float":case "number":case "integer":return Z;case "vector":case "vector2":case "vector3":case "vector4":return La;case "color":return K;case "quaternion":return ya;case "bool":case "boolean":return F;
case "string":return Xa}throw Error("THREE.KeyframeTrack: Unsupported typeName: "+c);}function bb(c,f,b){var d=this,g=!1,l=0,r=0,v=void 0,x=[];this.onStart=void 0;this.onLoad=c;this.onProgress=f;this.onError=b;this.itemStart=function(w){r++;if(!1===g&&void 0!==d.onStart)d.onStart(w,l,r);g=!0};this.itemEnd=function(w){l++;if(void 0!==d.onProgress)d.onProgress(w,l,r);if(l===r&&(g=!1,void 0!==d.onLoad))d.onLoad()};this.itemError=function(w){if(void 0!==d.onError)d.onError(w)};this.resolveURL=function(w){return v?
v(w):w};this.setURLModifier=function(w){v=w;return this};this.addHandler=function(w,A){x.push(w,A);return this};this.removeHandler=function(w){w=x.indexOf(w);-1!==w&&x.splice(w,2);return this};this.getHandler=function(w){for(var A=0,D=x.length;A<D;A+=2){var J=x[A],N=x[A+1];J.global&&(J.lastIndex=0);if(J.test(w))return N}return null}}function sb(c){this.manager=void 0!==c?c:Jj;this.crossOrigin="anonymous";this.withCredentials=!1;this.resourcePath=this.path="";this.requestHeader={}}function Wb(c){sb.call(this,
c)}function tb(c){sb.call(this,c)}function bc(c){sb.call(this,c)}function fc(c){sb.call(this,c)}function ub(c){sb.call(this,c)}function Ac(c){sb.call(this,c)}function Uc(c){sb.call(this,c)}function Eb(){this.type="Curve";this.arcLengthDivisions=200}function Hc(c,f,b,d,g,l,r,v){Eb.call(this);this.type="EllipseCurve";this.aX=c||0;this.aY=f||0;this.xRadius=b||1;this.yRadius=d||1;this.aStartAngle=g||0;this.aEndAngle=l||2*Math.PI;this.aClockwise=r||!1;this.aRotation=v||0}function Vc(c,f,b,d,g,l){Hc.call(this,
c,f,b,b,d,g,l);this.type="ArcCurve"}function zi(){var c=0,f=0,b=0,d=0;return{initCatmullRom:function(g,l,r,v,x){g=x*(r-g);v=x*(v-l);c=l;f=g;b=-3*l+3*r-2*g-v;d=2*l-2*r+g+v},initNonuniformCatmullRom:function(g,l,r,v,x,w,A){g=((l-g)/x-(r-g)/(x+w)+(r-l)/w)*w;v=((r-l)/w-(v-l)/(w+A)+(v-r)/A)*w;c=l;f=g;b=-3*l+3*r-2*g-v;d=2*l-2*r+g+v},calc:function(g){var l=g*g;return c+f*g+b*l+d*l*g}}}function Qc(c,f,b,d){void 0===c&&(c=[]);void 0===f&&(f=!1);void 0===b&&(b="centripetal");void 0===d&&(d=.5);Eb.call(this);
this.type="CatmullRomCurve3";this.points=c;this.closed=f;this.curveType=b;this.tension=d}function Kj(c,f,b,d,g){f=.5*(d-f);g=.5*(g-b);var l=c*c;return(2*b-2*d+f+g)*c*l+(-3*b+3*d-2*f-g)*l+f*c+b}function dg(c,f,b,d){var g=1-c;return g*g*f+2*(1-c)*c*b+c*c*d}function eg(c,f,b,d,g){var l=1-c,r=1-c;return l*l*l*f+3*r*r*c*b+3*(1-c)*c*c*d+c*c*c*g}function qd(c,f,b,d){void 0===c&&(c=new ib);void 0===f&&(f=new ib);void 0===b&&(b=new ib);void 0===d&&(d=new ib);Eb.call(this);this.type="CubicBezierCurve";this.v0=
c;this.v1=f;this.v2=b;this.v3=d}function Kd(c,f,b,d){void 0===c&&(c=new da);void 0===f&&(f=new da);void 0===b&&(b=new da);void 0===d&&(d=new da);Eb.call(this);this.type="CubicBezierCurve3";this.v0=c;this.v1=f;this.v2=b;this.v3=d}function dd(c,f){void 0===c&&(c=new ib);void 0===f&&(f=new ib);Eb.call(this);this.type="LineCurve";this.v1=c;this.v2=f}function rd(c,f){void 0===c&&(c=new da);void 0===f&&(f=new da);Eb.call(this);this.type="LineCurve3";this.v1=c;this.v2=f}function sd(c,f,b){void 0===c&&(c=
new ib);void 0===f&&(f=new ib);void 0===b&&(b=new ib);Eb.call(this);this.type="QuadraticBezierCurve";this.v0=c;this.v1=f;this.v2=b}function Ld(c,f,b){void 0===c&&(c=new da);void 0===f&&(f=new da);void 0===b&&(b=new da);Eb.call(this);this.type="QuadraticBezierCurve3";this.v0=c;this.v1=f;this.v2=b}function td(c){void 0===c&&(c=[]);Eb.call(this);this.type="SplineCurve";this.points=c}function xe(){Eb.call(this);this.type="CurvePath";this.curves=[];this.autoClose=!1}function ud(c){xe.call(this);this.type=
"Path";this.currentPoint=new ib;c&&this.setFromPoints(c)}function ye(c){ud.call(this,c);this.uuid=Qb.generateUUID();this.type="Shape";this.holes=[]}function uc(c,f){void 0===f&&(f=1);T.call(this);this.type="Light";this.color=new Cb(c);this.intensity=f}function $g(c,f,b){uc.call(this,c,b);this.type="HemisphereLight";this.position.copy(T.DefaultUp);this.updateMatrix();this.groundColor=new Cb(f)}function $d(c){this.camera=c;this.normalBias=this.bias=0;this.radius=1;this.mapSize=new ib(512,512);this.mapPass=
this.map=null;this.matrix=new ec;this.autoUpdate=!0;this.needsUpdate=!1;this._frustum=new Yf;this._frameExtents=new ib(1,1);this._viewportCount=1;this._viewports=[new qc(0,0,1,1)]}function Ai(){$d.call(this,new Bb(50,1,.5,500));this.focus=1}function ah(c,f,b,d,g,l){uc.call(this,c,f);this.type="SpotLight";this.position.copy(T.DefaultUp);this.updateMatrix();this.target=new T;Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(r){this.intensity=r/Math.PI}});
this.distance=void 0!==b?b:0;this.angle=void 0!==d?d:Math.PI/3;this.penumbra=void 0!==g?g:0;this.decay=void 0!==l?l:1;this.shadow=new Ai}function Bi(){$d.call(this,new Bb(90,1,.5,500));this._frameExtents=new ib(4,2);this._viewportCount=6;this._viewports=[new qc(2,1,1,1),new qc(0,1,1,1),new qc(3,1,1,1),new qc(1,1,1,1),new qc(3,0,1,1),new qc(1,0,1,1)];this._cubeDirections=[new da(1,0,0),new da(-1,0,0),new da(0,0,1),new da(0,0,-1),new da(0,1,0),new da(0,-1,0)];this._cubeUps=[new da(0,1,0),new da(0,1,
0),new da(0,1,0),new da(0,1,0),new da(0,0,1),new da(0,0,-1)]}function bh(c,f,b,d){uc.call(this,c,f);this.type="PointLight";Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(g){this.intensity=g/(4*Math.PI)}});this.distance=void 0!==b?b:0;this.decay=void 0!==d?d:1;this.shadow=new Bi}function yf(c,f,b,d,g,l){void 0===c&&(c=-1);void 0===f&&(f=1);void 0===b&&(b=1);void 0===d&&(d=-1);void 0===g&&(g=.1);void 0===l&&(l=2E3);wb.call(this);this.type="OrthographicCamera";
this.zoom=1;this.view=null;this.left=c;this.right=f;this.top=b;this.bottom=d;this.near=g;this.far=l;this.updateProjectionMatrix()}function Ci(){$d.call(this,new yf(-5,5,5,-5,.5,500))}function ch(c,f){uc.call(this,c,f);this.type="DirectionalLight";this.position.copy(T.DefaultUp);this.updateMatrix();this.target=new T;this.shadow=new Ci}function dh(c,f){uc.call(this,c,f);this.type="AmbientLight"}function eh(c,f,b,d){uc.call(this,c,f);this.type="RectAreaLight";this.width=void 0!==b?b:10;this.height=void 0!==
d?d:10}function ld(c,f){uc.call(this,void 0,f);this.type="LightProbe";this.sh=void 0!==c?c:new Lj}function fh(c){sb.call(this,c);this.textures={}}function fg(){Na.call(this);this.type="InstancedBufferGeometry";this.instanceCount=Infinity}function gh(c,f,b,d){"number"===typeof b&&(d=b,b=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument."));M.call(this,c,f,b);this.meshPerAttribute=d||1}function hh(c){sb.call(this,c)}function Di(c){"undefined"===
typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported.");"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported.");sb.call(this,c);this.options={premultiplyAlpha:"none"}}function Ei(){this.type="ShapePath";this.color=new Cb;this.subPaths=[];this.currentPath=null}function Fi(c){sb.call(this,c)}function ih(c){sb.call(this,c)}function Gi(c,f,b){ld.call(this,void 0,b);c=(new Cb).set(c);b=(new Cb).set(f);f=new da(c.r,c.g,c.b);
c=new da(b.r,b.g,b.b);b=Math.sqrt(Math.PI);var d=b*Math.sqrt(.75);this.sh.coefficients[0].copy(f).add(c).multiplyScalar(b);this.sh.coefficients[1].copy(f).sub(c).multiplyScalar(d)}function Hi(c,f){ld.call(this,void 0,f);c=(new Cb).set(c);this.sh.coefficients[0].set(c.r,c.g,c.b).multiplyScalar(2*Math.sqrt(Math.PI))}function Mj(){this.type="StereoCamera";this.aspect=1;this.eyeSep=.064;this.cameraL=new Bb;this.cameraL.layers.enable(1);this.cameraL.matrixAutoUpdate=!1;this.cameraR=new Bb;this.cameraR.layers.enable(2);
this.cameraR.matrixAutoUpdate=!1;this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}function Nj(){return("undefined"===typeof performance?Date:performance).now()}function Ii(c,f,b){this.binding=c;this.valueSize=b;switch(f){case "quaternion":c=this._slerp;f=this._slerpAdditive;var d=this._setAdditiveIdentityQuaternion;this.buffer=new Float64Array(6*b);this._workIndex=5;break;case "string":case "bool":f=c=this._select;d=this._setAdditiveIdentityOther;this.buffer=
Array(5*b);break;default:c=this._lerp,f=this._lerpAdditive,d=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*b)}this._mixBufferRegion=c;this._mixBufferRegionAdditive=f;this._setIdentity=d;this._origIndex=3;this._addIndex=4;this.referenceCount=this.useCount=this.cumulativeWeightAdditive=this.cumulativeWeight=0}function Oj(c,f,b){b=b||Rc.parseTrackName(f);this._targetGroup=c;this._bindings=c.subscribe_(f,b)}function Rc(c,f,b){this.path=f;this.parsedPath=b||Rc.parseTrackName(f);this.node=
Rc.findNode(c,this.parsedPath.nodeName)||c;this.rootNode=c}function Pj(){this.uuid=Qb.generateUUID();this._objects=Array.prototype.slice.call(arguments);this.nCachedObjects_=0;var c={};this._indicesByUUID=c;for(var f=0,b=arguments.length;f!==b;++f)c[arguments[f].uuid]=f;this._paths=[];this._parsedPaths=[];this._bindings=[];this._bindingsIndicesByPath={};var d=this;this.stats={objects:{get total(){return d._objects.length},get inUse(){return this.total-d.nCachedObjects_}},get bindingsPerObject(){return d._bindings.length}}}
function Ji(c){this._root=c;this._initMemoryManager();this.time=this._accuIndex=0;this.timeScale=1}function Ki(c,f,b){Tc.call(this,c,f);this.meshPerAttribute=b||1}function Li(c,f,b,d,g){this.buffer=c;this.type=f;this.itemSize=b;this.elementSize=d;this.count=g;this.version=0}function Mi(c,f,b,d){this.ray=new zf(c,f);this.near=b||0;this.far=d||Infinity;this.camera=null;this.layers=new Vh;this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}};Object.defineProperties(this.params,
{PointCloud:{get:function(){console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points.");return this.Points}}})}function Qj(c,f){return c.distance-f.distance}function Ni(c,f,b,d){c.layers.test(f.layers)&&c.raycast(f,b);if(!0===d){c=c.children;d=0;for(var g=c.length;d<g;d++)Ni(c[d],f,b,!0)}}function gg(c){T.call(this);this.material=c;this.render=function(){};this.hasUvs=this.hasColors=this.hasNormals=this.hasPositions=!1;this.uvArray=this.colorArray=this.normalArray=this.positionArray=
null;this.count=0}function Rj(c){var f=[];c&&c.isBone&&f.push(c);for(var b=0;b<c.children.length;b++)f.push.apply(f,Rj(c.children[b]));return f}function Dc(c,f,b,d,g,l,r){jh.set(g,l,r).unproject(d);c=f[c];if(void 0!==c)for(b=b.getAttribute("position"),f=0,d=c.length;f<d;f++)b.setXYZ(c[f],jh.x,jh.y,jh.z)}function Sj(c){var f=Math.min(Math.max(Math.ceil(Math.log2(Math.max(c.r,c.g,c.b))),-128),127);c.multiplyScalar(Math.pow(2,-f));return(f+128)/255}function Tj(c){c=new pe(3*Md,3*Md,c);c.texture.mapping=
306;c.texture.name="PMREM.cubeUv";c.scissorTest=!0;return c}function kh(c,f,b,d,g){c.viewport.set(f,b,d,g);c.scissor.set(f,b,d,g)}function Uj(){var c=new ib(1,1);return new kd({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:c},inputEncoding:{value:Nd[3E3]},outputEncoding:{value:Nd[3E3]}},vertexShader:Oi(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t"+
Pi()+"\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",
blending:0,depthTest:!1,depthWrite:!1})}function Vj(){return new kd({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:Nd[3E3]},outputEncoding:{value:Nd[3E3]}},vertexShader:Oi(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t"+Pi()+"\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",
blending:0,depthTest:!1,depthWrite:!1})}function Oi(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}
function Pi(){return"\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t"}
function Wj(c){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead.");Qc.call(this,c);this.type="catmullrom";this.closed=!0}function Xj(c){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead.");Qc.call(this,c);this.type="catmullrom"}function Qi(c){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead.");Qc.call(this,c);this.type="catmullrom"}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,
-52));void 0===Number.isInteger&&(Number.isInteger=function(c){return"number"===typeof c&&isFinite(c)&&Math.floor(c)===c});void 0===Math.sign&&(Math.sign=function(c){return 0>c?-1:0<c?1:+c});!1==="name"in Function.prototype&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}});void 0===Object.assign&&(Object.assign=function(c){if(void 0===c||null===c)throw new TypeError("Cannot convert undefined or null to object");for(var f=
Object(c),b=1;b<arguments.length;b++){var d=arguments[b];if(void 0!==d&&null!==d)for(var g in d)Object.prototype.hasOwnProperty.call(d,g)&&(f[g]=d[g])}return f});var Yj=function(c){function f(Ba,Ea,Pa){Object.defineProperty(Ba,Ea,{value:Pa,enumerable:!0,configurable:!0,writable:!0});return Ba[Ea]}function b(Ba,Ea,Pa,qb){Ea=Object.create((Ea&&Ea.prototype instanceof g?Ea:g).prototype);qb=new N(qb||[]);Ea._invoke=w(Ba,Pa,qb);return Ea}function d(Ba,Ea,Pa){try{return{type:"normal",arg:Ba.call(Ea,Pa)}}catch(qb){return{type:"throw",
arg:qb}}}function g(){}function l(){}function r(){}function v(Ba){["next","throw","return"].forEach(function(Ea){f(Ba,Ea,function(Pa){return this._invoke(Ea,Pa)})})}function x(Ba,Ea){function Pa(Va,Db,Sb,$b){Va=d(Ba[Va],Ba,Db);if("throw"===Va.type)$b(Va.arg);else{var lc=Va.arg;return(Va=lc.value)&&"object"===typeof Va&&ka.call(Va,"__await")?Ea.resolve(Va.__await).then(function(ha){Pa("next",ha,Sb,$b)},function(ha){Pa("throw",ha,Sb,$b)}):Ea.resolve(Va).then(function(ha){lc.value=ha;Sb(lc)},function(ha){return Pa("throw",
ha,Sb,$b)})}}var qb;this._invoke=function(Va,Db){function Sb(){return new Ea(function($b,lc){Pa(Va,Db,$b,lc)})}return qb=qb?qb.then(Sb,Sb):Sb()}}function w(Ba,Ea,Pa){var qb=ra;return function(Va,Db){if(qb===Ra)throw Error("Generator is already running");if(qb===xa){if("throw"===Va)throw Db;return S()}Pa.method=Va;for(Pa.arg=Db;;){if(Va=Pa.delegate)if(Va=A(Va,Pa)){if(Va===Ga)continue;return Va}if("next"===Pa.method)Pa.sent=Pa._sent=Pa.arg;else if("throw"===Pa.method){if(qb===ra)throw qb=xa,Pa.arg;
Pa.dispatchException(Pa.arg)}else"return"===Pa.method&&Pa.abrupt("return",Pa.arg);qb=Ra;Va=d(Ba,Ea,Pa);if("normal"===Va.type){qb=Pa.done?xa:Ja;if(Va.arg===Ga)continue;return{value:Va.arg,done:Pa.done}}"throw"===Va.type&&(qb=xa,Pa.method="throw",Pa.arg=Va.arg)}}}function A(Ba,Ea){var Pa=Ba.iterator[Ea.method];if(Pa===ia){Ea.delegate=null;if("throw"===Ea.method){if(Ba.iterator["return"]&&(Ea.method="return",Ea.arg=ia,A(Ba,Ea),"throw"===Ea.method))return Ga;Ea.method="throw";Ea.arg=new TypeError("The iterator does not provide a 'throw' method")}return Ga}Pa=
d(Pa,Ba.iterator,Ea.arg);if("throw"===Pa.type)return Ea.method="throw",Ea.arg=Pa.arg,Ea.delegate=null,Ga;Pa=Pa.arg;if(!Pa)return Ea.method="throw",Ea.arg=new TypeError("iterator result is not an object"),Ea.delegate=null,Ga;if(Pa.done)Ea[Ba.resultName]=Pa.value,Ea.next=Ba.nextLoc,"return"!==Ea.method&&(Ea.method="next",Ea.arg=ia);else return Pa;Ea.delegate=null;return Ga}function D(Ba){var Ea={tryLoc:Ba[0]};1 in Ba&&(Ea.catchLoc=Ba[1]);2 in Ba&&(Ea.finallyLoc=Ba[2],Ea.afterLoc=Ba[3]);this.tryEntries.push(Ea)}
function J(Ba){var Ea=Ba.completion||{};Ea.type="normal";delete Ea.arg;Ba.completion=Ea}function N(Ba){this.tryEntries=[{tryLoc:"root"}];Ba.forEach(D,this);this.reset(!0)}function L(Ba){if(Ba){var Ea=Ba[oa];if(Ea)return Ea.call(Ba);if("function"===typeof Ba.next)return Ba;if(!isNaN(Ba.length)){var Pa=-1;Ea=function Va(){for(;++Pa<Ba.length;)if(ka.call(Ba,Pa))return Va.value=Ba[Pa],Va.done=!1,Va;Va.value=ia;Va.done=!0;return Va};return Ea.next=Ea}}return{next:S}}function S(){return{value:ia,done:!0}}
var P=Object.prototype,ka=P.hasOwnProperty,ia,la="function"===typeof Symbol?Symbol:{},oa=la.iterator||"@@iterator",Ca=la.asyncIterator||"@@asyncIterator",Aa=la.toStringTag||"@@toStringTag";try{f({},"")}catch(Ba){f=function(Ea,Pa,qb){return Ea[Pa]=qb}}c.wrap=b;var ra="suspendedStart",Ja="suspendedYield",Ra="executing",xa="completed",Ga={};la={};la[oa]=function(){return this};var Oa=Object.getPrototypeOf;(Oa=Oa&&Oa(Oa(L([]))))&&Oa!==P&&ka.call(Oa,oa)&&(la=Oa);var nb=r.prototype=g.prototype=Object.create(la);
l.prototype=nb.constructor=r;r.constructor=l;l.displayName=f(r,Aa,"GeneratorFunction");c.isGeneratorFunction=function(Ba){return(Ba="function"===typeof Ba&&Ba.constructor)?Ba===l||"GeneratorFunction"===(Ba.displayName||Ba.name):!1};c.mark=function(Ba){Object.setPrototypeOf?Object.setPrototypeOf(Ba,r):(Ba.__proto__=r,f(Ba,Aa,"GeneratorFunction"));Ba.prototype=Object.create(nb);return Ba};c.awrap=function(Ba){return{__await:Ba}};v(x.prototype);x.prototype[Ca]=function(){return this};c.AsyncIterator=
x;c.async=function(Ba,Ea,Pa,qb,Va){void 0===Va&&(Va=Promise);var Db=new x(b(Ba,Ea,Pa,qb),Va);return c.isGeneratorFunction(Ea)?Db:Db.next().then(function(Sb){return Sb.done?Sb.value:Db.next()})};v(nb);f(nb,Aa,"Generator");nb[oa]=function(){return this};nb.toString=function(){return"[object Generator]"};c.keys=function(Ba){var Ea=[],Pa;for(Pa in Ba)Ea.push(Pa);Ea.reverse();return function Va(){for(;Ea.length;){var Db=Ea.pop();if(Db in Ba)return Va.value=Db,Va.done=!1,Va}Va.done=!0;return Va}};c.values=
L;N.prototype={constructor:N,reset:function(Ba){this.next=this.prev=0;this.sent=this._sent=ia;this.done=!1;this.delegate=null;this.method="next";this.arg=ia;this.tryEntries.forEach(J);if(!Ba)for(var Ea in this)"t"===Ea.charAt(0)&&ka.call(this,Ea)&&!isNaN(+Ea.slice(1))&&(this[Ea]=ia)},stop:function(){this.done=!0;var Ba=this.tryEntries[0].completion;if("throw"===Ba.type)throw Ba.arg;return this.rval},dispatchException:function(Ba){function Ea(lc,ha){Db.type="throw";Db.arg=Ba;Pa.next=lc;ha&&(Pa.method=
"next",Pa.arg=ia);return!!ha}if(this.done)throw Ba;for(var Pa=this,qb=this.tryEntries.length-1;0<=qb;--qb){var Va=this.tryEntries[qb],Db=Va.completion;if("root"===Va.tryLoc)return Ea("end");if(Va.tryLoc<=this.prev){var Sb=ka.call(Va,"catchLoc"),$b=ka.call(Va,"finallyLoc");if(Sb&&$b){if(this.prev<Va.catchLoc)return Ea(Va.catchLoc,!0);if(this.prev<Va.finallyLoc)return Ea(Va.finallyLoc)}else if(Sb){if(this.prev<Va.catchLoc)return Ea(Va.catchLoc,!0)}else if($b){if(this.prev<Va.finallyLoc)return Ea(Va.finallyLoc)}else throw Error("try statement without catch or finally");
}}},abrupt:function(Ba,Ea){for(var Pa=this.tryEntries.length-1;0<=Pa;--Pa){var qb=this.tryEntries[Pa];if(qb.tryLoc<=this.prev&&ka.call(qb,"finallyLoc")&&this.prev<qb.finallyLoc){var Va=qb;break}}Va&&("break"===Ba||"continue"===Ba)&&Va.tryLoc<=Ea&&Ea<=Va.finallyLoc&&(Va=null);Pa=Va?Va.completion:{};Pa.type=Ba;Pa.arg=Ea;return Va?(this.method="next",this.next=Va.finallyLoc,Ga):this.complete(Pa)},complete:function(Ba,Ea){if("throw"===Ba.type)throw Ba.arg;"break"===Ba.type||"continue"===Ba.type?this.next=
Ba.arg:"return"===Ba.type?(this.rval=this.arg=Ba.arg,this.method="return",this.next="end"):"normal"===Ba.type&&Ea&&(this.next=Ea);return Ga},finish:function(Ba){for(var Ea=this.tryEntries.length-1;0<=Ea;--Ea){var Pa=this.tryEntries[Ea];if(Pa.finallyLoc===Ba)return this.complete(Pa.completion,Pa.afterLoc),J(Pa),Ga}},"catch":function(Ba){for(var Ea=this.tryEntries.length-1;0<=Ea;--Ea){var Pa=this.tryEntries[Ea];if(Pa.tryLoc===Ba){Ba=Pa.completion;if("throw"===Ba.type){var qb=Ba.arg;J(Pa)}return qb}}throw Error("illegal catch attempt");
},delegateYield:function(Ba,Ea,Pa){this.delegate={iterator:L(Ba),resultName:Ea,nextLoc:Pa};"next"===this.method&&(this.arg=ia);return Ga}};return c}("object"===typeof module?module.exports:{});try{regeneratorRuntime=Yj}catch(c){Function("r","regeneratorRuntime = r")(Yj)}Object.assign(O.prototype,{addEventListener:function(c,f){void 0===this._listeners&&(this._listeners={});var b=this._listeners;void 0===b[c]&&(b[c]=[]);-1===b[c].indexOf(f)&&b[c].push(f)},hasEventListener:function(c,f){if(void 0===
this._listeners)return!1;var b=this._listeners;return void 0!==b[c]&&-1!==b[c].indexOf(f)},removeEventListener:function(c,f){void 0!==this._listeners&&(c=this._listeners[c],void 0!==c&&(f=c.indexOf(f),-1!==f&&c.splice(f,1)))},dispatchEvent:function(c){if(void 0!==this._listeners){var f=this._listeners[c.type];if(void 0!==f){c.target=this;f=f.slice(0);for(var b=0,d=f.length;b<d;b++)f[b].call(this,c)}}}});for(var Nc=[],hg=0;256>hg;hg++)Nc[hg]=(16>hg?"0":"")+hg.toString(16);var lh=1234567,Qb={DEG2RAD:Math.PI/
180,RAD2DEG:180/Math.PI,generateUUID:function(){var c=4294967295*Math.random()|0,f=4294967295*Math.random()|0,b=4294967295*Math.random()|0,d=4294967295*Math.random()|0;return(Nc[c&255]+Nc[c>>8&255]+Nc[c>>16&255]+Nc[c>>24&255]+"-"+Nc[f&255]+Nc[f>>8&255]+"-"+Nc[f>>16&15|64]+Nc[f>>24&255]+"-"+Nc[b&63|128]+Nc[b>>8&255]+"-"+Nc[b>>16&255]+Nc[b>>24&255]+Nc[d&255]+Nc[d>>8&255]+Nc[d>>16&255]+Nc[d>>24&255]).toUpperCase()},clamp:function(c,f,b){return Math.max(f,Math.min(b,c))},euclideanModulo:function(c,f){return(c%
f+f)%f},mapLinear:function(c,f,b,d,g){return d+(c-f)*(g-d)/(b-f)},lerp:function(c,f,b){return(1-b)*c+b*f},damp:function(c,f,b,d){return Qb.lerp(c,f,1-Math.exp(-b*d))},pingpong:function(c,f){void 0===f&&(f=1);return f-Math.abs(Qb.euclideanModulo(c,2*f)-f)},smoothstep:function(c,f,b){if(c<=f)return 0;if(c>=b)return 1;c=(c-f)/(b-f);return c*c*(3-2*c)},smootherstep:function(c,f,b){if(c<=f)return 0;if(c>=b)return 1;c=(c-f)/(b-f);return c*c*c*(c*(6*c-15)+10)},randInt:function(c,f){return c+Math.floor(Math.random()*
(f-c+1))},randFloat:function(c,f){return c+Math.random()*(f-c)},randFloatSpread:function(c){return c*(.5-Math.random())},seededRandom:function(c){void 0!==c&&(lh=c%2147483647);lh=16807*lh%2147483647;return(lh-1)/2147483646},degToRad:function(c){return c*Qb.DEG2RAD},radToDeg:function(c){return c*Qb.RAD2DEG},isPowerOfTwo:function(c){return 0===(c&c-1)&&0!==c},ceilPowerOfTwo:function(c){return Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))},floorPowerOfTwo:function(c){return Math.pow(2,Math.floor(Math.log(c)/
Math.LN2))},setQuaternionFromProperEuler:function(c,f,b,d,g){var l=Math.cos,r=Math.sin,v=l(b/2);b=r(b/2);var x=l((f+d)/2),w=r((f+d)/2),A=l((f-d)/2),D=r((f-d)/2);l=l((d-f)/2);f=r((d-f)/2);switch(g){case "XYX":c.set(v*w,b*A,b*D,v*x);break;case "YZY":c.set(b*D,v*w,b*A,v*x);break;case "ZXZ":c.set(b*A,b*D,v*w,v*x);break;case "XZX":c.set(v*w,b*f,b*l,v*x);break;case "YXY":c.set(b*l,v*w,b*f,v*x);break;case "ZYZ":c.set(b*f,b*l,v*w,v*x);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+
g)}}},ib=function(){function c(b,d){void 0===b&&(b=0);void 0===d&&(d=0);Object.defineProperty(this,"isVector2",{value:!0});this.x=b;this.y=d}var f=c.prototype;f.set=function(b,d){this.x=b;this.y=d;return this};f.setScalar=function(b){this.y=this.x=b;return this};f.setX=function(b){this.x=b;return this};f.setY=function(b){this.y=b;return this};f.setComponent=function(b,d){switch(b){case 0:this.x=d;break;case 1:this.y=d;break;default:throw Error("index is out of range: "+b);}return this};f.getComponent=
function(b){switch(b){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+b);}};f.clone=function(){return new this.constructor(this.x,this.y)};f.copy=function(b){this.x=b.x;this.y=b.y;return this};f.add=function(b,d){if(void 0!==d)return console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(b,d);this.x+=b.x;this.y+=b.y;return this};f.addScalar=function(b){this.x+=b;this.y+=b;return this};f.addVectors=
function(b,d){this.x=b.x+d.x;this.y=b.y+d.y;return this};f.addScaledVector=function(b,d){this.x+=b.x*d;this.y+=b.y*d;return this};f.sub=function(b,d){if(void 0!==d)return console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(b,d);this.x-=b.x;this.y-=b.y;return this};f.subScalar=function(b){this.x-=b;this.y-=b;return this};f.subVectors=function(b,d){this.x=b.x-d.x;this.y=b.y-d.y;return this};f.multiply=function(b){this.x*=b.x;this.y*=
b.y;return this};f.multiplyScalar=function(b){this.x*=b;this.y*=b;return this};f.divide=function(b){this.x/=b.x;this.y/=b.y;return this};f.divideScalar=function(b){return this.multiplyScalar(1/b)};f.applyMatrix3=function(b){var d=this.x,g=this.y;b=b.elements;this.x=b[0]*d+b[3]*g+b[6];this.y=b[1]*d+b[4]*g+b[7];return this};f.min=function(b){this.x=Math.min(this.x,b.x);this.y=Math.min(this.y,b.y);return this};f.max=function(b){this.x=Math.max(this.x,b.x);this.y=Math.max(this.y,b.y);return this};f.clamp=
function(b,d){this.x=Math.max(b.x,Math.min(d.x,this.x));this.y=Math.max(b.y,Math.min(d.y,this.y));return this};f.clampScalar=function(b,d){this.x=Math.max(b,Math.min(d,this.x));this.y=Math.max(b,Math.min(d,this.y));return this};f.clampLength=function(b,d){var g=this.length();return this.divideScalar(g||1).multiplyScalar(Math.max(b,Math.min(d,g)))};f.floor=function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this};f.ceil=function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);
return this};f.round=function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this};f.roundToZero=function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);return this};f.negate=function(){this.x=-this.x;this.y=-this.y;return this};f.dot=function(b){return this.x*b.x+this.y*b.y};f.cross=function(b){return this.x*b.y-this.y*b.x};f.lengthSq=function(){return this.x*this.x+this.y*this.y};f.length=function(){return Math.sqrt(this.x*
this.x+this.y*this.y)};f.manhattanLength=function(){return Math.abs(this.x)+Math.abs(this.y)};f.normalize=function(){return this.divideScalar(this.length()||1)};f.angle=function(){return Math.atan2(-this.y,-this.x)+Math.PI};f.distanceTo=function(b){return Math.sqrt(this.distanceToSquared(b))};f.distanceToSquared=function(b){var d=this.x-b.x;b=this.y-b.y;return d*d+b*b};f.manhattanDistanceTo=function(b){return Math.abs(this.x-b.x)+Math.abs(this.y-b.y)};f.setLength=function(b){return this.normalize().multiplyScalar(b)};
f.lerp=function(b,d){this.x+=(b.x-this.x)*d;this.y+=(b.y-this.y)*d;return this};f.lerpVectors=function(b,d,g){this.x=b.x+(d.x-b.x)*g;this.y=b.y+(d.y-b.y)*g;return this};f.equals=function(b){return b.x===this.x&&b.y===this.y};f.fromArray=function(b,d){void 0===d&&(d=0);this.x=b[d];this.y=b[d+1];return this};f.toArray=function(b,d){void 0===b&&(b=[]);void 0===d&&(d=0);b[d]=this.x;b[d+1]=this.y;return b};f.fromBufferAttribute=function(b,d,g){void 0!==g&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute().");
this.x=b.getX(d);this.y=b.getY(d);return this};f.rotateAround=function(b,d){var g=Math.cos(d);d=Math.sin(d);var l=this.x-b.x,r=this.y-b.y;this.x=l*g-r*d+b.x;this.y=l*d+r*g+b.y;return this};f.random=function(){this.x=Math.random();this.y=Math.random();return this};t(c,[{key:"width",get:function(){return this.x},set:function(b){this.x=b}},{key:"height",get:function(){return this.y},set:function(b){this.y=b}}]);return c}(),fd=function(){function c(){Object.defineProperty(this,"isMatrix3",{value:!0});
this.elements=[1,0,0,0,1,0,0,0,1];0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}var f=c.prototype;f.set=function(b,d,g,l,r,v,x,w,A){var D=this.elements;D[0]=b;D[1]=l;D[2]=x;D[3]=d;D[4]=r;D[5]=w;D[6]=g;D[7]=v;D[8]=A;return this};f.identity=function(){this.set(1,0,0,0,1,0,0,0,1);return this};f.clone=function(){return(new this.constructor).fromArray(this.elements)};f.copy=function(b){var d=this.elements;b=b.elements;d[0]=b[0];d[1]=
b[1];d[2]=b[2];d[3]=b[3];d[4]=b[4];d[5]=b[5];d[6]=b[6];d[7]=b[7];d[8]=b[8];return this};f.extractBasis=function(b,d,g){b.setFromMatrix3Column(this,0);d.setFromMatrix3Column(this,1);g.setFromMatrix3Column(this,2);return this};f.setFromMatrix4=function(b){b=b.elements;this.set(b[0],b[4],b[8],b[1],b[5],b[9],b[2],b[6],b[10]);return this};f.multiply=function(b){return this.multiplyMatrices(this,b)};f.premultiply=function(b){return this.multiplyMatrices(b,this)};f.multiplyMatrices=function(b,d){var g=b.elements,
l=d.elements;d=this.elements;b=g[0];var r=g[3],v=g[6],x=g[1],w=g[4],A=g[7],D=g[2],J=g[5];g=g[8];var N=l[0],L=l[3],S=l[6],P=l[1],ka=l[4],ia=l[7],la=l[2],oa=l[5];l=l[8];d[0]=b*N+r*P+v*la;d[3]=b*L+r*ka+v*oa;d[6]=b*S+r*ia+v*l;d[1]=x*N+w*P+A*la;d[4]=x*L+w*ka+A*oa;d[7]=x*S+w*ia+A*l;d[2]=D*N+J*P+g*la;d[5]=D*L+J*ka+g*oa;d[8]=D*S+J*ia+g*l;return this};f.multiplyScalar=function(b){var d=this.elements;d[0]*=b;d[3]*=b;d[6]*=b;d[1]*=b;d[4]*=b;d[7]*=b;d[2]*=b;d[5]*=b;d[8]*=b;return this};f.determinant=function(){var b=
this.elements,d=b[0],g=b[1],l=b[2],r=b[3],v=b[4],x=b[5],w=b[6],A=b[7];b=b[8];return d*v*b-d*x*A-g*r*b+g*x*w+l*r*A-l*v*w};f.invert=function(){var b=this.elements,d=b[0],g=b[1],l=b[2],r=b[3],v=b[4],x=b[5],w=b[6],A=b[7],D=b[8],J=D*v-x*A,N=x*w-D*r,L=A*r-v*w,S=d*J+g*N+l*L;if(0===S)return this.set(0,0,0,0,0,0,0,0,0);S=1/S;b[0]=J*S;b[1]=(l*A-D*g)*S;b[2]=(x*g-l*v)*S;b[3]=N*S;b[4]=(D*d-l*w)*S;b[5]=(l*r-x*d)*S;b[6]=L*S;b[7]=(g*w-A*d)*S;b[8]=(v*d-g*r)*S;return this};f.transpose=function(){var b=this.elements;
var d=b[1];b[1]=b[3];b[3]=d;d=b[2];b[2]=b[6];b[6]=d;d=b[5];b[5]=b[7];b[7]=d;return this};f.getNormalMatrix=function(b){return this.setFromMatrix4(b).copy(this).invert().transpose()};f.transposeIntoArray=function(b){var d=this.elements;b[0]=d[0];b[1]=d[3];b[2]=d[6];b[3]=d[1];b[4]=d[4];b[5]=d[7];b[6]=d[2];b[7]=d[5];b[8]=d[8];return this};f.setUvTransform=function(b,d,g,l,r,v,x){var w=Math.cos(r);r=Math.sin(r);this.set(g*w,g*r,-g*(w*v+r*x)+v+b,-l*r,l*w,-l*(-r*v+w*x)+x+d,0,0,1);return this};f.scale=function(b,
d){var g=this.elements;g[0]*=b;g[3]*=b;g[6]*=b;g[1]*=d;g[4]*=d;g[7]*=d;return this};f.rotate=function(b){var d=Math.cos(b);b=Math.sin(b);var g=this.elements,l=g[0],r=g[3],v=g[6],x=g[1],w=g[4],A=g[7];g[0]=d*l+b*x;g[3]=d*r+b*w;g[6]=d*v+b*A;g[1]=-b*l+d*x;g[4]=-b*r+d*w;g[7]=-b*v+d*A;return this};f.translate=function(b,d){var g=this.elements;g[0]+=b*g[2];g[3]+=b*g[5];g[6]+=b*g[8];g[1]+=d*g[2];g[4]+=d*g[5];g[7]+=d*g[8];return this};f.equals=function(b){var d=this.elements;b=b.elements;for(var g=0;9>g;g++)if(d[g]!==
b[g])return!1;return!0};f.fromArray=function(b,d){void 0===d&&(d=0);for(var g=0;9>g;g++)this.elements[g]=b[g+d];return this};f.toArray=function(b,d){void 0===b&&(b=[]);void 0===d&&(d=0);var g=this.elements;b[d]=g[0];b[d+1]=g[1];b[d+2]=g[2];b[d+3]=g[3];b[d+4]=g[4];b[d+5]=g[5];b[d+6]=g[6];b[d+7]=g[7];b[d+8]=g[8];return b};return c}(),Af,Ge={getDataURL:function(c){if(/^data:/i.test(c.src)||"undefined"==typeof HTMLCanvasElement)return c.src;if(!(c instanceof HTMLCanvasElement)){void 0===Af&&(Af=document.createElementNS("http://www.w3.org/1999/xhtml",
"canvas"));Af.width=c.width;Af.height=c.height;var f=Af.getContext("2d");c instanceof ImageData?f.putImageData(c,0,0):f.drawImage(c,0,0,c.width,c.height);c=Af}return 2048<c.width||2048<c.height?c.toDataURL("image/jpeg",.6):c.toDataURL("image/png")}},fl=0;R.DEFAULT_IMAGE=void 0;R.DEFAULT_MAPPING=300;R.prototype=Object.assign(Object.create(O.prototype),{constructor:R,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,
this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(c){this.name=c.name;this.image=c.image;this.mipmaps=c.mipmaps.slice(0);this.mapping=c.mapping;this.wrapS=c.wrapS;this.wrapT=c.wrapT;this.magFilter=c.magFilter;this.minFilter=c.minFilter;this.anisotropy=c.anisotropy;this.format=c.format;this.internalFormat=c.internalFormat;this.type=c.type;this.offset.copy(c.offset);this.repeat.copy(c.repeat);this.center.copy(c.center);this.rotation=c.rotation;this.matrixAutoUpdate=
c.matrixAutoUpdate;this.matrix.copy(c.matrix);this.generateMipmaps=c.generateMipmaps;this.premultiplyAlpha=c.premultiplyAlpha;this.flipY=c.flipY;this.unpackAlignment=c.unpackAlignment;this.encoding=c.encoding;return this},toJSON:function(c){var f=void 0===c||"string"===typeof c;if(!f&&void 0!==c.textures[this.uuid])return c.textures[this.uuid];var b={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],
offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var d=this.image;void 0===d.uuid&&(d.uuid=Qb.generateUUID());if(!f&&void 0===c.images[d.uuid]){if(Array.isArray(d)){var g=[];
for(var l=0,r=d.length;l<r;l++)d[l].isDataTexture?g.push(W(d[l].image)):g.push(W(d[l]))}else g=W(d);c.images[d.uuid]={uuid:d.uuid,url:g}}b.image=d.uuid}f||(c.textures[this.uuid]=b);return b},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(c){if(300!==this.mapping)return c;c.applyMatrix3(this.matrix);if(0>c.x||1<c.x)switch(this.wrapS){case 1E3:c.x-=Math.floor(c.x);break;case 1001:c.x=0>c.x?0:1;break;case 1002:c.x=1===Math.abs(Math.floor(c.x)%2)?Math.ceil(c.x)-c.x:c.x-
Math.floor(c.x)}if(0>c.y||1<c.y)switch(this.wrapT){case 1E3:c.y-=Math.floor(c.y);break;case 1001:c.y=0>c.y?0:1;break;case 1002:c.y=1===Math.abs(Math.floor(c.y)%2)?Math.ceil(c.y)-c.y:c.y-Math.floor(c.y)}this.flipY&&(c.y=1-c.y);return c}});Object.defineProperty(R.prototype,"needsUpdate",{set:function(c){!0===c&&this.version++}});var qc=function(){function c(b,d,g,l){void 0===b&&(b=0);void 0===d&&(d=0);void 0===g&&(g=0);void 0===l&&(l=1);Object.defineProperty(this,"isVector4",{value:!0});this.x=b;this.y=
d;this.z=g;this.w=l}var f=c.prototype;f.set=function(b,d,g,l){this.x=b;this.y=d;this.z=g;this.w=l;return this};f.setScalar=function(b){this.w=this.z=this.y=this.x=b;return this};f.setX=function(b){this.x=b;return this};f.setY=function(b){this.y=b;return this};f.setZ=function(b){this.z=b;return this};f.setW=function(b){this.w=b;return this};f.setComponent=function(b,d){switch(b){case 0:this.x=d;break;case 1:this.y=d;break;case 2:this.z=d;break;case 3:this.w=d;break;default:throw Error("index is out of range: "+
b);}return this};f.getComponent=function(b){switch(b){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+b);}};f.clone=function(){return new this.constructor(this.x,this.y,this.z,this.w)};f.copy=function(b){this.x=b.x;this.y=b.y;this.z=b.z;this.w=void 0!==b.w?b.w:1;return this};f.add=function(b,d){if(void 0!==d)return console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),
this.addVectors(b,d);this.x+=b.x;this.y+=b.y;this.z+=b.z;this.w+=b.w;return this};f.addScalar=function(b){this.x+=b;this.y+=b;this.z+=b;this.w+=b;return this};f.addVectors=function(b,d){this.x=b.x+d.x;this.y=b.y+d.y;this.z=b.z+d.z;this.w=b.w+d.w;return this};f.addScaledVector=function(b,d){this.x+=b.x*d;this.y+=b.y*d;this.z+=b.z*d;this.w+=b.w*d;return this};f.sub=function(b,d){if(void 0!==d)return console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),
this.subVectors(b,d);this.x-=b.x;this.y-=b.y;this.z-=b.z;this.w-=b.w;return this};f.subScalar=function(b){this.x-=b;this.y-=b;this.z-=b;this.w-=b;return this};f.subVectors=function(b,d){this.x=b.x-d.x;this.y=b.y-d.y;this.z=b.z-d.z;this.w=b.w-d.w;return this};f.multiply=function(b){this.x*=b.x;this.y*=b.y;this.z*=b.z;this.w*=b.w;return this};f.multiplyScalar=function(b){this.x*=b;this.y*=b;this.z*=b;this.w*=b;return this};f.applyMatrix4=function(b){var d=this.x,g=this.y,l=this.z,r=this.w;b=b.elements;
this.x=b[0]*d+b[4]*g+b[8]*l+b[12]*r;this.y=b[1]*d+b[5]*g+b[9]*l+b[13]*r;this.z=b[2]*d+b[6]*g+b[10]*l+b[14]*r;this.w=b[3]*d+b[7]*g+b[11]*l+b[15]*r;return this};f.divideScalar=function(b){return this.multiplyScalar(1/b)};f.setAxisAngleFromQuaternion=function(b){this.w=2*Math.acos(b.w);var d=Math.sqrt(1-b.w*b.w);1E-4>d?(this.x=1,this.z=this.y=0):(this.x=b.x/d,this.y=b.y/d,this.z=b.z/d);return this};f.setAxisAngleFromRotationMatrix=function(b){b=b.elements;var d=b[0];var g=b[4];var l=b[8],r=b[1],v=b[5],
x=b[9];var w=b[2];var A=b[6];var D=b[10];if(.01>Math.abs(g-r)&&.01>Math.abs(l-w)&&.01>Math.abs(x-A)){if(.1>Math.abs(g+r)&&.1>Math.abs(l+w)&&.1>Math.abs(x+A)&&.1>Math.abs(d+v+D-3))return this.set(1,0,0,0),this;b=Math.PI;d=(d+1)/2;v=(v+1)/2;D=(D+1)/2;g=(g+r)/4;l=(l+w)/4;x=(x+A)/4;d>v&&d>D?.01>d?(A=0,g=w=.707106781):(A=Math.sqrt(d),w=g/A,g=l/A):v>D?.01>v?(A=.707106781,w=0,g=.707106781):(w=Math.sqrt(v),A=g/w,g=x/w):.01>D?(w=A=.707106781,g=0):(g=Math.sqrt(D),A=l/g,w=x/g);this.set(A,w,g,b);return this}b=
Math.sqrt((A-x)*(A-x)+(l-w)*(l-w)+(r-g)*(r-g));.001>Math.abs(b)&&(b=1);this.x=(A-x)/b;this.y=(l-w)/b;this.z=(r-g)/b;this.w=Math.acos((d+v+D-1)/2);return this};f.min=function(b){this.x=Math.min(this.x,b.x);this.y=Math.min(this.y,b.y);this.z=Math.min(this.z,b.z);this.w=Math.min(this.w,b.w);return this};f.max=function(b){this.x=Math.max(this.x,b.x);this.y=Math.max(this.y,b.y);this.z=Math.max(this.z,b.z);this.w=Math.max(this.w,b.w);return this};f.clamp=function(b,d){this.x=Math.max(b.x,Math.min(d.x,this.x));
this.y=Math.max(b.y,Math.min(d.y,this.y));this.z=Math.max(b.z,Math.min(d.z,this.z));this.w=Math.max(b.w,Math.min(d.w,this.w));return this};f.clampScalar=function(b,d){this.x=Math.max(b,Math.min(d,this.x));this.y=Math.max(b,Math.min(d,this.y));this.z=Math.max(b,Math.min(d,this.z));this.w=Math.max(b,Math.min(d,this.w));return this};f.clampLength=function(b,d){var g=this.length();return this.divideScalar(g||1).multiplyScalar(Math.max(b,Math.min(d,g)))};f.floor=function(){this.x=Math.floor(this.x);this.y=
Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this};f.ceil=function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this};f.round=function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this};f.roundToZero=function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):
Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this};f.negate=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this};f.dot=function(b){return this.x*b.x+this.y*b.y+this.z*b.z+this.w*b.w};f.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w};f.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)};f.manhattanLength=function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+
Math.abs(this.w)};f.normalize=function(){return this.divideScalar(this.length()||1)};f.setLength=function(b){return this.normalize().multiplyScalar(b)};f.lerp=function(b,d){this.x+=(b.x-this.x)*d;this.y+=(b.y-this.y)*d;this.z+=(b.z-this.z)*d;this.w+=(b.w-this.w)*d;return this};f.lerpVectors=function(b,d,g){this.x=b.x+(d.x-b.x)*g;this.y=b.y+(d.y-b.y)*g;this.z=b.z+(d.z-b.z)*g;this.w=b.w+(d.w-b.w)*g;return this};f.equals=function(b){return b.x===this.x&&b.y===this.y&&b.z===this.z&&b.w===this.w};f.fromArray=
function(b,d){void 0===d&&(d=0);this.x=b[d];this.y=b[d+1];this.z=b[d+2];this.w=b[d+3];return this};f.toArray=function(b,d){void 0===b&&(b=[]);void 0===d&&(d=0);b[d]=this.x;b[d+1]=this.y;b[d+2]=this.z;b[d+3]=this.w;return b};f.fromBufferAttribute=function(b,d,g){void 0!==g&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute().");this.x=b.getX(d);this.y=b.getY(d);this.z=b.getZ(d);this.w=b.getW(d);return this};f.random=function(){this.x=Math.random();this.y=Math.random();
this.z=Math.random();this.w=Math.random();return this};t(c,[{key:"width",get:function(){return this.z},set:function(b){this.z=b}},{key:"height",get:function(){return this.w},set:function(b){this.w=b}}]);return c}(),pe=function(c){function f(d,g,l){var r=c.call(this)||this;Object.defineProperty(C(r),"isWebGLRenderTarget",{value:!0});r.width=d;r.height=g;r.scissor=new qc(0,0,d,g);r.scissorTest=!1;r.viewport=new qc(0,0,d,g);l=l||{};r.texture=new R(void 0,l.mapping,l.wrapS,l.wrapT,l.magFilter,l.minFilter,
l.format,l.type,l.anisotropy,l.encoding);r.texture.image={};r.texture.image.width=d;r.texture.image.height=g;r.texture.generateMipmaps=void 0!==l.generateMipmaps?l.generateMipmaps:!1;r.texture.minFilter=void 0!==l.minFilter?l.minFilter:1006;r.depthBuffer=void 0!==l.depthBuffer?l.depthBuffer:!0;r.stencilBuffer=void 0!==l.stencilBuffer?l.stencilBuffer:!1;r.depthTexture=void 0!==l.depthTexture?l.depthTexture:null;return r}y(f,c);var b=f.prototype;b.setSize=function(d,g){if(this.width!==d||this.height!==
g)this.width=d,this.height=g,this.texture.image.width=d,this.texture.image.height=g,this.dispose();this.viewport.set(0,0,d,g);this.scissor.set(0,0,d,g)};b.clone=function(){return(new this.constructor).copy(this)};b.copy=function(d){this.width=d.width;this.height=d.height;this.viewport.copy(d.viewport);this.texture=d.texture.clone();this.depthBuffer=d.depthBuffer;this.stencilBuffer=d.stencilBuffer;this.depthTexture=d.depthTexture;return this};b.dispose=function(){this.dispatchEvent({type:"dispose"})};
return f}(O),nl=function(c){function f(b,d,g){b=c.call(this,b,d,g)||this;Object.defineProperty(C(b),"isWebGLMultisampleRenderTarget",{value:!0});b.samples=4;return b}y(f,c);f.prototype.copy=function(b){c.prototype.copy.call(this,b);this.samples=b.samples;return this};return f}(pe),Oc=function(){function c(b,d,g,l){void 0===b&&(b=0);void 0===d&&(d=0);void 0===g&&(g=0);void 0===l&&(l=1);Object.defineProperty(this,"isQuaternion",{value:!0});this._x=b;this._y=d;this._z=g;this._w=l}c.slerp=function(b,
d,g,l){return g.copy(b).slerp(d,l)};c.slerpFlat=function(b,d,g,l,r,v,x){var w=g[l+0],A=g[l+1],D=g[l+2];g=g[l+3];l=r[v+0];var J=r[v+1],N=r[v+2];r=r[v+3];if(g!==r||w!==l||A!==J||D!==N){v=1-x;var L=w*l+A*J+D*N+g*r,S=0<=L?1:-1,P=1-L*L;P>Number.EPSILON&&(P=Math.sqrt(P),L=Math.atan2(P,L*S),v=Math.sin(v*L)/P,x=Math.sin(x*L)/P);S*=x;w=w*v+l*S;A=A*v+J*S;D=D*v+N*S;g=g*v+r*S;v===1-x&&(x=1/Math.sqrt(w*w+A*A+D*D+g*g),w*=x,A*=x,D*=x,g*=x)}b[d]=w;b[d+1]=A;b[d+2]=D;b[d+3]=g};c.multiplyQuaternionsFlat=function(b,
d,g,l,r,v){var x=g[l],w=g[l+1],A=g[l+2];g=g[l+3];l=r[v];var D=r[v+1],J=r[v+2];r=r[v+3];b[d]=x*r+g*l+w*J-A*D;b[d+1]=w*r+g*D+A*l-x*J;b[d+2]=A*r+g*J+x*D-w*l;b[d+3]=g*r-x*l-w*D-A*J;return b};var f=c.prototype;f.set=function(b,d,g,l){this._x=b;this._y=d;this._z=g;this._w=l;this._onChangeCallback();return this};f.clone=function(){return new this.constructor(this._x,this._y,this._z,this._w)};f.copy=function(b){this._x=b.x;this._y=b.y;this._z=b.z;this._w=b.w;this._onChangeCallback();return this};f.setFromEuler=
function(b,d){if(!b||!b.isEuler)throw Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var g=b._x,l=b._y,r=b._z;b=b._order;var v=Math.cos,x=Math.sin,w=v(g/2),A=v(l/2);v=v(r/2);g=x(g/2);l=x(l/2);r=x(r/2);switch(b){case "XYZ":this._x=g*A*v+w*l*r;this._y=w*l*v-g*A*r;this._z=w*A*r+g*l*v;this._w=w*A*v-g*l*r;break;case "YXZ":this._x=g*A*v+w*l*r;this._y=w*l*v-g*A*r;this._z=w*A*r-g*l*v;this._w=w*A*v+g*l*r;break;case "ZXY":this._x=g*A*v-w*l*r;this._y=
w*l*v+g*A*r;this._z=w*A*r+g*l*v;this._w=w*A*v-g*l*r;break;case "ZYX":this._x=g*A*v-w*l*r;this._y=w*l*v+g*A*r;this._z=w*A*r-g*l*v;this._w=w*A*v+g*l*r;break;case "YZX":this._x=g*A*v+w*l*r;this._y=w*l*v+g*A*r;this._z=w*A*r-g*l*v;this._w=w*A*v-g*l*r;break;case "XZY":this._x=g*A*v-w*l*r;this._y=w*l*v-g*A*r;this._z=w*A*r+g*l*v;this._w=w*A*v+g*l*r;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+b)}!1!==d&&this._onChangeCallback();return this};f.setFromAxisAngle=
function(b,d){d/=2;var g=Math.sin(d);this._x=b.x*g;this._y=b.y*g;this._z=b.z*g;this._w=Math.cos(d);this._onChangeCallback();return this};f.setFromRotationMatrix=function(b){var d=b.elements,g=d[0];b=d[4];var l=d[8],r=d[1],v=d[5],x=d[9],w=d[2],A=d[6];d=d[10];var D=g+v+d;0<D?(g=.5/Math.sqrt(D+1),this._w=.25/g,this._x=(A-x)*g,this._y=(l-w)*g,this._z=(r-b)*g):g>v&&g>d?(g=2*Math.sqrt(1+g-v-d),this._w=(A-x)/g,this._x=.25*g,this._y=(b+r)/g,this._z=(l+w)/g):v>d?(g=2*Math.sqrt(1+v-g-d),this._w=(l-w)/g,this._x=
(b+r)/g,this._y=.25*g,this._z=(x+A)/g):(g=2*Math.sqrt(1+d-g-v),this._w=(r-b)/g,this._x=(l+w)/g,this._y=(x+A)/g,this._z=.25*g);this._onChangeCallback();return this};f.setFromUnitVectors=function(b,d){var g=b.dot(d)+1;1E-6>g?(g=0,Math.abs(b.x)>Math.abs(b.z)?(this._x=-b.y,this._y=b.x,this._z=0):(this._x=0,this._y=-b.z,this._z=b.y)):(this._x=b.y*d.z-b.z*d.y,this._y=b.z*d.x-b.x*d.z,this._z=b.x*d.y-b.y*d.x);this._w=g;return this.normalize()};f.angleTo=function(b){return 2*Math.acos(Math.abs(Qb.clamp(this.dot(b),
-1,1)))};f.rotateTowards=function(b,d){var g=this.angleTo(b);if(0===g)return this;this.slerp(b,Math.min(1,d/g));return this};f.identity=function(){return this.set(0,0,0,1)};f.invert=function(){return this.conjugate()};f.conjugate=function(){this._x*=-1;this._y*=-1;this._z*=-1;this._onChangeCallback();return this};f.dot=function(b){return this._x*b._x+this._y*b._y+this._z*b._z+this._w*b._w};f.lengthSq=function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w};f.length=function(){return Math.sqrt(this._x*
this._x+this._y*this._y+this._z*this._z+this._w*this._w)};f.normalize=function(){var b=this.length();0===b?(this._z=this._y=this._x=0,this._w=1):(b=1/b,this._x*=b,this._y*=b,this._z*=b,this._w*=b);this._onChangeCallback();return this};f.multiply=function(b,d){return void 0!==d?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(b,d)):this.multiplyQuaternions(this,b)};f.premultiply=function(b){return this.multiplyQuaternions(b,
this)};f.multiplyQuaternions=function(b,d){var g=b._x,l=b._y,r=b._z;b=b._w;var v=d._x,x=d._y,w=d._z;d=d._w;this._x=g*d+b*v+l*w-r*x;this._y=l*d+b*x+r*v-g*w;this._z=r*d+b*w+g*x-l*v;this._w=b*d-g*v-l*x-r*w;this._onChangeCallback();return this};f.slerp=function(b,d){if(0===d)return this;if(1===d)return this.copy(b);var g=this._x,l=this._y,r=this._z,v=this._w,x=v*b._w+g*b._x+l*b._y+r*b._z;0>x?(this._w=-b._w,this._x=-b._x,this._y=-b._y,this._z=-b._z,x=-x):this.copy(b);if(1<=x)return this._w=v,this._x=g,
this._y=l,this._z=r,this;b=1-x*x;if(b<=Number.EPSILON)return x=1-d,this._w=x*v+d*this._w,this._x=x*g+d*this._x,this._y=x*l+d*this._y,this._z=x*r+d*this._z,this.normalize(),this._onChangeCallback(),this;b=Math.sqrt(b);var w=Math.atan2(b,x);x=Math.sin((1-d)*w)/b;d=Math.sin(d*w)/b;this._w=v*x+this._w*d;this._x=g*x+this._x*d;this._y=l*x+this._y*d;this._z=r*x+this._z*d;this._onChangeCallback();return this};f.equals=function(b){return b._x===this._x&&b._y===this._y&&b._z===this._z&&b._w===this._w};f.fromArray=
function(b,d){void 0===d&&(d=0);this._x=b[d];this._y=b[d+1];this._z=b[d+2];this._w=b[d+3];this._onChangeCallback();return this};f.toArray=function(b,d){void 0===b&&(b=[]);void 0===d&&(d=0);b[d]=this._x;b[d+1]=this._y;b[d+2]=this._z;b[d+3]=this._w;return b};f.fromBufferAttribute=function(b,d){this._x=b.getX(d);this._y=b.getY(d);this._z=b.getZ(d);this._w=b.getW(d);return this};f._onChange=function(b){this._onChangeCallback=b;return this};f._onChangeCallback=function(){};t(c,[{key:"x",get:function(){return this._x},
set:function(b){this._x=b;this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(b){this._y=b;this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(b){this._z=b;this._onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(b){this._w=b;this._onChangeCallback()}}]);return c}(),da=function(){function c(b,d,g){void 0===b&&(b=0);void 0===d&&(d=0);void 0===g&&(g=0);Object.defineProperty(this,"isVector3",{value:!0});this.x=b;this.y=d;
this.z=g}var f=c.prototype;f.set=function(b,d,g){void 0===g&&(g=this.z);this.x=b;this.y=d;this.z=g;return this};f.setScalar=function(b){this.z=this.y=this.x=b;return this};f.setX=function(b){this.x=b;return this};f.setY=function(b){this.y=b;return this};f.setZ=function(b){this.z=b;return this};f.setComponent=function(b,d){switch(b){case 0:this.x=d;break;case 1:this.y=d;break;case 2:this.z=d;break;default:throw Error("index is out of range: "+b);}return this};f.getComponent=function(b){switch(b){case 0:return this.x;
case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+b);}};f.clone=function(){return new this.constructor(this.x,this.y,this.z)};f.copy=function(b){this.x=b.x;this.y=b.y;this.z=b.z;return this};f.add=function(b,d){if(void 0!==d)return console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(b,d);this.x+=b.x;this.y+=b.y;this.z+=b.z;return this};f.addScalar=function(b){this.x+=b;this.y+=b;this.z+=b;return this};
f.addVectors=function(b,d){this.x=b.x+d.x;this.y=b.y+d.y;this.z=b.z+d.z;return this};f.addScaledVector=function(b,d){this.x+=b.x*d;this.y+=b.y*d;this.z+=b.z*d;return this};f.sub=function(b,d){if(void 0!==d)return console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(b,d);this.x-=b.x;this.y-=b.y;this.z-=b.z;return this};f.subScalar=function(b){this.x-=b;this.y-=b;this.z-=b;return this};f.subVectors=function(b,d){this.x=b.x-d.x;this.y=
b.y-d.y;this.z=b.z-d.z;return this};f.multiply=function(b,d){if(void 0!==d)return console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(b,d);this.x*=b.x;this.y*=b.y;this.z*=b.z;return this};f.multiplyScalar=function(b){this.x*=b;this.y*=b;this.z*=b;return this};f.multiplyVectors=function(b,d){this.x=b.x*d.x;this.y=b.y*d.y;this.z=b.z*d.z;return this};f.applyEuler=function(b){b&&b.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.");
return this.applyQuaternion(Zj.setFromEuler(b))};f.applyAxisAngle=function(b,d){return this.applyQuaternion(Zj.setFromAxisAngle(b,d))};f.applyMatrix3=function(b){var d=this.x,g=this.y,l=this.z;b=b.elements;this.x=b[0]*d+b[3]*g+b[6]*l;this.y=b[1]*d+b[4]*g+b[7]*l;this.z=b[2]*d+b[5]*g+b[8]*l;return this};f.applyNormalMatrix=function(b){return this.applyMatrix3(b).normalize()};f.applyMatrix4=function(b){var d=this.x,g=this.y,l=this.z;b=b.elements;var r=1/(b[3]*d+b[7]*g+b[11]*l+b[15]);this.x=(b[0]*d+b[4]*
g+b[8]*l+b[12])*r;this.y=(b[1]*d+b[5]*g+b[9]*l+b[13])*r;this.z=(b[2]*d+b[6]*g+b[10]*l+b[14])*r;return this};f.applyQuaternion=function(b){var d=this.x,g=this.y,l=this.z,r=b.x,v=b.y,x=b.z;b=b.w;var w=b*d+v*l-x*g,A=b*g+x*d-r*l,D=b*l+r*g-v*d;d=-r*d-v*g-x*l;this.x=w*b+d*-r+A*-x-D*-v;this.y=A*b+d*-v+D*-r-w*-x;this.z=D*b+d*-x+w*-v-A*-r;return this};f.project=function(b){return this.applyMatrix4(b.matrixWorldInverse).applyMatrix4(b.projectionMatrix)};f.unproject=function(b){return this.applyMatrix4(b.projectionMatrixInverse).applyMatrix4(b.matrixWorld)};
f.transformDirection=function(b){var d=this.x,g=this.y,l=this.z;b=b.elements;this.x=b[0]*d+b[4]*g+b[8]*l;this.y=b[1]*d+b[5]*g+b[9]*l;this.z=b[2]*d+b[6]*g+b[10]*l;return this.normalize()};f.divide=function(b){this.x/=b.x;this.y/=b.y;this.z/=b.z;return this};f.divideScalar=function(b){return this.multiplyScalar(1/b)};f.min=function(b){this.x=Math.min(this.x,b.x);this.y=Math.min(this.y,b.y);this.z=Math.min(this.z,b.z);return this};f.max=function(b){this.x=Math.max(this.x,b.x);this.y=Math.max(this.y,
b.y);this.z=Math.max(this.z,b.z);return this};f.clamp=function(b,d){this.x=Math.max(b.x,Math.min(d.x,this.x));this.y=Math.max(b.y,Math.min(d.y,this.y));this.z=Math.max(b.z,Math.min(d.z,this.z));return this};f.clampScalar=function(b,d){this.x=Math.max(b,Math.min(d,this.x));this.y=Math.max(b,Math.min(d,this.y));this.z=Math.max(b,Math.min(d,this.z));return this};f.clampLength=function(b,d){var g=this.length();return this.divideScalar(g||1).multiplyScalar(Math.max(b,Math.min(d,g)))};f.floor=function(){this.x=
Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this};f.ceil=function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this};f.round=function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this};f.roundToZero=function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);return this};f.negate=
function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this};f.dot=function(b){return this.x*b.x+this.y*b.y+this.z*b.z};f.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z};f.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};f.manhattanLength=function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)};f.normalize=function(){return this.divideScalar(this.length()||1)};f.setLength=function(b){return this.normalize().multiplyScalar(b)};
f.lerp=function(b,d){this.x+=(b.x-this.x)*d;this.y+=(b.y-this.y)*d;this.z+=(b.z-this.z)*d;return this};f.lerpVectors=function(b,d,g){this.x=b.x+(d.x-b.x)*g;this.y=b.y+(d.y-b.y)*g;this.z=b.z+(d.z-b.z)*g;return this};f.cross=function(b,d){return void 0!==d?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(b,d)):this.crossVectors(this,b)};f.crossVectors=function(b,d){var g=b.x,l=b.y;b=b.z;var r=d.x,v=d.y;d=d.z;this.x=l*d-b*v;
this.y=b*r-g*d;this.z=g*v-l*r;return this};f.projectOnVector=function(b){var d=b.lengthSq();if(0===d)return this.set(0,0,0);d=b.dot(this)/d;return this.copy(b).multiplyScalar(d)};f.projectOnPlane=function(b){Ri.copy(this).projectOnVector(b);return this.sub(Ri)};f.reflect=function(b){return this.sub(Ri.copy(b).multiplyScalar(2*this.dot(b)))};f.angleTo=function(b){var d=Math.sqrt(this.lengthSq()*b.lengthSq());if(0===d)return Math.PI/2;b=this.dot(b)/d;return Math.acos(Qb.clamp(b,-1,1))};f.distanceTo=
function(b){return Math.sqrt(this.distanceToSquared(b))};f.distanceToSquared=function(b){var d=this.x-b.x,g=this.y-b.y;b=this.z-b.z;return d*d+g*g+b*b};f.manhattanDistanceTo=function(b){return Math.abs(this.x-b.x)+Math.abs(this.y-b.y)+Math.abs(this.z-b.z)};f.setFromSpherical=function(b){return this.setFromSphericalCoords(b.radius,b.phi,b.theta)};f.setFromSphericalCoords=function(b,d,g){var l=Math.sin(d)*b;this.x=l*Math.sin(g);this.y=Math.cos(d)*b;this.z=l*Math.cos(g);return this};f.setFromCylindrical=
function(b){return this.setFromCylindricalCoords(b.radius,b.theta,b.y)};f.setFromCylindricalCoords=function(b,d,g){this.x=b*Math.sin(d);this.y=g;this.z=b*Math.cos(d);return this};f.setFromMatrixPosition=function(b){b=b.elements;this.x=b[12];this.y=b[13];this.z=b[14];return this};f.setFromMatrixScale=function(b){var d=this.setFromMatrixColumn(b,0).length(),g=this.setFromMatrixColumn(b,1).length();b=this.setFromMatrixColumn(b,2).length();this.x=d;this.y=g;this.z=b;return this};f.setFromMatrixColumn=
function(b,d){return this.fromArray(b.elements,4*d)};f.setFromMatrix3Column=function(b,d){return this.fromArray(b.elements,3*d)};f.equals=function(b){return b.x===this.x&&b.y===this.y&&b.z===this.z};f.fromArray=function(b,d){void 0===d&&(d=0);this.x=b[d];this.y=b[d+1];this.z=b[d+2];return this};f.toArray=function(b,d){void 0===b&&(b=[]);void 0===d&&(d=0);b[d]=this.x;b[d+1]=this.y;b[d+2]=this.z;return b};f.fromBufferAttribute=function(b,d,g){void 0!==g&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute().");
this.x=b.getX(d);this.y=b.getY(d);this.z=b.getZ(d);return this};f.random=function(){this.x=Math.random();this.y=Math.random();this.z=Math.random();return this};return c}(),Ri=new da,Zj=new Oc,be=function(){function c(b,d){Object.defineProperty(this,"isBox3",{value:!0});this.min=void 0!==b?b:new da(Infinity,Infinity,Infinity);this.max=void 0!==d?d:new da(-Infinity,-Infinity,-Infinity)}var f=c.prototype;f.set=function(b,d){this.min.copy(b);this.max.copy(d);return this};f.setFromArray=function(b){for(var d=
Infinity,g=Infinity,l=Infinity,r=-Infinity,v=-Infinity,x=-Infinity,w=0,A=b.length;w<A;w+=3){var D=b[w],J=b[w+1],N=b[w+2];D<d&&(d=D);J<g&&(g=J);N<l&&(l=N);D>r&&(r=D);J>v&&(v=J);N>x&&(x=N)}this.min.set(d,g,l);this.max.set(r,v,x);return this};f.setFromBufferAttribute=function(b){for(var d=Infinity,g=Infinity,l=Infinity,r=-Infinity,v=-Infinity,x=-Infinity,w=0,A=b.count;w<A;w++){var D=b.getX(w),J=b.getY(w),N=b.getZ(w);D<d&&(d=D);J<g&&(g=J);N<l&&(l=N);D>r&&(r=D);J>v&&(v=J);N>x&&(x=N)}this.min.set(d,g,l);
this.max.set(r,v,x);return this};f.setFromPoints=function(b){this.makeEmpty();for(var d=0,g=b.length;d<g;d++)this.expandByPoint(b[d]);return this};f.setFromCenterAndSize=function(b,d){d=ig.copy(d).multiplyScalar(.5);this.min.copy(b).sub(d);this.max.copy(b).add(d);return this};f.setFromObject=function(b){this.makeEmpty();return this.expandByObject(b)};f.clone=function(){return(new this.constructor).copy(this)};f.copy=function(b){this.min.copy(b.min);this.max.copy(b.max);return this};f.makeEmpty=function(){this.min.x=
this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this};f.isEmpty=function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z};f.getCenter=function(b){void 0===b&&(console.warn("THREE.Box3: .getCenter() target is now required"),b=new da);return this.isEmpty()?b.set(0,0,0):b.addVectors(this.min,this.max).multiplyScalar(.5)};f.getSize=function(b){void 0===b&&(console.warn("THREE.Box3: .getSize() target is now required"),b=new da);return this.isEmpty()?
b.set(0,0,0):b.subVectors(this.max,this.min)};f.expandByPoint=function(b){this.min.min(b);this.max.max(b);return this};f.expandByVector=function(b){this.min.sub(b);this.max.add(b);return this};f.expandByScalar=function(b){this.min.addScalar(-b);this.max.addScalar(b);return this};f.expandByObject=function(b){b.updateWorldMatrix(!1,!1);var d=b.geometry;void 0!==d&&(null===d.boundingBox&&d.computeBoundingBox(),Si.copy(d.boundingBox),Si.applyMatrix4(b.matrixWorld),this.union(Si));b=b.children;d=0;for(var g=
b.length;d<g;d++)this.expandByObject(b[d]);return this};f.containsPoint=function(b){return b.x<this.min.x||b.x>this.max.x||b.y<this.min.y||b.y>this.max.y||b.z<this.min.z||b.z>this.max.z?!1:!0};f.containsBox=function(b){return this.min.x<=b.min.x&&b.max.x<=this.max.x&&this.min.y<=b.min.y&&b.max.y<=this.max.y&&this.min.z<=b.min.z&&b.max.z<=this.max.z};f.getParameter=function(b,d){void 0===d&&(console.warn("THREE.Box3: .getParameter() target is now required"),d=new da);return d.set((b.x-this.min.x)/
(this.max.x-this.min.x),(b.y-this.min.y)/(this.max.y-this.min.y),(b.z-this.min.z)/(this.max.z-this.min.z))};f.intersectsBox=function(b){return b.max.x<this.min.x||b.min.x>this.max.x||b.max.y<this.min.y||b.min.y>this.max.y||b.max.z<this.min.z||b.min.z>this.max.z?!1:!0};f.intersectsSphere=function(b){this.clampPoint(b.center,ig);return ig.distanceToSquared(b.center)<=b.radius*b.radius};f.intersectsPlane=function(b){if(0<b.normal.x){var d=b.normal.x*this.min.x;var g=b.normal.x*this.max.x}else d=b.normal.x*
this.max.x,g=b.normal.x*this.min.x;0<b.normal.y?(d+=b.normal.y*this.min.y,g+=b.normal.y*this.max.y):(d+=b.normal.y*this.max.y,g+=b.normal.y*this.min.y);0<b.normal.z?(d+=b.normal.z*this.min.z,g+=b.normal.z*this.max.z):(d+=b.normal.z*this.max.z,g+=b.normal.z*this.min.z);return d<=-b.constant&&g>=-b.constant};f.intersectsTriangle=function(b){if(this.isEmpty())return!1;this.getCenter(jg);mh.subVectors(this.max,jg);Bf.subVectors(b.a,jg);Cf.subVectors(b.b,jg);Df.subVectors(b.c,jg);ze.subVectors(Cf,Bf);
Ae.subVectors(Df,Cf);af.subVectors(Bf,Df);b=[0,-ze.z,ze.y,0,-Ae.z,Ae.y,0,-af.z,af.y,ze.z,0,-ze.x,Ae.z,0,-Ae.x,af.z,0,-af.x,-ze.y,ze.x,0,-Ae.y,Ae.x,0,-af.y,af.x,0];if(!ea(b,Bf,Cf,Df,mh))return!1;b=[1,0,0,0,1,0,0,0,1];if(!ea(b,Bf,Cf,Df,mh))return!1;nh.crossVectors(ze,Ae);b=[nh.x,nh.y,nh.z];return ea(b,Bf,Cf,Df,mh)};f.clampPoint=function(b,d){void 0===d&&(console.warn("THREE.Box3: .clampPoint() target is now required"),d=new da);return d.copy(b).clamp(this.min,this.max)};f.distanceToPoint=function(b){return ig.copy(b).clamp(this.min,
this.max).sub(b).length()};f.getBoundingSphere=function(b){void 0===b&&console.error("THREE.Box3: .getBoundingSphere() target is now required");this.getCenter(b.center);b.radius=.5*this.getSize(ig).length();return b};f.intersect=function(b){this.min.max(b.min);this.max.min(b.max);this.isEmpty()&&this.makeEmpty();return this};f.union=function(b){this.min.min(b.min);this.max.max(b.max);return this};f.applyMatrix4=function(b){if(this.isEmpty())return this;ae[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(b);
ae[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(b);ae[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(b);ae[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(b);ae[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(b);ae[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(b);ae[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(b);ae[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(b);this.setFromPoints(ae);return this};f.translate=function(b){this.min.add(b);this.max.add(b);
return this};f.equals=function(b){return b.min.equals(this.min)&&b.max.equals(this.max)};return c}(),ae=[new da,new da,new da,new da,new da,new da,new da,new da],ig=new da,Si=new be,Bf=new da,Cf=new da,Df=new da,ze=new da,Ae=new da,af=new da,jg=new da,mh=new da,nh=new da,He=new da,ol=new be,Be=function(){function c(b,d){this.center=void 0!==b?b:new da;this.radius=void 0!==d?d:-1}var f=c.prototype;f.set=function(b,d){this.center.copy(b);this.radius=d;return this};f.setFromPoints=function(b,d){var g=
this.center;void 0!==d?g.copy(d):ol.setFromPoints(b).getCenter(g);for(var l=d=0,r=b.length;l<r;l++)d=Math.max(d,g.distanceToSquared(b[l]));this.radius=Math.sqrt(d);return this};f.clone=function(){return(new this.constructor).copy(this)};f.copy=function(b){this.center.copy(b.center);this.radius=b.radius;return this};f.isEmpty=function(){return 0>this.radius};f.makeEmpty=function(){this.center.set(0,0,0);this.radius=-1;return this};f.containsPoint=function(b){return b.distanceToSquared(this.center)<=
this.radius*this.radius};f.distanceToPoint=function(b){return b.distanceTo(this.center)-this.radius};f.intersectsSphere=function(b){var d=this.radius+b.radius;return b.center.distanceToSquared(this.center)<=d*d};f.intersectsBox=function(b){return b.intersectsSphere(this)};f.intersectsPlane=function(b){return Math.abs(b.distanceToPoint(this.center))<=this.radius};f.clampPoint=function(b,d){var g=this.center.distanceToSquared(b);void 0===d&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),
d=new da);d.copy(b);g>this.radius*this.radius&&(d.sub(this.center).normalize(),d.multiplyScalar(this.radius).add(this.center));return d};f.getBoundingBox=function(b){void 0===b&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),b=new be);if(this.isEmpty())return b.makeEmpty(),b;b.set(this.center,this.center);b.expandByScalar(this.radius);return b};f.applyMatrix4=function(b){this.center.applyMatrix4(b);this.radius*=b.getMaxScaleOnAxis();return this};f.translate=function(b){this.center.add(b);
return this};f.equals=function(b){return b.center.equals(this.center)&&b.radius===this.radius};return c}(),ce=new da,Ti=new da,oh=new da,Ce=new da,Ui=new da,ph=new da,Vi=new da,zf=function(){function c(b,d){this.origin=void 0!==b?b:new da;this.direction=void 0!==d?d:new da(0,0,-1)}var f=c.prototype;f.set=function(b,d){this.origin.copy(b);this.direction.copy(d);return this};f.clone=function(){return(new this.constructor).copy(this)};f.copy=function(b){this.origin.copy(b.origin);this.direction.copy(b.direction);
return this};f.at=function(b,d){void 0===d&&(console.warn("THREE.Ray: .at() target is now required"),d=new da);return d.copy(this.direction).multiplyScalar(b).add(this.origin)};f.lookAt=function(b){this.direction.copy(b).sub(this.origin).normalize();return this};f.recast=function(b){this.origin.copy(this.at(b,ce));return this};f.closestPointToPoint=function(b,d){void 0===d&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),d=new da);d.subVectors(b,this.origin);b=d.dot(this.direction);
return 0>b?d.copy(this.origin):d.copy(this.direction).multiplyScalar(b).add(this.origin)};f.distanceToPoint=function(b){return Math.sqrt(this.distanceSqToPoint(b))};f.distanceSqToPoint=function(b){var d=ce.subVectors(b,this.origin).dot(this.direction);if(0>d)return this.origin.distanceToSquared(b);ce.copy(this.direction).multiplyScalar(d).add(this.origin);return ce.distanceToSquared(b)};f.distanceSqToSegment=function(b,d,g,l){Ti.copy(b).add(d).multiplyScalar(.5);oh.copy(d).sub(b).normalize();Ce.copy(this.origin).sub(Ti);
var r=.5*b.distanceTo(d),v=-this.direction.dot(oh),x=Ce.dot(this.direction),w=-Ce.dot(oh),A=Ce.lengthSq(),D=Math.abs(1-v*v);if(0<D){b=v*w-x;d=v*x-w;var J=r*D;0<=b?d>=-J?d<=J?(r=1/D,b*=r,d*=r,v=b*(b+v*d+2*x)+d*(v*b+d+2*w)+A):(d=r,b=Math.max(0,-(v*d+x)),v=-b*b+d*(d+2*w)+A):(d=-r,b=Math.max(0,-(v*d+x)),v=-b*b+d*(d+2*w)+A):d<=-J?(b=Math.max(0,-(-v*r+x)),d=0<b?-r:Math.min(Math.max(-r,-w),r),v=-b*b+d*(d+2*w)+A):d<=J?(b=0,d=Math.min(Math.max(-r,-w),r),v=d*(d+2*w)+A):(b=Math.max(0,-(v*r+x)),d=0<b?r:Math.min(Math.max(-r,
-w),r),v=-b*b+d*(d+2*w)+A)}else d=0<v?-r:r,b=Math.max(0,-(v*d+x)),v=-b*b+d*(d+2*w)+A;g&&g.copy(this.direction).multiplyScalar(b).add(this.origin);l&&l.copy(oh).multiplyScalar(d).add(Ti);return v};f.intersectSphere=function(b,d){ce.subVectors(b.center,this.origin);var g=ce.dot(this.direction),l=ce.dot(ce)-g*g;b=b.radius*b.radius;if(l>b)return null;b=Math.sqrt(b-l);l=g-b;g+=b;return 0>l&&0>g?null:0>l?this.at(g,d):this.at(l,d)};f.intersectsSphere=function(b){return this.distanceSqToPoint(b.center)<=
b.radius*b.radius};f.distanceToPlane=function(b){var d=b.normal.dot(this.direction);if(0===d)return 0===b.distanceToPoint(this.origin)?0:null;b=-(this.origin.dot(b.normal)+b.constant)/d;return 0<=b?b:null};f.intersectPlane=function(b,d){b=this.distanceToPlane(b);return null===b?null:this.at(b,d)};f.intersectsPlane=function(b){var d=b.distanceToPoint(this.origin);return 0===d||0>b.normal.dot(this.direction)*d?!0:!1};f.intersectBox=function(b,d){var g=1/this.direction.x;var l=1/this.direction.y;var r=
1/this.direction.z,v=this.origin;if(0<=g){var x=(b.min.x-v.x)*g;g*=b.max.x-v.x}else x=(b.max.x-v.x)*g,g*=b.min.x-v.x;if(0<=l){var w=(b.min.y-v.y)*l;l*=b.max.y-v.y}else w=(b.max.y-v.y)*l,l*=b.min.y-v.y;if(x>l||w>g)return null;if(w>x||x!==x)x=w;if(l<g||g!==g)g=l;0<=r?(w=(b.min.z-v.z)*r,b=(b.max.z-v.z)*r):(w=(b.max.z-v.z)*r,b=(b.min.z-v.z)*r);if(x>b||w>g)return null;if(w>x||x!==x)x=w;if(b<g||g!==g)g=b;return 0>g?null:this.at(0<=x?x:g,d)};f.intersectsBox=function(b){return null!==this.intersectBox(b,
ce)};f.intersectTriangle=function(b,d,g,l,r){Ui.subVectors(d,b);ph.subVectors(g,b);Vi.crossVectors(Ui,ph);d=this.direction.dot(Vi);if(0<d){if(l)return null;l=1}else if(0>d)l=-1,d=-d;else return null;Ce.subVectors(this.origin,b);b=l*this.direction.dot(ph.crossVectors(Ce,ph));if(0>b)return null;g=l*this.direction.dot(Ui.cross(Ce));if(0>g||b+g>d)return null;b=-l*Ce.dot(Vi);return 0>b?null:this.at(b/d,r)};f.applyMatrix4=function(b){this.origin.applyMatrix4(b);this.direction.transformDirection(b);return this};
f.equals=function(b){return b.origin.equals(this.origin)&&b.direction.equals(this.direction)};return c}(),ec=function(){function c(){Object.defineProperty(this,"isMatrix4",{value:!0});this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}var f=c.prototype;f.set=function(b,d,g,l,r,v,x,w,A,D,J,N,L,S,P,ka){var ia=this.elements;ia[0]=b;ia[4]=d;ia[8]=g;ia[12]=l;ia[1]=r;ia[5]=v;ia[9]=x;ia[13]=w;
ia[2]=A;ia[6]=D;ia[10]=J;ia[14]=N;ia[3]=L;ia[7]=S;ia[11]=P;ia[15]=ka;return this};f.identity=function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this};f.clone=function(){return(new c).fromArray(this.elements)};f.copy=function(b){var d=this.elements;b=b.elements;d[0]=b[0];d[1]=b[1];d[2]=b[2];d[3]=b[3];d[4]=b[4];d[5]=b[5];d[6]=b[6];d[7]=b[7];d[8]=b[8];d[9]=b[9];d[10]=b[10];d[11]=b[11];d[12]=b[12];d[13]=b[13];d[14]=b[14];d[15]=b[15];return this};f.copyPosition=function(b){var d=this.elements;
b=b.elements;d[12]=b[12];d[13]=b[13];d[14]=b[14];return this};f.setFromMatrix3=function(b){b=b.elements;this.set(b[0],b[3],b[6],0,b[1],b[4],b[7],0,b[2],b[5],b[8],0,0,0,0,1);return this};f.extractBasis=function(b,d,g){b.setFromMatrixColumn(this,0);d.setFromMatrixColumn(this,1);g.setFromMatrixColumn(this,2);return this};f.makeBasis=function(b,d,g){this.set(b.x,d.x,g.x,0,b.y,d.y,g.y,0,b.z,d.z,g.z,0,0,0,0,1);return this};f.extractRotation=function(b){var d=this.elements,g=b.elements,l=1/Ef.setFromMatrixColumn(b,
0).length(),r=1/Ef.setFromMatrixColumn(b,1).length();b=1/Ef.setFromMatrixColumn(b,2).length();d[0]=g[0]*l;d[1]=g[1]*l;d[2]=g[2]*l;d[3]=0;d[4]=g[4]*r;d[5]=g[5]*r;d[6]=g[6]*r;d[7]=0;d[8]=g[8]*b;d[9]=g[9]*b;d[10]=g[10]*b;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return this};f.makeRotationFromEuler=function(b){b&&b.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var d=this.elements,g=b.x,l=b.y,r=b.z,v=Math.cos(g);g=Math.sin(g);
var x=Math.cos(l);l=Math.sin(l);var w=Math.cos(r);r=Math.sin(r);if("XYZ"===b.order){b=v*w;var A=v*r,D=g*w,J=g*r;d[0]=x*w;d[4]=-x*r;d[8]=l;d[1]=A+D*l;d[5]=b-J*l;d[9]=-g*x;d[2]=J-b*l;d[6]=D+A*l;d[10]=v*x}else"YXZ"===b.order?(b=x*w,A=x*r,D=l*w,J=l*r,d[0]=b+J*g,d[4]=D*g-A,d[8]=v*l,d[1]=v*r,d[5]=v*w,d[9]=-g,d[2]=A*g-D,d[6]=J+b*g,d[10]=v*x):"ZXY"===b.order?(b=x*w,A=x*r,D=l*w,J=l*r,d[0]=b-J*g,d[4]=-v*r,d[8]=D+A*g,d[1]=A+D*g,d[5]=v*w,d[9]=J-b*g,d[2]=-v*l,d[6]=g,d[10]=v*x):"ZYX"===b.order?(b=v*w,A=v*r,D=g*
w,J=g*r,d[0]=x*w,d[4]=D*l-A,d[8]=b*l+J,d[1]=x*r,d[5]=J*l+b,d[9]=A*l-D,d[2]=-l,d[6]=g*x,d[10]=v*x):"YZX"===b.order?(b=v*x,A=v*l,D=g*x,J=g*l,d[0]=x*w,d[4]=J-b*r,d[8]=D*r+A,d[1]=r,d[5]=v*w,d[9]=-g*w,d[2]=-l*w,d[6]=A*r+D,d[10]=b-J*r):"XZY"===b.order&&(b=v*x,A=v*l,D=g*x,J=g*l,d[0]=x*w,d[4]=-r,d[8]=l*w,d[1]=b*r+J,d[5]=v*w,d[9]=A*r-D,d[2]=D*r-A,d[6]=g*w,d[10]=J*r+b);d[3]=0;d[7]=0;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return this};f.makeRotationFromQuaternion=function(b){return this.compose(pl,b,ql)};f.lookAt=
function(b,d,g){var l=this.elements;Wc.subVectors(b,d);0===Wc.lengthSq()&&(Wc.z=1);Wc.normalize();De.crossVectors(g,Wc);0===De.lengthSq()&&(1===Math.abs(g.z)?Wc.x+=1E-4:Wc.z+=1E-4,Wc.normalize(),De.crossVectors(g,Wc));De.normalize();qh.crossVectors(Wc,De);l[0]=De.x;l[4]=qh.x;l[8]=Wc.x;l[1]=De.y;l[5]=qh.y;l[9]=Wc.y;l[2]=De.z;l[6]=qh.z;l[10]=Wc.z;return this};f.multiply=function(b,d){return void 0!==d?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),
this.multiplyMatrices(b,d)):this.multiplyMatrices(this,b)};f.premultiply=function(b){return this.multiplyMatrices(b,this)};f.multiplyMatrices=function(b,d){var g=b.elements,l=d.elements;d=this.elements;b=g[0];var r=g[4],v=g[8],x=g[12],w=g[1],A=g[5],D=g[9],J=g[13],N=g[2],L=g[6],S=g[10],P=g[14],ka=g[3],ia=g[7],la=g[11];g=g[15];var oa=l[0],Ca=l[4],Aa=l[8],ra=l[12],Ja=l[1],Ra=l[5],xa=l[9],Ga=l[13],Oa=l[2],nb=l[6],Ba=l[10],Ea=l[14],Pa=l[3],qb=l[7],Va=l[11];l=l[15];d[0]=b*oa+r*Ja+v*Oa+x*Pa;d[4]=b*Ca+r*
Ra+v*nb+x*qb;d[8]=b*Aa+r*xa+v*Ba+x*Va;d[12]=b*ra+r*Ga+v*Ea+x*l;d[1]=w*oa+A*Ja+D*Oa+J*Pa;d[5]=w*Ca+A*Ra+D*nb+J*qb;d[9]=w*Aa+A*xa+D*Ba+J*Va;d[13]=w*ra+A*Ga+D*Ea+J*l;d[2]=N*oa+L*Ja+S*Oa+P*Pa;d[6]=N*Ca+L*Ra+S*nb+P*qb;d[10]=N*Aa+L*xa+S*Ba+P*Va;d[14]=N*ra+L*Ga+S*Ea+P*l;d[3]=ka*oa+ia*Ja+la*Oa+g*Pa;d[7]=ka*Ca+ia*Ra+la*nb+g*qb;d[11]=ka*Aa+ia*xa+la*Ba+g*Va;d[15]=ka*ra+ia*Ga+la*Ea+g*l;return this};f.multiplyScalar=function(b){var d=this.elements;d[0]*=b;d[4]*=b;d[8]*=b;d[12]*=b;d[1]*=b;d[5]*=b;d[9]*=b;d[13]*=
b;d[2]*=b;d[6]*=b;d[10]*=b;d[14]*=b;d[3]*=b;d[7]*=b;d[11]*=b;d[15]*=b;return this};f.determinant=function(){var b=this.elements,d=b[0],g=b[4],l=b[8],r=b[12],v=b[1],x=b[5],w=b[9],A=b[13],D=b[2],J=b[6],N=b[10],L=b[14];return b[3]*(+r*w*J-l*A*J-r*x*N+g*A*N+l*x*L-g*w*L)+b[7]*(+d*w*L-d*A*N+r*v*N-l*v*L+l*A*D-r*w*D)+b[11]*(+d*A*J-d*x*L-r*v*J+g*v*L+r*x*D-g*A*D)+b[15]*(-l*x*D-d*w*J+d*x*N+l*v*J-g*v*N+g*w*D)};f.transpose=function(){var b=this.elements;var d=b[1];b[1]=b[4];b[4]=d;d=b[2];b[2]=b[8];b[8]=d;d=b[6];
b[6]=b[9];b[9]=d;d=b[3];b[3]=b[12];b[12]=d;d=b[7];b[7]=b[13];b[13]=d;d=b[11];b[11]=b[14];b[14]=d;return this};f.setPosition=function(b,d,g){var l=this.elements;b.isVector3?(l[12]=b.x,l[13]=b.y,l[14]=b.z):(l[12]=b,l[13]=d,l[14]=g);return this};f.invert=function(){var b=this.elements,d=b[0],g=b[1],l=b[2],r=b[3],v=b[4],x=b[5],w=b[6],A=b[7],D=b[8],J=b[9],N=b[10],L=b[11],S=b[12],P=b[13],ka=b[14],ia=b[15],la=J*ka*A-P*N*A+P*w*L-x*ka*L-J*w*ia+x*N*ia,oa=S*N*A-D*ka*A-S*w*L+v*ka*L+D*w*ia-v*N*ia,Ca=D*P*A-S*J*
A+S*x*L-v*P*L-D*x*ia+v*J*ia,Aa=S*J*w-D*P*w-S*x*N+v*P*N+D*x*ka-v*J*ka,ra=d*la+g*oa+l*Ca+r*Aa;if(0===ra)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);ra=1/ra;b[0]=la*ra;b[1]=(P*N*r-J*ka*r-P*l*L+g*ka*L+J*l*ia-g*N*ia)*ra;b[2]=(x*ka*r-P*w*r+P*l*A-g*ka*A-x*l*ia+g*w*ia)*ra;b[3]=(J*w*r-x*N*r-J*l*A+g*N*A+x*l*L-g*w*L)*ra;b[4]=oa*ra;b[5]=(D*ka*r-S*N*r+S*l*L-d*ka*L-D*l*ia+d*N*ia)*ra;b[6]=(S*w*r-v*ka*r-S*l*A+d*ka*A+v*l*ia-d*w*ia)*ra;b[7]=(v*N*r-D*w*r+D*l*A-d*N*A-v*l*L+d*w*L)*ra;b[8]=Ca*ra;b[9]=(S*J*r-D*P*r-
S*g*L+d*P*L+D*g*ia-d*J*ia)*ra;b[10]=(v*P*r-S*x*r+S*g*A-d*P*A-v*g*ia+d*x*ia)*ra;b[11]=(D*x*r-v*J*r-D*g*A+d*J*A+v*g*L-d*x*L)*ra;b[12]=Aa*ra;b[13]=(D*P*l-S*J*l+S*g*N-d*P*N-D*g*ka+d*J*ka)*ra;b[14]=(S*x*l-v*P*l-S*g*w+d*P*w+v*g*ka-d*x*ka)*ra;b[15]=(v*J*l-D*x*l+D*g*w-d*J*w-v*g*N+d*x*N)*ra;return this};f.scale=function(b){var d=this.elements,g=b.x,l=b.y;b=b.z;d[0]*=g;d[4]*=l;d[8]*=b;d[1]*=g;d[5]*=l;d[9]*=b;d[2]*=g;d[6]*=l;d[10]*=b;d[3]*=g;d[7]*=l;d[11]*=b;return this};f.getMaxScaleOnAxis=function(){var b=
this.elements;return Math.sqrt(Math.max(b[0]*b[0]+b[1]*b[1]+b[2]*b[2],b[4]*b[4]+b[5]*b[5]+b[6]*b[6],b[8]*b[8]+b[9]*b[9]+b[10]*b[10]))};f.makeTranslation=function(b,d,g){this.set(1,0,0,b,0,1,0,d,0,0,1,g,0,0,0,1);return this};f.makeRotationX=function(b){var d=Math.cos(b);b=Math.sin(b);this.set(1,0,0,0,0,d,-b,0,0,b,d,0,0,0,0,1);return this};f.makeRotationY=function(b){var d=Math.cos(b);b=Math.sin(b);this.set(d,0,b,0,0,1,0,0,-b,0,d,0,0,0,0,1);return this};f.makeRotationZ=function(b){var d=Math.cos(b);
b=Math.sin(b);this.set(d,-b,0,0,b,d,0,0,0,0,1,0,0,0,0,1);return this};f.makeRotationAxis=function(b,d){var g=Math.cos(d);d=Math.sin(d);var l=1-g,r=b.x,v=b.y;b=b.z;var x=l*r,w=l*v;this.set(x*r+g,x*v-d*b,x*b+d*v,0,x*v+d*b,w*v+g,w*b-d*r,0,x*b-d*v,w*b+d*r,l*b*b+g,0,0,0,0,1);return this};f.makeScale=function(b,d,g){this.set(b,0,0,0,0,d,0,0,0,0,g,0,0,0,0,1);return this};f.makeShear=function(b,d,g){this.set(1,d,g,0,b,1,g,0,b,d,1,0,0,0,0,1);return this};f.compose=function(b,d,g){var l=this.elements,r=d._x,
v=d._y,x=d._z,w=d._w,A=r+r,D=v+v,J=x+x;d=r*A;var N=r*D;r*=J;var L=v*D;v*=J;x*=J;A*=w;D*=w;w*=J;J=g.x;var S=g.y;g=g.z;l[0]=(1-(L+x))*J;l[1]=(N+w)*J;l[2]=(r-D)*J;l[3]=0;l[4]=(N-w)*S;l[5]=(1-(d+x))*S;l[6]=(v+A)*S;l[7]=0;l[8]=(r+D)*g;l[9]=(v-A)*g;l[10]=(1-(d+L))*g;l[11]=0;l[12]=b.x;l[13]=b.y;l[14]=b.z;l[15]=1;return this};f.decompose=function(b,d,g){var l=this.elements,r=Ef.set(l[0],l[1],l[2]).length(),v=Ef.set(l[4],l[5],l[6]).length(),x=Ef.set(l[8],l[9],l[10]).length();0>this.determinant()&&(r=-r);b.x=
l[12];b.y=l[13];b.z=l[14];Fc.copy(this);b=1/r;l=1/v;var w=1/x;Fc.elements[0]*=b;Fc.elements[1]*=b;Fc.elements[2]*=b;Fc.elements[4]*=l;Fc.elements[5]*=l;Fc.elements[6]*=l;Fc.elements[8]*=w;Fc.elements[9]*=w;Fc.elements[10]*=w;d.setFromRotationMatrix(Fc);g.x=r;g.y=v;g.z=x;return this};f.makePerspective=function(b,d,g,l,r,v){void 0===v&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var x=this.elements;x[0]=2*r/(d-b);x[4]=0;x[8]=(d+
b)/(d-b);x[12]=0;x[1]=0;x[5]=2*r/(g-l);x[9]=(g+l)/(g-l);x[13]=0;x[2]=0;x[6]=0;x[10]=-(v+r)/(v-r);x[14]=-2*v*r/(v-r);x[3]=0;x[7]=0;x[11]=-1;x[15]=0;return this};f.makeOrthographic=function(b,d,g,l,r,v){var x=this.elements,w=1/(d-b),A=1/(g-l),D=1/(v-r);x[0]=2*w;x[4]=0;x[8]=0;x[12]=-((d+b)*w);x[1]=0;x[5]=2*A;x[9]=0;x[13]=-((g+l)*A);x[2]=0;x[6]=0;x[10]=-2*D;x[14]=-((v+r)*D);x[3]=0;x[7]=0;x[11]=0;x[15]=1;return this};f.equals=function(b){var d=this.elements;b=b.elements;for(var g=0;16>g;g++)if(d[g]!==
b[g])return!1;return!0};f.fromArray=function(b,d){void 0===d&&(d=0);for(var g=0;16>g;g++)this.elements[g]=b[g+d];return this};f.toArray=function(b,d){void 0===b&&(b=[]);void 0===d&&(d=0);var g=this.elements;b[d]=g[0];b[d+1]=g[1];b[d+2]=g[2];b[d+3]=g[3];b[d+4]=g[4];b[d+5]=g[5];b[d+6]=g[6];b[d+7]=g[7];b[d+8]=g[8];b[d+9]=g[9];b[d+10]=g[10];b[d+11]=g[11];b[d+12]=g[12];b[d+13]=g[13];b[d+14]=g[14];b[d+15]=g[15];return b};return c}(),Ef=new da,Fc=new ec,pl=new da(0,0,0),ql=new da(1,1,1),De=new da,qh=new da,
Wc=new da,wg=function(){function c(b,d,g,l){void 0===b&&(b=0);void 0===d&&(d=0);void 0===g&&(g=0);void 0===l&&(l=c.DefaultOrder);Object.defineProperty(this,"isEuler",{value:!0});this._x=b;this._y=d;this._z=g;this._order=l}var f=c.prototype;f.set=function(b,d,g,l){this._x=b;this._y=d;this._z=g;this._order=l||this._order;this._onChangeCallback();return this};f.clone=function(){return new this.constructor(this._x,this._y,this._z,this._order)};f.copy=function(b){this._x=b._x;this._y=b._y;this._z=b._z;
this._order=b._order;this._onChangeCallback();return this};f.setFromRotationMatrix=function(b,d,g){var l=Qb.clamp,r=b.elements;b=r[0];var v=r[4],x=r[8],w=r[1],A=r[5],D=r[9],J=r[2],N=r[6];r=r[10];d=d||this._order;switch(d){case "XYZ":this._y=Math.asin(l(x,-1,1));.9999999>Math.abs(x)?(this._x=Math.atan2(-D,r),this._z=Math.atan2(-v,b)):(this._x=Math.atan2(N,A),this._z=0);break;case "YXZ":this._x=Math.asin(-l(D,-1,1));.9999999>Math.abs(D)?(this._y=Math.atan2(x,r),this._z=Math.atan2(w,A)):(this._y=Math.atan2(-J,
b),this._z=0);break;case "ZXY":this._x=Math.asin(l(N,-1,1));.9999999>Math.abs(N)?(this._y=Math.atan2(-J,r),this._z=Math.atan2(-v,A)):(this._y=0,this._z=Math.atan2(w,b));break;case "ZYX":this._y=Math.asin(-l(J,-1,1));.9999999>Math.abs(J)?(this._x=Math.atan2(N,r),this._z=Math.atan2(w,b)):(this._x=0,this._z=Math.atan2(-v,A));break;case "YZX":this._z=Math.asin(l(w,-1,1));.9999999>Math.abs(w)?(this._x=Math.atan2(-D,A),this._y=Math.atan2(-J,b)):(this._x=0,this._y=Math.atan2(x,r));break;case "XZY":this._z=
Math.asin(-l(v,-1,1));.9999999>Math.abs(v)?(this._x=Math.atan2(N,A),this._y=Math.atan2(x,b)):(this._x=Math.atan2(-D,r),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+d)}this._order=d;!1!==g&&this._onChangeCallback();return this};f.setFromQuaternion=function(b,d,g){ak.makeRotationFromQuaternion(b);return this.setFromRotationMatrix(ak,d,g)};f.setFromVector3=function(b,d){return this.set(b.x,b.y,b.z,d||this._order)};f.reorder=function(b){bk.setFromEuler(this);
return this.setFromQuaternion(bk,b)};f.equals=function(b){return b._x===this._x&&b._y===this._y&&b._z===this._z&&b._order===this._order};f.fromArray=function(b){this._x=b[0];this._y=b[1];this._z=b[2];void 0!==b[3]&&(this._order=b[3]);this._onChangeCallback();return this};f.toArray=function(b,d){void 0===b&&(b=[]);void 0===d&&(d=0);b[d]=this._x;b[d+1]=this._y;b[d+2]=this._z;b[d+3]=this._order;return b};f.toVector3=function(b){return b?b.set(this._x,this._y,this._z):new da(this._x,this._y,this._z)};
f._onChange=function(b){this._onChangeCallback=b;return this};f._onChangeCallback=function(){};t(c,[{key:"x",get:function(){return this._x},set:function(b){this._x=b;this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(b){this._y=b;this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(b){this._z=b;this._onChangeCallback()}},{key:"order",get:function(){return this._order},set:function(b){this._order=b;this._onChangeCallback()}}]);return c}();wg.DefaultOrder=
"XYZ";wg.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" ");var ak=new ec,bk=new Oc,Vh=function(){function c(){this.mask=1}var f=c.prototype;f.set=function(b){this.mask=1<<b|0};f.enable=function(b){this.mask=this.mask|1<<b|0};f.enableAll=function(){this.mask=-1};f.toggle=function(b){this.mask^=1<<b|0};f.disable=function(b){this.mask&=~(1<<b|0)};f.disableAll=function(){this.mask=0};f.test=function(b){return 0!==(this.mask&b.mask)};return c}(),gl=0,ck=new da,Ff=new Oc,de=new ec,rh=new da,kg=new da,
rl=new da,sl=new Oc,dk=new da(1,0,0),ek=new da(0,1,0),fk=new da(0,0,1),tl={type:"added"},gk={type:"removed"};T.DefaultUp=new da(0,1,0);T.DefaultMatrixAutoUpdate=!0;T.prototype=Object.assign(Object.create(O.prototype),{constructor:T,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(c){this.matrixAutoUpdate&&this.updateMatrix();this.matrix.premultiply(c);this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(c){this.quaternion.premultiply(c);
return this},setRotationFromAxisAngle:function(c,f){this.quaternion.setFromAxisAngle(c,f)},setRotationFromEuler:function(c){this.quaternion.setFromEuler(c,!0)},setRotationFromMatrix:function(c){this.quaternion.setFromRotationMatrix(c)},setRotationFromQuaternion:function(c){this.quaternion.copy(c)},rotateOnAxis:function(c,f){Ff.setFromAxisAngle(c,f);this.quaternion.multiply(Ff);return this},rotateOnWorldAxis:function(c,f){Ff.setFromAxisAngle(c,f);this.quaternion.premultiply(Ff);return this},rotateX:function(c){return this.rotateOnAxis(dk,
c)},rotateY:function(c){return this.rotateOnAxis(ek,c)},rotateZ:function(c){return this.rotateOnAxis(fk,c)},translateOnAxis:function(c,f){ck.copy(c).applyQuaternion(this.quaternion);this.position.add(ck.multiplyScalar(f));return this},translateX:function(c){return this.translateOnAxis(dk,c)},translateY:function(c){return this.translateOnAxis(ek,c)},translateZ:function(c){return this.translateOnAxis(fk,c)},localToWorld:function(c){return c.applyMatrix4(this.matrixWorld)},worldToLocal:function(c){return c.applyMatrix4(de.copy(this.matrixWorld).invert())},
lookAt:function(c,f,b){c.isVector3?rh.copy(c):rh.set(c,f,b);c=this.parent;this.updateWorldMatrix(!0,!1);kg.setFromMatrixPosition(this.matrixWorld);this.isCamera||this.isLight?de.lookAt(kg,rh,this.up):de.lookAt(rh,kg,this.up);this.quaternion.setFromRotationMatrix(de);c&&(de.extractRotation(c.matrixWorld),Ff.setFromRotationMatrix(de),this.quaternion.premultiply(Ff.invert()))},add:function(c){if(1<arguments.length){for(var f=0;f<arguments.length;f++)this.add(arguments[f]);return this}if(c===this)return console.error("THREE.Object3D.add: object can't be added as a child of itself.",
c),this;c&&c.isObject3D?(null!==c.parent&&c.parent.remove(c),c.parent=this,this.children.push(c),c.dispatchEvent(tl)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",c);return this},remove:function(c){if(1<arguments.length){for(var f=0;f<arguments.length;f++)this.remove(arguments[f]);return this}f=this.children.indexOf(c);-1!==f&&(c.parent=null,this.children.splice(f,1),c.dispatchEvent(gk));return this},clear:function(){for(var c=0;c<this.children.length;c++){var f=this.children[c];
f.parent=null;f.dispatchEvent(gk)}this.children.length=0;return this},attach:function(c){this.updateWorldMatrix(!0,!1);de.copy(this.matrixWorld).invert();null!==c.parent&&(c.parent.updateWorldMatrix(!0,!1),de.multiply(c.parent.matrixWorld));c.applyMatrix4(de);c.updateWorldMatrix(!1,!1);this.add(c);return this},getObjectById:function(c){return this.getObjectByProperty("id",c)},getObjectByName:function(c){return this.getObjectByProperty("name",c)},getObjectByProperty:function(c,f){if(this[c]===f)return this;
for(var b=0,d=this.children.length;b<d;b++){var g=this.children[b].getObjectByProperty(c,f);if(void 0!==g)return g}},getWorldPosition:function(c){void 0===c&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),c=new da);this.updateWorldMatrix(!0,!1);return c.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(c){void 0===c&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),c=new Oc);this.updateWorldMatrix(!0,!1);this.matrixWorld.decompose(kg,
c,rl);return c},getWorldScale:function(c){void 0===c&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),c=new da);this.updateWorldMatrix(!0,!1);this.matrixWorld.decompose(kg,sl,c);return c},getWorldDirection:function(c){void 0===c&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),c=new da);this.updateWorldMatrix(!0,!1);var f=this.matrixWorld.elements;return c.set(f[8],f[9],f[10]).normalize()},raycast:function(){},traverse:function(c){c(this);for(var f=
this.children,b=0,d=f.length;b<d;b++)f[b].traverse(c)},traverseVisible:function(c){if(!1!==this.visible){c(this);for(var f=this.children,b=0,d=f.length;b<d;b++)f[b].traverseVisible(c)}},traverseAncestors:function(c){var f=this.parent;null!==f&&(c(f),f.traverseAncestors(c))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(c){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||c)null===
this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,c=!0;for(var f=this.children,b=0,d=f.length;b<d;b++)f[b].updateMatrixWorld(c)},updateWorldMatrix:function(c,f){var b=this.parent;!0===c&&null!==b&&b.updateWorldMatrix(!0,!1);this.matrixAutoUpdate&&this.updateMatrix();null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix);if(!0===f)for(c=
this.children,f=0,b=c.length;f<b;f++)c[f].updateWorldMatrix(!1,!0)},toJSON:function(c){function f(J,N){void 0===J[N.uuid]&&(J[N.uuid]=N.toJSON(c));return N.uuid}function b(J){var N=[],L;for(L in J){var S=J[L];delete S.metadata;N.push(S)}return N}var d=void 0===c||"string"===typeof c,g={};d&&(c={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},g.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var l={};l.uuid=this.uuid;l.type=this.type;""!==this.name&&
(l.name=this.name);!0===this.castShadow&&(l.castShadow=!0);!0===this.receiveShadow&&(l.receiveShadow=!0);!1===this.visible&&(l.visible=!1);!1===this.frustumCulled&&(l.frustumCulled=!1);0!==this.renderOrder&&(l.renderOrder=this.renderOrder);"{}"!==JSON.stringify(this.userData)&&(l.userData=this.userData);l.layers=this.layers.mask;l.matrix=this.matrix.toArray();!1===this.matrixAutoUpdate&&(l.matrixAutoUpdate=!1);this.isInstancedMesh&&(l.type="InstancedMesh",l.count=this.count,l.instanceMatrix=this.instanceMatrix.toJSON());
if(this.isMesh||this.isLine||this.isPoints){l.geometry=f(c.geometries,this.geometry);var r=this.geometry.parameters;if(void 0!==r&&void 0!==r.shapes)if(r=r.shapes,Array.isArray(r))for(var v=0,x=r.length;v<x;v++)f(c.shapes,r[v]);else f(c.shapes,r)}this.isSkinnedMesh&&(l.bindMode=this.bindMode,l.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(f(c.skeletons,this.skeleton),l.skeleton=this.skeleton.uuid));if(void 0!==this.material)if(Array.isArray(this.material)){r=[];v=0;for(x=this.material.length;v<
x;v++)r.push(f(c.materials,this.material[v]));l.material=r}else l.material=f(c.materials,this.material);if(0<this.children.length)for(l.children=[],r=0;r<this.children.length;r++)l.children.push(this.children[r].toJSON(c).object);if(0<this.animations.length)for(l.animations=[],r=0;r<this.animations.length;r++)l.animations.push(f(c.animations,this.animations[r]));if(d){d=b(c.geometries);r=b(c.materials);v=b(c.textures);x=b(c.images);var w=b(c.shapes),A=b(c.skeletons),D=b(c.animations);0<d.length&&
(g.geometries=d);0<r.length&&(g.materials=r);0<v.length&&(g.textures=v);0<x.length&&(g.images=x);0<w.length&&(g.shapes=w);0<A.length&&(g.skeletons=A);0<D.length&&(g.animations=D)}g.object=l;return g},clone:function(c){return(new this.constructor).copy(this,c)},copy:function(c,f){void 0===f&&(f=!0);this.name=c.name;this.up.copy(c.up);this.position.copy(c.position);this.rotation.order=c.rotation.order;this.quaternion.copy(c.quaternion);this.scale.copy(c.scale);this.matrix.copy(c.matrix);this.matrixWorld.copy(c.matrixWorld);
this.matrixAutoUpdate=c.matrixAutoUpdate;this.matrixWorldNeedsUpdate=c.matrixWorldNeedsUpdate;this.layers.mask=c.layers.mask;this.visible=c.visible;this.castShadow=c.castShadow;this.receiveShadow=c.receiveShadow;this.frustumCulled=c.frustumCulled;this.renderOrder=c.renderOrder;this.userData=JSON.parse(JSON.stringify(c.userData));if(!0===f)for(f=0;f<c.children.length;f++)this.add(c.children[f].clone());return this}});var Wi=new da,ul=new da,vl=new fd,yd=function(){function c(b,d){Object.defineProperty(this,
"isPlane",{value:!0});this.normal=void 0!==b?b:new da(1,0,0);this.constant=void 0!==d?d:0}var f=c.prototype;f.set=function(b,d){this.normal.copy(b);this.constant=d;return this};f.setComponents=function(b,d,g,l){this.normal.set(b,d,g);this.constant=l;return this};f.setFromNormalAndCoplanarPoint=function(b,d){this.normal.copy(b);this.constant=-d.dot(this.normal);return this};f.setFromCoplanarPoints=function(b,d,g){d=Wi.subVectors(g,d).cross(ul.subVectors(b,d)).normalize();this.setFromNormalAndCoplanarPoint(d,
b);return this};f.clone=function(){return(new this.constructor).copy(this)};f.copy=function(b){this.normal.copy(b.normal);this.constant=b.constant;return this};f.normalize=function(){var b=1/this.normal.length();this.normal.multiplyScalar(b);this.constant*=b;return this};f.negate=function(){this.constant*=-1;this.normal.negate();return this};f.distanceToPoint=function(b){return this.normal.dot(b)+this.constant};f.distanceToSphere=function(b){return this.distanceToPoint(b.center)-b.radius};f.projectPoint=
function(b,d){void 0===d&&(console.warn("THREE.Plane: .projectPoint() target is now required"),d=new da);return d.copy(this.normal).multiplyScalar(-this.distanceToPoint(b)).add(b)};f.intersectLine=function(b,d){void 0===d&&(console.warn("THREE.Plane: .intersectLine() target is now required"),d=new da);var g=b.delta(Wi),l=this.normal.dot(g);if(0===l){if(0===this.distanceToPoint(b.start))return d.copy(b.start)}else if(l=-(b.start.dot(this.normal)+this.constant)/l,!(0>l||1<l))return d.copy(g).multiplyScalar(l).add(b.start)};
f.intersectsLine=function(b){var d=this.distanceToPoint(b.start);b=this.distanceToPoint(b.end);return 0>d&&0<b||0>b&&0<d};f.intersectsBox=function(b){return b.intersectsPlane(this)};f.intersectsSphere=function(b){return b.intersectsPlane(this)};f.coplanarPoint=function(b){void 0===b&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),b=new da);return b.copy(this.normal).multiplyScalar(-this.constant)};f.applyMatrix4=function(b,d){d=d||vl.getNormalMatrix(b);b=this.coplanarPoint(Wi).applyMatrix4(b);
d=this.normal.applyMatrix3(d).normalize();this.constant=-b.dot(d);return this};f.translate=function(b){this.constant-=b.dot(this.normal);return this};f.equals=function(b){return b.normal.equals(this.normal)&&b.constant===this.constant};return c}(),vd=new da,ee=new da,Xi=new da,fe=new da,Gf=new da,Hf=new da,hk=new da,Yi=new da,Zi=new da,$i=new da,xd=function(){function c(b,d,g){this.a=void 0!==b?b:new da;this.b=void 0!==d?d:new da;this.c=void 0!==g?g:new da}c.getNormal=function(b,d,g,l){void 0===l&&
(console.warn("THREE.Triangle: .getNormal() target is now required"),l=new da);l.subVectors(g,d);vd.subVectors(b,d);l.cross(vd);b=l.lengthSq();return 0<b?l.multiplyScalar(1/Math.sqrt(b)):l.set(0,0,0)};c.getBarycoord=function(b,d,g,l,r){vd.subVectors(l,d);ee.subVectors(g,d);Xi.subVectors(b,d);b=vd.dot(vd);d=vd.dot(ee);g=vd.dot(Xi);var v=ee.dot(ee);l=ee.dot(Xi);var x=b*v-d*d;void 0===r&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),r=new da);if(0===x)return r.set(-2,-1,-1);
x=1/x;v=(v*g-d*l)*x;b=(b*l-d*g)*x;return r.set(1-v-b,b,v)};c.containsPoint=function(b,d,g,l){this.getBarycoord(b,d,g,l,fe);return 0<=fe.x&&0<=fe.y&&1>=fe.x+fe.y};c.getUV=function(b,d,g,l,r,v,x,w){this.getBarycoord(b,d,g,l,fe);w.set(0,0);w.addScaledVector(r,fe.x);w.addScaledVector(v,fe.y);w.addScaledVector(x,fe.z);return w};c.isFrontFacing=function(b,d,g,l){vd.subVectors(g,d);ee.subVectors(b,d);return 0>vd.cross(ee).dot(l)?!0:!1};var f=c.prototype;f.set=function(b,d,g){this.a.copy(b);this.b.copy(d);
this.c.copy(g);return this};f.setFromPointsAndIndices=function(b,d,g,l){this.a.copy(b[d]);this.b.copy(b[g]);this.c.copy(b[l]);return this};f.clone=function(){return(new this.constructor).copy(this)};f.copy=function(b){this.a.copy(b.a);this.b.copy(b.b);this.c.copy(b.c);return this};f.getArea=function(){vd.subVectors(this.c,this.b);ee.subVectors(this.a,this.b);return.5*vd.cross(ee).length()};f.getMidpoint=function(b){void 0===b&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),
b=new da);return b.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)};f.getNormal=function(b){return c.getNormal(this.a,this.b,this.c,b)};f.getPlane=function(b){void 0===b&&(console.warn("THREE.Triangle: .getPlane() target is now required"),b=new yd);return b.setFromCoplanarPoints(this.a,this.b,this.c)};f.getBarycoord=function(b,d){return c.getBarycoord(b,this.a,this.b,this.c,d)};f.getUV=function(b,d,g,l,r){return c.getUV(b,this.a,this.b,this.c,d,g,l,r)};f.containsPoint=function(b){return c.containsPoint(b,
this.a,this.b,this.c)};f.isFrontFacing=function(b){return c.isFrontFacing(this.a,this.b,this.c,b)};f.intersectsBox=function(b){return b.intersectsTriangle(this)};f.closestPointToPoint=function(b,d){void 0===d&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),d=new da);var g=this.a,l=this.b,r=this.c;Gf.subVectors(l,g);Hf.subVectors(r,g);Yi.subVectors(b,g);var v=Gf.dot(Yi),x=Hf.dot(Yi);if(0>=v&&0>=x)return d.copy(g);Zi.subVectors(b,l);var w=Gf.dot(Zi),A=Hf.dot(Zi);if(0<=
w&&A<=w)return d.copy(l);var D=v*A-w*x;if(0>=D&&0<=v&&0>=w)return l=v/(v-w),d.copy(g).addScaledVector(Gf,l);$i.subVectors(b,r);b=Gf.dot($i);var J=Hf.dot($i);if(0<=J&&b<=J)return d.copy(r);v=b*x-v*J;if(0>=v&&0<=x&&0>=J)return D=x/(x-J),d.copy(g).addScaledVector(Hf,D);x=w*J-b*A;if(0>=x&&0<=A-w&&0<=b-J)return hk.subVectors(r,l),D=(A-w)/(A-w+(b-J)),d.copy(l).addScaledVector(hk,D);r=1/(x+v+D);l=v*r;D*=r;return d.copy(g).addScaledVector(Gf,l).addScaledVector(Hf,D)};f.equals=function(b){return b.a.equals(this.a)&&
b.b.equals(this.b)&&b.c.equals(this.c)};return c}(),ik={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,
darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,
green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,
lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,
palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,
steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ed={h:0,s:0,l:0},sh={h:0,s:0,l:0},Cb=function(){function c(b,d,g){Object.defineProperty(this,"isColor",{value:!0});return void 0===d&&void 0===g?this.set(b):this.setRGB(b,d,g)}var f=c.prototype;f.set=function(b){b&&b.isColor?this.copy(b):"number"===typeof b?this.setHex(b):"string"===typeof b&&this.setStyle(b);
return this};f.setScalar=function(b){this.b=this.g=this.r=b;return this};f.setHex=function(b){b=Math.floor(b);this.r=(b>>16&255)/255;this.g=(b>>8&255)/255;this.b=(b&255)/255;return this};f.setRGB=function(b,d,g){this.r=b;this.g=d;this.b=g;return this};f.setHSL=function(b,d,g){b=Qb.euclideanModulo(b,1);d=Qb.clamp(d,0,1);g=Qb.clamp(g,0,1);0===d?this.r=this.g=this.b=g:(d=.5>=g?g*(1+d):g+d-g*d,g=2*g-d,this.r=fa(g,d,b+1/3),this.g=fa(g,d,b),this.b=fa(g,d,b-1/3));return this};f.setStyle=function(b){function d(x){void 0!==
x&&1>parseFloat(x)&&console.warn("THREE.Color: Alpha component of "+b+" will be ignored.")}var g;if(g=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(b)){var l=g[2];switch(g[1]){case "rgb":case "rgba":if(g=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return this.r=Math.min(255,parseInt(g[1],10))/255,this.g=Math.min(255,parseInt(g[2],10))/255,this.b=Math.min(255,parseInt(g[3],10))/255,d(g[4]),this;if(g=/^\s*(\d+)%\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return this.r=
Math.min(100,parseInt(g[1],10))/100,this.g=Math.min(100,parseInt(g[2],10))/100,this.b=Math.min(100,parseInt(g[3],10))/100,d(g[4]),this;break;case "hsl":case "hsla":if(g=/^\s*(\d*\.?\d+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l)){l=parseFloat(g[1])/360;var r=parseInt(g[2],10)/100,v=parseInt(g[3],10)/100;d(g[4]);return this.setHSL(l,r,v)}}}else if(g=/^#([A-Fa-f\d]+)$/.exec(b)){g=g[1];l=g.length;if(3===l)return this.r=parseInt(g.charAt(0)+g.charAt(0),16)/255,this.g=parseInt(g.charAt(1)+
g.charAt(1),16)/255,this.b=parseInt(g.charAt(2)+g.charAt(2),16)/255,this;if(6===l)return this.r=parseInt(g.charAt(0)+g.charAt(1),16)/255,this.g=parseInt(g.charAt(2)+g.charAt(3),16)/255,this.b=parseInt(g.charAt(4)+g.charAt(5),16)/255,this}return b&&0<b.length?this.setColorName(b):this};f.setColorName=function(b){var d=ik[b];void 0!==d?this.setHex(d):console.warn("THREE.Color: Unknown color "+b);return this};f.clone=function(){return new this.constructor(this.r,this.g,this.b)};f.copy=function(b){this.r=
b.r;this.g=b.g;this.b=b.b;return this};f.copyGammaToLinear=function(b,d){void 0===d&&(d=2);this.r=Math.pow(b.r,d);this.g=Math.pow(b.g,d);this.b=Math.pow(b.b,d);return this};f.copyLinearToGamma=function(b,d){void 0===d&&(d=2);d=0<d?1/d:1;this.r=Math.pow(b.r,d);this.g=Math.pow(b.g,d);this.b=Math.pow(b.b,d);return this};f.convertGammaToLinear=function(b){this.copyGammaToLinear(this,b);return this};f.convertLinearToGamma=function(b){this.copyLinearToGamma(this,b);return this};f.copySRGBToLinear=function(b){this.r=
sa(b.r);this.g=sa(b.g);this.b=sa(b.b);return this};f.copyLinearToSRGB=function(b){this.r=wa(b.r);this.g=wa(b.g);this.b=wa(b.b);return this};f.convertSRGBToLinear=function(){this.copySRGBToLinear(this);return this};f.convertLinearToSRGB=function(){this.copyLinearToSRGB(this);return this};f.getHex=function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0};f.getHexString=function(){return("000000"+this.getHex().toString(16)).slice(-6)};f.getHSL=function(b){void 0===b&&(console.warn("THREE.Color: .getHSL() target is now required"),
b={h:0,s:0,l:0});var d=this.r,g=this.g,l=this.b,r=Math.max(d,g,l),v=Math.min(d,g,l),x,w=(v+r)/2;if(v===r)v=x=0;else{var A=r-v;v=.5>=w?A/(r+v):A/(2-r-v);switch(r){case d:x=(g-l)/A+(g<l?6:0);break;case g:x=(l-d)/A+2;break;case l:x=(d-g)/A+4}x/=6}b.h=x;b.s=v;b.l=w;return b};f.getStyle=function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"};f.offsetHSL=function(b,d,g){this.getHSL(ed);ed.h+=b;ed.s+=d;ed.l+=g;this.setHSL(ed.h,ed.s,ed.l);return this};f.add=function(b){this.r+=b.r;
this.g+=b.g;this.b+=b.b;return this};f.addColors=function(b,d){this.r=b.r+d.r;this.g=b.g+d.g;this.b=b.b+d.b;return this};f.addScalar=function(b){this.r+=b;this.g+=b;this.b+=b;return this};f.sub=function(b){this.r=Math.max(0,this.r-b.r);this.g=Math.max(0,this.g-b.g);this.b=Math.max(0,this.b-b.b);return this};f.multiply=function(b){this.r*=b.r;this.g*=b.g;this.b*=b.b;return this};f.multiplyScalar=function(b){this.r*=b;this.g*=b;this.b*=b;return this};f.lerp=function(b,d){this.r+=(b.r-this.r)*d;this.g+=
(b.g-this.g)*d;this.b+=(b.b-this.b)*d;return this};f.lerpColors=function(b,d,g){this.r=b.r+(d.r-b.r)*g;this.g=b.g+(d.g-b.g)*g;this.b=b.b+(d.b-b.b)*g;return this};f.lerpHSL=function(b,d){this.getHSL(ed);b.getHSL(sh);b=Qb.lerp(ed.h,sh.h,d);var g=Qb.lerp(ed.s,sh.s,d);d=Qb.lerp(ed.l,sh.l,d);this.setHSL(b,g,d);return this};f.equals=function(b){return b.r===this.r&&b.g===this.g&&b.b===this.b};f.fromArray=function(b,d){void 0===d&&(d=0);this.r=b[d];this.g=b[d+1];this.b=b[d+2];return this};f.toArray=function(b,
d){void 0===b&&(b=[]);void 0===d&&(d=0);b[d]=this.r;b[d+1]=this.g;b[d+2]=this.b;return b};f.fromBufferAttribute=function(b,d){this.r=b.getX(d);this.g=b.getY(d);this.b=b.getZ(d);!0===b.normalized&&(this.r/=255,this.g/=255,this.b/=255);return this};f.toJSON=function(){return this.getHex()};return c}();Cb.NAMES=ik;Cb.prototype.r=1;Cb.prototype.g=1;Cb.prototype.b=1;var $h=function(){function c(b,d,g,l,r,v){void 0===v&&(v=0);this.a=b;this.b=d;this.c=g;this.normal=l&&l.isVector3?l:new da;this.vertexNormals=
Array.isArray(l)?l:[];this.color=r&&r.isColor?r:new Cb;this.vertexColors=Array.isArray(r)?r:[];this.materialIndex=v}var f=c.prototype;f.clone=function(){return(new this.constructor).copy(this)};f.copy=function(b){this.a=b.a;this.b=b.b;this.c=b.c;this.normal.copy(b.normal);this.color.copy(b.color);this.materialIndex=b.materialIndex;for(var d=0,g=b.vertexNormals.length;d<g;d++)this.vertexNormals[d]=b.vertexNormals[d].clone();d=0;for(g=b.vertexColors.length;d<g;d++)this.vertexColors[d]=b.vertexColors[d].clone();
return this};return c}(),hl=0;U.prototype=Object.assign(Object.create(O.prototype),{constructor:U,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(c){if(void 0!==c)for(var f in c){var b=c[f];if(void 0===b)console.warn("THREE.Material: '"+f+"' parameter is undefined.");else if("shading"===f)console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===b?
!0:!1;else{var d=this[f];void 0===d?console.warn("THREE."+this.type+": '"+f+"' is not a property of this material."):d&&d.isColor?d.set(b):d&&d.isVector3&&b&&b.isVector3?d.copy(b):this[f]=b}}},toJSON:function(c){function f(g){var l=[],r;for(r in g){var v=g[r];delete v.metadata;l.push(v)}return l}var b=void 0===c||"string"===typeof c;b&&(c={textures:{},images:{}});var d={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};d.uuid=this.uuid;d.type=this.type;""!==this.name&&(d.name=this.name);
this.color&&this.color.isColor&&(d.color=this.color.getHex());void 0!==this.roughness&&(d.roughness=this.roughness);void 0!==this.metalness&&(d.metalness=this.metalness);this.sheen&&this.sheen.isColor&&(d.sheen=this.sheen.getHex());this.emissive&&this.emissive.isColor&&(d.emissive=this.emissive.getHex());this.emissiveIntensity&&1!==this.emissiveIntensity&&(d.emissiveIntensity=this.emissiveIntensity);this.specular&&this.specular.isColor&&(d.specular=this.specular.getHex());void 0!==this.shininess&&
(d.shininess=this.shininess);void 0!==this.clearcoat&&(d.clearcoat=this.clearcoat);void 0!==this.clearcoatRoughness&&(d.clearcoatRoughness=this.clearcoatRoughness);this.clearcoatMap&&this.clearcoatMap.isTexture&&(d.clearcoatMap=this.clearcoatMap.toJSON(c).uuid);this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(d.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(c).uuid);this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(d.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(c).uuid,
d.clearcoatNormalScale=this.clearcoatNormalScale.toArray());this.map&&this.map.isTexture&&(d.map=this.map.toJSON(c).uuid);this.matcap&&this.matcap.isTexture&&(d.matcap=this.matcap.toJSON(c).uuid);this.alphaMap&&this.alphaMap.isTexture&&(d.alphaMap=this.alphaMap.toJSON(c).uuid);this.lightMap&&this.lightMap.isTexture&&(d.lightMap=this.lightMap.toJSON(c).uuid);this.aoMap&&this.aoMap.isTexture&&(d.aoMap=this.aoMap.toJSON(c).uuid,d.aoMapIntensity=this.aoMapIntensity);this.bumpMap&&this.bumpMap.isTexture&&
(d.bumpMap=this.bumpMap.toJSON(c).uuid,d.bumpScale=this.bumpScale);this.normalMap&&this.normalMap.isTexture&&(d.normalMap=this.normalMap.toJSON(c).uuid,d.normalMapType=this.normalMapType,d.normalScale=this.normalScale.toArray());this.displacementMap&&this.displacementMap.isTexture&&(d.displacementMap=this.displacementMap.toJSON(c).uuid,d.displacementScale=this.displacementScale,d.displacementBias=this.displacementBias);this.roughnessMap&&this.roughnessMap.isTexture&&(d.roughnessMap=this.roughnessMap.toJSON(c).uuid);
this.metalnessMap&&this.metalnessMap.isTexture&&(d.metalnessMap=this.metalnessMap.toJSON(c).uuid);this.emissiveMap&&this.emissiveMap.isTexture&&(d.emissiveMap=this.emissiveMap.toJSON(c).uuid);this.specularMap&&this.specularMap.isTexture&&(d.specularMap=this.specularMap.toJSON(c).uuid);this.envMap&&this.envMap.isTexture&&(d.envMap=this.envMap.toJSON(c).uuid,d.reflectivity=this.reflectivity,d.refractionRatio=this.refractionRatio,void 0!==this.combine&&(d.combine=this.combine),void 0!==this.envMapIntensity&&
(d.envMapIntensity=this.envMapIntensity));this.gradientMap&&this.gradientMap.isTexture&&(d.gradientMap=this.gradientMap.toJSON(c).uuid);void 0!==this.size&&(d.size=this.size);void 0!==this.sizeAttenuation&&(d.sizeAttenuation=this.sizeAttenuation);1!==this.blending&&(d.blending=this.blending);!0===this.flatShading&&(d.flatShading=this.flatShading);0!==this.side&&(d.side=this.side);this.vertexColors&&(d.vertexColors=!0);1>this.opacity&&(d.opacity=this.opacity);!0===this.transparent&&(d.transparent=
this.transparent);d.depthFunc=this.depthFunc;d.depthTest=this.depthTest;d.depthWrite=this.depthWrite;d.stencilWrite=this.stencilWrite;d.stencilWriteMask=this.stencilWriteMask;d.stencilFunc=this.stencilFunc;d.stencilRef=this.stencilRef;d.stencilFuncMask=this.stencilFuncMask;d.stencilFail=this.stencilFail;d.stencilZFail=this.stencilZFail;d.stencilZPass=this.stencilZPass;this.rotation&&0!==this.rotation&&(d.rotation=this.rotation);!0===this.polygonOffset&&(d.polygonOffset=!0);0!==this.polygonOffsetFactor&&
(d.polygonOffsetFactor=this.polygonOffsetFactor);0!==this.polygonOffsetUnits&&(d.polygonOffsetUnits=this.polygonOffsetUnits);this.linewidth&&1!==this.linewidth&&(d.linewidth=this.linewidth);void 0!==this.dashSize&&(d.dashSize=this.dashSize);void 0!==this.gapSize&&(d.gapSize=this.gapSize);void 0!==this.scale&&(d.scale=this.scale);!0===this.dithering&&(d.dithering=!0);0<this.alphaTest&&(d.alphaTest=this.alphaTest);!0===this.premultipliedAlpha&&(d.premultipliedAlpha=this.premultipliedAlpha);!0===this.wireframe&&
(d.wireframe=this.wireframe);1<this.wireframeLinewidth&&(d.wireframeLinewidth=this.wireframeLinewidth);"round"!==this.wireframeLinecap&&(d.wireframeLinecap=this.wireframeLinecap);"round"!==this.wireframeLinejoin&&(d.wireframeLinejoin=this.wireframeLinejoin);!0===this.morphTargets&&(d.morphTargets=!0);!0===this.morphNormals&&(d.morphNormals=!0);!0===this.skinning&&(d.skinning=!0);!1===this.visible&&(d.visible=!1);!1===this.toneMapped&&(d.toneMapped=!1);"{}"!==JSON.stringify(this.userData)&&(d.userData=
this.userData);b&&(b=f(c.textures),c=f(c.images),0<b.length&&(d.textures=b),0<c.length&&(d.images=c));return d},clone:function(){return(new this.constructor).copy(this)},copy:function(c){this.name=c.name;this.fog=c.fog;this.blending=c.blending;this.side=c.side;this.flatShading=c.flatShading;this.vertexColors=c.vertexColors;this.opacity=c.opacity;this.transparent=c.transparent;this.blendSrc=c.blendSrc;this.blendDst=c.blendDst;this.blendEquation=c.blendEquation;this.blendSrcAlpha=c.blendSrcAlpha;this.blendDstAlpha=
c.blendDstAlpha;this.blendEquationAlpha=c.blendEquationAlpha;this.depthFunc=c.depthFunc;this.depthTest=c.depthTest;this.depthWrite=c.depthWrite;this.stencilWriteMask=c.stencilWriteMask;this.stencilFunc=c.stencilFunc;this.stencilRef=c.stencilRef;this.stencilFuncMask=c.stencilFuncMask;this.stencilFail=c.stencilFail;this.stencilZFail=c.stencilZFail;this.stencilZPass=c.stencilZPass;this.stencilWrite=c.stencilWrite;var f=c.clippingPlanes,b=null;if(null!==f){var d=f.length;b=Array(d);for(var g=0;g!==d;++g)b[g]=
f[g].clone()}this.clippingPlanes=b;this.clipIntersection=c.clipIntersection;this.clipShadows=c.clipShadows;this.shadowSide=c.shadowSide;this.colorWrite=c.colorWrite;this.precision=c.precision;this.polygonOffset=c.polygonOffset;this.polygonOffsetFactor=c.polygonOffsetFactor;this.polygonOffsetUnits=c.polygonOffsetUnits;this.dithering=c.dithering;this.alphaTest=c.alphaTest;this.premultipliedAlpha=c.premultipliedAlpha;this.visible=c.visible;this.toneMapped=c.toneMapped;this.userData=JSON.parse(JSON.stringify(c.userData));
return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});Object.defineProperty(U.prototype,"needsUpdate",{set:function(c){!0===c&&this.version++}});qa.prototype=Object.create(U.prototype);qa.prototype.constructor=qa;qa.prototype.isMeshBasicMaterial=!0;qa.prototype.copy=function(c){U.prototype.copy.call(this,c);this.color.copy(c.color);this.map=c.map;this.lightMap=c.lightMap;this.lightMapIntensity=c.lightMapIntensity;this.aoMap=c.aoMap;this.aoMapIntensity=c.aoMapIntensity;this.specularMap=
c.specularMap;this.alphaMap=c.alphaMap;this.envMap=c.envMap;this.combine=c.combine;this.reflectivity=c.reflectivity;this.refractionRatio=c.refractionRatio;this.wireframe=c.wireframe;this.wireframeLinewidth=c.wireframeLinewidth;this.wireframeLinecap=c.wireframeLinecap;this.wireframeLinejoin=c.wireframeLinejoin;this.skinning=c.skinning;this.morphTargets=c.morphTargets;return this};var vc=new da,th=new ib;Object.defineProperty(M.prototype,"needsUpdate",{set:function(c){!0===c&&this.version++}});Object.assign(M.prototype,
{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(c){this.usage=c;return this},copy:function(c){this.name=c.name;this.array=new c.array.constructor(c.array);this.itemSize=c.itemSize;this.count=c.count;this.normalized=c.normalized;this.usage=c.usage;return this},copyAt:function(c,f,b){c*=this.itemSize;b*=f.itemSize;for(var d=0,g=this.itemSize;d<g;d++)this.array[c+d]=f.array[b+d];return this},copyArray:function(c){this.array.set(c);return this},copyColorsArray:function(c){for(var f=
this.array,b=0,d=0,g=c.length;d<g;d++){var l=c[d];void 0===l&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",d),l=new Cb);f[b++]=l.r;f[b++]=l.g;f[b++]=l.b}return this},copyVector2sArray:function(c){for(var f=this.array,b=0,d=0,g=c.length;d<g;d++){var l=c[d];void 0===l&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",d),l=new ib);f[b++]=l.x;f[b++]=l.y}return this},copyVector3sArray:function(c){for(var f=this.array,b=0,d=0,g=c.length;d<g;d++){var l=
c[d];void 0===l&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",d),l=new da);f[b++]=l.x;f[b++]=l.y;f[b++]=l.z}return this},copyVector4sArray:function(c){for(var f=this.array,b=0,d=0,g=c.length;d<g;d++){var l=c[d];void 0===l&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",d),l=new qc);f[b++]=l.x;f[b++]=l.y;f[b++]=l.z;f[b++]=l.w}return this},applyMatrix3:function(c){if(2===this.itemSize)for(var f=0,b=this.count;f<b;f++)th.fromBufferAttribute(this,
f),th.applyMatrix3(c),this.setXY(f,th.x,th.y);else if(3===this.itemSize)for(f=0,b=this.count;f<b;f++)vc.fromBufferAttribute(this,f),vc.applyMatrix3(c),this.setXYZ(f,vc.x,vc.y,vc.z);return this},applyMatrix4:function(c){for(var f=0,b=this.count;f<b;f++)vc.x=this.getX(f),vc.y=this.getY(f),vc.z=this.getZ(f),vc.applyMatrix4(c),this.setXYZ(f,vc.x,vc.y,vc.z);return this},applyNormalMatrix:function(c){for(var f=0,b=this.count;f<b;f++)vc.x=this.getX(f),vc.y=this.getY(f),vc.z=this.getZ(f),vc.applyNormalMatrix(c),
this.setXYZ(f,vc.x,vc.y,vc.z);return this},transformDirection:function(c){for(var f=0,b=this.count;f<b;f++)vc.x=this.getX(f),vc.y=this.getY(f),vc.z=this.getZ(f),vc.transformDirection(c),this.setXYZ(f,vc.x,vc.y,vc.z);return this},set:function(c,f){void 0===f&&(f=0);this.array.set(c,f);return this},getX:function(c){return this.array[c*this.itemSize]},setX:function(c,f){this.array[c*this.itemSize]=f;return this},getY:function(c){return this.array[c*this.itemSize+1]},setY:function(c,f){this.array[c*this.itemSize+
1]=f;return this},getZ:function(c){return this.array[c*this.itemSize+2]},setZ:function(c,f){this.array[c*this.itemSize+2]=f;return this},getW:function(c){return this.array[c*this.itemSize+3]},setW:function(c,f){this.array[c*this.itemSize+3]=f;return this},setXY:function(c,f,b){c*=this.itemSize;this.array[c+0]=f;this.array[c+1]=b;return this},setXYZ:function(c,f,b,d){c*=this.itemSize;this.array[c+0]=f;this.array[c+1]=b;this.array[c+2]=d;return this},setXYZW:function(c,f,b,d,g){c*=this.itemSize;this.array[c+
0]=f;this.array[c+1]=b;this.array[c+2]=d;this.array[c+3]=g;return this},onUpload:function(c){this.onUploadCallback=c;return this},clone:function(){return(new this.constructor(this.array,this.itemSize)).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}});Q.prototype=Object.create(M.prototype);Q.prototype.constructor=Q;V.prototype=Object.create(M.prototype);V.prototype.constructor=V;
ca.prototype=Object.create(M.prototype);ca.prototype.constructor=ca;za.prototype=Object.create(M.prototype);za.prototype.constructor=za;ta.prototype=Object.create(M.prototype);ta.prototype.constructor=ta;Ka.prototype=Object.create(M.prototype);Ka.prototype.constructor=Ka;cb.prototype=Object.create(M.prototype);cb.prototype.constructor=cb;gb.prototype=Object.create(M.prototype);gb.prototype.constructor=gb;gb.prototype.isFloat16BufferAttribute=!0;Ya.prototype=Object.create(M.prototype);Ya.prototype.constructor=
Ya;na.prototype=Object.create(M.prototype);na.prototype.constructor=na;var lg={Int8Array,Uint8Array,Uint8ClampedArray:"undefined"!==typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array},il=0,Od=new ec,aj=new T,If=new da,hd=new be,mg=new be,Kc=new da;Na.prototype=Object.assign(Object.create(O.prototype),{constructor:Na,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(c){Array.isArray(c)?this.index=
new (65535<Ia(c)?cb:ta)(c,1):this.index=c;return this},getAttribute:function(c){return this.attributes[c]},setAttribute:function(c,f){this.attributes[c]=f;return this},deleteAttribute:function(c){delete this.attributes[c];return this},hasAttribute:function(c){return void 0!==this.attributes[c]},addGroup:function(c,f,b){void 0===b&&(b=0);this.groups.push({start:c,count:f,materialIndex:b})},clearGroups:function(){this.groups=[]},setDrawRange:function(c,f){this.drawRange.start=c;this.drawRange.count=
f},applyMatrix4:function(c){var f=this.attributes.position;void 0!==f&&(f.applyMatrix4(c),f.needsUpdate=!0);f=this.attributes.normal;if(void 0!==f){var b=(new fd).getNormalMatrix(c);f.applyNormalMatrix(b);f.needsUpdate=!0}f=this.attributes.tangent;void 0!==f&&(f.transformDirection(c),f.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();return this},rotateX:function(c){Od.makeRotationX(c);this.applyMatrix4(Od);return this},rotateY:function(c){Od.makeRotationY(c);
this.applyMatrix4(Od);return this},rotateZ:function(c){Od.makeRotationZ(c);this.applyMatrix4(Od);return this},translate:function(c,f,b){Od.makeTranslation(c,f,b);this.applyMatrix4(Od);return this},scale:function(c,f,b){Od.makeScale(c,f,b);this.applyMatrix4(Od);return this},lookAt:function(c){aj.lookAt(c);aj.updateMatrix();this.applyMatrix4(aj.matrix);return this},center:function(){this.computeBoundingBox();this.boundingBox.getCenter(If).negate();this.translate(If.x,If.y,If.z);return this},setFromPoints:function(c){for(var f=
[],b=0,d=c.length;b<d;b++){var g=c[b];f.push(g.x,g.y,g.z||0)}this.setAttribute("position",new Ya(f,3));return this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new be);var c=this.attributes.position,f=this.morphAttributes.position;if(c&&c.isGLBufferAttribute)console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new da(-Infinity,-Infinity,
-Infinity),new da(Infinity,Infinity,Infinity));else{if(void 0!==c){if(this.boundingBox.setFromBufferAttribute(c),f){c=0;for(var b=f.length;c<b;c++)hd.setFromBufferAttribute(f[c]),this.morphTargetsRelative?(Kc.addVectors(this.boundingBox.min,hd.min),this.boundingBox.expandByPoint(Kc),Kc.addVectors(this.boundingBox.max,hd.max),this.boundingBox.expandByPoint(Kc)):(this.boundingBox.expandByPoint(hd.min),this.boundingBox.expandByPoint(hd.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||
isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Be);var c=this.attributes.position,f=this.morphAttributes.position;if(c&&c.isGLBufferAttribute)console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',
this),this.boundingSphere.set(new da,Infinity);else if(c){var b=this.boundingSphere.center;hd.setFromBufferAttribute(c);if(f)for(var d=0,g=f.length;d<g;d++)mg.setFromBufferAttribute(f[d]),this.morphTargetsRelative?(Kc.addVectors(hd.min,mg.min),hd.expandByPoint(Kc),Kc.addVectors(hd.max,mg.max),hd.expandByPoint(Kc)):(hd.expandByPoint(mg.min),hd.expandByPoint(mg.max));hd.getCenter(b);g=d=0;for(var l=c.count;g<l;g++)Kc.fromBufferAttribute(c,g),d=Math.max(d,b.distanceToSquared(Kc));if(f)for(g=0,l=f.length;g<
l;g++)for(var r=f[g],v=this.morphTargetsRelative,x=0,w=r.count;x<w;x++)Kc.fromBufferAttribute(r,x),v&&(If.fromBufferAttribute(c,x),Kc.add(If)),d=Math.max(d,b.distanceToSquared(Kc));this.boundingSphere.radius=Math.sqrt(d);isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeTangents:function(){function c(Ga,Oa,nb){D.fromArray(g,3*
Ga);J.fromArray(g,3*Oa);N.fromArray(g,3*nb);L.fromArray(r,2*Ga);S.fromArray(r,2*Oa);P.fromArray(r,2*nb);J.sub(D);N.sub(D);S.sub(L);P.sub(L);var Ba=1/(S.x*P.y-P.x*S.y);isFinite(Ba)&&(ka.copy(J).multiplyScalar(P.y).addScaledVector(N,-S.y).multiplyScalar(Ba),ia.copy(N).multiplyScalar(S.x).addScaledVector(J,-P.x).multiplyScalar(Ba),w[Ga].add(ka),w[Oa].add(ka),w[nb].add(ka),A[Ga].add(ia),A[Oa].add(ia),A[nb].add(ia))}function f(Ga){Ra.fromArray(l,3*Ga);xa.copy(Ra);var Oa=w[Ga];ra.copy(Oa);ra.sub(Ra.multiplyScalar(Ra.dot(Oa))).normalize();
Ja.crossVectors(xa,Oa);Oa=Ja.dot(A[Ga]);x[4*Ga]=ra.x;x[4*Ga+1]=ra.y;x[4*Ga+2]=ra.z;x[4*Ga+3]=0>Oa?-1:1}var b=this.index,d=this.attributes;if(null===b||void 0===d.position||void 0===d.normal||void 0===d.uv)console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");else{b=b.array;var g=d.position.array,l=d.normal.array,r=d.uv.array,v=g.length/3;void 0===d.tangent&&this.setAttribute("tangent",new M(new Float32Array(4*v),4));var x=d.tangent.array,
w=[],A=[];for(d=0;d<v;d++)w[d]=new da,A[d]=new da;var D=new da,J=new da,N=new da,L=new ib,S=new ib,P=new ib,ka=new da,ia=new da;d=this.groups;0===d.length&&(d=[{start:0,count:b.length}]);v=0;for(var la=d.length;v<la;++v){var oa=d[v],Ca=oa.start,Aa=Ca;for(oa=Ca+oa.count;Aa<oa;Aa+=3)c(b[Aa+0],b[Aa+1],b[Aa+2])}var ra=new da,Ja=new da,Ra=new da,xa=new da;v=0;for(la=d.length;v<la;++v)for(oa=d[v],Aa=Ca=oa.start,oa=Ca+oa.count;Aa<oa;Aa+=3)f(b[Aa+0]),f(b[Aa+1]),f(b[Aa+2])}},computeVertexNormals:function(){var c=
this.index,f=this.getAttribute("position");if(void 0!==f){var b=this.getAttribute("normal");if(void 0===b)b=new M(new Float32Array(3*f.count),3),this.setAttribute("normal",b);else for(var d=0,g=b.count;d<g;d++)b.setXYZ(d,0,0,0);d=new da;g=new da;var l=new da,r=new da,v=new da,x=new da,w=new da,A=new da;if(c)for(var D=0,J=c.count;D<J;D+=3){var N=c.getX(D+0),L=c.getX(D+1),S=c.getX(D+2);d.fromBufferAttribute(f,N);g.fromBufferAttribute(f,L);l.fromBufferAttribute(f,S);w.subVectors(l,g);A.subVectors(d,
g);w.cross(A);r.fromBufferAttribute(b,N);v.fromBufferAttribute(b,L);x.fromBufferAttribute(b,S);r.add(w);v.add(w);x.add(w);b.setXYZ(N,r.x,r.y,r.z);b.setXYZ(L,v.x,v.y,v.z);b.setXYZ(S,x.x,x.y,x.z)}else for(c=0,r=f.count;c<r;c+=3)d.fromBufferAttribute(f,c+0),g.fromBufferAttribute(f,c+1),l.fromBufferAttribute(f,c+2),w.subVectors(l,g),A.subVectors(d,g),w.cross(A),b.setXYZ(c+0,w.x,w.y,w.z),b.setXYZ(c+1,w.x,w.y,w.z),b.setXYZ(c+2,w.x,w.y,w.z);this.normalizeNormals();b.needsUpdate=!0}},merge:function(c,f){if(c&&
c.isBufferGeometry){void 0===f&&(f=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var b=this.attributes,d;for(d in b)if(void 0!==c.attributes[d]){var g=b[d].array,l=c.attributes[d],r=l.array,v=l.itemSize*f;l=Math.min(r.length,g.length-v);for(var x=0;x<l;x++,v++)g[v]=r[x]}return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",
c)},normalizeNormals:function(){for(var c=this.attributes.normal,f=0,b=c.count;f<b;f++)Kc.fromBufferAttribute(c,f),Kc.normalize(),c.setXYZ(f,Kc.x,Kc.y,Kc.z)},toNonIndexed:function(){function c(A,D){var J=A.array,N=A.itemSize;A=A.normalized;for(var L=new J.constructor(D.length*N),S,P=0,ka=0,ia=D.length;ka<ia;ka++){S=D[ka]*N;for(var la=0;la<N;la++)L[P++]=J[S++]}return new M(L,N,A)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),
this;var f=new Na,b=this.index.array,d=this.attributes;for(r in d){var g=c(d[r],b);f.setAttribute(r,g)}d=this.morphAttributes;for(var l in d){var r=[];g=d[l];for(var v=0,x=g.length;v<x;v++){var w=c(g[v],b);r.push(w)}f.morphAttributes[l]=r}f.morphTargetsRelative=this.morphTargetsRelative;b=this.groups;l=0;for(d=b.length;l<d;l++)r=b[l],f.addGroup(r.start,r.count,r.materialIndex);return f},toJSON:function(){var c={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};c.uuid=
this.uuid;c.type=this.type;""!==this.name&&(c.name=this.name);0<Object.keys(this.userData).length&&(c.userData=this.userData);if(void 0!==this.parameters){var f=this.parameters;for(b in f)void 0!==f[b]&&(c[b]=f[b]);return c}c.data={attributes:{}};var b=this.index;null!==b&&(c.data.index={type:b.array.constructor.name,array:Array.prototype.slice.call(b.array)});b=this.attributes;for(var d in b){var g=b[d],l=g.toJSON(c.data);""!==g.name&&(l.name=g.name);c.data.attributes[d]=l}d={};b=!1;for(f in this.morphAttributes){g=
this.morphAttributes[f];l=[];for(var r=0,v=g.length;r<v;r++){var x=g[r],w=x.toJSON(c.data);""!==x.name&&(w.name=x.name);l.push(w)}0<l.length&&(d[f]=l,b=!0)}b&&(c.data.morphAttributes=d,c.data.morphTargetsRelative=this.morphTargetsRelative);f=this.groups;0<f.length&&(c.data.groups=JSON.parse(JSON.stringify(f)));f=this.boundingSphere;null!==f&&(c.data.boundingSphere={center:f.center.toArray(),radius:f.radius});return c},clone:function(){return(new Na).copy(this)},copy:function(c){this.index=null;this.attributes=
{};this.morphAttributes={};this.groups=[];this.boundingSphere=this.boundingBox=null;var f={};this.name=c.name;var b=c.index;null!==b&&this.setIndex(b.clone(f));b=c.attributes;for(var d in b)this.setAttribute(d,b[d].clone(f));d=c.morphAttributes;for(var g in d){b=[];for(var l=d[g],r=0,v=l.length;r<v;r++)b.push(l[r].clone(f));this.morphAttributes[g]=b}this.morphTargetsRelative=c.morphTargetsRelative;f=c.groups;g=0;for(d=f.length;g<d;g++)b=f[g],this.addGroup(b.start,b.count,b.materialIndex);f=c.boundingBox;
null!==f&&(this.boundingBox=f.clone());f=c.boundingSphere;null!==f&&(this.boundingSphere=f.clone());this.drawRange.start=c.drawRange.start;this.drawRange.count=c.drawRange.count;this.userData=c.userData;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var jk=new ec,Jf=new zf,bj=new Be,ie=new da,je=new da,ke=new da,Wh=new da,Xh=new da,Yh=new da,xg=new da,yg=new da,zg=new da,Bg=new ib,Cg=new ib,Dg=new ib,Zh=new da,Ag=new da;$a.prototype=Object.assign(Object.create(T.prototype),
{constructor:$a,isMesh:!0,copy:function(c){T.prototype.copy.call(this,c);void 0!==c.morphTargetInfluences&&(this.morphTargetInfluences=c.morphTargetInfluences.slice());void 0!==c.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},c.morphTargetDictionary));this.material=c.material;this.geometry=c.geometry;return this},updateMorphTargets:function(){var c=this.geometry;if(c.isBufferGeometry){c=c.morphAttributes;var f=Object.keys(c);if(0<f.length&&(c=c[f[0]],void 0!==c)){this.morphTargetInfluences=
[];this.morphTargetDictionary={};f=0;for(var b=c.length;f<b;f++){var d=c[f].name||String(f);this.morphTargetInfluences.push(0);this.morphTargetDictionary[d]=f}}}else c=c.morphTargets,void 0!==c&&0<c.length&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")},raycast:function(c,f){var b=this.geometry,d=this.material,g=this.matrixWorld;if(void 0!==d&&(null===b.boundingSphere&&b.computeBoundingSphere(),bj.copy(b.boundingSphere),bj.applyMatrix4(g),
!1!==c.ray.intersectsSphere(bj)&&(jk.copy(g).invert(),Jf.copy(c.ray).applyMatrix4(jk),null===b.boundingBox||!1!==Jf.intersectsBox(b.boundingBox))))if(b.isBufferGeometry){var l=b.index;g=b.attributes.position;var r=b.morphAttributes.position,v=b.morphTargetsRelative,x=b.attributes.uv,w=b.attributes.uv2,A=b.groups;b=b.drawRange;if(null!==l)if(Array.isArray(d))for(var D=0,J=A.length;D<J;D++)for(var N=A[D],L=d[N.materialIndex],S=Math.max(N.start,b.start),P=Math.min(N.start+N.count,b.start+b.count);S<
P;S+=3){var ka=l.getX(S);var ia=l.getX(S+1),la=l.getX(S+2);if(ka=rb(this,L,c,Jf,g,r,v,x,w,ka,ia,la))ka.faceIndex=Math.floor(S/3),ka.face.materialIndex=N.materialIndex,f.push(ka)}else for(A=Math.max(0,b.start),b=Math.min(l.count,b.start+b.count);A<b;A+=3){if(ka=l.getX(A),D=l.getX(A+1),J=l.getX(A+2),ka=rb(this,d,c,Jf,g,r,v,x,w,ka,D,J))ka.faceIndex=Math.floor(A/3),f.push(ka)}else if(void 0!==g)if(Array.isArray(d))for(l=0,D=A.length;l<D;l++)for(J=A[l],N=d[J.materialIndex],L=Math.max(J.start,b.start),
S=Math.min(J.start+J.count,b.start+b.count);L<S;L+=3){if(ka=rb(this,N,c,Jf,g,r,v,x,w,L,L+1,L+2))ka.faceIndex=Math.floor(L/3),ka.face.materialIndex=J.materialIndex,f.push(ka)}else for(A=Math.max(0,b.start),b=Math.min(g.count,b.start+b.count);A<b;A+=3)if(ka=rb(this,d,c,Jf,g,r,v,x,w,A,A+1,A+2))ka.faceIndex=Math.floor(A/3),f.push(ka)}else b.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}});var Ie=function(c){function f(b,d,g,l,r,
v){function x(ka,ia,la,oa,Ca,Aa,ra,Ja,Ra,xa,Ga){var Oa=Aa/Ra,nb=ra/xa,Ba=Aa/2,Ea=ra/2,Pa=Ja/2;ra=Ra+1;for(var qb=xa+1,Va=Aa=0,Db=new da,Sb=0;Sb<qb;Sb++)for(var $b=Sb*nb-Ea,lc=0;lc<ra;lc++)Db[ka]=(lc*Oa-Ba)*oa,Db[ia]=$b*Ca,Db[la]=Pa,J.push(Db.x,Db.y,Db.z),Db[ka]=0,Db[ia]=0,Db[la]=0<Ja?1:-1,N.push(Db.x,Db.y,Db.z),L.push(lc/Ra),L.push(1-Sb/xa),Aa+=1;for(ka=0;ka<xa;ka++)for(ia=0;ia<Ra;ia++)la=S+ia+ra*(ka+1),oa=S+(ia+1)+ra*(ka+1),Ca=S+(ia+1)+ra*ka,D.push(S+ia+ra*ka,la,Ca),D.push(la,oa,Ca),Va+=6;A.addGroup(P,
Va,Ga);P+=Va;S+=Aa}void 0===b&&(b=1);void 0===d&&(d=1);void 0===g&&(g=1);void 0===l&&(l=1);void 0===r&&(r=1);void 0===v&&(v=1);var w=c.call(this)||this;w.type="BoxGeometry";w.parameters={width:b,height:d,depth:g,widthSegments:l,heightSegments:r,depthSegments:v};var A=C(w);l=Math.floor(l);r=Math.floor(r);v=Math.floor(v);var D=[],J=[],N=[],L=[],S=0,P=0;x("z","y","x",-1,-1,g,d,b,v,r,0);x("z","y","x",1,-1,g,d,-b,v,r,1);x("x","z","y",1,1,b,g,d,l,v,2);x("x","z","y",1,-1,b,g,-d,l,v,3);x("x","y","z",1,-1,
b,d,g,l,r,4);x("x","y","z",-1,-1,b,d,-g,l,r,5);w.setIndex(D);w.setAttribute("position",new Ya(J,3));w.setAttribute("normal",new Ya(N,3));w.setAttribute("uv",new Ya(L,2));return w}y(f,c);return f}(Na),Dj={clone:lb,merge:jb};yb.prototype=Object.create(U.prototype);yb.prototype.constructor=yb;yb.prototype.isShaderMaterial=!0;yb.prototype.copy=function(c){U.prototype.copy.call(this,c);this.fragmentShader=c.fragmentShader;this.vertexShader=c.vertexShader;this.uniforms=lb(c.uniforms);this.defines=Object.assign({},
c.defines);this.wireframe=c.wireframe;this.wireframeLinewidth=c.wireframeLinewidth;this.lights=c.lights;this.clipping=c.clipping;this.skinning=c.skinning;this.morphTargets=c.morphTargets;this.morphNormals=c.morphNormals;this.extensions=Object.assign({},c.extensions);this.glslVersion=c.glslVersion;return this};yb.prototype.toJSON=function(c){var f=U.prototype.toJSON.call(this,c);f.glslVersion=this.glslVersion;f.uniforms={};for(var b in this.uniforms){var d=this.uniforms[b].value;f.uniforms[b]=d&&d.isTexture?
{type:"t",value:d.toJSON(c).uuid}:d&&d.isColor?{type:"c",value:d.getHex()}:d&&d.isVector2?{type:"v2",value:d.toArray()}:d&&d.isVector3?{type:"v3",value:d.toArray()}:d&&d.isVector4?{type:"v4",value:d.toArray()}:d&&d.isMatrix3?{type:"m3",value:d.toArray()}:d&&d.isMatrix4?{type:"m4",value:d.toArray()}:{value:d}}0<Object.keys(this.defines).length&&(f.defines=this.defines);f.vertexShader=this.vertexShader;f.fragmentShader=this.fragmentShader;c={};for(var g in this.extensions)!0===this.extensions[g]&&(c[g]=
!0);0<Object.keys(c).length&&(f.extensions=c);return f};wb.prototype=Object.assign(Object.create(T.prototype),{constructor:wb,isCamera:!0,copy:function(c,f){T.prototype.copy.call(this,c,f);this.matrixWorldInverse.copy(c.matrixWorldInverse);this.projectionMatrix.copy(c.projectionMatrix);this.projectionMatrixInverse.copy(c.projectionMatrixInverse);return this},getWorldDirection:function(c){void 0===c&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),c=new da);this.updateWorldMatrix(!0,
!1);var f=this.matrixWorld.elements;return c.set(-f[8],-f[9],-f[10]).normalize()},updateMatrixWorld:function(c){T.prototype.updateMatrixWorld.call(this,c);this.matrixWorldInverse.copy(this.matrixWorld).invert()},updateWorldMatrix:function(c,f){T.prototype.updateWorldMatrix.call(this,c,f);this.matrixWorldInverse.copy(this.matrixWorld).invert()},clone:function(){return(new this.constructor).copy(this)}});Bb.prototype=Object.assign(Object.create(wb.prototype),{constructor:Bb,isPerspectiveCamera:!0,copy:function(c,
f){wb.prototype.copy.call(this,c,f);this.fov=c.fov;this.zoom=c.zoom;this.near=c.near;this.far=c.far;this.focus=c.focus;this.aspect=c.aspect;this.view=null===c.view?null:Object.assign({},c.view);this.filmGauge=c.filmGauge;this.filmOffset=c.filmOffset;return this},setFocalLength:function(c){c=.5*this.getFilmHeight()/c;this.fov=2*Qb.RAD2DEG*Math.atan(c);this.updateProjectionMatrix()},getFocalLength:function(){var c=Math.tan(.5*Qb.DEG2RAD*this.fov);return.5*this.getFilmHeight()/c},getEffectiveFOV:function(){return 2*
Qb.RAD2DEG*Math.atan(Math.tan(.5*Qb.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(c,f,b,d,g,l){this.aspect=c/f;null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1});this.view.enabled=!0;this.view.fullWidth=c;this.view.fullHeight=f;this.view.offsetX=b;this.view.offsetY=d;this.view.width=g;this.view.height=
l;this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1);this.updateProjectionMatrix()},updateProjectionMatrix:function(){var c=this.near,f=c*Math.tan(.5*Qb.DEG2RAD*this.fov)/this.zoom,b=2*f,d=this.aspect*b,g=-.5*d,l=this.view;if(null!==this.view&&this.view.enabled){var r=l.fullWidth,v=l.fullHeight;g+=l.offsetX*d/r;f-=l.offsetY*b/v;d*=l.width/r;b*=l.height/v}l=this.filmOffset;0!==l&&(g+=c*l/this.getFilmWidth());this.projectionMatrix.makePerspective(g,g+
d,f,f-b,c,this.far);this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(c){c=T.prototype.toJSON.call(this,c);c.object.fov=this.fov;c.object.zoom=this.zoom;c.object.near=this.near;c.object.far=this.far;c.object.focus=this.focus;c.object.aspect=this.aspect;null!==this.view&&(c.object.view=Object.assign({},this.view));c.object.filmGauge=this.filmGauge;c.object.filmOffset=this.filmOffset;return c}});Tb.prototype=Object.create(T.prototype);Tb.prototype.constructor=Tb;Ob.prototype=
Object.create(R.prototype);Ob.prototype.constructor=Ob;Ob.prototype.isCubeTexture=!0;Object.defineProperty(Ob.prototype,"images",{get:function(){return this.image},set:function(c){this.image=c}});var ai=function(c){function f(d,g,l){Number.isInteger(g)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),g=l);d=c.call(this,d,d,g)||this;Object.defineProperty(C(d),"isWebGLCubeRenderTarget",{value:!0});g=g||{};d.texture=new Ob(void 0,g.mapping,
g.wrapS,g.wrapT,g.magFilter,g.minFilter,g.format,g.type,g.anisotropy,g.encoding);d.texture._needsFlipEnvMap=!1;return d}y(f,c);var b=f.prototype;b.fromEquirectangularTexture=function(d,g){this.texture.type=g.type;this.texture.format=1023;this.texture.encoding=g.encoding;this.texture.generateMipmaps=g.generateMipmaps;this.texture.minFilter=g.minFilter;this.texture.magFilter=g.magFilter;var l=new Ie(5,5,5),r=new yb({name:"CubemapFromEquirect",uniforms:lb({tEquirect:{value:null}}),vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",
fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",side:1,blending:0});r.uniforms.tEquirect.value=g;l=new $a(l,r);r=g.minFilter;1008===g.minFilter&&(g.minFilter=1006);(new Tb(1,10,this)).update(d,l);g.minFilter=
r;l.geometry.dispose();l.material.dispose();return this};b.clear=function(d,g,l,r){for(var v=d.getRenderTarget(),x=0;6>x;x++)d.setRenderTarget(this,x),d.clear(g,l,r);d.setRenderTarget(v)};return f}(pe);Ab.prototype=Object.create(R.prototype);Ab.prototype.constructor=Ab;Ab.prototype.isDataTexture=!0;var Kf=new Be,uh=new da,Yf=function(){function c(b,d,g,l,r,v){this.planes=[void 0!==b?b:new yd,void 0!==d?d:new yd,void 0!==g?g:new yd,void 0!==l?l:new yd,void 0!==r?r:new yd,void 0!==v?v:new yd]}var f=
c.prototype;f.set=function(b,d,g,l,r,v){var x=this.planes;x[0].copy(b);x[1].copy(d);x[2].copy(g);x[3].copy(l);x[4].copy(r);x[5].copy(v);return this};f.clone=function(){return(new this.constructor).copy(this)};f.copy=function(b){for(var d=this.planes,g=0;6>g;g++)d[g].copy(b.planes[g]);return this};f.setFromProjectionMatrix=function(b){var d=this.planes,g=b.elements;b=g[0];var l=g[1],r=g[2],v=g[3],x=g[4],w=g[5],A=g[6],D=g[7],J=g[8],N=g[9],L=g[10],S=g[11],P=g[12],ka=g[13],ia=g[14];g=g[15];d[0].setComponents(v-
b,D-x,S-J,g-P).normalize();d[1].setComponents(v+b,D+x,S+J,g+P).normalize();d[2].setComponents(v+l,D+w,S+N,g+ka).normalize();d[3].setComponents(v-l,D-w,S-N,g-ka).normalize();d[4].setComponents(v-r,D-A,S-L,g-ia).normalize();d[5].setComponents(v+r,D+A,S+L,g+ia).normalize();return this};f.intersectsObject=function(b){var d=b.geometry;null===d.boundingSphere&&d.computeBoundingSphere();Kf.copy(d.boundingSphere).applyMatrix4(b.matrixWorld);return this.intersectsSphere(Kf)};f.intersectsSprite=function(b){Kf.center.set(0,
0,0);Kf.radius=.7071067811865476;Kf.applyMatrix4(b.matrixWorld);return this.intersectsSphere(Kf)};f.intersectsSphere=function(b){var d=this.planes,g=b.center;b=-b.radius;for(var l=0;6>l;l++)if(d[l].distanceToPoint(g)<b)return!1;return!0};f.intersectsBox=function(b){for(var d=this.planes,g=0;6>g;g++){var l=d[g];uh.x=0<l.normal.x?b.max.x:b.min.x;uh.y=0<l.normal.y?b.max.y:b.min.y;uh.z=0<l.normal.z?b.max.z:b.min.z;if(0>l.distanceToPoint(uh))return!1}return!0};f.containsPoint=function(b){for(var d=this.planes,
g=0;6>g;g++)if(0>d[g].distanceToPoint(b))return!1;return!0};return c}(),Qf=function(c){function f(b,d,g,l){void 0===b&&(b=1);void 0===d&&(d=1);void 0===g&&(g=1);void 0===l&&(l=1);var r=c.call(this)||this;r.type="PlaneGeometry";r.parameters={width:b,height:d,widthSegments:g,heightSegments:l};var v=b/2,x=d/2;g=Math.floor(g);l=Math.floor(l);var w=g+1,A=l+1,D=b/g,J=d/l;d=[];b=[];for(var N=[],L=[],S=0;S<A;S++)for(var P=S*J-x,ka=0;ka<w;ka++)b.push(ka*D-v,-P,0),N.push(0,0,1),L.push(ka/g),L.push(1-S/l);for(v=
0;v<l;v++)for(x=0;x<g;x++)A=x+w*(v+1),D=x+1+w*(v+1),J=x+1+w*v,d.push(x+w*v,A,J),d.push(A,D,J);r.setIndex(d);r.setAttribute("position",new Ya(b,3));r.setAttribute("normal",new Ya(N,3));r.setAttribute("uv",new Ya(L,2));return r}y(f,c);return f}(Na),cc={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",
aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",
begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",
bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",
clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",
clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",
color_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor.xyz *= color.xyz;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",
cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",
defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",
displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",
emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",
envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",
envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",
envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",
envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",
fog_vertex:"#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",
gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",
lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",
lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",
lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",
lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",
lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",
lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(\t\t0, 1,\t\t0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",
lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",
lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",
lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",
logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",
map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",
map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",
morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",
morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",
normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",
normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",
normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",
clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",
packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",
premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",
roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",
shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",
shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",
shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",
skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",
skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",
specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(\t1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,\t1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,\t1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",
transmissionmap_fragment:"#ifdef USE_TRANSMISSIONMAP\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n#endif",transmissionmap_pars_fragment:"#ifdef USE_TRANSMISSIONMAP\n\tuniform sampler2D transmissionMap;\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",
uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",
background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",
cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",
depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",
distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",
distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",
equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",
linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",
linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",
meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",
meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",
meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",
meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",
meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",
meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",
meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",
meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",
meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",
meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",
meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",
meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",
normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",
normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",
points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",
points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",
shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",
sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",
sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},
zb={common:{diffuse:{value:new Cb(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new fd},uv2Transform:{value:new fd},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},
bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new ib(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:2.5E-4},fogNear:{value:1},fogFar:{value:2E3},fogColor:{value:new Cb(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],
properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],
properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Cb(15658734)},opacity:{value:1},
size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new fd}},sprite:{diffuse:{value:new Cb(15658734)},opacity:{value:1},center:{value:new ib(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new fd}}},md={basic:{uniforms:jb([zb.common,zb.specularmap,zb.envmap,zb.aomap,zb.lightmap,zb.fog]),vertexShader:cc.meshbasic_vert,fragmentShader:cc.meshbasic_frag},lambert:{uniforms:jb([zb.common,zb.specularmap,zb.envmap,zb.aomap,zb.lightmap,
zb.emissivemap,zb.fog,zb.lights,{emissive:{value:new Cb(0)}}]),vertexShader:cc.meshlambert_vert,fragmentShader:cc.meshlambert_frag},phong:{uniforms:jb([zb.common,zb.specularmap,zb.envmap,zb.aomap,zb.lightmap,zb.emissivemap,zb.bumpmap,zb.normalmap,zb.displacementmap,zb.fog,zb.lights,{emissive:{value:new Cb(0)},specular:{value:new Cb(1118481)},shininess:{value:30}}]),vertexShader:cc.meshphong_vert,fragmentShader:cc.meshphong_frag},standard:{uniforms:jb([zb.common,zb.envmap,zb.aomap,zb.lightmap,zb.emissivemap,
zb.bumpmap,zb.normalmap,zb.displacementmap,zb.roughnessmap,zb.metalnessmap,zb.fog,zb.lights,{emissive:{value:new Cb(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:cc.meshphysical_vert,fragmentShader:cc.meshphysical_frag},toon:{uniforms:jb([zb.common,zb.aomap,zb.lightmap,zb.emissivemap,zb.bumpmap,zb.normalmap,zb.displacementmap,zb.gradientmap,zb.fog,zb.lights,{emissive:{value:new Cb(0)}}]),vertexShader:cc.meshtoon_vert,fragmentShader:cc.meshtoon_frag},matcap:{uniforms:jb([zb.common,
zb.bumpmap,zb.normalmap,zb.displacementmap,zb.fog,{matcap:{value:null}}]),vertexShader:cc.meshmatcap_vert,fragmentShader:cc.meshmatcap_frag},points:{uniforms:jb([zb.points,zb.fog]),vertexShader:cc.points_vert,fragmentShader:cc.points_frag},dashed:{uniforms:jb([zb.common,zb.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:cc.linedashed_vert,fragmentShader:cc.linedashed_frag},depth:{uniforms:jb([zb.common,zb.displacementmap]),vertexShader:cc.depth_vert,fragmentShader:cc.depth_frag},
normal:{uniforms:jb([zb.common,zb.bumpmap,zb.normalmap,zb.displacementmap,{opacity:{value:1}}]),vertexShader:cc.normal_vert,fragmentShader:cc.normal_frag},sprite:{uniforms:jb([zb.sprite,zb.fog]),vertexShader:cc.sprite_vert,fragmentShader:cc.sprite_frag},background:{uniforms:{uvTransform:{value:new fd},t2D:{value:null}},vertexShader:cc.background_vert,fragmentShader:cc.background_frag},cube:{uniforms:jb([zb.envmap,{opacity:{value:1}}]),vertexShader:cc.cube_vert,fragmentShader:cc.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},
vertexShader:cc.equirect_vert,fragmentShader:cc.equirect_frag},distanceRGBA:{uniforms:jb([zb.common,zb.displacementmap,{referencePosition:{value:new da},nearDistance:{value:1},farDistance:{value:1E3}}]),vertexShader:cc.distanceRGBA_vert,fragmentShader:cc.distanceRGBA_frag},shadow:{uniforms:jb([zb.lights,zb.fog,{color:{value:new Cb(0)},opacity:{value:1}}]),vertexShader:cc.shadow_vert,fragmentShader:cc.shadow_frag}};md.physical={uniforms:jb([md.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},
clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new ib(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Cb(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:cc.meshphysical_vert,fragmentShader:cc.meshphysical_frag};pb.prototype=Object.create(R.prototype);pb.prototype.constructor=pb;pb.prototype.isDataTexture2DArray=!0;Kb.prototype=Object.create(R.prototype);Kb.prototype.constructor=Kb;Kb.prototype.isDataTexture3D=!0;var zj=new R,
jl=new pb,kl=new Kb,Aj=new Ob,uj=[],vj=[],yj=new Float32Array(16),xj=new Float32Array(9),wj=new Float32Array(4);Tf.prototype.updateCache=function(c){var f=this.cache;c instanceof Float32Array&&f.length!==c.length&&(this.cache=new Float32Array(c.length));Ub(f,c)};Lg.prototype.setValue=function(c,f,b){for(var d=this.seq,g=0,l=d.length;g!==l;++g){var r=d[g];r.setValue(c,f[r.id],b)}};var gi=/(\w+)(\])?(\[|\.)?/g;Ad.prototype.setValue=function(c,f,b,d){f=this.map[f];void 0!==f&&f.setValue(c,b,d)};Ad.prototype.setOptional=
function(c,f,b){f=f[b];void 0!==f&&this.setValue(c,b,f)};Ad.upload=function(c,f,b,d){for(var g=0,l=f.length;g!==l;++g){var r=f[g],v=b[r.id];!1!==v.needsUpdate&&r.setValue(c,v.value,d)}};Ad.seqWithValue=function(c,f){for(var b=[],d=0,g=c.length;d!==g;++d){var l=c[d];l.id in f&&b.push(l)}return b};var ll=0,ii=/^[ \t]*#include +<([\w\d./]+)>/gm,Cj=/#pragma unroll_loop[\s]+?for \( int i = (\d+); i < (\d+); i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Bj=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g,
ml=0;Bd.prototype=Object.create(U.prototype);Bd.prototype.constructor=Bd;Bd.prototype.isMeshDepthMaterial=!0;Bd.prototype.copy=function(c){U.prototype.copy.call(this,c);this.depthPacking=c.depthPacking;this.skinning=c.skinning;this.morphTargets=c.morphTargets;this.map=c.map;this.alphaMap=c.alphaMap;this.displacementMap=c.displacementMap;this.displacementScale=c.displacementScale;this.displacementBias=c.displacementBias;this.wireframe=c.wireframe;this.wireframeLinewidth=c.wireframeLinewidth;return this};
Cd.prototype=Object.create(U.prototype);Cd.prototype.constructor=Cd;Cd.prototype.isMeshDistanceMaterial=!0;Cd.prototype.copy=function(c){U.prototype.copy.call(this,c);this.referencePosition.copy(c.referencePosition);this.nearDistance=c.nearDistance;this.farDistance=c.farDistance;this.skinning=c.skinning;this.morphTargets=c.morphTargets;this.map=c.map;this.alphaMap=c.alphaMap;this.displacementMap=c.displacementMap;this.displacementScale=c.displacementScale;this.displacementBias=c.displacementBias;
return this};rf.prototype=Object.assign(Object.create(Bb.prototype),{constructor:rf,isArrayCamera:!0});Dd.prototype=Object.assign(Object.create(T.prototype),{constructor:Dd,isGroup:!0});Object.assign(Oe.prototype,{constructor:Oe,getHandSpace:function(){null===this._hand&&(this._hand=new Dd,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1});return this._hand},getTargetRaySpace:function(){null===this._targetRay&&(this._targetRay=new Dd,this._targetRay.matrixAutoUpdate=
!1,this._targetRay.visible=!1);return this._targetRay},getGripSpace:function(){null===this._grip&&(this._grip=new Dd,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1);return this._grip},dispatchEvent:function(c){null!==this._targetRay&&this._targetRay.dispatchEvent(c);null!==this._grip&&this._grip.dispatchEvent(c);null!==this._hand&&this._hand.dispatchEvent(c);return this},disconnect:function(c){this.dispatchEvent({type:"disconnected",data:c});null!==this._targetRay&&(this._targetRay.visible=
!1);null!==this._grip&&(this._grip.visible=!1);null!==this._hand&&(this._hand.visible=!1);return this},update:function(c,f,b){var d=null,g=null,l=null,r=this._targetRay,v=this._grip,x=this._hand;if(c&&"visible-blurred"!==f.session.visibilityState)if(x&&c.hand){l=!0;for(var w=H(c.hand.values()),A;!(A=w()).done;){var D=A.value;A=f.getJointPose(D,b);if(void 0===x.joints[D.jointName]){var J=new Dd;J.matrixAutoUpdate=!1;J.visible=!1;x.joints[D.jointName]=J;x.add(J)}D=x.joints[D.jointName];null!==A&&(D.matrix.fromArray(A.transform.matrix),
D.matrix.decompose(D.position,D.rotation,D.scale),D.jointRadius=A.radius);D.visible=null!==A}f=x.joints["index-finger-tip"].position.distanceTo(x.joints["thumb-tip"].position);x.inputState.pinching&&.025<f?(x.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:c.handedness,target:this})):!x.inputState.pinching&&.015>=f&&(x.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:c.handedness,target:this}))}else null!==r&&(d=f.getPose(c.targetRaySpace,b),null!==d&&
(r.matrix.fromArray(d.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale))),null!==v&&c.gripSpace&&(g=f.getPose(c.gripSpace,b),null!==g&&(v.matrix.fromArray(g.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale)));null!==r&&(r.visible=null!==d);null!==v&&(v.visible=null!==g);null!==x&&(x.visible=null!==l);return this}});Object.assign(ac.prototype,O.prototype);sf.prototype=Object.assign(Object.create(qe.prototype),{constructor:sf,isWebGL1Renderer:!0});var kk=function(){function c(b,
d){Object.defineProperty(this,"isFogExp2",{value:!0});this.name="";this.color=new Cb(b);this.density=void 0!==d?d:2.5E-4}var f=c.prototype;f.clone=function(){return new c(this.color,this.density)};f.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}};return c}(),lk=function(){function c(b,d,g){Object.defineProperty(this,"isFog",{value:!0});this.name="";this.color=new Cb(b);this.near=void 0!==d?d:1;this.far=void 0!==g?g:1E3}var f=c.prototype;f.clone=function(){return new c(this.color,
this.near,this.far)};f.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}};return c}(),cj=function(c){function f(){var d=c.call(this)||this;Object.defineProperty(C(d),"isScene",{value:!0});d.type="Scene";d.background=null;d.environment=null;d.fog=null;d.overrideMaterial=null;d.autoUpdate=!0;"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:C(d)}));return d}y(f,c);var b=f.prototype;b.copy=function(d,g){c.prototype.copy.call(this,
d,g);null!==d.background&&(this.background=d.background.clone());null!==d.environment&&(this.environment=d.environment.clone());null!==d.fog&&(this.fog=d.fog.clone());null!==d.overrideMaterial&&(this.overrideMaterial=d.overrideMaterial.clone());this.autoUpdate=d.autoUpdate;this.matrixAutoUpdate=d.matrixAutoUpdate;return this};b.toJSON=function(d){var g=c.prototype.toJSON.call(this,d);null!==this.background&&(g.object.background=this.background.toJSON(d));null!==this.environment&&(g.object.environment=
this.environment.toJSON(d));null!==this.fog&&(g.object.fog=this.fog.toJSON());return g};return f}(T);Object.defineProperty(Tc.prototype,"needsUpdate",{set:function(c){!0===c&&this.version++}});Object.assign(Tc.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(c){this.usage=c;return this},copy:function(c){this.array=new c.array.constructor(c.array);this.count=c.count;this.stride=c.stride;this.usage=c.usage;return this},copyAt:function(c,f,b){c*=this.stride;b*=f.stride;
for(var d=0,g=this.stride;d<g;d++)this.array[c+d]=f.array[b+d];return this},set:function(c,f){void 0===f&&(f=0);this.array.set(c,f);return this},clone:function(c){void 0===c.arrayBuffers&&(c.arrayBuffers={});void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Qb.generateUUID());void 0===c.arrayBuffers[this.array.buffer._uuid]&&(c.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);c=new this.array.constructor(c.arrayBuffers[this.array.buffer._uuid]);c=new Tc(c,this.stride);c.setUsage(this.usage);
return c},onUpload:function(c){this.onUploadCallback=c;return this},toJSON:function(c){void 0===c.arrayBuffers&&(c.arrayBuffers={});void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Qb.generateUUID());void 0===c.arrayBuffers[this.array.buffer._uuid]&&(c.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer)));return{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});var bf=new da;Object.defineProperties(od.prototype,
{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(c){this.data.needsUpdate=c}}});Object.assign(od.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(c){for(var f=0,b=this.data.count;f<b;f++)bf.x=this.getX(f),bf.y=this.getY(f),bf.z=this.getZ(f),bf.applyMatrix4(c),this.setXYZ(f,bf.x,bf.y,bf.z);return this},setX:function(c,f){this.data.array[c*this.data.stride+this.offset]=f;return this},setY:function(c,f){this.data.array[c*
this.data.stride+this.offset+1]=f;return this},setZ:function(c,f){this.data.array[c*this.data.stride+this.offset+2]=f;return this},setW:function(c,f){this.data.array[c*this.data.stride+this.offset+3]=f;return this},getX:function(c){return this.data.array[c*this.data.stride+this.offset]},getY:function(c){return this.data.array[c*this.data.stride+this.offset+1]},getZ:function(c){return this.data.array[c*this.data.stride+this.offset+2]},getW:function(c){return this.data.array[c*this.data.stride+this.offset+
3]},setXY:function(c,f,b){c=c*this.data.stride+this.offset;this.data.array[c+0]=f;this.data.array[c+1]=b;return this},setXYZ:function(c,f,b,d){c=c*this.data.stride+this.offset;this.data.array[c+0]=f;this.data.array[c+1]=b;this.data.array[c+2]=d;return this},setXYZW:function(c,f,b,d,g){c=c*this.data.stride+this.offset;this.data.array[c+0]=f;this.data.array[c+1]=b;this.data.array[c+2]=d;this.data.array[c+3]=g;return this},clone:function(c){if(void 0===c){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");
c=[];for(var f=0;f<this.count;f++)for(var b=f*this.data.stride+this.offset,d=0;d<this.itemSize;d++)c.push(this.data.array[b+d]);return new M(new this.array.constructor(c),this.itemSize,this.normalized)}void 0===c.interleavedBuffers&&(c.interleavedBuffers={});void 0===c.interleavedBuffers[this.data.uuid]&&(c.interleavedBuffers[this.data.uuid]=this.data.clone(c));return new od(c.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(c){if(void 0===c){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");
c=[];for(var f=0;f<this.count;f++)for(var b=f*this.data.stride+this.offset,d=0;d<this.itemSize;d++)c.push(this.data.array[b+d]);return{itemSize:this.itemSize,type:this.array.constructor.name,array:c,normalized:this.normalized}}void 0===c.interleavedBuffers&&(c.interleavedBuffers={});void 0===c.interleavedBuffers[this.data.uuid]&&(c.interleavedBuffers[this.data.uuid]=this.data.toJSON(c));return{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}});
pd.prototype=Object.create(U.prototype);pd.prototype.constructor=pd;pd.prototype.isSpriteMaterial=!0;pd.prototype.copy=function(c){U.prototype.copy.call(this,c);this.color.copy(c.color);this.map=c.map;this.alphaMap=c.alphaMap;this.rotation=c.rotation;this.sizeAttenuation=c.sizeAttenuation;return this};var tf,ng=new da,Lf=new da,Mf=new da,vf=new ib,ag=new ib,Ij=new ec,vh=new da,og=new da,wh=new da,mk=new ib,dj=new ib,nk=new ib;Qe.prototype=Object.assign(Object.create(T.prototype),{constructor:Qe,isSprite:!0,
raycast:function(c,f){null===c.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.');Lf.setFromMatrixScale(this.matrixWorld);Ij.copy(c.camera.matrixWorld);this.modelViewMatrix.multiplyMatrices(c.camera.matrixWorldInverse,this.matrixWorld);Mf.setFromMatrixPosition(this.modelViewMatrix);c.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Lf.multiplyScalar(-Mf.z);var b=this.material.rotation;if(0!==b){var d=Math.cos(b);var g=Math.sin(b)}b=
this.center;uf(vh.set(-.5,-.5,0),Mf,b,Lf,g,d);uf(og.set(.5,-.5,0),Mf,b,Lf,g,d);uf(wh.set(.5,.5,0),Mf,b,Lf,g,d);mk.set(0,0);dj.set(1,0);nk.set(1,1);var l=c.ray.intersectTriangle(vh,og,wh,!1,ng);if(null===l&&(uf(og.set(-.5,.5,0),Mf,b,Lf,g,d),dj.set(0,1),l=c.ray.intersectTriangle(vh,wh,og,!1,ng),null===l))return;g=c.ray.origin.distanceTo(ng);g<c.near||g>c.far||f.push({distance:g,point:ng.clone(),uv:xd.getUV(ng,vh,og,wh,mk,dj,nk,new ib),face:null,object:this})},copy:function(c){T.prototype.copy.call(this,
c);void 0!==c.center&&this.center.copy(c.center);this.material=c.material;return this}});var xh=new da,ok=new da;Re.prototype=Object.assign(Object.create(T.prototype),{constructor:Re,isLOD:!0,copy:function(c){T.prototype.copy.call(this,c,!1);for(var f=c.levels,b=0,d=f.length;b<d;b++){var g=f[b];this.addLevel(g.object.clone(),g.distance)}this.autoUpdate=c.autoUpdate;return this},addLevel:function(c,f){void 0===f&&(f=0);f=Math.abs(f);var b=this.levels,d;for(d=0;d<b.length&&!(f<b[d].distance);d++);b.splice(d,
0,{distance:f,object:c});this.add(c);return this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(c){var f=this.levels;if(0<f.length){var b;var d=1;for(b=f.length;d<b&&!(c<f[d].distance);d++);return f[d-1].object}return null},raycast:function(c,f){if(0<this.levels.length){xh.setFromMatrixPosition(this.matrixWorld);var b=c.ray.origin.distanceTo(xh);this.getObjectForDistance(b).raycast(c,f)}},update:function(c){var f=this.levels;if(1<f.length){xh.setFromMatrixPosition(c.matrixWorld);
ok.setFromMatrixPosition(this.matrixWorld);c=xh.distanceTo(ok)/c.zoom;f[0].object.visible=!0;var b;var d=1;for(b=f.length;d<b;d++)if(c>=f[d].distance)f[d-1].object.visible=!1,f[d].object.visible=!0;else break;for(this._currentLevel=d-1;d<b;d++)f[d].object.visible=!1}},toJSON:function(c){c=T.prototype.toJSON.call(this,c);!1===this.autoUpdate&&(c.object.autoUpdate=!1);c.object.levels=[];for(var f=this.levels,b=0,d=f.length;b<d;b++){var g=f[b];c.object.levels.push({object:g.object.uuid,distance:g.distance})}return c}});
var pk=new da,qk=new qc,rk=new qc,wl=new da,sk=new ec;Se.prototype=Object.assign(Object.create($a.prototype),{constructor:Se,isSkinnedMesh:!0,copy:function(c){$a.prototype.copy.call(this,c);this.bindMode=c.bindMode;this.bindMatrix.copy(c.bindMatrix);this.bindMatrixInverse.copy(c.bindMatrixInverse);this.skeleton=c.skeleton;return this},bind:function(c,f){this.skeleton=c;void 0===f&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),f=this.matrixWorld);this.bindMatrix.copy(f);this.bindMatrixInverse.copy(f).invert()},
pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var c=new qc,f=this.geometry.attributes.skinWeight,b=0,d=f.count;b<d;b++){c.x=f.getX(b);c.y=f.getY(b);c.z=f.getZ(b);c.w=f.getW(b);var g=1/c.manhattanLength();Infinity!==g?c.multiplyScalar(g):c.set(1,0,0,0);f.setXYZW(b,c.x,c.y,c.z,c.w)}},updateMatrixWorld:function(c){$a.prototype.updateMatrixWorld.call(this,c);"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():
console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(c,f){var b=this.skeleton,d=this.geometry;qk.fromBufferAttribute(d.attributes.skinIndex,c);rk.fromBufferAttribute(d.attributes.skinWeight,c);pk.fromBufferAttribute(d.attributes.position,c).applyMatrix4(this.bindMatrix);f.set(0,0,0);for(c=0;4>c;c++)if(d=rk.getComponent(c),0!==d){var g=qk.getComponent(c);sk.multiplyMatrices(b.bones[g].matrixWorld,b.boneInverses[g]);f.addScaledVector(wl.copy(pk).applyMatrix4(sk),
d)}return f.applyMatrix4(this.bindMatrixInverse)}});Te.prototype=Object.assign(Object.create(T.prototype),{constructor:Te,isBone:!0});var tk=new ec,xl=new ec;Object.assign(Ue.prototype,{init:function(){var c=this.bones,f=this.boneInverses;this.boneMatrices=new Float32Array(16*c.length);if(0===f.length)this.calculateInverses();else if(c.length!==f.length)for(console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[],c=0,f=this.bones.length;c<
f;c++)this.boneInverses.push(new ec)},calculateInverses:function(){for(var c=this.boneInverses.length=0,f=this.bones.length;c<f;c++){var b=new ec;this.bones[c]&&b.copy(this.bones[c].matrixWorld).invert();this.boneInverses.push(b)}},pose:function(){for(var c=0,f=this.bones.length;c<f;c++){var b=this.bones[c];b&&b.matrixWorld.copy(this.boneInverses[c]).invert()}c=0;for(f=this.bones.length;c<f;c++)if(b=this.bones[c])b.parent&&b.parent.isBone?(b.matrix.copy(b.parent.matrixWorld).invert(),b.matrix.multiply(b.matrixWorld)):
b.matrix.copy(b.matrixWorld),b.matrix.decompose(b.position,b.quaternion,b.scale)},update:function(){for(var c=this.bones,f=this.boneInverses,b=this.boneMatrices,d=this.boneTexture,g=0,l=c.length;g<l;g++)tk.multiplyMatrices(c[g]?c[g].matrixWorld:xl,f[g]),tk.toArray(b,16*g);null!==d&&(d.needsUpdate=!0)},clone:function(){return new Ue(this.bones,this.boneInverses)},getBoneByName:function(c){for(var f=0,b=this.bones.length;f<b;f++){var d=this.bones[f];if(d.name===c)return d}},dispose:function(){null!==
this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)},fromJSON:function(c,f){this.uuid=c.uuid;for(var b=0,d=c.bones.length;b<d;b++){var g=c.bones[b],l=f[g];void 0===l&&(console.warn("THREE.Skeleton: No bone found with UUID:",g),l=new Te);this.bones.push(l);this.boneInverses.push((new ec).fromArray(c.boneInverses[b]))}this.init();return this},toJSON:function(){var c={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};c.uuid=this.uuid;for(var f=
this.bones,b=this.boneInverses,d=0,g=f.length;d<g;d++)c.bones.push(f[d].uuid),c.boneInverses.push(b[d].toArray());return c}});var uk=new ec,vk=new ec,yh=[],pg=new $a;jd.prototype=Object.assign(Object.create($a.prototype),{constructor:jd,isInstancedMesh:!0,copy:function(c){$a.prototype.copy.call(this,c);this.instanceMatrix.copy(c.instanceMatrix);null!==c.instanceColor&&(this.instanceColor=c.instanceColor.clone());this.count=c.count;return this},getColorAt:function(c,f){f.fromArray(this.instanceColor.array,
3*c)},getMatrixAt:function(c,f){f.fromArray(this.instanceMatrix.array,16*c)},raycast:function(c,f){var b=this.matrixWorld,d=this.count;pg.geometry=this.geometry;pg.material=this.material;if(void 0!==pg.material)for(var g=0;g<d;g++){this.getMatrixAt(g,uk);vk.multiplyMatrices(b,uk);pg.matrixWorld=vk;pg.raycast(c,yh);for(var l=0,r=yh.length;l<r;l++){var v=yh[l];v.instanceId=g;v.object=this;f.push(v)}yh.length=0}},setColorAt:function(c,f){null===this.instanceColor&&(this.instanceColor=new M(new Float32Array(3*
this.count),3));f.toArray(this.instanceColor.array,3*c)},setMatrixAt:function(c,f){f.toArray(this.instanceMatrix.array,16*c)},updateMorphTargets:function(){},dispose:function(){this.dispatchEvent({type:"dispose"})}});sc.prototype=Object.create(U.prototype);sc.prototype.constructor=sc;sc.prototype.isLineBasicMaterial=!0;sc.prototype.copy=function(c){U.prototype.copy.call(this,c);this.color.copy(c.color);this.linewidth=c.linewidth;this.linecap=c.linecap;this.linejoin=c.linejoin;this.morphTargets=c.morphTargets;
return this};var wk=new da,xk=new da,yk=new ec,ej=new zf,qg=new Be;bd.prototype=Object.assign(Object.create(T.prototype),{constructor:bd,isLine:!0,copy:function(c){T.prototype.copy.call(this,c);this.material=c.material;this.geometry=c.geometry;return this},computeLineDistances:function(){var c=this.geometry;if(c.isBufferGeometry)if(null===c.index){for(var f=c.attributes.position,b=[0],d=1,g=f.count;d<g;d++)wk.fromBufferAttribute(f,d-1),xk.fromBufferAttribute(f,d),b[d]=b[d-1],b[d]+=wk.distanceTo(xk);
c.setAttribute("lineDistance",new Ya(b,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else c.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this},raycast:function(c,f){var b=this.geometry,d=this.matrixWorld,g=c.params.Line.threshold;null===b.boundingSphere&&b.computeBoundingSphere();qg.copy(b.boundingSphere);qg.applyMatrix4(d);qg.radius+=
g;if(!1!==c.ray.intersectsSphere(qg)){yk.copy(d).invert();ej.copy(c.ray).applyMatrix4(yk);d=g/((this.scale.x+this.scale.y+this.scale.z)/3);d*=d;g=new da;var l=new da,r=new da,v=new da,x=this.isLineSegments?2:1;if(b.isBufferGeometry){var w=b.index;b=b.attributes.position;if(null!==w){w=w.array;for(var A=0,D=w.length-1;A<D;A+=x){var J=w[A+1];g.fromBufferAttribute(b,w[A]);l.fromBufferAttribute(b,J);ej.distanceSqToSegment(g,l,v,r)>d||(v.applyMatrix4(this.matrixWorld),J=c.ray.origin.distanceTo(v),J<c.near||
J>c.far||f.push({distance:J,point:r.clone().applyMatrix4(this.matrixWorld),index:A,face:null,faceIndex:null,object:this}))}}else for(w=0,A=b.count-1;w<A;w+=x)g.fromBufferAttribute(b,w),l.fromBufferAttribute(b,w+1),ej.distanceSqToSegment(g,l,v,r)>d||(v.applyMatrix4(this.matrixWorld),D=c.ray.origin.distanceTo(v),D<c.near||D>c.far||f.push({distance:D,point:r.clone().applyMatrix4(this.matrixWorld),index:w,face:null,faceIndex:null,object:this}))}else b.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},
updateMorphTargets:function(){var c=this.geometry;if(c.isBufferGeometry){c=c.morphAttributes;var f=Object.keys(c);if(0<f.length&&(c=c[f[0]],void 0!==c)){this.morphTargetInfluences=[];this.morphTargetDictionary={};f=0;for(var b=c.length;f<b;f++){var d=c[f].name||String(f);this.morphTargetInfluences.push(0);this.morphTargetDictionary[d]=f}}}else c=c.morphTargets,void 0!==c&&0<c.length&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}});
var zk=new da,Ak=new da;Mc.prototype=Object.assign(Object.create(bd.prototype),{constructor:Mc,isLineSegments:!0,computeLineDistances:function(){var c=this.geometry;if(c.isBufferGeometry)if(null===c.index){for(var f=c.attributes.position,b=[],d=0,g=f.count;d<g;d+=2)zk.fromBufferAttribute(f,d),Ak.fromBufferAttribute(f,d+1),b[d]=0===d?0:b[d-1],b[d+1]=b[d]+zk.distanceTo(Ak);c.setAttribute("lineDistance",new Ya(b,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");
else c.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}});te.prototype=Object.assign(Object.create(bd.prototype),{constructor:te,isLineLoop:!0});cd.prototype=Object.create(U.prototype);cd.prototype.constructor=cd;cd.prototype.isPointsMaterial=!0;cd.prototype.copy=function(c){U.prototype.copy.call(this,c);this.color.copy(c.color);this.map=c.map;this.alphaMap=c.alphaMap;this.size=c.size;this.sizeAttenuation=
c.sizeAttenuation;this.morphTargets=c.morphTargets;return this};var Bk=new ec,wi=new zf,rg=new Be,zh=new da;Vd.prototype=Object.assign(Object.create(T.prototype),{constructor:Vd,isPoints:!0,copy:function(c){T.prototype.copy.call(this,c);this.material=c.material;this.geometry=c.geometry;return this},raycast:function(c,f){var b=this.geometry,d=this.matrixWorld,g=c.params.Points.threshold;null===b.boundingSphere&&b.computeBoundingSphere();rg.copy(b.boundingSphere);rg.applyMatrix4(d);rg.radius+=g;if(!1!==
c.ray.intersectsSphere(rg))if(Bk.copy(d).invert(),wi.copy(c.ray).applyMatrix4(Bk),g/=(this.scale.x+this.scale.y+this.scale.z)/3,g*=g,b.isBufferGeometry){var l=b.index;b=b.attributes.position;if(null!==l){l=l.array;for(var r=0,v=l.length;r<v;r++){var x=l[r];zh.fromBufferAttribute(b,x);Ve(zh,x,g,d,c,f,this)}}else for(l=0,r=b.count;l<r;l++)zh.fromBufferAttribute(b,l),Ve(zh,l,g,d,c,f,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")},
updateMorphTargets:function(){var c=this.geometry;if(c.isBufferGeometry){c=c.morphAttributes;var f=Object.keys(c);if(0<f.length&&(c=c[f[0]],void 0!==c)){this.morphTargetInfluences=[];this.morphTargetDictionary={};f=0;for(var b=c.length;f<b;f++){var d=c[f].name||String(f);this.morphTargetInfluences.push(0);this.morphTargetDictionary[d]=f}}}else c=c.morphTargets,void 0!==c&&0<c.length&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}});
We.prototype=Object.assign(Object.create(R.prototype),{constructor:We,clone:function(){return(new this.constructor(this.image)).copy(this)},isVideoTexture:!0,update:function(){var c=this.image;!1==="requestVideoFrameCallback"in c&&c.readyState>=c.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}});ue.prototype=Object.create(R.prototype);ue.prototype.constructor=ue;ue.prototype.isCompressedTexture=!0;Xe.prototype=Object.create(R.prototype);Xe.prototype.constructor=Xe;Xe.prototype.isCanvasTexture=!0;Wd.prototype=
Object.create(R.prototype);Wd.prototype.constructor=Wd;Wd.prototype.isDepthTexture=!0;var Ah=function(c){function f(b,d,g,l){void 0===b&&(b=1);void 0===d&&(d=8);void 0===g&&(g=0);void 0===l&&(l=2*Math.PI);var r=c.call(this)||this;r.type="CircleGeometry";r.parameters={radius:b,segments:d,thetaStart:g,thetaLength:l};d=Math.max(3,d);var v=[],x=[],w=[],A=[],D=new da,J=new ib;x.push(0,0,0);w.push(0,0,1);A.push(.5,.5);for(var N=0,L=3;N<=d;N++,L+=3){var S=g+N/d*l;D.x=b*Math.cos(S);D.y=b*Math.sin(S);x.push(D.x,
D.y,D.z);w.push(0,0,1);J.x=(x[L]/b+1)/2;J.y=(x[L+1]/b+1)/2;A.push(J.x,J.y)}for(b=1;b<=d;b++)v.push(b,b+1,0);r.setIndex(v);r.setAttribute("position",new Ya(x,3));r.setAttribute("normal",new Ya(w,3));r.setAttribute("uv",new Ya(A,2));return r}y(f,c);return f}(Na),Nf=function(c){function f(b,d,g,l,r,v,x,w){function A(Ca){for(var Aa=ka,ra=new ib,Ja=new da,Ra=0,xa=!0===Ca?b:d,Ga=!0===Ca?1:-1,Oa=1;Oa<=l;Oa++)L.push(0,la*Ga,0),S.push(0,Ga,0),P.push(.5,.5),ka++;Oa=ka;for(var nb=0;nb<=l;nb++){var Ba=nb/l*w+
x,Ea=Math.cos(Ba);Ba=Math.sin(Ba);Ja.x=xa*Ba;Ja.y=la*Ga;Ja.z=xa*Ea;L.push(Ja.x,Ja.y,Ja.z);S.push(0,Ga,0);ra.x=.5*Ea+.5;ra.y=.5*Ba*Ga+.5;P.push(ra.x,ra.y);ka++}for(ra=0;ra<l;ra++)Ja=Aa+ra,xa=Oa+ra,!0===Ca?N.push(xa,xa+1,Ja):N.push(xa+1,xa,Ja),Ra+=3;J.addGroup(oa,Ra,!0===Ca?1:2);oa+=Ra}void 0===b&&(b=1);void 0===d&&(d=1);void 0===g&&(g=1);void 0===l&&(l=8);void 0===r&&(r=1);void 0===v&&(v=!1);void 0===x&&(x=0);void 0===w&&(w=2*Math.PI);var D=c.call(this)||this;D.type="CylinderGeometry";D.parameters=
{radiusTop:b,radiusBottom:d,height:g,radialSegments:l,heightSegments:r,openEnded:v,thetaStart:x,thetaLength:w};var J=C(D);l=Math.floor(l);r=Math.floor(r);var N=[],L=[],S=[],P=[],ka=0,ia=[],la=g/2,oa=0;(function(){for(var Ca=new da,Aa=new da,ra=0,Ja=(d-b)/g,Ra=0;Ra<=r;Ra++){for(var xa=[],Ga=Ra/r,Oa=Ga*(d-b)+b,nb=0;nb<=l;nb++){var Ba=nb/l,Ea=Ba*w+x,Pa=Math.sin(Ea);Ea=Math.cos(Ea);Aa.x=Oa*Pa;Aa.y=-Ga*g+la;Aa.z=Oa*Ea;L.push(Aa.x,Aa.y,Aa.z);Ca.set(Pa,Ja,Ea).normalize();S.push(Ca.x,Ca.y,Ca.z);P.push(Ba,
1-Ga);xa.push(ka++)}ia.push(xa)}for(Ca=0;Ca<l;Ca++)for(Aa=0;Aa<r;Aa++)Ja=ia[Aa+1][Ca],Ra=ia[Aa+1][Ca+1],xa=ia[Aa][Ca+1],N.push(ia[Aa][Ca],Ja,xa),N.push(Ja,Ra,xa),ra+=6;J.addGroup(oa,ra,0);oa+=ra})();!1===v&&(0<b&&A(!0),0<d&&A(!1));D.setIndex(N);D.setAttribute("position",new Ya(L,3));D.setAttribute("normal",new Ya(S,3));D.setAttribute("uv",new Ya(P,2));return D}y(f,c);return f}(Na),Bh=function(c){function f(b,d,g,l,r,v,x){void 0===b&&(b=1);void 0===d&&(d=1);void 0===g&&(g=8);void 0===l&&(l=1);void 0===
r&&(r=!1);void 0===v&&(v=0);void 0===x&&(x=2*Math.PI);var w=c.call(this,0,b,d,g,l,r,v,x)||this;w.type="ConeGeometry";w.parameters={radius:b,height:d,radialSegments:g,heightSegments:l,openEnded:r,thetaStart:v,thetaLength:x};return w}y(f,c);return f}(Nf),Ee=function(c){function f(b,d,g,l){function r(J){A.push(J.x,J.y,J.z)}function v(J,N){J*=3;N.x=b[J+0];N.y=b[J+1];N.z=b[J+2]}function x(J,N,L,S){0>S&&1===J.x&&(D[N]=J.x-1);0===L.x&&0===L.z&&(D[N]=S/2/Math.PI+.5)}void 0===g&&(g=1);void 0===l&&(l=0);var w=
c.call(this)||this;w.type="PolyhedronGeometry";w.parameters={vertices:b,indices:d,radius:g,detail:l};var A=[],D=[];(function(J){for(var N=new da,L=new da,S=new da,P=0;P<d.length;P+=3){v(d[P+0],N);v(d[P+1],L);v(d[P+2],S);for(var ka=N,ia=L,la=S,oa=J+1,Ca=[],Aa=0;Aa<=oa;Aa++){Ca[Aa]=[];for(var ra=ka.clone().lerp(la,Aa/oa),Ja=ia.clone().lerp(la,Aa/oa),Ra=oa-Aa,xa=0;xa<=Ra;xa++)Ca[Aa][xa]=0===xa&&Aa===oa?ra:ra.clone().lerp(Ja,xa/Ra)}for(ka=0;ka<oa;ka++)for(ia=0;ia<2*(oa-ka)-1;ia++)la=Math.floor(ia/2),
0===ia%2?(r(Ca[ka][la+1]),r(Ca[ka+1][la]),r(Ca[ka][la])):(r(Ca[ka][la+1]),r(Ca[ka+1][la+1]),r(Ca[ka+1][la]))}})(l);(function(J){for(var N=new da,L=0;L<A.length;L+=3)N.x=A[L+0],N.y=A[L+1],N.z=A[L+2],N.normalize().multiplyScalar(J),A[L+0]=N.x,A[L+1]=N.y,A[L+2]=N.z})(g);(function(){for(var J=new da,N=0;N<A.length;N+=3)J.x=A[N+0],J.y=A[N+1],J.z=A[N+2],D.push(Math.atan2(J.z,-J.x)/2/Math.PI+.5,1-(Math.atan2(-J.y,Math.sqrt(J.x*J.x+J.z*J.z))/Math.PI+.5));J=new da;N=new da;for(var L=new da,S=new da,P=new ib,
ka=new ib,ia=new ib,la=0,oa=0;la<A.length;la+=9,oa+=6){J.set(A[la+0],A[la+1],A[la+2]);N.set(A[la+3],A[la+4],A[la+5]);L.set(A[la+6],A[la+7],A[la+8]);P.set(D[oa+0],D[oa+1]);ka.set(D[oa+2],D[oa+3]);ia.set(D[oa+4],D[oa+5]);S.copy(J).add(N).add(L).divideScalar(3);var Ca=Math.atan2(S.z,-S.x);x(P,oa+0,J,Ca);x(ka,oa+2,N,Ca);x(ia,oa+4,L,Ca)}for(J=0;J<D.length;J+=6)N=D[J+0],L=D[J+2],S=D[J+4],P=Math.min(N,L,S),.9<Math.max(N,L,S)&&.1>P&&(.2>N&&(D[J+0]+=1),.2>L&&(D[J+2]+=1),.2>S&&(D[J+4]+=1))})();w.setAttribute("position",
new Ya(A,3));w.setAttribute("normal",new Ya(A.slice(),3));w.setAttribute("uv",new Ya(D,2));0===l?w.computeVertexNormals():w.normalizeNormals();return w}y(f,c);return f}(Na),Ch=function(c){function f(b,d){void 0===b&&(b=1);void 0===d&&(d=0);var g=(1+Math.sqrt(5))/2;var l=1/g;g=c.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-l,-g,0,-l,g,0,l,-g,0,l,g,-l,-g,0,-l,g,0,l,-g,0,l,g,0,-g,0,-l,g,0,-l,-g,0,l,g,0,l],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,
6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],b,d)||this;g.type="DodecahedronGeometry";g.parameters={radius:b,detail:d};return g}y(f,c);return f}(Ee),Dh=new da,Eh=new da,fj=new da,Of=new xd,gj=function(c){function f(b,d){var g=c.call(this)||this;g.type="EdgesGeometry";g.parameters={thresholdAngle:d};d=void 0!==d?d:1;if(!0===b.isGeometry)return console.error("THREE.EdgesGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),
C(g);var l=Math.pow(10,4),r=Math.cos(Qb.DEG2RAD*d),v=b.getIndex();b=b.getAttribute("position");var x=v?v.count:b.count,w=[0,0,0],A=["a","b","c"],D=Array(3);d={};for(var J=[],N=0;N<x;N+=3){v?(w[0]=v.getX(N),w[1]=v.getX(N+1),w[2]=v.getX(N+2)):(w[0]=N,w[1]=N+1,w[2]=N+2);var L=Of.a,S=Of.b,P=Of.c;L.fromBufferAttribute(b,w[0]);S.fromBufferAttribute(b,w[1]);P.fromBufferAttribute(b,w[2]);Of.getNormal(fj);D[0]=Math.round(L.x*l)+","+Math.round(L.y*l)+","+Math.round(L.z*l);D[1]=Math.round(S.x*l)+","+Math.round(S.y*
l)+","+Math.round(S.z*l);D[2]=Math.round(P.x*l)+","+Math.round(P.y*l)+","+Math.round(P.z*l);if(D[0]!==D[1]&&D[1]!==D[2]&&D[2]!==D[0])for(L=0;3>L;L++){S=(L+1)%3;var ka=D[L],ia=D[S];P=Of[A[L]];var la=Of[A[S]],oa=ka+"_"+ia;ka=ia+"_"+ka;ka in d&&d[ka]?(fj.dot(d[ka].normal)<=r&&(J.push(P.x,P.y,P.z),J.push(la.x,la.y,la.z)),d[ka]=null):oa in d||(d[oa]={index0:w[L],index1:w[S],normal:fj.clone()})}}for(var Ca in d)d[Ca]&&(l=d[Ca],r=l.index1,Dh.fromBufferAttribute(b,l.index0),Eh.fromBufferAttribute(b,r),J.push(Dh.x,
Dh.y,Dh.z),J.push(Eh.x,Eh.y,Eh.z));g.setAttribute("position",new Ya(J,3));return g}y(f,c);return f}(Na),yl={triangulate:function(c,f,b){b=b||2;var d=f&&f.length,g=d?f[0]*b:c.length,l=Ye(c,0,g,b,!0),r=[];if(!l||l.next===l.prev)return r;var v;if(d){var x=b;d=[];var w;var A=0;for(w=f.length;A<w;A++){var D=f[A]*x;var J=A<w-1?f[A+1]*x:c.length;D=Ye(c,D,J,x,!1);D===D.next&&(D.steiner=!0);J=d;var N=J.push,L=D,S=D;do{if(L.x<S.x||L.x===S.x&&L.y<S.y)S=L;L=L.next}while(L!==D);N.call(J,S)}d.sort(yi);for(A=0;A<
d.length;A++){x=d[A];f=l;if(f=bg(x,f))x=Xg(f,x),Ed(f,f.next),Ed(x,x.next);l=Ed(l,l.next)}}if(c.length>80*b){var P=v=c[0];var ka=d=c[1];for(x=b;x<g;x+=b)A=c[x],f=c[x+1],A<P&&(P=A),f<ka&&(ka=f),A>v&&(v=A),f>d&&(d=f);v=Math.max(v-P,d-ka);v=0!==v?1/v:0}we(l,r,b,P,ka,v);return r}},ge={area:function(c){for(var f=c.length,b=0,d=f-1,g=0;g<f;d=g++)b+=c[d].x*c[g].y-c[g].x*c[d].y;return.5*b},isClockWise:function(c){return 0>ge.area(c)},triangulateShape:function(c,f){var b=[],d=[],g=[];Yg(c);Zg(b,c);c=c.length;
f.forEach(Yg);for(var l=0;l<f.length;l++)d.push(c),c+=f[l].length,Zg(b,f[l]);f=yl.triangulate(b,d);for(b=0;b<f.length;b+=3)g.push(f.slice(b,b+3));return g}},cf=function(c){function f(b,d){function g(D){function J(Za,Fb,Pb){Fb||console.error("THREE.ExtrudeGeometry: vec does not exist");return Fb.clone().multiplyScalar(Pb).add(Za)}function N(Za,Fb,Pb){var Nb=Za.x-Fb.x;var gc=Za.y-Fb.y;var dc=Pb.x-Za.x;var yc=Pb.y-Za.y,rc=Nb*Nb+gc*gc;if(Math.abs(Nb*yc-gc*dc)>Number.EPSILON){var $c=Math.sqrt(rc),Sd=Math.sqrt(dc*
dc+yc*yc);rc=Fb.x-gc/$c;Fb=Fb.y+Nb/$c;yc=((Pb.x-yc/Sd-rc)*yc-(Pb.y+dc/Sd-Fb)*dc)/(Nb*yc-gc*dc);dc=rc+Nb*yc-Za.x;Nb=Fb+gc*yc-Za.y;gc=dc*dc+Nb*Nb;if(2>=gc)return new ib(dc,Nb);gc=Math.sqrt(gc/2)}else Za=!1,Nb>Number.EPSILON?dc>Number.EPSILON&&(Za=!0):Nb<-Number.EPSILON?dc<-Number.EPSILON&&(Za=!0):Math.sign(gc)===Math.sign(yc)&&(Za=!0),Za?(dc=-gc,gc=Math.sqrt(rc)):(dc=Nb,Nb=gc,gc=Math.sqrt(rc/2));return new ib(dc/gc,Nb/gc)}function L(Za,Fb){for(var Pb=Za.length;0<=--Pb;){var Nb=Pb,gc=Pb-1;0>gc&&(gc=
Za.length-1);for(var dc=0,yc=Ca+2*Ga;dc<yc;dc++){var rc=pa*dc,$c=pa*(dc+1),Sd=Fb+gc+rc,re=Fb+gc+$c;$c=Fb+Nb+$c;ka(Fb+Nb+rc);ka(Sd);ka($c);ka(Sd);ka(re);ka($c);rc=v.length/3;rc=nb.generateSideWallUV(r,v,rc-6,rc-3,rc-2,rc-1);ia(rc[0]);ia(rc[1]);ia(rc[3]);ia(rc[1]);ia(rc[2]);ia(rc[3])}}}function S(Za,Fb,Pb){la.push(Za);la.push(Fb);la.push(Pb)}function P(Za,Fb,Pb){ka(Za);ka(Fb);ka(Pb);Za=v.length/3;Za=nb.generateTopUV(r,v,Za-3,Za-2,Za-1);ia(Za[0]);ia(Za[1]);ia(Za[2])}function ka(Za){v.push(la[3*Za]);
v.push(la[3*Za+1]);v.push(la[3*Za+2])}function ia(Za){x.push(Za.x);x.push(Za.y)}var la=[],oa=void 0!==d.curveSegments?d.curveSegments:12,Ca=void 0!==d.steps?d.steps:1,Aa=void 0!==d.depth?d.depth:100,ra=void 0!==d.bevelEnabled?d.bevelEnabled:!0,Ja=void 0!==d.bevelThickness?d.bevelThickness:6,Ra=void 0!==d.bevelSize?d.bevelSize:Ja-2,xa=void 0!==d.bevelOffset?d.bevelOffset:0,Ga=void 0!==d.bevelSegments?d.bevelSegments:3,Oa=d.extrudePath,nb=void 0!==d.UVGenerator?d.UVGenerator:zl;void 0!==d.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),
Aa=d.amount);var Ba=!1;if(Oa){var Ea=Oa.getSpacedPoints(Ca);Ba=!0;ra=!1;var Pa=Oa.computeFrenetFrames(Ca,!1);var qb=new da;var Va=new da;var Db=new da}ra||(xa=Ra=Ja=Ga=0);D=D.extractPoints(oa);Oa=D.shape;var Sb=D.holes;if(!ge.isClockWise(Oa))for(Oa=Oa.reverse(),D=0,oa=Sb.length;D<oa;D++){var $b=Sb[D];ge.isClockWise($b)&&(Sb[D]=$b.reverse())}var lc=ge.triangulateShape(Oa,Sb),ha=Oa;D=0;for(oa=Sb.length;D<oa;D++)Oa=Oa.concat(Sb[D]);var pa=Oa.length,ab=lc.length;D=[];oa=0;$b=ha.length;for(var ua=$b-1,
fb=oa+1;oa<$b;oa++,ua++,fb++)ua===$b&&(ua=0),fb===$b&&(fb=0),D[oa]=N(ha[oa],ha[ua],ha[fb]);oa=[];$b=D.concat();fb=0;for(var kb=Sb.length;fb<kb;fb++){var Ib=Sb[fb];ua=[];for(var vb=0,Vb=Ib.length,Rb=Vb-1,Yb=vb+1;vb<Vb;vb++,Rb++,Yb++)Rb===Vb&&(Rb=0),Yb===Vb&&(Yb=0),ua[vb]=N(Ib[vb],Ib[Rb],Ib[Yb]);oa.push(ua);$b=$b.concat(ua)}for(fb=0;fb<Ga;fb++){ua=fb/Ga;kb=Ja*Math.cos(ua*Math.PI/2);Ib=Ra*Math.sin(ua*Math.PI/2)+xa;ua=0;for(vb=ha.length;ua<vb;ua++)Vb=J(ha[ua],D[ua],Ib),S(Vb.x,Vb.y,-kb);vb=0;for(Vb=Sb.length;vb<
Vb;vb++){Rb=Sb[vb];ua=oa[vb];Yb=0;for(var Xb=Rb.length;Yb<Xb;Yb++){var nc=J(Rb[Yb],ua[Yb],Ib);S(nc.x,nc.y,-kb)}}}ua=Ra+xa;for(fb=0;fb<pa;fb++)kb=ra?J(Oa[fb],$b[fb],ua):Oa[fb],Ba?(Va.copy(Pa.normals[0]).multiplyScalar(kb.x),qb.copy(Pa.binormals[0]).multiplyScalar(kb.y),Db.copy(Ea[0]).add(Va).add(qb),S(Db.x,Db.y,Db.z)):S(kb.x,kb.y,0);for(fb=1;fb<=Ca;fb++)for(kb=0;kb<pa;kb++)Ib=ra?J(Oa[kb],$b[kb],ua):Oa[kb],Ba?(Va.copy(Pa.normals[fb]).multiplyScalar(Ib.x),qb.copy(Pa.binormals[fb]).multiplyScalar(Ib.y),
Db.copy(Ea[fb]).add(Va).add(qb),S(Db.x,Db.y,Db.z)):S(Ib.x,Ib.y,Aa/Ca*fb);for(Pa=Ga-1;0<=Pa;Pa--){Va=Pa/Ga;qb=Ja*Math.cos(Va*Math.PI/2);Va=Ra*Math.sin(Va*Math.PI/2)+xa;Db=0;for(Oa=ha.length;Db<Oa;Db++)$b=J(ha[Db],D[Db],Va),S($b.x,$b.y,Aa+qb);Db=0;for(Oa=Sb.length;Db<Oa;Db++)for($b=Sb[Db],ua=oa[Db],fb=0,kb=$b.length;fb<kb;fb++)Ib=J($b[fb],ua[fb],Va),Ba?S(Ib.x,Ib.y+Ea[Ca-1].y,Ea[Ca-1].x+qb):S(Ib.x,Ib.y,Aa+qb)}(function(){var Za=v.length/3;if(ra){for(var Fb=0*pa,Pb=0;Pb<ab;Pb++){var Nb=lc[Pb];P(Nb[2]+
Fb,Nb[1]+Fb,Nb[0]+Fb)}Fb=pa*(Ca+2*Ga);for(Pb=0;Pb<ab;Pb++)Nb=lc[Pb],P(Nb[0]+Fb,Nb[1]+Fb,Nb[2]+Fb)}else{for(Fb=0;Fb<ab;Fb++)Pb=lc[Fb],P(Pb[2],Pb[1],Pb[0]);for(Fb=0;Fb<ab;Fb++)Pb=lc[Fb],P(Pb[0]+pa*Ca,Pb[1]+pa*Ca,Pb[2]+pa*Ca)}r.addGroup(Za,v.length/3-Za,0)})();(function(){var Za=v.length/3,Fb=0;L(ha,Fb);Fb+=ha.length;for(var Pb=0,Nb=Sb.length;Pb<Nb;Pb++){var gc=Sb[Pb];L(gc,Fb);Fb+=gc.length}r.addGroup(Za,v.length/3-Za,1)})()}var l=c.call(this)||this;l.type="ExtrudeGeometry";l.parameters={shapes:b,options:d};
b=Array.isArray(b)?b:[b];for(var r=C(l),v=[],x=[],w=0,A=b.length;w<A;w++)g(b[w]);l.setAttribute("position",new Ya(v,3));l.setAttribute("uv",new Ya(x,2));l.computeVertexNormals();return l}y(f,c);f.prototype.toJSON=function(){var b=Na.prototype.toJSON.call(this),d=this.parameters.shapes,g=this.parameters.options;b.shapes=[];if(Array.isArray(d))for(var l=0,r=d.length;l<r;l++)b.shapes.push(d[l].uuid);else b.shapes.push(d.uuid);void 0!==g.extrudePath&&(b.options.extrudePath=g.extrudePath.toJSON());return b};
return f}(Na),zl={generateTopUV:function(c,f,b,d,g){c=f[3*d];d=f[3*d+1];var l=f[3*g];g=f[3*g+1];return[new ib(f[3*b],f[3*b+1]),new ib(c,d),new ib(l,g)]},generateSideWallUV:function(c,f,b,d,g,l){c=f[3*b];var r=f[3*b+1];b=f[3*b+2];var v=f[3*d],x=f[3*d+1];d=f[3*d+2];var w=f[3*g],A=f[3*g+1];g=f[3*g+2];var D=f[3*l],J=f[3*l+1];f=f[3*l+2];return.01>Math.abs(r-x)?[new ib(c,1-b),new ib(v,1-d),new ib(w,1-g),new ib(D,1-f)]:[new ib(r,1-b),new ib(x,1-d),new ib(A,1-g),new ib(J,1-f)]}},Fh=function(c){function f(b,
d){void 0===b&&(b=1);void 0===d&&(d=0);var g=(1+Math.sqrt(5))/2;g=c.call(this,[-1,g,0,1,g,0,-1,-g,0,1,-g,0,0,-1,g,0,1,g,0,-1,-g,0,1,-g,g,0,-1,g,0,1,-g,0,-1,-g,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],b,d)||this;g.type="IcosahedronGeometry";g.parameters={radius:b,detail:d};return g}y(f,c);return f}(Ee),Gh=function(c){function f(b,d,g,l){void 0===d&&(d=12);void 0===g&&(g=0);void 0===l&&(l=2*Math.PI);var r=
c.call(this)||this;r.type="LatheGeometry";r.parameters={points:b,segments:d,phiStart:g,phiLength:l};d=Math.floor(d);l=Qb.clamp(l,0,2*Math.PI);for(var v=[],x=[],w=[],A=1/d,D=new da,J=new ib,N=0;N<=d;N++){var L=g+N*A*l,S=Math.sin(L);L=Math.cos(L);for(var P=0;P<=b.length-1;P++)D.x=b[P].x*S,D.y=b[P].y,D.z=b[P].x*L,x.push(D.x,D.y,D.z),J.x=N/d,J.y=P/(b.length-1),w.push(J.x,J.y)}for(g=0;g<d;g++)for(A=0;A<b.length-1;A++)D=A+g*b.length,J=D+b.length,N=D+b.length+1,S=D+1,v.push(D,J,S),v.push(J,N,S);r.setIndex(v);
r.setAttribute("position",new Ya(x,3));r.setAttribute("uv",new Ya(w,2));r.computeVertexNormals();if(l===2*Math.PI)for(l=r.attributes.normal.array,v=new da,x=new da,w=new da,d=d*b.length*3,A=g=0;g<b.length;g++,A+=3)v.x=l[A+0],v.y=l[A+1],v.z=l[A+2],x.x=l[d+A+0],x.y=l[d+A+1],x.z=l[d+A+2],w.addVectors(v,x).normalize(),l[A+0]=l[d+A+0]=w.x,l[A+1]=l[d+A+1]=w.y,l[A+2]=l[d+A+2]=w.z;return r}y(f,c);return f}(Na),sg=function(c){function f(b,d){void 0===b&&(b=1);void 0===d&&(d=0);var g=c.call(this,[1,0,0,-1,
0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],b,d)||this;g.type="OctahedronGeometry";g.parameters={radius:b,detail:d};return g}y(f,c);return f}(Ee);Gd.prototype=Object.create(Na.prototype);Gd.prototype.constructor=Gd;var Hh=function(c){function f(b,d,g,l,r,v){void 0===b&&(b=.5);void 0===d&&(d=1);void 0===g&&(g=8);void 0===l&&(l=1);void 0===r&&(r=0);void 0===v&&(v=2*Math.PI);var x=c.call(this)||this;x.type="RingGeometry";x.parameters={innerRadius:b,outerRadius:d,
thetaSegments:g,phiSegments:l,thetaStart:r,thetaLength:v};g=Math.max(3,g);l=Math.max(1,l);var w=[],A=[],D=[],J=[],N=b;b=(d-b)/l;for(var L=new da,S=new ib,P=0;P<=l;P++){for(var ka=0;ka<=g;ka++){var ia=r+ka/g*v;L.x=N*Math.cos(ia);L.y=N*Math.sin(ia);A.push(L.x,L.y,L.z);D.push(0,0,1);S.x=(L.x/d+1)/2;S.y=(L.y/d+1)/2;J.push(S.x,S.y)}N+=b}for(d=0;d<l;d++)for(r=d*(g+1),v=0;v<g;v++)N=v+r,b=N+g+1,L=N+g+2,S=N+1,w.push(N,b,S),w.push(b,L,S);x.setIndex(w);x.setAttribute("position",new Ya(A,3));x.setAttribute("normal",
new Ya(D,3));x.setAttribute("uv",new Ya(J,2));return x}y(f,c);return f}(Na),tg=function(c){function f(b,d){function g(N){var L=v.length/3,S=N.extractPoints(d);N=S.shape;var P=S.holes;!1===ge.isClockWise(N)&&(N=N.reverse());S=0;for(var ka=P.length;S<ka;S++){var ia=P[S];!0===ge.isClockWise(ia)&&(P[S]=ia.reverse())}S=ge.triangulateShape(N,P);ka=0;for(ia=P.length;ka<ia;ka++)N=N.concat(P[ka]);P=0;for(ka=N.length;P<ka;P++)ia=N[P],v.push(ia.x,ia.y,0),x.push(0,0,1),w.push(ia.x,ia.y);N=0;for(P=S.length;N<
P;N++)ka=S[N],r.push(ka[0]+L,ka[1]+L,ka[2]+L),D+=3}void 0===d&&(d=12);var l=c.call(this)||this;l.type="ShapeGeometry";l.parameters={shapes:b,curveSegments:d};var r=[],v=[],x=[],w=[],A=0,D=0;if(!1===Array.isArray(b))g(b);else for(var J=0;J<b.length;J++)g(b[J]),l.addGroup(A,D,J),A+=D,D=0;l.setIndex(r);l.setAttribute("position",new Ya(v,3));l.setAttribute("normal",new Ya(x,3));l.setAttribute("uv",new Ya(w,2));return l}y(f,c);f.prototype.toJSON=function(){var b=Na.prototype.toJSON.call(this),d=this.parameters.shapes;
b.shapes=[];if(Array.isArray(d))for(var g=0,l=d.length;g<l;g++)b.shapes.push(d[g].uuid);else b.shapes.push(d.uuid);return b};return f}(Na),ug=function(c){function f(b,d,g,l,r,v,x){void 0===b&&(b=1);void 0===d&&(d=8);void 0===g&&(g=6);void 0===l&&(l=0);void 0===r&&(r=2*Math.PI);void 0===v&&(v=0);void 0===x&&(x=Math.PI);var w=c.call(this)||this;w.type="SphereGeometry";w.parameters={radius:b,widthSegments:d,heightSegments:g,phiStart:l,phiLength:r,thetaStart:v,thetaLength:x};d=Math.max(3,Math.floor(d));
g=Math.max(2,Math.floor(g));for(var A=Math.min(v+x,Math.PI),D=0,J=[],N=new da,L=new da,S=[],P=[],ka=[],ia=[],la=0;la<=g;la++){var oa=[],Ca=la/g,Aa=0;0==la&&0==v?Aa=.5/d:la==g&&A==Math.PI&&(Aa=-.5/d);for(var ra=0;ra<=d;ra++){var Ja=ra/d;N.x=-b*Math.cos(l+Ja*r)*Math.sin(v+Ca*x);N.y=b*Math.cos(v+Ca*x);N.z=b*Math.sin(l+Ja*r)*Math.sin(v+Ca*x);P.push(N.x,N.y,N.z);L.copy(N).normalize();ka.push(L.x,L.y,L.z);ia.push(Ja+Aa,1-Ca);oa.push(D++)}J.push(oa)}for(b=0;b<g;b++)for(l=0;l<d;l++)r=J[b][l+1],x=J[b][l],
D=J[b+1][l],N=J[b+1][l+1],(0!==b||0<v)&&S.push(r,x,N),(b!==g-1||A<Math.PI)&&S.push(x,D,N);w.setIndex(S);w.setAttribute("position",new Ya(P,3));w.setAttribute("normal",new Ya(ka,3));w.setAttribute("uv",new Ya(ia,2));return w}y(f,c);return f}(Na),Ih=function(c){function f(b,d){void 0===b&&(b=1);void 0===d&&(d=0);var g=c.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],b,d)||this;g.type="TetrahedronGeometry";g.parameters={radius:b,detail:d};return g}y(f,c);return f}(Ee),Jh=function(c){function f(b,
d){void 0===d&&(d={});var g=d.font;if(!g||!g.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Na;b=g.generateShapes(b,d.size);d.depth=void 0!==d.height?d.height:50;void 0===d.bevelThickness&&(d.bevelThickness=10);void 0===d.bevelSize&&(d.bevelSize=8);void 0===d.bevelEnabled&&(d.bevelEnabled=!1);d=c.call(this,b,d)||this;d.type="TextGeometry";return d}y(f,c);return f}(cf),Kh=function(c){function f(b,d,g,l,r){void 0===b&&(b=1);void 0===d&&(d=.4);
void 0===g&&(g=8);void 0===l&&(l=6);void 0===r&&(r=2*Math.PI);var v=c.call(this)||this;v.type="TorusGeometry";v.parameters={radius:b,tube:d,radialSegments:g,tubularSegments:l,arc:r};g=Math.floor(g);l=Math.floor(l);for(var x=[],w=[],A=[],D=[],J=new da,N=new da,L=new da,S=0;S<=g;S++)for(var P=0;P<=l;P++){var ka=P/l*r,ia=S/g*Math.PI*2;N.x=(b+d*Math.cos(ia))*Math.cos(ka);N.y=(b+d*Math.cos(ia))*Math.sin(ka);N.z=d*Math.sin(ia);w.push(N.x,N.y,N.z);J.x=b*Math.cos(ka);J.y=b*Math.sin(ka);L.subVectors(N,J).normalize();
A.push(L.x,L.y,L.z);D.push(P/l);D.push(S/g)}for(b=1;b<=g;b++)for(d=1;d<=l;d++)r=(l+1)*(b-1)+d-1,J=(l+1)*(b-1)+d,N=(l+1)*b+d,x.push((l+1)*b+d-1,r,N),x.push(r,J,N);v.setIndex(x);v.setAttribute("position",new Ya(w,3));v.setAttribute("normal",new Ya(A,3));v.setAttribute("uv",new Ya(D,2));return v}y(f,c);return f}(Na),Lh=function(c){function f(b,d,g,l,r,v){function x(Ra,xa,Ga,Oa,nb){var Ba=Math.sin(Ra);xa=Ga/xa*Ra;Ga=Math.cos(xa);nb.x=Oa*(2+Ga)*.5*Math.cos(Ra);nb.y=Oa*(2+Ga)*Ba*.5;nb.z=Oa*Math.sin(xa)*
.5}void 0===b&&(b=1);void 0===d&&(d=.4);void 0===g&&(g=64);void 0===l&&(l=8);void 0===r&&(r=2);void 0===v&&(v=3);var w=c.call(this)||this;w.type="TorusKnotGeometry";w.parameters={radius:b,tube:d,tubularSegments:g,radialSegments:l,p:r,q:v};g=Math.floor(g);l=Math.floor(l);for(var A=[],D=[],J=[],N=[],L=new da,S=new da,P=new da,ka=new da,ia=new da,la=new da,oa=new da,Ca=0;Ca<=g;++Ca){var Aa=Ca/g*r*Math.PI*2;x(Aa,r,v,b,P);x(Aa+.01,r,v,b,ka);la.subVectors(ka,P);oa.addVectors(ka,P);ia.crossVectors(la,oa);
oa.crossVectors(ia,la);ia.normalize();oa.normalize();for(Aa=0;Aa<=l;++Aa){var ra=Aa/l*Math.PI*2,Ja=-d*Math.cos(ra);ra=d*Math.sin(ra);L.x=P.x+(Ja*oa.x+ra*ia.x);L.y=P.y+(Ja*oa.y+ra*ia.y);L.z=P.z+(Ja*oa.z+ra*ia.z);D.push(L.x,L.y,L.z);S.subVectors(L,P).normalize();J.push(S.x,S.y,S.z);N.push(Ca/g);N.push(Aa/l)}}for(b=1;b<=g;b++)for(d=1;d<=l;d++)r=(l+1)*b+(d-1),v=(l+1)*b+d,L=(l+1)*(b-1)+d,A.push((l+1)*(b-1)+(d-1),r,L),A.push(r,v,L);w.setIndex(A);w.setAttribute("position",new Ya(D,3));w.setAttribute("normal",
new Ya(J,3));w.setAttribute("uv",new Ya(N,2));return w}y(f,c);return f}(Na),Mh=function(c){function f(b,d,g,l,r){function v(ia){N=b.getPointAt(ia/d,N);var la=w.normals[ia];ia=w.binormals[ia];for(var oa=0;oa<=l;oa++){var Ca=oa/l*Math.PI*2,Aa=Math.sin(Ca);Ca=-Math.cos(Ca);D.x=Ca*la.x+Aa*ia.x;D.y=Ca*la.y+Aa*ia.y;D.z=Ca*la.z+Aa*ia.z;D.normalize();S.push(D.x,D.y,D.z);A.x=N.x+g*D.x;A.y=N.y+g*D.y;A.z=N.z+g*D.z;L.push(A.x,A.y,A.z)}}void 0===d&&(d=64);void 0===g&&(g=1);void 0===l&&(l=8);void 0===r&&(r=!1);
var x=c.call(this)||this;x.type="TubeGeometry";x.parameters={path:b,tubularSegments:d,radius:g,radialSegments:l,closed:r};var w=b.computeFrenetFrames(d,r);x.tangents=w.tangents;x.normals=w.normals;x.binormals=w.binormals;var A=new da,D=new da,J=new ib,N=new da,L=[],S=[],P=[],ka=[];(function(){for(var ia=0;ia<d;ia++)v(ia);v(!1===r?d:0);for(ia=0;ia<=d;ia++)for(var la=0;la<=l;la++)J.x=ia/d,J.y=la/l,P.push(J.x,J.y);for(ia=1;ia<=d;ia++)for(la=1;la<=l;la++){var oa=(l+1)*ia+(la-1),Ca=(l+1)*ia+la,Aa=(l+1)*
(ia-1)+la;ka.push((l+1)*(ia-1)+(la-1),oa,Aa);ka.push(oa,Ca,Aa)}})();x.setIndex(ka);x.setAttribute("position",new Ya(L,3));x.setAttribute("normal",new Ya(S,3));x.setAttribute("uv",new Ya(P,2));return x}y(f,c);f.prototype.toJSON=function(){var b=Na.prototype.toJSON.call(this);b.path=this.parameters.path.toJSON();return b};return f}(Na),hj=function(c){function f(b){var d=c.call(this)||this;d.type="WireframeGeometry";if(!0===b.isGeometry)return console.error("THREE.WireframeGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),
C(d);var g=[],l=[0,0],r={},v=new da;if(null!==b.index){var x=b.attributes.position,w=b.index;b=b.groups;0===b.length&&(b=[{start:0,count:w.count,materialIndex:0}]);for(var A=0,D=b.length;A<D;++A){var J=b[A],N=J.start,L=N;for(J=N+J.count;L<J;L+=3)for(N=0;3>N;N++){var S=w.getX(L+N),P=w.getX(L+(N+1)%3);l[0]=Math.min(S,P);l[1]=Math.max(S,P);S=l[0]+","+l[1];void 0===r[S]&&(r[S]={index1:l[0],index2:l[1]})}}for(var ka in r)l=r[ka],v.fromBufferAttribute(x,l.index1),g.push(v.x,v.y,v.z),v.fromBufferAttribute(x,
l.index2),g.push(v.x,v.y,v.z)}else for(r=b.attributes.position,x=0,ka=r.count/3;x<ka;x++)for(l=0;3>l;l++)v.fromBufferAttribute(r,3*x+l),g.push(v.x,v.y,v.z),v.fromBufferAttribute(r,3*x+(l+1)%3),g.push(v.x,v.y,v.z);d.setAttribute("position",new Ya(g,3));return d}y(f,c);return f}(Na),Xc=Object.freeze({__proto__:null,BoxGeometry:Ie,BoxBufferGeometry:Ie,CircleGeometry:Ah,CircleBufferGeometry:Ah,ConeGeometry:Bh,ConeBufferGeometry:Bh,CylinderGeometry:Nf,CylinderBufferGeometry:Nf,DodecahedronGeometry:Ch,
DodecahedronBufferGeometry:Ch,EdgesGeometry:gj,ExtrudeGeometry:cf,ExtrudeBufferGeometry:cf,IcosahedronGeometry:Fh,IcosahedronBufferGeometry:Fh,LatheGeometry:Gh,LatheBufferGeometry:Gh,OctahedronGeometry:sg,OctahedronBufferGeometry:sg,ParametricGeometry:Gd,ParametricBufferGeometry:Gd,PlaneGeometry:Qf,PlaneBufferGeometry:Qf,PolyhedronGeometry:Ee,PolyhedronBufferGeometry:Ee,RingGeometry:Hh,RingBufferGeometry:Hh,ShapeGeometry:tg,ShapeBufferGeometry:tg,SphereGeometry:ug,SphereBufferGeometry:ug,TetrahedronGeometry:Ih,
TetrahedronBufferGeometry:Ih,TextGeometry:Jh,TextBufferGeometry:Jh,TorusGeometry:Kh,TorusBufferGeometry:Kh,TorusKnotGeometry:Lh,TorusKnotBufferGeometry:Lh,TubeGeometry:Mh,TubeBufferGeometry:Mh,WireframeGeometry:hj});Yd.prototype=Object.create(U.prototype);Yd.prototype.constructor=Yd;Yd.prototype.isShadowMaterial=!0;Yd.prototype.copy=function(c){U.prototype.copy.call(this,c);this.color.copy(c.color);return this};kd.prototype=Object.create(yb.prototype);kd.prototype.constructor=kd;kd.prototype.isRawShaderMaterial=
!0;gd.prototype=Object.create(U.prototype);gd.prototype.constructor=gd;gd.prototype.isMeshStandardMaterial=!0;gd.prototype.copy=function(c){U.prototype.copy.call(this,c);this.defines={STANDARD:""};this.color.copy(c.color);this.roughness=c.roughness;this.metalness=c.metalness;this.map=c.map;this.lightMap=c.lightMap;this.lightMapIntensity=c.lightMapIntensity;this.aoMap=c.aoMap;this.aoMapIntensity=c.aoMapIntensity;this.emissive.copy(c.emissive);this.emissiveMap=c.emissiveMap;this.emissiveIntensity=c.emissiveIntensity;
this.bumpMap=c.bumpMap;this.bumpScale=c.bumpScale;this.normalMap=c.normalMap;this.normalMapType=c.normalMapType;this.normalScale.copy(c.normalScale);this.displacementMap=c.displacementMap;this.displacementScale=c.displacementScale;this.displacementBias=c.displacementBias;this.roughnessMap=c.roughnessMap;this.metalnessMap=c.metalnessMap;this.alphaMap=c.alphaMap;this.envMap=c.envMap;this.envMapIntensity=c.envMapIntensity;this.refractionRatio=c.refractionRatio;this.wireframe=c.wireframe;this.wireframeLinewidth=
c.wireframeLinewidth;this.wireframeLinecap=c.wireframeLinecap;this.wireframeLinejoin=c.wireframeLinejoin;this.skinning=c.skinning;this.morphTargets=c.morphTargets;this.morphNormals=c.morphNormals;this.vertexTangents=c.vertexTangents;return this};Hd.prototype=Object.create(gd.prototype);Hd.prototype.constructor=Hd;Hd.prototype.isMeshPhysicalMaterial=!0;Hd.prototype.copy=function(c){gd.prototype.copy.call(this,c);this.defines={STANDARD:"",PHYSICAL:""};this.clearcoat=c.clearcoat;this.clearcoatMap=c.clearcoatMap;
this.clearcoatRoughness=c.clearcoatRoughness;this.clearcoatRoughnessMap=c.clearcoatRoughnessMap;this.clearcoatNormalMap=c.clearcoatNormalMap;this.clearcoatNormalScale.copy(c.clearcoatNormalScale);this.reflectivity=c.reflectivity;this.sheen=c.sheen?(this.sheen||new Cb).copy(c.sheen):null;this.transmission=c.transmission;this.transmissionMap=c.transmissionMap;return this};Id.prototype=Object.create(U.prototype);Id.prototype.constructor=Id;Id.prototype.isMeshPhongMaterial=!0;Id.prototype.copy=function(c){U.prototype.copy.call(this,
c);this.color.copy(c.color);this.specular.copy(c.specular);this.shininess=c.shininess;this.map=c.map;this.lightMap=c.lightMap;this.lightMapIntensity=c.lightMapIntensity;this.aoMap=c.aoMap;this.aoMapIntensity=c.aoMapIntensity;this.emissive.copy(c.emissive);this.emissiveMap=c.emissiveMap;this.emissiveIntensity=c.emissiveIntensity;this.bumpMap=c.bumpMap;this.bumpScale=c.bumpScale;this.normalMap=c.normalMap;this.normalMapType=c.normalMapType;this.normalScale.copy(c.normalScale);this.displacementMap=c.displacementMap;
this.displacementScale=c.displacementScale;this.displacementBias=c.displacementBias;this.specularMap=c.specularMap;this.alphaMap=c.alphaMap;this.envMap=c.envMap;this.combine=c.combine;this.reflectivity=c.reflectivity;this.refractionRatio=c.refractionRatio;this.wireframe=c.wireframe;this.wireframeLinewidth=c.wireframeLinewidth;this.wireframeLinecap=c.wireframeLinecap;this.wireframeLinejoin=c.wireframeLinejoin;this.skinning=c.skinning;this.morphTargets=c.morphTargets;this.morphNormals=c.morphNormals;
return this};Zd.prototype=Object.create(U.prototype);Zd.prototype.constructor=Zd;Zd.prototype.isMeshToonMaterial=!0;Zd.prototype.copy=function(c){U.prototype.copy.call(this,c);this.color.copy(c.color);this.map=c.map;this.gradientMap=c.gradientMap;this.lightMap=c.lightMap;this.lightMapIntensity=c.lightMapIntensity;this.aoMap=c.aoMap;this.aoMapIntensity=c.aoMapIntensity;this.emissive.copy(c.emissive);this.emissiveMap=c.emissiveMap;this.emissiveIntensity=c.emissiveIntensity;this.bumpMap=c.bumpMap;this.bumpScale=
c.bumpScale;this.normalMap=c.normalMap;this.normalMapType=c.normalMapType;this.normalScale.copy(c.normalScale);this.displacementMap=c.displacementMap;this.displacementScale=c.displacementScale;this.displacementBias=c.displacementBias;this.alphaMap=c.alphaMap;this.wireframe=c.wireframe;this.wireframeLinewidth=c.wireframeLinewidth;this.wireframeLinecap=c.wireframeLinecap;this.wireframeLinejoin=c.wireframeLinejoin;this.skinning=c.skinning;this.morphTargets=c.morphTargets;this.morphNormals=c.morphNormals;
return this};Jd.prototype=Object.create(U.prototype);Jd.prototype.constructor=Jd;Jd.prototype.isMeshNormalMaterial=!0;Jd.prototype.copy=function(c){U.prototype.copy.call(this,c);this.bumpMap=c.bumpMap;this.bumpScale=c.bumpScale;this.normalMap=c.normalMap;this.normalMapType=c.normalMapType;this.normalScale.copy(c.normalScale);this.displacementMap=c.displacementMap;this.displacementScale=c.displacementScale;this.displacementBias=c.displacementBias;this.wireframe=c.wireframe;this.wireframeLinewidth=
c.wireframeLinewidth;this.skinning=c.skinning;this.morphTargets=c.morphTargets;this.morphNormals=c.morphNormals;return this};G.prototype=Object.create(U.prototype);G.prototype.constructor=G;G.prototype.isMeshLambertMaterial=!0;G.prototype.copy=function(c){U.prototype.copy.call(this,c);this.color.copy(c.color);this.map=c.map;this.lightMap=c.lightMap;this.lightMapIntensity=c.lightMapIntensity;this.aoMap=c.aoMap;this.aoMapIntensity=c.aoMapIntensity;this.emissive.copy(c.emissive);this.emissiveMap=c.emissiveMap;
this.emissiveIntensity=c.emissiveIntensity;this.specularMap=c.specularMap;this.alphaMap=c.alphaMap;this.envMap=c.envMap;this.combine=c.combine;this.reflectivity=c.reflectivity;this.refractionRatio=c.refractionRatio;this.wireframe=c.wireframe;this.wireframeLinewidth=c.wireframeLinewidth;this.wireframeLinecap=c.wireframeLinecap;this.wireframeLinejoin=c.wireframeLinejoin;this.skinning=c.skinning;this.morphTargets=c.morphTargets;this.morphNormals=c.morphNormals;return this};z.prototype=Object.create(U.prototype);
z.prototype.constructor=z;z.prototype.isMeshMatcapMaterial=!0;z.prototype.copy=function(c){U.prototype.copy.call(this,c);this.defines={MATCAP:""};this.color.copy(c.color);this.matcap=c.matcap;this.map=c.map;this.bumpMap=c.bumpMap;this.bumpScale=c.bumpScale;this.normalMap=c.normalMap;this.normalMapType=c.normalMapType;this.normalScale.copy(c.normalScale);this.displacementMap=c.displacementMap;this.displacementScale=c.displacementScale;this.displacementBias=c.displacementBias;this.alphaMap=c.alphaMap;
this.skinning=c.skinning;this.morphTargets=c.morphTargets;this.morphNormals=c.morphNormals;return this};p.prototype=Object.create(sc.prototype);p.prototype.constructor=p;p.prototype.isLineDashedMaterial=!0;p.prototype.copy=function(c){sc.prototype.copy.call(this,c);this.scale=c.scale;this.dashSize=c.dashSize;this.gapSize=c.gapSize;return this};var Al=Object.freeze({__proto__:null,ShadowMaterial:Yd,SpriteMaterial:pd,RawShaderMaterial:kd,ShaderMaterial:yb,PointsMaterial:cd,MeshPhysicalMaterial:Hd,MeshStandardMaterial:gd,
MeshPhongMaterial:Id,MeshToonMaterial:Zd,MeshNormalMaterial:Jd,MeshLambertMaterial:G,MeshDepthMaterial:Bd,MeshDistanceMaterial:Cd,MeshBasicMaterial:qa,MeshMatcapMaterial:z,LineDashedMaterial:p,LineBasicMaterial:sc,Material:U}),wc={arraySlice:function(c,f,b){return wc.isTypedArray(c)?new c.constructor(c.subarray(f,void 0!==b?b:c.length)):c.slice(f,b)},convertArray:function(c,f,b){return!c||!b&&c.constructor===f?c:"number"===typeof f.BYTES_PER_ELEMENT?new f(c):Array.prototype.slice.call(c)},isTypedArray:function(c){return ArrayBuffer.isView(c)&&
!(c instanceof DataView)},getKeyframeOrder:function(c){for(var f=c.length,b=Array(f),d=0;d!==f;++d)b[d]=d;b.sort(function(g,l){return c[g]-c[l]});return b},sortedArray:function(c,f,b){for(var d=c.length,g=new c.constructor(d),l=0,r=0;r!==d;++l)for(var v=b[l]*f,x=0;x!==f;++x)g[r++]=c[v+x];return g},flattenJSON:function(c,f,b,d){for(var g=1,l=c[0];void 0!==l&&void 0===l[d];)l=c[g++];if(void 0!==l){var r=l[d];if(void 0!==r)if(Array.isArray(r)){do r=l[d],void 0!==r&&(f.push(l.time),b.push.apply(b,r)),
l=c[g++];while(void 0!==l)}else if(void 0!==r.toArray){do r=l[d],void 0!==r&&(f.push(l.time),r.toArray(b,b.length)),l=c[g++];while(void 0!==l)}else{do r=l[d],void 0!==r&&(f.push(l.time),b.push(r)),l=c[g++];while(void 0!==l)}}},subclip:function(c,f,b,d,g){void 0===g&&(g=30);c=c.clone();c.name=f;f=[];for(var l=0;l<c.tracks.length;++l){for(var r=c.tracks[l],v=r.getValueSize(),x=[],w=[],A=0;A<r.times.length;++A){var D=r.times[A]*g;if(!(D<b||D>=d))for(x.push(r.times[A]),D=0;D<v;++D)w.push(r.values[A*v+
D])}0!==x.length&&(r.times=wc.convertArray(x,r.times.constructor),r.values=wc.convertArray(w,r.values.constructor),f.push(r))}c.tracks=f;b=Infinity;for(d=0;d<c.tracks.length;++d)b>c.tracks[d].times[0]&&(b=c.tracks[d].times[0]);for(d=0;d<c.tracks.length;++d)c.tracks[d].shift(-1*b);c.resetDuration();return c},makeClipAdditive:function(c,f,b,d){void 0===f&&(f=0);void 0===b&&(b=c);void 0===d&&(d=30);0>=d&&(d=30);var g=b.tracks.length,l=f/d;f=function(r){var v=b.tracks[r],x=v.ValueTypeName;if("bool"===
x||"string"===x)return"continue";r=c.tracks.find(function(ka){return ka.name===v.name&&ka.ValueTypeName===x});if(void 0===r)return"continue";var w=0,A=v.getValueSize();v.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(w=A/3);var D=0,J=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(D=J/3);var N=v.times.length-1,L=void 0;l<=v.times[0]?L=wc.arraySlice(v.values,w,A-w):l>=v.times[N]?(L=N*A+w,L=wc.arraySlice(v.values,L,L+A-w)):(L=v.createInterpolant(),N=w,
w=A-w,L.evaluate(l),L=wc.arraySlice(L.resultBuffer,N,w));"quaternion"===x&&(new Oc).fromArray(L).normalize().conjugate().toArray(L);w=r.times.length;for(A=0;A<w;++A)if(N=A*J+D,"quaternion"===x)Oc.multiplyQuaternionsFlat(r.values,N,L,0,r.values,N);else for(var S=J-2*D,P=0;P<S;++P)r.values[N+P]-=L[P]};for(d=0;d<g;++d)f(d);c.blendMode=2501;return c}};Object.assign(n.prototype,{evaluate:function(c){var f=this.parameterPositions,b=this._cachedIndex,d=f[b],g=f[b-1];a:{b:{c:{d:if(!(c<d)){for(var l=b+2;;){if(void 0===
d){if(c<g)break d;this._cachedIndex=b=f.length;return this.afterEnd_(b-1,c,g)}if(b===l)break;g=d;d=f[++b];if(c<d)break b}d=f.length;break c}if(c>=g)break a;else{l=f[1];c<l&&(b=2,g=l);for(l=b-2;;){if(void 0===g)return this._cachedIndex=0,this.beforeStart_(0,c,d);if(b===l)break;d=g;g=f[--b-1];if(c>=g)break b}d=b;b=0}}for(;b<d;)g=b+d>>>1,c<f[g]?d=g:b=g+1;d=f[b];g=f[b-1];if(void 0===g)return this._cachedIndex=0,this.beforeStart_(0,c,d);if(void 0===d)return this._cachedIndex=b=f.length,this.afterEnd_(b-
1,g,c)}this._cachedIndex=b;this.intervalChanged_(b,g,d)}return this.interpolate_(b,g,c,d)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(c){var f=this.resultBuffer,b=this.sampleValues,d=this.valueSize;c*=d;for(var g=0;g!==d;++g)f[g]=b[c+g];return f},interpolate_:function(){throw Error("call to abstract method");},intervalChanged_:function(){}});Object.assign(n.prototype,{beforeStart_:n.prototype.copySampleValue_,afterEnd_:n.prototype.copySampleValue_});
k.prototype=Object.assign(Object.create(n.prototype),{constructor:k,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(c,f,b){var d=this.parameterPositions,g=c-2,l=c+1,r=d[g],v=d[l];if(void 0===r)switch(this.getSettings_().endingStart){case 2401:g=c;r=2*f-b;break;case 2402:g=d.length-2;r=f+d[g]-d[g+1];break;default:g=c,r=b}if(void 0===v)switch(this.getSettings_().endingEnd){case 2401:l=c;v=2*b-f;break;case 2402:l=1;v=b+d[1]-d[0];break;default:l=c-1,v=f}c=.5*(b-f);d=this.valueSize;
this._weightPrev=c/(f-r);this._weightNext=c/(v-b);this._offsetPrev=g*d;this._offsetNext=l*d},interpolate_:function(c,f,b,d){var g=this.resultBuffer,l=this.sampleValues,r=this.valueSize;c*=r;var v=c-r,x=this._offsetPrev,w=this._offsetNext,A=this._weightPrev,D=this._weightNext,J=(b-f)/(d-f);b=J*J;d=b*J;f=-A*d+2*A*b-A*J;A=(1+A)*d+(-1.5-2*A)*b+(-.5+A)*J+1;J=(-1-D)*d+(1.5+D)*b+.5*J;D=D*d-D*b;for(b=0;b!==r;++b)g[b]=f*l[x+b]+A*l[v+b]+J*l[c+b]+D*l[w+b];return g}});q.prototype=Object.assign(Object.create(n.prototype),
{constructor:q,interpolate_:function(c,f,b,d){var g=this.resultBuffer,l=this.sampleValues,r=this.valueSize;c*=r;var v=c-r;f=(b-f)/(d-f);b=1-f;for(d=0;d!==r;++d)g[d]=l[v+d]*b+l[c+d]*f;return g}});u.prototype=Object.assign(Object.create(n.prototype),{constructor:u,interpolate_:function(c){return this.copySampleValue_(c-1)}});Object.assign(B,{toJSON:function(c){var f=c.constructor;if(void 0!==f.toJSON)f=f.toJSON(c);else{f={name:c.name,times:wc.convertArray(c.times,Array),values:wc.convertArray(c.values,
Array)};var b=c.getInterpolation();b!==c.DefaultInterpolation&&(f.interpolation=b)}f.type=c.ValueTypeName;return f}});Object.assign(B.prototype,{constructor:B,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(c){return new u(this.times,this.values,this.getValueSize(),c)},InterpolantFactoryMethodLinear:function(c){return new q(this.times,this.values,this.getValueSize(),c)},InterpolantFactoryMethodSmooth:function(c){return new k(this.times,
this.values,this.getValueSize(),c)},setInterpolation:function(c){switch(c){case 2300:var f=this.InterpolantFactoryMethodDiscrete;break;case 2301:f=this.InterpolantFactoryMethodLinear;break;case 2302:f=this.InterpolantFactoryMethodSmooth}if(void 0===f){f="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant)if(c!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw Error(f);console.warn("THREE.KeyframeTrack:",
f);return this}this.createInterpolant=f;return this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(c){if(0!==c)for(var f=this.times,b=0,d=f.length;b!==d;++b)f[b]+=c;return this},scale:function(c){if(1!==c)for(var f=this.times,b=0,d=f.length;b!==
d;++b)f[b]*=c;return this},trim:function(c,f){for(var b=this.times,d=b.length,g=0,l=d-1;g!==d&&b[g]<c;)++g;for(;-1!==l&&b[l]>f;)--l;++l;if(0!==g||l!==d)g>=l&&(l=Math.max(l,1),g=l-1),c=this.getValueSize(),this.times=wc.arraySlice(b,g,l),this.values=wc.arraySlice(this.values,g*c,l*c);return this},validate:function(){var c=!0,f=this.getValueSize();0!==f-Math.floor(f)&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),c=!1);var b=this.times;f=this.values;var d=b.length;0===d&&(console.error("THREE.KeyframeTrack: Track is empty.",
this),c=!1);for(var g=null,l=0;l!==d;l++){var r=b[l];if("number"===typeof r&&isNaN(r)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,l,r);c=!1;break}if(null!==g&&g>r){console.error("THREE.KeyframeTrack: Out of order keys.",this,l,r,g);c=!1;break}g=r}if(void 0!==f&&wc.isTypedArray(f))for(b=0,d=f.length;b!==d;++b)if(g=f[b],isNaN(g)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,b,g);c=!1;break}return c},optimize:function(){for(var c=wc.arraySlice(this.times),
f=wc.arraySlice(this.values),b=this.getValueSize(),d=2302===this.getInterpolation(),g=c.length-1,l=1,r=1;r<g;++r){var v=!1,x=c[r];if(x!==c[r+1]&&(1!==r||x!==c[0]))if(d)v=!0;else{x=r*b;for(var w=x-b,A=x+b,D=0;D!==b;++D){var J=f[x+D];if(J!==f[w+D]||J!==f[A+D]){v=!0;break}}}if(v){if(r!==l)for(c[l]=c[r],v=r*b,x=l*b,w=0;w!==b;++w)f[x+w]=f[v+w];++l}}if(0<g){c[l]=c[g];d=g*b;g=l*b;for(r=0;r!==b;++r)f[g+r]=f[d+r];++l}l!==c.length?(this.times=wc.arraySlice(c,0,l),this.values=wc.arraySlice(f,0,l*b)):(this.times=
c,this.values=f);return this},clone:function(){var c=wc.arraySlice(this.times,0),f=wc.arraySlice(this.values,0);c=new this.constructor(this.name,c,f);c.createInterpolant=this.createInterpolant;return c}});F.prototype=Object.assign(Object.create(B.prototype),{constructor:F,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});K.prototype=Object.assign(Object.create(B.prototype),{constructor:K,ValueTypeName:"color"});
Z.prototype=Object.assign(Object.create(B.prototype),{constructor:Z,ValueTypeName:"number"});ja.prototype=Object.assign(Object.create(n.prototype),{constructor:ja,interpolate_:function(c,f,b,d){var g=this.resultBuffer,l=this.sampleValues,r=this.valueSize;f=(b-f)/(d-f);c*=r;for(b=c+r;c!==b;c+=4)Oc.slerpFlat(g,0,l,c-r,l,c,f);return g}});ya.prototype=Object.assign(Object.create(B.prototype),{constructor:ya,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(c){return new ja(this.times,
this.values,this.getValueSize(),c)},InterpolantFactoryMethodSmooth:void 0});Xa.prototype=Object.assign(Object.create(B.prototype),{constructor:Xa,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});La.prototype=Object.assign(Object.create(B.prototype),{constructor:La,ValueTypeName:"vector"});Object.assign(Wa,{parse:function(c){for(var f=[],b=c.tracks,d=1/(c.fps||1),g=0,l=b.length;g!==l;++g){var r=f,v=
r.push;var x=b[g];if(void 0===x.type)throw Error("THREE.KeyframeTrack: track type undefined, can not parse");var w=db(x.type);if(void 0===x.times){var A=[],D=[];wc.flattenJSON(x.keys,A,D,"value");x.times=A;x.values=D}x=void 0!==w.parse?w.parse(x):new w(x.name,x.times,x.values,x.interpolation);v.call(r,x.scale(d))}f=new Wa(c.name,c.duration,f,c.blendMode);f.uuid=c.uuid;return f},toJSON:function(c){var f=[],b=c.tracks;c={name:c.name,duration:c.duration,tracks:f,uuid:c.uuid,blendMode:c.blendMode};for(var d=
0,g=b.length;d!==g;++d)f.push(B.toJSON(b[d]));return c},CreateFromMorphTargetSequence:function(c,f,b,d){for(var g=f.length,l=[],r=0;r<g;r++){var v=[],x=[];v.push((r+g-1)%g,r,(r+1)%g);x.push(0,1,0);var w=wc.getKeyframeOrder(v);v=wc.sortedArray(v,1,w);x=wc.sortedArray(x,1,w);d||0!==v[0]||(v.push(g),x.push(x[0]));l.push((new Z(".morphTargetInfluences["+f[r].name+"]",v,x)).scale(1/b))}return new Wa(c,-1,l)},findByName:function(c,f){var b=c;Array.isArray(c)||(b=c.geometry&&c.geometry.animations||c.animations);
for(c=0;c<b.length;c++)if(b[c].name===f)return b[c];return null},CreateClipsFromMorphTargetSequences:function(c,f,b){for(var d={},g=/^([\w-]*?)([\d]+)$/,l=0,r=c.length;l<r;l++){var v=c[l],x=v.name.match(g);if(x&&1<x.length){x=x[1];var w=d[x];w||(d[x]=w=[]);w.push(v)}}c=[];for(var A in d)c.push(Wa.CreateFromMorphTargetSequence(A,d[A],f,b));return c},parseAnimation:function(c,f){if(!c)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;var b=function(P,ka,ia,la,oa){if(0!==
ia.length){var Ca=[],Aa=[];wc.flattenJSON(ia,Ca,Aa,la);0!==Ca.length&&oa.push(new P(ka,Ca,Aa))}},d=[],g=c.name||"default",l=c.fps||30,r=c.blendMode,v=c.length||-1;c=c.hierarchy||[];for(var x=0;x<c.length;x++){var w=c[x].keys;if(w&&0!==w.length)if(w[0].morphTargets){v={};var A=void 0;for(A=0;A<w.length;A++)if(w[A].morphTargets)for(var D=0;D<w[A].morphTargets.length;D++)v[w[A].morphTargets[D]]=-1;for(var J in v){D=[];for(var N=[],L=0;L!==w[A].morphTargets.length;++L){var S=w[A];D.push(S.time);N.push(S.morphTarget===
J?1:0)}d.push(new Z(".morphTargetInfluence["+J+"]",D,N))}v=v.length*(l||1)}else A=".bones["+f[x].name+"]",b(La,A+".position",w,"pos",d),b(ya,A+".quaternion",w,"rot",d),b(La,A+".scale",w,"scl",d)}return 0===d.length?null:new Wa(g,v,d,r)}});Object.assign(Wa.prototype,{resetDuration:function(){for(var c=0,f=0,b=this.tracks.length;f!==b;++f){var d=this.tracks[f];c=Math.max(c,d.times[d.times.length-1])}this.duration=c;return this},trim:function(){for(var c=0;c<this.tracks.length;c++)this.tracks[c].trim(0,
this.duration);return this},validate:function(){for(var c=!0,f=0;f<this.tracks.length;f++)c=c&&this.tracks[f].validate();return c},optimize:function(){for(var c=0;c<this.tracks.length;c++)this.tracks[c].optimize();return this},clone:function(){for(var c=[],f=0;f<this.tracks.length;f++)c.push(this.tracks[f].clone());return new Wa(this.name,this.duration,c,this.blendMode)},toJSON:function(){return Wa.toJSON(this)}});var df={enabled:!1,files:{},add:function(c,f){!1!==this.enabled&&(this.files[c]=f)},
get:function(c){if(!1!==this.enabled)return this.files[c]},remove:function(c){delete this.files[c]},clear:function(){this.files={}}},Jj=new bb;Object.assign(sb.prototype,{load:function(){},loadAsync:function(c,f){var b=this;return new Promise(function(d,g){b.load(c,d,f,g)})},parse:function(){},setCrossOrigin:function(c){this.crossOrigin=c;return this},setWithCredentials:function(c){this.withCredentials=c;return this},setPath:function(c){this.path=c;return this},setResourcePath:function(c){this.resourcePath=
c;return this},setRequestHeader:function(c){this.requestHeader=c;return this}});var wd={};Wb.prototype=Object.assign(Object.create(sb.prototype),{constructor:Wb,load:function(c,f,b,d){void 0===c&&(c="");void 0!==this.path&&(c=this.path+c);c=this.manager.resolveURL(c);var g=this,l=df.get(c);if(void 0!==l)return g.manager.itemStart(c),setTimeout(function(){f&&f(l);g.manager.itemEnd(c)},0),l;if(void 0!==wd[c])wd[c].push({onLoad:f,onProgress:b,onError:d});else{var r=c.match(/^data:(.*?)(;base64)?,(.*)$/);
if(r){b=r[1];var v=!!r[2];r=r[3];r=decodeURIComponent(r);v&&(r=atob(r));try{var x=(this.responseType||"").toLowerCase();switch(x){case "arraybuffer":case "blob":var w=new Uint8Array(r.length);for(v=0;v<r.length;v++)w[v]=r.charCodeAt(v);var A="blob"===x?new Blob([w.buffer],{type:b}):w.buffer;break;case "document":A=(new DOMParser).parseFromString(r,b);break;case "json":A=JSON.parse(r);break;default:A=r}setTimeout(function(){f&&f(A);g.manager.itemEnd(c)},0)}catch(J){setTimeout(function(){d&&d(J);g.manager.itemError(c);
g.manager.itemEnd(c)},0)}}else{wd[c]=[];wd[c].push({onLoad:f,onProgress:b,onError:d});var D=new XMLHttpRequest;D.open("GET",c,!0);D.addEventListener("load",function(J){var N=this.response,L=wd[c];delete wd[c];if(200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");df.add(c,N);J=0;for(var S=L.length;J<S;J++){var P=L[J];if(P.onLoad)P.onLoad(N)}}else{N=0;for(S=L.length;N<S;N++)if(P=L[N],P.onError)P.onError(J);g.manager.itemError(c)}g.manager.itemEnd(c)},
!1);D.addEventListener("progress",function(J){for(var N=wd[c],L=0,S=N.length;L<S;L++){var P=N[L];if(P.onProgress)P.onProgress(J)}},!1);D.addEventListener("error",function(J){var N=wd[c];delete wd[c];for(var L=0,S=N.length;L<S;L++){var P=N[L];if(P.onError)P.onError(J)}g.manager.itemError(c);g.manager.itemEnd(c)},!1);D.addEventListener("abort",function(J){var N=wd[c];delete wd[c];for(var L=0,S=N.length;L<S;L++){var P=N[L];if(P.onError)P.onError(J)}g.manager.itemError(c);g.manager.itemEnd(c)},!1);void 0!==
this.responseType&&(D.responseType=this.responseType);void 0!==this.withCredentials&&(D.withCredentials=this.withCredentials);D.overrideMimeType&&D.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(v in this.requestHeader)D.setRequestHeader(v,this.requestHeader[v]);D.send(null)}g.manager.itemStart(c);return D}},setResponseType:function(c){this.responseType=c;return this},setMimeType:function(c){this.mimeType=c;return this}});tb.prototype=Object.assign(Object.create(sb.prototype),
{constructor:tb,load:function(c,f,b,d){var g=this,l=new Wb(g.manager);l.setPath(g.path);l.setRequestHeader(g.requestHeader);l.setWithCredentials(g.withCredentials);l.load(c,function(r){try{f(g.parse(JSON.parse(r)))}catch(v){d?d(v):console.error(v),g.manager.itemError(c)}},b,d)},parse:function(c){for(var f=[],b=0;b<c.length;b++){var d=Wa.parse(c[b]);f.push(d)}return f}});bc.prototype=Object.assign(Object.create(sb.prototype),{constructor:bc,load:function(c,f,b,d){function g(J){x.load(c[J],function(N){N=
l.parse(N,!0);r[J]={width:N.width,height:N.height,format:N.format,mipmaps:N.mipmaps};w+=1;6===w&&(1===N.mipmapCount&&(v.minFilter=1006),v.image=r,v.format=N.format,v.needsUpdate=!0,f&&f(v))},b,d)}var l=this,r=[],v=new ue,x=new Wb(this.manager);x.setPath(this.path);x.setResponseType("arraybuffer");x.setRequestHeader(this.requestHeader);x.setWithCredentials(l.withCredentials);var w=0;if(Array.isArray(c))for(var A=0,D=c.length;A<D;++A)g(A);else x.load(c,function(J){J=l.parse(J,!0);if(J.isCubemap){for(var N=
J.mipmaps.length/J.mipmapCount,L=0;L<N;L++){r[L]={mipmaps:[]};for(var S=0;S<J.mipmapCount;S++)r[L].mipmaps.push(J.mipmaps[L*J.mipmapCount+S]),r[L].format=J.format,r[L].width=J.width,r[L].height=J.height}v.image=r}else v.image.width=J.width,v.image.height=J.height,v.mipmaps=J.mipmaps;1===J.mipmapCount&&(v.minFilter=1006);v.format=J.format;v.needsUpdate=!0;f&&f(v)},b,d);return v}});fc.prototype=Object.assign(Object.create(sb.prototype),{constructor:fc,load:function(c,f,b,d){function g(){x.removeEventListener("load",
g,!1);x.removeEventListener("error",l,!1);df.add(c,this);f&&f(this);r.manager.itemEnd(c)}function l(w){x.removeEventListener("load",g,!1);x.removeEventListener("error",l,!1);d&&d(w);r.manager.itemError(c);r.manager.itemEnd(c)}void 0!==this.path&&(c=this.path+c);c=this.manager.resolveURL(c);var r=this,v=df.get(c);if(void 0!==v)return r.manager.itemStart(c),setTimeout(function(){f&&f(v);r.manager.itemEnd(c)},0),v;var x=document.createElementNS("http://www.w3.org/1999/xhtml","img");x.addEventListener("load",
g,!1);x.addEventListener("error",l,!1);"data:"!==c.substr(0,5)&&void 0!==this.crossOrigin&&(x.crossOrigin=this.crossOrigin);r.manager.itemStart(c);x.src=c;return x}});ub.prototype=Object.assign(Object.create(sb.prototype),{constructor:ub,load:function(c,f,b,d){function g(x){r.load(c[x],function(w){l.images[x]=w;v++;6===v&&(l.needsUpdate=!0,f&&f(l))},void 0,d)}var l=new Ob,r=new fc(this.manager);r.setCrossOrigin(this.crossOrigin);r.setPath(this.path);var v=0;for(b=0;b<c.length;++b)g(b);return l}});
Ac.prototype=Object.assign(Object.create(sb.prototype),{constructor:Ac,load:function(c,f,b,d){var g=this,l=new Ab,r=new Wb(this.manager);r.setResponseType("arraybuffer");r.setRequestHeader(this.requestHeader);r.setPath(this.path);r.setWithCredentials(g.withCredentials);r.load(c,function(v){if(v=g.parse(v))void 0!==v.image?l.image=v.image:void 0!==v.data&&(l.image.width=v.width,l.image.height=v.height,l.image.data=v.data),l.wrapS=void 0!==v.wrapS?v.wrapS:1001,l.wrapT=void 0!==v.wrapT?v.wrapT:1001,
l.magFilter=void 0!==v.magFilter?v.magFilter:1006,l.minFilter=void 0!==v.minFilter?v.minFilter:1006,l.anisotropy=void 0!==v.anisotropy?v.anisotropy:1,void 0!==v.encoding&&(l.encoding=v.encoding),void 0!==v.flipY&&(l.flipY=v.flipY),void 0!==v.format&&(l.format=v.format),void 0!==v.type&&(l.type=v.type),void 0!==v.mipmaps&&(l.mipmaps=v.mipmaps,l.minFilter=1008),1===v.mipmapCount&&(l.minFilter=1006),l.needsUpdate=!0,f&&f(l,v)},b,d);return l}});Uc.prototype=Object.assign(Object.create(sb.prototype),{constructor:Uc,
load:function(c,f,b,d){var g=new R,l=new fc(this.manager);l.setCrossOrigin(this.crossOrigin);l.setPath(this.path);l.load(c,function(r){g.image=r;r=0<c.search(/\.jpe?g($|\?)/i)||0===c.search(/^data:image\/jpeg/);g.format=r?1022:1023;g.needsUpdate=!0;void 0!==f&&f(g)},b,d);return g}});Object.assign(Eb.prototype,{getPoint:function(){console.warn("THREE.Curve: .getPoint() not implemented.");return null},getPointAt:function(c,f){c=this.getUtoTmapping(c);return this.getPoint(c,f)},getPoints:function(c){void 0===
c&&(c=5);for(var f=[],b=0;b<=c;b++)f.push(this.getPoint(b/c));return f},getSpacedPoints:function(c){void 0===c&&(c=5);for(var f=[],b=0;b<=c;b++)f.push(this.getPointAt(b/c));return f},getLength:function(){var c=this.getLengths();return c[c.length-1]},getLengths:function(c){void 0===c&&(c=this.arcLengthDivisions);if(this.cacheArcLengths&&this.cacheArcLengths.length===c+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var f=[],b=this.getPoint(0),d=0;f.push(0);for(var g=1;g<=c;g++){var l=
this.getPoint(g/c);d+=l.distanceTo(b);f.push(d);b=l}return this.cacheArcLengths=f},updateArcLengths:function(){this.needsUpdate=!0;this.getLengths()},getUtoTmapping:function(c,f){var b=this.getLengths(),d=b.length;f=f?f:c*b[d-1];for(var g=0,l=d-1,r;g<=l;)if(c=Math.floor(g+(l-g)/2),r=b[c]-f,0>r)g=c+1;else if(0<r)l=c-1;else{l=c;break}c=l;if(b[c]===f)return c/(d-1);g=b[c];return(c+(f-g)/(b[c+1]-g))/(d-1)},getTangent:function(c,f){var b=c-1E-4;c+=1E-4;0>b&&(b=0);1<c&&(c=1);b=this.getPoint(b);c=this.getPoint(c);
f=f||(b.isVector2?new ib:new da);f.copy(c).sub(b).normalize();return f},getTangentAt:function(c,f){c=this.getUtoTmapping(c);return this.getTangent(c,f)},computeFrenetFrames:function(c,f){for(var b=new da,d=[],g=[],l=[],r=new da,v=new ec,x=0;x<=c;x++)d[x]=this.getTangentAt(x/c,new da),d[x].normalize();g[0]=new da;l[0]=new da;x=Number.MAX_VALUE;var w=Math.abs(d[0].x),A=Math.abs(d[0].y),D=Math.abs(d[0].z);w<=x&&(x=w,b.set(1,0,0));A<=x&&(x=A,b.set(0,1,0));D<=x&&b.set(0,0,1);r.crossVectors(d[0],b).normalize();
g[0].crossVectors(d[0],r);l[0].crossVectors(d[0],g[0]);for(b=1;b<=c;b++)g[b]=g[b-1].clone(),l[b]=l[b-1].clone(),r.crossVectors(d[b-1],d[b]),r.length()>Number.EPSILON&&(r.normalize(),x=Math.acos(Qb.clamp(d[b-1].dot(d[b]),-1,1)),g[b].applyMatrix4(v.makeRotationAxis(r,x))),l[b].crossVectors(d[b],g[b]);if(!0===f)for(f=Math.acos(Qb.clamp(g[0].dot(g[c]),-1,1)),f/=c,0<d[0].dot(r.crossVectors(g[0],g[c]))&&(f=-f),r=1;r<=c;r++)g[r].applyMatrix4(v.makeRotationAxis(d[r],f*r)),l[r].crossVectors(d[r],g[r]);return{tangents:d,
normals:g,binormals:l}},clone:function(){return(new this.constructor).copy(this)},copy:function(c){this.arcLengthDivisions=c.arcLengthDivisions;return this},toJSON:function(){var c={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};c.arcLengthDivisions=this.arcLengthDivisions;c.type=this.type;return c},fromJSON:function(c){this.arcLengthDivisions=c.arcLengthDivisions;return this}});Hc.prototype=Object.create(Eb.prototype);Hc.prototype.constructor=Hc;Hc.prototype.isEllipseCurve=!0;Hc.prototype.getPoint=
function(c,f){f=f||new ib;for(var b=2*Math.PI,d=this.aEndAngle-this.aStartAngle,g=Math.abs(d)<Number.EPSILON;0>d;)d+=b;for(;d>b;)d-=b;d<Number.EPSILON&&(d=g?0:b);!0!==this.aClockwise||g||(d=d===b?-b:d-b);b=this.aStartAngle+c*d;c=this.aX+this.xRadius*Math.cos(b);var l=this.aY+this.yRadius*Math.sin(b);0!==this.aRotation&&(b=Math.cos(this.aRotation),d=Math.sin(this.aRotation),g=c-this.aX,l-=this.aY,c=g*b-l*d+this.aX,l=g*d+l*b+this.aY);return f.set(c,l)};Hc.prototype.copy=function(c){Eb.prototype.copy.call(this,
c);this.aX=c.aX;this.aY=c.aY;this.xRadius=c.xRadius;this.yRadius=c.yRadius;this.aStartAngle=c.aStartAngle;this.aEndAngle=c.aEndAngle;this.aClockwise=c.aClockwise;this.aRotation=c.aRotation;return this};Hc.prototype.toJSON=function(){var c=Eb.prototype.toJSON.call(this);c.aX=this.aX;c.aY=this.aY;c.xRadius=this.xRadius;c.yRadius=this.yRadius;c.aStartAngle=this.aStartAngle;c.aEndAngle=this.aEndAngle;c.aClockwise=this.aClockwise;c.aRotation=this.aRotation;return c};Hc.prototype.fromJSON=function(c){Eb.prototype.fromJSON.call(this,
c);this.aX=c.aX;this.aY=c.aY;this.xRadius=c.xRadius;this.yRadius=c.yRadius;this.aStartAngle=c.aStartAngle;this.aEndAngle=c.aEndAngle;this.aClockwise=c.aClockwise;this.aRotation=c.aRotation;return this};Vc.prototype=Object.create(Hc.prototype);Vc.prototype.constructor=Vc;Vc.prototype.isArcCurve=!0;var Nh=new da,ij=new zi,jj=new zi,kj=new zi;Qc.prototype=Object.create(Eb.prototype);Qc.prototype.constructor=Qc;Qc.prototype.isCatmullRomCurve3=!0;Qc.prototype.getPoint=function(c,f){void 0===f&&(f=new da);
var b=this.points,d=b.length;c*=d-(this.closed?0:1);var g=Math.floor(c);c-=g;this.closed?g+=0<g?0:(Math.floor(Math.abs(g)/d)+1)*d:0===c&&g===d-1&&(g=d-2,c=1);if(this.closed||0<g)var l=b[(g-1)%d];else Nh.subVectors(b[0],b[1]).add(b[0]),l=Nh;var r=b[g%d],v=b[(g+1)%d];this.closed||g+2<d?b=b[(g+2)%d]:(Nh.subVectors(b[d-1],b[d-2]).add(b[d-1]),b=Nh);if("centripetal"===this.curveType||"chordal"===this.curveType){var x="chordal"===this.curveType?.5:.25;d=Math.pow(l.distanceToSquared(r),x);g=Math.pow(r.distanceToSquared(v),
x);x=Math.pow(v.distanceToSquared(b),x);1E-4>g&&(g=1);1E-4>d&&(d=g);1E-4>x&&(x=g);ij.initNonuniformCatmullRom(l.x,r.x,v.x,b.x,d,g,x);jj.initNonuniformCatmullRom(l.y,r.y,v.y,b.y,d,g,x);kj.initNonuniformCatmullRom(l.z,r.z,v.z,b.z,d,g,x)}else"catmullrom"===this.curveType&&(ij.initCatmullRom(l.x,r.x,v.x,b.x,this.tension),jj.initCatmullRom(l.y,r.y,v.y,b.y,this.tension),kj.initCatmullRom(l.z,r.z,v.z,b.z,this.tension));f.set(ij.calc(c),jj.calc(c),kj.calc(c));return f};Qc.prototype.copy=function(c){Eb.prototype.copy.call(this,
c);this.points=[];for(var f=0,b=c.points.length;f<b;f++)this.points.push(c.points[f].clone());this.closed=c.closed;this.curveType=c.curveType;this.tension=c.tension;return this};Qc.prototype.toJSON=function(){var c=Eb.prototype.toJSON.call(this);c.points=[];for(var f=0,b=this.points.length;f<b;f++)c.points.push(this.points[f].toArray());c.closed=this.closed;c.curveType=this.curveType;c.tension=this.tension;return c};Qc.prototype.fromJSON=function(c){Eb.prototype.fromJSON.call(this,c);this.points=
[];for(var f=0,b=c.points.length;f<b;f++){var d=c.points[f];this.points.push((new da).fromArray(d))}this.closed=c.closed;this.curveType=c.curveType;this.tension=c.tension;return this};qd.prototype=Object.create(Eb.prototype);qd.prototype.constructor=qd;qd.prototype.isCubicBezierCurve=!0;qd.prototype.getPoint=function(c,f){void 0===f&&(f=new ib);var b=this.v0,d=this.v1,g=this.v2,l=this.v3;f.set(eg(c,b.x,d.x,g.x,l.x),eg(c,b.y,d.y,g.y,l.y));return f};qd.prototype.copy=function(c){Eb.prototype.copy.call(this,
c);this.v0.copy(c.v0);this.v1.copy(c.v1);this.v2.copy(c.v2);this.v3.copy(c.v3);return this};qd.prototype.toJSON=function(){var c=Eb.prototype.toJSON.call(this);c.v0=this.v0.toArray();c.v1=this.v1.toArray();c.v2=this.v2.toArray();c.v3=this.v3.toArray();return c};qd.prototype.fromJSON=function(c){Eb.prototype.fromJSON.call(this,c);this.v0.fromArray(c.v0);this.v1.fromArray(c.v1);this.v2.fromArray(c.v2);this.v3.fromArray(c.v3);return this};Kd.prototype=Object.create(Eb.prototype);Kd.prototype.constructor=
Kd;Kd.prototype.isCubicBezierCurve3=!0;Kd.prototype.getPoint=function(c,f){void 0===f&&(f=new da);var b=this.v0,d=this.v1,g=this.v2,l=this.v3;f.set(eg(c,b.x,d.x,g.x,l.x),eg(c,b.y,d.y,g.y,l.y),eg(c,b.z,d.z,g.z,l.z));return f};Kd.prototype.copy=function(c){Eb.prototype.copy.call(this,c);this.v0.copy(c.v0);this.v1.copy(c.v1);this.v2.copy(c.v2);this.v3.copy(c.v3);return this};Kd.prototype.toJSON=function(){var c=Eb.prototype.toJSON.call(this);c.v0=this.v0.toArray();c.v1=this.v1.toArray();c.v2=this.v2.toArray();
c.v3=this.v3.toArray();return c};Kd.prototype.fromJSON=function(c){Eb.prototype.fromJSON.call(this,c);this.v0.fromArray(c.v0);this.v1.fromArray(c.v1);this.v2.fromArray(c.v2);this.v3.fromArray(c.v3);return this};dd.prototype=Object.create(Eb.prototype);dd.prototype.constructor=dd;dd.prototype.isLineCurve=!0;dd.prototype.getPoint=function(c,f){void 0===f&&(f=new ib);1===c?f.copy(this.v2):(f.copy(this.v2).sub(this.v1),f.multiplyScalar(c).add(this.v1));return f};dd.prototype.getPointAt=function(c,f){return this.getPoint(c,
f)};dd.prototype.getTangent=function(c,f){c=f||new ib;c.copy(this.v2).sub(this.v1).normalize();return c};dd.prototype.copy=function(c){Eb.prototype.copy.call(this,c);this.v1.copy(c.v1);this.v2.copy(c.v2);return this};dd.prototype.toJSON=function(){var c=Eb.prototype.toJSON.call(this);c.v1=this.v1.toArray();c.v2=this.v2.toArray();return c};dd.prototype.fromJSON=function(c){Eb.prototype.fromJSON.call(this,c);this.v1.fromArray(c.v1);this.v2.fromArray(c.v2);return this};rd.prototype=Object.create(Eb.prototype);
rd.prototype.constructor=rd;rd.prototype.isLineCurve3=!0;rd.prototype.getPoint=function(c,f){void 0===f&&(f=new da);1===c?f.copy(this.v2):(f.copy(this.v2).sub(this.v1),f.multiplyScalar(c).add(this.v1));return f};rd.prototype.getPointAt=function(c,f){return this.getPoint(c,f)};rd.prototype.copy=function(c){Eb.prototype.copy.call(this,c);this.v1.copy(c.v1);this.v2.copy(c.v2);return this};rd.prototype.toJSON=function(){var c=Eb.prototype.toJSON.call(this);c.v1=this.v1.toArray();c.v2=this.v2.toArray();
return c};rd.prototype.fromJSON=function(c){Eb.prototype.fromJSON.call(this,c);this.v1.fromArray(c.v1);this.v2.fromArray(c.v2);return this};sd.prototype=Object.create(Eb.prototype);sd.prototype.constructor=sd;sd.prototype.isQuadraticBezierCurve=!0;sd.prototype.getPoint=function(c,f){void 0===f&&(f=new ib);var b=this.v0,d=this.v1,g=this.v2;f.set(dg(c,b.x,d.x,g.x),dg(c,b.y,d.y,g.y));return f};sd.prototype.copy=function(c){Eb.prototype.copy.call(this,c);this.v0.copy(c.v0);this.v1.copy(c.v1);this.v2.copy(c.v2);
return this};sd.prototype.toJSON=function(){var c=Eb.prototype.toJSON.call(this);c.v0=this.v0.toArray();c.v1=this.v1.toArray();c.v2=this.v2.toArray();return c};sd.prototype.fromJSON=function(c){Eb.prototype.fromJSON.call(this,c);this.v0.fromArray(c.v0);this.v1.fromArray(c.v1);this.v2.fromArray(c.v2);return this};Ld.prototype=Object.create(Eb.prototype);Ld.prototype.constructor=Ld;Ld.prototype.isQuadraticBezierCurve3=!0;Ld.prototype.getPoint=function(c,f){void 0===f&&(f=new da);var b=this.v0,d=this.v1,
g=this.v2;f.set(dg(c,b.x,d.x,g.x),dg(c,b.y,d.y,g.y),dg(c,b.z,d.z,g.z));return f};Ld.prototype.copy=function(c){Eb.prototype.copy.call(this,c);this.v0.copy(c.v0);this.v1.copy(c.v1);this.v2.copy(c.v2);return this};Ld.prototype.toJSON=function(){var c=Eb.prototype.toJSON.call(this);c.v0=this.v0.toArray();c.v1=this.v1.toArray();c.v2=this.v2.toArray();return c};Ld.prototype.fromJSON=function(c){Eb.prototype.fromJSON.call(this,c);this.v0.fromArray(c.v0);this.v1.fromArray(c.v1);this.v2.fromArray(c.v2);return this};
td.prototype=Object.create(Eb.prototype);td.prototype.constructor=td;td.prototype.isSplineCurve=!0;td.prototype.getPoint=function(c,f){void 0===f&&(f=new ib);var b=this.points,d=(b.length-1)*c;c=Math.floor(d);d-=c;var g=b[0===c?c:c-1],l=b[c],r=b[c>b.length-2?b.length-1:c+1];b=b[c>b.length-3?b.length-1:c+2];f.set(Kj(d,g.x,l.x,r.x,b.x),Kj(d,g.y,l.y,r.y,b.y));return f};td.prototype.copy=function(c){Eb.prototype.copy.call(this,c);this.points=[];for(var f=0,b=c.points.length;f<b;f++)this.points.push(c.points[f].clone());
return this};td.prototype.toJSON=function(){var c=Eb.prototype.toJSON.call(this);c.points=[];for(var f=0,b=this.points.length;f<b;f++)c.points.push(this.points[f].toArray());return c};td.prototype.fromJSON=function(c){Eb.prototype.fromJSON.call(this,c);this.points=[];for(var f=0,b=c.points.length;f<b;f++){var d=c.points[f];this.points.push((new ib).fromArray(d))}return this};var lj=Object.freeze({__proto__:null,ArcCurve:Vc,CatmullRomCurve3:Qc,CubicBezierCurve:qd,CubicBezierCurve3:Kd,EllipseCurve:Hc,
LineCurve:dd,LineCurve3:rd,QuadraticBezierCurve:sd,QuadraticBezierCurve3:Ld,SplineCurve:td});xe.prototype=Object.assign(Object.create(Eb.prototype),{constructor:xe,add:function(c){this.curves.push(c)},closePath:function(){var c=this.curves[0].getPoint(0),f=this.curves[this.curves.length-1].getPoint(1);c.equals(f)||this.curves.push(new dd(f,c))},getPoint:function(c){var f=c*this.getLength(),b=this.getCurveLengths();for(c=0;c<b.length;){if(b[c]>=f)return f=b[c]-f,c=this.curves[c],b=c.getLength(),c.getPointAt(0===
b?0:1-f/b);c++}return null},getLength:function(){var c=this.getCurveLengths();return c[c.length-1]},updateArcLengths:function(){this.needsUpdate=!0;this.cacheLengths=null;this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var c=[],f=0,b=0,d=this.curves.length;b<d;b++)f+=this.curves[b].getLength(),c.push(f);return this.cacheLengths=c},getSpacedPoints:function(c){void 0===c&&(c=40);for(var f=[],b=0;b<=c;b++)f.push(this.getPoint(b/
c));this.autoClose&&f.push(f[0]);return f},getPoints:function(c){void 0===c&&(c=12);for(var f=[],b,d=0,g=this.curves;d<g.length;d++){var l=g[d];l=l.getPoints(l&&l.isEllipseCurve?2*c:l&&(l.isLineCurve||l.isLineCurve3)?1:l&&l.isSplineCurve?c*l.points.length:c);for(var r=0;r<l.length;r++){var v=l[r];b&&b.equals(v)||(f.push(v),b=v)}}this.autoClose&&1<f.length&&!f[f.length-1].equals(f[0])&&f.push(f[0]);return f},copy:function(c){Eb.prototype.copy.call(this,c);this.curves=[];for(var f=0,b=c.curves.length;f<
b;f++)this.curves.push(c.curves[f].clone());this.autoClose=c.autoClose;return this},toJSON:function(){var c=Eb.prototype.toJSON.call(this);c.autoClose=this.autoClose;c.curves=[];for(var f=0,b=this.curves.length;f<b;f++)c.curves.push(this.curves[f].toJSON());return c},fromJSON:function(c){Eb.prototype.fromJSON.call(this,c);this.autoClose=c.autoClose;this.curves=[];for(var f=0,b=c.curves.length;f<b;f++){var d=c.curves[f];this.curves.push((new lj[d.type]).fromJSON(d))}return this}});ud.prototype=Object.assign(Object.create(xe.prototype),
{constructor:ud,setFromPoints:function(c){this.moveTo(c[0].x,c[0].y);for(var f=1,b=c.length;f<b;f++)this.lineTo(c[f].x,c[f].y);return this},moveTo:function(c,f){this.currentPoint.set(c,f);return this},lineTo:function(c,f){var b=new dd(this.currentPoint.clone(),new ib(c,f));this.curves.push(b);this.currentPoint.set(c,f);return this},quadraticCurveTo:function(c,f,b,d){c=new sd(this.currentPoint.clone(),new ib(c,f),new ib(b,d));this.curves.push(c);this.currentPoint.set(b,d);return this},bezierCurveTo:function(c,
f,b,d,g,l){c=new qd(this.currentPoint.clone(),new ib(c,f),new ib(b,d),new ib(g,l));this.curves.push(c);this.currentPoint.set(g,l);return this},splineThru:function(c){var f=[this.currentPoint.clone()].concat(c);f=new td(f);this.curves.push(f);this.currentPoint.copy(c[c.length-1]);return this},arc:function(c,f,b,d,g,l){this.absarc(c+this.currentPoint.x,f+this.currentPoint.y,b,d,g,l);return this},absarc:function(c,f,b,d,g,l){this.absellipse(c,f,b,b,d,g,l);return this},ellipse:function(c,f,b,d,g,l,r,
v){this.absellipse(c+this.currentPoint.x,f+this.currentPoint.y,b,d,g,l,r,v);return this},absellipse:function(c,f,b,d,g,l,r,v){c=new Hc(c,f,b,d,g,l,r,v);0<this.curves.length&&(f=c.getPoint(0),f.equals(this.currentPoint)||this.lineTo(f.x,f.y));this.curves.push(c);c=c.getPoint(1);this.currentPoint.copy(c);return this},copy:function(c){xe.prototype.copy.call(this,c);this.currentPoint.copy(c.currentPoint);return this},toJSON:function(){var c=xe.prototype.toJSON.call(this);c.currentPoint=this.currentPoint.toArray();
return c},fromJSON:function(c){xe.prototype.fromJSON.call(this,c);this.currentPoint.fromArray(c.currentPoint);return this}});ye.prototype=Object.assign(Object.create(ud.prototype),{constructor:ye,getPointsHoles:function(c){for(var f=[],b=0,d=this.holes.length;b<d;b++)f[b]=this.holes[b].getPoints(c);return f},extractPoints:function(c){return{shape:this.getPoints(c),holes:this.getPointsHoles(c)}},copy:function(c){ud.prototype.copy.call(this,c);this.holes=[];for(var f=0,b=c.holes.length;f<b;f++)this.holes.push(c.holes[f].clone());
return this},toJSON:function(){var c=ud.prototype.toJSON.call(this);c.uuid=this.uuid;c.holes=[];for(var f=0,b=this.holes.length;f<b;f++)c.holes.push(this.holes[f].toJSON());return c},fromJSON:function(c){ud.prototype.fromJSON.call(this,c);this.uuid=c.uuid;this.holes=[];for(var f=0,b=c.holes.length;f<b;f++){var d=c.holes[f];this.holes.push((new ud).fromJSON(d))}return this}});uc.prototype=Object.assign(Object.create(T.prototype),{constructor:uc,isLight:!0,copy:function(c){T.prototype.copy.call(this,
c);this.color.copy(c.color);this.intensity=c.intensity;return this},toJSON:function(c){c=T.prototype.toJSON.call(this,c);c.object.color=this.color.getHex();c.object.intensity=this.intensity;void 0!==this.groundColor&&(c.object.groundColor=this.groundColor.getHex());void 0!==this.distance&&(c.object.distance=this.distance);void 0!==this.angle&&(c.object.angle=this.angle);void 0!==this.decay&&(c.object.decay=this.decay);void 0!==this.penumbra&&(c.object.penumbra=this.penumbra);void 0!==this.shadow&&
(c.object.shadow=this.shadow.toJSON());return c}});$g.prototype=Object.assign(Object.create(uc.prototype),{constructor:$g,isHemisphereLight:!0,copy:function(c){uc.prototype.copy.call(this,c);this.groundColor.copy(c.groundColor);return this}});Object.assign($d.prototype,{_projScreenMatrix:new ec,_lightPositionWorld:new da,_lookTarget:new da,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(c){var f=this.camera,b=this.matrix,
d=this._projScreenMatrix,g=this._lookTarget,l=this._lightPositionWorld;l.setFromMatrixPosition(c.matrixWorld);f.position.copy(l);g.setFromMatrixPosition(c.target.matrixWorld);f.lookAt(g);f.updateMatrixWorld();d.multiplyMatrices(f.projectionMatrix,f.matrixWorldInverse);this._frustum.setFromProjectionMatrix(d);b.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);b.multiply(f.projectionMatrix);b.multiply(f.matrixWorldInverse)},getViewport:function(c){return this._viewports[c]},getFrameExtents:function(){return this._frameExtents},
copy:function(c){this.camera=c.camera.clone();this.bias=c.bias;this.radius=c.radius;this.mapSize.copy(c.mapSize);return this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var c={};0!==this.bias&&(c.bias=this.bias);0!==this.normalBias&&(c.normalBias=this.normalBias);1!==this.radius&&(c.radius=this.radius);if(512!==this.mapSize.x||512!==this.mapSize.y)c.mapSize=this.mapSize.toArray();c.camera=this.camera.toJSON(!1).object;delete c.camera.matrix;return c}});Ai.prototype=
Object.assign(Object.create($d.prototype),{constructor:Ai,isSpotLightShadow:!0,updateMatrices:function(c){var f=this.camera,b=2*Qb.RAD2DEG*c.angle*this.focus,d=this.mapSize.width/this.mapSize.height,g=c.distance||f.far;if(b!==f.fov||d!==f.aspect||g!==f.far)f.fov=b,f.aspect=d,f.far=g,f.updateProjectionMatrix();$d.prototype.updateMatrices.call(this,c)}});ah.prototype=Object.assign(Object.create(uc.prototype),{constructor:ah,isSpotLight:!0,copy:function(c){uc.prototype.copy.call(this,c);this.distance=
c.distance;this.angle=c.angle;this.penumbra=c.penumbra;this.decay=c.decay;this.target=c.target.clone();this.shadow=c.shadow.clone();return this}});Bi.prototype=Object.assign(Object.create($d.prototype),{constructor:Bi,isPointLightShadow:!0,updateMatrices:function(c,f){void 0===f&&(f=0);var b=this.camera,d=this.matrix,g=this._lightPositionWorld,l=this._lookTarget,r=this._projScreenMatrix;g.setFromMatrixPosition(c.matrixWorld);b.position.copy(g);l.copy(b.position);l.add(this._cubeDirections[f]);b.up.copy(this._cubeUps[f]);
b.lookAt(l);b.updateMatrixWorld();d.makeTranslation(-g.x,-g.y,-g.z);r.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse);this._frustum.setFromProjectionMatrix(r)}});bh.prototype=Object.assign(Object.create(uc.prototype),{constructor:bh,isPointLight:!0,copy:function(c){uc.prototype.copy.call(this,c);this.distance=c.distance;this.decay=c.decay;this.shadow=c.shadow.clone();return this}});yf.prototype=Object.assign(Object.create(wb.prototype),{constructor:yf,isOrthographicCamera:!0,copy:function(c,
f){wb.prototype.copy.call(this,c,f);this.left=c.left;this.right=c.right;this.top=c.top;this.bottom=c.bottom;this.near=c.near;this.far=c.far;this.zoom=c.zoom;this.view=null===c.view?null:Object.assign({},c.view);return this},setViewOffset:function(c,f,b,d,g,l){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1});this.view.enabled=!0;this.view.fullWidth=c;this.view.fullHeight=f;this.view.offsetX=b;this.view.offsetY=d;this.view.width=g;this.view.height=
l;this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1);this.updateProjectionMatrix()},updateProjectionMatrix:function(){var c=(this.right-this.left)/(2*this.zoom),f=(this.top-this.bottom)/(2*this.zoom),b=(this.right+this.left)/2,d=(this.top+this.bottom)/2,g=b-c;b+=c;c=d+f;f=d-f;null!==this.view&&this.view.enabled&&(d=(this.right-this.left)/this.view.fullWidth/this.zoom,f=(this.top-this.bottom)/this.view.fullHeight/this.zoom,g+=d*this.view.offsetX,b=g+
d*this.view.width,c-=f*this.view.offsetY,f=c-f*this.view.height);this.projectionMatrix.makeOrthographic(g,b,c,f,this.near,this.far);this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(c){c=T.prototype.toJSON.call(this,c);c.object.zoom=this.zoom;c.object.left=this.left;c.object.right=this.right;c.object.top=this.top;c.object.bottom=this.bottom;c.object.near=this.near;c.object.far=this.far;null!==this.view&&(c.object.view=Object.assign({},this.view));return c}});Ci.prototype=
Object.assign(Object.create($d.prototype),{constructor:Ci,isDirectionalLightShadow:!0,updateMatrices:function(c){$d.prototype.updateMatrices.call(this,c)}});ch.prototype=Object.assign(Object.create(uc.prototype),{constructor:ch,isDirectionalLight:!0,copy:function(c){uc.prototype.copy.call(this,c);this.target=c.target.clone();this.shadow=c.shadow.clone();return this}});dh.prototype=Object.assign(Object.create(uc.prototype),{constructor:dh,isAmbientLight:!0});eh.prototype=Object.assign(Object.create(uc.prototype),
{constructor:eh,isRectAreaLight:!0,copy:function(c){uc.prototype.copy.call(this,c);this.width=c.width;this.height=c.height;return this},toJSON:function(c){c=uc.prototype.toJSON.call(this,c);c.object.width=this.width;c.object.height=this.height;return c}});var Lj=function(){function c(){Object.defineProperty(this,"isSphericalHarmonics3",{value:!0});this.coefficients=[];for(var b=0;9>b;b++)this.coefficients.push(new da)}var f=c.prototype;f.set=function(b){for(var d=0;9>d;d++)this.coefficients[d].copy(b[d]);
return this};f.zero=function(){for(var b=0;9>b;b++)this.coefficients[b].set(0,0,0);return this};f.getAt=function(b,d){var g=b.x,l=b.y;b=b.z;var r=this.coefficients;d.copy(r[0]).multiplyScalar(.282095);d.addScaledVector(r[1],.488603*l);d.addScaledVector(r[2],.488603*b);d.addScaledVector(r[3],.488603*g);d.addScaledVector(r[4],1.092548*g*l);d.addScaledVector(r[5],1.092548*l*b);d.addScaledVector(r[6],.315392*(3*b*b-1));d.addScaledVector(r[7],1.092548*g*b);d.addScaledVector(r[8],.546274*(g*g-l*l));return d};
f.getIrradianceAt=function(b,d){var g=b.x,l=b.y;b=b.z;var r=this.coefficients;d.copy(r[0]).multiplyScalar(.886227);d.addScaledVector(r[1],1.023328*l);d.addScaledVector(r[2],1.023328*b);d.addScaledVector(r[3],1.023328*g);d.addScaledVector(r[4],.858086*g*l);d.addScaledVector(r[5],.858086*l*b);d.addScaledVector(r[6],.743125*b*b-.247708);d.addScaledVector(r[7],.858086*g*b);d.addScaledVector(r[8],.429043*(g*g-l*l));return d};f.add=function(b){for(var d=0;9>d;d++)this.coefficients[d].add(b.coefficients[d]);
return this};f.addScaledSH=function(b,d){for(var g=0;9>g;g++)this.coefficients[g].addScaledVector(b.coefficients[g],d);return this};f.scale=function(b){for(var d=0;9>d;d++)this.coefficients[d].multiplyScalar(b);return this};f.lerp=function(b,d){for(var g=0;9>g;g++)this.coefficients[g].lerp(b.coefficients[g],d);return this};f.equals=function(b){for(var d=0;9>d;d++)if(!this.coefficients[d].equals(b.coefficients[d]))return!1;return!0};f.copy=function(b){return this.set(b.coefficients)};f.clone=function(){return(new this.constructor).copy(this)};
f.fromArray=function(b,d){void 0===d&&(d=0);for(var g=this.coefficients,l=0;9>l;l++)g[l].fromArray(b,d+3*l);return this};f.toArray=function(b,d){void 0===b&&(b=[]);void 0===d&&(d=0);for(var g=this.coefficients,l=0;9>l;l++)g[l].toArray(b,d+3*l);return b};c.getBasisAt=function(b,d){var g=b.x,l=b.y;b=b.z;d[0]=.282095;d[1]=.488603*l;d[2]=.488603*b;d[3]=.488603*g;d[4]=1.092548*g*l;d[5]=1.092548*l*b;d[6]=.315392*(3*b*b-1);d[7]=1.092548*g*b;d[8]=.546274*(g*g-l*l)};return c}();ld.prototype=Object.assign(Object.create(uc.prototype),
{constructor:ld,isLightProbe:!0,copy:function(c){uc.prototype.copy.call(this,c);this.sh.copy(c.sh);return this},fromJSON:function(c){this.intensity=c.intensity;this.sh.fromArray(c.sh);return this},toJSON:function(c){c=uc.prototype.toJSON.call(this,c);c.object.sh=this.sh.toArray();return c}});fh.prototype=Object.assign(Object.create(sb.prototype),{constructor:fh,load:function(c,f,b,d){var g=this,l=new Wb(g.manager);l.setPath(g.path);l.setRequestHeader(g.requestHeader);l.setWithCredentials(g.withCredentials);
l.load(c,function(r){try{f(g.parse(JSON.parse(r)))}catch(v){d?d(v):console.error(v),g.manager.itemError(c)}},b,d)},parse:function(c){function f(v){void 0===b[v]&&console.warn("THREE.MaterialLoader: Undefined texture",v);return b[v]}var b=this.textures,d=new Al[c.type];void 0!==c.uuid&&(d.uuid=c.uuid);void 0!==c.name&&(d.name=c.name);void 0!==c.color&&void 0!==d.color&&d.color.setHex(c.color);void 0!==c.roughness&&(d.roughness=c.roughness);void 0!==c.metalness&&(d.metalness=c.metalness);void 0!==c.sheen&&
(d.sheen=(new Cb).setHex(c.sheen));void 0!==c.emissive&&void 0!==d.emissive&&d.emissive.setHex(c.emissive);void 0!==c.specular&&void 0!==d.specular&&d.specular.setHex(c.specular);void 0!==c.shininess&&(d.shininess=c.shininess);void 0!==c.clearcoat&&(d.clearcoat=c.clearcoat);void 0!==c.clearcoatRoughness&&(d.clearcoatRoughness=c.clearcoatRoughness);void 0!==c.fog&&(d.fog=c.fog);void 0!==c.flatShading&&(d.flatShading=c.flatShading);void 0!==c.blending&&(d.blending=c.blending);void 0!==c.combine&&(d.combine=
c.combine);void 0!==c.side&&(d.side=c.side);void 0!==c.opacity&&(d.opacity=c.opacity);void 0!==c.transparent&&(d.transparent=c.transparent);void 0!==c.alphaTest&&(d.alphaTest=c.alphaTest);void 0!==c.depthTest&&(d.depthTest=c.depthTest);void 0!==c.depthWrite&&(d.depthWrite=c.depthWrite);void 0!==c.colorWrite&&(d.colorWrite=c.colorWrite);void 0!==c.stencilWrite&&(d.stencilWrite=c.stencilWrite);void 0!==c.stencilWriteMask&&(d.stencilWriteMask=c.stencilWriteMask);void 0!==c.stencilFunc&&(d.stencilFunc=
c.stencilFunc);void 0!==c.stencilRef&&(d.stencilRef=c.stencilRef);void 0!==c.stencilFuncMask&&(d.stencilFuncMask=c.stencilFuncMask);void 0!==c.stencilFail&&(d.stencilFail=c.stencilFail);void 0!==c.stencilZFail&&(d.stencilZFail=c.stencilZFail);void 0!==c.stencilZPass&&(d.stencilZPass=c.stencilZPass);void 0!==c.wireframe&&(d.wireframe=c.wireframe);void 0!==c.wireframeLinewidth&&(d.wireframeLinewidth=c.wireframeLinewidth);void 0!==c.wireframeLinecap&&(d.wireframeLinecap=c.wireframeLinecap);void 0!==
c.wireframeLinejoin&&(d.wireframeLinejoin=c.wireframeLinejoin);void 0!==c.rotation&&(d.rotation=c.rotation);1!==c.linewidth&&(d.linewidth=c.linewidth);void 0!==c.dashSize&&(d.dashSize=c.dashSize);void 0!==c.gapSize&&(d.gapSize=c.gapSize);void 0!==c.scale&&(d.scale=c.scale);void 0!==c.polygonOffset&&(d.polygonOffset=c.polygonOffset);void 0!==c.polygonOffsetFactor&&(d.polygonOffsetFactor=c.polygonOffsetFactor);void 0!==c.polygonOffsetUnits&&(d.polygonOffsetUnits=c.polygonOffsetUnits);void 0!==c.skinning&&
(d.skinning=c.skinning);void 0!==c.morphTargets&&(d.morphTargets=c.morphTargets);void 0!==c.morphNormals&&(d.morphNormals=c.morphNormals);void 0!==c.dithering&&(d.dithering=c.dithering);void 0!==c.vertexTangents&&(d.vertexTangents=c.vertexTangents);void 0!==c.visible&&(d.visible=c.visible);void 0!==c.toneMapped&&(d.toneMapped=c.toneMapped);void 0!==c.userData&&(d.userData=c.userData);void 0!==c.vertexColors&&(d.vertexColors="number"===typeof c.vertexColors?0<c.vertexColors?!0:!1:c.vertexColors);if(void 0!==
c.uniforms)for(var g in c.uniforms){var l=c.uniforms[g];d.uniforms[g]={};switch(l.type){case "t":d.uniforms[g].value=f(l.value);break;case "c":d.uniforms[g].value=(new Cb).setHex(l.value);break;case "v2":d.uniforms[g].value=(new ib).fromArray(l.value);break;case "v3":d.uniforms[g].value=(new da).fromArray(l.value);break;case "v4":d.uniforms[g].value=(new qc).fromArray(l.value);break;case "m3":d.uniforms[g].value=(new fd).fromArray(l.value);break;case "m4":d.uniforms[g].value=(new ec).fromArray(l.value);
break;default:d.uniforms[g].value=l.value}}void 0!==c.defines&&(d.defines=c.defines);void 0!==c.vertexShader&&(d.vertexShader=c.vertexShader);void 0!==c.fragmentShader&&(d.fragmentShader=c.fragmentShader);if(void 0!==c.extensions)for(var r in c.extensions)d.extensions[r]=c.extensions[r];void 0!==c.shading&&(d.flatShading=1===c.shading);void 0!==c.size&&(d.size=c.size);void 0!==c.sizeAttenuation&&(d.sizeAttenuation=c.sizeAttenuation);void 0!==c.map&&(d.map=f(c.map));void 0!==c.matcap&&(d.matcap=f(c.matcap));
void 0!==c.alphaMap&&(d.alphaMap=f(c.alphaMap));void 0!==c.bumpMap&&(d.bumpMap=f(c.bumpMap));void 0!==c.bumpScale&&(d.bumpScale=c.bumpScale);void 0!==c.normalMap&&(d.normalMap=f(c.normalMap));void 0!==c.normalMapType&&(d.normalMapType=c.normalMapType);void 0!==c.normalScale&&(g=c.normalScale,!1===Array.isArray(g)&&(g=[g,g]),d.normalScale=(new ib).fromArray(g));void 0!==c.displacementMap&&(d.displacementMap=f(c.displacementMap));void 0!==c.displacementScale&&(d.displacementScale=c.displacementScale);
void 0!==c.displacementBias&&(d.displacementBias=c.displacementBias);void 0!==c.roughnessMap&&(d.roughnessMap=f(c.roughnessMap));void 0!==c.metalnessMap&&(d.metalnessMap=f(c.metalnessMap));void 0!==c.emissiveMap&&(d.emissiveMap=f(c.emissiveMap));void 0!==c.emissiveIntensity&&(d.emissiveIntensity=c.emissiveIntensity);void 0!==c.specularMap&&(d.specularMap=f(c.specularMap));void 0!==c.envMap&&(d.envMap=f(c.envMap));void 0!==c.envMapIntensity&&(d.envMapIntensity=c.envMapIntensity);void 0!==c.reflectivity&&
(d.reflectivity=c.reflectivity);void 0!==c.refractionRatio&&(d.refractionRatio=c.refractionRatio);void 0!==c.lightMap&&(d.lightMap=f(c.lightMap));void 0!==c.lightMapIntensity&&(d.lightMapIntensity=c.lightMapIntensity);void 0!==c.aoMap&&(d.aoMap=f(c.aoMap));void 0!==c.aoMapIntensity&&(d.aoMapIntensity=c.aoMapIntensity);void 0!==c.gradientMap&&(d.gradientMap=f(c.gradientMap));void 0!==c.clearcoatMap&&(d.clearcoatMap=f(c.clearcoatMap));void 0!==c.clearcoatRoughnessMap&&(d.clearcoatRoughnessMap=f(c.clearcoatRoughnessMap));
void 0!==c.clearcoatNormalMap&&(d.clearcoatNormalMap=f(c.clearcoatNormalMap));void 0!==c.clearcoatNormalScale&&(d.clearcoatNormalScale=(new ib).fromArray(c.clearcoatNormalScale));void 0!==c.transmission&&(d.transmission=c.transmission);void 0!==c.transmissionMap&&(d.transmissionMap=f(c.transmissionMap));return d},setTextures:function(c){this.textures=c;return this}});var mj={decodeText:function(c){if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(c);for(var f="",b=0,d=c.length;b<
d;b++)f+=String.fromCharCode(c[b]);try{return decodeURIComponent(escape(f))}catch(g){return f}},extractUrlBase:function(c){var f=c.lastIndexOf("/");return-1===f?"./":c.substr(0,f+1)}};fg.prototype=Object.assign(Object.create(Na.prototype),{constructor:fg,isInstancedBufferGeometry:!0,copy:function(c){Na.prototype.copy.call(this,c);this.instanceCount=c.instanceCount;return this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var c=Na.prototype.toJSON.call(this);c.instanceCount=
this.instanceCount;c.isInstancedBufferGeometry=!0;return c}});gh.prototype=Object.assign(Object.create(M.prototype),{constructor:gh,isInstancedBufferAttribute:!0,copy:function(c){M.prototype.copy.call(this,c);this.meshPerAttribute=c.meshPerAttribute;return this},toJSON:function(){var c=M.prototype.toJSON.call(this);c.meshPerAttribute=this.meshPerAttribute;c.isInstancedBufferAttribute=!0;return c}});hh.prototype=Object.assign(Object.create(sb.prototype),{constructor:hh,load:function(c,f,b,d){var g=
this,l=new Wb(g.manager);l.setPath(g.path);l.setRequestHeader(g.requestHeader);l.setWithCredentials(g.withCredentials);l.load(c,function(r){try{f(g.parse(JSON.parse(r)))}catch(v){d?d(v):console.error(v),g.manager.itemError(c)}},b,d)},parse:function(c){function f(N,L){if(void 0!==b[L])return b[L];var S=N.interleavedBuffers[L];var P=S.buffer;void 0!==d[P]?P=d[P]:(N=(new Uint32Array(N.arrayBuffers[P])).buffer,P=d[P]=N);P=new lg[S.type](P);P=new Tc(P,S.stride);P.uuid=S.uuid;return b[L]=P}var b={},d={},
g=c.isInstancedBufferGeometry?new fg:new Na,l=c.data.index;void 0!==l&&(l=new lg[l.type](l.array),g.setIndex(new M(l,1)));l=c.data.attributes;for(var r in l){var v=l[r],x=void 0;v.isInterleavedBufferAttribute?(x=f(c.data,v.data),x=new od(x,v.itemSize,v.offset,v.normalized)):(x=new lg[v.type](v.array),x=new (v.isInstancedBufferAttribute?gh:M)(x,v.itemSize,v.normalized));void 0!==v.name&&(x.name=v.name);g.setAttribute(r,x)}if(r=c.data.morphAttributes)for(var w in r){l=r[w];v=[];x=0;for(var A=l.length;x<
A;x++){var D=l[x],J=void 0;D.isInterleavedBufferAttribute?(J=f(c.data,D.data),J=new od(J,D.itemSize,D.offset,D.normalized)):(J=new lg[D.type](D.array),J=new M(J,D.itemSize,D.normalized));void 0!==D.name&&(J.name=D.name);v.push(J)}g.morphAttributes[w]=v}c.data.morphTargetsRelative&&(g.morphTargetsRelative=!0);w=c.data.groups||c.data.drawcalls||c.data.offsets;if(void 0!==w)for(r=0,l=w.length;r!==l;++r)v=w[r],g.addGroup(v.start,v.count,v.materialIndex);w=c.data.boundingSphere;void 0!==w&&(r=new da,void 0!==
w.center&&r.fromArray(w.center),g.boundingSphere=new Be(r,w.radius));c.name&&(g.name=c.name);c.userData&&(g.userData=c.userData);return g}});var Cl=function(c){function f(d){return c.call(this,d)||this}y(f,c);var b=f.prototype;b.load=function(d,g,l,r){var v=this,x=""===this.path?mj.extractUrlBase(d):this.path;this.resourcePath=this.resourcePath||x;x=new Wb(this.manager);x.setPath(this.path);x.setRequestHeader(this.requestHeader);x.setWithCredentials(this.withCredentials);x.load(d,function(w){var A=
null;try{A=JSON.parse(w)}catch(D){void 0!==r&&r(D);console.error("THREE:ObjectLoader: Can't parse "+d+".",D.message);return}w=A.metadata;void 0===w||void 0===w.type||"geometry"===w.type.toLowerCase()?console.error("THREE.ObjectLoader: Can't load "+d):v.parse(A,g)},l,r)};b.parse=function(d,g){var l=this.parseAnimations(d.animations),r=this.parseShapes(d.shapes),v=this.parseGeometries(d.geometries,r);r=this.parseImages(d.images,function(){void 0!==g&&g(w)});var x=this.parseTextures(d.textures,r);x=
this.parseMaterials(d.materials,x);var w=this.parseObject(d.object,v,x,l);d=this.parseSkeletons(d.skeletons,w);this.bindSkeletons(w,d);if(void 0!==g){d=!1;for(var A in r)if(r[A]instanceof HTMLImageElement){d=!0;break}!1===d&&g(w)}return w};b.parseShapes=function(d){var g={};if(void 0!==d)for(var l=0,r=d.length;l<r;l++){var v=(new ye).fromJSON(d[l]);g[v.uuid]=v}return g};b.parseSkeletons=function(d,g){var l={},r={};g.traverse(function(w){w.isBone&&(r[w.uuid]=w)});if(void 0!==d){g=0;for(var v=d.length;g<
v;g++){var x=(new Ue).fromJSON(d[g],r);l[x.uuid]=x}}return l};b.parseGeometries=function(d,g){var l={};if(void 0!==d)for(var r=new hh,v=0,x=d.length;v<x;v++){var w=void 0;var A=d[v];switch(A.type){case "PlaneGeometry":case "PlaneBufferGeometry":w=new Xc[A.type](A.width,A.height,A.widthSegments,A.heightSegments);break;case "BoxGeometry":case "BoxBufferGeometry":w=new Xc[A.type](A.width,A.height,A.depth,A.widthSegments,A.heightSegments,A.depthSegments);break;case "CircleGeometry":case "CircleBufferGeometry":w=
new Xc[A.type](A.radius,A.segments,A.thetaStart,A.thetaLength);break;case "CylinderGeometry":case "CylinderBufferGeometry":w=new Xc[A.type](A.radiusTop,A.radiusBottom,A.height,A.radialSegments,A.heightSegments,A.openEnded,A.thetaStart,A.thetaLength);break;case "ConeGeometry":case "ConeBufferGeometry":w=new Xc[A.type](A.radius,A.height,A.radialSegments,A.heightSegments,A.openEnded,A.thetaStart,A.thetaLength);break;case "SphereGeometry":case "SphereBufferGeometry":w=new Xc[A.type](A.radius,A.widthSegments,
A.heightSegments,A.phiStart,A.phiLength,A.thetaStart,A.thetaLength);break;case "DodecahedronGeometry":case "DodecahedronBufferGeometry":case "IcosahedronGeometry":case "IcosahedronBufferGeometry":case "OctahedronGeometry":case "OctahedronBufferGeometry":case "TetrahedronGeometry":case "TetrahedronBufferGeometry":w=new Xc[A.type](A.radius,A.detail);break;case "RingGeometry":case "RingBufferGeometry":w=new Xc[A.type](A.innerRadius,A.outerRadius,A.thetaSegments,A.phiSegments,A.thetaStart,A.thetaLength);
break;case "TorusGeometry":case "TorusBufferGeometry":w=new Xc[A.type](A.radius,A.tube,A.radialSegments,A.tubularSegments,A.arc);break;case "TorusKnotGeometry":case "TorusKnotBufferGeometry":w=new Xc[A.type](A.radius,A.tube,A.tubularSegments,A.radialSegments,A.p,A.q);break;case "TubeGeometry":case "TubeBufferGeometry":w=new Xc[A.type]((new lj[A.path.type]).fromJSON(A.path),A.tubularSegments,A.radius,A.radialSegments,A.closed);break;case "LatheGeometry":case "LatheBufferGeometry":w=new Xc[A.type](A.points,
A.segments,A.phiStart,A.phiLength);break;case "PolyhedronGeometry":case "PolyhedronBufferGeometry":w=new Xc[A.type](A.vertices,A.indices,A.radius,A.details);break;case "ShapeGeometry":case "ShapeBufferGeometry":w=[];for(var D=0,J=A.shapes.length;D<J;D++)w.push(g[A.shapes[D]]);w=new Xc[A.type](w,A.curveSegments);break;case "ExtrudeGeometry":case "ExtrudeBufferGeometry":w=[];D=0;for(J=A.shapes.length;D<J;D++)w.push(g[A.shapes[D]]);D=A.options.extrudePath;void 0!==D&&(A.options.extrudePath=(new lj[D.type]).fromJSON(D));
w=new Xc[A.type](w,A.options);break;case "BufferGeometry":case "InstancedBufferGeometry":w=r.parse(A);break;case "Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+A.type+'"');continue}w.uuid=A.uuid;void 0!==A.name&&(w.name=A.name);!0===w.isBufferGeometry&&void 0!==A.userData&&(w.userData=A.userData);l[A.uuid]=w}return l};b.parseMaterials=function(d,g){var l={},r={};if(void 0!==d){var v=
new fh;v.setTextures(g);g=0;for(var x=d.length;g<x;g++){var w=d[g];if("MultiMaterial"===w.type){for(var A=[],D=0;D<w.materials.length;D++){var J=w.materials[D];void 0===l[J.uuid]&&(l[J.uuid]=v.parse(J));A.push(l[J.uuid])}r[w.uuid]=A}else void 0===l[w.uuid]&&(l[w.uuid]=v.parse(w)),r[w.uuid]=l[w.uuid]}}return r};b.parseAnimations=function(d){var g={};if(void 0!==d)for(var l=0;l<d.length;l++){var r=Wa.parse(d[l]);g[r.uuid]=r}return g};b.parseImages=function(d,g){function l(P){v.manager.itemStart(P);
return w.load(P,function(){v.manager.itemEnd(P)},void 0,function(){v.manager.itemError(P);v.manager.itemEnd(P)})}function r(P){return"string"===typeof P?(P=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(P)?P:v.resourcePath+P,l(P)):P.data?{data:new lg[P.type](P.data),width:P.width,height:P.height}:null}var v=this,x={};if(void 0!==d&&0<d.length){g=new bb(g);var w=new fc(g);w.setCrossOrigin(this.crossOrigin);g=0;for(var A=d.length;g<A;g++){var D=d[g],J=D.url;if(Array.isArray(J)){x[D.uuid]=[];for(var N=0,L=J.length;N<
L;N++){var S=r(J[N]);null!==S&&(S instanceof HTMLImageElement?x[D.uuid].push(S):x[D.uuid].push(new Ab(S.data,S.width,S.height)))}}else J=r(D.url),null!==J&&(x[D.uuid]=J)}}return x};b.parseTextures=function(d,g){function l(J,N){if("number"===typeof J)return J;console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",J);return N[J]}var r={};if(void 0!==d)for(var v=0,x=d.length;v<x;v++){var w=d[v];void 0===w.image&&console.warn('THREE.ObjectLoader: No "image" specified for',
w.uuid);void 0===g[w.image]&&console.warn("THREE.ObjectLoader: Undefined image",w.image);var A=void 0,D=g[w.image];Array.isArray(D)?(A=new Ob(D),6===D.length&&(A.needsUpdate=!0)):(A=D&&D.data?new Ab(D.data,D.width,D.height):new R(D),D&&(A.needsUpdate=!0));A.uuid=w.uuid;void 0!==w.name&&(A.name=w.name);void 0!==w.mapping&&(A.mapping=l(w.mapping,Bl));void 0!==w.offset&&A.offset.fromArray(w.offset);void 0!==w.repeat&&A.repeat.fromArray(w.repeat);void 0!==w.center&&A.center.fromArray(w.center);void 0!==
w.rotation&&(A.rotation=w.rotation);void 0!==w.wrap&&(A.wrapS=l(w.wrap[0],Ck),A.wrapT=l(w.wrap[1],Ck));void 0!==w.format&&(A.format=w.format);void 0!==w.type&&(A.type=w.type);void 0!==w.encoding&&(A.encoding=w.encoding);void 0!==w.minFilter&&(A.minFilter=l(w.minFilter,Dk));void 0!==w.magFilter&&(A.magFilter=l(w.magFilter,Dk));void 0!==w.anisotropy&&(A.anisotropy=w.anisotropy);void 0!==w.flipY&&(A.flipY=w.flipY);void 0!==w.premultiplyAlpha&&(A.premultiplyAlpha=w.premultiplyAlpha);void 0!==w.unpackAlignment&&
(A.unpackAlignment=w.unpackAlignment);r[w.uuid]=A}return r};b.parseObject=function(d,g,l,r){function v(J){void 0===g[J]&&console.warn("THREE.ObjectLoader: Undefined geometry",J);return g[J]}function x(J){if(void 0!==J){if(Array.isArray(J)){for(var N=[],L=0,S=J.length;L<S;L++){var P=J[L];void 0===l[P]&&console.warn("THREE.ObjectLoader: Undefined material",P);N.push(l[P])}return N}void 0===l[J]&&console.warn("THREE.ObjectLoader: Undefined material",J);return l[J]}}switch(d.type){case "Scene":var w=
new cj;void 0!==d.background&&Number.isInteger(d.background)&&(w.background=new Cb(d.background));void 0!==d.fog&&("Fog"===d.fog.type?w.fog=new lk(d.fog.color,d.fog.near,d.fog.far):"FogExp2"===d.fog.type&&(w.fog=new kk(d.fog.color,d.fog.density)));break;case "PerspectiveCamera":w=new Bb(d.fov,d.aspect,d.near,d.far);void 0!==d.focus&&(w.focus=d.focus);void 0!==d.zoom&&(w.zoom=d.zoom);void 0!==d.filmGauge&&(w.filmGauge=d.filmGauge);void 0!==d.filmOffset&&(w.filmOffset=d.filmOffset);void 0!==d.view&&
(w.view=Object.assign({},d.view));break;case "OrthographicCamera":w=new yf(d.left,d.right,d.top,d.bottom,d.near,d.far);void 0!==d.zoom&&(w.zoom=d.zoom);void 0!==d.view&&(w.view=Object.assign({},d.view));break;case "AmbientLight":w=new dh(d.color,d.intensity);break;case "DirectionalLight":w=new ch(d.color,d.intensity);break;case "PointLight":w=new bh(d.color,d.intensity,d.distance,d.decay);break;case "RectAreaLight":w=new eh(d.color,d.intensity,d.width,d.height);break;case "SpotLight":w=new ah(d.color,
d.intensity,d.distance,d.angle,d.penumbra,d.decay);break;case "HemisphereLight":w=new $g(d.color,d.groundColor,d.intensity);break;case "LightProbe":w=(new ld).fromJSON(d);break;case "SkinnedMesh":w=v(d.geometry);var A=x(d.material);w=new Se(w,A);void 0!==d.bindMode&&(w.bindMode=d.bindMode);void 0!==d.bindMatrix&&w.bindMatrix.fromArray(d.bindMatrix);void 0!==d.skeleton&&(w.skeleton=d.skeleton);break;case "Mesh":w=v(d.geometry);A=x(d.material);w=new $a(w,A);break;case "InstancedMesh":w=v(d.geometry);
A=x(d.material);var D=d.instanceMatrix;w=new jd(w,A,d.count);w.instanceMatrix=new M(new Float32Array(D.array),16);break;case "LOD":w=new Re;break;case "Line":w=new bd(v(d.geometry),x(d.material));break;case "LineLoop":w=new te(v(d.geometry),x(d.material));break;case "LineSegments":w=new Mc(v(d.geometry),x(d.material));break;case "PointCloud":case "Points":w=new Vd(v(d.geometry),x(d.material));break;case "Sprite":w=new Qe(x(d.material));break;case "Group":w=new Dd;break;case "Bone":w=new Te;break;
default:w=new T}w.uuid=d.uuid;void 0!==d.name&&(w.name=d.name);void 0!==d.matrix?(w.matrix.fromArray(d.matrix),void 0!==d.matrixAutoUpdate&&(w.matrixAutoUpdate=d.matrixAutoUpdate),w.matrixAutoUpdate&&w.matrix.decompose(w.position,w.quaternion,w.scale)):(void 0!==d.position&&w.position.fromArray(d.position),void 0!==d.rotation&&w.rotation.fromArray(d.rotation),void 0!==d.quaternion&&w.quaternion.fromArray(d.quaternion),void 0!==d.scale&&w.scale.fromArray(d.scale));void 0!==d.castShadow&&(w.castShadow=
d.castShadow);void 0!==d.receiveShadow&&(w.receiveShadow=d.receiveShadow);d.shadow&&(void 0!==d.shadow.bias&&(w.shadow.bias=d.shadow.bias),void 0!==d.shadow.normalBias&&(w.shadow.normalBias=d.shadow.normalBias),void 0!==d.shadow.radius&&(w.shadow.radius=d.shadow.radius),void 0!==d.shadow.mapSize&&w.shadow.mapSize.fromArray(d.shadow.mapSize),void 0!==d.shadow.camera&&(w.shadow.camera=this.parseObject(d.shadow.camera)));void 0!==d.visible&&(w.visible=d.visible);void 0!==d.frustumCulled&&(w.frustumCulled=
d.frustumCulled);void 0!==d.renderOrder&&(w.renderOrder=d.renderOrder);void 0!==d.userData&&(w.userData=d.userData);void 0!==d.layers&&(w.layers.mask=d.layers);if(void 0!==d.children)for(D=d.children,A=0;A<D.length;A++)w.add(this.parseObject(D[A],g,l,r));if(void 0!==d.animations)for(D=d.animations,A=0;A<D.length;A++)w.animations.push(r[D[A]]);if("LOD"===d.type)for(void 0!==d.autoUpdate&&(w.autoUpdate=d.autoUpdate),d=d.levels,r=0;r<d.length;r++)D=d[r],A=w.getObjectByProperty("uuid",D.object),void 0!==
A&&w.addLevel(A,D.distance);return w};b.bindSkeletons=function(d,g){0!==Object.keys(g).length&&d.traverse(function(l){if(!0===l.isSkinnedMesh&&void 0!==l.skeleton){var r=g[l.skeleton];void 0===r?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",l.skeleton):l.bind(r,l.bindMatrix)}})};b.setTexturePath=function(d){console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath().");return this.setResourcePath(d)};return f}(sb),Bl={UVMapping:300,CubeReflectionMapping:301,
CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},Ck={RepeatWrapping:1E3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},Dk={NearestFilter:1003,NearestMipmapNearestFilter:1004,NearestMipmapLinearFilter:1005,LinearFilter:1006,LinearMipmapNearestFilter:1007,LinearMipmapLinearFilter:1008};Di.prototype=Object.assign(Object.create(sb.prototype),{constructor:Di,isImageBitmapLoader:!0,setOptions:function(c){this.options=
c;return this},load:function(c,f,b,d){void 0===c&&(c="");void 0!==this.path&&(c=this.path+c);c=this.manager.resolveURL(c);var g=this,l=df.get(c);if(void 0!==l)return g.manager.itemStart(c),setTimeout(function(){f&&f(l);g.manager.itemEnd(c)},0),l;b={};b.credentials="anonymous"===this.crossOrigin?"same-origin":"include";fetch(c,b).then(function(r){return r.blob()}).then(function(r){return createImageBitmap(r,g.options)}).then(function(r){df.add(c,r);f&&f(r);g.manager.itemEnd(c)}).catch(function(r){d&&
d(r);g.manager.itemError(c);g.manager.itemEnd(c)});g.manager.itemStart(c)}});Object.assign(Ei.prototype,{moveTo:function(c,f){this.currentPath=new ud;this.subPaths.push(this.currentPath);this.currentPath.moveTo(c,f);return this},lineTo:function(c,f){this.currentPath.lineTo(c,f);return this},quadraticCurveTo:function(c,f,b,d){this.currentPath.quadraticCurveTo(c,f,b,d);return this},bezierCurveTo:function(c,f,b,d,g,l){this.currentPath.bezierCurveTo(c,f,b,d,g,l);return this},splineThru:function(c){this.currentPath.splineThru(c);
return this},toShapes:function(c,f){function b(P){for(var ka=[],ia=0,la=P.length;ia<la;ia++){var oa=P[ia],Ca=new ye;Ca.curves=oa.curves;ka.push(Ca)}return ka}function d(P,ka){for(var ia=ka.length,la=!1,oa=ia-1,Ca=0;Ca<ia;oa=Ca++){var Aa=ka[oa],ra=ka[Ca],Ja=ra.x-Aa.x,Ra=ra.y-Aa.y;if(Math.abs(Ra)>Number.EPSILON){if(0>Ra&&(Aa=ka[Ca],Ja=-Ja,ra=ka[oa],Ra=-Ra),!(P.y<Aa.y||P.y>ra.y))if(P.y===Aa.y){if(P.x===Aa.x)return!0}else{oa=Ra*(P.x-Aa.x)-Ja*(P.y-Aa.y);if(0===oa)return!0;0>oa||(la=!la)}}else if(P.y===
Aa.y&&(ra.x<=P.x&&P.x<=Aa.x||Aa.x<=P.x&&P.x<=ra.x))return!0}return la}var g=ge.isClockWise,l=this.subPaths;if(0===l.length)return[];if(!0===f)return b(l);f=[];if(1===l.length){var r=l[0];var v=new ye;v.curves=r.curves;f.push(v);return f}var x=!g(l[0].getPoints());x=c?!x:x;v=[];var w=[],A=[],D=0;w[D]=void 0;A[D]=[];for(var J=0,N=l.length;J<N;J++){r=l[J];var L=r.getPoints();var S=g(L);(S=c?!S:S)?(!x&&w[D]&&D++,w[D]={s:new ye,p:L},w[D].s.curves=r.curves,x&&D++,A[D]=[]):A[D].push({h:r,p:L[0]})}if(!w[0])return b(l);
if(1<w.length){c=!1;g=[];l=0;for(r=w.length;l<r;l++)v[l]=[];l=0;for(r=w.length;l<r;l++)for(S=A[l],x=0;x<S.length;x++){D=S[x];L=!0;for(J=0;J<w.length;J++)d(D.p,w[J].p)&&(l!==J&&g.push({froms:l,tos:J,hole:x}),L?(L=!1,v[J].push(D)):c=!0);L&&v[l].push(D)}0<g.length&&(c||(A=v))}g=0;for(l=w.length;g<l;g++)for(v=w[g].s,f.push(v),c=A[g],r=0,S=c.length;r<S;r++)v.holes.push(c[r].h);return f}});var Ek=function(){function c(f){Object.defineProperty(this,"isFont",{value:!0});this.type="Font";this.data=f}c.prototype.generateShapes=
function(f,b){void 0===b&&(b=100);var d=[],g=b;b=this.data;var l=Array.from?Array.from(f):String(f).split("");g/=b.resolution;var r=(b.boundingBox.yMax-b.boundingBox.yMin+b.underlineThickness)*g;f=[];for(var v=0,x=0,w=0;w<l.length;w++){var A=l[w];if("\n"===A)v=0,x-=r;else{var D=A;A=g;var J=v,N=x,L=b,S=L.glyphs[D]||L.glyphs["?"];if(S){D=new Ei;if(S.o){L=S._cachedOutline||(S._cachedOutline=S.o.split(" "));for(var P=0,ka=L.length;P<ka;)switch(L[P++]){case "m":var ia=L[P++]*A+J;var la=L[P++]*A+N;D.moveTo(ia,
la);break;case "l":ia=L[P++]*A+J;la=L[P++]*A+N;D.lineTo(ia,la);break;case "q":var oa=L[P++]*A+J;var Ca=L[P++]*A+N;var Aa=L[P++]*A+J;var ra=L[P++]*A+N;D.quadraticCurveTo(Aa,ra,oa,Ca);break;case "b":oa=L[P++]*A+J,Ca=L[P++]*A+N,Aa=L[P++]*A+J,ra=L[P++]*A+N,ia=L[P++]*A+J,la=L[P++]*A+N,D.bezierCurveTo(Aa,ra,ia,la,oa,Ca)}}A={offsetX:S.ha*A,path:D}}else console.error('THREE.Font: character "'+D+'" does not exists in font family '+L.familyName+"."),A=void 0;v+=A.offsetX;f.push(A.path)}}b=0;for(l=f.length;b<
l;b++)Array.prototype.push.apply(d,f[b].toShapes());return d};return c}();Fi.prototype=Object.assign(Object.create(sb.prototype),{constructor:Fi,load:function(c,f,b,d){var g=this,l=new Wb(this.manager);l.setPath(this.path);l.setRequestHeader(this.requestHeader);l.setWithCredentials(g.withCredentials);l.load(c,function(r){try{var v=JSON.parse(r)}catch(x){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),v=JSON.parse(r.substring(65,r.length-2))}r=
g.parse(v);f&&f(r)},b,d)},parse:function(c){return new Ek(c)}});var Oh,nj={getContext:function(){void 0===Oh&&(Oh=new (window.AudioContext||window.webkitAudioContext));return Oh},setContext:function(c){Oh=c}};ih.prototype=Object.assign(Object.create(sb.prototype),{constructor:ih,load:function(c,f,b,d){var g=this,l=new Wb(g.manager);l.setResponseType("arraybuffer");l.setPath(g.path);l.setRequestHeader(g.requestHeader);l.setWithCredentials(g.withCredentials);l.load(c,function(r){try{var v=r.slice(0);
nj.getContext().decodeAudioData(v,function(x){f(x)})}catch(x){d?d(x):console.error(x),g.manager.itemError(c)}},b,d)}});Gi.prototype=Object.assign(Object.create(ld.prototype),{constructor:Gi,isHemisphereLightProbe:!0,copy:function(c){ld.prototype.copy.call(this,c);return this},toJSON:function(c){return ld.prototype.toJSON.call(this,c)}});Hi.prototype=Object.assign(Object.create(ld.prototype),{constructor:Hi,isAmbientLightProbe:!0,copy:function(c){ld.prototype.copy.call(this,c);return this},toJSON:function(c){return ld.prototype.toJSON.call(this,
c)}});var Fk=new ec,Gk=new ec;Object.assign(Mj.prototype,{update:function(c){var f=this._cache;if(f.focus!==c.focus||f.fov!==c.fov||f.aspect!==c.aspect*this.aspect||f.near!==c.near||f.far!==c.far||f.zoom!==c.zoom||f.eyeSep!==this.eyeSep){f.focus=c.focus;f.fov=c.fov;f.aspect=c.aspect*this.aspect;f.near=c.near;f.far=c.far;f.zoom=c.zoom;f.eyeSep=this.eyeSep;var b=c.projectionMatrix.clone(),d=f.eyeSep/2,g=d*f.near/f.focus,l=f.near*Math.tan(Qb.DEG2RAD*f.fov*.5)/f.zoom;Gk.elements[12]=-d;Fk.elements[12]=
d;d=-l*f.aspect+g;var r=l*f.aspect+g;b.elements[0]=2*f.near/(r-d);b.elements[8]=(r+d)/(r-d);this.cameraL.projectionMatrix.copy(b);d=-l*f.aspect-g;r=l*f.aspect-g;b.elements[0]=2*f.near/(r-d);b.elements[8]=(r+d)/(r-d);this.cameraR.projectionMatrix.copy(b)}this.cameraL.matrixWorld.copy(c.matrixWorld).multiply(Gk);this.cameraR.matrixWorld.copy(c.matrixWorld).multiply(Fk)}});var Hk=function(){function c(b){this.autoStart=void 0!==b?b:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1}var f=
c.prototype;f.start=function(){this.oldTime=this.startTime=Nj();this.elapsedTime=0;this.running=!0};f.stop=function(){this.getElapsedTime();this.autoStart=this.running=!1};f.getElapsedTime=function(){this.getDelta();return this.elapsedTime};f.getDelta=function(){var b=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var d=Nj();b=(d-this.oldTime)/1E3;this.oldTime=d;this.elapsedTime+=b}return b};return c}(),ef=new da,Ik=new Oc,Dl=new da,ff=new da,El=function(c){function f(){var d=
c.call(this)||this;d.type="AudioListener";d.context=nj.getContext();d.gain=d.context.createGain();d.gain.connect(d.context.destination);d.filter=null;d.timeDelta=0;d._clock=new Hk;return d}y(f,c);var b=f.prototype;b.getInput=function(){return this.gain};b.removeFilter=function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null);return this};b.getFilter=function(){return this.filter};
b.setFilter=function(d){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination);this.filter=d;this.gain.connect(this.filter);this.filter.connect(this.context.destination);return this};b.getMasterVolume=function(){return this.gain.gain.value};b.setMasterVolume=function(d){this.gain.gain.setTargetAtTime(d,this.context.currentTime,.01);return this};b.updateMatrixWorld=function(d){c.prototype.updateMatrixWorld.call(this,
d);d=this.context.listener;var g=this.up;this.timeDelta=this._clock.getDelta();this.matrixWorld.decompose(ef,Ik,Dl);ff.set(0,0,-1).applyQuaternion(Ik);if(d.positionX){var l=this.context.currentTime+this.timeDelta;d.positionX.linearRampToValueAtTime(ef.x,l);d.positionY.linearRampToValueAtTime(ef.y,l);d.positionZ.linearRampToValueAtTime(ef.z,l);d.forwardX.linearRampToValueAtTime(ff.x,l);d.forwardY.linearRampToValueAtTime(ff.y,l);d.forwardZ.linearRampToValueAtTime(ff.z,l);d.upX.linearRampToValueAtTime(g.x,
l);d.upY.linearRampToValueAtTime(g.y,l);d.upZ.linearRampToValueAtTime(g.z,l)}else d.setPosition(ef.x,ef.y,ef.z),d.setOrientation(ff.x,ff.y,ff.z,g.x,g.y,g.z)};return f}(T),oj=function(c){function f(d){var g=c.call(this)||this;g.type="Audio";g.listener=d;g.context=d.context;g.gain=g.context.createGain();g.gain.connect(d.getInput());g.autoplay=!1;g.buffer=null;g.detune=0;g.loop=!1;g.loopStart=0;g.loopEnd=0;g.offset=0;g.duration=void 0;g.playbackRate=1;g.isPlaying=!1;g.hasPlaybackControl=!0;g.source=
null;g.sourceType="empty";g._startedAt=0;g._progress=0;g._connected=!1;g.filters=[];return g}y(f,c);var b=f.prototype;b.getOutput=function(){return this.gain};b.setNodeSource=function(d){this.hasPlaybackControl=!1;this.sourceType="audioNode";this.source=d;this.connect();return this};b.setMediaElementSource=function(d){this.hasPlaybackControl=!1;this.sourceType="mediaNode";this.source=this.context.createMediaElementSource(d);this.connect();return this};b.setMediaStreamSource=function(d){this.hasPlaybackControl=
!1;this.sourceType="mediaStreamNode";this.source=this.context.createMediaStreamSource(d);this.connect();return this};b.setBuffer=function(d){this.buffer=d;this.sourceType="buffer";this.autoplay&&this.play();return this};b.play=function(d){void 0===d&&(d=0);if(!0===this.isPlaying)console.warn("THREE.Audio: Audio is already playing.");else if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this._startedAt=this.context.currentTime+d,d=this.context.createBufferSource(),
d.buffer=this.buffer,d.loop=this.loop,d.loopStart=this.loopStart,d.loopEnd=this.loopEnd,d.onended=this.onEnded.bind(this),d.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=d,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()};b.pause=function(){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-
this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress%=this.duration||this.buffer.duration),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this};b.stop=function(){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this};b.connect=function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var d=1,g=this.filters.length;d<
g;d++)this.filters[d-1].connect(this.filters[d]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());this._connected=!0;return this};b.disconnect=function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var d=1,g=this.filters.length;d<g;d++)this.filters[d-1].disconnect(this.filters[d]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());this._connected=!1;return this};
b.getFilters=function(){return this.filters};b.setFilters=function(d){d||=[];!0===this._connected?(this.disconnect(),this.filters=d.slice(),this.connect()):this.filters=d.slice();return this};b.setDetune=function(d){this.detune=d;if(void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this};b.getDetune=function(){return this.detune};b.getFilter=function(){return this.getFilters()[0]};b.setFilter=function(d){return this.setFilters(d?
[d]:[])};b.setPlaybackRate=function(d){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.playbackRate=d,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this};b.getPlaybackRate=function(){return this.playbackRate};b.onEnded=function(){this.isPlaying=!1};b.getLoop=function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),
!1):this.loop};b.setLoop=function(d){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.loop=d,!0===this.isPlaying&&(this.source.loop=this.loop),this};b.setLoopStart=function(d){this.loopStart=d;return this};b.setLoopEnd=function(d){this.loopEnd=d;return this};b.getVolume=function(){return this.gain.gain.value};b.setVolume=function(d){this.gain.gain.setTargetAtTime(d,this.context.currentTime,.01);return this};return f}(T),gf=new da,Jk=
new Oc,Fl=new da,hf=new da,Gl=function(c){function f(d){d=c.call(this,d)||this;d.panner=d.context.createPanner();d.panner.panningModel="HRTF";d.panner.connect(d.gain);return d}y(f,c);var b=f.prototype;b.getOutput=function(){return this.panner};b.getRefDistance=function(){return this.panner.refDistance};b.setRefDistance=function(d){this.panner.refDistance=d;return this};b.getRolloffFactor=function(){return this.panner.rolloffFactor};b.setRolloffFactor=function(d){this.panner.rolloffFactor=d;return this};
b.getDistanceModel=function(){return this.panner.distanceModel};b.setDistanceModel=function(d){this.panner.distanceModel=d;return this};b.getMaxDistance=function(){return this.panner.maxDistance};b.setMaxDistance=function(d){this.panner.maxDistance=d;return this};b.setDirectionalCone=function(d,g,l){this.panner.coneInnerAngle=d;this.panner.coneOuterAngle=g;this.panner.coneOuterGain=l;return this};b.updateMatrixWorld=function(d){c.prototype.updateMatrixWorld.call(this,d);if(!0!==this.hasPlaybackControl||
!1!==this.isPlaying)if(this.matrixWorld.decompose(gf,Jk,Fl),hf.set(0,0,1).applyQuaternion(Jk),d=this.panner,d.positionX){var g=this.context.currentTime+this.listener.timeDelta;d.positionX.linearRampToValueAtTime(gf.x,g);d.positionY.linearRampToValueAtTime(gf.y,g);d.positionZ.linearRampToValueAtTime(gf.z,g);d.orientationX.linearRampToValueAtTime(hf.x,g);d.orientationY.linearRampToValueAtTime(hf.y,g);d.orientationZ.linearRampToValueAtTime(hf.z,g)}else d.setPosition(gf.x,gf.y,gf.z),d.setOrientation(hf.x,
hf.y,hf.z)};return f}(oj),Kk=function(){function c(b,d){void 0===d&&(d=2048);this.analyser=b.context.createAnalyser();this.analyser.fftSize=d;this.data=new Uint8Array(this.analyser.frequencyBinCount);b.getOutput().connect(this.analyser)}var f=c.prototype;f.getFrequencyData=function(){this.analyser.getByteFrequencyData(this.data);return this.data};f.getAverageFrequency=function(){for(var b=0,d=this.getFrequencyData(),g=0;g<d.length;g++)b+=d[g];return b/d.length};return c}();Object.assign(Ii.prototype,
{accumulate:function(c,f){var b=this.buffer,d=this.valueSize;c=c*d+d;var g=this.cumulativeWeight;if(0===g){for(g=0;g!==d;++g)b[c+g]=b[g];g=f}else g+=f,this._mixBufferRegion(b,c,0,f/g,d);this.cumulativeWeight=g},accumulateAdditive:function(c){var f=this.buffer,b=this.valueSize,d=b*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity();this._mixBufferRegionAdditive(f,d,0,c,b);this.cumulativeWeightAdditive+=c},apply:function(c){var f=this.valueSize,b=this.buffer;c=c*f+f;var d=this.cumulativeWeight,
g=this.cumulativeWeightAdditive,l=this.binding;this.cumulativeWeightAdditive=this.cumulativeWeight=0;1>d&&this._mixBufferRegion(b,c,f*this._origIndex,1-d,f);0<g&&this._mixBufferRegionAdditive(b,c,this._addIndex*f,1,f);d=f;for(g=f+f;d!==g;++d)if(b[d]!==b[d+f]){l.setValue(b,c);break}},saveOriginalState:function(){var c=this.buffer,f=this.valueSize,b=f*this._origIndex;this.binding.getValue(c,b);for(var d=f;d!==b;++d)c[d]=c[b+d%f];this._setIdentity();this.cumulativeWeightAdditive=this.cumulativeWeight=
0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_setAdditiveIdentityNumeric:function(){for(var c=this._addIndex*this.valueSize,f=c+this.valueSize;c<f;c++)this.buffer[c]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric();this.buffer[this._addIndex*this.valueSize+3]=1},_setAdditiveIdentityOther:function(){for(var c=this._origIndex*this.valueSize,f=this._addIndex*this.valueSize,b=0;b<this.valueSize;b++)this.buffer[f+b]=this.buffer[c+
b]},_select:function(c,f,b,d,g){if(.5<=d)for(d=0;d!==g;++d)c[f+d]=c[b+d]},_slerp:function(c,f,b,d){Oc.slerpFlat(c,f,c,f,c,b,d)},_slerpAdditive:function(c,f,b,d,g){g*=this._workIndex;Oc.multiplyQuaternionsFlat(c,g,c,f,c,b);Oc.slerpFlat(c,f,c,f,c,g,d)},_lerp:function(c,f,b,d,g){for(var l=1-d,r=0;r!==g;++r){var v=f+r;c[v]=c[v]*l+c[b+r]*d}},_lerpAdditive:function(c,f,b,d,g){for(var l=0;l!==g;++l){var r=f+l;c[r]+=c[b+l]*d}}});var Hl=RegExp("[\\[\\]\\.:\\/]","g"),Il=/((?:WC+[\/:])*)/.source.replace("WC",
"[^\\[\\]\\.:\\/]"),Jl=/(WCOD+)?/.source.replace("WCOD","[^\\[\\]:\\/]"),Kl=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Ll=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Ml=new RegExp("^"+Il+Jl+Kl+Ll+"$"),Nl=["material","materials","bones"];Object.assign(Oj.prototype,{getValue:function(c,f){this.bind();var b=this._bindings[this._targetGroup.nCachedObjects_];void 0!==b&&b.getValue(c,f)},setValue:function(c,f){for(var b=this._bindings,d=this._targetGroup.nCachedObjects_,
g=b.length;d!==g;++d)b[d].setValue(c,f)},bind:function(){for(var c=this._bindings,f=this._targetGroup.nCachedObjects_,b=c.length;f!==b;++f)c[f].bind()},unbind:function(){for(var c=this._bindings,f=this._targetGroup.nCachedObjects_,b=c.length;f!==b;++f)c[f].unbind()}});Object.assign(Rc,{Composite:Oj,create:function(c,f,b){return c&&c.isAnimationObjectGroup?new Rc.Composite(c,f,b):new Rc(c,f,b)},sanitizeNodeName:function(c){return c.replace(/\s/g,"_").replace(Hl,"")},parseTrackName:function(c){var f=
Ml.exec(c);if(!f)throw Error("PropertyBinding: Cannot parse trackName: "+c);f={nodeName:f[2],objectName:f[3],objectIndex:f[4],propertyName:f[5],propertyIndex:f[6]};var b=f.nodeName&&f.nodeName.lastIndexOf(".");if(void 0!==b&&-1!==b){var d=f.nodeName.substring(b+1);-1!==Nl.indexOf(d)&&(f.nodeName=f.nodeName.substring(0,b),f.objectName=d)}if(null===f.propertyName||0===f.propertyName.length)throw Error("PropertyBinding: can not parse propertyName from trackName: "+c);return f},findNode:function(c,f){if(!f||
""===f||"."===f||-1===f||f===c.name||f===c.uuid)return c;if(c.skeleton){var b=c.skeleton.getBoneByName(f);if(void 0!==b)return b}return c.children&&(c=function l(g){for(var r=0;r<g.length;r++){var v=g[r];if(v.name===f||v.uuid===f||(v=l(v.children)))return v}return null}(c.children))?c:null}});Object.assign(Rc.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},
GetterByBindingType:[function(c,f){c[f]=this.node[this.propertyName]},function(c,f){for(var b=this.resolvedProperty,d=0,g=b.length;d!==g;++d)c[f++]=b[d]},function(c,f){c[f]=this.resolvedProperty[this.propertyIndex]},function(c,f){this.resolvedProperty.toArray(c,f)}],SetterByBindingTypeAndVersioning:[[function(c,f){this.targetObject[this.propertyName]=c[f]},function(c,f){this.targetObject[this.propertyName]=c[f];this.targetObject.needsUpdate=!0},function(c,f){this.targetObject[this.propertyName]=c[f];
this.targetObject.matrixWorldNeedsUpdate=!0}],[function(c,f){for(var b=this.resolvedProperty,d=0,g=b.length;d!==g;++d)b[d]=c[f++]},function(c,f){for(var b=this.resolvedProperty,d=0,g=b.length;d!==g;++d)b[d]=c[f++];this.targetObject.needsUpdate=!0},function(c,f){for(var b=this.resolvedProperty,d=0,g=b.length;d!==g;++d)b[d]=c[f++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(c,f){this.resolvedProperty[this.propertyIndex]=c[f]},function(c,f){this.resolvedProperty[this.propertyIndex]=c[f];
this.targetObject.needsUpdate=!0},function(c,f){this.resolvedProperty[this.propertyIndex]=c[f];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(c,f){this.resolvedProperty.fromArray(c,f)},function(c,f){this.resolvedProperty.fromArray(c,f);this.targetObject.needsUpdate=!0},function(c,f){this.resolvedProperty.fromArray(c,f);this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(c,f){this.bind();this.getValue(c,f)},setValue:function(c,f){this.bind();this.setValue(c,f)},bind:function(){var c=
this.node,f=this.parsedPath,b=f.objectName,d=f.propertyName,g=f.propertyIndex;c||(this.node=c=Rc.findNode(this.rootNode,f.nodeName)||this.rootNode);this.getValue=this._getValue_unavailable;this.setValue=this._setValue_unavailable;if(c){if(b){var l=f.objectIndex;switch(b){case "materials":if(!c.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!c.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",
this);return}c=c.material.materials;break;case "bones":if(!c.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}c=c.skeleton.bones;for(b=0;b<c.length;b++)if(c[b].name===l){l=b;break}break;default:if(void 0===c[b]){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}c=c[b]}if(void 0!==l){if(void 0===c[l]){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",
this,c);return}c=c[l]}}l=c[d];if(void 0===l)console.error("THREE.PropertyBinding: Trying to update property for track: "+f.nodeName+"."+d+" but it wasn't found.",c);else{f=this.Versioning.None;this.targetObject=c;void 0!==c.needsUpdate?f=this.Versioning.NeedsUpdate:void 0!==c.matrixWorldNeedsUpdate&&(f=this.Versioning.MatrixWorldNeedsUpdate);b=this.BindingType.Direct;if(void 0!==g){if("morphTargetInfluences"===d){if(!c.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",
this);return}if(c.geometry.isBufferGeometry){if(!c.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}void 0!==c.morphTargetDictionary[g]&&(g=c.morphTargetDictionary[g])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}b=this.BindingType.ArrayElement;this.resolvedProperty=l;this.propertyIndex=
g}else void 0!==l.fromArray&&void 0!==l.toArray?(b=this.BindingType.HasFromToArray,this.resolvedProperty=l):Array.isArray(l)?(b=this.BindingType.EntireArray,this.resolvedProperty=l):this.propertyName=d;this.getValue=this.GetterByBindingType[b];this.setValue=this.SetterByBindingTypeAndVersioning[b][f]}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null;this.getValue=this._getValue_unbound;this.setValue=
this._setValue_unbound}});Object.assign(Rc.prototype,{_getValue_unbound:Rc.prototype.getValue,_setValue_unbound:Rc.prototype.setValue});Object.assign(Pj.prototype,{isAnimationObjectGroup:!0,add:function(){for(var c=this._objects,f=this._indicesByUUID,b=this._paths,d=this._parsedPaths,g=this._bindings,l=g.length,r=void 0,v=c.length,x=this.nCachedObjects_,w=0,A=arguments.length;w!==A;++w){var D=arguments[w],J=D.uuid,N=f[J];if(void 0===N){N=v++;f[J]=N;c.push(D);N=0;for(var L=l;N!==L;++N)g[N].push(new Rc(D,
b[N],d[N]))}else if(N<x){r=c[N];L=--x;var S=c[L];f[S.uuid]=N;c[N]=S;f[J]=L;c[L]=D;J=0;for(S=l;J!==S;++J){var P=g[J],ka=P[N];P[N]=P[L];void 0===ka&&(ka=new Rc(D,b[J],d[J]));P[L]=ka}}else c[N]!==r&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=x},remove:function(){for(var c=this._objects,f=this._indicesByUUID,b=this._bindings,d=b.length,g=this.nCachedObjects_,l=
0,r=arguments.length;l!==r;++l){var v=arguments[l],x=v.uuid,w=f[x];if(void 0!==w&&w>=g){var A=g++,D=c[A];f[D.uuid]=w;c[w]=D;f[x]=A;c[A]=v;v=0;for(x=d;v!==x;++v){D=b[v];var J=D[w];D[w]=D[A];D[A]=J}}}this.nCachedObjects_=g},uncache:function(){for(var c=this._objects,f=this._indicesByUUID,b=this._bindings,d=b.length,g=this.nCachedObjects_,l=c.length,r=0,v=arguments.length;r!==v;++r){var x=arguments[r].uuid,w=f[x];if(void 0!==w)if(delete f[x],w<g){x=--g;var A=c[x],D=--l,J=c[D];f[A.uuid]=w;c[w]=A;f[J.uuid]=
x;c[x]=J;c.pop();A=0;for(J=d;A!==J;++A){var N=b[A],L=N[D];N[w]=N[x];N[x]=L;N.pop()}}else for(x=--l,D=c[x],0<x&&(f[D.uuid]=w),c[w]=D,c.pop(),D=0,A=d;D!==A;++D)J=b[D],J[w]=J[x],J.pop()}this.nCachedObjects_=g},subscribe_:function(c,f){var b=this._bindingsIndicesByPath,d=b[c],g=this._bindings;if(void 0!==d)return g[d];var l=this._paths,r=this._parsedPaths,v=this._objects,x=this.nCachedObjects_,w=Array(v.length);d=g.length;b[c]=d;l.push(c);r.push(f);g.push(w);b=x;for(d=v.length;b!==d;++b)w[b]=new Rc(v[b],
c,f);return w},unsubscribe_:function(c){var f=this._bindingsIndicesByPath,b=f[c];if(void 0!==b){var d=this._paths,g=this._parsedPaths,l=this._bindings,r=l.length-1,v=l[r];f[c[r]]=b;l[b]=v;l.pop();g[b]=g[r];g.pop();d[b]=d[r];d.pop()}}});var Ol=function(){function c(b,d,g,l){void 0===g&&(g=null);void 0===l&&(l=d.blendMode);this._mixer=b;this._clip=d;this._localRoot=g;this.blendMode=l;b=d.tracks;d=b.length;g=Array(d);l={endingStart:2400,endingEnd:2400};for(var r=0;r!==d;++r){var v=b[r].createInterpolant(null);
g[r]=v;v.settings=l}this._interpolantSettings=l;this._interpolants=g;this._propertyBindings=Array(d);this._weightInterpolant=this._timeScaleInterpolant=this._byClipCacheIndex=this._cacheIndex=null;this.loop=2201;this._loopCount=-1;this._startTime=null;this.time=0;this._effectiveWeight=this.weight=this._effectiveTimeScale=this.timeScale=1;this.repetitions=Infinity;this.paused=!1;this.enabled=!0;this.clampWhenFinished=!1;this.zeroSlopeAtEnd=this.zeroSlopeAtStart=!0}var f=c.prototype;f.play=function(){this._mixer._activateAction(this);
return this};f.stop=function(){this._mixer._deactivateAction(this);return this.reset()};f.reset=function(){this.paused=!1;this.enabled=!0;this.time=0;this._loopCount=-1;this._startTime=null;return this.stopFading().stopWarping()};f.isRunning=function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)};f.isScheduled=function(){return this._mixer._isActiveAction(this)};f.startAt=function(b){this._startTime=b;return this};f.setLoop=function(b,
d){this.loop=b;this.repetitions=d;return this};f.setEffectiveWeight=function(b){this.weight=b;this._effectiveWeight=this.enabled?b:0;return this.stopFading()};f.getEffectiveWeight=function(){return this._effectiveWeight};f.fadeIn=function(b){return this._scheduleFading(b,0,1)};f.fadeOut=function(b){return this._scheduleFading(b,1,0)};f.crossFadeFrom=function(b,d,g){b.fadeOut(d);this.fadeIn(d);if(g){g=this._clip.duration;var l=b._clip.duration,r=g/l;b.warp(1,l/g,d);this.warp(r,1,d)}return this};f.crossFadeTo=
function(b,d,g){return b.crossFadeFrom(this,d,g)};f.stopFading=function(){var b=this._weightInterpolant;null!==b&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(b));return this};f.setEffectiveTimeScale=function(b){this.timeScale=b;this._effectiveTimeScale=this.paused?0:b;return this.stopWarping()};f.getEffectiveTimeScale=function(){return this._effectiveTimeScale};f.setDuration=function(b){this.timeScale=this._clip.duration/b;return this.stopWarping()};f.syncWith=function(b){this.time=
b.time;this.timeScale=b.timeScale;return this.stopWarping()};f.halt=function(b){return this.warp(this._effectiveTimeScale,0,b)};f.warp=function(b,d,g){var l=this._mixer,r=l.time,v=this.timeScale,x=this._timeScaleInterpolant;null===x&&(this._timeScaleInterpolant=x=l._lendControlInterpolant());l=x.parameterPositions;x=x.sampleValues;l[0]=r;l[1]=r+g;x[0]=b/v;x[1]=d/v;return this};f.stopWarping=function(){var b=this._timeScaleInterpolant;null!==b&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(b));
return this};f.getMixer=function(){return this._mixer};f.getClip=function(){return this._clip};f.getRoot=function(){return this._localRoot||this._mixer._root};f._update=function(b,d,g,l){if(this.enabled){var r=this._startTime;if(null!==r){d=(b-r)*g;if(0>d||0===g)return;this._startTime=null;d*=g}d*=this._updateTimeScale(b);g=this._updateTime(d);b=this._updateWeight(b);if(0<b)switch(d=this._interpolants,r=this._propertyBindings,this.blendMode){case 2501:l=0;for(var v=d.length;l!==v;++l)d[l].evaluate(g),
r[l].accumulateAdditive(b);break;default:v=0;for(var x=d.length;v!==x;++v)d[v].evaluate(g),r[v].accumulate(l,b)}}else this._updateWeight(b)};f._updateWeight=function(b){var d=0;if(this.enabled){d=this.weight;var g=this._weightInterpolant;if(null!==g){var l=g.evaluate(b)[0];d*=l;b>g.parameterPositions[1]&&(this.stopFading(),0===l&&(this.enabled=!1))}}return this._effectiveWeight=d};f._updateTimeScale=function(b){var d=0;if(!this.paused){d=this.timeScale;var g=this._timeScaleInterpolant;if(null!==g){var l=
g.evaluate(b)[0];d*=l;b>g.parameterPositions[1]&&(this.stopWarping(),0===d?this.paused=!0:this.timeScale=d)}}return this._effectiveTimeScale=d};f._updateTime=function(b){var d=this._clip.duration,g=this.loop,l=this.time+b,r=this._loopCount,v=2202===g;if(0===b)return-1===r?l:v&&1===(r&1)?d-l:l;if(2200===g)a:{if(-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1)),l>=d)l=d;else if(0>l)l=0;else{this.time=l;break a}this.clampWhenFinished?this.paused=!0:this.enabled=!1;this.time=l;this._mixer.dispatchEvent({type:"finished",
action:this,direction:0>b?-1:1})}else{-1===r&&(0<=b?(r=0,this._setEndings(!0,0===this.repetitions,v)):this._setEndings(0===this.repetitions,!0,v));if(l>=d||0>l){g=Math.floor(l/d);l-=d*g;r+=Math.abs(g);var x=this.repetitions-r;0>=x?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=l=0<b?d:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<b?1:-1})):(1===x?(b=0>b,this._setEndings(b,!b,v)):this._setEndings(!1,!1,v),this._loopCount=r,this.time=l,this._mixer.dispatchEvent({type:"loop",
action:this,loopDelta:g}))}else this.time=l;if(v&&1===(r&1))return d-l}return l};f._setEndings=function(b,d,g){var l=this._interpolantSettings;g?(l.endingStart=2401,l.endingEnd=2401):(l.endingStart=b?this.zeroSlopeAtStart?2401:2400:2402,l.endingEnd=d?this.zeroSlopeAtEnd?2401:2400:2402)};f._scheduleFading=function(b,d,g){var l=this._mixer,r=l.time,v=this._weightInterpolant;null===v&&(this._weightInterpolant=v=l._lendControlInterpolant());l=v.parameterPositions;v=v.sampleValues;l[0]=r;v[0]=d;l[1]=r+
b;v[1]=g;return this};return c}();Ji.prototype=Object.assign(Object.create(O.prototype),{constructor:Ji,_bindAction:function(c,f){var b=c._localRoot||this._root,d=c._clip.tracks,g=d.length,l=c._propertyBindings;c=c._interpolants;var r=b.uuid,v=this._bindingsByRootAndName,x=v[r];void 0===x&&(x={},v[r]=x);for(v=0;v!==g;++v){var w=d[v],A=w.name,D=x[A];if(void 0===D){D=l[v];if(void 0!==D){null===D._cacheIndex&&(++D.referenceCount,this._addInactiveBinding(D,r,A));continue}D=new Ii(Rc.create(b,A,f&&f._propertyBindings[v].binding.parsedPath),
w.ValueTypeName,w.getValueSize());++D.referenceCount;this._addInactiveBinding(D,r,A)}l[v]=D;c[v].resultBuffer=D.buffer}},_activateAction:function(c){if(!this._isActiveAction(c)){if(null===c._cacheIndex){var f=(c._localRoot||this._root).uuid,b=c._clip.uuid,d=this._actionsByClip[b];this._bindAction(c,d&&d.knownActions[0]);this._addInactiveAction(c,b,f)}f=c._propertyBindings;b=0;for(d=f.length;b!==d;++b){var g=f[b];0===g.useCount++&&(this._lendBinding(g),g.saveOriginalState())}this._lendAction(c)}},
_deactivateAction:function(c){if(this._isActiveAction(c)){for(var f=c._propertyBindings,b=0,d=f.length;b!==d;++b){var g=f[b];0===--g.useCount&&(g.restoreOriginalState(),this._takeBackBinding(g))}this._takeBackAction(c)}},_initMemoryManager:function(){this._actions=[];this._nActiveActions=0;this._actionsByClip={};this._bindings=[];this._nActiveBindings=0;this._bindingsByRootAndName={};this._controlInterpolants=[];this._nActiveControlInterpolants=0;var c=this;this.stats={actions:{get total(){return c._actions.length},
get inUse(){return c._nActiveActions}},bindings:{get total(){return c._bindings.length},get inUse(){return c._nActiveBindings}},controlInterpolants:{get total(){return c._controlInterpolants.length},get inUse(){return c._nActiveControlInterpolants}}}},_isActiveAction:function(c){c=c._cacheIndex;return null!==c&&c<this._nActiveActions},_addInactiveAction:function(c,f,b){var d=this._actions,g=this._actionsByClip,l=g[f];void 0===l?(l={knownActions:[c],actionByRoot:{}},c._byClipCacheIndex=0,g[f]=l):(f=
l.knownActions,c._byClipCacheIndex=f.length,f.push(c));c._cacheIndex=d.length;d.push(c);l.actionByRoot[b]=c},_removeInactiveAction:function(c){var f=this._actions,b=f[f.length-1],d=c._cacheIndex;b._cacheIndex=d;f[d]=b;f.pop();c._cacheIndex=null;f=c._clip.uuid;b=this._actionsByClip;d=b[f];var g=d.knownActions,l=g[g.length-1],r=c._byClipCacheIndex;l._byClipCacheIndex=r;g[r]=l;g.pop();c._byClipCacheIndex=null;delete d.actionByRoot[(c._localRoot||this._root).uuid];0===g.length&&delete b[f];this._removeInactiveBindingsForAction(c)},
_removeInactiveBindingsForAction:function(c){c=c._propertyBindings;for(var f=0,b=c.length;f!==b;++f){var d=c[f];0===--d.referenceCount&&this._removeInactiveBinding(d)}},_lendAction:function(c){var f=this._actions,b=c._cacheIndex,d=this._nActiveActions++,g=f[d];c._cacheIndex=d;f[d]=c;g._cacheIndex=b;f[b]=g},_takeBackAction:function(c){var f=this._actions,b=c._cacheIndex,d=--this._nActiveActions,g=f[d];c._cacheIndex=d;f[d]=c;g._cacheIndex=b;f[b]=g},_addInactiveBinding:function(c,f,b){var d=this._bindingsByRootAndName,
g=this._bindings,l=d[f];void 0===l&&(l={},d[f]=l);l[b]=c;c._cacheIndex=g.length;g.push(c)},_removeInactiveBinding:function(c){var f=this._bindings,b=c.binding,d=b.rootNode.uuid;b=b.path;var g=this._bindingsByRootAndName,l=g[d],r=f[f.length-1];c=c._cacheIndex;r._cacheIndex=c;f[c]=r;f.pop();delete l[b];0===Object.keys(l).length&&delete g[d]},_lendBinding:function(c){var f=this._bindings,b=c._cacheIndex,d=this._nActiveBindings++,g=f[d];c._cacheIndex=d;f[d]=c;g._cacheIndex=b;f[b]=g},_takeBackBinding:function(c){var f=
this._bindings,b=c._cacheIndex,d=--this._nActiveBindings,g=f[d];c._cacheIndex=d;f[d]=c;g._cacheIndex=b;f[b]=g},_lendControlInterpolant:function(){var c=this._controlInterpolants,f=this._nActiveControlInterpolants++,b=c[f];void 0===b&&(b=new q(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),b.__cacheIndex=f,c[f]=b);return b},_takeBackControlInterpolant:function(c){var f=this._controlInterpolants,b=c.__cacheIndex,d=--this._nActiveControlInterpolants,g=f[d];c.__cacheIndex=
d;f[d]=c;g.__cacheIndex=b;f[b]=g},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(c,f,b){var d=f||this._root,g=d.uuid;d="string"===typeof c?Wa.findByName(d,c):c;c=null!==d?d.uuid:c;var l=this._actionsByClip[c],r=null;void 0===b&&(b=null!==d?d.blendMode:2500);if(void 0!==l){r=l.actionByRoot[g];if(void 0!==r&&r.blendMode===b)return r;r=l.knownActions[0];null===d&&(d=r._clip)}if(null===d)return null;f=new Ol(this,d,f,b);this._bindAction(f,r);this._addInactiveAction(f,c,g);return f},
existingAction:function(c,f){var b=f||this._root;f=b.uuid;b="string"===typeof c?Wa.findByName(b,c):c;c=this._actionsByClip[b?b.uuid:c];return void 0!==c?c.actionByRoot[f]||null:null},stopAllAction:function(){for(var c=this._actions,f=this._nActiveActions-1;0<=f;--f)c[f].stop();return this},update:function(c){c*=this.timeScale;for(var f=this._actions,b=this._nActiveActions,d=this.time+=c,g=Math.sign(c),l=this._accuIndex^=1,r=0;r!==b;++r)f[r]._update(d,c,g,l);c=this._bindings;f=this._nActiveBindings;
for(b=0;b!==f;++b)c[b].apply(l);return this},setTime:function(c){for(var f=this.time=0;f<this._actions.length;f++)this._actions[f].time=0;return this.update(c)},getRoot:function(){return this._root},uncacheClip:function(c){var f=this._actions;c=c.uuid;var b=this._actionsByClip,d=b[c];if(void 0!==d){d=d.knownActions;for(var g=0,l=d.length;g!==l;++g){var r=d[g];this._deactivateAction(r);var v=r._cacheIndex,x=f[f.length-1];r._cacheIndex=null;r._byClipCacheIndex=null;x._cacheIndex=v;f[v]=x;f.pop();this._removeInactiveBindingsForAction(r)}delete b[c]}},
uncacheRoot:function(c){c=c.uuid;var f=this._actionsByClip;for(d in f){var b=f[d].actionByRoot[c];void 0!==b&&(this._deactivateAction(b),this._removeInactiveAction(b))}var d=this._bindingsByRootAndName[c];if(void 0!==d)for(var g in d)c=d[g],c.restoreOriginalState(),this._removeInactiveBinding(c)},uncacheAction:function(c,f){c=this.existingAction(c,f);null!==c&&(this._deactivateAction(c),this._removeInactiveAction(c))}});var Lk=function(){function c(f,b){"string"===typeof f&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),
f=b);this.value=f}c.prototype.clone=function(){return new c(void 0===this.value.clone?this.value:this.value.clone())};return c}();Ki.prototype=Object.assign(Object.create(Tc.prototype),{constructor:Ki,isInstancedInterleavedBuffer:!0,copy:function(c){Tc.prototype.copy.call(this,c);this.meshPerAttribute=c.meshPerAttribute;return this},clone:function(c){c=Tc.prototype.clone.call(this,c);c.meshPerAttribute=this.meshPerAttribute;return c},toJSON:function(c){c=Tc.prototype.toJSON.call(this,c);c.isInstancedInterleavedBuffer=
!0;c.meshPerAttribute=this.meshPerAttribute;return c}});Object.defineProperty(Li.prototype,"needsUpdate",{set:function(c){!0===c&&this.version++}});Object.assign(Li.prototype,{isGLBufferAttribute:!0,setBuffer:function(c){this.buffer=c;return this},setType:function(c,f){this.type=c;this.elementSize=f;return this},setItemSize:function(c){this.itemSize=c;return this},setCount:function(c){this.count=c;return this}});Object.assign(Mi.prototype,{set:function(c,f){this.ray.set(c,f)},setFromCamera:function(c,
f){f&&f.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(f.matrixWorld),this.ray.direction.set(c.x,c.y,.5).unproject(f).sub(this.ray.origin).normalize(),this.camera=f):f&&f.isOrthographicCamera?(this.ray.origin.set(c.x,c.y,(f.near+f.far)/(f.near-f.far)).unproject(f),this.ray.direction.set(0,0,-1).transformDirection(f.matrixWorld),this.camera=f):console.error("THREE.Raycaster: Unsupported camera type: "+f.type)},intersectObject:function(c,f,b){b=b||[];Ni(c,this,b,f);b.sort(Qj);return b},
intersectObjects:function(c,f,b){b=b||[];if(!1===Array.isArray(c))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),b;for(var d=0,g=c.length;d<g;d++)Ni(c[d],this,b,f);b.sort(Qj);return b}});var Pl=function(){function c(b,d,g){void 0===b&&(b=1);void 0===d&&(d=0);void 0===g&&(g=0);this.radius=b;this.phi=d;this.theta=g;return this}var f=c.prototype;f.set=function(b,d,g){this.radius=b;this.phi=d;this.theta=g;return this};f.clone=function(){return(new this.constructor).copy(this)};
f.copy=function(b){this.radius=b.radius;this.phi=b.phi;this.theta=b.theta;return this};f.makeSafe=function(){this.phi=Math.max(1E-6,Math.min(Math.PI-1E-6,this.phi));return this};f.setFromVector3=function(b){return this.setFromCartesianCoords(b.x,b.y,b.z)};f.setFromCartesianCoords=function(b,d,g){this.radius=Math.sqrt(b*b+d*d+g*g);0===this.radius?this.phi=this.theta=0:(this.theta=Math.atan2(b,g),this.phi=Math.acos(Qb.clamp(d/this.radius,-1,1)));return this};return c}(),Ql=function(){function c(b,d,
g){this.radius=void 0!==b?b:1;this.theta=void 0!==d?d:0;this.y=void 0!==g?g:0;return this}var f=c.prototype;f.set=function(b,d,g){this.radius=b;this.theta=d;this.y=g;return this};f.clone=function(){return(new this.constructor).copy(this)};f.copy=function(b){this.radius=b.radius;this.theta=b.theta;this.y=b.y;return this};f.setFromVector3=function(b){return this.setFromCartesianCoords(b.x,b.y,b.z)};f.setFromCartesianCoords=function(b,d,g){this.radius=Math.sqrt(b*b+g*g);this.theta=Math.atan2(b,g);this.y=
d;return this};return c}(),Mk=new ib,Nk=function(){function c(b,d){Object.defineProperty(this,"isBox2",{value:!0});this.min=void 0!==b?b:new ib(Infinity,Infinity);this.max=void 0!==d?d:new ib(-Infinity,-Infinity)}var f=c.prototype;f.set=function(b,d){this.min.copy(b);this.max.copy(d);return this};f.setFromPoints=function(b){this.makeEmpty();for(var d=0,g=b.length;d<g;d++)this.expandByPoint(b[d]);return this};f.setFromCenterAndSize=function(b,d){d=Mk.copy(d).multiplyScalar(.5);this.min.copy(b).sub(d);
this.max.copy(b).add(d);return this};f.clone=function(){return(new this.constructor).copy(this)};f.copy=function(b){this.min.copy(b.min);this.max.copy(b.max);return this};f.makeEmpty=function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this};f.isEmpty=function(){return this.max.x<this.min.x||this.max.y<this.min.y};f.getCenter=function(b){void 0===b&&(console.warn("THREE.Box2: .getCenter() target is now required"),b=new ib);return this.isEmpty()?b.set(0,0):b.addVectors(this.min,
this.max).multiplyScalar(.5)};f.getSize=function(b){void 0===b&&(console.warn("THREE.Box2: .getSize() target is now required"),b=new ib);return this.isEmpty()?b.set(0,0):b.subVectors(this.max,this.min)};f.expandByPoint=function(b){this.min.min(b);this.max.max(b);return this};f.expandByVector=function(b){this.min.sub(b);this.max.add(b);return this};f.expandByScalar=function(b){this.min.addScalar(-b);this.max.addScalar(b);return this};f.containsPoint=function(b){return b.x<this.min.x||b.x>this.max.x||
b.y<this.min.y||b.y>this.max.y?!1:!0};f.containsBox=function(b){return this.min.x<=b.min.x&&b.max.x<=this.max.x&&this.min.y<=b.min.y&&b.max.y<=this.max.y};f.getParameter=function(b,d){void 0===d&&(console.warn("THREE.Box2: .getParameter() target is now required"),d=new ib);return d.set((b.x-this.min.x)/(this.max.x-this.min.x),(b.y-this.min.y)/(this.max.y-this.min.y))};f.intersectsBox=function(b){return b.max.x<this.min.x||b.min.x>this.max.x||b.max.y<this.min.y||b.min.y>this.max.y?!1:!0};f.clampPoint=
function(b,d){void 0===d&&(console.warn("THREE.Box2: .clampPoint() target is now required"),d=new ib);return d.copy(b).clamp(this.min,this.max)};f.distanceToPoint=function(b){return Mk.copy(b).clamp(this.min,this.max).sub(b).length()};f.intersect=function(b){this.min.max(b.min);this.max.min(b.max);return this};f.union=function(b){this.min.min(b.min);this.max.max(b.max);return this};f.translate=function(b){this.min.add(b);this.max.add(b);return this};f.equals=function(b){return b.min.equals(this.min)&&
b.max.equals(this.max)};return c}(),Ok=new da,Ph=new da,Pk=function(){function c(b,d){this.start=void 0!==b?b:new da;this.end=void 0!==d?d:new da}var f=c.prototype;f.set=function(b,d){this.start.copy(b);this.end.copy(d);return this};f.clone=function(){return(new this.constructor).copy(this)};f.copy=function(b){this.start.copy(b.start);this.end.copy(b.end);return this};f.getCenter=function(b){void 0===b&&(console.warn("THREE.Line3: .getCenter() target is now required"),b=new da);return b.addVectors(this.start,
this.end).multiplyScalar(.5)};f.delta=function(b){void 0===b&&(console.warn("THREE.Line3: .delta() target is now required"),b=new da);return b.subVectors(this.end,this.start)};f.distanceSq=function(){return this.start.distanceToSquared(this.end)};f.distance=function(){return this.start.distanceTo(this.end)};f.at=function(b,d){void 0===d&&(console.warn("THREE.Line3: .at() target is now required"),d=new da);return this.delta(d).multiplyScalar(b).add(this.start)};f.closestPointToPointParameter=function(b,
d){Ok.subVectors(b,this.start);Ph.subVectors(this.end,this.start);b=Ph.dot(Ph);b=Ph.dot(Ok)/b;d&&(b=Qb.clamp(b,0,1));return b};f.closestPointToPoint=function(b,d,g){b=this.closestPointToPointParameter(b,d);void 0===g&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),g=new da);return this.delta(g).multiplyScalar(b).add(this.start)};f.applyMatrix4=function(b){this.start.applyMatrix4(b);this.end.applyMatrix4(b);return this};f.equals=function(b){return b.start.equals(this.start)&&
b.end.equals(this.end)};return c}();gg.prototype=Object.create(T.prototype);gg.prototype.constructor=gg;gg.prototype.isImmediateRenderObject=!0;var Qk=new da,Rl=function(c){function f(d,g){var l=c.call(this)||this;l.light=d;l.light.updateMatrixWorld();l.matrix=d.matrixWorld;l.matrixAutoUpdate=!1;l.color=g;d=new Na;g=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(var r=0,v=1;32>r;r++,v++){var x=r/32*Math.PI*2,w=v/32*Math.PI*2;g.push(Math.cos(x),Math.sin(x),1,Math.cos(w),Math.sin(w),
1)}d.setAttribute("position",new Ya(g,3));g=new sc({fog:!1,toneMapped:!1});l.cone=new Mc(d,g);l.add(l.cone);l.update();return l}y(f,c);var b=f.prototype;b.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};b.update=function(){this.light.updateMatrixWorld();var d=this.light.distance?this.light.distance:1E3,g=d*Math.tan(this.light.angle);this.cone.scale.set(g,g,d);Qk.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(Qk);void 0!==this.color?this.cone.material.color.set(this.color):
this.cone.material.color.copy(this.light.color)};return f}(T),Fe=new da,Qh=new ec,pj=new ec,Rk=function(c){function f(b){var d=Rj(b);var g=new Na;for(var l=[],r=[],v=new Cb(0,0,1),x=new Cb(0,1,0),w=0;w<d.length;w++){var A=d[w];A.parent&&A.parent.isBone&&(l.push(0,0,0),l.push(0,0,0),r.push(v.r,v.g,v.b),r.push(x.r,x.g,x.b))}g.setAttribute("position",new Ya(l,3));g.setAttribute("color",new Ya(r,3));l=new sc({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});g=c.call(this,g,l)||
this;g.type="SkeletonHelper";g.isSkeletonHelper=!0;g.root=b;g.bones=d;g.matrix=b.matrixWorld;g.matrixAutoUpdate=!1;return g}y(f,c);f.prototype.updateMatrixWorld=function(b){var d=this.bones,g=this.geometry,l=g.getAttribute("position");pj.copy(this.root.matrixWorld).invert();for(var r=0,v=0;r<d.length;r++){var x=d[r];x.parent&&x.parent.isBone&&(Qh.multiplyMatrices(pj,x.matrixWorld),Fe.setFromMatrixPosition(Qh),l.setXYZ(v,Fe.x,Fe.y,Fe.z),Qh.multiplyMatrices(pj,x.parent.matrixWorld),Fe.setFromMatrixPosition(Qh),
l.setXYZ(v+1,Fe.x,Fe.y,Fe.z),v+=2)}g.getAttribute("position").needsUpdate=!0;c.prototype.updateMatrixWorld.call(this,b)};return f}(Mc),Sl=function(c){function f(d,g,l){g=new ug(g,4,2);var r=new qa({wireframe:!0,fog:!1,toneMapped:!1});g=c.call(this,g,r)||this;g.light=d;g.light.updateMatrixWorld();g.color=l;g.type="PointLightHelper";g.matrix=g.light.matrixWorld;g.matrixAutoUpdate=!1;g.update();return g}y(f,c);var b=f.prototype;b.dispose=function(){this.geometry.dispose();this.material.dispose()};b.update=
function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)};return f}($a),Tl=new da,Sk=new Cb,Tk=new Cb,Ul=function(c){function f(d,g,l){var r=c.call(this)||this;r.light=d;r.light.updateMatrixWorld();r.matrix=d.matrixWorld;r.matrixAutoUpdate=!1;r.color=l;d=new sg(g);d.rotateY(.5*Math.PI);r.material=new qa({wireframe:!0,fog:!1,toneMapped:!1});void 0===r.color&&(r.material.vertexColors=!0);g=d.getAttribute("position");g=new Float32Array(3*g.count);
d.setAttribute("color",new M(g,3));r.add(new $a(d,r.material));r.update();return r}y(f,c);var b=f.prototype;b.dispose=function(){this.children[0].geometry.dispose();this.children[0].material.dispose()};b.update=function(){var d=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var g=d.geometry.getAttribute("color");Sk.copy(this.light.color);Tk.copy(this.light.groundColor);for(var l=0,r=g.count;l<r;l++){var v=l<r/2?Sk:Tk;g.setXYZ(l,v.r,v.g,v.b)}g.needsUpdate=!0}d.lookAt(Tl.setFromMatrixPosition(this.light.matrixWorld).negate())};
return f}(T),Uk=function(c){function f(b,d,g,l){void 0===b&&(b=10);void 0===d&&(d=10);void 0===g&&(g=4473924);void 0===l&&(l=8947848);g=new Cb(g);l=new Cb(l);var r=d/2,v=b/d,x=b/2;b=[];for(var w=[],A=0,D=0,J=-x;A<=d;A++,J+=v){b.push(-x,0,J,x,0,J);b.push(J,0,-x,J,0,x);var N=A===r?g:l;N.toArray(w,D);D+=3;N.toArray(w,D);D+=3;N.toArray(w,D);D+=3;N.toArray(w,D);D+=3}d=new Na;d.setAttribute("position",new Ya(b,3));d.setAttribute("color",new Ya(w,3));g=new sc({vertexColors:!0,toneMapped:!1});d=c.call(this,
d,g)||this;d.type="GridHelper";return d}y(f,c);return f}(Mc),Vl=function(c){function f(b,d,g,l,r,v){void 0===b&&(b=10);void 0===d&&(d=16);void 0===g&&(g=8);void 0===l&&(l=64);void 0===r&&(r=4473924);void 0===v&&(v=8947848);r=new Cb(r);v=new Cb(v);var x=[];for(var w=[],A=0;A<=d;A++){var D=A/d*2*Math.PI,J=Math.sin(D)*b;D=Math.cos(D)*b;x.push(0,0,0);x.push(J,0,D);J=A&1?r:v;w.push(J.r,J.g,J.b);w.push(J.r,J.g,J.b)}for(d=0;d<=g;d++)for(A=d&1?r:v,J=b-b/g*d,D=0;D<l;D++){var N=D/l*2*Math.PI,L=Math.sin(N)*
J;N=Math.cos(N)*J;x.push(L,0,N);w.push(A.r,A.g,A.b);N=(D+1)/l*2*Math.PI;L=Math.sin(N)*J;N=Math.cos(N)*J;x.push(L,0,N);w.push(A.r,A.g,A.b)}b=new Na;b.setAttribute("position",new Ya(x,3));b.setAttribute("color",new Ya(w,3));x=new sc({vertexColors:!0,toneMapped:!1});x=c.call(this,b,x)||this;x.type="PolarGridHelper";return x}y(f,c);return f}(Mc),Vk=new da,Rh=new da,Wk=new da,Wl=function(c){function f(d,g,l){var r=c.call(this)||this;r.light=d;r.light.updateMatrixWorld();r.matrix=d.matrixWorld;r.matrixAutoUpdate=
!1;r.color=l;void 0===g&&(g=1);d=new Na;d.setAttribute("position",new Ya([-g,g,0,g,g,0,g,-g,0,-g,-g,0,-g,g,0],3));g=new sc({fog:!1,toneMapped:!1});r.lightPlane=new bd(d,g);r.add(r.lightPlane);d=new Na;d.setAttribute("position",new Ya([0,0,0,0,0,1],3));r.targetLine=new bd(d,g);r.add(r.targetLine);r.update();return r}y(f,c);var b=f.prototype;b.dispose=function(){this.lightPlane.geometry.dispose();this.lightPlane.material.dispose();this.targetLine.geometry.dispose();this.targetLine.material.dispose()};
b.update=function(){Vk.setFromMatrixPosition(this.light.matrixWorld);Rh.setFromMatrixPosition(this.light.target.matrixWorld);Wk.subVectors(Rh,Vk);this.lightPlane.lookAt(Rh);void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color));this.targetLine.lookAt(Rh);this.targetLine.scale.z=Wk.length()};return f}(T),jh=new da,Bc=new wb,Xl=function(c){function f(b){function d(S,
P,ka){g(S,ka);g(P,ka)}function g(S,P){v.push(0,0,0);x.push(P.r,P.g,P.b);void 0===w[S]&&(w[S]=[]);w[S].push(v.length/3-1)}var l=new Na;var r=new sc({color:16777215,vertexColors:!0,toneMapped:!1}),v=[],x=[],w={},A=new Cb(16755200),D=new Cb(16711680),J=new Cb(43775),N=new Cb(16777215),L=new Cb(3355443);d("n1","n2",A);d("n2","n4",A);d("n4","n3",A);d("n3","n1",A);d("f1","f2",A);d("f2","f4",A);d("f4","f3",A);d("f3","f1",A);d("n1","f1",A);d("n2","f2",A);d("n3","f3",A);d("n4","f4",A);d("p","n1",D);d("p",
"n2",D);d("p","n3",D);d("p","n4",D);d("u1","u2",J);d("u2","u3",J);d("u3","u1",J);d("c","t",N);d("p","c",L);d("cn1","cn2",L);d("cn3","cn4",L);d("cf1","cf2",L);d("cf3","cf4",L);l.setAttribute("position",new Ya(v,3));l.setAttribute("color",new Ya(x,3));l=c.call(this,l,r)||this;l.type="CameraHelper";l.camera=b;l.camera.updateProjectionMatrix&&l.camera.updateProjectionMatrix();l.matrix=b.matrixWorld;l.matrixAutoUpdate=!1;l.pointMap=w;l.update();return l}y(f,c);f.prototype.update=function(){var b=this.geometry,
d=this.pointMap;Bc.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse);Dc("c",d,b,Bc,0,0,-1);Dc("t",d,b,Bc,0,0,1);Dc("n1",d,b,Bc,-1,-1,-1);Dc("n2",d,b,Bc,1,-1,-1);Dc("n3",d,b,Bc,-1,1,-1);Dc("n4",d,b,Bc,1,1,-1);Dc("f1",d,b,Bc,-1,-1,1);Dc("f2",d,b,Bc,1,-1,1);Dc("f3",d,b,Bc,-1,1,1);Dc("f4",d,b,Bc,1,1,1);Dc("u1",d,b,Bc,.7,1.1,-1);Dc("u2",d,b,Bc,-.7,1.1,-1);Dc("u3",d,b,Bc,0,2,-1);Dc("cf1",d,b,Bc,-1,0,1);Dc("cf2",d,b,Bc,1,0,1);Dc("cf3",d,b,Bc,0,-1,1);Dc("cf4",d,b,Bc,0,1,1);Dc("cn1",d,b,Bc,
-1,0,-1);Dc("cn2",d,b,Bc,1,0,-1);Dc("cn3",d,b,Bc,0,-1,-1);Dc("cn4",d,b,Bc,0,1,-1);b.getAttribute("position").needsUpdate=!0};return f}(Mc),Sh=new be,Xk=function(c){function f(d,g){void 0===g&&(g=16776960);var l=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),v=new Na;v.setIndex(new M(l,1));v.setAttribute("position",new M(r,3));g=c.call(this,v,new sc({color:g,toneMapped:!1}))||this;g.object=d;g.type="BoxHelper";g.matrixAutoUpdate=!1;g.update();return g}y(f,
c);var b=f.prototype;b.update=function(d){void 0!==d&&console.warn("THREE.BoxHelper: .update() has no longer arguments.");void 0!==this.object&&Sh.setFromObject(this.object);if(!Sh.isEmpty()){d=Sh.min;var g=Sh.max,l=this.geometry.attributes.position,r=l.array;r[0]=g.x;r[1]=g.y;r[2]=g.z;r[3]=d.x;r[4]=g.y;r[5]=g.z;r[6]=d.x;r[7]=d.y;r[8]=g.z;r[9]=g.x;r[10]=d.y;r[11]=g.z;r[12]=g.x;r[13]=g.y;r[14]=d.z;r[15]=d.x;r[16]=g.y;r[17]=d.z;r[18]=d.x;r[19]=d.y;r[20]=d.z;r[21]=g.x;r[22]=d.y;r[23]=d.z;l.needsUpdate=
!0;this.geometry.computeBoundingSphere()}};b.setFromObject=function(d){this.object=d;this.update();return this};b.copy=function(d){Mc.prototype.copy.call(this,d);this.object=d.object;return this};return f}(Mc),Yl=function(c){function f(b,d){void 0===d&&(d=16776960);var g=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),l=new Na;l.setIndex(new M(g,1));l.setAttribute("position",new Ya([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3));d=c.call(this,l,new sc({color:d,
toneMapped:!1}))||this;d.box=b;d.type="Box3Helper";d.geometry.computeBoundingSphere();return d}y(f,c);f.prototype.updateMatrixWorld=function(b){var d=this.box;d.isEmpty()||(d.getCenter(this.position),d.getSize(this.scale),this.scale.multiplyScalar(.5),c.prototype.updateMatrixWorld.call(this,b))};return f}(Mc),Zl=function(c){function f(b,d,g){void 0===d&&(d=1);void 0===g&&(g=16776960);var l=new Na;l.setAttribute("position",new Ya([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],
3));l.computeBoundingSphere();l=c.call(this,l,new sc({color:g,toneMapped:!1}))||this;l.type="PlaneHelper";l.plane=b;l.size=d;b=new Na;b.setAttribute("position",new Ya([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3));b.computeBoundingSphere();l.add(new $a(b,new qa({color:g,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})));return l}y(f,c);f.prototype.updateMatrixWorld=function(b){var d=-this.plane.constant;1E-8>Math.abs(d)&&(d=1E-8);this.scale.set(.5*this.size,.5*this.size,d);this.children[0].material.side=
0>d?1:0;this.lookAt(this.plane.normal);c.prototype.updateMatrixWorld.call(this,b)};return f}(bd),Yk=new da,Th,qj,$l=function(c){function f(d,g,l,r,v,x){var w=c.call(this)||this;w.type="ArrowHelper";void 0===d&&(d=new da(0,0,1));void 0===g&&(g=new da(0,0,0));void 0===l&&(l=1);void 0===r&&(r=16776960);void 0===v&&(v=.2*l);void 0===x&&(x=.2*v);void 0===Th&&(Th=new Na,Th.setAttribute("position",new Ya([0,0,0,0,1,0],3)),qj=new Nf(0,.5,1,5,1),qj.translate(0,-.5,0));w.position.copy(g);w.line=new bd(Th,new sc({color:r,
toneMapped:!1}));w.line.matrixAutoUpdate=!1;w.add(w.line);w.cone=new $a(qj,new qa({color:r,toneMapped:!1}));w.cone.matrixAutoUpdate=!1;w.add(w.cone);w.setDirection(d);w.setLength(l,v,x);return w}y(f,c);var b=f.prototype;b.setDirection=function(d){.99999<d.y?this.quaternion.set(0,0,0,1):-.99999>d.y?this.quaternion.set(1,0,0,0):(Yk.set(d.z,0,-d.x).normalize(),this.quaternion.setFromAxisAngle(Yk,Math.acos(d.y)))};b.setLength=function(d,g,l){void 0===g&&(g=.2*d);void 0===l&&(l=.2*g);this.line.scale.set(1,
Math.max(1E-4,d-g),1);this.line.updateMatrix();this.cone.scale.set(l,g,l);this.cone.position.y=d;this.cone.updateMatrix()};b.setColor=function(d){this.line.material.color.set(d);this.cone.material.color.set(d)};b.copy=function(d){c.prototype.copy.call(this,d,!1);this.line.copy(d.line);this.cone.copy(d.cone);return this};return f}(T),Zk=function(c){function f(b){void 0===b&&(b=1);var d=[0,0,0,b,0,0,0,0,0,0,b,0,0,0,0,0,0,b];b=new Na;b.setAttribute("position",new Ya(d,3));b.setAttribute("color",new Ya([1,
0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));d=new sc({vertexColors:!0,toneMapped:!1});b=c.call(this,b,d)||this;b.type="AxesHelper";return b}y(f,c);return f}(Mc),$k=new Float32Array(1),am=new Int32Array($k.buffer),he,Md=Math.pow(2,8),al=[.125,.215,.35,.446,.526,.582],bl=5+al.length,Nd=(he={},he[3E3]=0,he[3001]=1,he[3002]=2,he[3004]=3,he[3005]=4,he[3006]=5,he[3007]=6,he),jf=new qa({side:1,depthWrite:!1,depthTest:!1}),bm=new $a(new Ie,jf),rj=new yf,sj=function(){for(var c=[],f=[],b=[],d=8,g=0;g<bl;g++){var l=
Math.pow(2,d);f.push(l);var r=1/l;4<g?r=al[g-8+4-1]:0==g&&(r=0);b.push(r);r=1/(l-1);l=-r/2;r=1+r/2;var v=[l,l,r,l,r,r,l,l,r,r,l,r];l=new Float32Array(108);r=new Float32Array(72);for(var x=new Float32Array(36),w=0;6>w;w++){var A=w%3*2/3-1,D=2<w?0:-1;l.set([A,D,0,A+2/3,D,0,A+2/3,D+1,0,A,D,0,A+2/3,D+1,0,A,D+1,0],18*w);r.set(v,12*w);x.set([w,w,w,w,w,w],6*w)}v=new Na;v.setAttribute("position",new M(l,3));v.setAttribute("uv",new M(r,2));v.setAttribute("faceIndex",new M(x,1));c.push(v);4<d&&d--}return{_lodPlanes:c,
_sizeLods:f,_sigmas:b}}(),vg=sj._lodPlanes,cl=sj._sizeLods,Uh=sj._sigmas,dl=new Cb,tj=null,kf=(1+Math.sqrt(5))/2,Pf=1/kf,el=[new da(1,1,1),new da(-1,1,1),new da(1,1,-1),new da(-1,1,-1),new da(0,kf,Pf),new da(0,kf,-Pf),new da(Pf,0,kf),new da(-Pf,0,kf),new da(kf,Pf,0),new da(-kf,Pf,0)],cm=function(){function c(b){this._renderer=b;this._pingPongRenderTarget=null;b=new Float32Array(20);var d=new da(0,1,0);this._blurMaterial=new kd({name:"SphericalGaussianBlur",defines:{n:20},uniforms:{envMap:{value:null},
samples:{value:1},weights:{value:b},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:d},inputEncoding:{value:Nd[3E3]},outputEncoding:{value:Nd[3E3]}},vertexShader:Oi(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t"+
Pi()+"\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",
blending:0,depthTest:!1,depthWrite:!1});this._cubemapShader=this._equirectShader=null;this._compileMaterial(this._blurMaterial)}var f=c.prototype;f.fromScene=function(b,d,g,l){void 0===d&&(d=0);void 0===g&&(g=.1);void 0===l&&(l=100);tj=this._renderer.getRenderTarget();var r=this._allocateTargets();this._sceneToCubeUV(b,g,l,r);0<d&&this._blur(r,0,0,d);this._applyPMREM(r);this._cleanup(r);return r};f.fromEquirectangular=function(b){return this._fromTexture(b)};f.fromCubemap=function(b){return this._fromTexture(b)};
f.compileCubemapShader=function(){null===this._cubemapShader&&(this._cubemapShader=Vj(),this._compileMaterial(this._cubemapShader))};f.compileEquirectangularShader=function(){null===this._equirectShader&&(this._equirectShader=Uj(),this._compileMaterial(this._equirectShader))};f.dispose=function(){this._blurMaterial.dispose();null!==this._cubemapShader&&this._cubemapShader.dispose();null!==this._equirectShader&&this._equirectShader.dispose();for(var b=0;b<vg.length;b++)vg[b].dispose()};f._cleanup=
function(b){this._pingPongRenderTarget.dispose();this._renderer.setRenderTarget(tj);b.scissorTest=!1;kh(b,0,0,b.width,b.height)};f._fromTexture=function(b){tj=this._renderer.getRenderTarget();var d=this._allocateTargets(b);this._textureToCubeUV(b,d);this._applyPMREM(d);this._cleanup(d);return d};f._allocateTargets=function(b){var d=void 0===b||1009!==b.type?!1:3E3===b.encoding||3001===b.encoding||3007===b.encoding;d={magFilter:1003,minFilter:1003,generateMipmaps:!1,type:1009,format:1023,encoding:d?
b.encoding:3002,depthBuffer:!1};var g=Tj(d);g.depthBuffer=b?!1:!0;this._pingPongRenderTarget=Tj(d);return g};f._compileMaterial=function(b){b=new $a(vg[0],b);this._renderer.compile(b,rj)};f._sceneToCubeUV=function(b,d,g,l){d=new Bb(90,1,d,g);g=[1,-1,1,1,1,1];var r=[1,1,1,-1,-1,-1],v=this._renderer,x=v.autoClear,w=v.outputEncoding,A=v.toneMapping;v.getClearColor(dl);v.toneMapping=0;v.outputEncoding=3E3;var D=v.autoClear=!1,J=b.background;J?J.isColor&&(jf.color.copy(J).convertSRGBToLinear(),b.background=
null,D=Sj(jf.color),jf.opacity=D,D=!0):(jf.color.copy(dl).convertSRGBToLinear(),D=Sj(jf.color),jf.opacity=D,D=!0);for(J=0;6>J;J++){var N=J%3;0==N?(d.up.set(0,g[J],0),d.lookAt(r[J],0,0)):1==N?(d.up.set(0,0,g[J]),d.lookAt(0,r[J],0)):(d.up.set(0,g[J],0),d.lookAt(0,0,r[J]));kh(l,N*Md,2<J?Md:0,Md,Md);v.setRenderTarget(l);D&&v.render(bm,d);v.render(b,d)}v.toneMapping=A;v.outputEncoding=w;v.autoClear=x};f._textureToCubeUV=function(b,d){var g=this._renderer;b.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=
Vj()):null==this._equirectShader&&(this._equirectShader=Uj());var l=b.isCubeTexture?this._cubemapShader:this._equirectShader,r=new $a(vg[0],l);l=l.uniforms;l.envMap.value=b;b.isCubeTexture||l.texelSize.value.set(1/b.image.width,1/b.image.height);l.inputEncoding.value=Nd[b.encoding];l.outputEncoding.value=Nd[d.texture.encoding];kh(d,0,0,3*Md,2*Md);g.setRenderTarget(d);g.render(r,rj)};f._applyPMREM=function(b){var d=this._renderer,g=d.autoClear;d.autoClear=!1;for(var l=1;l<bl;l++)this._blur(b,l-1,l,
Math.sqrt(Uh[l]*Uh[l]-Uh[l-1]*Uh[l-1]),el[(l-1)%el.length]);d.autoClear=g};f._blur=function(b,d,g,l,r){var v=this._pingPongRenderTarget;this._halfBlur(b,v,d,g,l,"latitudinal",r);this._halfBlur(v,b,g,g,l,"longitudinal",r)};f._halfBlur=function(b,d,g,l,r,v,x){var w=this._renderer,A=this._blurMaterial;"latitudinal"!==v&&"longitudinal"!==v&&console.error("blur direction must be either latitudinal or longitudinal!");var D=new $a(vg[l],A);A=A.uniforms;var J=cl[g]-1;J=isFinite(r)?Math.PI/(2*J):2*Math.PI/
39;var N=r/J,L=isFinite(r)?1+Math.floor(3*N):20;20<L&&console.warn("sigmaRadians, "+r+", is too large and will clip, as it requested "+L+" samples when the maximum is set to 20");r=[];for(var S=0,P=0;20>P;++P){var ka=P/N;ka=Math.exp(-ka*ka/2);r.push(ka);0==P?S+=ka:P<L&&(S+=2*ka)}for(N=0;N<r.length;N++)r[N]/=S;A.envMap.value=b.texture;A.samples.value=L;A.weights.value=r;A.latitudinal.value="latitudinal"===v;x&&(A.poleAxis.value=x);A.dTheta.value=J;A.mipInt.value=8-g;A.inputEncoding.value=Nd[b.texture.encoding];
A.outputEncoding.value=Nd[b.texture.encoding];b=cl[l];kh(d,3*Math.max(0,Md-2*b),(0===l?0:2*Md)+2*b*(4<l?l-8+4:0),3*b,2*b);w.setRenderTarget(d);w.render(D,rj)};return c}();Eb.create=function(c,f){console.log("THREE.Curve.create() has been deprecated");c.prototype=Object.create(Eb.prototype);c.prototype.constructor=c;c.prototype.getPoint=f;return c};Object.assign(ud.prototype,{fromPoints:function(c){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints().");return this.setFromPoints(c)}});
Wj.prototype=Object.create(Qc.prototype);Xj.prototype=Object.create(Qc.prototype);Qi.prototype=Object.create(Qc.prototype);Object.assign(Qi.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}});Uk.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};
Rk.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};Object.assign(sb.prototype,{extractUrlBase:function(c){console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead.");return mj.extractUrlBase(c)}});sb.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};
Object.assign(Nk.prototype,{center:function(c){console.warn("THREE.Box2: .center() has been renamed to .getCenter().");return this.getCenter(c)},empty:function(){console.warn("THREE.Box2: .empty() has been renamed to .isEmpty().");return this.isEmpty()},isIntersectionBox:function(c){console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(c)},size:function(c){console.warn("THREE.Box2: .size() has been renamed to .getSize().");return this.getSize(c)}});
Object.assign(be.prototype,{center:function(c){console.warn("THREE.Box3: .center() has been renamed to .getCenter().");return this.getCenter(c)},empty:function(){console.warn("THREE.Box3: .empty() has been renamed to .isEmpty().");return this.isEmpty()},isIntersectionBox:function(c){console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(c)},isIntersectionSphere:function(c){console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere().");
return this.intersectsSphere(c)},size:function(c){console.warn("THREE.Box3: .size() has been renamed to .getSize().");return this.getSize(c)}});Object.assign(Be.prototype,{empty:function(){console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty().");return this.isEmpty()}});Yf.prototype.setFromMatrix=function(c){console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix().");return this.setFromProjectionMatrix(c)};Pk.prototype.center=function(c){console.warn("THREE.Line3: .center() has been renamed to .getCenter().");
return this.getCenter(c)};Object.assign(Qb,{random16:function(){console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead.");return Math.random()},nearestPowerOfTwo:function(c){console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo().");return Qb.floorPowerOfTwo(c)},nextPowerOfTwo:function(c){console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo().");return Qb.ceilPowerOfTwo(c)}});Object.assign(fd.prototype,{flattenToArrayOffset:function(c,
f){console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.");return this.toArray(c,f)},multiplyVector3:function(c){console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return c.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(c){console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead.");
return c.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},getInverse:function(c){console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead.");return this.copy(c).invert()}});Object.assign(ec.prototype,{extractPosition:function(c){console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(c)},flattenToArrayOffset:function(c,
f){console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.");return this.toArray(c,f)},getPosition:function(){console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");return(new da).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(c){console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(c)},
multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(c){console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead.");return c.applyMatrix4(this)},multiplyVector4:function(c){console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return c.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},
rotateAxis:function(c){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");c.transformDirection(this)},crossVector:function(c){console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");return c.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},
rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(c){console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead.");return c.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(c,f,b,d,g,l){console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead.");
return this.makePerspective(c,f,d,b,g,l)},getInverse:function(c){console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead.");return this.copy(c).invert()}});yd.prototype.isIntersectionLine=function(c){console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine().");return this.intersectsLine(c)};Object.assign(Oc.prototype,{multiplyVector3:function(c){console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");
return c.applyQuaternion(this)},inverse:function(){console.warn("THREE.Quaternion: .inverse() has been renamed to invert().");return this.invert()}});Object.assign(zf.prototype,{isIntersectionBox:function(c){console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(c)},isIntersectionPlane:function(c){console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane().");return this.intersectsPlane(c)},isIntersectionSphere:function(c){console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere().");
return this.intersectsSphere(c)}});Object.assign(xd.prototype,{area:function(){console.warn("THREE.Triangle: .area() has been renamed to .getArea().");return this.getArea()},barycoordFromPoint:function(c,f){console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord().");return this.getBarycoord(c,f)},midpoint:function(c){console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint().");return this.getMidpoint(c)},normal:function(c){console.warn("THREE.Triangle: .normal() has been renamed to .getNormal().");
return this.getNormal(c)},plane:function(c){console.warn("THREE.Triangle: .plane() has been renamed to .getPlane().");return this.getPlane(c)}});Object.assign(xd,{barycoordFromPoint:function(c,f,b,d,g){console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord().");return xd.getBarycoord(c,f,b,d,g)},normal:function(c,f,b,d){console.warn("THREE.Triangle: .normal() has been renamed to .getNormal().");return xd.getNormal(c,f,b,d)}});Object.assign(ye.prototype,{extractAllPoints:function(c){console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead.");
return this.extractPoints(c)},extrude:function(c){console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead.");return new cf(this,c)},makeGeometry:function(c){console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead.");return new tg(this,c)}});Object.assign(ib.prototype,{fromAttribute:function(c,f,b){console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(c,f,b)},distanceToManhattan:function(c){console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo().");
return this.manhattanDistanceTo(c)},lengthManhattan:function(){console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength().");return this.manhattanLength()}});Object.assign(da.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},
getPositionFromMatrix:function(c){console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(c)},getScaleFromMatrix:function(c){console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(c)},getColumnFromMatrix:function(c,f){console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(f,
c)},applyProjection:function(c){console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead.");return this.applyMatrix4(c)},fromAttribute:function(c,f,b){console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(c,f,b)},distanceToManhattan:function(c){console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo().");return this.manhattanDistanceTo(c)},lengthManhattan:function(){console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength().");
return this.manhattanLength()}});Object.assign(qc.prototype,{fromAttribute:function(c,f,b){console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(c,f,b)},lengthManhattan:function(){console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength().");return this.manhattanLength()}});Object.assign(T.prototype,{getChildByName:function(c){console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");
return this.getObjectByName(c)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(c,f){console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(f,c)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(c){console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4().");
return this.applyMatrix4(c)}});Object.defineProperties(T.prototype,{eulerOrder:{get:function(){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");return this.rotation.order},set:function(c){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");this.rotation.order=c}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});
Object.assign($a.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}});Object.defineProperties($a.prototype,{drawMode:{get:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode.");return 0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});
Object.defineProperties(Re.prototype,{objects:{get:function(){console.warn("THREE.LOD: .objects has been renamed to .levels.");return this.levels}}});Object.defineProperty(Ue.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}});Se.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};Object.defineProperty(Eb.prototype,
"__arcLengthDivisions",{get:function(){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions.");return this.arcLengthDivisions},set:function(c){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions.");this.arcLengthDivisions=c}});Bb.prototype.setLens=function(c,f){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup.");void 0!==f&&(this.filmGauge=f);this.setFocalLength(c)};Object.defineProperties(uc.prototype,
{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(c){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov.");this.shadow.camera.fov=c}},shadowCameraLeft:{set:function(c){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left.");this.shadow.camera.left=c}},shadowCameraRight:{set:function(c){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right.");this.shadow.camera.right=c}},shadowCameraTop:{set:function(c){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top.");
this.shadow.camera.top=c}},shadowCameraBottom:{set:function(c){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom.");this.shadow.camera.bottom=c}},shadowCameraNear:{set:function(c){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near.");this.shadow.camera.near=c}},shadowCameraFar:{set:function(c){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far.");this.shadow.camera.far=c}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},
shadowBias:{set:function(c){console.warn("THREE.Light: .shadowBias is now .shadow.bias.");this.shadow.bias=c}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(c){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width.");this.shadow.mapSize.width=c}},shadowMapHeight:{set:function(c){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height.");this.shadow.mapSize.height=c}}});Object.defineProperties(M.prototype,
{length:{get:function(){console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead.");return this.array.length}},dynamic:{get:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead.");return 35048===this.usage},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead.");this.setUsage(35048)}}});Object.assign(M.prototype,{setDynamic:function(c){console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead.");
this.setUsage(!0===c?35048:35044);return this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}});Object.assign(Na.prototype,{addIndex:function(c){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().");this.setIndex(c)},addAttribute:function(c,f,b){console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute().");
return f&&f.isBufferAttribute||f&&f.isInterleavedBufferAttribute?"index"===c?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(f),this):this.setAttribute(c,f):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(c,new M(f,b)))},addDrawCall:function(c,f,b){void 0!==b&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.");console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup().");
this.addGroup(c,f)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().");this.clearGroups()},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(c){console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute().");return this.deleteAttribute(c)},applyMatrix:function(c){console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4().");
return this.applyMatrix4(c)}});Object.defineProperties(Na.prototype,{drawcalls:{get:function(){console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups.");return this.groups}},offsets:{get:function(){console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups.");return this.groups}}});Object.defineProperties(fg.prototype,{maxInstancedCount:{get:function(){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount.");return this.instanceCount},
set:function(c){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount.");this.instanceCount=c}}});Object.defineProperties(Mi.prototype,{linePrecision:{get:function(){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead.");return this.params.Line.threshold},set:function(c){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead.");this.params.Line.threshold=c}}});
Object.defineProperties(Tc.prototype,{dynamic:{get:function(){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead.");return 35048===this.usage},set:function(c){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead.");this.setUsage(c)}}});Object.assign(Tc.prototype,{setDynamic:function(c){console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead.");this.setUsage(!0===c?35048:35044);return this},
setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}});Object.assign(cf.prototype,{getArrays:function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")}});Object.assign(cj.prototype,
{dispose:function(){console.error("THREE.Scene: .dispose() has been removed.")}});Object.defineProperties(Lk.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead.");return this}}});Object.defineProperties(U.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},
set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){console.warn("THREE.Material: .wrapRGB has been removed.");return new Cb}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(c){console.warn("THREE."+
this.type+": .shading has been removed. Use the boolean .flatShading instead.");this.flatShading=1===c}},stencilMask:{get:function(){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead.");return this.stencilFuncMask},set:function(c){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead.");this.stencilFuncMask=c}}});Object.defineProperties(Id.prototype,{metal:{get:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead.");
return!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}});Object.defineProperties(Hd.prototype,{transparency:{get:function(){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission.");return this.transmission},set:function(c){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission.");this.transmission=c}}});Object.defineProperties(yb.prototype,{derivatives:{get:function(){console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");
return this.extensions.derivatives},set:function(c){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");this.extensions.derivatives=c}}});Object.assign(qe.prototype,{clearTarget:function(c,f,b,d){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead.");this.setRenderTarget(c);this.clear(f,b,d)},animate:function(c){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop().");this.setAnimationLoop(c)},
getCurrentRenderTarget:function(){console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget().");return this.getRenderTarget()},getMaxAnisotropy:function(){console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy().");return this.capabilities.getMaxAnisotropy()},getPrecision:function(){console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision.");return this.capabilities.precision},resetGLState:function(){console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset().");
return this.state.reset()},supportsFloatTextures:function(){console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' ).");return this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' ).");return this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' ).");
return this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' ).");return this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' ).");return this.extensions.get("WEBGL_compressed_texture_pvrtc")},
supportsBlendMinMax:function(){console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' ).");return this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures.");return this.capabilities.vertexTextures},supportsInstancedArrays:function(){console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' ).");
return this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(c){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest().");this.setScissorTest(c)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},
setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel().");
return this.getActiveMipmapLevel()}});Object.defineProperties(qe.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(c){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.");this.shadowMap.enabled=c}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(c){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.");this.shadowMap.type=c}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},
set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead.");return this.getContext()}},vr:{get:function(){console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr");return this.xr}},gammaInput:{get:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.");
return!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead.");return!1},set:function(c){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead.");this.outputEncoding=!0===c?3001:3E3}},toneMappingWhitePoint:{get:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.");
return 1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}});Object.defineProperties(Ne.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},
set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(pe.prototype,{wrapS:{get:function(){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");
return this.texture.wrapS},set:function(c){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");this.texture.wrapS=c}},wrapT:{get:function(){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");return this.texture.wrapT},set:function(c){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");this.texture.wrapT=c}},magFilter:{get:function(){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");return this.texture.magFilter},
set:function(c){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");this.texture.magFilter=c}},minFilter:{get:function(){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");return this.texture.minFilter},set:function(c){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");this.texture.minFilter=c}},anisotropy:{get:function(){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");return this.texture.anisotropy},
set:function(c){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");this.texture.anisotropy=c}},offset:{get:function(){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");return this.texture.offset},set:function(c){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");this.texture.offset=c}},repeat:{get:function(){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");return this.texture.repeat},set:function(c){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");
this.texture.repeat=c}},format:{get:function(){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");return this.texture.format},set:function(c){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");this.texture.format=c}},type:{get:function(){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");return this.texture.type},set:function(c){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");this.texture.type=c}},generateMipmaps:{get:function(){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");
return this.texture.generateMipmaps},set:function(c){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");this.texture.generateMipmaps=c}}});Object.defineProperties(oj.prototype,{load:{value:function(c){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var f=this;(new ih).load(c,function(b){f.setBuffer(b)});return this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}});Kk.prototype.getData=
function(){console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData().");return this.getFrequencyData()};Tb.prototype.updateCubeMap=function(c,f){console.warn("THREE.CubeCamera: .updateCubeMap() is now .update().");return this.update(c,f)};Tb.prototype.clear=function(c,f,b,d){console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear().");return this.renderTarget.clear(c,f,b,d)};Ge.crossOrigin=void 0;Ge.loadTexture=function(c,f,b,d){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");
var g=new Uc;g.setCrossOrigin(this.crossOrigin);c=g.load(c,b,void 0,d);f&&(c.mapping=f);return c};Ge.loadTextureCube=function(c,f,b,d){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var g=new ub;g.setCrossOrigin(this.crossOrigin);c=g.load(c,b,void 0,d);f&&(c.mapping=f);return c};Ge.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};Ge.loadCompressedTextureCube=
function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"125"}}));"undefined"!==typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="125");a.ACESFilmicToneMapping=4;a.AddEquation=100;a.AddOperation=2;a.AdditiveAnimationBlendMode=2501;a.AdditiveBlending=
2;a.AlphaFormat=1021;a.AlwaysDepth=1;a.AlwaysStencilFunc=519;a.AmbientLight=dh;a.AmbientLightProbe=Hi;a.AnimationClip=Wa;a.AnimationLoader=tb;a.AnimationMixer=Ji;a.AnimationObjectGroup=Pj;a.AnimationUtils=wc;a.ArcCurve=Vc;a.ArrayCamera=rf;a.ArrowHelper=$l;a.Audio=oj;a.AudioAnalyser=Kk;a.AudioContext=nj;a.AudioListener=El;a.AudioLoader=ih;a.AxesHelper=Zk;a.AxisHelper=function(c){console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper.");return new Zk(c)};a.BackSide=1;a.BasicDepthPacking=
3200;a.BasicShadowMap=0;a.BinaryTextureLoader=function(c){console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader.");return new Ac(c)};a.Bone=Te;a.BooleanKeyframeTrack=F;a.BoundingBoxHelper=function(c,f){console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead.");return new Xk(c,f)};a.Box2=Nk;a.Box3=be;a.Box3Helper=Yl;a.BoxBufferGeometry=Ie;a.BoxGeometry=Ie;a.BoxHelper=Xk;a.BufferAttribute=M;a.BufferGeometry=Na;a.BufferGeometryLoader=
hh;a.ByteType=1010;a.Cache=df;a.Camera=wb;a.CameraHelper=Xl;a.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")};a.CanvasTexture=Xe;a.CatmullRomCurve3=Qc;a.CineonToneMapping=3;a.CircleBufferGeometry=Ah;a.CircleGeometry=Ah;a.ClampToEdgeWrapping=1001;a.Clock=Hk;a.ClosedSplineCurve3=Wj;a.Color=Cb;a.ColorKeyframeTrack=K;a.CompressedTexture=ue;a.CompressedTextureLoader=bc;a.ConeBufferGeometry=Bh;a.ConeGeometry=Bh;a.CubeCamera=Tb;a.CubeReflectionMapping=301;a.CubeRefractionMapping=
302;a.CubeTexture=Ob;a.CubeTextureLoader=ub;a.CubeUVReflectionMapping=306;a.CubeUVRefractionMapping=307;a.CubicBezierCurve=qd;a.CubicBezierCurve3=Kd;a.CubicInterpolant=k;a.CullFaceBack=1;a.CullFaceFront=2;a.CullFaceFrontBack=3;a.CullFaceNone=0;a.Curve=Eb;a.CurvePath=xe;a.CustomBlending=5;a.CustomToneMapping=5;a.CylinderBufferGeometry=Nf;a.CylinderGeometry=Nf;a.Cylindrical=Ql;a.DataTexture=Ab;a.DataTexture2DArray=pb;a.DataTexture3D=Kb;a.DataTextureLoader=Ac;a.DataUtils={toHalfFloat:function(c){$k[0]=
c;c=am[0];var f=c>>16&32768,b=c>>12&2047,d=c>>23&255;return 103>d?f:142<d?f|31744|((255==d?0:1)&&c&8388607):113>d?(b|=2048,f|(b>>114-d)+(b>>113-d&1)):f=(f|d-112<<10|b>>1)+(b&1)}};a.DecrementStencilOp=7683;a.DecrementWrapStencilOp=34056;a.DefaultLoadingManager=Jj;a.DepthFormat=1026;a.DepthStencilFormat=1027;a.DepthTexture=Wd;a.DirectionalLight=ch;a.DirectionalLightHelper=Wl;a.DiscreteInterpolant=u;a.DodecahedronBufferGeometry=Ch;a.DodecahedronGeometry=Ch;a.DoubleSide=2;a.DstAlphaFactor=206;a.DstColorFactor=
208;a.DynamicBufferAttribute=function(c,f){console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead.");return(new M(c,f)).setUsage(35048)};a.DynamicCopyUsage=35050;a.DynamicDrawUsage=35048;a.DynamicReadUsage=35049;a.EdgesGeometry=gj;a.EdgesHelper=function(c,f){console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead.");return new Mc(new gj(c.geometry),new sc({color:void 0!==f?f:16777215}))};a.EllipseCurve=
Hc;a.EqualDepth=4;a.EqualStencilFunc=514;a.EquirectangularReflectionMapping=303;a.EquirectangularRefractionMapping=304;a.Euler=wg;a.EventDispatcher=O;a.ExtrudeBufferGeometry=cf;a.ExtrudeGeometry=cf;a.Face3=$h;a.Face4=function(c,f,b,d,g,l,r){console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");return new $h(c,f,b,g,l,r)};a.FaceColors=1;a.FileLoader=Wb;a.FlatShading=1;a.Float16BufferAttribute=gb;a.Float32Attribute=function(c,f){console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead.");
return new Ya(c,f)};a.Float32BufferAttribute=Ya;a.Float64Attribute=function(c,f){console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead.");return new na(c,f)};a.Float64BufferAttribute=na;a.FloatType=1015;a.Fog=lk;a.FogExp2=kk;a.Font=Ek;a.FontLoader=Fi;a.FrontSide=0;a.Frustum=Yf;a.GLBufferAttribute=Li;a.GLSL1="100";a.GLSL3="300 es";a.GammaEncoding=3007;a.GeometryUtils={merge:function(c,f,b){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");
if(f.isMesh){f.matrixAutoUpdate&&f.updateMatrix();var d=f.matrix;f=f.geometry}c.merge(f,d,b)},center:function(c){console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.");return c.center()}};a.GreaterDepth=6;a.GreaterEqualDepth=5;a.GreaterEqualStencilFunc=518;a.GreaterStencilFunc=516;a.GridHelper=Uk;a.Group=Dd;a.HalfFloatType=1016;a.HemisphereLight=$g;a.HemisphereLightHelper=Ul;a.HemisphereLightProbe=Gi;a.IcosahedronBufferGeometry=Fh;a.IcosahedronGeometry=
Fh;a.ImageBitmapLoader=Di;a.ImageLoader=fc;a.ImageUtils=Ge;a.ImmediateRenderObject=gg;a.IncrementStencilOp=7682;a.IncrementWrapStencilOp=34055;a.InstancedBufferAttribute=gh;a.InstancedBufferGeometry=fg;a.InstancedInterleavedBuffer=Ki;a.InstancedMesh=jd;a.Int16Attribute=function(c,f){console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead.");return new za(c,f)};a.Int16BufferAttribute=za;a.Int32Attribute=function(c,f){console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead.");
return new Ka(c,f)};a.Int32BufferAttribute=Ka;a.Int8Attribute=function(c,f){console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead.");return new Q(c,f)};a.Int8BufferAttribute=Q;a.IntType=1013;a.InterleavedBuffer=Tc;a.InterleavedBufferAttribute=od;a.Interpolant=n;a.InterpolateDiscrete=2300;a.InterpolateLinear=2301;a.InterpolateSmooth=2302;a.InvertStencilOp=5386;a.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")};a.KeepStencilOp=7680;
a.KeyframeTrack=B;a.LOD=Re;a.LatheBufferGeometry=Gh;a.LatheGeometry=Gh;a.Layers=Vh;a.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")};a.LessDepth=2;a.LessEqualDepth=3;a.LessEqualStencilFunc=515;a.LessStencilFunc=513;a.Light=uc;a.LightProbe=ld;a.Line=bd;a.Line3=Pk;a.LineBasicMaterial=sc;a.LineCurve=dd;a.LineCurve3=rd;a.LineDashedMaterial=p;a.LineLoop=te;a.LinePieces=1;a.LineSegments=Mc;a.LineStrip=0;a.LinearEncoding=3E3;a.LinearFilter=1006;
a.LinearInterpolant=q;a.LinearMipMapLinearFilter=1008;a.LinearMipMapNearestFilter=1007;a.LinearMipmapLinearFilter=1008;a.LinearMipmapNearestFilter=1007;a.LinearToneMapping=1;a.Loader=sb;a.LoaderUtils=mj;a.LoadingManager=bb;a.LogLuvEncoding=3003;a.LoopOnce=2200;a.LoopPingPong=2202;a.LoopRepeat=2201;a.LuminanceAlphaFormat=1025;a.LuminanceFormat=1024;a.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2};a.Material=U;a.MaterialLoader=fh;a.Math=Qb;a.MathUtils=Qb;a.Matrix3=fd;a.Matrix4=ec;a.MaxEquation=
104;a.Mesh=$a;a.MeshBasicMaterial=qa;a.MeshDepthMaterial=Bd;a.MeshDistanceMaterial=Cd;a.MeshFaceMaterial=function(c){console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead.");return c};a.MeshLambertMaterial=G;a.MeshMatcapMaterial=z;a.MeshNormalMaterial=Jd;a.MeshPhongMaterial=Id;a.MeshPhysicalMaterial=Hd;a.MeshStandardMaterial=gd;a.MeshToonMaterial=Zd;a.MinEquation=103;a.MirroredRepeatWrapping=1002;a.MixOperation=1;a.MultiMaterial=function(c){void 0===c&&(c=[]);console.warn("THREE.MultiMaterial has been removed. Use an Array instead.");
c.isMultiMaterial=!0;c.materials=c;c.clone=function(){return c.slice()};return c};a.MultiplyBlending=4;a.MultiplyOperation=0;a.NearestFilter=1003;a.NearestMipMapLinearFilter=1005;a.NearestMipMapNearestFilter=1004;a.NearestMipmapLinearFilter=1005;a.NearestMipmapNearestFilter=1004;a.NeverDepth=0;a.NeverStencilFunc=512;a.NoBlending=0;a.NoColors=0;a.NoToneMapping=0;a.NormalAnimationBlendMode=2500;a.NormalBlending=1;a.NotEqualDepth=7;a.NotEqualStencilFunc=517;a.NumberKeyframeTrack=Z;a.Object3D=T;a.ObjectLoader=
Cl;a.ObjectSpaceNormalMap=1;a.OctahedronBufferGeometry=sg;a.OctahedronGeometry=sg;a.OneFactor=201;a.OneMinusDstAlphaFactor=207;a.OneMinusDstColorFactor=209;a.OneMinusSrcAlphaFactor=205;a.OneMinusSrcColorFactor=203;a.OrthographicCamera=yf;a.PCFShadowMap=1;a.PCFSoftShadowMap=2;a.PMREMGenerator=cm;a.ParametricBufferGeometry=Gd;a.ParametricGeometry=Gd;a.Particle=function(c){console.warn("THREE.Particle has been renamed to THREE.Sprite.");return new Qe(c)};a.ParticleBasicMaterial=function(c){console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial.");
return new cd(c)};a.ParticleSystem=function(c,f){console.warn("THREE.ParticleSystem has been renamed to THREE.Points.");return new Vd(c,f)};a.ParticleSystemMaterial=function(c){console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial.");return new cd(c)};a.Path=ud;a.PerspectiveCamera=Bb;a.Plane=yd;a.PlaneBufferGeometry=Qf;a.PlaneGeometry=Qf;a.PlaneHelper=Zl;a.PointCloud=function(c,f){console.warn("THREE.PointCloud has been renamed to THREE.Points.");return new Vd(c,f)};
a.PointCloudMaterial=function(c){console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial.");return new cd(c)};a.PointLight=bh;a.PointLightHelper=Sl;a.Points=Vd;a.PointsMaterial=cd;a.PolarGridHelper=Vl;a.PolyhedronBufferGeometry=Ee;a.PolyhedronGeometry=Ee;a.PositionalAudio=Gl;a.PropertyBinding=Rc;a.PropertyMixer=Ii;a.QuadraticBezierCurve=sd;a.QuadraticBezierCurve3=Ld;a.Quaternion=Oc;a.QuaternionKeyframeTrack=ya;a.QuaternionLinearInterpolant=ja;a.REVISION="125";a.RGBADepthPacking=
3201;a.RGBAFormat=1023;a.RGBAIntegerFormat=1033;a.RGBA_ASTC_10x10_Format=37819;a.RGBA_ASTC_10x5_Format=37816;a.RGBA_ASTC_10x6_Format=37817;a.RGBA_ASTC_10x8_Format=37818;a.RGBA_ASTC_12x10_Format=37820;a.RGBA_ASTC_12x12_Format=37821;a.RGBA_ASTC_4x4_Format=37808;a.RGBA_ASTC_5x4_Format=37809;a.RGBA_ASTC_5x5_Format=37810;a.RGBA_ASTC_6x5_Format=37811;a.RGBA_ASTC_6x6_Format=37812;a.RGBA_ASTC_8x5_Format=37813;a.RGBA_ASTC_8x6_Format=37814;a.RGBA_ASTC_8x8_Format=37815;a.RGBA_BPTC_Format=36492;a.RGBA_ETC2_EAC_Format=
37496;a.RGBA_PVRTC_2BPPV1_Format=35843;a.RGBA_PVRTC_4BPPV1_Format=35842;a.RGBA_S3TC_DXT1_Format=33777;a.RGBA_S3TC_DXT3_Format=33778;a.RGBA_S3TC_DXT5_Format=33779;a.RGBDEncoding=3006;a.RGBEEncoding=3002;a.RGBEFormat=1023;a.RGBFormat=1022;a.RGBIntegerFormat=1032;a.RGBM16Encoding=3005;a.RGBM7Encoding=3004;a.RGB_ETC1_Format=36196;a.RGB_ETC2_Format=37492;a.RGB_PVRTC_2BPPV1_Format=35841;a.RGB_PVRTC_4BPPV1_Format=35840;a.RGB_S3TC_DXT1_Format=33776;a.RGFormat=1030;a.RGIntegerFormat=1031;a.RawShaderMaterial=
kd;a.Ray=zf;a.Raycaster=Mi;a.RectAreaLight=eh;a.RedFormat=1028;a.RedIntegerFormat=1029;a.ReinhardToneMapping=2;a.RepeatWrapping=1E3;a.ReplaceStencilOp=7681;a.ReverseSubtractEquation=102;a.RingBufferGeometry=Hh;a.RingGeometry=Hh;a.SRGB8_ALPHA8_ASTC_10x10_Format=37851;a.SRGB8_ALPHA8_ASTC_10x5_Format=37848;a.SRGB8_ALPHA8_ASTC_10x6_Format=37849;a.SRGB8_ALPHA8_ASTC_10x8_Format=37850;a.SRGB8_ALPHA8_ASTC_12x10_Format=37852;a.SRGB8_ALPHA8_ASTC_12x12_Format=37853;a.SRGB8_ALPHA8_ASTC_4x4_Format=37840;a.SRGB8_ALPHA8_ASTC_5x4_Format=
37841;a.SRGB8_ALPHA8_ASTC_5x5_Format=37842;a.SRGB8_ALPHA8_ASTC_6x5_Format=37843;a.SRGB8_ALPHA8_ASTC_6x6_Format=37844;a.SRGB8_ALPHA8_ASTC_8x5_Format=37845;a.SRGB8_ALPHA8_ASTC_8x6_Format=37846;a.SRGB8_ALPHA8_ASTC_8x8_Format=37847;a.Scene=cj;a.SceneUtils={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};
a.ShaderChunk=cc;a.ShaderLib=md;a.ShaderMaterial=yb;a.ShadowMaterial=Yd;a.Shape=ye;a.ShapeBufferGeometry=tg;a.ShapeGeometry=tg;a.ShapePath=Ei;a.ShapeUtils=ge;a.ShortType=1011;a.Skeleton=Ue;a.SkeletonHelper=Rk;a.SkinnedMesh=Se;a.SmoothShading=2;a.Sphere=Be;a.SphereBufferGeometry=ug;a.SphereGeometry=ug;a.Spherical=Pl;a.SphericalHarmonics3=Lj;a.Spline=Qi;a.SplineCurve=td;a.SplineCurve3=Xj;a.SpotLight=ah;a.SpotLightHelper=Rl;a.Sprite=Qe;a.SpriteMaterial=pd;a.SrcAlphaFactor=204;a.SrcAlphaSaturateFactor=
210;a.SrcColorFactor=202;a.StaticCopyUsage=35046;a.StaticDrawUsage=35044;a.StaticReadUsage=35045;a.StereoCamera=Mj;a.StreamCopyUsage=35042;a.StreamDrawUsage=35040;a.StreamReadUsage=35041;a.StringKeyframeTrack=Xa;a.SubtractEquation=101;a.SubtractiveBlending=3;a.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3};a.TangentSpaceNormalMap=0;a.TetrahedronBufferGeometry=Ih;a.TetrahedronGeometry=Ih;a.TextBufferGeometry=Jh;a.TextGeometry=Jh;a.Texture=R;a.TextureLoader=Uc;a.TorusBufferGeometry=Kh;a.TorusGeometry=
Kh;a.TorusKnotBufferGeometry=Lh;a.TorusKnotGeometry=Lh;a.Triangle=xd;a.TriangleFanDrawMode=2;a.TriangleStripDrawMode=1;a.TrianglesDrawMode=0;a.TubeBufferGeometry=Mh;a.TubeGeometry=Mh;a.UVMapping=300;a.Uint16Attribute=function(c,f){console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead.");return new ta(c,f)};a.Uint16BufferAttribute=ta;a.Uint32Attribute=function(c,f){console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead.");
return new cb(c,f)};a.Uint32BufferAttribute=cb;a.Uint8Attribute=function(c,f){console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead.");return new V(c,f)};a.Uint8BufferAttribute=V;a.Uint8ClampedAttribute=function(c,f){console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead.");return new ca(c,f)};a.Uint8ClampedBufferAttribute=ca;a.Uniform=Lk;a.UniformsLib=zb;a.UniformsUtils=Dj;a.UnsignedByteType=1009;
a.UnsignedInt248Type=1020;a.UnsignedIntType=1014;a.UnsignedShort4444Type=1017;a.UnsignedShort5551Type=1018;a.UnsignedShort565Type=1019;a.UnsignedShortType=1012;a.VSMShadowMap=3;a.Vector2=ib;a.Vector3=da;a.Vector4=qc;a.VectorKeyframeTrack=La;a.Vertex=function(c,f,b){console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead.");return new da(c,f,b)};a.VertexColors=2;a.VideoTexture=We;a.WebGL1Renderer=sf;a.WebGLCubeRenderTarget=ai;a.WebGLMultisampleRenderTarget=nl;a.WebGLRenderTarget=pe;
a.WebGLRenderTargetCube=function(c,f,b){console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options ).");return new ai(c,b)};a.WebGLRenderer=qe;a.WebGLUtils=Zf;a.WireframeGeometry=hj;a.WireframeHelper=function(c,f){console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead.");return new Mc(new hj(c.geometry),new sc({color:void 0!==f?f:16777215}))};a.WrapAroundEnding=2402;a.XHRLoader=function(c){console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader.");
return new Wb(c)};a.ZeroCurvatureEnding=2400;a.ZeroFactor=200;a.ZeroSlopeEnding=2401;a.ZeroStencilOp=0;a.sRGBEncoding=3001;Object.defineProperty(a,"__esModule",{value:!0})});THREE.AmmoDebugConstants={NoDebug:0,DrawWireframe:1,DrawAabb:2,DrawFeaturesText:4,DrawContactPoints:8,NoDeactivation:16,NoHelpText:32,DrawText:64,ProfileTimings:128,EnableSatComparison:256,DisableBulletLCP:512,EnableCCD:1024,DrawConstraints:2048,DrawConstraintLimits:4096,FastWireframe:8192,DrawNormals:16384,DrawOnTop:32768,MAX_DEBUG_DRAW_MODE:4294967295};
THREE.AmmoDebugDrawer=function(a,e,h){this.scene=a;this.world=e;h=h||{};this.debugDrawMode=h.debugDrawMode||THREE.AmmoDebugConstants.DrawWireframe;a=this.debugDrawMode&THREE.AmmoDebugConstants.DrawOnTop||!1;e=h.maxBufferSize||1E6;this.geometry=new THREE.BufferGeometry;h=new Float32Array(3*e);e=new Float32Array(3*e);this.geometry.addAttribute("position",(new THREE.BufferAttribute(h,3)).setDynamic(!0));this.geometry.addAttribute("color",(new THREE.BufferAttribute(e,3)).setDynamic(!0));this.index=0;
h=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,depthTest:!a});this.mesh=new THREE.LineSegments(this.geometry,h);a&&(this.mesh.renderOrder=999);this.enabled=this.mesh.frustumCulled=!1;this.debugDrawer=new Ammo.DebugDrawer;this.debugDrawer.drawLine=this.drawLine.bind(this);this.debugDrawer.drawContactPoint=this.drawContactPoint.bind(this);this.debugDrawer.reportErrorWarning=this.reportErrorWarning.bind(this);this.debugDrawer.draw3dText=this.draw3dText.bind(this);this.debugDrawer.setDebugMode=
this.setDebugMode.bind(this);this.debugDrawer.getDebugMode=this.getDebugMode.bind(this);this.debugDrawer.enable=this.enable.bind(this);this.debugDrawer.disable=this.disable.bind(this);this.debugDrawer.update=this.update.bind(this);this.world.setDebugDrawer(this.debugDrawer)};THREE.AmmoDebugDrawer.prototype=function(){return this.debugDrawer};THREE.AmmoDebugDrawer.prototype.enable=function(){this.enabled=!0;this.scene.add(this.mesh)};
THREE.AmmoDebugDrawer.prototype.disable=function(){this.enabled=!1;this.scene.remove(this.mesh)};THREE.AmmoDebugDrawer.prototype.update=function(){this.enabled&&(0!=this.index&&(this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.color.needsUpdate=!0),this.index=0,this.world.debugDrawWorld(),this.geometry.setDrawRange(0,this.index))};
THREE.AmmoDebugDrawer.prototype.drawLine=function(a,e,h){var m=Ammo.HEAPF32,t=m[(h+0)/4],y=m[(h+4)/4];h=m[(h+8)/4];this.geometry.attributes.position.setXYZ(this.index,m[(a+0)/4],m[(a+4)/4],m[(a+8)/4]);this.geometry.attributes.color.setXYZ(this.index++,t,y,h);this.geometry.attributes.position.setXYZ(this.index,m[(e+0)/4],m[(e+4)/4],m[(e+8)/4]);this.geometry.attributes.color.setXYZ(this.index++,t,y,h)};
THREE.AmmoDebugDrawer.prototype.drawContactPoint=function(a,e,h,m,t){m=Ammo.HEAPF32;var y=m[(t+0)/4],C=m[(t+4)/4];t=m[(t+8)/4];var I=m[(a+0)/4],E=m[(a+4)/4];a=m[(a+8)/4];this.geometry.attributes.position.setXYZ(this.index,I,E,a);this.geometry.attributes.color.setXYZ(this.index++,y,C,t);this.geometry.attributes.position.setXYZ(this.index,I+m[(e+0)/4]*h,E+m[(e+4)/4]*h,a+m[(e+8)/4]*h);this.geometry.attributes.color.setXYZ(this.index++,y,C,t)};
THREE.AmmoDebugDrawer.prototype.reportErrorWarning=function(a){Ammo.hasOwnProperty("Pointer_stringify")?console.warn(Ammo.Pointer_stringify(a)):this.warnedOnce||(this.warnedOnce=!0,console.warn("Cannot print warningString, please rebuild Ammo.js using 'debug' flag"))};THREE.AmmoDebugDrawer.prototype.draw3dText=function(a,e){console.warn("TODO: draw3dText")};THREE.AmmoDebugDrawer.prototype.setDebugMode=function(a){this.debugDrawMode=a};THREE.AmmoDebugDrawer.prototype.getDebugMode=function(){return this.debugDrawMode};(function(a){function e(){const na=ca.call(this);na.templates=this.templates;return na}function h(na){if(na&&na.uniforms)for(let Ia in na.uniforms)na.uniforms[Ia].linked&&(this.uniforms[Ia]=na.uniforms[Ia]);return this}function m(na){a.Material.prototype.copy.call(this,na);this.fragmentShader=na.fragmentShader;this.vertexShader=na.vertexShader;this.uniforms=E(na.uniforms);this.defines=Object.assign({},na.defines);this.wireframe=na.wireframe;this.wireframeLinewidth=na.wireframeLinewidth;this.lights=
na.lights;this.clipping=na.clipping;this.skinning=na.skinning;this.morphTargets=na.morphTargets;this.morphNormals=na.morphNormals;this.extensions=na.extensions;na.customDepthMaterial&&(this.customDepthMaterial=na.customDepthMaterial.clone().link(this));na.customDistanceMaterial&&(this.customDistanceMaterial=na.customDistanceMaterial.clone().link(this));return this}function t(na){void 0===this.uniforms[na]&&(this.uniforms[na]={value:null});return this.uniforms[na]}function y(na,Ia){Ia=Ia||{};let Na=
{};const $a=Ia.template||Ia.extends,rb=new (Ia.class||(na.isMaterial&&na.constructor?na.constructor:null)||a.ShaderMaterial),lb=Ia.material=Ia.material||{},jb=Object.assign({},lb.defines);rb.templates=[Ia];na.templates instanceof Array&&(rb.templates=na.templates.concat(rb.templates));if(na instanceof Function){var yb=na.prototype.type;var wb=ta[yb];if(void 0===wb)return console.error('THREE.extendMaterial: no mapping for material class "%s" found',yb),rb;lb.lights=void 0===lb.lights?!0:lb.lights;
Na=ea(wb.name,Na,Ia);var Bb=a.ShaderChunk[wb.id+"_vert"];wb=a.ShaderChunk[wb.id+"_frag"]}else if(na.isShaderMaterial)yb=na.type,Na=E(na.uniforms,Na),Bb=na.vertexShader,wb=na.fragmentShader,rb.copy(na,!1),na.defines&&Object.assign(jb,na.defines);else{yb=na.type;var Tb=ta[yb];if(void 0===Tb)return console.error('THREE.extendMaterial: no mapping for material class "%s" found',yb),rb;lb.lights=void 0===lb.lights?!0:lb.lights;Na=ea(Tb.name,Na,Ia);Bb=a.ShaderChunk[Tb.id+"_vert"];wb=a.ShaderChunk[Tb.id+
"_frag"];Tb=a.ShaderLib[Tb.name].uniforms;for(let Ab in Tb)void 0!==Na[Ab]||void 0===na[Ab]||null===na[Ab]&&!1!==Ia.explicit||(Na[Ab]=Na[Ab]||{value:null},Na[Ab].value=na[Ab])}rb.isCustomMaterial&&(rb["is"+yb]=!0);Ia.defines&&Object.assign(jb,Ia.defines);yb=(Ia.header||"")+"\n";void 0!==Ia.vertex&&(Bb=H(Bb,Ia.vertex));void 0!==Ia.fragment&&(wb=H(wb,Ia.fragment));lb.defines=jb;lb.uniforms=Na;lb.vertexShader=yb+(Ia.vertexHeader||"")+"\n"+Bb;lb.fragmentShader=yb+(Ia.fragmentHeader||"")+"\n"+wb;Ia.vertexEnd&&
(lb.vertexShader=lb.vertexShader.replace(/\}(?=[^.]*$)/g,Ia.vertexEnd+"\n}"));Ia.fragmentEnd&&(lb.fragmentShader=lb.fragmentShader.replace(/\}(?=[^.]*$)/g,Ia.fragmentEnd+"\n}"));if(Ia.override)for(var Ob in Ia.override){Bb=Ia.override[Ob];wb=Na[Ob]=Na[Ob]||{value:null};for(let Ab in Bb)wb[Ab]=Bb[Ab];wb.mixed&&(Ia.uniforms||(Ia.uniforms={}),Ia.uniforms[Ob]=wb)}if($a&&$a.templates&&$a.templates.length){Ia.class=Ia.class||$a.class;for(let Ab of $a.templates)T(lb,Ab,W,jb);for(let Ab in $a.uniforms)Ob=
$a.uniforms[Ab],Ob.linked&&(Na[Ab]=Ob)}R(rb,Ia,lb,jb);rb.setValues(lb);if(rb.isCustomMaterial)for(let Ab in Na)Ya[Ab]&&Na[Ab].value&&(rb[Ab]=Na[Ab]);for(let Ab in jb)!1===jb[Ab]&&delete jb[Ab];!na.isMeshDepthMaterial&&na!==a.MeshDepthMaterial||void 0!==jb.DEPTH_PACKING||(jb.DEPTH_PACKING=a.RGBADepthPacking);return rb}function C(na,Ia){Ia=Ia||{};for(let Na in na){const $a=na[Na];$a&&($a.isColor||$a.isMatrix3||$a.isMatrix4||$a.isVector2||$a.isVector3||$a.isVector4||$a.isTexture)?Ia[Na]=$a.clone():Array.isArray($a)?
Ia[Na]=$a.slice():Ia[Na]=$a}return Ia}function I(na){return na&&void 0!==na.value?na:{value:na}}function E(na,Ia,Na=!1,$a=!1,rb=!1,lb=!1){Ia=Ia||{};for(let jb in na){const yb=na[jb];yb&&(!Na||null!==yb.value&&0!==yb.value)&&(yb.shared||yb.linked&&lb?Ia[jb]=yb:(Ia[jb]=C(yb),!0===$a&&(Ia[jb].shared=!0),!0===rb&&(Ia[jb].mixed=!0)))}return Ia}function H(na,Ia){for(let $a in Ia){const rb=Ia[$a];void 0!==Ka[$a]&&($a=Ka[$a]);if(rb instanceof Object)void 0===a.ShaderChunk[$a]?console.error('THREE.ShaderMaterial.extend: ShaderChunk "%s" not found',
$a):na=na.replace("#include <"+$a+">",H(a.ShaderChunk[$a],rb));else if("@"===$a[0]){var Na=$a.substr(1);na=na.replace(Na,rb)}else"?"===$a[0]?(Na=$a.substr(1),na=na.replace(Na,rb+"\n"+Na)):na?na=na.replace($a,$a+"\n"+rb):console.error("THREE.patchShader: chunk not found '%s'",$a)}return na}function O(na,Ia,Na,$a,rb){void 0!==Ya[na]&&Ia&&Ia.value&&(void 0!==rb[na]?rb[na]=Ia.value:Na[Ya[na]]=!0);na=cb[na];void 0===na||void 0!==na.not&&na.not===value||(Na[na.as]=Ia.value)}function R(na,Ia,Na,$a){if(Ia.uniforms&&
Na)for(let rb in Ia.uniforms){Na.uniforms[rb]||(Na.uniforms[rb]={});let lb=I(Ia.uniforms[rb]);$a&&!1===O(rb,lb,$a,Ia,na)||(Na.uniforms[rb]=lb)}}function W(na,Ia,Na){if(na.uniforms)for(let $a in na.uniforms){let rb=na.uniforms[$a];rb&&(rb=I(rb),rb.mixed&&void 0===Ia.uniforms[$a]&&(Ia.uniforms[$a]=rb.shared?rb:C(rb),Na&&O($a,rb,Na,na)))}}function ea(na,Ia,Na){if(!1===Na.explicit)return E(a.ShaderLib[na].uniforms,Ia);var $a=Na.uniforms;$a&&($a.envMap&&E(fa.envmap,Ia),$a.aoMap&&E(fa.aomap,Ia),$a.lightMap&&
E(fa.lightmap,Ia),$a.bumpMap&&E(fa.bumpmap,Ia),$a.normalMap&&E(fa.normalmap,Ia),$a.displacementMap&&E(fa.displacementmap,Ia),$a.clearcoatNormalMap&&E(fa.clearcoatnormalmap,Ia));!1!==Na.common&&E(fa.common,Ia);void 0!==gb[na]&&E(gb[na],Ia);na=Na.lights||(Na.material?Na.material.lights:null);(Na.fog||Na.material&&(Na.material.fog||Na.material.useFog))&&E(fa.fog,Ia);na&&(Na.use?(Na=Na.use,Na.indexOf("sharedLights"),na=-1<Na.indexOf("shadows"),-1<Na.indexOf("PointLight")&&(E(fa.lights.pointLights,Ia),
na&&(E(fa.pointLightShadows,Ia),E(fa.pointShadowMap,Ia),E(fa.pointShadowMatrix,Ia))),-1<Na.indexOf("SpotLight")&&(E(fa.lights.spotLights,Ia),na&&(E(fa.spotLightShadows,Ia),E(fa.spotShadowMap,Ia),E(fa.spotShadowMatrix,Ia))),-1<Na.indexOf("DirectionalLight")&&(E(fa.lights.directionalLights,Ia),na&&(E(fa.directionalLightShadows,Ia),E(fa.directionalShadowMap,Ia),E(fa.directionalShadowMatrix,Ia))),-1<Na.indexOf("LightProbe")&&E(fa.lights.lightProbe,Ia),-1<Na.indexOf("AmbientLight")&&E(fa.lights.ambientLightColor,
Ia),-1<Na.indexOf("ReactAreaLight")&&E(fa.lights.rectAreaLights,Ia),-1<Na.indexOf("HemisphereLight")&&E(fa.lights.hemisphereLights,Ia)):E(za,Ia));return Ia}function T(na,Ia,Na=R,$a=null){let rb=(Ia.header||"")+"\n",lb=(Ia.vertexHeader||"")+"\n"+na.vertexShader,jb=(Ia.fragmentHeader||"")+"\n"+na.fragmentShader;Ia.vertexEnd&&(lb=lb.replace(/\}(?=[^.]*$)/g,Ia.vertexEnd+"\n}"));Ia.fragmentEnd&&(jb=jb.replace(/\}(?=[^.]*$)/g,Ia.fragmentEnd+"\n}"));void 0!==Ia.vertex&&(lb=H(lb,Ia.vertex));void 0!==Ia.fragment&&
(jb=H(jb,Ia.fragment));na.vertexShader=rb+lb;na.fragmentShader=rb+jb;Na instanceof Function&&Na(Ia,na,$a);return na}const {UniformsLib:fa,Vector2:sa,Color:wa,TangentSpaceNormalMap:U,ShaderMaterial:qa,RawShaderMaterial:M}=a;fa.clearcoatnormalmap={clearcoatNormalScale:{value:new sa(1,1)}};var Q="MeshDistanceMaterial MeshMatcapMaterial ShadowMaterial SpriteMaterial RawShaderMaterial ShaderMaterial PointsMaterial MeshPhysicalMaterial MeshStandardMaterial MeshPhongMaterial MeshToonMaterial MeshNormalMaterial MeshLambertMaterial MeshDepthMaterial MeshBasicMaterial LineDashedMaterial LineBasicMaterial Material MeshFaceMaterial MultiMaterial PointCloudMaterial ParticleBasicMaterial ParticleSystemMaterial".split(" ");
for(var V of Q)void 0!==a[V]&&(Q=a[V].prototype,Q.type=V,Q.customDepthMaterial=null,Q.customDistanceMaterial=null,Q.templates=[]);const ca=a.ShaderMaterial.prototype.clone;Object.assign(M.prototype,{extend:y,uniform:t,clone:e,link:h,copy:m});Object.assign(qa.prototype,{extend:y,uniform:t,clone:e,link:h,copy:m});void 0!==a.ShaderMaterial.prototype.customDepthMaterial&&(V={_customDepthMaterial:{enumerable:!0,value:void 0,writable:!0},_customDistanceMaterial:{enumerable:!0,value:void 0,writable:!0},
customDepthMaterial:{get:function(){return this._customDepthMaterial||(this.material&&this.material.customDepthMaterial?this.material.customDepthMaterial:void 0)},set:function(na){this._customDepthMaterial=na}},customDistanceMaterial:{get:function(){return this._customDistanceMaterial||(this.material&&this.material.customDistanceMaterial?this.material.customDistanceMaterial:void 0)},set:function(na){this._customDistanceMaterial=na}}},Object.defineProperties(a.Mesh.prototype,V),Object.defineProperties(a.SkinnedMesh.prototype,
V));a.CustomMaterial=function(na){qa.call(this,na);this.type="CustomMaterial"};Object.assign(a.CustomMaterial.prototype,a.Material.prototype,a.ShaderMaterial.prototype,a.EventDispatcher.prototype,{isShaderMaterial:!0,isCustomMaterial:!0,isMeshPhongMaterial:!1,isMeshDistanceMaterial:!1,isMeshMatcapMaterial:!1,isShadowMaterial:!1,isSpriteMaterial:!1,isRawShaderMaterial:!1,isPointsMaterial:!1,isMeshPhysicalMaterial:!1,isMeshStandardMaterial:!1,isMeshPhongMaterial:!1,isMeshToonMaterial:!1,isMeshNormalMaterial:!1,
isMeshLambertMaterial:!1,isMeshDepthMaterial:!1,isMeshBasicMaterial:!1,isLineDashedMaterial:!1,isLineBasicMaterial:!1,isMaterial:!1,isMeshFaceMaterial:!1,isMultiMaterial:!1,isPointCloudMaterial:!1,isParticleBasicMaterial:!1,isParticleSystemMaterial:!1,constructor:a.CustomMaterial,map:null,aoMap:null,envMap:null,bumpMap:null,normalMap:null,lightMap:null,emissiveMap:null,specularMap:null,roughnessMap:null,metalnessMap:null,alphaMap:null,displacementMap:null,clearcoatMap:null,clearcoatRoughnessMap:null,
clearcoatNormalMap:null,normalMapType:U,combine:a.MultiplyOperation,clone:function(na){na=ca.call(this);this.map&&(na.map=this.map);this.aoMap&&(na.aoMap=this.aoMap);this.envMap&&(na.envMap=this.envMap);this.bumpMap&&(na.bumpMap=this.bumpMap);this.normalMap&&(na.normalMap=this.normalMap);this.lightMap&&(na.lightMap=this.lightMap);this.emissiveMap&&(na.emissiveMap=this.emissiveMap);this.specularMap&&(na.specularMap=this.specularMap);this.roughnessMap&&(na.roughnessMap=this.roughnessMap);this.metalnessMap&&
(na.metalnessMap=this.metalnessMap);this.alphaMap&&(na.alphaMap=this.alphaMap);this.displacementMap&&(na.displacementMap=this.displacementMap);this.clearcoatMap&&(na.clearcoatMap=this.clearcoatMap);this.clearcoatRoughnessMap&&(na.clearcoatRoughnessMap=this.clearcoatRoughnessMap);this.clearcoatNormalMap&&(na.clearcoatNormalMap=this.clearcoatNormalMap);na.templates=this.templates;return na}});Object.defineProperties(a.CustomMaterial.prototype,{specular:{get:function(){return this.uniforms.specular.value},
set:function(na){this.uniforms.specular.value=na}},shininess:{get:function(){return this.uniforms.shininess.value},set:function(na){this.uniforms.shininess.value=na}}});let za;const ta={MeshLambertMaterial:{id:"meshlambert",name:"lambert"},MeshBasicMaterial:{id:"meshbasic",name:"basic"},MeshStandardMaterial:{id:"meshphysical",name:"physical"},MeshPhongMaterial:{id:"meshphong",name:"phong"},MeshMatcapMaterial:{id:"meshmatcap",name:"matcap"},PointsMaterial:{id:"points",name:"points"},LineDashedMaterial:{id:"dashed",
name:"linedashed"},MeshDepthMaterial:{id:"depth",name:"depth"},MeshNormalMaterial:{id:"normal",name:"normal"},MeshDistanceMaterial:{id:"distanceRGBA",name:"distanceRGBA"},SpriteMaterial:{id:"sprite",name:"sprite"}},Ka={lightsBegin:"?#include <lights_fragment_maps>",lightsEnd:"?#include <aomap_fragment>",colorBegin:"?#include <logdepthbuf_fragment>",colorEnd:"?#include <tonemapping_fragment>",transformBegin:"?#include <morphtarget_vertex>",transformEnd:"?#include <project_vertex>"},cb={alphaTest:{as:"ALPHATEST",
not:0}};V={value:1};Q={value:new wa(1118481)};const gb={points:fa.points,sprite:fa.sprite,dashed:{scale:{value:1},dashSize:{value:1},totalSize:{value:2}},normal:{opacity:V},toon:{specular:Q,shininess:{value:30}},standard:{shininess:{value:30},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}},physical:{shininess:{value:30},roughness:{value:1},metalness:{value:.5},envMapIntensity:{value:1}},phong:{specular:Q,shininess:{value:30}},cube:{opacity:V},distanceRGBA:{nearDistance:{value:1},
farDistance:{value:1E3}},shadow:{opacity:V}},Ya={map:"USE_MAP",aoMap:"USE_AOMAP",envMap:"USE_ENVMAP",bumpMap:"USE_BUMPMAP",normalMap:"USE_NORMALMAP",lightMap:"USE_LIGHTMAP",emissiveMap:"USE_EMISSIVEMAP",specularMap:"USE_SPECULARMAP",roughnessMap:"USE_ROUGHNESSMAP",metalnessMap:"USE_METALNESSMAP",alphaMap:"USE_ALPHAMAP",displacementMap:"USE_DISPLACEMENTMAP"};za=E(fa.lights,{},!1,!0);a.cloneUniforms=E;a.cloneUniform=C;a.patchShader=T;a.mapShader=function(na,Ia){return a.ShaderChunk[ta[na].id+"_"+("vertex"===
Ia?"vert":"frag")]};a.extendMaterial=y})(THREE);THREE.Sky=function(){var a=THREE.Sky.SkyShader;a=new THREE.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:THREE.UniformsUtils.clone(a.uniforms),side:THREE.BackSide});THREE.Mesh.call(this,new THREE.SphereBufferGeometry(1,32,15),a)};THREE.Sky.prototype=Object.create(THREE.Mesh.prototype);
THREE.Sky.SkyShader={uniforms:{luminance:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new THREE.Vector3}},vertexShader:"uniform vec3 sunPosition;\nuniform float rayleigh;\nuniform float turbidity;\nuniform float mieCoefficient;\nvarying vec3 vWorldPosition;\nvarying vec3 vSunDirection;\nvarying float vSunfade;\nvarying vec3 vBetaR;\nvarying vec3 vBetaM;\nvarying float vSunE;\nconst vec3 up = vec3( 0.0, 1.0, 0.0 );\nconst float e = 2.71828182845904523536028747135266249775724709369995957;\nconst float pi = 3.141592653589793238462643383279502884197169;\nconst vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );\nconst vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );\nconst float v = 4.0;\nconst vec3 K = vec3( 0.686, 0.678, 0.666 );\nconst vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );\nconst float cutoffAngle = 1.6110731556870734;\nconst float steepness = 1.5;\nconst float EE = 1000.0;\nfloat sunIntensity( float zenithAngleCos ) {\n\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );\n\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );\n}\nvec3 totalMie( float T ) {\n\tfloat c = ( 0.2 * T ) * 10E-18;\n\treturn 0.434 * c * MieConst;\n}\nvoid main() {\n\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\tvWorldPosition = worldPosition.xyz;\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\tvSunDirection = normalize( sunPosition );\n\tvSunE = sunIntensity( dot( vSunDirection, up ) );\n\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );\n\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );\n\tvBetaR = totalRayleigh * rayleighCoefficient;\n\tvBetaM = totalMie( turbidity ) * mieCoefficient;\n}",
fragmentShader:"varying vec3 vWorldPosition;\nvarying vec3 vSunDirection;\nvarying float vSunfade;\nvarying vec3 vBetaR;\nvarying vec3 vBetaM;\nvarying float vSunE;\nuniform float luminance;\nuniform float mieDirectionalG;\nconst vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );\nconst float pi = 3.141592653589793238462643383279502884197169;\nconst float n = 1.0003;\nconst float N = 2.545E25;\nconst float rayleighZenithLength = 8.4E3;\nconst float mieZenithLength = 1.25E3;\nconst vec3 up = vec3( 0.0, 1.0, 0.0 );\nconst float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;\nconst float THREE_OVER_SIXTEENPI = 0.05968310365946075;\nconst float ONE_OVER_FOURPI = 0.07957747154594767;\nfloat rayleighPhase( float cosTheta ) {\n\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );\n}\nfloat hgPhase( float cosTheta, float g ) {\n\tfloat g2 = pow( g, 2.0 );\n\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );\n\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );\n}\nconst float A = 0.15;\nconst float B = 0.50;\nconst float C = 0.10;\nconst float D = 0.20;\nconst float E = 0.02;\nconst float F = 0.30;\nconst float whiteScale = 1.0748724675633854;\nvec3 Uncharted2Tonemap( vec3 x ) {\n\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;\n}\nvoid main() {\n\tfloat zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );\n\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );\n\tfloat sR = rayleighZenithLength * inverse;\n\tfloat sM = mieZenithLength * inverse;\n\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );\n\tfloat cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );\n\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );\n\tvec3 betaRTheta = vBetaR * rPhase;\n\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );\n\tvec3 betaMTheta = vBetaM * mPhase;\n\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );\n\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );\n\tvec3 direction = normalize( vWorldPosition - cameraPos );\n\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]\n\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]\n\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );\n\tvec3 L0 = vec3( 0.1 ) * Fex;\n\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );\n\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;\n\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );\n\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );\n\tvec3 color = curr * whiteScale;\n\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );\n\tgl_FragColor = vec4( retColor, 1.0 );\n}"};THREE.CopyShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float opacity;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\ngl_FragColor = opacity * texel;\n}"};THREE.EffectComposer=function(a,e){function h(){a.getDrawingBufferSize(t);y.setPixelRatio(a.getPixelRatio());y.setSize(t.x,t.y)}this.renderer=a;if(void 0===e){e={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1};var m=a.getSize(new THREE.Vector2);this._pixelRatio=a.getPixelRatio();this._width=m.width;this._height=m.height;e=new THREE.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,e);e.texture.name="EffectComposer.rt1"}else this._pixelRatio=
1,this._width=e.width,this._height=e.height;this.renderTarget1=e;this.renderTarget2=e.clone();this.renderTarget2.texture.name="EffectComposer.rt2";this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2;this.renderToScreen=!0;this.passes=[];void 0===THREE.CopyShader&&console.error("THREE.EffectComposer relies on THREE.CopyShader");void 0===THREE.ShaderPass&&console.error("THREE.EffectComposer relies on THREE.ShaderPass");this.copyPass=new THREE.ShaderPass(THREE.CopyShader);this.clock=
new THREE.Clock;var t=new THREE.Vector2,y=this;a.xr.addEventListener("sessionstart",h);a.xr.addEventListener("sessionend",h)};
Object.assign(THREE.EffectComposer.prototype,{swapBuffers:function(){var a=this.readBuffer;this.readBuffer=this.writeBuffer;this.writeBuffer=a},addPass:function(a){this.passes.push(a);a.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)},insertPass:function(a,e){this.passes.splice(e,0,a)},isLastEnabledPass:function(a){for(a+=1;a<this.passes.length;a++)if(this.passes[a].enabled)return!1;return!0},render:function(a){void 0===a&&(a=this.clock.getDelta());var e=this.renderer.getRenderTarget(),
h=!1,m=this.renderer.xr.enabled;!0===this.renderer.xr.enabled&&(this.renderer.xr.enabled=!1);var t,y=this.passes.length,C=!1;for(t=0;t<y;t++){var I=this.passes[t];if(!1!==I.enabled){I.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(t);I.render(this.renderer,this.writeBuffer,this.readBuffer,a,h);if(I.needsSwap){if(h){var E=this.renderer.getContext(),H=this.renderer.state.buffers.stencil;H.setFunc(E.NOTEQUAL,1,4294967295);this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,
a);H.setFunc(E.EQUAL,1,4294967295)}this.swapBuffers();C=!C}void 0!==THREE.MaskPass&&(I instanceof THREE.MaskPass?h=!0:I instanceof THREE.ClearMaskPass&&(h=!1))}}C&&this.swapBuffers();this.renderer.setRenderTarget(e);this.renderer.xr.enabled=m},reset:function(a){void 0===a&&(a=this.renderer.getSize(new THREE.Vector2),this._pixelRatio=this.renderer.getPixelRatio(),this._width=a.width,this._height=a.height,a=this.renderTarget1.clone(),a.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio));
this.renderTarget1.dispose();this.renderTarget2.dispose();this.renderTarget1=a;this.renderTarget2=a.clone();this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2},setSize:function(a,e){this._width=a;this._height=e;a=this._width*this._pixelRatio;e=this._height*this._pixelRatio;this.renderTarget1.setSize(a,e);this.renderTarget2.setSize(a,e);for(var h=0;h<this.passes.length;h++)this.passes[h].setSize(a,e)},setPixelRatio:function(a){this._pixelRatio=a;this.setSize(this._width,this._height)}});
THREE.Pass=function(){this.needsSwap=this.enabled=!0;this.renderToScreen=this.clear=!1};Object.assign(THREE.Pass.prototype,{setSize:function(a,e){},render:function(a,e,h,m,t){console.error("THREE.Pass: .render() must be implemented in derived pass.")}});
THREE.Pass.FullScreenQuad=function(){var a=new THREE.OrthographicCamera(-1,1,1,-1,0,1),e=new THREE.PlaneBufferGeometry(2,2),h=function(m){this._mesh=new THREE.Mesh(e,m)};Object.defineProperty(h.prototype,"material",{get:function(){return this._mesh.material},set:function(m){this._mesh.material=m}});Object.assign(h.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(m){m.render(this._mesh,a)}});return h}();THREE.FXAAShader={uniforms:{tDiffuse:{value:null},resolution:{value:new THREE.Vector2(1/1024,1/512)}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:'precision highp float;\n\nuniform sampler2D tDiffuse;\n\nuniform vec2 resolution;\n\nvarying vec2 vUv;\n\n// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)\n\n//----------------------------------------------------------------------------------\n// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag\n// SDK Version: v3.00\n// Email:       gameworks@nvidia.com\n// Site:        http://developer.nvidia.com/\n//\n// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.\n//\n// Redistribution and use in source and binary forms, with or without\n// modification, are permitted provided that the following conditions\n// are met:\n//  * Redistributions of source code must retain the above copyright\n//    notice, this list of conditions and the following disclaimer.\n//  * Redistributions in binary form must reproduce the above copyright\n//    notice, this list of conditions and the following disclaimer in the\n//    documentation and/or other materials provided with the distribution.\n//  * Neither the name of NVIDIA CORPORATION nor the names of its\n//    contributors may be used to endorse or promote products derived\n//    from this software without specific prior written permission.\n//\n// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS\'\' AND ANY\n// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR\n// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\n// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n//\n//----------------------------------------------------------------------------------\n\n#define FXAA_PC 1\n#define FXAA_GLSL_100 1\n#define FXAA_QUALITY_PRESET 12\n\n#define FXAA_GREEN_AS_LUMA 1\n\n/*--------------------------------------------------------------------------*/\n#ifndef FXAA_PC_CONSOLE\n    //\n    // The console algorithm for PC is included\n    // for developers targeting really low spec machines.\n    // Likely better to just run FXAA_PC, and use a really low preset.\n    //\n    #define FXAA_PC_CONSOLE 0\n#endif\n/*--------------------------------------------------------------------------*/\n#ifndef FXAA_GLSL_120\n    #define FXAA_GLSL_120 0\n#endif\n/*--------------------------------------------------------------------------*/\n#ifndef FXAA_GLSL_130\n    #define FXAA_GLSL_130 0\n#endif\n/*--------------------------------------------------------------------------*/\n#ifndef FXAA_HLSL_3\n    #define FXAA_HLSL_3 0\n#endif\n/*--------------------------------------------------------------------------*/\n#ifndef FXAA_HLSL_4\n    #define FXAA_HLSL_4 0\n#endif\n/*--------------------------------------------------------------------------*/\n#ifndef FXAA_HLSL_5\n    #define FXAA_HLSL_5 0\n#endif\n/*==========================================================================*/\n#ifndef FXAA_GREEN_AS_LUMA\n    //\n    // For those using non-linear color,\n    // and either not able to get luma in alpha, or not wanting to,\n    // this enables FXAA to run using green as a proxy for luma.\n    // So with this enabled, no need to pack luma in alpha.\n    //\n    // This will turn off AA on anything which lacks some amount of green.\n    // Pure red and blue or combination of only R and B, will get no AA.\n    //\n    // Might want to lower the settings for both,\n    //    fxaaConsoleEdgeThresholdMin\n    //    fxaaQualityEdgeThresholdMin\n    // In order to insure AA does not get turned off on colors\n    // which contain a minor amount of green.\n    //\n    // 1 = On.\n    // 0 = Off.\n    //\n    #define FXAA_GREEN_AS_LUMA 0\n#endif\n/*--------------------------------------------------------------------------*/\n#ifndef FXAA_EARLY_EXIT\n    //\n    // Controls algorithm\'s early exit path.\n    // On PS3 turning this ON adds 2 cycles to the shader.\n    // On 360 turning this OFF adds 10ths of a millisecond to the shader.\n    // Turning this off on console will result in a more blurry image.\n    // So this defaults to on.\n    //\n    // 1 = On.\n    // 0 = Off.\n    //\n    #define FXAA_EARLY_EXIT 1\n#endif\n/*--------------------------------------------------------------------------*/\n#ifndef FXAA_DISCARD\n    //\n    // Only valid for PC OpenGL currently.\n    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.\n    //\n    // 1 = Use discard on pixels which don\'t need AA.\n    //     For APIs which enable concurrent TEX+ROP from same surface.\n    // 0 = Return unchanged color on pixels which don\'t need AA.\n    //\n    #define FXAA_DISCARD 0\n#endif\n/*--------------------------------------------------------------------------*/\n#ifndef FXAA_FAST_PIXEL_OFFSET\n    //\n    // Used for GLSL 120 only.\n    //\n    // 1 = GL API supports fast pixel offsets\n    // 0 = do not use fast pixel offsets\n    //\n    #ifdef GL_EXT_gpu_shader4\n        #define FXAA_FAST_PIXEL_OFFSET 1\n    #endif\n    #ifdef GL_NV_gpu_shader5\n        #define FXAA_FAST_PIXEL_OFFSET 1\n    #endif\n    #ifdef GL_ARB_gpu_shader5\n        #define FXAA_FAST_PIXEL_OFFSET 1\n    #endif\n    #ifndef FXAA_FAST_PIXEL_OFFSET\n        #define FXAA_FAST_PIXEL_OFFSET 0\n    #endif\n#endif\n/*--------------------------------------------------------------------------*/\n#ifndef FXAA_GATHER4_ALPHA\n    //\n    // 1 = API supports gather4 on alpha channel.\n    // 0 = API does not support gather4 on alpha channel.\n    //\n    #if (FXAA_HLSL_5 == 1)\n        #define FXAA_GATHER4_ALPHA 1\n    #endif\n    #ifdef GL_ARB_gpu_shader5\n        #define FXAA_GATHER4_ALPHA 1\n    #endif\n    #ifdef GL_NV_gpu_shader5\n        #define FXAA_GATHER4_ALPHA 1\n    #endif\n    #ifndef FXAA_GATHER4_ALPHA\n        #define FXAA_GATHER4_ALPHA 0\n    #endif\n#endif\n\n\n/*============================================================================\n                        FXAA QUALITY - TUNING KNOBS\n------------------------------------------------------------------------------\nNOTE the other tuning knobs are now in the shader function inputs!\n============================================================================*/\n#ifndef FXAA_QUALITY_PRESET\n    //\n    // Choose the quality preset.\n    // This needs to be compiled into the shader as it effects code.\n    // Best option to include multiple presets is to\n    // in each shader define the preset, then include this file.\n    //\n    // OPTIONS\n    // -----------------------------------------------------------------------\n    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)\n    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)\n    // 39       - no dither, very expensive\n    //\n    // NOTES\n    // -----------------------------------------------------------------------\n    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)\n    // 13 = about same speed as FXAA 3.9 and better than 12\n    // 23 = closest to FXAA 3.9 visually and performance wise\n    //  _ = the lowest digit is directly related to performance\n    // _  = the highest digit is directly related to style\n    //\n    #define FXAA_QUALITY_PRESET 12\n#endif\n\n\n/*============================================================================\n\n                           FXAA QUALITY - PRESETS\n\n============================================================================*/\n\n/*============================================================================\n                     FXAA QUALITY - MEDIUM DITHER PRESETS\n============================================================================*/\n#if (FXAA_QUALITY_PRESET == 10)\n    #define FXAA_QUALITY_PS 3\n    #define FXAA_QUALITY_P0 1.5\n    #define FXAA_QUALITY_P1 3.0\n    #define FXAA_QUALITY_P2 12.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITY_PRESET == 11)\n    #define FXAA_QUALITY_PS 4\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 3.0\n    #define FXAA_QUALITY_P3 12.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITY_PRESET == 12)\n    #define FXAA_QUALITY_PS 5\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 4.0\n    #define FXAA_QUALITY_P4 12.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITY_PRESET == 13)\n    #define FXAA_QUALITY_PS 6\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 4.0\n    #define FXAA_QUALITY_P5 12.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITY_PRESET == 14)\n    #define FXAA_QUALITY_PS 7\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 4.0\n    #define FXAA_QUALITY_P6 12.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITY_PRESET == 15)\n    #define FXAA_QUALITY_PS 8\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 4.0\n    #define FXAA_QUALITY_P7 12.0\n#endif\n\n/*============================================================================\n                     FXAA QUALITY - LOW DITHER PRESETS\n============================================================================*/\n#if (FXAA_QUALITY_PRESET == 20)\n    #define FXAA_QUALITY_PS 3\n    #define FXAA_QUALITY_P0 1.5\n    #define FXAA_QUALITY_P1 2.0\n    #define FXAA_QUALITY_P2 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITY_PRESET == 21)\n    #define FXAA_QUALITY_PS 4\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITY_PRESET == 22)\n    #define FXAA_QUALITY_PS 5\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITY_PRESET == 23)\n    #define FXAA_QUALITY_PS 6\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITY_PRESET == 24)\n    #define FXAA_QUALITY_PS 7\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 3.0\n    #define FXAA_QUALITY_P6 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITY_PRESET == 25)\n    #define FXAA_QUALITY_PS 8\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 4.0\n    #define FXAA_QUALITY_P7 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITY_PRESET == 26)\n    #define FXAA_QUALITY_PS 9\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 4.0\n    #define FXAA_QUALITY_P8 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITY_PRESET == 27)\n    #define FXAA_QUALITY_PS 10\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 2.0\n    #define FXAA_QUALITY_P8 4.0\n    #define FXAA_QUALITY_P9 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITY_PRESET == 28)\n    #define FXAA_QUALITY_PS 11\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 2.0\n    #define FXAA_QUALITY_P8 2.0\n    #define FXAA_QUALITY_P9 4.0\n    #define FXAA_QUALITY_P10 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITY_PRESET == 29)\n    #define FXAA_QUALITY_PS 12\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 2.0\n    #define FXAA_QUALITY_P8 2.0\n    #define FXAA_QUALITY_P9 2.0\n    #define FXAA_QUALITY_P10 4.0\n    #define FXAA_QUALITY_P11 8.0\n#endif\n\n/*============================================================================\n                     FXAA QUALITY - EXTREME QUALITY\n============================================================================*/\n#if (FXAA_QUALITY_PRESET == 39)\n    #define FXAA_QUALITY_PS 12\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.0\n    #define FXAA_QUALITY_P2 1.0\n    #define FXAA_QUALITY_P3 1.0\n    #define FXAA_QUALITY_P4 1.0\n    #define FXAA_QUALITY_P5 1.5\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 2.0\n    #define FXAA_QUALITY_P8 2.0\n    #define FXAA_QUALITY_P9 2.0\n    #define FXAA_QUALITY_P10 4.0\n    #define FXAA_QUALITY_P11 8.0\n#endif\n\n\n\n/*============================================================================\n\n                                API PORTING\n\n============================================================================*/\n#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)\n    #define FxaaBool bool\n    #define FxaaDiscard discard\n    #define FxaaFloat float\n    #define FxaaFloat2 vec2\n    #define FxaaFloat3 vec3\n    #define FxaaFloat4 vec4\n    #define FxaaHalf float\n    #define FxaaHalf2 vec2\n    #define FxaaHalf3 vec3\n    #define FxaaHalf4 vec4\n    #define FxaaInt2 ivec2\n    #define FxaaSat(x) clamp(x, 0.0, 1.0)\n    #define FxaaTex sampler2D\n#else\n    #define FxaaBool bool\n    #define FxaaDiscard clip(-1)\n    #define FxaaFloat float\n    #define FxaaFloat2 float2\n    #define FxaaFloat3 float3\n    #define FxaaFloat4 float4\n    #define FxaaHalf half\n    #define FxaaHalf2 half2\n    #define FxaaHalf3 half3\n    #define FxaaHalf4 half4\n    #define FxaaSat(x) saturate(x)\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_GLSL_100 == 1)\n  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)\n  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_GLSL_120 == 1)\n    // Requires,\n    //  #version 120\n    // And at least,\n    //  #extension GL_EXT_gpu_shader4 : enable\n    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)\n    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)\n    #if (FXAA_FAST_PIXEL_OFFSET == 1)\n        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)\n    #else\n        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)\n    #endif\n    #if (FXAA_GATHER4_ALPHA == 1)\n        // use #extension GL_ARB_gpu_shader5 : enable\n        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\n        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\n        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)\n        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\n    #endif\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_GLSL_130 == 1)\n    // Requires "#version 130" or better\n    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)\n    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)\n    #if (FXAA_GATHER4_ALPHA == 1)\n        // use #extension GL_ARB_gpu_shader5 : enable\n        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\n        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\n        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)\n        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\n    #endif\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_HLSL_3 == 1)\n    #define FxaaInt2 float2\n    #define FxaaTex sampler2D\n    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))\n    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_HLSL_4 == 1)\n    #define FxaaInt2 int2\n    struct FxaaTex { SamplerState smpl; Texture2D tex; };\n    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\n    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_HLSL_5 == 1)\n    #define FxaaInt2 int2\n    struct FxaaTex { SamplerState smpl; Texture2D tex; };\n    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\n    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\n    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)\n    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)\n    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)\n    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)\n#endif\n\n\n/*============================================================================\n                   GREEN AS LUMA OPTION SUPPORT FUNCTION\n============================================================================*/\n#if (FXAA_GREEN_AS_LUMA == 0)\n    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }\n#else\n    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }\n#endif\n\n\n\n\n/*============================================================================\n\n                             FXAA3 QUALITY - PC\n\n============================================================================*/\n#if (FXAA_PC == 1)\n/*--------------------------------------------------------------------------*/\nFxaaFloat4 FxaaPixelShader(\n    //\n    // Use noperspective interpolation here (turn off perspective interpolation).\n    // {xy} = center of pixel\n    FxaaFloat2 pos,\n    //\n    // Used only for FXAA Console, and not used on the 360 version.\n    // Use noperspective interpolation here (turn off perspective interpolation).\n    // {xy_} = upper left of pixel\n    // {_zw} = lower right of pixel\n    FxaaFloat4 fxaaConsolePosPos,\n    //\n    // Input color texture.\n    // {rgb_} = color in linear or perceptual color space\n    // if (FXAA_GREEN_AS_LUMA == 0)\n    //     {__a} = luma in perceptual color space (not linear)\n    FxaaTex tex,\n    //\n    // Only used on the optimized 360 version of FXAA Console.\n    // For everything but 360, just use the same input here as for "tex".\n    // For 360, same texture, just alias with a 2nd sampler.\n    // This sampler needs to have an exponent bias of -1.\n    FxaaTex fxaaConsole360TexExpBiasNegOne,\n    //\n    // Only used on the optimized 360 version of FXAA Console.\n    // For everything but 360, just use the same input here as for "tex".\n    // For 360, same texture, just alias with a 3nd sampler.\n    // This sampler needs to have an exponent bias of -2.\n    FxaaTex fxaaConsole360TexExpBiasNegTwo,\n    //\n    // Only used on FXAA Quality.\n    // This must be from a constant/uniform.\n    // {x_} = 1.0/screenWidthInPixels\n    // {_y} = 1.0/screenHeightInPixels\n    FxaaFloat2 fxaaQualityRcpFrame,\n    //\n    // Only used on FXAA Console.\n    // This must be from a constant/uniform.\n    // This effects sub-pixel AA quality and inversely sharpness.\n    //   Where N ranges between,\n    //     N = 0.50 (default)\n    //     N = 0.33 (sharper)\n    // {x__} = -N/screenWidthInPixels\n    // {_y_} = -N/screenHeightInPixels\n    // {_z_} =  N/screenWidthInPixels\n    // {__w} =  N/screenHeightInPixels\n    FxaaFloat4 fxaaConsoleRcpFrameOpt,\n    //\n    // Only used on FXAA Console.\n    // Not used on 360, but used on PS3 and PC.\n    // This must be from a constant/uniform.\n    // {x__} = -2.0/screenWidthInPixels\n    // {_y_} = -2.0/screenHeightInPixels\n    // {_z_} =  2.0/screenWidthInPixels\n    // {__w} =  2.0/screenHeightInPixels\n    FxaaFloat4 fxaaConsoleRcpFrameOpt2,\n    //\n    // Only used on FXAA Console.\n    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.\n    // This must be from a constant/uniform.\n    // {x__} =  8.0/screenWidthInPixels\n    // {_y_} =  8.0/screenHeightInPixels\n    // {_z_} = -4.0/screenWidthInPixels\n    // {__w} = -4.0/screenHeightInPixels\n    FxaaFloat4 fxaaConsole360RcpFrameOpt2,\n    //\n    // Only used on FXAA Quality.\n    // This used to be the FXAA_QUALITY_SUBPIX define.\n    // It is here now to allow easier tuning.\n    // Choose the amount of sub-pixel aliasing removal.\n    // This can effect sharpness.\n    //   1.00 - upper limit (softer)\n    //   0.75 - default amount of filtering\n    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)\n    //   0.25 - almost off\n    //   0.00 - completely off\n    FxaaFloat fxaaQualitySubpix,\n    //\n    // Only used on FXAA Quality.\n    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.\n    // It is here now to allow easier tuning.\n    // The minimum amount of local contrast required to apply algorithm.\n    //   0.333 - too little (faster)\n    //   0.250 - low quality\n    //   0.166 - default\n    //   0.125 - high quality\n    //   0.063 - overkill (slower)\n    FxaaFloat fxaaQualityEdgeThreshold,\n    //\n    // Only used on FXAA Quality.\n    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.\n    // It is here now to allow easier tuning.\n    // Trims the algorithm from processing darks.\n    //   0.0833 - upper limit (default, the start of visible unfiltered edges)\n    //   0.0625 - high quality (faster)\n    //   0.0312 - visible limit (slower)\n    // Special notes when using FXAA_GREEN_AS_LUMA,\n    //   Likely want to set this to zero.\n    //   As colors that are mostly not-green\n    //   will appear very dark in the green channel!\n    //   Tune by looking at mostly non-green content,\n    //   then start at zero and increase until aliasing is a problem.\n    FxaaFloat fxaaQualityEdgeThresholdMin,\n    //\n    // Only used on FXAA Console.\n    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.\n    // It is here now to allow easier tuning.\n    // This does not effect PS3, as this needs to be compiled in.\n    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.\n    //   Due to the PS3 being ALU bound,\n    //   there are only three safe values here: 2 and 4 and 8.\n    //   These options use the shaders ability to a free *|/ by 2|4|8.\n    // For all other platforms can be a non-power of two.\n    //   8.0 is sharper (default!!!)\n    //   4.0 is softer\n    //   2.0 is really soft (good only for vector graphics inputs)\n    FxaaFloat fxaaConsoleEdgeSharpness,\n    //\n    // Only used on FXAA Console.\n    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.\n    // It is here now to allow easier tuning.\n    // This does not effect PS3, as this needs to be compiled in.\n    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.\n    //   Due to the PS3 being ALU bound,\n    //   there are only two safe values here: 1/4 and 1/8.\n    //   These options use the shaders ability to a free *|/ by 2|4|8.\n    // The console setting has a different mapping than the quality setting.\n    // Other platforms can use other values.\n    //   0.125 leaves less aliasing, but is softer (default!!!)\n    //   0.25 leaves more aliasing, and is sharper\n    FxaaFloat fxaaConsoleEdgeThreshold,\n    //\n    // Only used on FXAA Console.\n    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.\n    // It is here now to allow easier tuning.\n    // Trims the algorithm from processing darks.\n    // The console setting has a different mapping than the quality setting.\n    // This only applies when FXAA_EARLY_EXIT is 1.\n    // This does not apply to PS3,\n    // PS3 was simplified to avoid more shader instructions.\n    //   0.06 - faster but more aliasing in darks\n    //   0.05 - default\n    //   0.04 - slower and less aliasing in darks\n    // Special notes when using FXAA_GREEN_AS_LUMA,\n    //   Likely want to set this to zero.\n    //   As colors that are mostly not-green\n    //   will appear very dark in the green channel!\n    //   Tune by looking at mostly non-green content,\n    //   then start at zero and increase until aliasing is a problem.\n    FxaaFloat fxaaConsoleEdgeThresholdMin,\n    //\n    // Extra constants for 360 FXAA Console only.\n    // Use zeros or anything else for other platforms.\n    // These must be in physical constant registers and NOT immediates.\n    // Immediates will result in compiler un-optimizing.\n    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)\n    FxaaFloat4 fxaaConsole360ConstDir\n) {\n/*--------------------------------------------------------------------------*/\n    FxaaFloat2 posM;\n    posM.x = pos.x;\n    posM.y = pos.y;\n    #if (FXAA_GATHER4_ALPHA == 1)\n        #if (FXAA_DISCARD == 0)\n            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n            #if (FXAA_GREEN_AS_LUMA == 0)\n                #define lumaM rgbyM.w\n            #else\n                #define lumaM rgbyM.y\n            #endif\n        #endif\n        #if (FXAA_GREEN_AS_LUMA == 0)\n            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);\n            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));\n        #else\n            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);\n            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));\n        #endif\n        #if (FXAA_DISCARD == 1)\n            #define lumaM luma4A.w\n        #endif\n        #define lumaE luma4A.z\n        #define lumaS luma4A.x\n        #define lumaSE luma4A.y\n        #define lumaNW luma4B.w\n        #define lumaN luma4B.z\n        #define lumaW luma4B.x\n    #else\n        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n        #if (FXAA_GREEN_AS_LUMA == 0)\n            #define lumaM rgbyM.w\n        #else\n            #define lumaM rgbyM.y\n        #endif\n        #if (FXAA_GLSL_100 == 1)\n          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));\n          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));\n          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));\n          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));\n        #else\n          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));\n          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));\n          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));\n          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));\n        #endif\n    #endif\n/*--------------------------------------------------------------------------*/\n    FxaaFloat maxSM = max(lumaS, lumaM);\n    FxaaFloat minSM = min(lumaS, lumaM);\n    FxaaFloat maxESM = max(lumaE, maxSM);\n    FxaaFloat minESM = min(lumaE, minSM);\n    FxaaFloat maxWN = max(lumaN, lumaW);\n    FxaaFloat minWN = min(lumaN, lumaW);\n    FxaaFloat rangeMax = max(maxWN, maxESM);\n    FxaaFloat rangeMin = min(minWN, minESM);\n    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\n    FxaaFloat range = rangeMax - rangeMin;\n    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\n    FxaaBool earlyExit = range < rangeMaxClamped;\n/*--------------------------------------------------------------------------*/\n    if(earlyExit)\n        #if (FXAA_DISCARD == 1)\n            FxaaDiscard;\n        #else\n            return rgbyM;\n        #endif\n/*--------------------------------------------------------------------------*/\n    #if (FXAA_GATHER4_ALPHA == 0)\n        #if (FXAA_GLSL_100 == 1)\n          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));\n          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));\n          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));\n          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));\n        #else\n          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));\n          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));\n          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));\n          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n        #endif\n    #else\n        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));\n        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n    #endif\n/*--------------------------------------------------------------------------*/\n    FxaaFloat lumaNS = lumaN + lumaS;\n    FxaaFloat lumaWE = lumaW + lumaE;\n    FxaaFloat subpixRcpRange = 1.0/range;\n    FxaaFloat subpixNSWE = lumaNS + lumaWE;\n    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;\n    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat lumaNESE = lumaNE + lumaSE;\n    FxaaFloat lumaNWNE = lumaNW + lumaNE;\n    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\n    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat lumaNWSW = lumaNW + lumaSW;\n    FxaaFloat lumaSWSE = lumaSW + lumaSE;\n    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\n    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\n    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\n    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\n    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;\n    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;\n    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;\n    FxaaBool horzSpan = edgeHorz >= edgeVert;\n    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\n/*--------------------------------------------------------------------------*/\n    if(!horzSpan) lumaN = lumaW;\n    if(!horzSpan) lumaS = lumaE;\n    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;\n    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat gradientN = lumaN - lumaM;\n    FxaaFloat gradientS = lumaS - lumaM;\n    FxaaFloat lumaNN = lumaN + lumaM;\n    FxaaFloat lumaSS = lumaS + lumaM;\n    FxaaBool pairN = abs(gradientN) >= abs(gradientS);\n    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));\n    if(pairN) lengthSign = -lengthSign;\n    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);\n/*--------------------------------------------------------------------------*/\n    FxaaFloat2 posB;\n    posB.x = posM.x;\n    posB.y = posM.y;\n    FxaaFloat2 offNP;\n    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\n    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\n    if(!horzSpan) posB.x += lengthSign * 0.5;\n    if( horzSpan) posB.y += lengthSign * 0.5;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat2 posN;\n    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;\n    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;\n    FxaaFloat2 posP;\n    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;\n    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;\n    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;\n    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));\n    FxaaFloat subpixE = subpixC * subpixC;\n    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));\n/*--------------------------------------------------------------------------*/\n    if(!pairN) lumaNN = lumaSS;\n    FxaaFloat gradientScaled = gradient * 1.0/4.0;\n    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;\n    FxaaFloat subpixF = subpixD * subpixE;\n    FxaaBool lumaMLTZero = lumaMM < 0.0;\n/*--------------------------------------------------------------------------*/\n    lumaEndN -= lumaNN * 0.5;\n    lumaEndP -= lumaNN * 0.5;\n    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;\n    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;\n    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;\n    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;\n    FxaaBool doneNP = (!doneN) || (!doneP);\n    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;\n    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;\n/*--------------------------------------------------------------------------*/\n    if(doneNP) {\n        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n        doneN = abs(lumaEndN) >= gradientScaled;\n        doneP = abs(lumaEndP) >= gradientScaled;\n        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;\n        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;\n        doneNP = (!doneN) || (!doneP);\n        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;\n        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;\n/*--------------------------------------------------------------------------*/\n        #if (FXAA_QUALITY_PS > 3)\n        if(doneNP) {\n            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n            doneN = abs(lumaEndN) >= gradientScaled;\n            doneP = abs(lumaEndP) >= gradientScaled;\n            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;\n            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;\n            doneNP = (!doneN) || (!doneP);\n            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;\n            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;\n/*--------------------------------------------------------------------------*/\n            #if (FXAA_QUALITY_PS > 4)\n            if(doneNP) {\n                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                doneN = abs(lumaEndN) >= gradientScaled;\n                doneP = abs(lumaEndP) >= gradientScaled;\n                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;\n                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;\n                doneNP = (!doneN) || (!doneP);\n                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;\n                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;\n/*--------------------------------------------------------------------------*/\n                #if (FXAA_QUALITY_PS > 5)\n                if(doneNP) {\n                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                    doneN = abs(lumaEndN) >= gradientScaled;\n                    doneP = abs(lumaEndP) >= gradientScaled;\n                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;\n                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;\n                    doneNP = (!doneN) || (!doneP);\n                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;\n                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;\n/*--------------------------------------------------------------------------*/\n                    #if (FXAA_QUALITY_PS > 6)\n                    if(doneNP) {\n                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                        doneN = abs(lumaEndN) >= gradientScaled;\n                        doneP = abs(lumaEndP) >= gradientScaled;\n                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;\n                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;\n                        doneNP = (!doneN) || (!doneP);\n                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;\n                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;\n/*--------------------------------------------------------------------------*/\n                        #if (FXAA_QUALITY_PS > 7)\n                        if(doneNP) {\n                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                            doneN = abs(lumaEndN) >= gradientScaled;\n                            doneP = abs(lumaEndP) >= gradientScaled;\n                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;\n                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;\n                            doneNP = (!doneN) || (!doneP);\n                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;\n                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;\n/*--------------------------------------------------------------------------*/\n    #if (FXAA_QUALITY_PS > 8)\n    if(doneNP) {\n        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n        doneN = abs(lumaEndN) >= gradientScaled;\n        doneP = abs(lumaEndP) >= gradientScaled;\n        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;\n        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;\n        doneNP = (!doneN) || (!doneP);\n        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;\n        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;\n/*--------------------------------------------------------------------------*/\n        #if (FXAA_QUALITY_PS > 9)\n        if(doneNP) {\n            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n            doneN = abs(lumaEndN) >= gradientScaled;\n            doneP = abs(lumaEndP) >= gradientScaled;\n            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;\n            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;\n            doneNP = (!doneN) || (!doneP);\n            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;\n            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;\n/*--------------------------------------------------------------------------*/\n            #if (FXAA_QUALITY_PS > 10)\n            if(doneNP) {\n                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                doneN = abs(lumaEndN) >= gradientScaled;\n                doneP = abs(lumaEndP) >= gradientScaled;\n                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;\n                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;\n                doneNP = (!doneN) || (!doneP);\n                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;\n                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;\n/*--------------------------------------------------------------------------*/\n                #if (FXAA_QUALITY_PS > 11)\n                if(doneNP) {\n                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                    doneN = abs(lumaEndN) >= gradientScaled;\n                    doneP = abs(lumaEndP) >= gradientScaled;\n                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;\n                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;\n                    doneNP = (!doneN) || (!doneP);\n                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;\n                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;\n/*--------------------------------------------------------------------------*/\n                    #if (FXAA_QUALITY_PS > 12)\n                    if(doneNP) {\n                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                        doneN = abs(lumaEndN) >= gradientScaled;\n                        doneP = abs(lumaEndP) >= gradientScaled;\n                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;\n                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;\n                        doneNP = (!doneN) || (!doneP);\n                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;\n                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;\n/*--------------------------------------------------------------------------*/\n                    }\n                    #endif\n/*--------------------------------------------------------------------------*/\n                }\n                #endif\n/*--------------------------------------------------------------------------*/\n            }\n            #endif\n/*--------------------------------------------------------------------------*/\n        }\n        #endif\n/*--------------------------------------------------------------------------*/\n    }\n    #endif\n/*--------------------------------------------------------------------------*/\n                        }\n                        #endif\n/*--------------------------------------------------------------------------*/\n                    }\n                    #endif\n/*--------------------------------------------------------------------------*/\n                }\n                #endif\n/*--------------------------------------------------------------------------*/\n            }\n            #endif\n/*--------------------------------------------------------------------------*/\n        }\n        #endif\n/*--------------------------------------------------------------------------*/\n    }\n/*--------------------------------------------------------------------------*/\n    FxaaFloat dstN = posM.x - posN.x;\n    FxaaFloat dstP = posP.x - posM.x;\n    if(!horzSpan) dstN = posM.y - posN.y;\n    if(!horzSpan) dstP = posP.y - posM.y;\n/*--------------------------------------------------------------------------*/\n    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\n    FxaaFloat spanLength = (dstP + dstN);\n    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\n    FxaaFloat spanLengthRcp = 1.0/spanLength;\n/*--------------------------------------------------------------------------*/\n    FxaaBool directionN = dstN < dstP;\n    FxaaFloat dst = min(dstN, dstP);\n    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;\n    FxaaFloat subpixG = subpixF * subpixF;\n    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\n    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\n    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\n    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;\n    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;\n    #if (FXAA_DISCARD == 1)\n        return FxaaTexTop(tex, posM);\n    #else\n        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);\n    #endif\n}\n/*==========================================================================*/\n#endif\n\nvoid main() {\n  gl_FragColor = FxaaPixelShader(\n    vUv,\n    vec4(0.0),\n    tDiffuse,\n    tDiffuse,\n    tDiffuse,\n    resolution,\n    vec4(0.0),\n    vec4(0.0),\n    vec4(0.0),\n    0.75,\n    0.166,\n    0.0833,\n    0.0,\n    0.0,\n    0.0,\n    vec4(0.0)\n  );\n\n  // TODO avoid querying texture twice for same texel\n  gl_FragColor.a = texture2D(tDiffuse, vUv).a;\n}'};THREE.LuminosityHighPassShader={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new THREE.Color(0)},defaultOpacity:{value:0}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform vec3 defaultColor;\nuniform float defaultOpacity;\nuniform float luminosityThreshold;\nuniform float smoothWidth;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\nvec3 luma = vec3( 0.299, 0.587, 0.114 );\nfloat v = dot( texel.xyz, luma );\nvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\nfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\ngl_FragColor = mix( outputColor, texel, alpha );\n}"};THREE.MaskPass=function(a,e){THREE.Pass.call(this);this.scene=a;this.camera=e;this.clear=!0;this.inverse=this.needsSwap=!1};
THREE.MaskPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.MaskPass,render:function(a,e,h){var m=a.context,t=a.state;t.buffers.color.setMask(!1);t.buffers.depth.setMask(!1);t.buffers.color.setLocked(!0);t.buffers.depth.setLocked(!0);if(this.inverse){var y=0;var C=1}else y=1,C=0;t.buffers.stencil.setTest(!0);t.buffers.stencil.setOp(m.REPLACE,m.REPLACE,m.REPLACE);t.buffers.stencil.setFunc(m.ALWAYS,y,4294967295);t.buffers.stencil.setClear(C);a.setRenderTarget(h);this.clear&&
a.clear();a.render(this.scene,this.camera);a.setRenderTarget(e);this.clear&&a.clear();a.render(this.scene,this.camera);t.buffers.color.setLocked(!1);t.buffers.depth.setLocked(!1);t.buffers.stencil.setFunc(m.EQUAL,1,4294967295);t.buffers.stencil.setOp(m.KEEP,m.KEEP,m.KEEP)}});THREE.ClearMaskPass=function(){THREE.Pass.call(this);this.needsSwap=!1};THREE.ClearMaskPass.prototype=Object.create(THREE.Pass.prototype);Object.assign(THREE.ClearMaskPass.prototype,{render:function(a){a.state.buffers.stencil.setTest(!1)}});THREE.OutlinePass=function(a,e,h){this.renderScene=e;this.renderCamera=h;this.contouredObjects=[];this.invisibleObjects=[];this.edgeThickness=1;this.downSampleRatio=6;THREE.Pass.call(this);a||=new THREE.Vector2(256,256);e={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};h=Math.round(a.x/this.downSampleRatio);var m=Math.round(a.y/this.downSampleRatio);this.maskBufferMaterial=new THREE.MeshBasicMaterial({color:16777215});this.maskBufferMaterial.side=THREE.DoubleSide;
this.renderTargetMaskBuffer=new THREE.WebGLRenderTarget(a.x,a.y,e);this.renderTargetMaskBuffer.texture.name="OutlinePass.mask";this.renderTargetMaskBuffer.texture.generateMipmaps=!1;this.depthMaterial=new THREE.MeshDepthMaterial;this.depthMaterial.side=THREE.DoubleSide;this.depthMaterial.depthPacking=THREE.RGBADepthPacking;this.depthMaterial.blending=THREE.NoBlending;this.prepareMaskMaterial=this.getPrepareMaskMaterial();this.prepareMaskMaterial.side=THREE.DoubleSide;this.prepareMaskMaterial.uniforms.resolution.value=
new THREE.Vector2(a.x,a.y);this.renderTargetDepthBuffer=new THREE.WebGLRenderTarget(a.x,a.y,e);this.renderTargetDepthBuffer.texture.name="OutlinePass.depth";this.renderTargetDepthBuffer.texture.generateMipmaps=!1;this.renderTargetMaskDownSampleBuffer=new THREE.WebGLRenderTarget(h,m,e);this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample";this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1;this.renderTargetBlurBuffer=new THREE.WebGLRenderTarget(h,m,e);this.renderTargetBlurBuffer.texture.name=
"OutlinePass.blur";this.renderTargetBlurBuffer.texture.generateMipmaps=!1;this.edgeDetectionMaterial=this.getEdgeDetectionMaterial();this.renderTargetEdgeBuffer=new THREE.WebGLRenderTarget(h,m,e);this.renderTargetEdgeBuffer.texture.name="OutlinePass.edge";this.renderTargetEdgeBuffer.texture.generateMipmaps=!1;this.separableBlurMaterial=this.getSeperableBlurMaterial(4);this.separableBlurMaterial.uniforms.texSize.value=new THREE.Vector2(h,m);this.separableBlurMaterial.uniforms.kernelRadius.value=1;
this.overlayMaterial=this.getOverlayMaterial();void 0===THREE.CopyShader&&console.error("THREE.OutlinePass relies on THREE.CopyShader");a=THREE.CopyShader;this.copyUniforms=THREE.UniformsUtils.clone(a.uniforms);this.copyUniforms.opacity.value=1;this.materialCopy=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,blending:THREE.NoBlending,depthTest:!1,depthWrite:!1,transparent:!0});this.enabled=!0;this.needsSwap=!1;this.oldClearColor=new THREE.Color;
this.oldClearAlpha=1;this.fsQuad=new THREE.Pass.FullScreenQuad(null)};
THREE.OutlinePass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.OutlinePass,dispose:function(){this.renderTargetMaskBuffer.dispose();this.renderTargetDepthBuffer.dispose();this.renderTargetMaskDownSampleBuffer.dispose();this.renderTargetBlurBuffer.dispose();this.renderTargetEdgeBuffer.dispose()},setSize:function(a,e){this.renderTargetMaskBuffer.setSize(a,e);var h=Math.round(a/this.downSampleRatio),m=Math.round(e/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(h,
m);this.renderTargetBlurBuffer.setSize(h,m);this.renderTargetEdgeBuffer.setSize(h,m);this.prepareMaskMaterial.uniforms.resolution.value=new THREE.Vector2(a,e);this.separableBlurMaterial.uniforms.texSize.value=new THREE.Vector2(h,m)},changeVisibilityOfSelectedObjects:function(a){function e(m){m.isMesh&&(a?(m.visible=m.userData.oldVisible,delete m.userData.oldVisible):(m.userData.oldVisible=m.visible,m.visible=a))}for(var h=0;h<this.contouredObjects.length;h++)this.contouredObjects[h].traverse(e);for(h=
0;h<this.invisibleObjects.length;h++)this.invisibleObjects[h].traverse(e)},changeVisibilityOfNonContouredObjects:function(a){function e(t){t.isMesh&&h.push(t)}for(var h=[],m=0;m<this.contouredObjects.length;m++)this.contouredObjects[m].traverse(e);this.renderScene.traverse(function(t){if(t.isMesh||t.isLine||t.isSprite){for(var y=!1,C=0;C<h.length;C++)if(h[C].id===t.id){y=!0;break}if(!y){y=t.visible;if(!a||t.bVisible)t.visible=a;t.bVisible=y}}})},render:function(a,e,h,m,t){0<this.contouredObjects.length&&
(a.getClearColor(this.oldClearColor),this.oldClearAlpha=a.getClearAlpha(),e=a.autoClear,a.autoClear=!1,t&&a.state.buffers.stencil.setTest(!1),a.setClearColor(16777215,0),this.changeVisibilityOfSelectedObjects(!1),m=this.renderScene.background,this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,a.setRenderTarget(this.renderTargetDepthBuffer),a.clear(),a.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this.changeVisibilityOfNonContouredObjects(!1),
this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,a.setRenderTarget(this.renderTargetMaskBuffer),a.clear(),a.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonContouredObjects(!0),this.renderScene.background=m,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,a.setRenderTarget(this.renderTargetMaskDownSampleBuffer),
a.clear(),this.fsQuad.render(a),this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value=new THREE.Vector2(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),a.setRenderTarget(this.renderTargetEdgeBuffer),a.clear(),this.fsQuad.render(a),this.fsQuad.material=this.separableBlurMaterial,this.separableBlurMaterial.uniforms.colorTexture.value=
this.renderTargetEdgeBuffer.texture,this.separableBlurMaterial.uniforms.direction.value=THREE.OutlinePass.BlurDirectionX,this.separableBlurMaterial.uniforms.kernelRadius.value=this.edgeThickness,a.setRenderTarget(this.renderTargetBlurBuffer),a.clear(),this.fsQuad.render(a),this.separableBlurMaterial.uniforms.colorTexture.value=this.renderTargetBlurBuffer.texture,this.separableBlurMaterial.uniforms.direction.value=THREE.OutlinePass.BlurDirectionY,a.setRenderTarget(this.renderTargetEdgeBuffer),a.clear(),
this.fsQuad.render(a),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture.value=this.renderTargetEdgeBuffer.texture,t&&a.state.buffers.stencil.setTest(!0),a.setRenderTarget(h),this.fsQuad.render(a),a.setClearColor(this.oldClearColor,this.oldClearAlpha),a.autoClear=e);this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=h.texture,a.setRenderTarget(null),
this.fsQuad.render(a))},getPrepareMaskMaterial:function(){return new THREE.ShaderMaterial({uniforms:{depthTexture:{value:null},resolution:{value:new THREE.Vector2(1,1)}},vertexShader:"varying vec4 projTexCoord;\nvarying vec3 vColor;\nvoid main() {\n\tvColor = color;\n\tvec4 worldPosition = modelMatrix * vec4(position, 1.0);\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",fragmentShader:"#include <packing>\nvarying vec3 vColor;\nuniform sampler2D depthTexture;\nuniform vec2 resolution;\nvoid main() {\n\tfloat depth = unpackRGBAToDepth(texture2D(depthTexture, gl_FragCoord.xy / resolution));\n\tfloat depthTest = gl_FragCoord.z <= depth ? 1.0 : 0.5; // 0.5 shall represent hidden parts\n\tgl_FragColor = vec4(vColor, depthTest);\n}",
vertexColors:THREE.VertexColors})},getEdgeDetectionMaterial:function(){return new THREE.ShaderMaterial({uniforms:{maskTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\t\t\t\tuniform sampler2D maskTexture;\n\t\t\t\tuniform vec2 texSize;\n\t\t\t\t\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\n\t\t\t\t\tvec4 c0 = texture2D(maskTexture, vUv);\n\t\t\t\t\tvec4 c1 = texture2D(maskTexture, vUv + vec2(invSize.x, 0.0));\n\t\t\t\t\tvec4 c2 = texture2D(maskTexture, vUv - vec2(invSize.x, 0.0));\n\t\t\t\t\tvec4 c3 = texture2D(maskTexture, vUv + vec2(0.0, invSize.y));\n\t\t\t\t\tvec4 c4 = texture2D(maskTexture, vUv - vec2(0.0, invSize.y));\n\t\t\t\t\tfloat a1 = min(c1.a, c2.a);\n\t\t\t\t\tfloat a2 = min(c3.a, c4.a);\n\t\t\t\t\tfloat visibilityFactor = min(a1, a2) == 0.0 ? 0.0 : 1.0;\n\t\t\t\t\tgl_FragColor = vec4(c0.rgb, visibilityFactor);\n\t\t\t\t}"})},
getSeperableBlurMaterial:function(a){return new THREE.ShaderMaterial({defines:{MAX_RADIUS:a},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)},kernelRadius:{value:1}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\t\t\t\tuniform sampler2D colorTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\tuniform float kernelRadius;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp(-0.5 * x * x/(sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, kernelRadius);\t\t\t\t\tvec4 diffuseSum = texture2D(colorTexture, vUv) * weightSum;\t\t\t\t\tvec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);\t\t\t\t\tvec2 uvOffset = delta;\t\t\t\t\tfor(int i = 1; i <= MAX_RADIUS; i ++) {\t\t\t\t\t\tfloat w = gaussianPdf(uvOffset.x, kernelRadius);\t\t\t\t\t\tvec4 sample1 = texture2D(colorTexture, vUv + uvOffset);\t\t\t\t\t\tvec4 sample2 = texture2D(colorTexture, vUv - uvOffset);\t\t\t\t\t\tdiffuseSum += ((sample1 + sample2) * w);\t\t\t\t\t\tweightSum += (2.0 * w);\t\t\t\t\t\tuvOffset += delta;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = diffuseSum/weightSum;\t\t\t\t}"})},
getOverlayMaterial:function(){return new THREE.ShaderMaterial({uniforms:{maskTexture:{value:null},edgeTexture:{value:null}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\t\t\t\tuniform sampler2D maskTexture;\n\t\t\t\tuniform sampler2D edgeTexture;\n\t\t\t\t\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec4 edgeValue = texture2D(edgeTexture, vUv);\n\t\t\t\t\tvec4 maskColor = texture2D(maskTexture, vUv);\n\t\t\t\t\tif (maskColor.a != 1.0) discard;\n\t\t\t\t\tfloat opacityBoost = 3.0;\n\t\t\t\t\tgl_FragColor = vec4(maskColor.xyz, opacityBoost * (1.0 - edgeValue.a));\n\t\t\t\t}",
depthTest:!1,depthWrite:!1,transparent:!0})}});THREE.OutlinePass.BlurDirectionX=new THREE.Vector2(1,0);THREE.OutlinePass.BlurDirectionY=new THREE.Vector2(0,1);THREE.RenderPass=function(a,e,h,m,t){THREE.Pass.call(this);this.scene=a;this.camera=e;this.overrideMaterial=h;this.clearColor=m;this.clearAlpha=void 0!==t?t:0;this.clear=!0;this.needsSwap=this.clearDepth=!1};
THREE.RenderPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.RenderPass,render:function(a,e,h){e=a.autoClear;a.autoClear=!1;this.scene.overrideMaterial=this.overrideMaterial;if(this.clearColor){a.getClearColor(void 0);var m=a.getClearAlpha();a.setClearColor(this.clearColor,this.clearAlpha)}this.clearDepth&&a.clearDepth();a.setRenderTarget(this.renderToScreen?null:h);this.clear&&a.clear(a.autoClearColor,a.autoClearDepth,a.autoClearStencil);a.render(this.scene,this.camera);
this.clearColor&&a.setClearColor(void 0,m);this.scene.overrideMaterial=null;a.autoClear=e}});THREE.ShaderPass=function(a,e){THREE.Pass.call(this);this.textureID=void 0!==e?e:"tDiffuse";a instanceof THREE.ShaderMaterial?(this.uniforms=a.uniforms,this.material=a):a&&(this.uniforms=THREE.UniformsUtils.clone(a.uniforms),this.material=new THREE.ShaderMaterial({defines:Object.assign({},a.defines),uniforms:this.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader}));this.fsQuad=new THREE.Pass.FullScreenQuad(this.material)};
THREE.ShaderPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.ShaderPass,render:function(a,e,h){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=h.texture);this.fsQuad.material=this.material;this.renderToScreen?a.setRenderTarget(null):(a.setRenderTarget(e),this.clear&&a.clear(a.autoClearColor,a.autoClearDepth,a.autoClearStencil));this.fsQuad.render(a)}});THREE.UnrealBloomPass=function(a,e,h,m){THREE.Pass.call(this);this.strength=void 0!==e?e:1;this.radius=h;this.threshold=m;this.resolution=void 0!==a?new THREE.Vector2(a.x,a.y):new THREE.Vector2(256,256);this.clearColor=new THREE.Color(0,0,0);var t={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};this.renderTargetsHorizontal=[];this.renderTargetsVertical=[];this.nMips=5;a=Math.round(this.resolution.x/2);h=Math.round(this.resolution.y/2);this.renderTargetBright=new THREE.WebGLRenderTarget(a,
h,t);this.renderTargetBright.texture.name="UnrealBloomPass.bright";this.renderTargetBright.texture.generateMipmaps=!1;for(var y=0;y<this.nMips;y++){var C=new THREE.WebGLRenderTarget(a,h,t);C.texture.name="UnrealBloomPass.h"+y;C.texture.generateMipmaps=!1;this.renderTargetsHorizontal.push(C);C=new THREE.WebGLRenderTarget(a,h,t);C.texture.name="UnrealBloomPass.v"+y;C.texture.generateMipmaps=!1;this.renderTargetsVertical.push(C);a=Math.round(a/2);h=Math.round(h/2)}void 0===THREE.LuminosityHighPassShader&&
console.error("THREE.UnrealBloomPass relies on THREE.LuminosityHighPassShader");a=THREE.LuminosityHighPassShader;this.highPassUniforms=THREE.UniformsUtils.clone(a.uniforms);this.highPassUniforms.luminosityThreshold.value=m;this.highPassUniforms.smoothWidth.value=.01;this.materialHighPassFilter=new THREE.ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,defines:{}});this.separableBlurMaterials=[];m=[3,5,7,9,11];a=Math.round(this.resolution.x/
2);h=Math.round(this.resolution.y/2);for(y=0;y<this.nMips;y++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(m[y])),this.separableBlurMaterials[y].uniforms.texSize.value=new THREE.Vector2(a,h),a=Math.round(a/2),h=Math.round(h/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips);this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture;this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture;this.compositeMaterial.uniforms.blurTexture3.value=
this.renderTargetsVertical[2].texture;this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture;this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture;this.compositeMaterial.uniforms.bloomStrength.value=e;this.compositeMaterial.uniforms.bloomRadius.value=.1;this.compositeMaterial.needsUpdate=!0;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2];this.bloomTintColors=[new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,
1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1)];this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors;void 0===THREE.CopyShader&&console.error("THREE.UnrealBloomPass relies on THREE.CopyShader");e=THREE.CopyShader;this.copyUniforms=THREE.UniformsUtils.clone(e.uniforms);this.copyUniforms.opacity.value=1;this.materialCopy=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,blending:THREE.AdditiveBlending,depthTest:!1,
depthWrite:!1,transparent:!0});this.enabled=!0;this.needsSwap=!1;this.oldClearColor=new THREE.Color;this.oldClearAlpha=1;this.basic=new THREE.MeshBasicMaterial;this.fsQuad=new THREE.Pass.FullScreenQuad(null)};
THREE.UnrealBloomPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.UnrealBloomPass,dispose:function(){for(var a=0;a<this.renderTargetsHorizontal.length;a++)this.renderTargetsHorizontal[a].dispose();for(a=0;a<this.renderTargetsVertical.length;a++)this.renderTargetsVertical[a].dispose();this.renderTargetBright.dispose()},setSize:function(a,e){a=Math.round(a/2);e=Math.round(e/2);this.renderTargetBright.setSize(a,e);for(var h=0;h<this.nMips;h++)this.renderTargetsHorizontal[h].setSize(a,
e),this.renderTargetsVertical[h].setSize(a,e),this.separableBlurMaterials[h].uniforms.texSize.value=new THREE.Vector2(a,e),a=Math.round(a/2),e=Math.round(e/2)},render:function(a,e,h,m,t){a.getClearColor(this.oldClearColor);this.oldClearAlpha=a.getClearAlpha();e=a.autoClear;a.autoClear=!1;a.setClearColor(this.clearColor,0);t&&a.state.buffers.stencil.setTest(!1);this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=h.texture,a.setRenderTarget(null),a.clear(),this.fsQuad.render(a));this.highPassUniforms.tDiffuse.value=
h.texture;this.highPassUniforms.luminosityThreshold.value=this.threshold;this.fsQuad.material=this.materialHighPassFilter;a.setRenderTarget(this.renderTargetBright);a.clear();this.fsQuad.render(a);m=this.renderTargetBright;for(var y=0;y<this.nMips;y++)this.fsQuad.material=this.separableBlurMaterials[y],this.separableBlurMaterials[y].uniforms.colorTexture.value=m.texture,this.separableBlurMaterials[y].uniforms.direction.value=THREE.UnrealBloomPass.BlurDirectionX,a.setRenderTarget(this.renderTargetsHorizontal[y]),
a.clear(),this.fsQuad.render(a),this.separableBlurMaterials[y].uniforms.colorTexture.value=this.renderTargetsHorizontal[y].texture,this.separableBlurMaterials[y].uniforms.direction.value=THREE.UnrealBloomPass.BlurDirectionY,a.setRenderTarget(this.renderTargetsVertical[y]),a.clear(),this.fsQuad.render(a),m=this.renderTargetsVertical[y];this.fsQuad.material=this.compositeMaterial;this.compositeMaterial.uniforms.bloomStrength.value=this.strength;this.compositeMaterial.uniforms.bloomRadius.value=this.radius;
this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors;a.setRenderTarget(this.renderTargetsHorizontal[0]);a.clear();this.fsQuad.render(a);this.fsQuad.material=this.materialCopy;this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture;t&&a.state.buffers.stencil.setTest(!0);this.renderToScreen?a.setRenderTarget(null):a.setRenderTarget(h);this.fsQuad.render(a);a.setClearColor(this.oldClearColor,this.oldClearAlpha);a.autoClear=e},getSeperableBlurMaterial:function(a){return new THREE.ShaderMaterial({defines:{KERNEL_RADIUS:a,
SIGMA:a},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat fSigma = float(SIGMA);\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\t\t\t\t\t\tfloat x = float(i);\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\t\t\t\t\t\tweightSum += 2.0 * w;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})},
getCompositeMaterial:function(a){return new THREE.ShaderMaterial({defines:{NUM_MIPS:a},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",
fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D blurTexture1;\t\t\t\tuniform sampler2D blurTexture2;\t\t\t\tuniform sampler2D blurTexture3;\t\t\t\tuniform sampler2D blurTexture4;\t\t\t\tuniform sampler2D blurTexture5;\t\t\t\tuniform sampler2D dirtTexture;\t\t\t\tuniform float bloomStrength;\t\t\t\tuniform float bloomRadius;\t\t\t\tuniform float bloomFactors[NUM_MIPS];\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\t\t\t\t\t\t\t\tfloat lerpBloomFactor(const in float factor) { \t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\t\t\t\t}\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\t\t\t\t}"})}});
THREE.UnrealBloomPass.BlurDirectionX=new THREE.Vector2(1,0);THREE.UnrealBloomPass.BlurDirectionY=new THREE.Vector2(0,1);THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){try{return this.faces[this.face.toLowerCase()][this.weight][this.style]}catch(a){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing.";}},loadFace:function(a){var e=a.familyName.toLowerCase();this.faces[e]=this.faces[e]||{};this.faces[e][a.cssFontWeight]=this.faces[e][a.cssFontWeight]||{};this.faces[e][a.cssFontWeight][a.cssFontStyle]=a;return this.faces[e][a.cssFontWeight][a.cssFontStyle]=
a},drawText:function(a){var e=this.getFace(),h=this.size/e.resolution,m=0,t=String(a).split(""),y=t.length,C=[];for(a=0;a<y;a++){var I=new THREE.Path;I=this.extractGlyphPoints(t[a],e,h,m,I);m+=I.offset;C.push(I.path)}return{paths:C,offset:m/2}},extractGlyphPoints:function(a,e,h,m,t){var y=[],C=THREE.ShapeUtils.b2,I=THREE.ShapeUtils.b3,E,H,O=e.glyphs[a]||e.glyphs["?"];if(O){if(O.o){e=O._cachedOutline||(O._cachedOutline=O.o.split(" "));var R=e.length;for(a=0;a<R;){var W=e[a++];switch(W){case "m":W=
e[a++]*h+m;var ea=e[a++]*h;t.moveTo(W,ea);break;case "l":W=e[a++]*h+m;ea=e[a++]*h;t.lineTo(W,ea);break;case "q":W=e[a++]*h+m;ea=e[a++]*h;var T=e[a++]*h+m;var fa=e[a++]*h;t.quadraticCurveTo(T,fa,W,ea);if(E=y[y.length-1]){var sa=E.x;var wa=E.y;E=1;for(H=this.divisions;E<=H;E++){var U=E/H;C(U,sa,T,W);C(U,wa,fa,ea)}}break;case "b":W=e[a++]*h+m;ea=e[a++]*h;T=e[a++]*h+m;fa=e[a++]*h;var qa=e[a++]*h+m;var M=e[a++]*h;t.bezierCurveTo(T,fa,qa,M,W,ea);if(E=y[y.length-1])for(sa=E.x,wa=E.y,E=1,H=this.divisions;E<=
H;E++)U=E/H,I(U,sa,T,qa,W),I(U,wa,fa,M,ea)}}}return{offset:O.ha*h,path:t}}}};
THREE.FontUtils.generateShapes=function(a,e){e=e||{};var h=void 0!==e.curveSegments?e.curveSegments:4,m=void 0!==e.font?e.font:"helvetiker",t=void 0!==e.weight?e.weight:"normal",y=void 0!==e.style?e.style:"normal";THREE.FontUtils.size=void 0!==e.size?e.size:100;THREE.FontUtils.divisions=h;THREE.FontUtils.face=m;THREE.FontUtils.weight=t;THREE.FontUtils.style=y;a=THREE.FontUtils.drawText(a).paths;e=[];h=0;for(m=a.length;h<m;h++)Array.prototype.push.apply(e,a[h].toShapes());return e};
THREE.typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace};"undefined"!==typeof self&&(self._typeface_js=THREE.typeface_js);"undefined"!=typeof window&&function(a,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Hls=e():a.Hls=e()}(this,function(){return function(a){function e(m){if(h[m])return h[m].exports;var t=h[m]={i:m,l:!1,exports:{}};return a[m].call(t.exports,t,t.exports,e),t.l=!0,t.exports}var h={};return e.m=a,e.c=h,e.d=function(m,t,y){e.o(m,t)||Object.defineProperty(m,t,{enumerable:!0,get:y})},e.r=function(m){"undefined"!=
typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(m,Symbol.toStringTag,{value:"Module"});Object.defineProperty(m,"__esModule",{value:!0})},e.t=function(m,t){if((1&t&&(m=e(m)),8&t)||4&t&&"object"==typeof m&&m&&m.__esModule)return m;var y=Object.create(null);if(e.r(y),Object.defineProperty(y,"default",{enumerable:!0,value:m}),2&t&&"string"!=typeof m)for(var C in m)e.d(y,C,function(I){return m[I]}.bind(null,C));return y},e.n=function(m){var t=m&&m.__esModule?function(){return m.default}:function(){return m};
return e.d(t,"a",t),t},e.o=function(m,t){return Object.prototype.hasOwnProperty.call(m,t)},e.p="/dist/",e(e.s=20)}([function(a,e,h){var m;h.d(e,"a",function(){return m});(function(t){t.MEDIA_ATTACHING="hlsMediaAttaching";t.MEDIA_ATTACHED="hlsMediaAttached";t.MEDIA_DETACHING="hlsMediaDetaching";t.MEDIA_DETACHED="hlsMediaDetached";t.BUFFER_RESET="hlsBufferReset";t.BUFFER_CODECS="hlsBufferCodecs";t.BUFFER_CREATED="hlsBufferCreated";t.BUFFER_APPENDING="hlsBufferAppending";t.BUFFER_APPENDED="hlsBufferAppended";
t.BUFFER_EOS="hlsBufferEos";t.BUFFER_FLUSHING="hlsBufferFlushing";t.BUFFER_FLUSHED="hlsBufferFlushed";t.MANIFEST_LOADING="hlsManifestLoading";t.MANIFEST_LOADED="hlsManifestLoaded";t.MANIFEST_PARSED="hlsManifestParsed";t.LEVEL_SWITCHING="hlsLevelSwitching";t.LEVEL_SWITCHED="hlsLevelSwitched";t.LEVEL_LOADING="hlsLevelLoading";t.LEVEL_LOADED="hlsLevelLoaded";t.LEVEL_UPDATED="hlsLevelUpdated";t.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated";t.LEVELS_UPDATED="hlsLevelsUpdated";t.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated";
t.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching";t.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched";t.AUDIO_TRACK_LOADING="hlsAudioTrackLoading";t.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded";t.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated";t.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared";t.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch";t.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading";t.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded";t.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed";t.CUES_PARSED=
"hlsCuesParsed";t.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound";t.INIT_PTS_FOUND="hlsInitPtsFound";t.FRAG_LOADING="hlsFragLoading";t.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted";t.FRAG_LOADED="hlsFragLoaded";t.FRAG_DECRYPTED="hlsFragDecrypted";t.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment";t.FRAG_PARSING_USERDATA="hlsFragParsingUserdata";t.FRAG_PARSING_METADATA="hlsFragParsingMetadata";t.FRAG_PARSED="hlsFragParsed";t.FRAG_BUFFERED="hlsFragBuffered";t.FRAG_CHANGED=
"hlsFragChanged";t.FPS_DROP="hlsFpsDrop";t.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping";t.ERROR="hlsError";t.DESTROYING="hlsDestroying";t.KEY_LOADING="hlsKeyLoading";t.KEY_LOADED="hlsKeyLoaded";t.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached";t.BACK_BUFFER_REACHED="hlsBackBufferReached"})(m||={})},function(a,e,h){function m(E){if(self.console&&!0===E||"object"==typeof E){!function(H){for(var O=arguments.length,R=Array(1<O?O-1:0),W=1;W<O;W++)R[W-1]=arguments[W];R.forEach(function(ea){var T=
C;var fa=H[ea]?H[ea].bind(H):(fa=self.console[ea])?fa.bind(self.console,"["+ea+"] >"):t;T[ea]=fa})}(E,"debug","log","info","warn","error");try{C.log()}catch(H){C=y}}else C=y}h.d(e,"a",function(){return m});h.d(e,"b",function(){return I});var t=function(){},y={trace:t,debug:t,log:t,warn:t,info:t,error:t},C=y,I=y},function(a,e,h){var m,t;h.d(e,"b",function(){return m});h.d(e,"a",function(){return t});(function(y){y.NETWORK_ERROR="networkError";y.MEDIA_ERROR="mediaError";y.KEY_SYSTEM_ERROR="keySystemError";
y.MUX_ERROR="muxError";y.OTHER_ERROR="otherError"})(m||={});(function(y){y.KEY_SYSTEM_NO_KEYS="keySystemNoKeys";y.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess";y.KEY_SYSTEM_NO_SESSION="keySystemNoSession";y.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed";y.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData";y.MANIFEST_LOAD_ERROR="manifestLoadError";y.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut";y.MANIFEST_PARSING_ERROR="manifestParsingError";y.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError";
y.LEVEL_EMPTY_ERROR="levelEmptyError";y.LEVEL_LOAD_ERROR="levelLoadError";y.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut";y.LEVEL_SWITCH_ERROR="levelSwitchError";y.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError";y.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut";y.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError";y.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut";y.FRAG_LOAD_ERROR="fragLoadError";y.FRAG_LOAD_TIMEOUT="fragLoadTimeOut";y.FRAG_DECRYPT_ERROR="fragDecryptError";y.FRAG_PARSING_ERROR="fragParsingError";
y.REMUX_ALLOC_ERROR="remuxAllocError";y.KEY_LOAD_ERROR="keyLoadError";y.KEY_LOAD_TIMEOUT="keyLoadTimeOut";y.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError";y.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError";y.BUFFER_APPEND_ERROR="bufferAppendError";y.BUFFER_APPENDING_ERROR="bufferAppendingError";y.BUFFER_STALLED_ERROR="bufferStalledError";y.BUFFER_FULL_ERROR="bufferFullError";y.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole";y.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall";y.INTERNAL_EXCEPTION=
"internalException";y.INTERNAL_ABORTED="aborted";y.UNKNOWN="unknown"})(t||={})},function(a,e,h){h.d(e,"a",function(){return m});var m=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)};Number.MAX_SAFE_INTEGER},function(a,e,h){var m,t;h.d(e,"a",function(){return m});h.d(e,"b",function(){return t});(function(y){y.MANIFEST="manifest";y.LEVEL="level";y.AUDIO_TRACK="audioTrack";y.SUBTITLE_TRACK="subtitleTrack"})(m||={});(function(y){y.MAIN="main";y.AUDIO="audio";y.SUBTITLE="subtitle"})(t||=
{})},function(a,e,h){function m(fa,sa){fa.prototype=Object.create(sa.prototype);fa.prototype.constructor=fa;t(fa,sa)}function t(fa,sa){return(t=Object.setPrototypeOf||function(wa,U){return wa.__proto__=U,wa})(fa,sa)}function y(fa,sa){for(var wa=0;wa<sa.length;wa++){var U=sa[wa];U.enumerable=U.enumerable||!1;U.configurable=!0;"value"in U&&(U.writable=!0);Object.defineProperty(fa,U.key,U)}}function C(fa,sa,wa){return sa&&y(fa.prototype,sa),wa&&y(fa,wa),fa}h.d(e,"a",function(){return I});h.d(e,"b",function(){return ea});
h.d(e,"c",function(){return T});var I,E=h(3),H=h(11),O=h(1),R=h(17),W=h(12);!function(fa){fa.AUDIO="audio";fa.VIDEO="video";fa.AUDIOVIDEO="audiovideo"}(I||={});a=function(){function fa(sa){var wa;this._url=this._byteRange=null;this.relurl=void 0;this.elementaryStreams=((wa={})[I.AUDIO]=null,wa[I.VIDEO]=null,wa[I.AUDIOVIDEO]=null,wa);this.baseurl=sa}return fa.prototype.setByteRange=function(sa,wa){sa=sa.split("@",2);var U=[];1===sa.length?U[0]=wa?wa.byteRangeEndOffset:0:U[0]=parseInt(sa[1]);U[1]=parseInt(sa[0])+
U[0];this._byteRange=U},C(fa,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(H.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(sa){this._url=sa}}]),fa}();var ea=function(fa){function sa(U,qa){var M;return(M=
fa.call(this,qa)||this)._decryptdata=null,M.rawProgramDateTime=null,M.programDateTime=null,M.tagList=[],M.duration=0,M.sn=0,M.levelkey=void 0,M.type=void 0,M.loader=null,M.level=-1,M.cc=0,M.startPTS=void 0,M.endPTS=void 0,M.appendedPTS=void 0,M.startDTS=void 0,M.endDTS=void 0,M.start=0,M.deltaPTS=void 0,M.maxStartPTS=void 0,M.minEndPTS=void 0,M.stats=new W.a,M.urlId=0,M.data=void 0,M.bitrateTest=!1,M.title=null,M.initSegment=null,M.type=U,M}m(sa,fa);var wa=sa.prototype;return wa.createInitializationVector=
function(U){for(var qa=new Uint8Array(16),M=12;16>M;M++)qa[M]=U>>8*(15-M)&255;return qa},wa.setDecryptDataFromLevelKey=function(U,qa){var M=U;return"AES-128"===(null==U?void 0:U.method)&&U.uri&&!U.iv&&((M=R.a.fromURI(U.uri)).method=U.method,M.iv=this.createInitializationVector(qa),M.keyFormat="identity"),M},wa.setElementaryStreamInfo=function(U,qa,M,Q,V,ca){void 0===ca&&(ca=!1);var za=this.elementaryStreams,ta=za[U];ta?(ta.startPTS=Math.min(ta.startPTS,qa),ta.endPTS=Math.max(ta.endPTS,M),ta.startDTS=
Math.min(ta.startDTS,Q),ta.endDTS=Math.max(ta.endDTS,V)):za[U]={startPTS:qa,endPTS:M,startDTS:Q,endDTS:V,partial:ca}},wa.clearElementaryStreamInfo=function(){var U=this.elementaryStreams;U[I.AUDIO]=null;U[I.VIDEO]=null;U[I.AUDIOVIDEO]=null},C(sa,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var U=this.sn;"number"!=typeof U&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&O.b.warn('missing IV for initialization segment with method="'+
this.levelkey.method+'" - compliance issue'),U=0);this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,U)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime||!Object(E.a)(this.programDateTime))return null;var U=Object(E.a)(this.duration)?this.duration:0;return this.programDateTime+1E3*U}},{key:"encrypted",get:function(){var U;return!(null===(U=this.decryptdata)||void 0===U||!U.keyFormat||
!this.decryptdata.uri)}}]),sa}(a),T=function(fa){function sa(wa,U,qa,M,Q){(qa=fa.call(this,qa)||this).fragOffset=0;qa.duration=0;qa.gap=!1;qa.independent=!1;qa.relurl=void 0;qa.fragment=void 0;qa.index=void 0;qa.stats=new W.a;qa.duration=wa.decimalFloatingPoint("DURATION");qa.gap=wa.bool("GAP");qa.independent=wa.bool("INDEPENDENT");qa.relurl=wa.enumeratedString("URI");qa.fragment=U;qa.index=M;wa=wa.enumeratedString("BYTERANGE");return wa&&qa.setByteRange(wa,Q),Q&&(qa.fragOffset=Q.fragOffset+Q.duration),
qa}return m(sa,fa),C(sa,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var wa=this.elementaryStreams;return!!(wa.audio||wa.video||wa.audiovideo)}}]),sa}(a)},function(a,e,h){function m(U,qa){"data"in U&&(qa+=U.start,U=U.data);U=U[qa]<<24|U[qa+1]<<16|U[qa+2]<<8|U[qa+3];return 0>U?4294967296+U:U}function t(U,qa,M){"data"in U&&(qa+=U.start,U=U.data);U[qa]=M>>24;U[qa+1]=M>>16&255;U[qa+2]=
M>>8&255;U[qa+3]=255&M}function y(U,qa){var M,Q,V,ca=[];if(!qa.length)return ca;"data"in U?(M=U.data,Q=U.start,V=U.end):(Q=0,V=(M=U).byteLength);for(U=Q;U<V;)Q=m(M,U),Q=1<Q?U+Q:V,String.fromCharCode.apply(null,M.subarray(U+4,U+8))===qa[0]&&(1===qa.length?ca.push({data:M,start:U+8,end:Q}):(U=y({data:M,start:U+8,end:Q},qa.slice(1)),U.length&&wa.apply(ca,U))),U=Q;return ca}function C(U){var qa=y(U,["moov"])[0];qa=qa?qa.end:null;var M=y(U,["sidx"]);if(!M||!M[0])return null;U=[];M=M[0];var Q=M.data[0],
V=0===Q?8:16,ca=m(M,V);V=V+4+(0===Q?8:16)+2;var za=M.end+0;var ta=M;var Ka=V;"data"in ta&&(Ka+=ta.start,ta=ta.data);ta=ta[Ka]<<8|ta[Ka+1];ta=0>ta?65536+ta:ta;V+=2;for(Ka=0;Ka<ta;Ka++){var cb=m(M,V);V+=4;var gb=2147483647&cb;if(1===(2147483648&cb)>>>31)return console.warn("SIDX has hierarchical references (not supported)"),null;cb=m(M,V);V+=4;U.push({referenceSize:gb,subsegmentDuration:cb,info:{duration:cb/ca,start:za,end:za+gb-1}});za+=gb;V+=4}return{earliestPresentationTime:0,timescale:ca,version:Q,
referencesCount:ta,references:U,moovEndOffset:qa}}function I(U){for(var qa=[],M=y(U,["moov","trak"]),Q=0;Q<M.length;Q++){var V=M[Q],ca=y(V,["tkhd"])[0];if(ca){var za=ca.data[ca.start];za=0===za?12:20;ca=m(ca,za);var ta=y(V,["mdia","mdhd"])[0];if(ta&&(ta=m(ta,za=0===(za=ta.data[ta.start])?12:20),za=y(V,["mdia","hdlr"])[0])&&(za=String.fromCharCode.apply(null,za.data.subarray(za.start+8,za.start+12)),za={soun:fa.a.AUDIO,vide:fa.a.VIDEO}[za])){V=y(V,["mdia","minf","stbl","stsd"])[0];var Ka=void 0;V&&
(Ka=String.fromCharCode.apply(null,V.data.subarray(V.start+12,V.start+16)));qa[ca]={timescale:ta,type:za};qa[za]={timescale:ta,id:ca,codec:Ka}}}}return y(U,["moov","mvex","trex"]).forEach(function(cb){var gb=m(cb,4);(gb=qa[gb])&&(gb.default={duration:m(cb,12),flags:m(cb,20)})}),qa}function E(U,qa){return y(qa,["moof","traf"]).reduce(function(M,Q){var V=y(Q,["tfdt"])[0],ca=V.data[V.start];Q=y(Q,["tfhd"]).reduce(function(za,ta){ta=m(ta,4);if(ta=U[ta]){var Ka=m(V,4);1===ca&&(Ka*=Math.pow(2,32),Ka+=m(V,
8));ta=Ka/(ta.timescale||9E4);if(isFinite(ta)&&(null===za||ta<za))return ta}return za},null);return null!==Q&&isFinite(Q)&&(null===M||Q<M)?Q:M},null)||0}function H(U,qa){for(var M=0,Q=0,V=0,ca=y(U,["moof","traf"]),za=0;za<ca.length;za++){M=ca[za];var ta=y(M,["tfhd"])[0],Ka=qa[m(ta,4)];if(Ka){var cb=Ka.default,gb=m(ta,0)|(null==cb?NaN:cb.flags);cb=null==cb?void 0:cb.duration;8&gb&&(cb=m(ta,2&gb?12:8));ta=Ka.timescale||9E4;gb=y(M,["trun"]);for(var Ya=0;Ya<gb.length;Ya++)!(M=O(gb[Ya]))&&cb&&(M=cb*m(gb[Ya],
4)),Ka.type===fa.a.VIDEO?Q+=M/ta:Ka.type===fa.a.AUDIO&&(V+=M/ta)}}return 0===Q&&0===V&&(U=C(U),null!=U&&U.references)?U.references.reduce(function(na,Ia){return na+Ia.info.duration||0},0):Q||V}function O(U){var qa=m(U,0),M=8;1&qa&&(M+=4);4&qa&&(M+=4);for(var Q=0,V=m(U,4),ca=0;ca<V;ca++)256&qa&&(Q+=m(U,M),M+=4),512&qa&&(M+=4),1024&qa&&(M+=4),2048&qa&&(M+=4);return Q}function R(U,qa,M){y(qa,["moof","traf"]).forEach(function(Q){y(Q,["tfhd"]).forEach(function(V){V=m(V,4);if(V=U[V]){var ca=V.timescale||
9E4;y(Q,["tfdt"]).forEach(function(za){var ta=za.data[za.start],Ka=m(za,4);0===ta?t(za,4,Ka-M*ca):(Ka*=Math.pow(2,32),Ka+=m(za,8),Ka-=M*ca,Ka=Math.max(Ka,0),ta=Math.floor(Ka%(sa+1)),t(za,4,Math.floor(Ka/(sa+1))),t(za,8,ta))})}})})}function W(U){var qa={valid:null,remainder:null},M=y(U,["moof"]);if(!M)return qa;if(2>M.length)return qa.remainder=U,qa;M=M[M.length-1];return qa.valid=Object(T.a)(U,0,M.start-8),qa.remainder=Object(T.a)(U,M.start-8),qa}function ea(U,qa){var M=new Uint8Array(U.length+qa.length);
return M.set(U),M.set(qa,U.length),M}h.d(e,"b",function(){return y});h.d(e,"g",function(){return C});h.d(e,"f",function(){return I});h.d(e,"d",function(){return E});h.d(e,"c",function(){return H});h.d(e,"e",function(){return R});h.d(e,"h",function(){return W});h.d(e,"a",function(){return ea});var T=h(9),fa=h(5),sa=Math.pow(2,32)-1,wa=[].push},function(a,e,h){h.d(e,"b",function(){return C});h.d(e,"a",function(){return E});h.d(e,"d",function(){return H});h.d(e,"e",function(){return O});h.d(e,"c",function(){return R});
h.d(e,"f",function(){return W});var m,t=function(ea,T){return T+10<=ea.length&&73===ea[T]&&68===ea[T+1]&&51===ea[T+2]&&255>ea[T+3]&&255>ea[T+4]&&128>ea[T+6]&&128>ea[T+7]&&128>ea[T+8]&&128>ea[T+9]},y=function(ea,T){return T+10<=ea.length&&51===ea[T]&&68===ea[T+1]&&73===ea[T+2]&&255>ea[T+3]&&255>ea[T+4]&&128>ea[T+6]&&128>ea[T+7]&&128>ea[T+8]&&128>ea[T+9]},C=function(ea,T){for(var fa=T,sa=0;t(ea,T);)sa+=10,sa+=I(ea,T+6),y(ea,T+10)&&(sa+=10),T+=sa;if(0<sa)return ea.subarray(fa,fa+sa)},I=function(ea,T){var fa=
0;return fa=(127&ea[T])<<21,fa|=(127&ea[T+1])<<14,fa|=(127&ea[T+2])<<7,fa|127&ea[T+3]},E=function(ea,T){return t(ea,T)&&I(ea,T+6)+10<=ea.length-T},H=function(ea){ea=R(ea);for(var T=0;T<ea.length;T++){var fa=ea[T];if(O(fa))return 8===fa.data.byteLength?(T=new Uint8Array(fa.data),ea=1&T[3],fa=(T[4]<<23)+(T[5]<<15)+(T[6]<<7)+T[7],T=(fa/=45,ea&&(fa+=4.772185884E7),Math.round(fa))):T=void 0,T}},O=function(ea){return ea&&"PRIV"===ea.key&&"com.apple.streaming.transportStreamTimestamp"===ea.info},R=function(ea){for(var T=
0,fa=[];t(ea,T);){for(var sa=I(ea,T+6),wa=(T+=10)+sa;T+8<wa;){sa=ea.subarray(T);var U=String.fromCharCode(sa[0],sa[1],sa[2],sa[3]),qa=I(sa,4);U=sa={type:U,size:qa,data:sa.subarray(10,10+qa)};if("PRIV"===U.type)if(2>U.size)U=void 0;else{qa=W(U.data,!0);var M=new Uint8Array(U.data.subarray(qa.length+1));U={key:U.type,info:qa,data:M.buffer}}else"W"===U.type[0]?"WXXX"===U.type?2>U.size?U=void 0:(M=1,qa=W(U.data.subarray(M),!0),M+=qa.length+1,M=W(U.data.subarray(M)),U={key:U.type,info:qa,data:M}):(qa=
W(U.data),U={key:U.type,data:qa}):2>U.size?U=void 0:"TXXX"===U.type?(M=1,qa=W(U.data.subarray(M),!0),M+=qa.length+1,M=W(U.data.subarray(M)),U={key:U.type,info:qa,data:M}):(qa=W(U.data.subarray(1)),U={key:U.type,data:qa});U&&fa.push(U);T+=sa.size+10}y(ea,T)&&(T+=10)}return fa},W=function(ea,T){void 0===T&&(T=!1);var fa=(m||void 0===self.TextDecoder||(m=new self.TextDecoder("utf-8")),m);if(fa)return ea=fa.decode(ea),T?(T=ea.indexOf("\x00"),-1!==T?ea.substring(0,T):ea):ea.replace(/\0/g,"");for(var sa,
wa,U=ea.length,qa="",M=0;M<U&&(0!==(fa=ea[M++])||!T);)if(0!==fa&&3!==fa)switch(fa>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:qa+=String.fromCharCode(fa);break;case 12:case 13:sa=ea[M++];qa+=String.fromCharCode((31&fa)<<6|63&sa);break;case 14:sa=ea[M++],wa=ea[M++],qa+=String.fromCharCode((15&fa)<<12|(63&sa)<<6|(63&wa)<<0)}return qa}},function(a,e,h){function m(I,E,H,O){void 0===H&&(H=1);void 0===O&&(O=!1);I=I*E*H;return O?Math.round(I):I}function t(I,E,H,O){return void 0===H&&(H=1),
void 0===O&&(O=!1),m(I,E,1/H,O)}function y(I,E){return void 0===E&&(E=!1),m(I,1E3,1/9E4,E)}function C(I,E){return void 0===E&&(E=1),m(I,9E4,1/E)}h.d(e,"c",function(){return t});h.d(e,"b",function(){return y});h.d(e,"a",function(){return C})},function(a,e,h){function m(t,y,C){return Uint8Array.prototype.slice?t.slice(y,C):new Uint8Array(Array.prototype.slice.call(t,y,C))}h.d(e,"a",function(){return m})},function(a,e,h){function m(Ma,va){return 255===Ma[va]&&240==(246&Ma[va+1])}function t(Ma,va){return(3&
Ma[va+3])<<11|Ma[va+4]<<3|(224&Ma[va+5])>>>5}function y(Ma,va){if(va+1<Ma.length&&m(Ma,va)){var X=1&Ma[va+1]?7:9;if(va+X>=Ma.length)return!1;var aa=t(Ma,va);if(aa<=X)return!1;va+=aa;return va===Ma.length||va+1<Ma.length&&m(Ma,va)}return!1}function C(Ma,va,X,aa,ma){if(!Ma.samplerate){var Da,Ha,Sa,Fa=navigator.userAgent.toLowerCase(),ob=[96E3,88200,64E3,48E3,44100,32E3,24E3,22050,16E3,12E3,11025,8E3,7350];var mb=1+((192&X[aa+2])>>>6);var pb=(60&X[aa+2])>>>2;pb>ob.length-1?(va.trigger(M.a.ERROR,{type:Q.b.MEDIA_ERROR,
details:Q.a.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+pb}),va=void 0):va=(Ha=(1&X[aa+2])<<2,Ha|=(192&X[aa+3])>>>6,gb.b.log("manifest codec:"+ma+", ADTS type:"+mb+", samplingIndex:"+pb),/firefox/i.test(Fa)?6<=pb?(mb=5,Sa=Array(4),Da=pb-3):(mb=2,Sa=Array(2),Da=pb):-1!==Fa.indexOf("android")?(mb=2,Sa=Array(2),Da=pb):(mb=5,Sa=Array(4),ma&&(-1!==ma.indexOf("mp4a.40.29")||-1!==ma.indexOf("mp4a.40.5"))||!ma&&6<=pb?Da=pb-3:((ma&&-1!==ma.indexOf("mp4a.40.2")&&(6<=pb&&1===Ha||/vivaldi/i.test(Fa))||
!ma&&1===Ha)&&(mb=2,Sa=Array(2)),Da=pb)),Sa[0]=mb<<3,Sa[0]|=(14&pb)>>1,Sa[1]|=(1&pb)<<7,Sa[1]|=Ha<<3,5===mb&&(Sa[1]|=(14&Da)>>1,Sa[2]=(1&Da)<<7,Sa[2]|=8,Sa[3]=0),{config:Sa,samplerate:ob[pb],channelCount:Ha,codec:"mp4a.40."+mb,manifestCodec:ma});va&&(Ma.config=va.config,Ma.samplerate=va.samplerate,Ma.channelCount=va.channelCount,Ma.codec=va.codec,Ma.manifestCodec=va.manifestCodec,gb.b.log("parsed codec:"+Ma.codec+", rate:"+va.samplerate+", channels:"+va.channelCount))}}function I(Ma,va,X,aa,ma){var Da=
9216E4/Ma.samplerate,Ha=1&va[X+1]?7:9,Sa=t(va,X);var Fa=0<(Sa-=Ha)?{headerLength:Ha,frameLength:Sa,stamp:aa+ma*Da}:void 0;if(Fa){var ob;aa=Fa.headerLength;ma=Fa.stamp;Fa=aa+Fa.frameLength;(Da=Math.max(0,X+Fa-va.length))?(ob=new Uint8Array(Fa-aa)).set(va.subarray(X+aa,va.length),0):ob=va.subarray(X+aa,X+Fa);va={unit:ob,pts:ma};return Da||Ma.samples.push(va),{sample:va,length:Fa,missing:Da}}}function E(Ma,va){return(E=Object.setPrototypeOf||function(X,aa){return X.__proto__=aa,X})(Ma,va)}function H(Ma,
va,X,aa,ma){if(!(X+24>va.length)){var Da=O(va,X);if(Da&&X+Da.frameLength<=va.length)return aa+=9E4*Da.samplesPerFrame/Da.sampleRate*ma,va={unit:va.subarray(X,X+Da.frameLength),pts:aa,dts:aa},Ma.config=[],Ma.channelCount=Da.channelCount,Ma.samplerate=Da.sampleRate,Ma.samples.push(va),{sample:va,length:Da.frameLength,missing:0}}}function O(Ma,va){var X=Ma[va+1]>>3&3,aa=Ma[va+1]>>1&3,ma=Ma[va+2]>>4&15,Da=Ma[va+2]>>2&3;if(1!==X&&0!==ma&&15!==ma&&3!==Da){var Ha=Ma[va+3]>>6;ma=1E3*Ia[14*(3===X?3-aa:3===
aa?3:4)+ma-1];Da=Na[3*(3===X?0:2===X?1:2)+Da];var Sa=3===Ha?1:2,Fa=$a[X][aa],ob=rb[aa];X=8*Fa*ob;Fa=Math.floor(Fa*ma/Da+(Ma[va+2]>>1&1))*ob;null===na&&(na=(ob=(navigator.userAgent||"").match(/Chrome\/(\d+)/i))?parseInt(ob[1]):0);return!!na&&87>=na&&2===aa&&224E3<=ma&&0===Ha&&(Ma[va+3]|=128),{sampleRate:Da,channelCount:Sa,frameLength:Fa,samplesPerFrame:X}}}function R(Ma,va){return 255===Ma[va]&&224==(224&Ma[va+1])&&0!=(6&Ma[va+1])}function W(Ma,va,X,aa){return{key:Ma,frame:!1,pts:va,dts:X,units:[],
debug:aa,length:0}}function ea(Ma){var va,X,aa,ma,Da=0,Ha=Ma.data;if(!Ma||0===Ma.size)return null;for(;19>Ha[0].length&&1<Ha.length;){var Sa=new Uint8Array(Ha[0].length+Ha[1].length);Sa.set(Ha[0]);Sa.set(Ha[1],Ha[0].length);Ha[0]=Sa;Ha.splice(1,1)}if(1===((va=Ha[0])[0]<<16)+(va[1]<<8)+va[2]){if((X=(va[4]<<8)+va[5])&&X>Ma.size-6)return null;Sa=va[7];192&Sa&&(aa=536870912*(14&va[9])+4194304*(255&va[10])+16384*(254&va[11])+128*(255&va[12])+(254&va[13])/2,64&Sa?54E5<aa-(ma=536870912*(14&va[14])+4194304*
(255&va[15])+16384*(254&va[16])+128*(255&va[17])+(254&va[18])/2)&&(gb.b.warn(Math.round((aa-ma)/9E4)+"s delta between PTS and DTS, align them"),aa=ma):ma=aa);var Fa=(Sa=va[8])+9;if(Ma.size<=Fa)return null;Ma.size-=Fa;Ma=new Uint8Array(Ma.size);for(var ob=0,mb=Ha.length;ob<mb;ob++){var pb=(va=Ha[ob]).byteLength;if(Fa){if(Fa>pb){Fa-=pb;continue}va=va.subarray(Fa);pb-=Fa;Fa=0}Ma.set(va,Da);Da+=pb}return X&&(X-=Sa+3),{data:Ma,pts:aa,dts:ma,len:X}}return null}function T(Ma,va){if(Ma.units.length&&Ma.frame){if(void 0===
Ma.pts){var X=va.samples,aa=X.length;if(!aa)return void va.dropped++;X=X[aa-1];Ma.pts=X.pts;Ma.dts=X.dts}va.samples.push(Ma)}Ma.debug.length&&gb.b.log(Ma.pts+"/"+Ma.dts+":"+Ma.debug)}function fa(Ma,va){var X=Ma.length;if(0<X)if(va.pts>=Ma[X-1].pts)Ma.push(va);else for(--X;0<=X;X--){if(va.pts<Ma[X].pts){Ma.splice(X,0,va);break}}else Ma.push(va)}function sa(Ma){for(var va=Ma.byteLength,X=[],aa=1;aa<va-2;)0===Ma[aa]&&0===Ma[aa+1]&&3===Ma[aa+2]?(X.push(aa+2),aa+=2):aa++;if(0===X.length)return Ma;va-=
X.length;var ma=new Uint8Array(va),Da=0;for(aa=0;aa<va;Da++,aa++)Da===X[0]&&(Da++,X.shift()),ma[aa]=Ma[Da];return ma}function wa(Ma,va){return(wa=Object.setPrototypeOf||function(X,aa){return X.__proto__=aa,X})(Ma,va)}function U(Ma,va){return(Ma=null==Ma?void 0:Ma.codec)&&4<Ma.length?Ma:"hvc1"===Ma?"hvc1.1.c.L120.90":"av01"===Ma?"av01.0.04M.08":"avc1"===Ma||va===Bb.a.VIDEO?"avc1.42e01e":"mp4a.40.5"}function qa(Ma){return"then"in Ma&&Ma.then instanceof Function}h.d(e,"c",function(){return Sc});h.d(e,
"d",function(){return qa});h.d(e,"a",function(){return Je});h.d(e,"b",function(){return lf});var M=h(0),Q=h(2),V=h(15),ca=h(3),za=h(7),ta=h(6),Ka=h(9),cb=function(){function Ma(){this._id3Track=this._audioTrack=void 0;this.frameIndex=0;this.initPTS=this.cachedData=null}var va=Ma.prototype;return va.resetInitSegment=function(X,aa,ma){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9E4,sequenceNumber:0,samples:[],dropped:0}},va.resetTimeStamp=function(){},va.resetContiguity=function(){},va.canParse=
function(X,aa){return!1},va.appendFrame=function(X,aa,ma){},va.demux=function(X,aa){this.cachedData&&(X=Object(ta.a)(this.cachedData,X),this.cachedData=null);var ma,Da=za.b(X,0),Ha=Da?Da.length:0,Sa=this._audioTrack,Fa=this._id3Track,ob=Da?za.d(Da):void 0,mb=X.length;if(0===this.frameIndex||null===this.initPTS)this.initPTS=Object(ca.a)(ob)?90*ob:9E4*aa;Da&&0<Da.length&&Fa.samples.push({pts:this.initPTS,dts:this.initPTS,data:Da});for(aa=this.initPTS;Ha<mb;)this.canParse(X,Ha)?(ob=this.appendFrame(Sa,
X,Ha))?(this.frameIndex++,aa=ob.sample.pts,ma=Ha+=ob.length):Ha=mb:za.a(X,Ha)?(Da=za.b(X,Ha),Fa.samples.push({pts:aa,dts:aa,data:Da}),ma=Ha+=Da.length):Ha++,Ha===mb&&ma!==mb&&(ob=Object(Ka.a)(X,ma),this.cachedData?this.cachedData=Object(ta.a)(this.cachedData,ob):this.cachedData=ob);return{audioTrack:Sa,avcTrack:{type:"",id:-1,pid:-1,inputTimeScale:9E4,sequenceNumber:-1,samples:[],dropped:0},id3Track:Fa,textTrack:{type:"",id:-1,pid:-1,inputTimeScale:9E4,sequenceNumber:-1,samples:[],dropped:0}}},va.demuxSampleAes=
function(X,aa,ma){return Promise.reject(Error("["+this+"] This demuxer does not support Sample-AES decryption"))},va.flush=function(X){X=this.cachedData;return X&&(this.cachedData=null,this.demux(X,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:{type:"",id:-1,pid:-1,inputTimeScale:9E4,sequenceNumber:-1,samples:[],dropped:0},id3Track:this._id3Track,textTrack:{type:"",id:-1,pid:-1,inputTimeScale:9E4,sequenceNumber:-1,samples:[],dropped:0}}},va.destroy=function(){},Ma}(),gb=h(1);a=function(Ma){function va(aa,
ma){var Da;return(Da=Ma.call(this)||this).observer=void 0,Da.observer=aa,Da.config=ma,Da}va.prototype=Object.create(Ma.prototype);va.prototype.constructor=va;E(va,Ma);var X=va.prototype;return X.resetInitSegment=function(aa,ma,Da){Ma.prototype.resetInitSegment.call(this,aa,ma,Da);this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:aa,duration:Da,inputTimeScale:9E4,dropped:0}},va.probe=function(aa){if(!aa)return!1;for(var ma=(za.b(aa,
0)||[]).length,Da=aa.length;ma<Da;ma++)if(y(aa,ma))return gb.b.log("ADTS sync word found !"),!0;return!1},X.canParse=function(aa,ma){return ma+5<aa.length&&m(aa,ma)&&t(aa,ma)<=aa.length-ma},X.appendFrame=function(aa,ma,Da){C(aa,this.observer,ma,Da,aa.manifestCodec);if((aa=I(aa,ma,Da,this.initPTS,this.frameIndex))&&0===aa.missing)return aa},va}(cb);a.minProbeByteLength=9;var Ya=function(){function Ma(X,aa){this.remainderData=null;this.config=aa}var va=Ma.prototype;return va.resetTimeStamp=function(){},
va.resetInitSegment=function(){},va.resetContiguity=function(){},Ma.probe=function(X){return 0<Object(ta.b)({data:X,start:0,end:Math.min(X.length,16384)},["moof"]).length},va.demux=function(X){var aa=X,ma={type:"",id:-1,pid:-1,inputTimeScale:9E4,sequenceNumber:-1,samples:[],dropped:0};this.config.progressive?(this.remainderData&&(aa=Object(ta.a)(this.remainderData,X)),X=Object(ta.h)(aa),this.remainderData=X.remainder,ma.samples=X.valid||new Uint8Array):ma.samples=aa;return{audioTrack:{type:"",id:-1,
pid:-1,inputTimeScale:9E4,sequenceNumber:-1,samples:[],dropped:0},avcTrack:ma,id3Track:{type:"",id:-1,pid:-1,inputTimeScale:9E4,sequenceNumber:-1,samples:[],dropped:0},textTrack:{type:"",id:-1,pid:-1,inputTimeScale:9E4,sequenceNumber:-1,samples:[],dropped:0}}},va.flush=function(){var X={type:"",id:-1,pid:-1,inputTimeScale:9E4,sequenceNumber:-1,samples:[],dropped:0};return X.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:{type:"",id:-1,pid:-1,inputTimeScale:9E4,sequenceNumber:-1,
samples:[],dropped:0},avcTrack:X,id3Track:{type:"",id:-1,pid:-1,inputTimeScale:9E4,sequenceNumber:-1,samples:[],dropped:0},textTrack:{type:"",id:-1,pid:-1,inputTimeScale:9E4,sequenceNumber:-1,samples:[],dropped:0}}},va.demuxSampleAes=function(X,aa,ma){return Promise.reject(Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},va.destroy=function(){},Ma}();Ya.minProbeByteLength=1024;var na=null,Ia=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,
256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Na=[44100,48E3,32E3,22050,24E3,16E3,11025,12E3,8E3],$a=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],rb=[0,1,1,4],lb=function(){function Ma(X){this.bitsAvailable=this.word=this.bytesAvailable=this.data=void 0;this.data=X;this.bytesAvailable=X.byteLength;this.bitsAvailable=this.word=0}var va=Ma.prototype;return va.loadWord=function(){var X=
this.data,aa=this.bytesAvailable,ma=X.byteLength-aa,Da=new Uint8Array(4);aa=Math.min(4,aa);if(0===aa)throw Error("no bytes available");Da.set(X.subarray(ma,ma+aa));this.word=(new DataView(Da.buffer)).getUint32(0);this.bitsAvailable=8*aa;this.bytesAvailable-=aa},va.skipBits=function(X){var aa;this.bitsAvailable>X?(this.word<<=X,this.bitsAvailable-=X):(X-=this.bitsAvailable,X-=(aa=X>>3)>>3,this.bytesAvailable-=aa,this.loadWord(),this.word<<=X,this.bitsAvailable-=X)},va.readBits=function(X){var aa=Math.min(this.bitsAvailable,
X),ma=this.word>>>32-aa;return 32<X&&gb.b.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=aa,0<this.bitsAvailable?this.word<<=aa:0<this.bytesAvailable&&this.loadWord(),0<(aa=X-aa)&&this.bitsAvailable?ma<<aa|this.readBits(aa):ma},va.skipLZ=function(){var X;for(X=0;X<this.bitsAvailable;++X)if(0!=(this.word&2147483648>>>X))return this.word<<=X,this.bitsAvailable-=X,X;return this.loadWord(),X+this.skipLZ()},va.skipUEG=function(){this.skipBits(1+this.skipLZ())},va.skipEG=function(){this.skipBits(1+
this.skipLZ())},va.readUEG=function(){var X=this.skipLZ();return this.readBits(X+1)-1},va.readEG=function(){var X=this.readUEG();return 1&X?1+X>>>1:-1*(X>>>1)},va.readBoolean=function(){return 1===this.readBits(1)},va.readUByte=function(){return this.readBits(8)},va.readUShort=function(){return this.readBits(16)},va.readUInt=function(){return this.readBits(32)},va.skipScalingList=function(X){for(var aa=8,ma=8,Da=0;Da<X;Da++)0!==ma&&(ma=(aa+this.readEG()+256)%256),aa=0===ma?aa:ma},va.readSPS=function(){var X=
0,aa=0,ma=0,Da=0,Ha=this.readUByte.bind(this),Sa=this.readBits.bind(this),Fa=this.readUEG.bind(this),ob=this.readBoolean.bind(this),mb=this.skipBits.bind(this),pb=this.skipEG.bind(this),Kb=this.skipUEG.bind(this);var Mb=this.skipScalingList.bind(this);Ha();var Gb=Ha();if(Sa(5),mb(3),Ha(),Kb(),100===Gb||110===Gb||122===Gb||244===Gb||44===Gb||83===Gb||86===Gb||118===Gb||128===Gb)if(Gb=Fa(),3===Gb&&mb(1),Kb(),Kb(),mb(1),ob()){var Ub=3!==Gb?8:12;for(Gb=0;Gb<Ub;Gb++)ob()&&Mb(6>Gb?16:64)}Kb();Mb=Fa();if(0===
Mb)Fa();else if(1===Mb)for(mb(1),pb(),pb(),Mb=Fa(),Gb=0;Gb<Mb;Gb++)pb();Kb();mb(1);pb=Fa();Kb=Fa();Sa=Sa(1);0===Sa&&mb(1);mb(1);ob()&&(X=Fa(),aa=Fa(),ma=Fa(),Da=Fa());Fa=[1,1];if(ob()&&ob())switch(Ha()){case 1:Fa=[1,1];break;case 2:Fa=[12,11];break;case 3:Fa=[10,11];break;case 4:Fa=[16,11];break;case 5:Fa=[40,33];break;case 6:Fa=[24,11];break;case 7:Fa=[20,11];break;case 8:Fa=[32,11];break;case 9:Fa=[80,33];break;case 10:Fa=[18,11];break;case 11:Fa=[15,11];break;case 12:Fa=[64,33];break;case 13:Fa=
[160,99];break;case 14:Fa=[4,3];break;case 15:Fa=[3,2];break;case 16:Fa=[2,1];break;case 255:Fa=[Ha()<<8|Ha(),Ha()<<8|Ha()]}return{width:Math.ceil(16*(pb+1)-2*X-2*aa),height:(2-Sa)*(Kb+1)*16-(Sa?2:4)*(ma+Da),pixelRatio:Fa}},va.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},Ma}(),jb=function(){function Ma(X,aa,ma){this.decrypter=void 0;this.keyData=ma;this.decrypter=new V.a(X,aa,{removePKCS7Padding:!1})}var va=Ma.prototype;return va.decryptBuffer=function(X,aa){this.decrypter.decrypt(X,
this.keyData.key.buffer,this.keyData.iv.buffer,aa)},va.decryptAacSample=function(X,aa,ma,Da){var Ha=X[aa].unit,Sa=Ha.subarray(16,Ha.length-Ha.length%16);Sa=Sa.buffer.slice(Sa.byteOffset,Sa.byteOffset+Sa.length);var Fa=this;this.decryptBuffer(Sa,function(ob){ob=new Uint8Array(ob);Ha.set(ob,16);Da||Fa.decryptAacSamples(X,aa+1,ma)})},va.decryptAacSamples=function(X,aa,ma){for(;;aa++){if(aa>=X.length)return void ma();if(!(32>X[aa].unit.length)){var Da=this.decrypter.isSync();if(this.decryptAacSample(X,
aa,ma,Da),!Da)break}}},va.getAvcEncryptedData=function(X){for(var aa=new Int8Array(16*Math.floor((X.length-48)/160)+16),ma=0,Da=32;Da<X.length-16;Da+=160,ma+=16)aa.set(X.subarray(Da,Da+16),ma);return aa},va.getAvcDecryptedUnit=function(X,aa){aa=new Uint8Array(aa);for(var ma=0,Da=32;Da<X.length-16;Da+=160,ma+=16)X.set(aa.subarray(ma,ma+16),Da);return X},va.decryptAvcSample=function(X,aa,ma,Da,Ha,Sa){var Fa=sa(Ha.data),ob=this.getAvcEncryptedData(Fa),mb=this;this.decryptBuffer(ob.buffer,function(pb){Ha.data=
mb.getAvcDecryptedUnit(Fa,pb);Sa||mb.decryptAvcSamples(X,aa,ma+1,Da)})},va.decryptAvcSamples=function(X,aa,ma,Da){if(X instanceof Uint8Array)throw Error("Cannot decrypt samples of type Uint8Array");for(;;aa++,ma=0){if(aa>=X.length)return void Da();for(var Ha=X[aa].units;!(ma>=Ha.length);ma++){var Sa=Ha[ma];if(!(48>=Sa.data.length||1!==Sa.type&&5!==Sa.type)){var Fa=this.decrypter.isSync();if(this.decryptAvcSample(X,aa,ma,Da,Sa,Fa),!Fa)return}}}},Ma}(),yb={video:1,audio:2,id3:3,text:4};e=function(){function Ma(X,
aa,ma){this.sampleAes=null;this.pmtParsed=!1;this.videoCodec=this.audioCodec=void 0;this._duration=0;this._initDTS=this._initPTS=this.aacLastPTS=null;this._pmtId=-1;this._txtTrack=this._id3Track=this._audioTrack=this._avcTrack=void 0;this.remainderData=this.avcSample=this.aacOverFlow=null;this.observer=X;this.config=aa;this.typeSupported=ma}Ma.probe=function(X){X=Ma.syncOffset(X);return!(0>X)&&(X&&gb.b.warn("MPEG2-TS detected but first sync word found @ offset "+X+", junk ahead ?"),!0)};Ma.syncOffset=
function(X){for(var aa=Math.min(1E3,X.length-564),ma=0;ma<aa;){if(71===X[ma]&&71===X[ma+188]&&71===X[ma+376])return ma;ma++}return-1};Ma.createTrack=function(X,aa){return{container:"video"===X||"audio"===X?"video/mp2t":void 0,type:X,id:yb[X],pid:-1,inputTimeScale:9E4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===X?aa:void 0}};var va=Ma.prototype;return va.resetInitSegment=function(X,aa,ma){this.pmtParsed=!1;this._pmtId=-1;this._avcTrack=Ma.createTrack("video",ma);this._audioTrack=Ma.createTrack("audio",
ma);this._id3Track=Ma.createTrack("id3",ma);this._txtTrack=Ma.createTrack("text",ma);this._audioTrack.isAAC=!0;this.avcSample=this.aacLastPTS=this.aacOverFlow=null;this.audioCodec=X;this.videoCodec=aa;this._duration=ma},va.resetTimeStamp=function(){},va.resetContiguity=function(){var X=this._audioTrack,aa=this._avcTrack,ma=this._id3Track;X&&(X.pesData=null);aa&&(aa.pesData=null);ma&&(ma.pesData=null);this.aacLastPTS=this.aacOverFlow=null},va.demux=function(X,aa,ma,Da){var Ha;void 0===ma&&(ma=!1);
void 0===Da&&(Da=!1);ma||(this.sampleAes=null);aa=this._avcTrack;var Sa=this._audioTrack,Fa=this._id3Track,ob=aa.pid,mb=aa.pesData,pb=Sa.pid,Kb=Fa.pid,Mb=Sa.pesData,Gb=Fa.pesData,Ub=!1,Cc=this.pmtParsed,id=this._pmtId,Yc=X.length;if(this.remainderData&&(Yc=(X=Object(ta.a)(this.remainderData,X)).length,this.remainderData=null),188>Yc&&!Da)return this.remainderData=X,{audioTrack:Sa,avcTrack:aa,id3Track:Fa,textTrack:this._txtTrack};var zd=Math.max(0,Ma.syncOffset(X));(Yc-=(Yc+zd)%188)<X.byteLength&&
!Da&&(this.remainderData=new Uint8Array(X.buffer,Yc,X.buffer.byteLength-Yc));for(var Zc=0,oc=zd;oc<Yc;oc+=188)if(71===X[oc]){var pc=!!(64&X[oc+1]),le=((31&X[oc+1])<<8)+X[oc+2],kc;if(1<(48&X[oc+3])>>4){if((kc=oc+5+X[oc+4])===oc+188)continue}else kc=oc+4;switch(le){case ob:pc&&(mb&&(Ha=ea(mb))&&this.parseAVCPES(Ha,!1),mb={data:[],size:0});mb&&(mb.data.push(X.subarray(kc,oc+188)),mb.size+=oc+188-kc);break;case pb:pc&&(Mb&&(Ha=ea(Mb))&&(Sa.isAAC?this.parseAACPES(Ha):this.parseMPEGPES(Ha)),Mb={data:[],
size:0});Mb&&(Mb.data.push(X.subarray(kc,oc+188)),Mb.size+=oc+188-kc);break;case Kb:pc&&(Gb&&(Ha=ea(Gb))&&this.parseID3PES(Ha),Gb={data:[],size:0});Gb&&(Gb.data.push(X.subarray(kc,oc+188)),Gb.size+=oc+188-kc);break;case 0:pc&&(kc+=X[kc]+1);id=this._pmtId=(31&X[kc+10])<<8|X[kc+11];break;case id:pc&&(kc+=X[kc]+1);pc=X;le=!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3;var mf=ma,Lc={audio:-1,avc:-1,id3:-1,isAAC:!0},nf=kc+3+((15&pc[kc+1])<<8|pc[kc+2])-4;for(kc+=12+((15&pc[kc+10])<<8|pc[kc+11]);kc<
nf;){var Pd=(31&pc[kc+1])<<8|pc[kc+2];switch(pc[kc]){case 207:if(!mf){gb.b.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===Lc.audio&&(Lc.audio=Pd);break;case 21:-1===Lc.id3&&(Lc.id3=Pd);break;case 219:if(!mf){gb.b.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===Lc.avc&&(Lc.avc=Pd);break;case 3:case 4:le?-1===Lc.audio&&(Lc.audio=Pd,Lc.isAAC=!1):gb.b.log("MPEG audio found, not supported in this browser");
break;case 36:gb.b.warn("Unsupported HEVC stream type found")}kc+=5+((15&pc[kc+3])<<8|pc[kc+4])}pc=Lc;0<(ob=pc.avc)&&(aa.pid=ob);0<(pb=pc.audio)&&(Sa.pid=pb,Sa.isAAC=pc.isAAC);0<(Kb=pc.id3)&&(Fa.pid=Kb);Ub&&!Cc&&(gb.b.log("reparse from beginning"),Ub=!1,oc=zd-188);Cc=this.pmtParsed=!0;break;case 17:case 8191:break;default:Ub=!0}}else Zc++;0<Zc&&this.observer.emit(M.a.ERROR,M.a.ERROR,{type:Q.b.MEDIA_ERROR,details:Q.a.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+Zc+" TS packet/s that do not start with 0x47"});
aa.pesData=mb;Sa.pesData=Mb;Fa.pesData=Gb;X={audioTrack:Sa,avcTrack:aa,id3Track:Fa,textTrack:this._txtTrack};return Da&&this.extractRemainingSamples(X),X},va.flush=function(){var X,aa=this.remainderData;return this.remainderData=null,X=aa?this.demux(aa,-1,!1,!0):{audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(X),this.sampleAes?this.decrypt(X,this.sampleAes):X},va.extractRemainingSamples=function(X){var aa,ma=X.audioTrack,
Da=X.avcTrack;X=X.id3Track;var Ha=Da.pesData,Sa=ma.pesData,Fa=X.pesData;Ha&&(aa=ea(Ha))?(this.parseAVCPES(aa,!0),Da.pesData=null):Da.pesData=Ha;Sa&&(aa=ea(Sa))?(ma.isAAC?this.parseAACPES(aa):this.parseMPEGPES(aa),ma.pesData=null):(null!=Sa&&Sa.size&&gb.b.log("last AAC PES packet truncated,might overlap between fragments"),ma.pesData=Sa);Fa&&(aa=ea(Fa))?(this.parseID3PES(aa),X.pesData=null):X.pesData=Fa},va.demuxSampleAes=function(X,aa,ma){X=this.demux(X,ma,!0,!this.config.progressive);aa=this.sampleAes=
new jb(this.observer,this.config,aa);return this.decrypt(X,aa)},va.decrypt=function(X,aa){return new Promise(function(ma){var Da=X.audioTrack,Ha=X.avcTrack;Da.samples&&Da.isAAC?aa.decryptAacSamples(Da.samples,0,function(){Ha.samples?aa.decryptAvcSamples(Ha.samples,0,0,function(){ma(X)}):ma(X)}):Ha.samples&&aa.decryptAvcSamples(Ha.samples,0,0,function(){ma(X)})})},va.destroy=function(){this._initPTS=this._initDTS=null;this._duration=0},va.parseAVCPES=function(X,aa){var ma,Da=this,Ha=this._avcTrack,
Sa=this.parseAVCNALu(X.data),Fa=this.avcSample,ob=!1;X.data=null;Fa&&Sa.length&&!Ha.audFound&&(T(Fa,Ha),Fa=this.avcSample=W(!1,X.pts,X.dts,""));Sa.forEach(function(mb){switch(mb.type){case 1:ma=!0;Fa||=Da.avcSample=W(!0,X.pts,X.dts,"");Fa.frame=!0;var pb=mb.data;ob&&4<pb.length&&(pb=(new lb(pb)).readSliceType(),2!==pb&&4!==pb&&7!==pb&&9!==pb||(Fa.key=!0));break;case 5:ma=!0;Fa||=Da.avcSample=W(!0,X.pts,X.dts,"");Fa.key=!0;Fa.frame=!0;break;case 6:ma=!0;pb=new lb(sa(mb.data));pb.readUByte();for(var Kb,
Mb,Gb=!1,Ub;!Gb&&1<pb.bytesAvailable;){Kb=0;do Kb+=Ub=pb.readUByte();while(255===Ub);Mb=0;do Mb+=Ub=pb.readUByte();while(255===Ub);if(4===Kb&&0!==pb.bytesAvailable){if((Gb=!0,181===pb.readUByte())&&49===pb.readUShort()&&1195456820===pb.readUInt()&&3===pb.readUByte()){Ub=pb.readUByte();Kb=31&Ub;Ub=[Ub,pb.readUByte()];for(Mb=0;Mb<Kb;Mb++)Ub.push(pb.readUByte()),Ub.push(pb.readUByte()),Ub.push(pb.readUByte());fa(Da._txtTrack.samples,{type:3,pts:X.pts,bytes:Ub})}}else if(5===Kb&&0!==pb.bytesAvailable){if(Gb=
!0,16<Mb){Ub=[];for(var Cc=0;16>Cc;Cc++)Ub.push(pb.readUByte().toString(16)),3!==Cc&&5!==Cc&&7!==Cc&&9!==Cc||Ub.push("-");Mb-=16;Cc=new Uint8Array(Mb);for(var id=0;id<Mb;id++)Cc[id]=pb.readUByte();fa(Da._txtTrack.samples,{pts:X.pts,payloadType:Kb,uuid:Ub.join(""),userData:Object(za.f)(Cc),userDataBytes:Cc})}}else if(Mb<pb.bytesAvailable)for(Kb=0;Kb<Mb;Kb++)pb.readUByte()}break;case 7:if(ma=!0,ob=!0,!Ha.sps){pb=(new lb(mb.data)).readSPS();Ha.width=pb.width;Ha.height=pb.height;Ha.pixelRatio=pb.pixelRatio;
Ha.sps=[mb.data];Ha.duration=Da._duration;pb=mb.data.subarray(1,4);Gb="avc1.";for(Kb=0;3>Kb;Kb++)Ub=pb[Kb].toString(16),2>Ub.length&&(Ub="0"+Ub),Gb+=Ub;Ha.codec=Gb}break;case 8:ma=!0;Ha.pps||(Ha.pps=[mb.data]);break;case 9:ma=!1;Ha.audFound=!0;Fa&&T(Fa,Ha);Fa=Da.avcSample=W(!1,X.pts,X.dts,"");break;case 12:ma=!1;break;default:ma=!1,Fa&&(Fa.debug+="unknown NAL "+mb.type+" ")}Fa&&ma&&Fa.units.push(mb)});aa&&Fa&&(T(Fa,Ha),this.avcSample=null)},va.getLastNalUnit=function(){var X,aa=this.avcSample;aa&&
0!==aa.units.length||(aa=this._avcTrack.samples,aa=aa[aa.length-1]);if(null!==(X=aa)&&void 0!==X&&X.units){X=aa.units;var ma=X[X.length-1]}return ma},va.parseAVCNALu=function(X){var aa,ma,Da=X.byteLength,Ha=this._avcTrack,Sa=Ha.naluState||0,Fa=Sa,ob=[],mb=0,pb=-1,Kb=0;for(-1===Sa&&(pb=0,Kb=31&X[0],Sa=0,mb=1);mb<Da;)if(aa=X[mb++],Sa)if(1!==Sa)if(aa)if(1===aa){if(0<=pb)aa={data:X.subarray(pb,mb-Sa-1),type:Kb},ob.push(aa);else if((aa=this.getLastNalUnit())&&(Fa&&mb<=4-Fa&&aa.state&&(aa.data=aa.data.subarray(0,
aa.data.byteLength-Fa)),0<(ma=mb-Sa-1))){var Mb=new Uint8Array(aa.data.byteLength+ma);Mb.set(aa.data,0);Mb.set(X.subarray(0,ma),aa.data.byteLength);aa.data=Mb;aa.state=0}mb<Da?(pb=mb,Kb=31&X[mb],Sa=0):Sa=-1}else Sa=0;else Sa=3;else Sa=aa?0:2;else Sa=aa?0:1;0<=pb&&0<=Sa&&(ma={data:X.subarray(pb,Da),type:Kb,state:Sa},ob.push(ma));0===ob.length&&(ma=this.getLastNalUnit())&&(Da=new Uint8Array(ma.data.byteLength+X.byteLength),Da.set(ma.data,0),Da.set(X,ma.data.byteLength),ma.data=Da);return Ha.naluState=
Sa,ob},va.parseAACPES=function(X){var aa,ma,Da=0,Ha=this._audioTrack,Sa=this.aacOverFlow,Fa=X.data;if(Sa){this.aacOverFlow=null;var ob=Sa.sample.unit.byteLength;var mb=Math.min(Sa.missing,ob);ob-=mb;Sa.sample.unit.set(Fa.subarray(0,mb),ob);Ha.samples.push(Sa.sample);Da=Sa.missing}mb=Da;for(ob=Fa.length;mb<ob-1&&!(mb+1<Fa.length&&m(Fa,mb));mb++);if(mb===Da||(mb<ob-1?(aa="AAC PES did not start with ADTS header,offset:"+mb,ma=!1):(aa="no ADTS header found in AAC PES",ma=!0),gb.b.warn("parsing error:"+
aa),this.observer.emit(M.a.ERROR,M.a.ERROR,{type:Q.b.MEDIA_ERROR,details:Q.a.FRAG_PARSING_ERROR,fatal:ma,reason:aa}),!ma)){if(C(Ha,this.observer,Fa,mb,this.audioCodec),void 0!==X.pts)X=X.pts;else{if(!Sa)return void gb.b.warn("[tsdemuxer]: AAC PES unknown PTS");X=Sa.sample.pts+9216E4/Ha.samplerate}for(aa=0;mb<ob;){if(mb+1<Fa.length&&m(Fa,mb)){if(mb+5<ob&&(ma=I(Ha,Fa,mb,X,aa))){if(!ma.missing){mb+=ma.length;aa++;continue}this.aacOverFlow=ma}break}mb++}}},va.parseMPEGPES=function(X){var aa=X.data,ma=
aa.length,Da=0,Ha=0;X=X.pts;if(void 0!==X)for(;Ha<ma;)if(Ha+1<aa.length&&R(aa,Ha)){var Sa=H(this._audioTrack,aa,Ha,X,Da);if(!Sa)break;Ha+=Sa.length;Da++}else Ha++;else gb.b.warn("[tsdemuxer]: MPEG PES unknown PTS")},va.parseID3PES=function(X){void 0!==X.pts?this._id3Track.samples.push(X):gb.b.warn("[tsdemuxer]: ID3 PES unknown PTS")},Ma}();e.minProbeByteLength=188;cb=function(Ma){function va(){return Ma.apply(this,arguments)||this}va.prototype=Object.create(Ma.prototype);va.prototype.constructor=
va;wa(va,Ma);var X=va.prototype;return X.resetInitSegment=function(aa,ma,Da){Ma.prototype.resetInitSegment.call(this,aa,ma,Da);this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:aa,duration:Da,inputTimeScale:9E4,dropped:0}},va.probe=function(aa){if(!aa)return!1;for(var ma=(za.b(aa,0)||[]).length,Da=aa.length;ma<Da;ma++){var Ha=aa;var Sa=ma;if(Sa+1<Ha.length&&R(Ha,Sa)){var Fa=O(Ha,Sa),ob=4;null!=Fa&&Fa.frameLength&&(ob=Fa.frameLength);
Sa+=ob;Ha=Sa===Ha.length||Sa+1<Ha.length&&R(Ha,Sa)}else Ha=!1;if(Ha)return gb.b.log("MPEG Audio sync word found !"),!0}return!1},X.canParse=function(aa,ma){return R(aa,ma)&&4<=aa.length-ma},X.appendFrame=function(aa,ma,Da){if(null!==this.initPTS)return H(aa,ma,Da,this.initPTS,this.frameIndex)},va}(cb);cb.minProbeByteLength=4;var wb=h(16),Bb=h(5),Tb=function(){function Ma(){this.emitInitSegment=!1;this.initTracks=this.initPTS=this.initData=this.videoCodec=this.audioCodec=void 0;this.lastEndDTS=null}
var va=Ma.prototype;return va.destroy=function(){},va.resetTimeStamp=function(X){this.initPTS=X;this.lastEndDTS=null},va.resetNextTimestamp=function(){this.lastEndDTS=null},va.resetInitSegment=function(X,aa,ma){this.audioCodec=aa;this.videoCodec=ma;this.generateInitSegment(X);this.emitInitSegment=!0},va.generateInitSegment=function(X){var aa=this.audioCodec,ma=this.videoCodec;if(!X||!X.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var Da=this.initData=Object(ta.f)(X);aa||=U(Da.audio,
Bb.a.AUDIO);ma||=U(Da.video,Bb.a.VIDEO);var Ha={};Da.audio&&Da.video?Ha.audiovideo={container:"video/mp4",codec:aa+","+ma,initSegment:X,id:"main"}:Da.audio?Ha.audio={container:"audio/mp4",codec:aa,initSegment:X,id:"audio"}:Da.video?Ha.video={container:"video/mp4",codec:ma,initSegment:X,id:"main"}:gb.b.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes.");this.initTracks=Ha},va.remux=function(X,aa,ma,Da,Ha){var Sa=this.initPTS,Fa=this.lastEndDTS;X={audio:void 0,video:void 0,
text:Da,id3:ma,initSegment:void 0};Object(ca.a)(Fa)||(Fa=this.lastEndDTS=Ha||0);Ha=aa.samples;if(!Ha||!Ha.length)return X;aa={initPTS:void 0,timescale:1};var ob=this.initData;if(ob&&ob.length||(this.generateInitSegment(Ha),ob=this.initData),!ob||!ob.length)return gb.b.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),X;this.emitInitSegment&&(aa.tracks=this.initTracks,this.emitInitSegment=!1);Object(ca.a)(Sa)||(Sa=Fa,Sa=Object(ta.d)(ob,Ha)-Sa,this.initPTS=aa.initPTS=Sa);var mb=Object(ta.c)(Ha,
ob),pb=mb+Fa;Object(ta.e)(ob,Ha,Sa);0<mb?this.lastEndDTS=pb:(gb.b.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());Sa=!!ob.audio;ob=!!ob.video;mb="";Sa&&(mb+="audio");ob&&(mb+="video");Ha={data1:Ha,startPTS:Fa,startDTS:Fa,endPTS:pb,endDTS:pb,type:mb,hasAudio:Sa,hasVideo:ob,nb:1,dropped:0};return X.audio="audio"===Ha.type?Ha:void 0,X.video="audio"!==Ha.type?Ha:void 0,X.text=Da,X.id3=ma,X.initSegment=aa,X},Ma}(),Ob=h(13);try{var Ab=self.performance.now.bind(self.performance)}catch(Ma){gb.b.debug("Unable to use Performance API on this environment"),
Ab=self.Date.now}var mc=[{demux:e,remux:wb.a},{demux:Ya,remux:Tb},{demux:a,remux:wb.a},{demux:cb,remux:wb.a}],Ec=1024;mc.forEach(function(Ma){Ec=Math.max(Ec,Ma.demux.minProbeByteLength)});var Sc=function(){function Ma(X,aa,ma,Da,Ha){this.probe=this.decrypter=this.remuxer=this.demuxer=this.id=this.vendor=this.config=this.typeSupported=this.observer=void 0;this.decryptionPromise=null;this.currentTransmuxState=this.transmuxConfig=void 0;this.cache=new Ob.a;this.observer=X;this.typeSupported=aa;this.config=
ma;this.vendor=Da;this.id=Ha}var va=Ma.prototype;return va.configure=function(X){this.transmuxConfig=X;this.decrypter&&this.decrypter.reset()},va.push=function(X,aa,ma,Da){var Ha=this,Sa=ma.transmuxing;Sa.executeStart=Ab();var Fa=new Uint8Array(X),ob=this.cache,mb=this.config,pb=this.currentTransmuxState;X=this.transmuxConfig;Da&&(this.currentTransmuxState=Da);if((aa=function(Zc,oc){var pc=null;0<Zc.byteLength&&null!=oc&&null!=oc.key&&null!==oc.iv&&null!=oc.method&&(pc=oc);return pc}(Fa,aa))&&"AES-128"===
aa.method){var Kb=this.getDecrypter();if(!mb.enableSoftwareAES)return this.decryptionPromise=Kb.webCryptoDecrypt(Fa,aa.key.buffer,aa.iv.buffer).then(function(Zc){Zc=Ha.push(Zc,null,ma);return Ha.decryptionPromise=null,Zc}),this.decryptionPromise;Fa=Kb.softwareDecrypt(Fa,aa.key.buffer,aa.iv.buffer);if(!Fa)return Sa.executeEnd=Ab(),{remuxResult:{},chunkMeta:ma};Fa=new Uint8Array(Fa)}var Mb=Da||pb;mb=Mb.contiguous;Kb=Mb.discontinuity;var Gb=Mb.trackSwitch;Da=Mb.accurateTimeOffset;pb=Mb.timeOffset;Mb=
Mb.initSegmentChange;var Ub=X.audioCodec,Cc=X.videoCodec,id=X.defaultInitPts,Yc=X.duration,zd=X.initSegmentData;if((Kb||Gb||Mb)&&this.resetInitSegment(zd,Ub,Cc,Yc),(Kb||Mb)&&this.resetInitialTimestamp(id),mb||this.resetContiguity(),this.needsProbing(Fa,Kb,Gb))ob.dataLength&&(ob=ob.flush(),Fa=Object(ta.a)(ob,Fa)),this.configureTransmuxer(Fa,X);X=this.transmux(Fa,aa,pb,Da,ma);Fa=this.currentTransmuxState;return Fa.contiguous=!0,Fa.discontinuity=!1,Fa.trackSwitch=!1,Sa.executeEnd=Ab(),X},va.flush=function(X){var aa=
this,ma=X.transmuxing;ma.executeStart=Ab();var Da=this.decrypter,Ha=this.cache,Sa=this.currentTransmuxState,Fa=this.decryptionPromise;if(Fa)return Fa.then(function(){return aa.flush(X)});var ob=[];Sa=Sa.timeOffset;Da&&(Da=Da.flush())&&ob.push(this.push(Da,null,X));Da=Ha.dataLength;Ha.reset();Ha=this.demuxer;Fa=this.remuxer;if(!Ha||!Fa)return Da>=Ec&&this.observer.emit(M.a.ERROR,M.a.ERROR,{type:Q.b.MEDIA_ERROR,details:Q.a.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),
ma.executeEnd=Ab(),[{remuxResult:{},chunkMeta:X}];ma=Ha.flush(Sa);return qa(ma)?ma.then(function(mb){return aa.flushRemux(ob,mb,X),ob}):(this.flushRemux(ob,ma,X),ob)},va.flushRemux=function(X,aa,ma){var Da=aa.audioTrack,Ha=aa.avcTrack,Sa=aa.id3Track;aa=aa.textTrack;var Fa=this.currentTransmuxState,ob=Fa.accurateTimeOffset;Fa=Fa.timeOffset;gb.b.log("[transmuxer.ts]: Flushed fragment "+ma.sn+(-1<ma.part?" p: "+ma.part:"")+" of level "+ma.level);Da=this.remuxer.remux(Da,Ha,Sa,aa,Fa,ob,!0,this.id);X.push({remuxResult:Da,
chunkMeta:ma});ma.transmuxing.executeEnd=Ab()},va.resetInitialTimestamp=function(X){var aa=this.demuxer,ma=this.remuxer;aa&&ma&&(aa.resetTimeStamp(X),ma.resetTimeStamp(X))},va.resetContiguity=function(){var X=this.demuxer,aa=this.remuxer;X&&aa&&(X.resetContiguity(),aa.resetNextTimestamp())},va.resetInitSegment=function(X,aa,ma,Da){var Ha=this.demuxer,Sa=this.remuxer;Ha&&Sa&&(Ha.resetInitSegment(aa,ma,Da),Sa.resetInitSegment(X,aa,ma))},va.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=
void 0);this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},va.transmux=function(X,aa,ma,Da,Ha){return aa&&"SAMPLE-AES"===aa.method?this.transmuxSampleAes(X,aa,ma,Da,Ha):this.transmuxUnencrypted(X,ma,Da,Ha)},va.transmuxUnencrypted=function(X,aa,ma,Da){X=this.demuxer.demux(X,aa,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(X.audioTrack,X.avcTrack,X.id3Track,X.textTrack,aa,ma,!1,this.id),chunkMeta:Da}},va.transmuxSampleAes=function(X,aa,ma,Da,Ha){var Sa=this;return this.demuxer.demuxSampleAes(X,
aa,ma).then(function(Fa){return{remuxResult:Sa.remuxer.remux(Fa.audioTrack,Fa.avcTrack,Fa.id3Track,Fa.textTrack,ma,Da,!1,Sa.id),chunkMeta:Ha}})},va.configureTransmuxer=function(X,aa){var ma=this.config,Da=this.observer,Ha=this.typeSupported,Sa=this.vendor,Fa=aa.audioCodec,ob=aa.defaultInitPts,mb=aa.duration,pb=aa.initSegmentData;aa=aa.videoCodec;for(var Kb=0,Mb=mc.length;Kb<Mb;Kb++)if(mc[Kb].demux.probe(X)){var Gb=mc[Kb];break}Gb||(gb.b.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),
Gb={demux:Ya,remux:Tb});X=this.demuxer;Kb=this.remuxer;Mb=Gb.remux;Gb=Gb.demux;Kb&&Kb instanceof Mb||(this.remuxer=new Mb(Da,ma,Ha,Sa));X&&X instanceof Gb||(this.demuxer=new Gb(Da,ma,Ha),this.probe=Gb.probe);this.resetInitSegment(pb,Fa,aa,mb);this.resetInitialTimestamp(ob)},va.needsProbing=function(X,aa,ma){return!this.demuxer||!this.remuxer||aa||ma},va.getDecrypter=function(){var X=this.decrypter;return X||=this.decrypter=new V.a(this.observer,this.config),X},Ma}(),Je=function(Ma,va,X,aa,ma){this.defaultInitPts=
this.duration=this.initSegmentData=this.videoCodec=this.audioCodec=void 0;this.audioCodec=Ma;this.videoCodec=va;this.initSegmentData=X;this.duration=aa;this.defaultInitPts=ma},lf=function(Ma,va,X,aa,ma,Da){this.discontinuity=Ma;this.contiguous=va;this.accurateTimeOffset=X;this.trackSwitch=aa;this.timeOffset=ma;this.initSegmentChange=Da}},function(a,e,h){var m=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/;var t=/^([^\/?#]*)([^]*)$/;var y=/(?:\/|^)\.(?=\/)/g;
var C=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g;var I={buildAbsoluteURL:function(E,H,O){if(O=O||{},E=E.trim(),!(H=H.trim())){if(!O.alwaysNormalize)return E;O=I.parseURL(E);if(!O)throw Error("Error trying to parse base URL.");return O.path=I.normalizePath(O.path),I.buildURLFromParts(O)}var R=I.parseURL(H);if(!R)throw Error("Error trying to parse relative URL.");if(R.scheme)return O.alwaysNormalize?(R.path=I.normalizePath(R.path),I.buildURLFromParts(R)):H;H=I.parseURL(E);if(!H)throw Error("Error trying to parse base URL.");
!H.netLoc&&H.path&&"/"!==H.path[0]&&(E=t.exec(H.path),H.netLoc=E[1],H.path=E[2]);H.netLoc&&!H.path&&(H.path="/");E={scheme:H.scheme,netLoc:R.netLoc,path:null,params:R.params,query:R.query,fragment:R.fragment};R.netLoc||(E.netLoc=H.netLoc,"/"===R.path[0])||(R.path?(H=H.path,H=H.substring(0,H.lastIndexOf("/")+1)+R.path,E.path=I.normalizePath(H)):(E.path=H.path,R.params||(E.params=H.params,R.query||(E.query=H.query))));return null===E.path&&(E.path=O.alwaysNormalize?I.normalizePath(R.path):R.path),I.buildURLFromParts(E)},
parseURL:function(E){return(E=m.exec(E))?{scheme:E[1]||"",netLoc:E[2]||"",path:E[3]||"",params:E[4]||"",query:E[5]||"",fragment:E[6]||""}:null},normalizePath:function(E){for(E=E.split("").reverse().join("").replace(y,"");E.length!==(E=E.replace(C,"")).length;);return E.split("").reverse().join("")},buildURLFromParts:function(E){return E.scheme+E.netLoc+E.path+E.params+E.query+E.fragment}};a.exports=I},function(a,e,h){h.d(e,"a",function(){return m});var m=function(){this.aborted=!1;this.bwEstimate=
this.chunkCount=this.total=this.retry=this.loaded=0;this.loading={start:0,first:0,end:0};this.parsing={start:0,end:0};this.buffering={start:0,first:0,end:0}}},function(a,e,h){h.d(e,"a",function(){return m});var m=function(){function t(){this.chunks=[];this.dataLength=0}var y=t.prototype;return y.push=function(C){this.chunks.push(C);this.dataLength+=C.length},y.flush=function(){var C,I=this.chunks,E=this.dataLength;if(I.length){if(1===I.length)I=I[0];else{E=new Uint8Array(E);for(var H=0,O=0;O<I.length;O++){var R=
I[O];E.set(R,H);H+=R.length}I=E}I=(C=I,this.reset(),C)}else I=new Uint8Array(0);return I},y.reset=function(){this.dataLength=this.chunks.length=0},t}()},function(a,e,h){function m(){}function t(O,R,W){this.fn=O;this.context=R;this.once=W||!1}function y(O,R,W,ea,T){if("function"!=typeof W)throw new TypeError("The listener must be a function");W=new t(W,ea||O,T);R=H?H+R:R;return O._events[R]?O._events[R].fn?O._events[R]=[O._events[R],W]:O._events[R].push(W):(O._events[R]=W,O._eventsCount++),O}function C(O,
R){0==--O._eventsCount?O._events=new m:delete O._events[R]}function I(){this._events=new m;this._eventsCount=0}var E=Object.prototype.hasOwnProperty,H="~";Object.create&&(m.prototype=Object.create(null),(new m).__proto__||(H=!1));I.prototype.eventNames=function(){var O,R,W=[];if(0===this._eventsCount)return W;for(R in O=this._events)E.call(O,R)&&W.push(H?R.slice(1):R);return Object.getOwnPropertySymbols?W.concat(Object.getOwnPropertySymbols(O)):W};I.prototype.listeners=function(O){O=this._events[H?
H+O:O];if(!O)return[];if(O.fn)return[O.fn];for(var R=0,W=O.length,ea=Array(W);R<W;R++)ea[R]=O[R].fn;return ea};I.prototype.listenerCount=function(O){return(O=this._events[H?H+O:O])?O.fn?1:O.length:0};I.prototype.emit=function(O,R,W,ea,T,fa){var sa=H?H+O:O;if(!this._events[sa])return!1;var wa,U=this._events[sa],qa=arguments.length;if(U.fn){switch(U.once&&this.removeListener(O,U.fn,void 0,!0),qa){case 1:return U.fn.call(U.context),!0;case 2:return U.fn.call(U.context,R),!0;case 3:return U.fn.call(U.context,
R,W),!0;case 4:return U.fn.call(U.context,R,W,ea),!0;case 5:return U.fn.call(U.context,R,W,ea,T),!0;case 6:return U.fn.call(U.context,R,W,ea,T,fa),!0}sa=1;for(wa=Array(qa-1);sa<qa;sa++)wa[sa-1]=arguments[sa];U.fn.apply(U.context,wa)}else{var M=U.length;for(sa=0;sa<M;sa++)switch(U[sa].once&&this.removeListener(O,U[sa].fn,void 0,!0),qa){case 1:U[sa].fn.call(U[sa].context);break;case 2:U[sa].fn.call(U[sa].context,R);break;case 3:U[sa].fn.call(U[sa].context,R,W);break;case 4:U[sa].fn.call(U[sa].context,
R,W,ea);break;default:if(!wa){var Q=1;for(wa=Array(qa-1);Q<qa;Q++)wa[Q-1]=arguments[Q]}U[sa].fn.apply(U[sa].context,wa)}}return!0};I.prototype.on=function(O,R,W){return y(this,O,R,W,!1)};I.prototype.once=function(O,R,W){return y(this,O,R,W,!0)};I.prototype.removeListener=function(O,R,W,ea){O=H?H+O:O;if(!this._events[O])return this;if(!R)return C(this,O),this;var T=this._events[O];if(T.fn)T.fn!==R||ea&&!T.once||W&&T.context!==W||C(this,O);else{for(var fa=0,sa=[],wa=T.length;fa<wa;fa++)(T[fa].fn!==
R||ea&&!T[fa].once||W&&T[fa].context!==W)&&sa.push(T[fa]);sa.length?this._events[O]=1===sa.length?sa[0]:sa:C(this,O)}return this};I.prototype.removeAllListeners=function(O){var R;return O?(R=H?H+O:O,this._events[R]&&C(this,R)):(this._events=new m,this._eventsCount=0),this};I.prototype.off=I.prototype.removeListener;I.prototype.addListener=I.prototype.on;I.prefixed=H;I.EventEmitter=I;a.exports=I},function(a,e,h){h.d(e,"a",function(){return H});var m=function(){function O(R,W){this.aesIV=this.subtle=
void 0;this.subtle=R;this.aesIV=W}return O.prototype.decrypt=function(R,W){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},W,R)},O}(),t=function(){function O(R,W){this.key=this.subtle=void 0;this.subtle=R;this.key=W}return O.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},O}(),y=h(9),C=function(){function O(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54];this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),
new Uint32Array(256)];this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)];this.sBox=new Uint32Array(256);this.invSBox=new Uint32Array(256);this.key=new Uint32Array(0);this.keySize=this.ksRows=0;this.invKeySchedule=this.keySchedule=void 0;this.initTable()}var R=O.prototype;return R.uint8ArrayToUint32Array_=function(W){W=new DataView(W);for(var ea=new Uint32Array(4),T=0;4>T;T++)ea[T]=W.getUint32(4*T);return ea},R.initTable=function(){var W=this.sBox,
ea=this.invSBox,T=this.subMix,fa=T[0],sa=T[1],wa=T[2];T=T[3];var U=this.invSubMix,qa=U[0],M=U[1],Q=U[2];U=U[3];var V=new Uint32Array(256),ca=0,za=0,ta;for(ta=0;256>ta;ta++)V[ta]=128>ta?ta<<1:ta<<1^283;for(ta=0;256>ta;ta++){var Ka=za^za<<1^za<<2^za<<3^za<<4;Ka=Ka>>>8^255&Ka^99;W[ca]=Ka;ea[Ka]=ca;var cb=V[ca],gb=V[cb],Ya=V[gb],na=257*V[Ka]^16843008*Ka;fa[ca]=na<<24|na>>>8;sa[ca]=na<<16|na>>>16;wa[ca]=na<<8|na>>>24;T[ca]=na;na=16843009*Ya^65537*gb^257*cb^16843008*ca;qa[Ka]=na<<24|na>>>8;M[Ka]=na<<16|
na>>>16;Q[Ka]=na<<8|na>>>24;U[Ka]=na;ca?(ca=cb^V[V[V[Ya^cb]]],za^=V[V[za]]):ca=za=1}},R.expandKey=function(W){W=this.uint8ArrayToUint32Array_(W);for(var ea=!0,T=0;T<W.length&&ea;)ea=W[T]===this.key[T],T++;if(!ea){this.key=W;var fa=this.keySize=W.length;if(4!==fa&&6!==fa&&8!==fa)throw Error("Invalid aes key size="+fa);var sa,wa;ea=this.ksRows=4*(fa+6+1);T=this.keySchedule=new Uint32Array(ea);var U=this.invKeySchedule=new Uint32Array(ea),qa=this.sBox,M=this.rcon;var Q=this.invSubMix;var V=Q[0],ca=Q[1],
za=Q[2],ta=Q[3];for(Q=0;Q<ea;Q++)Q<fa?sa=T[Q]=W[Q]:(wa=sa,0==Q%fa?(wa=qa[(wa=wa<<8|wa>>>24)>>>24]<<24|qa[wa>>>16&255]<<16|qa[wa>>>8&255]<<8|qa[255&wa],wa^=M[Q/fa|0]<<24):6<fa&&4==Q%fa&&(wa=qa[wa>>>24]<<24|qa[wa>>>16&255]<<16|qa[wa>>>8&255]<<8|qa[255&wa]),T[Q]=sa=(T[Q-fa]^wa)>>>0);for(sa=0;sa<ea;sa++)Q=ea-sa,wa=3&sa?T[Q]:T[Q-4],U[sa]=4>sa||4>=Q?wa:V[qa[wa>>>24]]^ca[qa[wa>>>16&255]]^za[qa[wa>>>8&255]]^ta[qa[255&wa]],U[sa]>>>=0}},R.networkToHostOrderSwap=function(W){return W<<24|(65280&W)<<8|(16711680&
W)>>8|W>>>24},R.decrypt=function(W,ea,T){var fa,sa=this.keySize+6,wa=this.invKeySchedule,U=this.invSBox,qa=this.invSubMix,M=qa[0],Q=qa[1],V=qa[2];qa=qa[3];var ca=this.uint8ArrayToUint32Array_(T);T=ca[0];var za=ca[1],ta=ca[2];ca=ca[3];for(var Ka=new Int32Array(W),cb=new Int32Array(Ka.length),gb=this.networkToHostOrderSwap;ea<Ka.length;){var Ya=gb(Ka[ea]);var na=gb(Ka[ea+1]);var Ia=gb(Ka[ea+2]);var Na=gb(Ka[ea+3]);var $a=Ya^wa[0];var rb=Na^wa[1];var lb=Ia^wa[2];var jb=na^wa[3];var yb=4;for(fa=1;fa<
sa;fa++){W=M[$a>>>24]^Q[rb>>16&255]^V[lb>>8&255]^qa[255&jb]^wa[yb];var wb=M[rb>>>24]^Q[lb>>16&255]^V[jb>>8&255]^qa[255&$a]^wa[yb+1];var Bb=M[lb>>>24]^Q[jb>>16&255]^V[$a>>8&255]^qa[255&rb]^wa[yb+2];jb=M[jb>>>24]^Q[$a>>16&255]^V[rb>>8&255]^qa[255&lb]^wa[yb+3];$a=W;rb=wb;lb=Bb;yb+=4}W=U[$a>>>24]<<24^U[rb>>16&255]<<16^U[lb>>8&255]<<8^U[255&jb]^wa[yb];wb=U[rb>>>24]<<24^U[lb>>16&255]<<16^U[jb>>8&255]<<8^U[255&$a]^wa[yb+1];Bb=U[lb>>>24]<<24^U[jb>>16&255]<<16^U[$a>>8&255]<<8^U[255&rb]^wa[yb+2];jb=U[jb>>>
24]<<24^U[$a>>16&255]<<16^U[rb>>8&255]<<8^U[255&lb]^wa[yb+3];cb[ea]=gb(W^T);cb[ea+1]=gb(jb^za);cb[ea+2]=gb(Bb^ta);cb[ea+3]=gb(wb^ca);T=Ya;za=na;ta=Ia;ca=Na;ea+=4}return cb.buffer},O}(),I=h(1),E=h(6),H=function(){function O(W,ea,T){T=(void 0===T?{}:T).removePKCS7Padding;T=void 0===T||T;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,
this.currentResult=null,this.observer=W,this.config=ea,this.removePKCS7Padding=T,T)try{var fa=self.crypto;fa&&(this.subtle=fa.subtle||fa.webkitSubtle)}catch(sa){}null===this.subtle&&(this.config.enableSoftwareAES=!0)}var R=O.prototype;return R.destroy=function(){this.observer=null},R.isSync=function(){return this.config.enableSoftwareAES},R.flush=function(){var W=this.currentResult;if(W){var ea,T;W=new Uint8Array(W);return this.reset(),this.removePKCS7Padding?(ea=W.byteLength,(T=ea&&(new DataView(W.buffer)).getUint8(ea-
1))?Object(y.a)(W,0,ea-T):W):W}this.reset()},R.reset=function(){this.remainderData=this.currentIV=this.currentResult=null;this.softwareDecrypter&&(this.softwareDecrypter=null)},R.decrypt=function(W,ea,T,fa){this.config.enableSoftwareAES?(this.softwareDecrypt(new Uint8Array(W),ea,T),(W=this.flush())&&fa(W.buffer)):this.webCryptoDecrypt(new Uint8Array(W),ea,T).then(fa)},R.softwareDecrypt=function(W,ea,T){var fa=this.currentIV,sa=this.currentResult,wa=this.remainderData;this.logOnce("JS AES decrypt");
wa&&(W=Object(E.a)(wa,W),this.remainderData=null);W=this.getValidChunk(W);if(!W.length)return null;fa&&(T=fa);(fa=this.softwareDecrypter)||(fa=this.softwareDecrypter=new C);fa.expandKey(ea);return this.currentResult=fa.decrypt(W.buffer,0,T),this.currentIV=Object(y.a)(W,-16).buffer,sa||null},R.webCryptoDecrypt=function(W,ea,T){var fa=this,sa=this.subtle;return this.key===ea&&this.fastAesKey||(this.key=ea,this.fastAesKey=new t(sa,ea)),this.fastAesKey.expandKey().then(function(wa){return sa?(new m(sa,
T)).decrypt(W.buffer,wa):Promise.reject(Error("web crypto not initialized"))}).catch(function(wa){return fa.onWebCryptoError(wa,W,ea,T)})},R.onWebCryptoError=function(W,ea,T,fa){return I.b.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",W),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(ea,T,fa)},R.getValidChunk=function(W){var ea=W,T=W.length-W.length%16;return T!==W.length&&(ea=Object(y.a)(W,0,T),this.remainderData=Object(y.a)(W,T)),ea},R.logOnce=function(W){this.logEnabled&&
(I.b.log("[decrypter.ts]: "+W),this.logEnabled=!1)},O}()},function(a,e,h){function m(){return(m=Object.assign||function(M){for(var Q=1;Q<arguments.length;Q++){var V=arguments[Q],ca;for(ca in V)Object.prototype.hasOwnProperty.call(V,ca)&&(M[ca]=V[ca])}return M}).apply(this,arguments)}function t(M,Q){var V;if(null===Q)return M;for(V=Q<M?-8589934592:8589934592;4294967296<Math.abs(M-Q);)M+=V;return M}h.d(e,"a",function(){return wa});h.d(e,"b",function(){return t});var y=h(3),C=function(){function M(){}
return M.getSilentFrame=function(Q,V){switch(Q){case "mp4a.40.2":if(1===V)return new Uint8Array([0,200,0,128,35,128]);if(2===V)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===V)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===V)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===V)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===V)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,
130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===V)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===V||3===V)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},M}(),I=Math.pow(2,
32)-1,E=function(){function M(){}return M.init=function(){for(var Q in M.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},M.types)M.types.hasOwnProperty(Q)&&(M.types[Q]=[Q.charCodeAt(0),Q.charCodeAt(1),Q.charCodeAt(2),Q.charCodeAt(3)]);Q=new Uint8Array([0,
0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]);var V=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);M.HDLR_TYPES={video:Q,audio:V};Q=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]);V=new Uint8Array([0,0,0,0,0,0,0,0]);M.STTS=M.STSC=M.STCO=V;M.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);M.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]);M.SMHD=new Uint8Array([0,
0,0,0,0,0,0,0]);M.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);V=new Uint8Array([105,115,111,109]);var ca=new Uint8Array([97,118,99,49]),za=new Uint8Array([0,0,0,1]);M.FTYP=M.box(M.types.ftyp,V,za,V,ca);M.DINF=M.box(M.types.dinf,M.box(M.types.dref,Q))},M.box=function(Q){for(var V=8,ca=arguments.length,za=Array(1<ca?ca-1:0),ta=1;ta<ca;ta++)za[ta-1]=arguments[ta];for(ta=ca=za.length;ca--;)V+=za[ca].byteLength;var Ka=new Uint8Array(V);Ka[0]=V>>24&255;Ka[1]=V>>16&255;Ka[2]=V>>8&255;Ka[3]=255&V;Ka.set(Q,4);
ca=0;for(V=8;ca<ta;ca++)Ka.set(za[ca],V),V+=za[ca].byteLength;return Ka},M.hdlr=function(Q){return M.box(M.types.hdlr,M.HDLR_TYPES[Q])},M.mdat=function(Q){return M.box(M.types.mdat,Q)},M.mdhd=function(Q,V){V*=Q;var ca=Math.floor(V/(I+1));V=Math.floor(V%(I+1));return M.box(M.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,Q>>24&255,Q>>16&255,Q>>8&255,255&Q,ca>>24,ca>>16&255,ca>>8&255,255&ca,V>>24,V>>16&255,V>>8&255,255&V,85,196,0,0]))},M.mdia=function(Q){return M.box(M.types.mdia,
M.mdhd(Q.timescale,Q.duration),M.hdlr(Q.type),M.minf(Q))},M.mfhd=function(Q){return M.box(M.types.mfhd,new Uint8Array([0,0,0,0,Q>>24,Q>>16&255,Q>>8&255,255&Q]))},M.minf=function(Q){return"audio"===Q.type?M.box(M.types.minf,M.box(M.types.smhd,M.SMHD),M.DINF,M.stbl(Q)):M.box(M.types.minf,M.box(M.types.vmhd,M.VMHD),M.DINF,M.stbl(Q))},M.moof=function(Q,V,ca){return M.box(M.types.moof,M.mfhd(Q),M.traf(ca,V))},M.moov=function(Q){for(var V=Q.length,ca=[];V--;)ca[V]=M.trak(Q[V]);return M.box.apply(null,[M.types.moov,
M.mvhd(Q[0].timescale,Q[0].duration)].concat(ca).concat(M.mvex(Q)))},M.mvex=function(Q){for(var V=Q.length,ca=[];V--;)ca[V]=M.trex(Q[V]);return M.box.apply(null,[M.types.mvex].concat(ca))},M.mvhd=function(Q,V){V*=Q;var ca=Math.floor(V/(I+1));V=Math.floor(V%(I+1));Q=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,Q>>24&255,Q>>16&255,Q>>8&255,255&Q,ca>>24,ca>>16&255,ca>>8&255,255&ca,V>>24,V>>16&255,V>>8&255,255&V,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return M.box(M.types.mvhd,Q)},M.sdtp=function(Q){var V=Q.samples||[],ca=new Uint8Array(4+V.length);for(Q=0;Q<V.length;Q++){var za=V[Q].flags;ca[Q+4]=za.dependsOn<<4|za.isDependedOn<<2|za.hasRedundancy}return M.box(M.types.sdtp,ca)},M.stbl=function(Q){return M.box(M.types.stbl,M.stsd(Q),M.box(M.types.stts,M.STTS),M.box(M.types.stsc,M.STSC),M.box(M.types.stsz,M.STSZ),M.box(M.types.stco,M.STCO))},M.avc1=function(Q){var V,
ca,za=[],ta=[];for(V=0;V<Q.sps.length;V++){var Ka=(ca=Q.sps[V]).byteLength;za.push(Ka>>>8&255);za.push(255&Ka);za=za.concat(Array.prototype.slice.call(ca))}for(V=0;V<Q.pps.length;V++)Ka=(ca=Q.pps[V]).byteLength,ta.push(Ka>>>8&255),ta.push(255&Ka),ta=ta.concat(Array.prototype.slice.call(ca));V=M.box(M.types.avcC,new Uint8Array([1,za[3],za[4],za[5],255,224|Q.sps.length].concat(za).concat([Q.pps.length]).concat(ta)));ca=Q.width;Ka=Q.height;za=Q.pixelRatio[0];Q=Q.pixelRatio[1];return M.box(M.types.avc1,
new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,ca>>8&255,255&ca,Ka>>8&255,255&Ka,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),V,M.box(M.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),M.box(M.types.pasp,new Uint8Array([za>>24,za>>16&255,za>>8&255,255&za,Q>>24,Q>>16&255,Q>>8&255,255&Q])))},M.esds=function(Q){var V=Q.config.length;return new Uint8Array([0,0,0,0,3,23+
V,0,1,0,4,15+V,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([V]).concat(Q.config).concat([6,1,2]))},M.mp4a=function(Q){var V=Q.samplerate;return M.box(M.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,Q.channelCount,0,16,0,0,0,0,V>>8&255,255&V,0,0]),M.box(M.types.esds,M.esds(Q)))},M.mp3=function(Q){var V=Q.samplerate;return M.box(M.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,Q.channelCount,0,16,0,0,0,0,V>>8&255,255&V,0,0]))},M.stsd=function(Q){return"audio"===Q.type?Q.isAAC||
"mp3"!==Q.codec?M.box(M.types.stsd,M.STSD,M.mp4a(Q)):M.box(M.types.stsd,M.STSD,M.mp3(Q)):M.box(M.types.stsd,M.STSD,M.avc1(Q))},M.tkhd=function(Q){var V=Q.id,ca=Q.duration*Q.timescale,za=Q.width;Q=Q.height;var ta=Math.floor(ca/(I+1));ca=Math.floor(ca%(I+1));return M.box(M.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,V>>24&255,V>>16&255,V>>8&255,255&V,0,0,0,0,ta>>24,ta>>16&255,ta>>8&255,255&ta,ca>>24,ca>>16&255,ca>>8&255,255&ca,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,za>>8&255,255&za,0,0,Q>>8&255,255&Q,0,0]))},M.traf=function(Q,V){var ca=M.sdtp(Q),za=Q.id,ta=Math.floor(V/(I+1));V=Math.floor(V%(I+1));return M.box(M.types.traf,M.box(M.types.tfhd,new Uint8Array([0,0,0,0,za>>24,za>>16&255,za>>8&255,255&za])),M.box(M.types.tfdt,new Uint8Array([1,0,0,0,ta>>24,ta>>16&255,ta>>8&255,255&ta,V>>24,V>>16&255,V>>8&255,255&V])),M.trun(Q,ca.length+16+20+8+16+8+8),ca)},M.trak=function(Q){return Q.duration=Q.duration||4294967295,
M.box(M.types.trak,M.tkhd(Q),M.mdia(Q))},M.trex=function(Q){Q=Q.id;return M.box(M.types.trex,new Uint8Array([0,0,0,0,Q>>24,Q>>16&255,Q>>8&255,255&Q,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},M.trun=function(Q,V){var ca;Q=Q.samples||[];var za=Q.length;var ta=12+16*za;var Ka=new Uint8Array(ta);V+=8+ta;Ka.set([0,0,15,1,za>>>24&255,za>>>16&255,za>>>8&255,255&za,V>>>24&255,V>>>16&255,V>>>8&255,255&V],0);for(V=0;V<za;V++){ta=(ca=Q[V]).duration;var cb=ca.size;var gb=ca.flags;ca=ca.cts;Ka.set([ta>>>24&255,ta>>>
16&255,ta>>>8&255,255&ta,cb>>>24&255,cb>>>16&255,cb>>>8&255,255&cb,gb.isLeading<<2|gb.dependsOn,gb.isDependedOn<<6|gb.hasRedundancy<<4|gb.paddingValue<<1|gb.isNonSync,61440&gb.degradPrio,15&gb.degradPrio,ca>>>24&255,ca>>>16&255,ca>>>8&255,255&ca],12+16*V)}return M.box(M.types.trun,Ka)},M.initSegment=function(Q){M.types||M.init();Q=M.moov(Q);var V=new Uint8Array(M.FTYP.byteLength+Q.byteLength);return V.set(M.FTYP),V.set(Q,M.FTYP.byteLength),V},M}();E.types=void 0;E.HDLR_TYPES=void 0;E.STTS=void 0;
E.STSC=void 0;E.STCO=void 0;E.STSZ=void 0;E.VMHD=void 0;E.SMHD=void 0;E.STSD=void 0;E.FTYP=void 0;E.DINF=void 0;var H=h(0),O=h(2),R=h(1),W=h(4),ea=h(8),T=null,fa=null,sa=!1,wa=function(){function M(V,ca,za,ta){if(this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=V,this.config=ca,this.typeSupported=za,this.ISGenerated=!1,null===T)T=(V=(navigator.userAgent||"").match(/Chrome\/(\d+)/i))?parseInt(V[1]):
0;null===fa&&(fa=(V=navigator.userAgent.match(/Safari\/(\d+)/i))?parseInt(V[1]):0);sa=!!T&&75>T||!!fa&&600>fa}var Q=M.prototype;return Q.destroy=function(){},Q.resetTimeStamp=function(V){R.b.log("[mp4-remuxer]: initPTS & initDTS reset");this._initPTS=this._initDTS=V},Q.resetNextTimestamp=function(){R.b.log("[mp4-remuxer]: reset next timestamp");this.isAudioContiguous=this.isVideoContiguous=!1},Q.resetInitSegment=function(){R.b.log("[mp4-remuxer]: ISGenerated flag reset");this.ISGenerated=!1},Q.getVideoStartPts=
function(V){var ca=!1;V=V.reduce(function(za,ta){var Ka=ta.pts-za;return-4294967296>Ka?(ca=!0,t(za,ta.pts)):0<Ka?za:ta.pts},V[0].pts);return ca&&R.b.debug("PTS rollover detected"),V},Q.remux=function(V,ca,za,ta,Ka,cb,gb,Ya){var na,Ia,Na,$a,rb,lb=Ka,jb=Ka,yb=-1<ca.pid,wb=ca.samples.length,Bb=0<V.samples.length,Tb=1<wb;if(!(-1<V.pid&&!Bb||yb&&!Tb)||this.ISGenerated||gb){this.ISGenerated||(Ia=this.generateIS(V,ca,Ka));gb=this.isVideoContiguous;var Ob=-1,Ab;if(Ab=Tb){a:{Ob=ca.samples;for(Ab=0;Ab<Ob.length;Ab++)if(Ob[Ab].key){Ob=
Ab;break a}Ob=-1}Ab=!gb&&this.config.forceKeyFrameOnDiscontinuity}Ab&&((rb=!0,0<Ob)?(R.b.warn("[mp4-remuxer]: Dropped "+Ob+" out of "+wb+" video samples due to a missing keyframe"),wb=this.getVideoStartPts(ca.samples),ca.samples=ca.samples.slice(Ob),ca.dropped+=Ob,jb+=(ca.samples[0].pts-wb)/(ca.timescale||9E4)):-1===Ob&&(R.b.warn("[mp4-remuxer]: No keyframe found out of "+wb+" video samples"),rb=!1));if(this.ISGenerated){Bb&&Tb&&(wb=this.getVideoStartPts(ca.samples),wb=(t(V.samples[0].pts,wb)-wb)/
ca.inputTimeScale,lb+=Math.max(0,wb),jb+=Math.max(0,-wb));if(Bb){if(V.samplerate||(R.b.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),Ia=this.generateIS(V,ca,Ka)),na=this.remuxAudio(V,lb,this.isAudioContiguous,cb,yb||Tb||Ya===W.b.AUDIO?jb:void 0),Tb){cb=na?na.endPTS-na.startPTS:0;ca.inputTimeScale||(R.b.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),Ia=this.generateIS(V,ca,Ka));var mc=this.remuxVideo(ca,jb,gb,cb)}}else Tb&&(mc=this.remuxVideo(ca,jb,gb,0));mc&&(mc.firstKeyFrame=
Ob,mc.independent=-1!==Ob)}}return this.ISGenerated&&(za.samples.length&&($a=this.remuxID3(za,Ka)),ta.samples.length&&(Na=this.remuxText(ta,Ka))),{audio:na,video:mc,initSegment:Ia,independent:rb,text:Na,id3:$a}},Q.generateIS=function(V,ca,za){var ta,Ka,cb,gb=V.samples,Ya=ca.samples,na=this.typeSupported,Ia={},Na=!Object(y.a)(this._initPTS),$a="audio/mp4";if(Na&&(ta=Ka=1/0),V.config&&gb.length&&(V.timescale=V.samplerate,V.isAAC||(na.mpeg?($a="audio/mpeg",V.codec=""):na.mp3&&(V.codec="mp3")),Ia.audio=
{id:"audio",container:$a,codec:V.codec,initSegment:!V.isAAC&&na.mpeg?new Uint8Array(0):E.initSegment([V]),metadata:{channelCount:V.channelCount}},Na&&(cb=V.inputTimeScale,ta=Ka=gb[0].pts-Math.round(cb*za))),ca.sps&&ca.pps&&Ya.length&&(ca.timescale=ca.inputTimeScale,Ia.video={id:"main",container:"video/mp4",codec:ca.codec,initSegment:E.initSegment([ca]),metadata:{width:ca.width,height:ca.height}},Na))cb=ca.inputTimeScale,V=this.getVideoStartPts(Ya),za=Math.round(cb*za),Ka=Math.min(Ka,t(Ya[0].dts,V)-
za),ta=Math.min(ta,V-za);if(Object.keys(Ia).length)return this.ISGenerated=!0,Na&&(this._initPTS=ta,this._initDTS=Ka),{tracks:Ia,initPTS:ta,timescale:cb}},Q.remuxVideo=function(V,ca,za,ta){var Ka=V.inputTimeScale,cb=V.samples,gb=[],Ya=cb.length;var na=this._initPTS;var Ia=this.nextAvcDts,Na=8,$a=Number.POSITIVE_INFINITY,rb=Number.NEGATIVE_INFINITY,lb=0;var jb=!1;za&&null!==Ia||(Ia=ca*Ka-(cb[0].pts-t(cb[0].dts,cb[0].pts)));for(ca=0;ca<Ya;ca++){var yb=cb[ca];if(yb.pts=t(yb.pts-na,Ia),yb.dts=t(yb.dts-
na,Ia),yb.dts>yb.pts)lb=Math.max(Math.min(lb,yb.pts-yb.dts),-18E3);yb.dts<cb[0<ca?ca-1:ca].dts&&(jb=!0)}jb&&cb.sort(function(Ec,Sc){var Je=Ec.pts-Sc.pts;return Ec.dts-Sc.dts||Je});na=cb[0].dts;jb=cb[cb.length-1].dts;jb=Math.round((jb-na)/(Ya-1));if(0>lb){if(lb<-2*jb)for(R.b.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(ea.b)(-jb,!0)+" ms"),na=lb,lb=0;lb<Ya;lb++)cb[lb].dts=na=Math.max(na,cb[lb].pts-jb),cb[lb].pts=Math.max(na,cb[lb].pts);else for(R.b.warn("PTS < DTS detected in video samples, shifting DTS by "+
Object(ea.b)(lb,!0)+" ms to overcome this issue"),na=0;na<Ya;na++)cb[na].dts+=lb;na=cb[0].dts}za&&(za=na-Ia,(jb=za>jb)||-1>za)&&(jb?R.b.warn("AVC: "+Object(ea.b)(za,!0)+" ms ("+za+"dts) hole between fragments detected, filling it"):R.b.warn("AVC: "+Object(ea.b)(-za,!0)+" ms ("+za+"dts) overlapping between fragments detected"),na=Ia,jb=cb[0].pts-za,cb[0].dts=na,cb[0].pts=jb,R.b.log("Video: First PTS/DTS adjusted: "+Object(ea.b)(jb,!0)+"/"+Object(ea.b)(na,!0)+", delta: "+Object(ea.b)(za,!0)+" ms"));
sa&&(na=Math.max(0,na));for(jb=za=Ia=0;jb<Ya;jb++){lb=cb[jb];ca=lb.units;yb=ca.length;for(var wb=0,Bb=0;Bb<yb;Bb++)wb+=ca[Bb].data.length;za+=wb;Ia+=yb;lb.length=wb;lb.dts=Math.max(lb.dts,na);lb.pts=Math.max(lb.pts,lb.dts,0);$a=Math.min(lb.pts,$a);rb=Math.max(lb.pts,rb)}jb=cb[Ya-1].dts;za=za+4*Ia+8;try{var Tb=new Uint8Array(za)}catch(Ec){return void this.observer.emit(H.a.ERROR,H.a.ERROR,{type:O.b.MUX_ERROR,details:O.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:za,reason:"fail allocating video mdat "+za})}Ia=
new DataView(Tb.buffer);Ia.setUint32(0,za);Tb.set(E.types.mdat,4);for(za=0;za<Ya;za++){lb=cb[za];yb=lb.units;wb=ca=0;for(Bb=yb.length;wb<Bb;wb++){var Ob=yb[wb],Ab=Ob.data;Ob=Ob.data.byteLength;Ia.setUint32(Na,Ob);Na+=4;Tb.set(Ab,Na);Na+=Ob;ca+=4+Ob}if(za<Ya-1)var mc=cb[za+1].dts-lb.dts;else yb=this.config,wb=lb.dts-cb[0<za?za-1:za].dts,yb.stretchShortVideoTrack&&null!==this.nextAudioPts?(Bb=(ta?$a+ta*Ka:this.nextAudioPts)-lb.pts,Bb>Math.floor(yb.maxBufferHole*Ka)?(0>(mc=Bb-wb)&&(mc=wb),R.b.log("[mp4-remuxer]: It is approximately "+
Bb/90+" ms to the next segment; using duration "+mc/90+" ms for the last video frame.")):mc=wb):mc=wb;gb.push(new U(lb.key,mc,ca,Math.round(lb.pts-lb.dts)))}gb.length&&T&&70>T&&(ta=gb[0].flags,ta.dependsOn=2,ta.isNonSync=0);this.nextAvcDts=Ia=jb+mc;this.isVideoContiguous=!0;mc={data1:E.moof(V.sequenceNumber++,na,m({},V,{samples:gb})),data2:Tb,startPTS:$a/Ka,endPTS:(rb+mc)/Ka,startDTS:na/Ka,endDTS:Ia/Ka,type:"video",hasAudio:!1,hasVideo:!0,nb:gb.length,dropped:V.dropped};return V.samples=[],V.dropped=
0,mc},Q.remuxAudio=function(V,ca,za,ta,Ka){var cb=V.inputTimeScale,gb=cb/(V.samplerate?V.samplerate:cb),Ya=V.isAAC?1024:1152,na=Ya*gb,Ia=this._initPTS,Na=!V.isAAC&&this.typeSupported.mpeg,$a=[],rb=V.samples,lb=Na?0:8,jb=this.nextAudioPts||-1,yb=ca*cb;if(this.isAudioContiguous=za=za||rb.length&&0<jb&&(ta&&9E3>Math.abs(yb-jb)||Math.abs(t(rb[0].pts-Ia,yb)-jb)<20*na),rb.forEach(function(Sc){Sc.pts=t(Sc.pts-Ia,yb)}),!za||0>jb){if(!(rb=rb.filter(function(Sc){return 0<=Sc.pts})).length)return;jb=0===Ka?
0:ta?Math.max(0,yb):rb[0].pts}if(V.isAAC){ca=void 0!==Ka;ta=this.config.maxAudioFramesDrift;Ka=0;for(var wb=jb;Ka<rb.length;Ka++){var Bb=rb[Ka],Tb=Bb.pts,Ob=Tb-wb,Ab=Math.abs(1E3*Ob/cb);if(Ob<=-ta*na&&ca)0===Ka&&(R.b.warn("Audio frame @ "+(Tb/cb).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1E3*Ob/cb)+" ms."),this.nextAudioPts=jb=wb=Tb);else if(Ob>=ta*na&&1E4>Ab&&ca)for(Ab=Math.round(Ob/na),0>(wb=Tb-Ab*na)&&(Ab--,wb+=na),0===Ka&&(this.nextAudioPts=jb=wb),R.b.warn("[mp4-remuxer]: Injecting "+
Ab+" audio frame @ "+(wb/cb).toFixed(3)+"s due to "+Math.round(1E3*Ob/cb)+" ms gap."),Tb=0;Tb<Ab;Tb++){Ob=Math.max(wb,0);var mc=C.getSilentFrame(V.manifestCodec||V.codec,V.channelCount);mc||(R.b.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),mc=Bb.unit.subarray());rb.splice(Ka,0,{unit:mc,pts:Ob});wb+=na;Ka++}Bb.pts=wb;wb+=na}}ca=na=null;ta=0;for(Ka=rb.length;Ka--;)ta+=rb[Ka].unit.byteLength;Ka=0;for(wb=rb.length;Ka<wb;Ka++){Ab=rb[Ka];Bb=Ab.unit;
Ab=Ab.pts;if(null!==ca)$a[Ka-1].duration=Math.round((Ab-ca)/gb);else{if(za&&V.isAAC&&(Ab=jb),na=Ab,!(0<ta))return;ta+=lb;try{var Ec=new Uint8Array(ta)}catch(Sc){return void this.observer.emit(H.a.ERROR,H.a.ERROR,{type:O.b.MUX_ERROR,details:O.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:ta,reason:"fail allocating audio mdat "+ta})}Na||((new DataView(Ec.buffer)).setUint32(0,ta),Ec.set(E.types.mdat,4))}Ec.set(Bb,lb);ca=Bb.byteLength;lb+=ca;$a.push(new U(!0,Ya,ca,0));ca=Ab}if(za=$a.length)return this.nextAudioPts=
jb=ca+gb*$a[$a.length-1].duration,gb=Na?new Uint8Array(0):E.moof(V.sequenceNumber++,na/gb,m({},V,{samples:$a})),V.samples=[],V=na/cb,cb=jb/cb,Ec={data1:gb,data2:Ec,startPTS:V,endPTS:cb,startDTS:V,endDTS:cb,type:"audio",hasAudio:!0,hasVideo:!1,nb:za},this.isAudioContiguous=!0,Ec},Q.remuxEmptyAudio=function(V,ca,za,ta){var Ka=V.inputTimeScale,cb=this.nextAudioPts;cb=(null!==cb?cb:ta.startDTS*Ka)+this._initDTS;var gb=Ka/(V.samplerate?V.samplerate:Ka)*1024;ta=Math.ceil((ta.endDTS*Ka+this._initDTS-cb)/
gb);Ka=C.getSilentFrame(V.manifestCodec||V.codec,V.channelCount);if(R.b.warn("[mp4-remuxer]: remux empty Audio"),Ka){for(var Ya=[],na=0;na<ta;na++){var Ia=cb+na*gb;Ya.push({unit:Ka,pts:Ia,dts:Ia})}return V.samples=Ya,this.remuxAudio(V,ca,za,!1)}R.b.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},Q.remuxID3=function(V,ca){var za=V.samples.length;if(za){for(var ta=V.inputTimeScale,Ka=this._initPTS,cb=this._initDTS,gb=0;gb<za;gb++){var Ya=
V.samples[gb];Ya.pts=t(Ya.pts-Ka,ca*ta)/ta;Ya.dts=t(Ya.dts-cb,ca*ta)/ta}ca=V.samples;return V.samples=[],{samples:ca}}},Q.remuxText=function(V,ca){var za=V.samples.length;if(za){for(var ta=V.inputTimeScale,Ka=this._initPTS,cb=0;cb<za;cb++){var gb=V.samples[cb];gb.pts=t(gb.pts-Ka,ca*ta)/ta}V.samples.sort(function(Ya,na){return Ya.pts-na.pts});ca=V.samples;return V.samples=[],{samples:ca}}},M}(),U=function(M,Q,V,ca){this.flags=this.cts=this.duration=this.size=void 0;this.duration=Q;this.size=V;this.cts=
ca;this.flags=new qa(M)},qa=function(M){this.degradPrio=this.hasRedundancy=this.isDependedOn=this.isLeading=0;this.isNonSync=this.dependsOn=1;this.dependsOn=M?2:1;this.isNonSync=M?0:1}},function(a,e,h){function m(C,I){for(var E=0;E<I.length;E++){var H=I[E];H.enumerable=H.enumerable||!1;H.configurable=!0;"value"in H&&(H.writable=!0);Object.defineProperty(C,H.key,H)}}h.d(e,"a",function(){return y});var t=h(11),y=function(){function C(E,H){this.iv=this.key=this.keyID=this.keyFormatVersions=this.keyFormat=
this.method=this._uri=null;this._uri=H?Object(t.buildAbsoluteURL)(E,H,{alwaysNormalize:!0}):E}var I;return C.fromURL=function(E,H){return new C(E,H)},C.fromURI=function(E){return new C(E)},I=[{key:"uri",get:function(){return this._uri}}],m(C.prototype,I),C}()},function(a,e,h){function m(C){function I(O){if(E[O])return E[O].exports;var R=E[O]={i:O,l:!1,exports:{}};return C[O].call(R.exports,R,R.exports,I),R.l=!0,R.exports}var E={};I.m=C;I.c=E;I.i=function(O){return O};I.d=function(O,R,W){I.o(O,R)||
Object.defineProperty(O,R,{configurable:!1,enumerable:!0,get:W})};I.r=function(O){Object.defineProperty(O,"__esModule",{value:!0})};I.n=function(O){var R=O&&O.__esModule?function(){return O.default}:function(){return O};return I.d(R,"a",R),R};I.o=function(O,R){return Object.prototype.hasOwnProperty.call(O,R)};I.p="/";I.oe=function(O){throw console.error(O),O;};var H=I(I.s=ENTRY_MODULE);return H.default||H}function t(C){return(C+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function y(C){return Object.keys(C).reduce(function(I,
E){return I||0<C[E].length},!1)}a.exports=function(C,I){I=I||{};var E={main:h.m},H=I.all?{main:Object.keys(E.main)}:function(R,W){W={main:[W]};for(var ea={main:[]},T={main:{}};y(W);)for(var fa=Object.keys(W),sa=0;sa<fa.length;sa++){var wa=fa[sa],U=W[wa].pop();if(T[wa]=T[wa]||{},!T[wa][U]&&R[wa][U]){T[wa][U]=!0;ea[wa]=ea[wa]||[];ea[wa].push(U);var qa;var M=R;var Q=R[wa][U];U=wa;wa={};wa[U]=[];Q=Q.toString();if(qa=Q.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)){for(var V=qa[1],ca=new RegExp("(\\\\n|\\W)"+
t(V)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");qa=ca.exec(Q);)"dll-reference"!==qa[3]&&wa[U].push(qa[3]);for(ca=new RegExp("\\("+t(V)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");qa=ca.exec(Q);)M[qa[2]]||(wa[U].push(qa[1]),M[qa[2]]=h(qa[1]).m),wa[qa[2]]=wa[qa[2]]||[],wa[qa[2]].push(qa[4]);U=Object.keys(wa);for(Q=0;Q<U.length;Q++)for(qa=0;qa<wa[U[Q]].length;qa++)M=wa[U[Q]][qa],isNaN(1*M)||(wa[U[Q]][qa]*=
1)}M=Object.keys(wa);for(U=0;U<M.length;U++)W[M[U]]=W[M[U]]||[],W[M[U]]=W[M[U]].concat(wa[M[U]])}}return ea}(E,C),O="";Object.keys(H).filter(function(R){return"main"!==R}).forEach(function(R){for(var W=0;H[R][W];)W++;H[R].push(W);E[R][W]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })";O=O+"var "+R+" = ("+m.toString().replace("ENTRY_MODULE",JSON.stringify(W))+")({"+H[R].map(function(ea){return JSON.stringify(ea)+": "+E[R][ea].toString()}).join(",")+"});\n"});
O=O+"new (("+m.toString().replace("ENTRY_MODULE",JSON.stringify(C))+")({"+H.main.map(function(R){return JSON.stringify(R)+": "+E.main[R].toString()}).join(",")+"}))(self);";C=new window.Blob([O],{type:"text/javascript"});if(I.bare)return C;I=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(C);C=new window.Worker(I);return C.objectURL=I,C}},function(a,e,h){function m(R){var W=new O.EventEmitter,ea=function(T,fa){R.postMessage({event:T,data:fa})};W.on(E.a.FRAG_DECRYPTED,ea);
W.on(E.a.ERROR,ea);R.addEventListener("message",function(T){T=T.data;switch(T.cmd){case "init":var fa=JSON.parse(T.config);R.transmuxer=new I.c(W,T.typeSupported,fa,T.vendor,T.id);Object(H.a)(fa.debug);ea("init",null);break;case "configure":R.transmuxer.configure(T.config);break;case "demux":T=R.transmuxer.push(T.data,T.decryptdata,T.chunkMeta,T.state);Object(I.d)(T)?T.then(function(wa){t(R,wa)}):t(R,T);break;case "flush":var sa=T.chunkMeta;T=R.transmuxer.flush(sa);Object(I.d)(T)?T.then(function(wa){C(R,
wa,sa)}):C(R,T,sa)}})}function t(R,W){if((ea=W.remuxResult).audio||ea.video||ea.text||ea.id3||ea.initSegment){var ea;ea=[];var T=W.remuxResult,fa=T.audio;T=T.video;fa&&y(ea,fa);T&&y(ea,T);R.postMessage({event:"transmuxComplete",data:W},ea)}}function y(R,W){W.data1&&R.push(W.data1.buffer);W.data2&&R.push(W.data2.buffer)}function C(R,W,ea){W.forEach(function(T){t(R,T)});R.postMessage({event:"flush",data:ea})}h.r(e);h.d(e,"default",function(){return m});var I=h(10),E=h(0),H=h(1),O=h(14)},function(a,
e,h){function m(G,z){for(var p=0;p<z.length;p++){var n=z[p];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(G,n.key,n)}}function t(G,z){return MediaSource.isTypeSupported((z||"video")+'/mp4;codecs="'+G+'"')}function y(G,z){["video","audio","text"].forEach(function(p){var n=G.filter(function(q){var u=fi[p];return!!u&&!0===u[q.slice(0,4)]});if(n.length){var k=n.filter(function(q){return 0===q.lastIndexOf("avc1",0)||0===q.lastIndexOf("mp4a",0)});z[p+
"Codec"]=0<k.length?k[0]:n[0];G=G.filter(function(q){return-1===n.indexOf(q)})}});z.unknownCodecs=G}function C(G,z){G.rawProgramDateTime?G.programDateTime=Date.parse(G.rawProgramDateTime):null!=z&&z.programDateTime&&(G.programDateTime=z.endProgramDateTime);Object(Zb.a)(G.programDateTime)||(G.programDateTime=null,G.rawProgramDateTime=null)}function I(G,z){G=G.url;return void 0!==G&&0!==G.indexOf("data:")||(G=z.url),G}function E(G,z){try{var p=new Event("addtrack")}catch(n){(p=document.createEvent("Event")).initEvent("addtrack",
!1,!1)}p.track=G;z.dispatchEvent(p)}function H(G,z){var p=G.mode;if("disabled"===p&&(G.mode="hidden"),G.cues&&!G.cues.getCueById(z.id))try{if(G.addCue(z),!G.cues.getCueById(z.id))throw Error("addCue is failed for: "+z);}catch(k){Ua.b.debug("[texttrack-utils]: "+k);var n=new self.TextTrackCue(z.startTime,z.endTime,z.text);n.id=z.id;G.addCue(n)}"disabled"===p&&(G.mode=p)}function O(G){var z=G.mode;if("disabled"===z&&(G.mode="hidden"),G.cues)for(var p=G.cues.length;p--;)G.removeCue(G.cues[p]);"disabled"===
z&&(G.mode=z)}function R(G,z,p){var n=G.mode;if("disabled"===n&&(G.mode="hidden"),G.cues&&0<G.cues.length)for(z=function(k,q,u){var B=[],F=function(ja,ya){if(ya<ja[0].startTime)return 0;var Xa=ja.length-1;if(ya>ja[Xa].endTime)return-1;for(var La=0,Wa=Xa;La<=Wa;){var db=Math.floor((Wa+La)/2);if(ya<ja[db].startTime)Wa=db-1;else{if(!(ya>ja[db].startTime&&La<Xa))return db;La=db+1}}return ja[La].startTime-ya<ya-ja[Wa].startTime?La:Wa}(k,q);if(-1<F)for(var K=k.length;F<K;F++){var Z=k[F];if(Z.startTime>=
q&&Z.endTime<=u)B.push(Z);else if(Z.startTime>u)break}return B}(G.cues,z,p),p=0;p<z.length;p++)G.removeCue(z[p]);"disabled"===n&&(G.mode=n)}function W(G,z){for(var p=0;p<z.length;p++){var n=z[p];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(G,n.key,n)}}function ea(G,z){for(var p=0;p<z.length;p++){var n=z[p];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(G,n.key,n)}}function T(G,z,p){switch(z){case "audio":G.audioGroupIds||
(G.audioGroupIds=[]);G.audioGroupIds.push(p);break;case "text":G.textGroupIds||(G.textGroupIds=[]),G.textGroupIds.push(p)}}function fa(G){var z={};G.forEach(function(p){var n=p.groupId||"";p.id=z[n]=z[n]||0;z[n]++})}function sa(G,z){var p=z.startPTS;if(Object(Zb.a)(p)){var n,k=0;z.sn>G.sn?(k=p-G.start,n=G):(k=G.start-p,n=z);n.duration!==k&&(n.duration=k)}else z.sn>G.sn?G.cc===z.cc&&G.minEndPTS?z.start=G.start+(G.minEndPTS-G.start):z.start=G.start+G.duration:z.start=Math.max(G.start-z.duration,0)}
function wa(G,z,p,n,k,q){0>=n-p&&(Ua.b.warn("Fragment should have a positive duration",z),n=p+z.duration,q=k+z.duration);var u=p,B=n,F=z.startPTS,K=z.endPTS;Object(Zb.a)(F)&&(u=Math.abs(F-p),Object(Zb.a)(z.deltaPTS)?z.deltaPTS=Math.max(u,z.deltaPTS):z.deltaPTS=u,u=Math.max(p,F),p=Math.min(p,F),k=Math.min(k,z.startDTS),B=Math.min(n,K),n=Math.max(n,K),q=Math.max(q,z.endDTS));z.duration=n-p;F=p-z.start;z.appendedPTS=n;z.start=z.startPTS=p;z.maxStartPTS=u;z.startDTS=k;z.endPTS=n;z.minEndPTS=B;z.endDTS=
q;p=z.sn;if(!G||p<G.startSN||p>G.endSN)return 0;p-=G.startSN;n=G.fragments;n[p]=z;for(z=p;0<z;z--)sa(n[z],n[z-1]);for(z=p;z<n.length-1;z++)sa(n[z],n[z+1]);return G.fragmentHint&&sa(n[n.length-1],G.fragmentHint),G.PTSKnown=G.alignedSliding=!0,F}function U(G,z){for(var p=null,n=G.fragments,k=n.length-1;0<=k;k--){var q=n[k].initSegment;if(q){p=q;break}}G.fragmentHint&&delete G.fragmentHint.endPTS;var u,B=0;(function(F,K,Z){var ja=K.skippedSegments,ya=Math.max(F.startSN,K.startSN)-K.startSN,Xa=(F.fragmentHint?
1:0)+(ja?K.endSN:Math.min(F.endSN,K.endSN))-K.startSN,La=K.startSN-F.startSN,Wa=K.fragmentHint?K.fragments.concat(K.fragmentHint):K.fragments;for(F=F.fragmentHint?F.fragments.concat(F.fragmentHint):F.fragments;ya<=Xa;ya++){var db=F[La+ya],bb=Wa[ya];ja&&!bb&&ya<ja&&(bb=K.fragments[ya]=db);db&&bb&&Z(db,bb)}}(G,z,function(F,K){F.relurl&&(B=F.cc-K.cc);Object(Zb.a)(F.startPTS)&&Object(Zb.a)(F.endPTS)&&(K.start=K.startPTS=F.startPTS,K.startDTS=F.startDTS,K.appendedPTS=F.appendedPTS,K.maxStartPTS=F.maxStartPTS,
K.endPTS=F.endPTS,K.endDTS=F.endDTS,K.minEndPTS=F.minEndPTS,K.duration=F.endPTS-F.startPTS,K.duration&&(u=K),z.PTSKnown=z.alignedSliding=!0);K.elementaryStreams=F.elementaryStreams;K.loader=F.loader;K.stats=F.stats;K.urlId=F.urlId;F.initSegment&&(K.initSegment=F.initSegment,p=F.initSegment)}),p)&&(z.fragmentHint?z.fragments.concat(z.fragmentHint):z.fragments).forEach(function(F){var K;F.initSegment&&F.initSegment.relurl!==(null===(K=p)||void 0===K?void 0:K.relurl)||(F.initSegment=p)});if(z.skippedSegments&&
(z.deltaUpdateFailed=z.fragments.some(function(F){return!F}),z.deltaUpdateFailed)){Ua.b.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(n=z.skippedSegments;n--;)z.fragments.shift();z.startSN=z.fragments[0].sn;z.startCC=z.fragments[0].cc}n=z.fragments;if(B)for(Ua.b.warn("discontinuity sliding from playlist, take drift into account"),k=0;k<n.length;k++)n[k].cc+=B;z.skippedSegments&&(z.startCC=z.fragments[0].cc);(function(F,K,Z){if(F&&K)for(var ja=0,ya=0,Xa=F.length;ya<=
Xa;ya++){var La=F[ya],Wa=K[ya+ja];La&&Wa&&La.index===Wa.index&&La.fragment.sn===Wa.fragment.sn?Z(La,Wa):ja--}})(G.partList,z.partList,function(F,K){K.elementaryStreams=F.elementaryStreams;K.stats=F.stats});u?wa(z,u,u.startPTS,u.endPTS,u.startDTS,u.endDTS):qa(G,z);n.length&&(z.totalduration=z.edge-n[0].start);z.driftStartTime=G.driftStartTime;z.driftStart=G.driftStart;n=z.advancedDateTime;z.advanced&&n?(G=z.edge,z.driftStart||(z.driftStartTime=n,z.driftStart=G),z.driftEndTime=n,z.driftEnd=G):(z.driftEndTime=
G.driftEndTime,z.driftEnd=G.driftEnd,z.advancedDateTime=G.advancedDateTime)}function qa(G,z){var p=z.startSN+z.skippedSegments-G.startSN;G=G.fragments;0>p||p>=G.length||M(z,G[p].start)}function M(G,z){if(z){for(var p=G.fragments,n=G.skippedSegments;n<p.length;n++)p[n].start+=z;G.fragmentHint&&(G.fragmentHint.start+=z)}}function Q(){return(Q=Object.assign||function(G){for(var z=1;z<arguments.length;z++){var p=arguments[z],n;for(n in p)Object.prototype.hasOwnProperty.call(p,n)&&(G[n]=p[n])}return G}).apply(this,
arguments)}function V(G,z){for(var p=0;p<z.length;p++){var n=z[p];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(G,n.key,n)}}function ca(G,z){return(ca=Object.setPrototypeOf||function(p,n){return p.__proto__=n,p})(G,z)}function za(G){var z,p;return G.buffered&&((null===(z=G.range.video)||void 0===z?void 0:z.partial)||(null===(p=G.range.audio)||void 0===p?void 0:p.partial))}function ta(G){return G.type+"_"+G.level+"_"+G.urlId+"_"+G.sn}function Ka(G,
z){G&&(z=G.start+z,G.start=G.startPTS=z,G.endPTS=z+G.duration)}function cb(G,z){for(var p=z.fragments,n=0,k=p.length;n<k;n++)Ka(p[n],G);z.fragmentHint&&Ka(z.fragmentHint,G);z.alignedSliding=!0}function gb(G,z,p){z&&(!function(n,k,q){if(q.details&&(k.endCC>k.startCC||n&&n.cc<k.startCC)){a:{n=q.details.fragments;q=k.fragments;if(q.length&&n.length){for(var u=null,B=0,F=n.length;B<F;B++){var K=n[B];if(K&&K.cc===q[0].cc){u=K;break}}if((n=u)&&(!n||n.startPTS))break a;Ua.b.log("No frag in previous level to align on")}else Ua.b.log("No fragments to align");
n=void 0}n&&Object(Zb.a)(n.start)&&(Ua.b.log("Adjusting PTS using last level due to CC increase within current level "+k.url),cb(n.start,k))}}(G,p,z),!p.alignedSliding&&z.details&&function(n,k){if(k.fragments.length&&n.hasProgramDateTime&&k.hasProgramDateTime){var q=k.fragments[0].programDateTime,u=n.fragments[0].programDateTime;(k=(u-q)/1E3+k.fragments[0].start)&&Object(Zb.a)(k)&&(Ua.b.log("Adjusting PTS using programDateTime delta "+(u-q)+"ms, sliding:"+k.toFixed(3)+" "+n.url+" "),cb(k,n))}}(p,
z.details),p.alignedSliding||!z.details||p.skippedSegments||qa(z.details,p))}function Ya(G,z){var p=G.programDateTime;p&&(z=(p-z)/1E3,G.start=G.startPTS=z,G.endPTS=z+G.duration)}function na(G,z){if(z.fragments.length&&G.hasProgramDateTime&&z.hasProgramDateTime){var p=z.fragments[0].programDateTime-1E3*z.fragments[0].start;G.fragments.forEach(function(n){Ya(n,p)});G.fragmentHint&&Ya(G.fragmentHint,p);G.alignedSliding=!0}}function Ia(G,z,p,n){void 0===p&&(p=0);void 0===n&&(n=0);var k=null;return(G?
k=z[G.sn-z[0].sn+1]||null:0===p&&0===z[0].start&&(k=z[0]),k&&0===Na(p,n,k))?k:Og.search(z,Na.bind(null,p,n))||k}function Na(G,z,p){void 0===G&&(G=0);void 0===z&&(z=0);z=Math.min(z,p.duration+(p.deltaPTS?p.deltaPTS:0));return p.start+p.duration-z<=G?1:p.start-z>G&&p.start?-1:0}function $a(G){var z="function"==typeof Map?new Map:void 0;return($a=function(p){function n(){return rb(p,arguments,yb(this).constructor)}if(null===p||(k=p,-1===Function.toString.call(k).indexOf("[native code]")))return p;var k;
if("function"!=typeof p)throw new TypeError("Super expression must either be null or a function");if(void 0!==z){if(z.has(p))return z.get(p);z.set(p,n)}return n.prototype=Object.create(p.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),jb(n,p)})(G)}function rb(G,z,p){return(rb=lb()?Reflect.construct:function(n,k,q){var u=[null];u.push.apply(u,k);n=new (Function.bind.apply(n,u));return q&&jb(n,q.prototype),n}).apply(null,arguments)}function lb(){if("undefined"==typeof Reflect||
!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(G){return!1}}function jb(G,z){return(jb=Object.setPrototypeOf||function(p,n){return p.__proto__=n,p})(G,z)}function yb(G){return(yb=Object.setPrototypeOf?Object.getPrototypeOf:function(z){return z.__proto__||Object.getPrototypeOf(z)})(G)}function wb(G,z){void 0===z&&(z=null);var p=z||G;G={frag:G,part:z,responseType:"arraybuffer",
url:p.url,headers:{},rangeStart:0,rangeEnd:0};z=p.byteRangeStartOffset;p=p.byteRangeEndOffset;return Object(Zb.a)(z)&&Object(Zb.a)(p)&&(G.rangeStart=z,G.rangeEnd=p),G}function Bb(G,z){for(var p=0;p<z.length;p++){var n=z[p];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(G,n.key,n)}}function Tb(G,z){return(Tb=Object.setPrototypeOf||function(p,n){return p.__proto__=n,p})(G,z)}function Ob(G,z){for(var p=0;p<z.length;p++){var n=z[p];n.enumerable=n.enumerable||
!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(G,n.key,n)}}function Ab(G,z){return(Ab=Object.setPrototypeOf||function(p,n){return p.__proto__=n,p})(G,z)}function mc(G,z){for(var p=0;p<z.length;p++){var n=z[p];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(G,n.key,n)}}function Ec(){return(Ec=Object.assign||function(G){for(var z=1;z<arguments.length;z++){var p=arguments[z],n;for(n in p)Object.prototype.hasOwnProperty.call(p,
n)&&(G[n]=p[n])}return G}).apply(this,arguments)}function Sc(G,z){return(Sc=Object.setPrototypeOf||function(p,n){return p.__proto__=n,p})(G,z)}function Je(G,z){for(var p=0;p<z.length;p++){var n=z[p];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(G,n.key,n)}}function lf(G,z){return(lf=Object.setPrototypeOf||function(p,n){return p.__proto__=n,p})(G,z)}function Ma(G,z){for(var p=0;p<z.length;p++){var n=z[p];n.enumerable=n.enumerable||!1;n.configurable=
!0;"value"in n&&(n.writable=!0);Object.defineProperty(G,n.key,n)}}function va(G,z){return(va=Object.setPrototypeOf||function(p,n){return p.__proto__=n,p})(G,z)}function X(G,z){for(var p=0;p<z.length;p++){var n=z[p];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(G,n.key,n)}}function aa(G,z){return(aa=Object.setPrototypeOf||function(p,n){return p.__proto__=n,p})(G,z)}function ma(G){for(var z=[],p=0;p<G.length;p++){var n=G[p];"subtitles"===n.kind&&
n.label&&z.push(G[p])}return z}function Da(G){return(G=G.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/))?59<parseFloat(G[2])?3600*(0|G[2])+60*(0|G[3])+parseFloat(G[4]||0):3600*(0|G[1])+60*(0|G[2])+(0|G[3])+parseFloat(G[4]||0):null}function Ha(G,z,p,n){G=n?G.split(n):[G];for(var k in G)"string"==typeof G[k]&&(n=G[k].split(p),2===n.length&&z(n[0],n[1]))}function Sa(G,z,p){function n(){var u=Da(G);if(null===u)throw Error("Malformed timestamp: "+q);return G=G.replace(/^[^\sa-zA-Z-]+/,""),u}function k(){G=
G.replace(/^\s+/,"")}var q=G;if(k(),z.startTime=n(),k(),"--\x3e"!==G.substr(0,3))throw Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+q);G=G.substr(3);k();z.endTime=n();k();(function(u,B){var F=new Xe;Ha(u,function(K,Z){switch(K){case "region":for(var ja=p.length-1;0<=ja;ja--)if(p[ja].id===Z){F.set(K,p[ja].region);break}break;case "vertical":F.alt(K,Z,["rl","lr"]);break;case "line":Z=Z.split(",");F.integer(K,Z[0]);F.percent(K,Z[0])&&F.set("snapToLines",!1);F.alt(K,Z[0],
["auto"]);2===Z.length&&F.alt("lineAlign",Z[1],["start",Ye,"end"]);break;case "position":Z=Z.split(",");F.percent(K,Z[0]);2===Z.length&&F.alt("positionAlign",Z[1],["start",Ye,"end","line-left","line-right","auto"]);break;case "size":F.percent(K,Z);break;case "align":F.alt(K,Z,["start",Ye,"end","left","right"])}},/:/,/\s/);B.region=F.get("region",null);B.vertical=F.get("vertical","");u=F.get("line","auto");"auto"===u&&-1===Wd.line&&(u=-1);B.line=u;B.lineAlign=F.get("lineAlign","start");B.snapToLines=
F.get("snapToLines",!0);B.size=F.get("size",100);B.align=F.get("align",Ye);u=F.get("position","auto");"auto"===u&&50===Wd.position&&(u="start"===B.align||"left"===B.align?0:"end"===B.align||"right"===B.align?100:50);B.position=u})(G,z)}function Fa(G,z,p){return Ze(G.toString())+Ze(z.toString())+Ze(p)}function ob(G,z,p,n,k,q,u,B){var F,K=new Ed;G=Object(of.f)(new Uint8Array(G)).trim().replace(yi,"\n").split("\n");var Z=[],ja=Object(we.a)(z,p),ya="00:00.000",Xa=0,La=0,Wa=!0,db=!1;K.oncue=function(bb){var sb=
n[k],Wb=n.ccOffset,tb=(Xa-ja)/9E4;if(null!=sb&&sb.new)if(void 0!==La)Wb=n.ccOffset=sb.start;else{sb=n[k];var bc=n[sb.prevCC];if(!bc||!bc.new&&sb.new)n.ccOffset=n.presentationOffset=sb.start,sb.new=!1;else{for(;null!==(fc=bc)&&void 0!==fc&&fc.new;){var fc;n.ccOffset+=sb.start-bc.start;sb.new=!1;bc=n[(sb=bc).prevCC]}n.presentationOffset=tb}}if(tb&&(Wb=tb-n.presentationOffset),db)tb=bb.endTime-bb.startTime,Wb=Object(xi.b)(9E4*(bb.startTime+Wb-La),9E4*q)/9E4,bb.startTime=Wb,bb.endTime=Wb+tb;Wb=bb.text.trim();
bb.text=decodeURIComponent(encodeURIComponent(Wb));bb.id||(bb.id=Fa(bb.startTime,bb.endTime,Wb));0<bb.endTime&&Z.push(bb)};K.onparsingerror=function(bb){F=bb};K.onflush=function(){F?B(F):u(Z)};G.forEach(function(bb){if(Wa){if(bg(bb,"X-TIMESTAMP-MAP=")){Wa=!1;db=!0;bb.substr(16).split(",").forEach(function(sb){bg(sb,"LOCAL:")?ya=sb.substr(6):bg(sb,"MPEGTS:")&&(Xa=parseInt(sb.substr(7)))});try{La=function(sb){var Wb=parseInt(sb.substr(-3)),tb=parseInt(sb.substr(-6,2)),bc=parseInt(sb.substr(-9,2)),fc=
9<sb.length?parseInt(sb.substr(0,sb.indexOf(":"))):0;if(!(Object(Zb.a)(Wb)&&Object(Zb.a)(tb)&&Object(Zb.a)(bc)&&Object(Zb.a)(fc)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+sb);return Wb+=1E3*tb,Wb+=6E4*bc,Wb+36E5*fc}(ya)/1E3}catch(sb){db=!1,F=sb}return}""===bb&&(Wa=!1)}K.parse(bb+"\n")});K.flush()}function mb(){return(mb=Object.assign||function(G){for(var z=1;z<arguments.length;z++){var p=arguments[z],n;for(n in p)Object.prototype.hasOwnProperty.call(p,n)&&(G[n]=p[n])}return G}).apply(this,
arguments)}function pb(G,z,p,n,k){var q=Object(Sf.b)(new Uint8Array(G),["mdat"]);if(0!==q.length){q=q[0];G=Object(of.f)(new Uint8Array(G,q.start,q.end-q.start));z=Object(we.c)(z,1,p);try{n(function(u,B){var F=(new DOMParser).parseFromString(u,"text/xml").getElementsByTagName("tt")[0];if(!F)throw Error("Invalid ttml");var K={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},Z=Object.keys(K).reduce(function(La,Wa){return La[Wa]=F.getAttribute("ttp:"+Wa)||K[Wa],La},{}),ja="preserve"!==F.getAttribute("xml:space"),
ya=Mb(Kb(F,"styling","style")),Xa=Mb(Kb(F,"layout","region"));u=Kb(F,"body","[begin]");return[].map.call(u,function(La){var Wa=function fc(tb,bc){return[].slice.call(tb.childNodes).reduce(function(ub,Ac,Uc){var Eb;return"br"===Ac.nodeName&&Uc?ub+"\n":null!==(Eb=Ac.childNodes)&&void 0!==Eb&&Eb.length?fc(Ac,bc):bc?ub+Ac.textContent.trim().replace(/\s+/g," "):ub+Ac.textContent},"")}(La,ja);if(!Wa||!La.hasAttribute("begin"))return null;var db=Ub(La.getAttribute("begin"),Z),bb=Ub(La.getAttribute("dur"),
Z),sb=Ub(La.getAttribute("end"),Z);if(null===db)throw Gb(La);if(null===sb){if(null===bb)throw Gb(La);sb=db+bb}Wa=new We(db-B,sb-B,Wa);Wa.id=Fa(Wa.startTime,Wa.endTime,Wa.text);db=Xa[La.getAttribute("region")];La=ya[La.getAttribute("style")];Wa.position=10;Wa.size=80;La=function(tb,bc){return"displayAlign textAlign color backgroundColor fontSize fontFamily".split(" ").reduce(function(fc,ub){var Ac;(Ac=bc.hasAttributeNS("http://www.w3.org/ns/ttml#styling",ub)?bc.getAttributeNS("http://www.w3.org/ns/ttml#styling",
ub):null)||(Ac=tb.hasAttributeNS("http://www.w3.org/ns/ttml#styling",ub)?tb.getAttributeNS("http://www.w3.org/ns/ttml#styling",ub):null);return Ac&&(fc[ub]=Ac),fc},{})}(db,La);if(db=La.textAlign)(bb=wf[db])&&(Wa.lineAlign=bb),Wa.align=db;return mb(Wa,La),Wa}).filter(function(La){return null!==La})}(G,z))}catch(u){k(u)}}else k(Error("Could not parse IMSC1 mdat"))}function Kb(G,z,p){return(G=G.getElementsByTagName(z)[0])?[].slice.call(G.querySelectorAll(p)):[]}function Mb(G){return G.reduce(function(z,
p){var n=p.getAttribute("xml:id");return n&&(z[n]=p),z},{})}function Gb(G){return Error("Could not parse ttml timestamp "+G)}function Ub(G,z){if(!G)return null;var p=Da(G);return null===p&&(Xd.test(G)?p=function(n,k){n=Xd.exec(n);return 3600*(0|n[1])+60*(0|n[2])+(0|n[3])+((0|n[4])+(0|n[5])/k.subFrameRate)/k.frameRate}(G,z):tc.test(G)&&(p=function(n,k){n=tc.exec(n);var q=Number(n[1]);switch(n[2]){case "h":return 3600*q;case "m":return 60*q;case "ms":return 1E3*q;case "f":return q/k.frameRate;case "t":return q/
k.tickRate}return q}(G,z))),p}function Cc(G,z){for(var p=0;p<z.length;p++){var n=z[p];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(G,n.key,n)}}function id(G,z){for(var p=0;p<z.length;p++){var n=z[p];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(G,n.key,n)}}function Yc(G,z){for(var p=0;p<z.length;p++){var n=z[p];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(G,
n.key,n)}}function zd(G,z,p){return z&&Yc(G.prototype,z),p&&Yc(G,p),G}function Zc(G,z){var p="undefined"!=typeof Symbol&&G[Symbol.iterator]||G["@@iterator"];if(p)return(p=p.call(G)).next.bind(p);if(Array.isArray(G)||(p=function(k,q){if(k){if("string"==typeof k)return oc(k,q);var u=Object.prototype.toString.call(k).slice(8,-1);"Object"===u&&k.constructor&&(u=k.constructor.name);if("Map"===u||"Set"===u)return Array.from(k);if("Arguments"===u||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(u))return oc(k,
q)}}(G))||z&&G&&"number"==typeof G.length){p&&(G=p);var n=0;return function(){return n>=G.length?{done:!0}:{done:!1,value:G[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function oc(G,z){(null==z||z>G.length)&&(z=G.length);for(var p=0,n=Array(z);p<z;p++)n[p]=G[p];return n}function pc(){return(pc=Object.assign||function(G){for(var z=1;z<arguments.length;z++){var p=arguments[z],n;for(n in p)Object.prototype.hasOwnProperty.call(p,
n)&&(G[n]=p[n])}return G}).apply(this,arguments)}function le(G){var z="function"==typeof Map?new Map:void 0;return(le=function(p){function n(){return kc(p,arguments,nf(this).constructor)}if(null===p||(k=p,-1===Function.toString.call(k).indexOf("[native code]")))return p;var k;if("function"!=typeof p)throw new TypeError("Super expression must either be null or a function");if(void 0!==z){if(z.has(p))return z.get(p);z.set(p,n)}return n.prototype=Object.create(p.prototype,{constructor:{value:n,enumerable:!1,
writable:!0,configurable:!0}}),Lc(n,p)})(G)}function kc(G,z,p){return(kc=mf()?Reflect.construct:function(n,k,q){var u=[null];u.push.apply(u,k);n=new (Function.bind.apply(n,u));return q&&Lc(n,q.prototype),n}).apply(null,arguments)}function mf(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(G){return!1}}function Lc(G,z){return(Lc=Object.setPrototypeOf||
function(p,n){return p.__proto__=n,p})(G,z)}function nf(G){return(nf=Object.setPrototypeOf?Object.getPrototypeOf:function(z){return z.__proto__||Object.getPrototypeOf(z)})(G)}function Pd(){return(Pd=Object.assign||function(G){for(var z=1;z<arguments.length;z++){var p=arguments[z],n;for(n in p)Object.prototype.hasOwnProperty.call(p,n)&&(G[n]=p[n])}return G}).apply(this,arguments)}function bi(G,z){return new self.Request(G.url,z)}function Eg(){return(Eg=Object.assign||function(G){for(var z=1;z<arguments.length;z++){var p=
arguments[z],n;for(n in p)Object.prototype.hasOwnProperty.call(p,n)&&(G[n]=p[n])}return G}).apply(this,arguments)}function Fg(G,z){var p=Object.keys(G);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(G);z&&(n=n.filter(function(k){return Object.getOwnPropertyDescriptor(G,k).enumerable}));p.push.apply(p,n)}return p}function Gg(G){for(var z=1;z<arguments.length;z++){var p=null!=arguments[z]?arguments[z]:{};z%2?Fg(Object(p),!0).forEach(function(n){var k=p[n];n in G?Object.defineProperty(G,
n,{value:k,enumerable:!0,configurable:!0,writable:!0}):G[n]=k}):Object.getOwnPropertyDescriptors?Object.defineProperties(G,Object.getOwnPropertyDescriptors(p)):Fg(Object(p)).forEach(function(n){Object.defineProperty(G,n,Object.getOwnPropertyDescriptor(p,n))})}return G}function Hg(G,z){for(var p=0;p<z.length;p++){var n=z[p];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(G,n.key,n)}}h.r(e);h.d(e,"default",function(){return Jd});var Rf=h(11),Zb=h(3),
Y=h(0),hb=h(2),Ua=h(1),Sf=h(6),Gc=h(5),ci=function(){function G(p){this.alignedSliding=this.PTSKnown=!1;this.averagetargetduration=void 0;this.endSN=this.endCC=0;this.fragmentHint=this.fragments=void 0;this.partList=null;this.live=!0;this.ageHeader=0;this.advancedDateTime=void 0;this.advanced=this.updated=!0;this.availabilityDelay=void 0;this.misses=0;this.needSidxRanges=!1;this.startSN=this.startCC=0;this.startTimeOffset=null;this.totalduration=this.targetduration=0;this.type=null;this.url=void 0;
this.m3u8="";this.version=null;this.canBlockReload=!1;this.canSkipUntil=0;this.canSkipDateRanges=!1;this.skippedSegments=0;this.recentlyRemovedDateranges=void 0;this.partTarget=this.holdBack=this.partHoldBack=0;this.renditionReports=this.preloadHint=void 0;this.tuneInGoal=0;this.deltaUpdateFailed=void 0;this.driftEnd=this.driftStart=this.driftEndTime=this.driftStartTime=0;this.fragments=[];this.url=p}var z;return G.prototype.reloaded=function(p){if(!p)return this.advanced=!0,void(this.updated=!0);
var n=this.lastPartSn-p.lastPartSn,k=this.lastPartIndex-p.lastPartIndex;this.updated=this.endSN!==p.endSN||!!k||!!n;this.advanced=this.endSN>p.endSN||0<n||0===n&&0<k;this.updated||this.advanced?this.misses=Math.floor(.6*p.misses):this.misses=p.misses+1;this.availabilityDelay=p.availabilityDelay},z=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&Object(Zb.a)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||
this.targetduration||10}},{key:"drift",get:function(){var p=this.driftEndTime-this.driftStartTime;return 0<p?1E3*(this.driftEnd-this.driftStart)/p:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var p;return null!==(p=this.partList)&&void 0!==p&&p.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var p;return null!==(p=this.fragments)&&void 0!==p&&p.length?this.fragments[this.fragments.length-
1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1E3:0}},{key:"lastPartIndex",get:function(){var p;return null!==(p=this.partList)&&void 0!==p&&p.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var p;return null!==(p=this.partList)&&void 0!==p&&p.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}],m(G.prototype,z),G}(),di=h(17),ei=/^(\d+)x(\d+)$/,Ig=/\s*(.+?)\s*=((?:".*?")|.*?)(?:,|$)/g,
Pc=function(){function G(p){for(var n in"string"==typeof p&&(p=G.parseAttrList(p)),p)p.hasOwnProperty(n)&&(this[n]=p[n])}var z=G.prototype;return z.decimalInteger=function(p){p=parseInt(this[p],10);return p>Number.MAX_SAFE_INTEGER?1/0:p},z.hexadecimalInteger=function(p){if(this[p]){p=(this[p]||"0x").slice(2);p=(1&p.length?"0":"")+p;for(var n=new Uint8Array(p.length/2),k=0;k<p.length/2;k++)n[k]=parseInt(p.slice(2*k,2*k+2),16);return n}return null},z.hexadecimalIntegerAsNumber=function(p){p=parseInt(this[p],
16);return p>Number.MAX_SAFE_INTEGER?1/0:p},z.decimalFloatingPoint=function(p){return parseFloat(this[p])},z.optionalFloat=function(p,n){return(p=this[p])?parseFloat(p):n},z.enumeratedString=function(p){return this[p]},z.bool=function(p){return"YES"===this[p]},z.decimalResolution=function(p){p=ei.exec(this[p]);if(null!==p)return{width:parseInt(p[1],10),height:parseInt(p[2],10)}},G.parseAttrList=function(p){var n,k={};for(Ig.lastIndex=0;null!==(n=Ig.exec(p));){var q=n[2];0===q.indexOf('"')&&q.lastIndexOf('"')===
q.length-1&&(q=q.slice(1,-1));k[n[1]]=q}return k},G}(),fi={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,
s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}},Jg=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,Kg=/#EXT-X-MEDIA:(.*)/g,Tf=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),Lg=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,
/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,
/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),Ad=/\.(mp4|m4s|m4v|m4a)$/i,me=function(){function G(){}return G.findGroup=function(z,p){for(var n=0;n<z.length;n++){var k=z[n];if(k.id===p)return k}},G.convertAVC1ToAVCOTI=function(z){var p=z.split(".");return 2<p.length?(z=p.shift()+".",z+=parseInt(p.shift()).toString(16),z+("000"+parseInt(p.shift()).toString(16)).substr(-4)):z},G.resolve=function(z,p){return Rf.buildAbsoluteURL(p,z,{alwaysNormalize:!0})},G.parseMasterPlaylist=function(z,
p){var n,k=[],q={},u=!1;for(Jg.lastIndex=0;null!=(n=Jg.exec(z));)if(n[1]){var B=new Pc(n[1]);n={attrs:B,bitrate:B.decimalInteger("AVERAGE-BANDWIDTH")||B.decimalInteger("BANDWIDTH"),name:B.NAME,url:G.resolve(n[2],p)};var F=B.decimalResolution("RESOLUTION");F&&(n.width=F.width,n.height=F.height);y((B.CODECS||"").split(/[ ,]+/).filter(function(K){return K}),n);n.videoCodec&&-1!==n.videoCodec.indexOf("avc1")&&(n.videoCodec=G.convertAVC1ToAVCOTI(n.videoCodec));k.push(n)}else n[3]&&(B=new Pc(n[3]),B["DATA-ID"]&&
(u=!0,q[B["DATA-ID"]]=B));return{levels:k,sessionData:u?q:null}},G.parseMasterPlaylistMedia=function(z,p,n,k){var q;void 0===k&&(k=[]);var u=[],B=0;for(Kg.lastIndex=0;null!==(q=Kg.exec(z));)if(q=new Pc(q[1]),q.TYPE===n){q={attrs:q,bitrate:0,id:B++,groupId:q["GROUP-ID"],instreamId:q["INSTREAM-ID"],name:q.NAME||q.LANGUAGE||"",type:n,default:q.bool("DEFAULT"),autoselect:q.bool("AUTOSELECT"),forced:q.bool("FORCED"),lang:q.LANGUAGE,url:q.URI?G.resolve(q.URI,p):""};if(k.length){var F=G.findGroup(k,q.groupId)||
k[0],K=F.audioCodec;K&&(q.audioCodec=K);(F=F.textCodec)&&(q.textCodec=F)}u.push(q)}return u},G.parseLevelPlaylist=function(z,p,n,k,q){var u,B,F,K=new ci(p),Z=K.fragments,ja=null,ya=0,Xa=0,La=0,Wa=0,db=null,bb=new Gc.b(k,p),sb=-1,Wb=!1;Tf.lastIndex=0;for(K.m3u8=z;null!==(u=Tf.exec(z));){Wb&&(Wb=!1,(bb=new Gc.b(k,p)).start=La,bb.sn=ya,bb.cc=Wa,bb.level=n,ja&&(bb.initSegment=ja,bb.rawProgramDateTime=ja.rawProgramDateTime));var tb=u[1];if(tb)bb.duration=parseFloat(tb),u=(" "+u[2]).slice(1),bb.title=u||
null,bb.tagList.push(u?["INF",tb,u]:["INF",tb]);else if(u[3])Object(Zb.a)(bb.duration)&&(bb.start=La,F&&(bb.levelkey=F),bb.sn=ya,bb.level=n,bb.cc=Wa,bb.urlId=q,Z.push(bb),bb.relurl=(" "+u[3]).slice(1),C(bb,db),db=bb,La+=bb.duration,ya++,Xa=0,Wb=!0);else if(u[4])tb=(" "+u[4]).slice(1),db?bb.setByteRange(tb,db):bb.setByteRange(tb);else if(u[5])bb.rawProgramDateTime=(" "+u[5]).slice(1),bb.tagList.push(["PROGRAM-DATE-TIME",bb.rawProgramDateTime]),-1===sb&&(sb=Z.length);else if(u=u[0].match(Lg)){for(B=
1;B<u.length&&void 0===u[B];B++);var bc=(" "+u[B]).slice(1);tb=(" "+u[B+1]).slice(1);B=u[B+2]?(" "+u[B+2]).slice(1):"";switch(bc){case "PLAYLIST-TYPE":K.type=tb.toUpperCase();break;case "MEDIA-SEQUENCE":ya=K.startSN=parseInt(tb);break;case "SKIP":tb=new Pc(tb);u=tb.decimalInteger("SKIPPED-SEGMENTS");if(Object(Zb.a)(u)){for(bc=K.skippedSegments=u;bc--;)Z.unshift(null);ya+=u}(tb=tb.enumeratedString("RECENTLY-REMOVED-DATERANGES"))&&(K.recentlyRemovedDateranges=tb.split("\t"));break;case "TARGETDURATION":K.targetduration=
parseFloat(tb);break;case "VERSION":K.version=parseInt(tb);break;case "EXTM3U":break;case "ENDLIST":K.live=!1;break;case "#":(tb||B)&&bb.tagList.push(B?[tb,B]:[tb]);break;case "DIS":Wa++;case "GAP":bb.tagList.push([bc]);break;case "BITRATE":bb.tagList.push([bc,tb]);break;case "DISCONTINUITY-SEQ":Wa=parseInt(tb);break;case "KEY":var fc,ub=new Pc(tb);tb=ub.enumeratedString("METHOD");u=ub.URI;bc=ub.hexadecimalInteger("IV");B=ub.enumeratedString("KEYFORMATVERSIONS");var Ac=ub.enumeratedString("KEYID");
ub=null!=(fc=ub.enumeratedString("KEYFORMAT"))?fc:"identity";if(-1<["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(ub)){Ua.b.warn("Keyformat "+ub+" is not supported from the manifest");continue}if("identity"!==ub)continue;tb&&(F=di.a.fromURL(p,u),u&&0<=["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(tb)&&(F.method=tb,F.keyFormat=ub,Ac&&(F.keyID=Ac),B&&(F.keyFormatVersions=B),F.iv=bc));break;case "START":tb=(new Pc(tb)).decimalFloatingPoint("TIME-OFFSET");
Object(Zb.a)(tb)&&(K.startTimeOffset=tb);break;case "MAP":ja=new Pc(tb);bb.relurl=ja.URI;ja.BYTERANGE&&bb.setByteRange(ja.BYTERANGE);bb.level=n;bb.sn="initSegment";F&&(bb.levelkey=F);bb.initSegment=null;ja=bb;Wb=!0;break;case "SERVER-CONTROL":tb=new Pc(tb);K.canBlockReload=tb.bool("CAN-BLOCK-RELOAD");K.canSkipUntil=tb.optionalFloat("CAN-SKIP-UNTIL",0);K.canSkipDateRanges=0<K.canSkipUntil&&tb.bool("CAN-SKIP-DATERANGES");K.partHoldBack=tb.optionalFloat("PART-HOLD-BACK",0);K.holdBack=tb.optionalFloat("HOLD-BACK",
0);break;case "PART-INF":tb=new Pc(tb);K.partTarget=tb.decimalFloatingPoint("PART-TARGET");break;case "PART":(u=K.partList)||(u=K.partList=[]);bc=0<Xa?u[u.length-1]:void 0;B=Xa++;tb=new Gc.c(new Pc(tb),bb,p,B,bc);u.push(tb);bb.duration+=tb.duration;break;case "PRELOAD-HINT":tb=new Pc(tb);K.preloadHint=tb;break;case "RENDITION-REPORT":tb=new Pc(tb);K.renditionReports=K.renditionReports||[];K.renditionReports.push(tb);break;default:Ua.b.warn("line parsed but not handled: "+u)}}else Ua.b.warn("No matches on slow regex match for level playlist!")}db&&
!db.relurl?(Z.pop(),La-=db.duration,K.partList&&(K.fragmentHint=db)):K.partList&&(C(bb,db),bb.cc=Wa,K.fragmentHint=bb);F=Z.length;z=Z[0];q=Z[F-1];0<(La+=K.skippedSegments*K.targetduration)&&F&&q?(K.averagetargetduration=La/F,F=q.sn,K.endSN="initSegment"!==F?F:0,z&&(K.startCC=z.cc,z.initSegment||K.fragments.every(function(Uc){return Uc.relurl&&(Eb=Uc.relurl,Ad.test(null!=(Hc=null===(Vc=Rf.parseURL(Eb))||void 0===Vc?void 0:Vc.path)?Hc:""));var Eb,Hc,Vc})&&(Ua.b.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),
(bb=new Gc.b(k,p)).relurl=q.relurl,bb.level=n,bb.sn="initSegment",z.initSegment=bb,K.needSidxRanges=!0))):(K.endSN=0,K.startCC=0);return K.fragmentHint&&(La+=K.fragmentHint.duration),K.totalduration=La,K.endCC=Wa,0<sb&&function(Uc,Eb){for(var Hc=Uc[Eb];Eb--;){var Vc=Uc[Eb];if(!Vc)break;Vc.programDateTime=Hc.programDateTime-1E3*Vc.duration;Hc=Vc}}(Z,sb),K},G}(),Hb=h(4),Mg=function(){function G(p){this.hls=void 0;this.loaders=Object.create(null);this.hls=p;this.registerListeners()}var z=G.prototype;
return z.registerListeners=function(){var p=this.hls;p.on(Y.a.MANIFEST_LOADING,this.onManifestLoading,this);p.on(Y.a.LEVEL_LOADING,this.onLevelLoading,this);p.on(Y.a.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this);p.on(Y.a.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},z.unregisterListeners=function(){var p=this.hls;p.off(Y.a.MANIFEST_LOADING,this.onManifestLoading,this);p.off(Y.a.LEVEL_LOADING,this.onLevelLoading,this);p.off(Y.a.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this);p.off(Y.a.SUBTITLE_TRACK_LOADING,
this.onSubtitleTrackLoading,this)},z.createInternalLoader=function(p){var n=this.hls.config,k=n.loader;n=new (n.pLoader||k)(n);return p.loader=n,this.loaders[p.type]=n,n},z.getInternalLoader=function(p){return this.loaders[p.type]},z.resetInternalLoader=function(p){this.loaders[p]&&delete this.loaders[p]},z.destroyInternalLoaders=function(){for(var p in this.loaders){var n=this.loaders[p];n&&n.destroy();this.resetInternalLoader(p)}},z.destroy=function(){this.unregisterListeners();this.destroyInternalLoaders()},
z.onManifestLoading=function(p,n){this.load({id:null,groupId:null,level:0,responseType:"text",type:Hb.a.MANIFEST,url:n.url,deliveryDirectives:null})},z.onLevelLoading=function(p,n){this.load({id:n.id,groupId:null,level:n.level,responseType:"text",type:Hb.a.LEVEL,url:n.url,deliveryDirectives:n.deliveryDirectives})},z.onAudioTrackLoading=function(p,n){this.load({id:n.id,groupId:n.groupId,level:null,responseType:"text",type:Hb.a.AUDIO_TRACK,url:n.url,deliveryDirectives:n.deliveryDirectives})},z.onSubtitleTrackLoading=
function(p,n){this.load({id:n.id,groupId:n.groupId,level:null,responseType:"text",type:Hb.a.SUBTITLE_TRACK,url:n.url,deliveryDirectives:n.deliveryDirectives})},z.load=function(p){var n,k,q,u=this.hls.config,B=this.getInternalLoader(p);if(B){if((k=B.context)&&k.url===p.url)return void Ua.b.trace("[playlist-loader]: playlist request ongoing");Ua.b.log("[playlist-loader]: aborting previous loader for type: "+p.type);B.abort()}switch(p.type){case Hb.a.MANIFEST:k=u.manifestLoadingMaxRetry;var F=u.manifestLoadingTimeOut;
var K=u.manifestLoadingRetryDelay;var Z=u.manifestLoadingMaxRetryTimeout;break;case Hb.a.LEVEL:case Hb.a.AUDIO_TRACK:case Hb.a.SUBTITLE_TRACK:k=0;F=u.levelLoadingTimeOut;break;default:k=u.levelLoadingMaxRetry,F=u.levelLoadingTimeOut,K=u.levelLoadingRetryDelay,Z=u.levelLoadingMaxRetryTimeout}(B=this.createInternalLoader(p),null!==(n=p.deliveryDirectives)&&void 0!==n&&n.part)&&(p.type===Hb.a.LEVEL&&null!==p.level?q=this.hls.levels[p.level].details:p.type===Hb.a.AUDIO_TRACK&&null!==p.id?q=this.hls.audioTracks[p.id].details:
p.type===Hb.a.SUBTITLE_TRACK&&null!==p.id&&(q=this.hls.subtitleTracks[p.id].details),q)&&(n=q.partTarget,q=q.targetduration,n&&q&&(F=Math.min(1E3*Math.max(3*n,.8*q),F)));K={timeout:F,maxRetry:k,retryDelay:K,maxRetryDelay:Z,highWaterMark:0};Z={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};B.load(p,K,Z)},z.loadsuccess=function(p,n,k,q){if(void 0===q&&(q=null),k.isSidxRequest)return this.handleSidxRequest(p,k),void this.handlePlaylistLoaded(p,
n,k,q);this.resetInternalLoader(k.type);var u=p.data;0===u.indexOf("#EXTM3U")?(n.parsing.start=performance.now(),0<u.indexOf("#EXTINF:")||0<u.indexOf("#EXT-X-TARGETDURATION:")?this.handleTrackOrLevelPlaylist(p,n,k,q):this.handleMasterPlaylist(p,n,k,q)):this.handleManifestParsingError(p,k,"no EXTM3U delimiter",q)},z.loaderror=function(p,n,k){void 0===k&&(k=null);this.handleNetworkError(n,k,!1,p)},z.loadtimeout=function(p,n,k){void 0===k&&(k=null);this.handleNetworkError(n,k,!0)},z.handleMasterPlaylist=
function(p,n,k,q){var u=this.hls,B=p.data,F=I(p,k),K=me.parseMasterPlaylist(B,F),Z=K.levels;K=K.sessionData;Z.length?(p=Z.map(function(ja){return{id:ja.attrs.AUDIO,audioCodec:ja.audioCodec}}),k=Z.map(function(ja){return{id:ja.attrs.SUBTITLES,textCodec:ja.textCodec}}),p=me.parseMasterPlaylistMedia(B,F,"AUDIO",p),k=me.parseMasterPlaylistMedia(B,F,"SUBTITLES",k),B=me.parseMasterPlaylistMedia(B,F,"CLOSED-CAPTIONS"),p.length&&(p.some(function(ja){return!ja.url})||!Z[0].audioCodec||Z[0].attrs.AUDIO||(Ua.b.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),
p.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Pc({}),bitrate:0,url:""}))),u.trigger(Y.a.MANIFEST_LOADED,{levels:Z,audioTracks:p,subtitles:k,captions:B,url:F,stats:n,networkDetails:q,sessionData:K})):this.handleManifestParsingError(p,k,"no level found in manifest",q)},z.handleTrackOrLevelPlaylist=function(p,n,k,q){var u=this.hls,B=k.id,F=k.level,K=k.type,Z=I(p,k),ja=Object(Zb.a)(B)?B:0,ya=Object(Zb.a)(F)?F:ja;a:switch(k.type){case Hb.a.AUDIO_TRACK:var Xa=Hb.b.AUDIO;
break a;case Hb.a.SUBTITLE_TRACK:Xa=Hb.b.SUBTITLE;break a;default:Xa=Hb.b.MAIN}ja=me.parseLevelPlaylist(p.data,Z,ya,Xa,ja);if(ja.fragments.length)if(K===Hb.a.MANIFEST&&(ya={attrs:new Pc({}),bitrate:0,details:ja,name:"",url:Z},u.trigger(Y.a.MANIFEST_LOADED,{levels:[ya],audioTracks:[],url:Z,stats:n,networkDetails:q,sessionData:null})),n.parsing.end=performance.now(),ja.needSidxRanges){var La;p=null===(La=ja.fragments[0].initSegment)||void 0===La?void 0:La.url;this.load({url:p,isSidxRequest:!0,type:K,
level:F,levelDetails:ja,id:B,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else k.levelDetails=ja,this.handlePlaylistLoaded(p,n,k,q);else u.trigger(Y.a.ERROR,{type:hb.b.NETWORK_ERROR,details:hb.a.LEVEL_EMPTY_ERROR,fatal:!1,url:Z,reason:"no fragments found in level",level:"number"==typeof k.level?k.level:void 0})},z.handleSidxRequest=function(p,n){var k=Object(Sf.g)(new Uint8Array(p.data));if(k){var q=n.levelDetails;k.references.forEach(function(u,B){u=
u.info;B=q.fragments[B];0===B.byteRange.length&&B.setByteRange(String(1+u.end-u.start)+"@"+String(u.start));B.initSegment&&B.initSegment.setByteRange(String(k.moovEndOffset)+"@0")})}},z.handleManifestParsingError=function(p,n,k,q){this.hls.trigger(Y.a.ERROR,{type:hb.b.NETWORK_ERROR,details:hb.a.MANIFEST_PARSING_ERROR,fatal:n.type===Hb.a.MANIFEST,url:p.url,reason:k,response:p,context:n,networkDetails:q})},z.handleNetworkError=function(p,n,k,q){void 0===k&&(k=!1);Ua.b.warn("[playlist-loader]: A network "+
(k?"timeout":"error")+" occurred while loading "+p.type+" level: "+p.level+" id: "+p.id+' group-id: "'+p.groupId+'"');var u=hb.a.UNKNOWN,B=!1,F=this.getInternalLoader(p);switch(p.type){case Hb.a.MANIFEST:u=k?hb.a.MANIFEST_LOAD_TIMEOUT:hb.a.MANIFEST_LOAD_ERROR;B=!0;break;case Hb.a.LEVEL:u=k?hb.a.LEVEL_LOAD_TIMEOUT:hb.a.LEVEL_LOAD_ERROR;B=!1;break;case Hb.a.AUDIO_TRACK:u=k?hb.a.AUDIO_TRACK_LOAD_TIMEOUT:hb.a.AUDIO_TRACK_LOAD_ERROR;B=!1;break;case Hb.a.SUBTITLE_TRACK:u=k?hb.a.SUBTITLE_TRACK_LOAD_TIMEOUT:
hb.a.SUBTITLE_LOAD_ERROR,B=!1}F&&this.resetInternalLoader(p.type);p={type:hb.b.NETWORK_ERROR,details:u,fatal:B,url:p.url,loader:F,context:p,networkDetails:n};q&&(p.response=q);this.hls.trigger(Y.a.ERROR,p)},z.handlePlaylistLoaded=function(p,n,k,q){var u=k.type,B=k.level,F=k.id,K=k.groupId,Z=k.loader,ja=k.levelDetails,ya=k.deliveryDirectives;if(null!=ja&&ja.targetduration){if(Z)switch(ja.live&&(Z.getCacheAge&&(ja.ageHeader=Z.getCacheAge()||0),Z.getCacheAge&&!isNaN(ja.ageHeader)||(ja.ageHeader=0)),
u){case Hb.a.MANIFEST:case Hb.a.LEVEL:this.hls.trigger(Y.a.LEVEL_LOADED,{details:ja,level:B||0,id:F||0,stats:n,networkDetails:q,deliveryDirectives:ya});break;case Hb.a.AUDIO_TRACK:this.hls.trigger(Y.a.AUDIO_TRACK_LOADED,{details:ja,id:F||0,groupId:K||"",stats:n,networkDetails:q,deliveryDirectives:ya});break;case Hb.a.SUBTITLE_TRACK:this.hls.trigger(Y.a.SUBTITLE_TRACK_LOADED,{details:ja,id:F||0,groupId:K||"",stats:n,networkDetails:q,deliveryDirectives:ya})}}else this.handleManifestParsingError(p,k,
"invalid target duration",q)},G}(),Ke=function(){function G(p){this.loaders={};this.decrypturl=this.decryptkey=null;this.hls=p;this._registerListeners()}var z=G.prototype;return z._registerListeners=function(){this.hls.on(Y.a.KEY_LOADING,this.onKeyLoading,this)},z._unregisterListeners=function(){this.hls.off(Y.a.KEY_LOADING,this.onKeyLoading)},z.destroy=function(){for(var p in this._unregisterListeners(),this.loaders){var n=this.loaders[p];n&&n.destroy()}this.loaders={}},z.onKeyLoading=function(p,
n){var k=n.frag;n=k.type;var q=this.loaders[n];if(k.decryptdata){var u=k.decryptdata.uri;if(u!==this.decrypturl||null===this.decryptkey){p=this.hls.config;if(q&&(Ua.b.warn("abort previous key loader for type:"+n),q.abort()),!u)return void Ua.b.warn("key uri is falsy");n=k.loader=this.loaders[n]=new p.loader(p);this.decrypturl=u;this.decryptkey=null;k={url:u,frag:k,responseType:"arraybuffer"};p={timeout:p.fragLoadingTimeOut,maxRetry:0,retryDelay:p.fragLoadingRetryDelay,maxRetryDelay:p.fragLoadingMaxRetryTimeout,
highWaterMark:0};u={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};n.load(k,p,u)}else this.decryptkey&&(k.decryptdata.key=this.decryptkey,this.hls.trigger(Y.a.KEY_LOADED,{frag:k}))}else Ua.b.warn("Missing decryption data on fragment in onKeyLoading")},z.loadsuccess=function(p,n,k){n=k.frag;n.decryptdata?(this.decryptkey=n.decryptdata.key=new Uint8Array(p.data),n.loader=null,delete this.loaders[n.type],this.hls.trigger(Y.a.KEY_LOADED,
{frag:n})):Ua.b.error("after key load, decryptdata unset")},z.loaderror=function(p,n){n=n.frag;var k=n.loader;k&&k.abort();delete this.loaders[n.type];this.hls.trigger(Y.a.ERROR,{type:hb.b.NETWORK_ERROR,details:hb.a.KEY_LOAD_ERROR,fatal:!1,frag:n,response:p})},z.loadtimeout=function(p,n){p=n.frag;(n=p.loader)&&n.abort();delete this.loaders[p.type];this.hls.trigger(Y.a.ERROR,{type:hb.b.NETWORK_ERROR,details:hb.a.KEY_LOAD_TIMEOUT,fatal:!1,frag:p})},G}(),of=h(7),hi=function(){function G(p){this.hls=
void 0;this.media=this.id3Track=null;this.hls=p;this._registerListeners()}var z=G.prototype;return z.destroy=function(){this._unregisterListeners()},z._registerListeners=function(){var p=this.hls;p.on(Y.a.MEDIA_ATTACHED,this.onMediaAttached,this);p.on(Y.a.MEDIA_DETACHING,this.onMediaDetaching,this);p.on(Y.a.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this);p.on(Y.a.BUFFER_FLUSHING,this.onBufferFlushing,this)},z._unregisterListeners=function(){var p=this.hls;p.off(Y.a.MEDIA_ATTACHED,this.onMediaAttached,
this);p.off(Y.a.MEDIA_DETACHING,this.onMediaDetaching,this);p.off(Y.a.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this);p.off(Y.a.BUFFER_FLUSHING,this.onBufferFlushing,this)},z.onMediaAttached=function(p,n){this.media=n.media},z.onMediaDetaching=function(){this.id3Track&&(O(this.id3Track),this.id3Track=null,this.media=null)},z.getID3Track=function(p){if(this.media){for(var n=0;n<p.length;n++){var k=p[n];if("metadata"===k.kind&&"id3"===k.label)return E(k,this.media),k}return this.media.addTextTrack("metadata",
"id3")}},z.onFragParsingMetadata=function(p,n){if(this.media){p=n.frag;n=n.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var k=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,q=0;q<n.length;q++){var u=of.c(n[q].data);if(u){var B=n[q].pts,F=q<n.length-1?n[q+1].pts:p.end;0>=F-B&&(F=B+.25);for(var K=0;K<u.length;K++){var Z=u[K];if(!of.e(Z)){var ja=new k(B,F,"");ja.value=Z;this.id3Track.addCue(ja)}}}}}},z.onBufferFlushing=function(p,
n){p=n.startOffset;var k=n.endOffset;n=n.type;n&&"audio"!==n||(n=this.id3Track)&&R(n,p,k)},G}(),ne,Le=function(){function G(n){var k=this;this.config=this.hls=void 0;this.levelDetails=this.media=null;this.stallCount=this.currentTime=0;this._latency=null;this.timeupdateHandler=function(){return k.timeupdate()};this.hls=n;this.config=n.config;this.registerListeners()}var z,p=G.prototype;return p.destroy=function(){this.unregisterListeners();this.onMediaDetaching();this.hls=this.timeupdateHandler=this.levelDetails=
null},p.registerListeners=function(){this.hls.on(Y.a.MEDIA_ATTACHED,this.onMediaAttached,this);this.hls.on(Y.a.MEDIA_DETACHING,this.onMediaDetaching,this);this.hls.on(Y.a.MANIFEST_LOADING,this.onManifestLoading,this);this.hls.on(Y.a.LEVEL_UPDATED,this.onLevelUpdated,this);this.hls.on(Y.a.ERROR,this.onError,this)},p.unregisterListeners=function(){this.hls.off(Y.a.MEDIA_ATTACHED,this.onMediaAttached);this.hls.off(Y.a.MEDIA_DETACHING,this.onMediaDetaching);this.hls.off(Y.a.MANIFEST_LOADING,this.onManifestLoading);
this.hls.off(Y.a.LEVEL_UPDATED,this.onLevelUpdated);this.hls.off(Y.a.ERROR,this.onError)},p.onMediaAttached=function(n,k){this.media=k.media;this.media.addEventListener("timeupdate",this.timeupdateHandler)},p.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},p.onManifestLoading=function(){this._latency=this.levelDetails=null;this.stallCount=0},p.onLevelUpdated=function(n,k){this.levelDetails=n=k.details;n.advanced&&this.timeupdate();
!n.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},p.onError=function(n,k){k.details===hb.a.BUFFER_STALLED_ERROR&&(this.stallCount++,Ua.b.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},p.timeupdate=function(){var n=this.media,k=this.levelDetails;if(n&&k){this.currentTime=n.currentTime;var q=this.computeLatency();if(null!==q){this._latency=q;var u=this.config,B=u.maxLiveSyncPlaybackRate;u.lowLatencyMode&&1!==B&&(u=this.targetLatency,
null!==u&&(q-=u,u=q<Math.min(this.maxLatency,u+k.targetduration),k.live&&u&&.05<q&&1<this.forwardBufferLength?n.playbackRate=Math.min(Math.min(2,Math.max(1,B)),Math.max(1,Math.round(2/(1+Math.exp(-.75*q-this.edgeStalled))*20)/20)):1!==n.playbackRate&&0!==n.playbackRate&&(n.playbackRate=1)))}}},p.estimateLiveEdge=function(){var n=this.levelDetails;return null===n?null:n.edge+n.age},p.computeLatency=function(){var n=this.estimateLiveEdge();return null===n?null:n-this.currentTime},z=[{key:"latency",
get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var n=this.config,k=this.levelDetails;return void 0!==n.liveMaxLatencyDuration?n.liveMaxLatencyDuration:k?n.liveMaxLatencyDurationCount*k.targetduration:0}},{key:"targetLatency",get:function(){var n=this.levelDetails;if(null===n)return null;var k=n.holdBack,q=n.partHoldBack;n=n.targetduration;var u=this.config,B=u.liveSyncDuration,F=u.liveSyncDurationCount,K=this.hls.userConfig;k=u.lowLatencyMode&&q||k;(K.liveSyncDuration||
K.liveSyncDurationCount||0===k)&&(k=void 0!==B?B:F*n);return k+Math.min(1*this.stallCount,n)}},{key:"liveSyncPosition",get:function(){var n=this.estimateLiveEdge(),k=this.targetLatency,q=this.levelDetails;if(null===n||null===k||null===q)return null;var u=q.edge;return Math.min(Math.max(u-q.totalduration,n-k-this.edgeStalled),u-(this.config.lowLatencyMode&&q.partTarget||q.targetduration))}},{key:"drift",get:function(){var n=this.levelDetails;return null===n?1:n.drift}},{key:"edgeStalled",get:function(){var n=
this.levelDetails;return null===n?0:Math.max(n.age-3*(this.config.lowLatencyMode&&n.partTarget||n.targetduration),0)}},{key:"forwardBufferLength",get:function(){var n=this.media,k=this.levelDetails;if(!n||!k)return 0;var q=n.buffered.length;return q?n.buffered.end(q-1):k.edge-this.currentTime}}],W(G.prototype,z),G}();!function(G){G.No="";G.Yes="YES";G.v2="v2"}(ne||={});var Uf=function(){function G(z,p,n){this.msn=z;this.part=p;this.skip=n}return G.prototype.addDirectives=function(z){z=new self.URL(z);
return void 0!==this.msn&&z.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&z.searchParams.set("_HLS_part",this.part.toString()),this.skip&&z.searchParams.set("_HLS_skip",this.skip),z.toString()},G}(),pf=function(){function G(p){this.details=this.audioGroupIds=this.unknownCodecs=this.width=this.videoCodec=this.name=this.id=this.height=this.codecSet=this.bitrate=this.audioCodec=this.attrs=void 0;this.loadError=this.fragmentError=0;this.loaded=void 0;this.realBitrate=0;this.url=
this.textGroupIds=void 0;this._urlId=0;this.url=[p.url];this.attrs=p.attrs;this.bitrate=p.bitrate;p.details&&(this.details=p.details);this.id=p.id||0;this.name=p.name;this.width=p.width||0;this.height=p.height||0;this.audioCodec=p.audioCodec;this.videoCodec=p.videoCodec;this.unknownCodecs=p.unknownCodecs;this.codecSet=[p.videoCodec,p.audioCodec].filter(function(n){return n}).join(",").replace(/\.[^.,]+/g,"")}var z;return z=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},
{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(p){p%=this.url.length;this._urlId!==p&&(this.details=void 0,this._urlId=p)}}],ea(G.prototype,z),G}(),Me=function(){function G(p,n){this.hls=void 0;this.timer=-1;this.canLoad=!1;this.retryCount=0;this.warn=this.log=void 0;this.log=Ua.b.log.bind(Ua.b,n+":");this.warn=Ua.b.warn.bind(Ua.b,n+":");this.hls=p}var z=G.prototype;return z.destroy=function(){this.clearTimer();this.hls=this.log=
this.warn=null},z.onError=function(p,n){n.fatal&&n.type===hb.b.NETWORK_ERROR&&this.clearTimer()},z.clearTimer=function(){clearTimeout(this.timer);this.timer=-1},z.startLoad=function(){this.canLoad=!0;this.retryCount=0;this.loadPlaylist()},z.stopLoad=function(){this.canLoad=!1;this.clearTimer()},z.switchParams=function(p,n){var k=null==n?void 0:n.renditionReports;if(k)for(var q=0;q<k.length;q++){var u=k[q],B=""+u.URI;if(B===p.substr(-B.length)){B=parseInt(u["LAST-MSN"]);u=parseInt(u["LAST-PART"]);
if(n&&this.hls.config.lowLatencyMode){var F=Math.min(n.age-n.partTarget,n.targetduration);void 0!==u&&F>n.partTarget&&(u+=1)}if(Object(Zb.a)(B))return new Uf(B,Object(Zb.a)(u)?u:void 0,ne.No)}}},z.loadPlaylist=function(p){},z.shouldLoadTrack=function(p){return this.canLoad&&p&&!!p.url&&(!p.details||p.details.live)},z.playlistLoaded=function(p,n,k){var q=this,u=n.details,B=n.stats,F=B.loading.end?Math.max(0,self.performance.now()-B.loading.end):0;if(u.advancedDateTime=Date.now()-F,u.live||null!=k&&
k.live){if(u.reloaded(k),k&&this.log("live playlist "+p+" "+(u.advanced?"REFRESHED "+u.lastPartSn+"-"+u.lastPartIndex:"MISSED")),k&&0<u.fragments.length&&U(k,u),this.canLoad&&u.live){var K,Z=F=void 0;if(u.canBlockReload&&u.endSN&&u.advanced){var ja=this.hls.config.lowLatencyMode,ya=u.lastPartSn,Xa=u.endSN,La=u.lastPartIndex,Wa=ya===Xa;-1!==La?(F=Wa?Xa+1:ya,Z=Wa?ja?0:La:La+1):F=Xa+1;ya=u.age;Xa=Math.min(ya+u.ageHeader-u.partTarget,1.5*u.targetduration);if(0<Xa){if(k&&Xa>k.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+
k.tuneInGoal+" to: "+Xa+" with playlist age: "+u.age),Xa=0;else{k=Math.floor(Xa/u.targetduration);if(F+=k,void 0!==Z)Z+=Math.round(Xa%u.targetduration/u.partTarget);this.log("CDN Tune-in age: "+u.ageHeader+"s last advanced "+ya.toFixed(2)+"s goal: "+Xa+" skip sn "+k+" to part "+Z)}u.tuneInGoal=Xa}if(K=this.getDeliveryDirectives(u,n.deliveryDirectives,F,Z),ja||!Wa)return void this.loadPlaylist(K)}else K=this.getDeliveryDirectives(u,n.deliveryDirectives,F,Z);n=function(db,bb){var sb=1E3*db.levelTargetDuration,
Wb=sb/2,tb=db.age,bc=0<tb&&tb<3*sb;bb=bb.loading.end-bb.loading.start;var fc=db.availabilityDelay;if(!1===db.updated)if(bc){var ub=Math.max(Math.min(Wb,2*bb),333*db.misses);db.availabilityDelay=(db.availabilityDelay||0)+ub}else ub=Wb;else bc?(fc=Math.min(fc||sb/2,tb),db.availabilityDelay=fc,ub=fc+sb-tb):ub=sb-bb;return Math.round(ub)}(u,B);void 0!==F&&u.canBlockReload&&(n-=u.partTarget||1);this.log("reload live playlist "+p+" in "+Math.round(n)+" ms");this.timer=self.setTimeout(function(){return q.loadPlaylist(K)},
n)}}else this.clearTimer()},z.getDeliveryDirectives=function(p,n,k,q){var u=p.canSkipUntil;var B=p.canSkipDateRanges,F=p.endSN;u=u&&(void 0!==k?k-F:0)<u?B?ne.v2:ne.Yes:ne.No;return null!=n&&n.skip&&p.deltaUpdateFailed&&(k=n.msn,q=n.part,u=ne.No),new Uf(k,q,u)},z.retryLoadingOrFail=function(p){var n,k=this,q=this.hls.config,u=this.retryCount<q.levelLoadingMaxRetry;u?(this.retryCount++,-1<p.details.indexOf("LoadTimeOut")&&null!==(n=p.context)&&void 0!==n&&n.deliveryDirectives)?(this.warn("retry playlist loading #"+
this.retryCount+' after "'+p.details+'"'),this.loadPlaylist()):(n=Math.min(Math.pow(2,this.retryCount)*q.levelLoadingRetryDelay,q.levelLoadingMaxRetryTimeout),this.timer=self.setTimeout(function(){return k.loadPlaylist()},n),this.warn("retry playlist loading #"+this.retryCount+" in "+n+' ms after "'+p.details+'"')):(this.warn('cannot recover from error "'+p.details+'"'),this.clearTimer(),p.fatal=!0);return u},G}(),zc,Vf=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),Ng=function(G){function z(k){var q;
return(q=G.call(this,k,"[level-controller]")||this)._levels=[],q._firstLevel=-1,q._startLevel=void 0,q.currentLevelIndex=-1,q.manualLevelIndex=-1,q.onParsedComplete=void 0,q._registerListeners(),q}z.prototype=Object.create(G.prototype);z.prototype.constructor=z;ca(z,G);var p,n=z.prototype;return n._registerListeners=function(){var k=this.hls;k.on(Y.a.MANIFEST_LOADED,this.onManifestLoaded,this);k.on(Y.a.LEVEL_LOADED,this.onLevelLoaded,this);k.on(Y.a.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this);
k.on(Y.a.FRAG_LOADED,this.onFragLoaded,this);k.on(Y.a.ERROR,this.onError,this)},n._unregisterListeners=function(){var k=this.hls;k.off(Y.a.MANIFEST_LOADED,this.onManifestLoaded,this);k.off(Y.a.LEVEL_LOADED,this.onLevelLoaded,this);k.off(Y.a.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this);k.off(Y.a.FRAG_LOADED,this.onFragLoaded,this);k.off(Y.a.ERROR,this.onError,this)},n.destroy=function(){this._unregisterListeners();this.manualLevelIndex=-1;this._levels.length=0;G.prototype.destroy.call(this)},
n.startLoad=function(){this._levels.forEach(function(k){k.loadError=0});G.prototype.startLoad.call(this)},n.onManifestLoaded=function(k,q){var u,B=[],F=[],K=[],Z={},ja=!1,ya=!1,Xa=!1;if(q.levels.forEach(function(Wa){var db=Wa.attrs;ja=ja||!(!Wa.width||!Wa.height);ya=ya||!!Wa.videoCodec;Xa=Xa||!!Wa.audioCodec;Vf&&Wa.audioCodec&&-1!==Wa.audioCodec.indexOf("mp4a.40.34")&&(Wa.audioCodec=void 0);var bb=Wa.bitrate+"-"+Wa.attrs.RESOLUTION+"-"+Wa.attrs.CODECS;(u=Z[bb])?u.url.push(Wa.url):(u=new pf(Wa),Z[bb]=
u,B.push(u));db&&(db.AUDIO&&T(u,"audio",db.AUDIO),db.SUBTITLES&&T(u,"text",db.SUBTITLES))}),(ja||ya)&&Xa&&(B=B.filter(function(Wa){var db=Wa.width,bb=Wa.height;return!!Wa.videoCodec||!(!db||!bb)})),B=B.filter(function(Wa){var db=Wa.audioCodec;Wa=Wa.videoCodec;return(!db||t(db,"audio"))&&(!Wa||t(Wa,"video"))}),q.audioTracks&&fa(F=q.audioTracks.filter(function(Wa){return!Wa.audioCodec||t(Wa.audioCodec,"audio")})),q.subtitles&&fa(K=q.subtitles),0<B.length){k=B[0].bitrate;B.sort(function(Wa,db){return Wa.bitrate-
db.bitrate});this._levels=B;for(var La=0;La<B.length;La++)if(B[La].bitrate===k){this._firstLevel=La;this.log("manifest loaded, "+B.length+" level(s) found, first bitrate: "+k);break}q={levels:B,audioTracks:F,subtitleTracks:K,firstLevel:this._firstLevel,stats:q.stats,audio:Xa,video:ya,altAudio:!(Xa&&!ya)&&F.some(function(Wa){return!!Wa.url})};this.hls.trigger(Y.a.MANIFEST_PARSED,q);(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(Y.a.ERROR,
{type:hb.b.MEDIA_ERROR,details:hb.a.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:q.url,reason:"no level with compatible codecs found in manifest"})},n.onError=function(k,q){if(G.prototype.onError.call(this,k,q),!q.fatal){k=q.context;var u=this._levels[this.currentLevelIndex];if(k&&(k.type===Hb.a.AUDIO_TRACK&&u.audioGroupIds&&k.groupId===u.audioGroupIds[u.urlId]||k.type===Hb.a.SUBTITLE_TRACK&&u.textGroupIds&&k.groupId===u.textGroupIds[u.urlId]))this.redundantFailover(this.currentLevelIndex);else{var B;
u=!1;var F=!0;switch(q.details){case hb.a.FRAG_LOAD_ERROR:case hb.a.FRAG_LOAD_TIMEOUT:case hb.a.KEY_LOAD_ERROR:case hb.a.KEY_LOAD_TIMEOUT:q.frag&&((k=this._levels[q.frag.level])?(k.fragmentError++,k.fragmentError>this.hls.config.fragLoadingMaxRetry&&(B=q.frag.level)):B=q.frag.level);break;case hb.a.LEVEL_LOAD_ERROR:case hb.a.LEVEL_LOAD_TIMEOUT:k&&(k.deliveryDirectives&&(F=!1),B=k.level);u=!0;break;case hb.a.REMUX_ALLOC_ERROR:B=q.level,u=!0}void 0!==B&&this.recoverLevel(q,B,u,F)}}},n.recoverLevel=
function(k,q,u,B){var F=k.details,K=this._levels[q];if(K.loadError++,u){if(!this.retryLoadingOrFail(k))return void(this.currentLevelIndex=-1);k.levelRetry=!0}B&&(u=K.url.length,1<u&&K.loadError<u?(k.levelRetry=!0,this.redundantFailover(q)):-1===this.manualLevelIndex&&(q=0===q?this._levels.length-1:q-1,this.currentLevelIndex!==q&&0===this._levels[q].loadError&&(this.warn(F+": switch to "+q),k.levelRetry=!0,this.hls.nextAutoLevel=q)))},n.redundantFailover=function(k){var q=this._levels[k],u=q.url.length;
if(1<u){var B=(q.urlId+1)%u;this.warn("Switching to redundant URL-id "+B);this._levels.forEach(function(F){F.urlId=B});this.level=k}},n.onFragLoaded=function(k,q){k=q.frag;void 0!==k&&k.type===Hb.b.MAIN&&(k=this._levels[k.level],void 0!==k&&(k.fragmentError=0,k.loadError=0))},n.onLevelLoaded=function(k,q){var u,B;k=q.level;var F=q.details,K=this._levels[k];if(!K)return this.warn("Invalid level index "+k),void(null!==(B=q.deliveryDirectives)&&void 0!==B&&B.skip&&(F.deltaUpdateFailed=!0));k===this.currentLevelIndex?
(0===K.fragmentError&&(K.loadError=0,this.retryCount=0),this.playlistLoaded(k,q,K.details)):null!==(u=q.deliveryDirectives)&&void 0!==u&&u.skip&&(F.deltaUpdateFailed=!0)},n.onAudioTrackSwitched=function(k,q){if((k=this.hls.levels[this.currentLevelIndex])&&k.audioGroupIds){var u=-1;q=this.hls.audioTracks[q.id].groupId;for(var B=0;B<k.audioGroupIds.length;B++)if(k.audioGroupIds[B]===q){u=B;break}u!==k.urlId&&(k.urlId=u,this.startLoad())}},n.loadPlaylist=function(k){var q=this.currentLevelIndex,u=this._levels[q];
if(this.canLoad&&u&&0<u.url.length){var B=u.urlId;u=u.url[B];if(k)try{u=k.addDirectives(u)}catch(F){this.warn("Could not construct new URL with HLS Delivery Directives: "+F)}this.log("Attempt loading level index "+q+(k?" at sn "+k.msn+" part "+k.part:"")+" with URL-id "+B+" "+u);this.clearTimer();this.hls.trigger(Y.a.LEVEL_LOADING,{url:u,level:q,id:B,deliveryDirectives:k||null})}},n.removeLevel=function(k,q){var u=function(F,K){return K!==q},B=this._levels.filter(function(F,K){return K!==k||1<F.url.length&&
void 0!==q&&(F.url=F.url.filter(u),F.audioGroupIds&&(F.audioGroupIds=F.audioGroupIds.filter(u)),F.textGroupIds&&(F.textGroupIds=F.textGroupIds.filter(u)),F.urlId=0,!0)}).map(function(F,K){var Z=F.details;return null!=Z&&Z.fragments&&Z.fragments.forEach(function(ja){ja.level=K}),F});this._levels=B;this.hls.trigger(Y.a.LEVELS_UPDATED,{levels:B})},p=[{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(k){var q,
u=this._levels;if(0!==u.length&&(this.currentLevelIndex!==k||null===(q=u[k])||void 0===q||!q.details)){if(0>k||k>=u.length){q=0>k;if(this.hls.trigger(Y.a.ERROR,{type:hb.b.OTHER_ERROR,details:hb.a.LEVEL_SWITCH_ERROR,level:k,fatal:q,reason:"invalid level idx"}),q)return;k=Math.min(k,u.length-1)}this.clearTimer();var B=this.currentLevelIndex;q=u[B];u=u[k];this.log("switching to level "+k+" from "+B);this.currentLevelIndex=k;k=Q({},u,{level:k,maxBitrate:u.maxBitrate,uri:u.uri,urlId:u.urlId});delete k._urlId;
this.hls.trigger(Y.a.LEVEL_SWITCHING,k);k=u.details;if(!k||k.live)k=this.switchParams(u.uri,null==q?void 0:q.details),this.loadPlaylist(k)}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(k){this.manualLevelIndex=k;void 0===this._startLevel&&(this._startLevel=k);-1!==k&&(this.level=k)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(k){this._firstLevel=k}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var k=this.hls.config.startLevel;
return void 0!==k?k:this._firstLevel}return this._startLevel},set:function(k){this._startLevel=k}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(k){this.level=k;-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=k)}}],V(z.prototype,p),z}(Me);!function(G){G.NOT_LOADED="NOT_LOADED";G.BACKTRACKED="BACKTRACKED";G.APPENDING="APPENDING";G.PARTIAL="PARTIAL";G.OK="OK"}(zc||={});var ji=function(){function G(p){this.activeParts=
this.activeFragment=null;this.fragments=Object.create(null);this.timeRanges=Object.create(null);this.bufferPadding=.2;this.hls=p;this._registerListeners()}var z=G.prototype;return z._registerListeners=function(){var p=this.hls;p.on(Y.a.BUFFER_APPENDED,this.onBufferAppended,this);p.on(Y.a.FRAG_BUFFERED,this.onFragBuffered,this);p.on(Y.a.FRAG_LOADED,this.onFragLoaded,this)},z._unregisterListeners=function(){var p=this.hls;p.off(Y.a.BUFFER_APPENDED,this.onBufferAppended,this);p.off(Y.a.FRAG_BUFFERED,
this.onFragBuffered,this);p.off(Y.a.FRAG_LOADED,this.onFragLoaded,this)},z.destroy=function(){this._unregisterListeners();this.fragments=this.timeRanges=null},z.getAppendedFrag=function(p,n){if(n===Hb.b.MAIN){var k=this.activeFragment,q=this.activeParts;if(!k)return null;if(q)for(var u=q.length;u--;){var B=q[u],F=B?B.end:k.appendedPTS;if(B.start<=p&&void 0!==F&&p<=F)return 9<u&&(this.activeParts=q.slice(u-9)),B}else if(k.start<=p&&void 0!==k.appendedPTS&&p<=k.appendedPTS)return k}return this.getBufferedFrag(p,
n)},z.getBufferedFrag=function(p,n){for(var k=this.fragments,q=Object.keys(k),u=q.length;u--;){var B=k[q[u]];if((null==B?void 0:B.body.type)===n&&B.buffered&&(B=B.body,B.start<=p&&p<=B.end))return B}return null},z.detectEvictedFragments=function(p,n,k){var q=this;Object.keys(this.fragments).forEach(function(u){var B=q.fragments[u];B&&(B.buffered?(u=B.range[p])&&u.time.some(function(F){F=!q.isTimeBuffered(F.startPTS,F.endPTS,n);return F&&q.removeFragment(B.body),F}):B.body.type===k&&q.removeFragment(B.body))})},
z.detectPartialFragments=function(p){var n=this,k=this.timeRanges,q=p.frag,u=p.part;if(k&&"initSegment"!==q.sn){p=ta(q);var B=this.fragments[p];B&&(Object.keys(k).forEach(function(F){var K=q.elementaryStreams[F];K&&(B.range[F]=n.getBufferedTimes(q,u,null!==u||!0===K.partial,k[F]))}),B.backtrack=B.loaded=null,Object.keys(B.range).length?B.buffered=!0:this.removeFragment(B.body))}},z.fragBuffered=function(p){p=ta(p);(p=this.fragments[p])&&(p.backtrack=p.loaded=null,p.buffered=!0)},z.getBufferedTimes=
function(p,n,k,q){k={time:[],partial:k};var u=n?n.start:p.start;n=n?n.end:p.end;var B=p.minEndPTS||n;p=p.maxStartPTS||u;for(var F=0;F<q.length;F++){var K=q.start(F)-this.bufferPadding,Z=q.end(F)+this.bufferPadding;if(p>=K&&B<=Z){k.time.push({startPTS:Math.max(u,q.start(F)),endPTS:Math.min(n,q.end(F))});break}if(u<Z&&n>K)k.partial=!0,k.time.push({startPTS:Math.max(u,q.start(F)),endPTS:Math.min(n,q.end(F))});else if(n<=K)break}return k},z.getPartialFragment=function(p){var n,k,q,u=null,B=0,F=this.bufferPadding,
K=this.fragments;return Object.keys(K).forEach(function(Z){(Z=K[Z])&&za(Z)&&(k=Z.body.start-F,q=Z.body.end+F,p>=k&&p<=q&&(n=Math.min(p-k,q-p),B<=n&&(u=Z.body,B=n)))}),u},z.getState=function(p){p=ta(p);return(p=this.fragments[p])?p.buffered?za(p)?zc.PARTIAL:zc.OK:p.backtrack?zc.BACKTRACKED:zc.APPENDING:zc.NOT_LOADED},z.backtrack=function(p,n){p=ta(p);p=this.fragments[p];if(!p||p.backtrack)return null;n=p.backtrack=n||p.loaded;return p.loaded=null,n},z.getBacktrackData=function(p){var n=ta(p);if(n=
this.fragments[n]){var k;n=n.backtrack;if(null!=n&&null!==(k=n.payload)&&void 0!==k&&k.byteLength)return n;this.removeFragment(p)}return null},z.isTimeBuffered=function(p,n,k){for(var q,u,B=0;B<k.length;B++){if(q=k.start(B)-this.bufferPadding,u=k.end(B)+this.bufferPadding,p>=q&&n<=u)return!0;if(n<=q)break}return!1},z.onFragLoaded=function(p,n){p=n.frag;var k=n.part;"initSegment"===p.sn||p.bitrateTest||k||(k=ta(p),this.fragments[k]={body:p,loaded:n,backtrack:null,buffered:!1,range:Object.create(null)})},
z.onBufferAppended=function(p,n){var k=this,q=n.frag,u=n.part,B=n.timeRanges;q.type===Hb.b.MAIN&&((this.activeFragment=q,u)?((p=this.activeParts)||(this.activeParts=p=[]),p.push(u)):this.activeParts=null);this.timeRanges=B;Object.keys(B).forEach(function(F){var K=B[F];if(k.detectEvictedFragments(F,K),!u)for(F=0;F<K.length;F++)q.appendedPTS=Math.max(K.end(F),q.appendedPTS||0)})},z.onFragBuffered=function(p,n){this.detectPartialFragments(n)},z.hasFragment=function(p){p=ta(p);return!!this.fragments[p]},
z.removeFragmentsInRange=function(p,n,k){var q=this;Object.keys(this.fragments).forEach(function(u){(u=q.fragments[u])&&u.buffered&&(u=u.body,u.type===k&&u.start<n&&u.end>p&&q.removeFragment(u))})},z.removeFragment=function(p){var n=ta(p);p.stats.loaded=0;p.clearElementaryStreamInfo();delete this.fragments[n]},z.removeAllFragments=function(){this.fragments=Object.create(null);this.activeParts=this.activeFragment=null},G}(),ki=function(){function G(){this._boundTick=void 0;this._tickInterval=this._tickTimer=
null;this._tickCallCount=0;this._boundTick=this.tick.bind(this)}var z=G.prototype;return z.destroy=function(){this.onHandlerDestroying();this.onHandlerDestroyed()},z.onHandlerDestroying=function(){this.clearNextTick();this.clearInterval()},z.onHandlerDestroyed=function(){},z.hasInterval=function(){return!!this._tickInterval},z.hasNextTick=function(){return!!this._tickTimer},z.setInterval=function(p){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,p),!0)},z.clearInterval=
function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},z.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},z.tick=function(){this._tickCallCount++;1===this._tickCallCount&&(this.doTick(),1<this._tickCallCount&&this.tickImmediate(),this._tickCallCount=0)},z.tickImmediate=function(){this.clearNextTick();this._tickTimer=self.setTimeout(this._boundTick,0)},z.doTick=function(){},G}(),li={length:0,
start:function(){return 0},end:function(){return 0}},xc=function(){function G(){}return G.isBuffered=function(z,p){try{if(z){var n=G.getBuffered(z);for(z=0;z<n.length;z++)if(p>=n.start(z)&&p<=n.end(z))return!0}}catch(k){}return!1},G.bufferInfo=function(z,p,n){try{if(z){var k,q=G.getBuffered(z);z=[];for(k=0;k<q.length;k++)z.push({start:q.start(k),end:q.end(k)});return this.bufferedInfo(z,p,n)}}catch(u){}return{len:0,start:p,end:p,nextStart:void 0}},G.bufferedInfo=function(z,p,n){p=Math.max(0,p);z.sort(function(ja,
ya){return ja.start-ya.start||ya.end-ja.end});var k=[];if(n)for(var q=0;q<z.length;q++){var u=k.length;if(u){var B=k[u-1].end;z[q].start-B<n?z[q].end>B&&(k[u-1].end=z[q].end):k.push(z[q])}else k.push(z[q])}else k=z;z=0;u=q=p;for(B=0;B<k.length;B++){var F=k[B].start,K=k[B].end;if(p+n>=F&&p<K)q=F,z=(u=K)-p;else if(p+n<F){var Z=F;break}}return{len:z,start:q||0,end:u||0,nextStart:Z}},G.getBuffered=function(z){try{return z.buffered}catch(p){return Ua.b.log("failed to get media.buffered",p),li}},G}(),Wf=
function(G,z,p,n,k,q){void 0===n&&(n=0);void 0===k&&(k=-1);void 0===q&&(q=!1);this.partial=this.size=this.id=this.part=this.sn=this.level=void 0;this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0};this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}};this.level=G;this.sn=z;this.id=p;this.size=n;this.part=k;this.partial=q},Og={search:function(G,z){for(var p=0,n=G.length-1,
k,q;p<=n;){var u=z(q=G[k=(p+n)/2|0]);if(0<u)p=k+1;else{if(!(0>u))return q;n=k-1}}return null}},Pg=Math.pow(2,17),mi=function(){function G(p){this.loader=null;this.partLoadTimeout=-1;this.config=p}var z=G.prototype;return z.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},z.abort=function(){this.loader&&this.loader.abort()},z.load=function(p,n){var k=this,q=p.url;if(!q)return Promise.reject(new Qd({type:hb.b.NETWORK_ERROR,details:hb.a.FRAG_LOAD_ERROR,fatal:!1,frag:p,networkDetails:null},
"Fragment does not have a "+(q?"part list":"url")));this.abort();var u=this.config,B=u.fLoader,F=u.loader;return new Promise(function(K,Z){k.loader&&k.loader.destroy();var ja=k.loader=p.loader=B?new B(u):new F(u),ya=wb(p),Xa={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:u.fragLoadingMaxRetryTimeout,highWaterMark:Pg};p.stats=ja.stats;ja.load(ya,Xa,{onSuccess:function(La,Wa,db,bb){k.resetLoader(p,ja);K({frag:p,part:null,payload:La.data,networkDetails:bb})},onError:function(La,
Wa,db){k.resetLoader(p,ja);Z(new Qd({type:hb.b.NETWORK_ERROR,details:hb.a.FRAG_LOAD_ERROR,fatal:!1,frag:p,response:La,networkDetails:db}))},onAbort:function(La,Wa,db){k.resetLoader(p,ja);Z(new Qd({type:hb.b.NETWORK_ERROR,details:hb.a.INTERNAL_ABORTED,fatal:!1,frag:p,networkDetails:db}))},onTimeout:function(La,Wa,db){k.resetLoader(p,ja);Z(new Qd({type:hb.b.NETWORK_ERROR,details:hb.a.FRAG_LOAD_TIMEOUT,fatal:!1,frag:p,networkDetails:db}))},onProgress:function(La,Wa,db,bb){n&&n({frag:p,part:null,payload:db,
networkDetails:bb})}})})},z.loadPart=function(p,n,k){var q=this;this.abort();var u=this.config,B=u.fLoader,F=u.loader;return new Promise(function(K,Z){q.loader&&q.loader.destroy();var ja=q.loader=p.loader=B?new B(u):new F(u),ya=wb(p,n),Xa={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:u.fragLoadingMaxRetryTimeout,highWaterMark:Pg};n.stats=ja.stats;ja.load(ya,Xa,{onSuccess:function(La,Wa,db,bb){q.resetLoader(p,ja);q.updateStatsFromPart(p,n);La={frag:p,part:n,payload:La.data,networkDetails:bb};
k(La);K(La)},onError:function(La,Wa,db){q.resetLoader(p,ja);Z(new Qd({type:hb.b.NETWORK_ERROR,details:hb.a.FRAG_LOAD_ERROR,fatal:!1,frag:p,part:n,response:La,networkDetails:db}))},onAbort:function(La,Wa,db){p.stats.aborted=n.stats.aborted;q.resetLoader(p,ja);Z(new Qd({type:hb.b.NETWORK_ERROR,details:hb.a.INTERNAL_ABORTED,fatal:!1,frag:p,part:n,networkDetails:db}))},onTimeout:function(La,Wa,db){q.resetLoader(p,ja);Z(new Qd({type:hb.b.NETWORK_ERROR,details:hb.a.FRAG_LOAD_TIMEOUT,fatal:!1,frag:p,part:n,
networkDetails:db}))}})})},z.updateStatsFromPart=function(p,n){var k=p.stats,q=n.stats,u=q.total;(k.loaded+=q.loaded,u)?(p=Math.round(p.duration/n.duration),u=Math.min(Math.round(k.loaded/u),p),k.total=k.loaded+(p-u)*Math.round(k.loaded/u)):k.total=Math.max(k.loaded,k.total);k=k.loading;q=q.loading;k.start?k.first+=q.first-q.start:(k.start=q.start,k.first=q.first);k.end=q.end},z.resetLoader=function(p,n){p.loader=null;this.loader===n&&(self.clearTimeout(this.partLoadTimeout),this.loader=null);n.destroy()},
G}(),Qd=function(G){function z(p){for(var n,k=arguments.length,q=Array(1<k?k-1:0),u=1;u<k;u++)q[u-1]=arguments[u];return(n=G.call.apply(G,[this].concat(q))||this).data=void 0,n.data=p,n}return z.prototype=Object.create(G.prototype),z.prototype.constructor=z,jb(z,G),z}($a(Error)),Qg=h(15),ni={toString:function(G){for(var z="",p=G.length,n=0;n<p;n++)z+="["+G.start(n).toFixed(3)+","+G.end(n).toFixed(3)+"]";return z}},Xf=function(G){function z(k,q,u){var B;(B=G.call(this)||this).hls=void 0;B.fragPrevious=
null;B.fragCurrent=null;B.fragmentTracker=void 0;B.transmuxer=null;B._state="STOPPED";B.media=void 0;B.mediaBuffer=void 0;B.config=void 0;B.bitrateTest=!1;B.lastCurrentTime=0;B.nextLoadPosition=0;B.startPosition=0;B.loadedmetadata=!1;B.fragLoadError=0;B.retryDate=0;B.levels=null;B.fragmentLoader=void 0;B.levelLastLoaded=null;B.startFragRequested=!1;B.decrypter=void 0;B.initPTS=[];B.onvseeking=null;B.onvended=null;B.logPrefix="";B.log=void 0;B.warn=void 0;B.logPrefix=u;B.log=Ua.b.log.bind(Ua.b,u+":");
B.warn=Ua.b.warn.bind(Ua.b,u+":");B.hls=k;B.fragmentLoader=new mi(k.config);B.fragmentTracker=q;B.config=k.config;B.decrypter=new Qg.a(k,k.config);q=k.on;u=Y.a.KEY_LOADED;var F=B.onKeyLoaded;if(void 0===B)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return q.call(k,u,F,B),B}z.prototype=Object.create(G.prototype);z.prototype.constructor=z;Tb(z,G);var p,n=z.prototype;return n.doTick=function(){this.onTickEnd()},n.onTickEnd=function(){},n.startLoad=function(k){},
n.stopLoad=function(){this.fragmentLoader.abort();var k=this.fragCurrent;k&&this.fragmentTracker.removeFragment(k);this.resetTransmuxer();this.fragPrevious=this.fragCurrent=null;this.clearInterval();this.clearNextTick();this.state="STOPPED"},n._streamEnded=function(k,q){var u=this.fragCurrent,B=this.fragmentTracker;return q.live||!u||u.sn!==q.endSN||k.nextStart?!1:(k=B.getState(u),k===zc.PARTIAL||k===zc.OK)},n.onMediaAttached=function(k,q){k=this.media=this.mediaBuffer=q.media;this.onvseeking=this.onMediaSeeking.bind(this);
this.onvended=this.onMediaEnded.bind(this);k.addEventListener("seeking",this.onvseeking);k.addEventListener("ended",this.onvended);k=this.config;this.levels&&k.autoStartLoad&&"STOPPED"===this.state&&this.startLoad(k.startPosition)},n.onMediaDetaching=function(){var k=this.media;null!=k&&k.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);k&&(k.removeEventListener("seeking",this.onvseeking),k.removeEventListener("ended",this.onvended),
this.onvseeking=this.onvended=null);this.media=this.mediaBuffer=null;this.loadedmetadata=!1;this.fragmentTracker.removeAllFragments();this.stopLoad()},n.onMediaSeeking=function(){var k=this.config,q=this.fragCurrent,u=this.media,B=this.state,F=u?u.currentTime:0,K=xc.bufferInfo(this.mediaBuffer||u,F,k.maxBufferHole);(this.log("media seeking to "+(Object(Zb.a)(F)?F.toFixed(3):F)+", state: "+B),"ENDED"===B)?this.resetLoadingState():q&&!K.len&&(k=k.maxFragLookUpTolerance,B=F>q.start+q.duration+k,(F<q.start-
k||B)&&(B&&q.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),q.loader.abort()),this.resetLoadingState()));u&&(this.lastCurrentTime=F);this.loadedmetadata||K.len||(this.nextLoadPosition=this.startPosition=F);this.tickImmediate()},n.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},n.onKeyLoaded=function(k,q){"KEY_LOADING"===this.state&&q.frag===this.fragCurrent&&this.levels&&(this.state="IDLE",(k=this.levels[q.frag.level].details)&&
this.loadFragment(q.frag,k,q.frag.start))},n.onHandlerDestroying=function(){this.stopLoad();G.prototype.onHandlerDestroying.call(this)},n.onHandlerDestroyed=function(){this.state="STOPPED";this.hls.off(Y.a.KEY_LOADED,this.onKeyLoaded,this);this.fragmentLoader&&this.fragmentLoader.destroy();this.decrypter&&this.decrypter.destroy();this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null;G.prototype.onHandlerDestroyed.call(this)},n.loadKey=function(k,q){this.log("Loading key for "+
k.sn+" of ["+q.startSN+"-"+q.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+k.level);this.state="KEY_LOADING";this.fragCurrent=k;this.hls.trigger(Y.a.KEY_LOADING,{frag:k})},n.loadFragment=function(k,q,u){this._loadFragForPlayback(k,q,u)},n._loadFragForPlayback=function(k,q,u){var B=this;this._doFragLoad(k,q,u,function(F){if(B.fragContextChanged(k))return B.warn("Fragment "+k.sn+(F.part?" p: "+F.part.index:"")+" of level "+k.level+" was dropped during download."),void B.fragmentTracker.removeFragment(k);
k.stats.chunkCount++;B._handleFragmentLoadProgress(F)}).then(function(F){if(F){B.fragLoadError=0;var K=B.state;if(!B.fragContextChanged(k))return"payload"in F&&(B.log("Loaded fragment "+k.sn+" of level "+k.level),B.hls.trigger(Y.a.FRAG_LOADED,F),"BACKTRACKING"===B.state)?(B.fragmentTracker.backtrack(k,F),void B.resetFragmentLoading(k)):void B._handleFragmentLoadComplete(F);("FRAG_LOADING"===K||"BACKTRACKING"===K||!B.fragCurrent&&"PARSING"===K)&&(B.fragmentTracker.removeFragment(k),B.state="IDLE")}}).catch(function(F){B.warn(F);
B.resetFragmentLoading(k)})},n.flushMainBuffer=function(k,q,u){if(void 0===u&&(u=null),k-q)k={startOffset:k,endOffset:q,type:u},this.fragLoadError=0,this.hls.trigger(Y.a.BUFFER_FLUSHING,k)},n._loadInitSegment=function(k){var q=this;this._doFragLoad(k).then(function(u){if(!u||q.fragContextChanged(k)||!q.levels)throw Error("init load aborted");return u}).then(function(u){var B=q.hls,F=u.payload,K=k.decryptdata;if(F&&0<F.byteLength&&K&&K.key&&K.iv&&"AES-128"===K.method){var Z=self.performance.now();
return q.decrypter.webCryptoDecrypt(new Uint8Array(F),K.key.buffer,K.iv.buffer).then(function(ja){var ya=self.performance.now();return B.trigger(Y.a.FRAG_DECRYPTED,{frag:k,payload:ja,stats:{tstart:Z,tdecrypt:ya}}),u.payload=ja,u})}return u}).then(function(u){var B=q.fragCurrent,F=q.hls,K=q.levels;if(!K)throw Error("init load aborted, missing levels");K[k.level].details;K=k.stats;q.state="IDLE";q.fragLoadError=0;k.data=new Uint8Array(u.payload);K.parsing.start=K.buffering.start=self.performance.now();
K.parsing.end=K.buffering.end=self.performance.now();u.frag===B&&F.trigger(Y.a.FRAG_BUFFERED,{stats:K,frag:B,part:null,id:k.type});q.tick()}).catch(function(u){q.warn(u);q.resetFragmentLoading(k)})},n.fragContextChanged=function(k){var q=this.fragCurrent;return!k||!q||k.level!==q.level||k.sn!==q.sn||k.urlId!==q.urlId},n.fragBufferedComplete=function(k,q){this.log("Buffered "+k.type+" sn: "+k.sn+(q?" part: "+q.index:"")+" of "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+k.level+" "+
ni.toString(xc.getBuffered(this.mediaBuffer?this.mediaBuffer:this.media)));this.state="IDLE";this.tick()},n._handleFragmentLoadComplete=function(k){var q=this.transmuxer;if(q){var u=k.frag,B=k.part;k=k.partsLoaded;k=!k||0===k.length||k.some(function(F){return!F});u=new Wf(u.level,u.sn,u.stats.chunkCount+1,0,B?B.index:-1,!k);q.flush(u)}},n._handleFragmentLoadProgress=function(k){},n._doFragLoad=function(k,q,u,B){var F=this;if(void 0===u&&(u=null),!this.levels)throw Error("frag load aborted, missing levels");
if(u=Math.max(k.start,u||0),this.config.lowLatencyMode&&q){var K=q.partList;if(K&&B){u>k.end&&q.fragmentHint&&(k=q.fragmentHint);var Z=this.getNextPart(K,k,u);if(-1<Z){var ja=K[Z];return this.log("Loading part sn: "+k.sn+" p: "+ja.index+" cc: "+k.cc+" of playlist ["+q.startSN+"-"+q.endSN+"] parts [0-"+Z+"-"+(K.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+k.level+", target: "+parseFloat(u.toFixed(3))),this.nextLoadPosition=ja.start+ja.duration,this.state="FRAG_LOADING",
this.hls.trigger(Y.a.FRAG_LOADING,{frag:k,part:K[Z],targetBufferTime:u}),this.doFragPartsLoad(k,K,Z,B).catch(function(ya){return F.handleFragLoadError(ya)})}if(!k.url||this.loadedEndOfParts(K,u))return Promise.resolve(null)}}return this.log("Loading fragment "+k.sn+" cc: "+k.cc+" "+(q?"of ["+q.startSN+"-"+q.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+k.level+", target: "+parseFloat(u.toFixed(3))),Object(Zb.a)(k.sn)&&!this.bitrateTest&&(this.nextLoadPosition=k.start+
k.duration),this.state="FRAG_LOADING",this.hls.trigger(Y.a.FRAG_LOADING,{frag:k,targetBufferTime:u}),this.fragmentLoader.load(k,B).catch(function(ya){return F.handleFragLoadError(ya)})},n.doFragPartsLoad=function(k,q,u,B){var F=this;return new Promise(function(K,Z){var ja=[];!function La(Xa){var Wa=q[Xa];F.fragmentLoader.loadPart(k,Wa,B).then(function(db){ja[Wa.index]=db;var bb=db.part;F.hls.trigger(Y.a.FRAG_LOADED,db);db=q[Xa+1];if(!db||db.fragment!==k)return K({frag:k,part:bb,partsLoaded:ja});La(Xa+
1)}).catch(Z)}(u)})},n.handleFragLoadError=function(k){k=k.data;return k&&k.details===hb.a.INTERNAL_ABORTED?this.handleFragLoadAborted(k.frag,k.part):this.hls.trigger(Y.a.ERROR,k),null},n._handleTransmuxerFlush=function(k){var q=this.getCurrentContext(k);if(q&&"PARSING"===this.state){var u=q.frag,B=q.part;q=q.level;var F=self.performance.now();u.stats.parsing.end=F;B&&(B.stats.parsing.end=F);this.updateLevelTiming(u,B,q,k.partial)}else this.fragCurrent||(this.state="IDLE")},n.getCurrentContext=function(k){var q=
this.levels,u=k.level,B=k.sn;k=k.part;if(!q||!q[u])return this.warn("Levels object was unset while buffering fragment "+B+" of level "+u+". The current chunk will not be buffered."),null;q=q[u];return(B=(u=-1<k?function(F,K,Z){if(!F||!F.details)return null;if(F=F.details.partList)for(var ja=F.length;ja--;){var ya=F[ja];if(ya.index===Z&&ya.fragment.sn===K)return ya}return null}(q,B,k):null)?u.fragment:function(F,K,Z){if(!F||!F.details)return null;F=F.details;var ja=F.fragments[K-F.startSN];return ja||
((ja=F.fragmentHint)&&ja.sn===K?ja:K<F.startSN&&Z&&Z.sn===K?Z:null)}(q,B,this.fragCurrent))?{frag:B,part:u,level:q}:null},n.bufferFragmentData=function(k,q,u,B){if(k&&"PARSING"===this.state){var F=k.data1,K=k.data2,Z=F;if(F&&K&&(Z=Object(Sf.a)(F,K)),Z&&Z.length)this.hls.trigger(Y.a.BUFFER_APPENDING,{type:k.type,frag:q,part:u,chunkMeta:B,parent:q.type,data:Z}),k.dropped&&k.independent&&!u&&this.flushBufferGap(q)}},n.flushBufferGap=function(k){var q=this.media;if(q)if(xc.isBuffered(q,q.currentTime)){var u=
q.currentTime,B=xc.bufferInfo(q,u,0);q=Math.min(2*this.config.maxFragLookUpTolerance,.25*k.duration);u=Math.max(Math.min(k.start-q,B.end-q),u+q);k.start-u>q&&this.flushMainBuffer(u,k.start)}else this.flushMainBuffer(0,k.start)},n.getFwdBufferInfo=function(k,q){var u=this.config,B=this.getLoadPosition();if(!Object(Zb.a)(B))return null;var F=xc.bufferInfo(k,B,u.maxBufferHole);return 0===F.len&&void 0!==F.nextStart&&(q=this.fragmentTracker.getBufferedFrag(B,q))&&F.nextStart<q.end?xc.bufferInfo(k,B,Math.max(F.nextStart,
u.maxBufferHole)):F},n.getMaxBufferLength=function(k){var q,u=this.config;return q=k?Math.max(8*u.maxBufferSize/k,u.maxBufferLength):u.maxBufferLength,Math.min(q,u.maxMaxBufferLength)},n.reduceMaxBufferLength=function(k){var q=this.config;return q.maxMaxBufferLength>=(k||q.maxBufferLength)&&(q.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+q.maxMaxBufferLength+"s"),!0)},n.getNextFragment=function(k,q){var u,B,F=q.fragments,K=F.length;if(!K)return null;var Z,ja=this.config,ya=F[0].start;
if(q.live){ya=ja.initialLiveManifestSize;if(K<ya)return this.warn("Not enough fragments to start playback (have: "+K+", need: "+ya+")"),null;q.PTSKnown||this.startFragRequested||-1!==this.startPosition||(Z=this.getInitialLiveFragment(q,F),this.startPosition=Z?this.hls.liveSyncPosition||Z.start:k)}else k<=ya&&(Z=F[0]);Z||=this.getFragmentAtPosition(k,ja.lowLatencyMode?q.partEnd:q.fragmentEnd,q);return null===(u=Z)||void 0===u||!u.initSegment||null!==(B=Z)&&void 0!==B&&B.initSegment.data||this.bitrateTest||
(Z=Z.initSegment),Z},n.getNextPart=function(k,q,u){for(var B=-1,F=!1,K=!0,Z=0,ja=k.length;Z<ja;Z++){var ya=k[Z];if(K=K&&!ya.independent,-1<B&&u<ya.start)break;var Xa=ya.loaded;!Xa&&(F||ya.independent||K)&&ya.fragment===q&&(B=Z);F=Xa}return B},n.loadedEndOfParts=function(k,q){return(k=k[k.length-1])&&q>k.start&&k.loaded},n.getInitialLiveFragment=function(k,q){var u=this.fragPrevious,B=null;if(u){if(k.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+u.programDateTime),
B=function(K,Z,ja){if(null===Z||!Array.isArray(K)||!K.length||!Object(Zb.a)(Z)||Z<(K[0].programDateTime||0)||Z>=(K[K.length-1].endProgramDateTime||0))return null;ja=ja||0;for(var ya=0;ya<K.length;++ya){var Xa=K[ya];if((Xa.endProgramDateTime||0)-1E3*Math.min(ja,Xa.duration+(Xa.deltaPTS?Xa.deltaPTS:0))>Z)return Xa}return null}(q,u.endProgramDateTime,this.config.maxFragLookUpTolerance)),!B){var F=u.sn+1;F>=k.startSN&&F<=k.endSN&&(k=q[F-k.startSN],u.cc===k.cc&&(B=k,this.log("Live playlist, switching playlist, load frag with next SN: "+
B.sn)));B||(B=function(K,Z){return Og.search(K,function(ja){return ja.cc<Z?1:ja.cc>Z?-1:0})}(q,u.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+B.sn)}}else q=this.hls.liveSyncPosition,null!==q&&(B=this.getFragmentAtPosition(q,this.bitrateTest?k.fragmentEnd:k.edge,k));return B},n.getFragmentAtPosition=function(k,q,u){var B,F=this.config,K=this.fragPrevious,Z=u.fragments,ja=u.endSN,ya=u.fragmentHint,Xa=F.maxFragLookUpTolerance;F=!!(F.lowLatencyMode&&u.partList&&ya);(F&&
ya&&!this.bitrateTest&&(Z=Z.concat(ya),ja=ya.sn),k<q)?B=Ia(K,Z,k,k>q-Xa?0:Xa):B=Z[Z.length-1];if(B)if(q=B.sn-u.startSN,u=K&&B.level===K.level,k=Z[q+1],this.fragmentTracker.getState(B)===zc.BACKTRACKED){B=null;for(ja=q;Z[ja]&&this.fragmentTracker.getState(Z[ja])===zc.BACKTRACKED;)B=K?Z[ja--]:Z[--ja];B||=k}else K&&B.sn===K.sn&&!F&&u&&(B.sn<ja&&this.fragmentTracker.getState(k)!==zc.OK?(this.log("SN "+B.sn+" just loaded, load next one: "+k.sn),B=k):B=null);return B},n.synchronizeToLiveEdge=function(k){var q=
this.config,u=this.media;if(u){var B=this.hls.liveSyncPosition,F=u.currentTime,K=k.edge,Z=F>=k.fragments[0].start-q.maxFragLookUpTolerance&&F<=K;null!==B&&u.duration>B&&(F<B||!Z)&&(k=void 0!==q.liveMaxLatencyDuration?q.liveMaxLatencyDuration:q.liveMaxLatencyDurationCount*k.targetduration,(!Z&&4>u.readyState||F<K-k)&&(this.loadedmetadata||(this.nextLoadPosition=B),u.readyState&&(this.warn("Playback: "+F.toFixed(3)+" is located too far from the end of live sliding playlist: "+K+", reset currentTime to : "+
B.toFixed(3)),u.currentTime=B)))}},n.alignPlaylists=function(k,q){var u=this.levels,B=this.levelLastLoaded,F=this.fragPrevious;B=null!==B?u[B]:null;u=k.fragments.length;if(!u)return this.warn("No fragments in live playlist"),0;var K=k.fragments[0].start,Z=!q,ja=k.alignedSliding&&Object(Zb.a)(K);return Z||!ja&&!K?(gb(F,B,k),B=k.fragments[0].start,this.log("Live playlist sliding: "+B.toFixed(2)+" start-sn: "+(q?q.startSN:"na")+"->"+k.startSN+" prev-sn: "+(F?F.sn:"na")+" fragments: "+u),B):K},n.waitForCdnTuneIn=
function(k){return k.live&&k.canBlockReload&&k.tuneInGoal>Math.max(k.partHoldBack,3*k.partTarget)},n.setStartPosition=function(k,q){var u=this.startPosition;if(u<q&&(u=-1),-1===u||-1===this.lastCurrentTime){var B=k.startTimeOffset;Object(Zb.a)(B)?(u=q+B,0>B&&(u+=k.totalduration),u=Math.min(Math.max(q,u),q+k.totalduration),this.log("Start time offset "+B+" found in playlist, adjust startPosition to "+u),this.startPosition=u):k.live?u=this.hls.liveSyncPosition||q:this.startPosition=u=0;this.lastCurrentTime=
u}this.nextLoadPosition=u},n.getLoadPosition=function(){var k=this.media,q=0;return this.loadedmetadata&&k?q=k.currentTime:this.nextLoadPosition&&(q=this.nextLoadPosition),q},n.handleFragLoadAborted=function(k,q){this.transmuxer&&"initSegment"!==k.sn&&k.stats.aborted&&(this.warn("Fragment "+k.sn+(q?" part"+q.index:"")+" of level "+k.level+" was aborted"),this.resetFragmentLoading(k))},n.resetFragmentLoading=function(k){this.fragCurrent&&this.fragContextChanged(k)||(this.state="IDLE")},n.onFragmentOrKeyLoadError=
function(k,q){if(!q.fatal){var u=q.frag;if(u&&u.type===k){this.fragCurrent;var B=this.config;this.fragLoadError+1<=B.fragLoadingMaxRetry?this.resetLiveStartWhenNotLoaded(u.level)||(q=Math.min(Math.pow(2,this.fragLoadError)*B.fragLoadingRetryDelay,B.fragLoadingMaxRetryTimeout),this.warn("Fragment "+u.sn+" of "+k+" "+u.level+" failed to load, retrying in "+q+"ms"),this.retryDate=self.performance.now()+q,this.fragLoadError++,this.state="FRAG_LOADING_WAITING_RETRY"):q.levelRetry?(k===Hb.b.AUDIO&&(this.fragCurrent=
null),this.fragLoadError=0,this.state="IDLE"):(Ua.b.error(q.details+" reaches max retry, redispatch as fatal ..."),q.fatal=!0,this.hls.stopLoad(),this.state="ERROR")}}},n.afterBufferFlushed=function(k,q,u){k&&(k=xc.getBuffered(k),this.fragmentTracker.detectEvictedFragments(q,k,u),"ENDED"===this.state&&this.resetLoadingState())},n.resetLoadingState=function(){this.fragPrevious=this.fragCurrent=null;this.state="IDLE"},n.resetLiveStartWhenNotLoaded=function(k){if(!this.loadedmetadata){this.startFragRequested=
!1;k=this.levels?this.levels[k].details:null;if(null!=k&&k.live)return this.startPosition=-1,this.setStartPosition(k,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},n.updateLevelTiming=function(k,q,u,B){var F=this,K=u.details;Object.keys(k.elementaryStreams).reduce(function(Z,ja){var ya=k.elementaryStreams[ja];if(ya){var Xa=ya.endPTS-ya.startPTS;if(0>=Xa)return F.warn("Could not parse fragment "+k.sn+" "+ja+" duration reliably ("+Xa+") resetting transmuxer to fallback to playlist timing"),
F.resetTransmuxer(),Z||!1;Z=B?0:wa(K,k,ya.startPTS,ya.endPTS,ya.startDTS,ya.endDTS);return F.hls.trigger(Y.a.LEVEL_PTS_UPDATED,{details:K,level:u,drift:Z,type:ja,frag:k,start:ya.startPTS,end:ya.endPTS}),!0}return Z},!1)?(this.state="PARSED",this.hls.trigger(Y.a.FRAG_PARSED,{frag:k,part:q})):this.resetLoadingState()},n.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},p=[{key:"state",get:function(){return this._state},set:function(k){var q=this._state;q!==
k&&(this._state=k,this.log(q+"->"+k))}}],Bb(z.prototype,p),z}(ki),oi=h(18),oe=h(10),Rg=h(14),qf=self.MediaSource||self.WebKitMediaSource||{isTypeSupported:function(){return!1}},Sg=function(){function G(p,n,k,q){var u=this;this.observer=this.id=this.hls=void 0;this.part=this.frag=null;this.onwmsg=this.worker=void 0;this.transmuxer=null;this.onFlush=this.onTransmuxComplete=void 0;this.hls=p;this.id=n;this.onTransmuxComplete=k;this.onFlush=q;k=p.config;q=function(K,Z){(Z=Z||{}).frag=u.frag;Z.id=u.id;
p.trigger(K,Z)};this.observer=new Rg.EventEmitter;this.observer.on(Y.a.FRAG_DECRYPTED,q);this.observer.on(Y.a.ERROR,q);q={mp4:qf.isTypeSupported("video/mp4"),mpeg:qf.isTypeSupported("audio/mpeg"),mp3:qf.isTypeSupported('audio/mp4; codecs="mp3"')};var B=navigator.vendor;if(k.enableWorker&&"undefined"!=typeof Worker){Ua.b.log("demuxing in webworker");try{var F=this.worker=oi(19);this.onwmsg=this.onWorkerMessage.bind(this);F.addEventListener("message",this.onwmsg);F.onerror=function(K){p.trigger(Y.a.ERROR,
{type:hb.b.OTHER_ERROR,details:hb.a.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:Error(K.message+"  ("+K.filename+":"+K.lineno+")")})};F.postMessage({cmd:"init",typeSupported:q,vendor:B,id:n,config:JSON.stringify(k)})}catch(K){Ua.b.warn("Error in worker:",K),Ua.b.error("Error while initializing DemuxerWorker, fallback to inline"),F&&self.URL.revokeObjectURL(F.objectURL),this.transmuxer=new oe.c(this.observer,q,k,B,n),this.worker=null}}else this.transmuxer=new oe.c(this.observer,q,k,B,n)}
var z=G.prototype;return z.destroy=function(){var p=this.worker;p?(p.removeEventListener("message",this.onwmsg),p.terminate(),this.worker=null):(p=this.transmuxer)&&(p.destroy(),this.transmuxer=null);(p=this.observer)&&p.removeAllListeners();this.observer=null},z.push=function(p,n,k,q,u,B,F,K,Z,ja){var ya,Xa,La=this;Z.transmuxing.start=self.performance.now();var Wa=this.transmuxer,db=this.worker,bb=B?B.start:u.start,sb=u.decryptdata,Wb=this.frag,tb=!(Wb&&u.cc===Wb.cc),bc=!(Wb&&Z.level===Wb.level),
fc=Wb?Z.sn-Wb.sn:-1,ub=this.part?Z.part-this.part.index:1,Ac=!bc&&(1===fc||0===fc&&1===ub),Uc=self.performance.now();(bc||fc||0===u.stats.parsing.start)&&(u.stats.parsing.start=Uc);!B||!ub&&Ac||(B.stats.parsing.start=Uc);fc=!(Wb&&(null===(ya=u.initSegment)||void 0===ya?void 0:ya.url)===(null===(Xa=Wb.initSegment)||void 0===Xa?void 0:Xa.url));ya=new oe.b(tb,Ac,K,bc,bb,fc);if(!Ac||tb||fc)Ua.b.log("[transmuxer-interface, "+u.type+"]: Starting new transmux session for sn: "+Z.sn+" p: "+Z.part+" level: "+
Z.level+" id: "+Z.id+"\n        discontinuity: "+tb+"\n        trackSwitch: "+bc+"\n        contiguous: "+Ac+"\n        accurateTimeOffset: "+K+"\n        timeOffset: "+bb+"\n        initSegmentChange: "+fc),n=new oe.a(k,q,n,F,ja),this.configureTransmuxer(n);(this.frag=u,this.part=B,db)?db.postMessage({cmd:"demux",data:p,decryptdata:sb,chunkMeta:Z,state:ya},p instanceof ArrayBuffer?[p]:[]):Wa&&(p=Wa.push(p,sb,Z,ya),Object(oe.d)(p)?p.then(function(Eb){La.handleTransmuxComplete(Eb)}):this.handleTransmuxComplete(p))},
z.flush=function(p){var n=this;p.transmuxing.start=self.performance.now();var k=this.transmuxer,q=this.worker;q?q.postMessage({cmd:"flush",chunkMeta:p}):k&&(k=k.flush(p),Object(oe.d)(k)?k.then(function(u){n.handleFlushResult(u,p)}):this.handleFlushResult(k,p))},z.handleFlushResult=function(p,n){var k=this;p.forEach(function(q){k.handleTransmuxComplete(q)});this.onFlush(n)},z.onWorkerMessage=function(p){p=p.data;var n=this.hls;switch(p.event){case "init":self.URL.revokeObjectURL(this.worker.objectURL);
break;case "transmuxComplete":this.handleTransmuxComplete(p.data);break;case "flush":this.onFlush(p.data);break;default:p.data=p.data||{},p.data.frag=this.frag,p.data.id=this.id,n.trigger(p.event,p.data)}},z.configureTransmuxer=function(p){var n=this.worker,k=this.transmuxer;n?n.postMessage({cmd:"configure",config:p}):k&&k.configure(p)},z.handleTransmuxComplete=function(p){p.chunkMeta.transmuxing.end=self.performance.now();this.onTransmuxComplete(p)},G}(),Bd=function(){function G(p,n,k,q){this.hls=
this.fragmentTracker=this.media=this.config=void 0;this.nudgeRetry=0;this.stallReported=!1;this.stalled=null;this.seeking=this.moved=!1;this.config=p;this.media=n;this.fragmentTracker=k;this.hls=q}var z=G.prototype;return z.destroy=function(){this.hls=this.fragmentTracker=this.media=null},z.poll=function(p){var n=this.config,k=this.media,q=this.stalled,u=k.currentTime,B=k.seeking,F=this.seeking&&!B,K=!this.seeking&&B;if(this.seeking=B,u===p){if((K||F)&&(this.stalled=null),!k.paused&&!k.ended&&0!==
k.playbackRate&&xc.getBuffered(k).length)if(p=xc.bufferInfo(k,u,0),F=p.nextStart||0,0<p.len||F){if(B){K=2<p.len;var Z=!F||2<F-u&&!this.fragmentTracker.getPartialFragment(u);if(K||Z)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var ja;F=Math.max(F,p.start||0)-u;K=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null;Z=(null==K||null===(ja=K.details)||void 0===ja?0:ja.live)?2*K.details.targetduration:2;if(0<F&&F<=Z)return void this._trySkipBufferHole(null)}ja=self.performance.now();
null!==q?(q=ja-q,!B&&250<=q&&this._reportStall(p.len),u=xc.bufferInfo(k,u,n.maxBufferHole),this._tryFixBufferStall(u,q)):this.stalled=ja}}else if(this.moved=!0,null!==q)this.stallReported&&(n=self.performance.now()-q,Ua.b.warn("playback not stuck anymore @"+u+", after "+Math.round(n)+"ms"),this.stallReported=!1),this.stalled=null,this.nudgeRetry=0},z._tryFixBufferStall=function(p,n){var k=this.config,q=this.fragmentTracker.getPartialFragment(this.media.currentTime);q&&this._trySkipBufferHole(q)||
p.len>k.maxBufferHole&&n>1E3*k.highBufferWatchdogPeriod&&(Ua.b.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},z._reportStall=function(p){var n=this.hls,k=this.media;this.stallReported||(this.stallReported=!0,Ua.b.warn("Playback stalling at @"+k.currentTime+" due to low buffer (buffer="+p+")"),n.trigger(Y.a.ERROR,{type:hb.b.MEDIA_ERROR,details:hb.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:p}))},z._trySkipBufferHole=function(p){for(var n=this.config,k=this.hls,
q=this.media,u=q.currentTime,B=0,F=xc.getBuffered(q),K=0;K<F.length;K++){var Z=F.start(K);if(u+n.maxBufferHole>=B&&u<Z)return n=Math.max(Z+.05,q.currentTime+.1),Ua.b.warn("skipping hole, adjusting currentTime from "+u+" to "+n),this.moved=!0,this.stalled=null,q.currentTime=n,p&&k.trigger(Y.a.ERROR,{type:hb.b.MEDIA_ERROR,details:hb.a.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+u+" to "+n,frag:p}),n;B=F.end(K)}return 0},z._tryNudgeBuffer=function(){var p=
this.config,n=this.hls,k=this.media,q=k.currentTime,u=(this.nudgeRetry||0)+1;(this.nudgeRetry=u,u<p.nudgeMaxRetry)?(p=q+u*p.nudgeOffset,Ua.b.warn("Nudging 'currentTime' from "+q+" to "+p),k.currentTime=p,n.trigger(Y.a.ERROR,{type:hb.b.MEDIA_ERROR,details:hb.a.BUFFER_NUDGE_ON_STALL,fatal:!1})):(Ua.b.error("Playhead still not moving while enough data buffered @"+q+" after "+p.nudgeMaxRetry+" nudges"),n.trigger(Y.a.ERROR,{type:hb.b.MEDIA_ERROR,details:hb.a.BUFFER_STALLED_ERROR,fatal:!0}))},G}(),Cd=function(G){function z(k,
q){var u;return(u=G.call(this,k,q,"[stream-controller]")||this).audioCodecSwap=!1,u.gapController=null,u.level=-1,u._forceStartLoad=!1,u.altAudio=!1,u.audioOnly=!1,u.fragPlaying=null,u.onvplaying=null,u.onvseeked=null,u.fragLastKbps=0,u.stalled=!1,u.couldBacktrack=!1,u.audioCodecSwitch=!1,u.videoBuffer=null,u._registerListeners(),u}z.prototype=Object.create(G.prototype);z.prototype.constructor=z;Ab(z,G);var p,n=z.prototype;return n._registerListeners=function(){var k=this.hls;k.on(Y.a.MEDIA_ATTACHED,
this.onMediaAttached,this);k.on(Y.a.MEDIA_DETACHING,this.onMediaDetaching,this);k.on(Y.a.MANIFEST_LOADING,this.onManifestLoading,this);k.on(Y.a.MANIFEST_PARSED,this.onManifestParsed,this);k.on(Y.a.LEVEL_LOADING,this.onLevelLoading,this);k.on(Y.a.LEVEL_LOADED,this.onLevelLoaded,this);k.on(Y.a.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this);k.on(Y.a.ERROR,this.onError,this);k.on(Y.a.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this);k.on(Y.a.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,
this);k.on(Y.a.BUFFER_CREATED,this.onBufferCreated,this);k.on(Y.a.BUFFER_FLUSHED,this.onBufferFlushed,this);k.on(Y.a.LEVELS_UPDATED,this.onLevelsUpdated,this);k.on(Y.a.FRAG_BUFFERED,this.onFragBuffered,this)},n._unregisterListeners=function(){var k=this.hls;k.off(Y.a.MEDIA_ATTACHED,this.onMediaAttached,this);k.off(Y.a.MEDIA_DETACHING,this.onMediaDetaching,this);k.off(Y.a.MANIFEST_LOADING,this.onManifestLoading,this);k.off(Y.a.MANIFEST_PARSED,this.onManifestParsed,this);k.off(Y.a.LEVEL_LOADED,this.onLevelLoaded,
this);k.off(Y.a.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this);k.off(Y.a.ERROR,this.onError,this);k.off(Y.a.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this);k.off(Y.a.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this);k.off(Y.a.BUFFER_CREATED,this.onBufferCreated,this);k.off(Y.a.BUFFER_FLUSHED,this.onBufferFlushed,this);k.off(Y.a.LEVELS_UPDATED,this.onLevelsUpdated,this);k.off(Y.a.FRAG_BUFFERED,this.onFragBuffered,this)},n.onHandlerDestroying=function(){this._unregisterListeners();
this.onMediaDetaching()},n.startLoad=function(k){if(this.levels){var q=this.lastCurrentTime,u=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var B=u.startLevel;-1===B&&(u.config.testBandwidth?(B=0,this.bitrateTest=!0):B=u.nextAutoLevel);this.level=u.nextLoadLevel=B;this.loadedmetadata=!1}0<q&&-1===k&&(this.log("Override startPosition with lastCurrentTime @"+q.toFixed(3)),k=q);this.state="IDLE";this.nextLoadPosition=this.startPosition=
this.lastCurrentTime=k;this.tick()}else this._forceStartLoad=!0,this.state="STOPPED"},n.stopLoad=function(){this._forceStartLoad=!1;G.prototype.stopLoad.call(this)},n.doTick=function(){switch(this.state){case "IDLE":this.doTickIdle();break;case "WAITING_LEVEL":var k,q=this.levels,u=this.level;!(q=null==q||null===(k=q[u])||void 0===k?void 0:k.details)||q.live&&this.levelLastLoaded!==this.level||this.waitForCdnTuneIn(q)||(this.state="IDLE");break;case "FRAG_LOADING_WAITING_RETRY":k=self.performance.now(),
u=this.retryDate,(!u||k>=u||null!==(q=this.media)&&void 0!==q&&q.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state="IDLE")}this.onTickEnd()},n.onTickEnd=function(){G.prototype.onTickEnd.call(this);this.checkBuffer();this.checkFragmentChanged()},n.doTickIdle=function(){var k,q=this.hls,u=this.levels,B=this.media,F=q.config,K=q.nextLoadLevel;if(null!==this.levelLastLoaded&&(B||!this.startFragRequested&&F.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&u&&u[K])if(u=
u[K],this.level=q.nextLoadLevel=K,q=u.details,!q||"WAITING_LEVEL"===this.state||q.live&&this.levelLastLoaded!==K)this.state="WAITING_LEVEL";else if(K=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:B,Hb.b.MAIN),null!==K&&!(K.len>=this.getMaxBufferLength(u.maxBitrate))){if(this._streamEnded(K,q)){var Z={};return this.altAudio&&(Z.type="video"),this.hls.trigger(Y.a.BUFFER_EOS,Z),void(this.state="ENDED")}K=K.end;u=this.getNextFragment(K,q);this.couldBacktrack&&!this.fragPrevious&&u&&"initSegment"!==
u.sn&&(F=u.sn-q.startSN,1<F&&(u=q.fragments[F-1],this.fragmentTracker.removeFragment(u)));u&&this.fragmentTracker.getState(u)===zc.OK&&this.nextLoadPosition>K&&(this.afterBufferFlushed(B,this.audioOnly&&!this.altAudio?Gc.a.AUDIO:Gc.a.VIDEO,Hb.b.MAIN),u=this.getNextFragment(this.nextLoadPosition,q));u&&(!u.initSegment||u.initSegment.data||this.bitrateTest||(u=u.initSegment),"identity"!==(null===(Z=u.decryptdata)||void 0===Z?void 0:Z.keyFormat)||null!==(k=u.decryptdata)&&void 0!==k&&k.key?this.loadFragment(u,
q,K):this.loadKey(u,q))}},n.loadFragment=function(k,q,u){var B,F=this.fragmentTracker.getState(k);if(this.fragCurrent=k,F===zc.BACKTRACKED){if(F=this.fragmentTracker.getBacktrackData(k))return this._handleFragmentLoadProgress(F),void this._handleFragmentLoadComplete(F);F=zc.NOT_LOADED}F===zc.NOT_LOADED||F===zc.PARTIAL?"initSegment"===k.sn?this._loadInitSegment(k):this.bitrateTest?(k.bitrateTest=!0,this.log("Fragment "+k.sn+" of level "+k.level+" is being downloaded to test bitrate and will not be buffered"),
this._loadBitrateTestFrag(k)):(this.startFragRequested=!0,G.prototype.loadFragment.call(this,k,q,u)):F===zc.APPENDING?this.reduceMaxBufferLength(k.duration)&&this.fragmentTracker.removeFragment(k):0===(null===(B=this.media)||void 0===B?void 0:B.buffered.length)&&this.fragmentTracker.removeAllFragments()},n.getAppendedFrag=function(k){return(k=this.fragmentTracker.getAppendedFrag(k,Hb.b.MAIN))&&"fragment"in k?k.fragment:k},n.getBufferedFrag=function(k){return this.fragmentTracker.getBufferedFrag(k,
Hb.b.MAIN)},n.followingBufferedFrag=function(k){return k?this.getBufferedFrag(k.end+.5):null},n.immediateLevelSwitch=function(){this.abortCurrentFrag();this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},n.nextLevelSwitch=function(){var k=this.levels,q=this.media;if(null!=q&&q.readyState){var u=this.getAppendedFrag(q.currentTime);(u&&1<u.start&&this.flushMainBuffer(0,u.start-1),!q.paused&&k)?(k=k[this.hls.nextLoadLevel],k=(u=this.fragLastKbps)&&this.fragCurrent?this.fragCurrent.duration*k.maxBitrate/
(1E3*u)+1:0):k=0;if(q=this.getBufferedFrag(q.currentTime+k))if(k=this.followingBufferedFrag(q))this.abortCurrentFrag(),u=k.duration,this.flushMainBuffer(Math.max(q.end,(k.maxStartPTS?k.maxStartPTS:k.start)+Math.min(Math.max(u-this.config.maxFragLookUpTolerance,.5*u),.75*u)),Number.POSITIVE_INFINITY)}},n.abortCurrentFrag=function(){var k=this.fragCurrent;this.fragCurrent=null;null!=k&&k.loader&&k.loader.abort();"KEY_LOADING"===this.state&&(this.state="IDLE");this.nextLoadPosition=this.getLoadPosition()},
n.flushMainBuffer=function(k,q){G.prototype.flushMainBuffer.call(this,k,q,this.altAudio?"video":null)},n.onMediaAttached=function(k,q){G.prototype.onMediaAttached.call(this,k,q);k=q.media;this.onvplaying=this.onMediaPlaying.bind(this);this.onvseeked=this.onMediaSeeked.bind(this);k.addEventListener("playing",this.onvplaying);k.addEventListener("seeked",this.onvseeked);this.gapController=new Bd(this.config,k,this.fragmentTracker,this.hls)},n.onMediaDetaching=function(){var k=this.media;k&&(k.removeEventListener("playing",
this.onvplaying),k.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null);this.fragPlaying=null;this.gapController&&(this.gapController.destroy(),this.gapController=null);G.prototype.onMediaDetaching.call(this)},n.onMediaPlaying=function(){this.tick()},n.onMediaSeeked=function(){var k=this.media;k=k?k.currentTime:null;Object(Zb.a)(k)&&this.log("Media seeked to "+k.toFixed(3));this.tick()},n.onManifestLoading=function(){this.log("Trigger BUFFER_RESET");
this.hls.trigger(Y.a.BUFFER_RESET,void 0);this.fragmentTracker.removeAllFragments();this.couldBacktrack=this.stalled=!1;this.startPosition=this.lastCurrentTime=0;this.fragPlaying=null},n.onManifestParsed=function(k,q){var u,B,F,K=!1,Z=!1;q.levels.forEach(function(ja){(u=ja.audioCodec)&&(-1!==u.indexOf("mp4a.40.2")&&(K=!0),-1!==u.indexOf("mp4a.40.5")&&(Z=!0))});(this.audioCodecSwitch=K&&Z&&"function"!=typeof(null==(F=self.SourceBuffer||self.WebKitSourceBuffer)||null===(B=F.prototype)||void 0===B?void 0:
B.changeType))&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC");this.levels=q.levels;this.startFragRequested=!1},n.onLevelLoading=function(k,q){(k=this.levels)&&"IDLE"===this.state&&(k=k[q.level],(!k.details||k.details.live&&this.levelLastLoaded!==q.level||this.waitForCdnTuneIn(k.details))&&(this.state="WAITING_LEVEL"))},n.onLevelLoaded=function(k,q){var u,B=this.levels;k=q.level;var F=q.details,K=F.totalduration;if(B){this.log("Level "+k+" loaded ["+F.startSN+","+
F.endSN+"], cc ["+F.startCC+", "+F.endCC+"] duration:"+K);K=this.fragCurrent;!K||"FRAG_LOADING"!==this.state&&"FRAG_LOADING_WAITING_RETRY"!==this.state||K.level!==q.level&&K.loader&&(this.state="IDLE",K.loader.abort());q=B[k];B=0;if(F.live||null!==(u=q.details)&&void 0!==u&&u.live){if(F.fragments[0]||(F.deltaUpdateFailed=!0),F.deltaUpdateFailed)return;B=this.alignPlaylists(F,q.details)}if(q.details=F,this.levelLastLoaded=k,this.hls.trigger(Y.a.LEVEL_UPDATED,{details:F,level:k}),"WAITING_LEVEL"===
this.state){if(this.waitForCdnTuneIn(F))return;this.state="IDLE"}this.startFragRequested?F.live&&this.synchronizeToLiveEdge(F):this.setStartPosition(F,B);this.tick()}else this.warn("Levels were reset while loading level "+k)},n._handleFragmentLoadProgress=function(k){var q,u=k.frag,B=k.part;k=k.payload;var F=this.levels;if(F){var K=F[u.level];if(F=K.details){var Z=K.videoCodec,ja=F.PTSKnown||!F.live,ya=null===(q=u.initSegment)||void 0===q?void 0:q.data;q=this._getAudioCodec(K);K=this.transmuxer=this.transmuxer||
new Sg(this.hls,Hb.b.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this));var Xa=B?B.index:-1;Xa=new Wf(u.level,u.sn,u.stats.chunkCount,k.byteLength,Xa,-1!==Xa);K.push(k,ya,q,Z,u,B,F.totalduration,ja,Xa,this.initPTS[u.cc])}else this.warn("Dropping fragment "+u.sn+" of level "+u.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+u.sn+" of level "+u.level+" will not be buffered")},n.onAudioTrackSwitching=
function(k,q){k=this.altAudio;var u=q.id;q.url||(this.mediaBuffer!==this.media?(this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media,q=this.fragCurrent,null!=q&&q.loader&&(this.log("Switching to main audio track, cancel main fragment load"),q.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()):this.audioOnly&&this.resetTransmuxer(),q=this.hls,k&&q.trigger(Y.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,
type:"audio"}),q.trigger(Y.a.AUDIO_TRACK_SWITCHED,{id:u}))},n.onAudioTrackSwitched=function(k,q){(k=!!this.hls.audioTracks[q.id].url)&&(q=this.videoBuffer)&&this.mediaBuffer!==q&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=q);this.altAudio=k;this.tick()},n.onBufferCreated=function(k,q){var u,B;k=q.tracks;q=!1;for(var F in k){var K=k[F];"main"===K.id?(B=F,u=K,"video"===F)&&(K=k[F])&&(this.videoBuffer=K.buffer):q=!0}q&&u?(this.log("Alternate track found, use "+
B+".buffered to schedule main fragment loading"),this.mediaBuffer=u.buffer):this.mediaBuffer=this.media},n.onFragBuffered=function(k,q){k=q.frag;q=q.part;if(!k||k.type===Hb.b.MAIN){if(this.fragContextChanged(k))return this.warn("Fragment "+k.sn+(q?" p: "+q.index:"")+" of level "+k.level+" finished buffering, but was aborted. state: "+this.state),void("PARSED"===this.state&&(this.state="IDLE"));var u=q?q.stats:k.stats;this.fragLastKbps=Math.round(8*u.total/(u.buffering.end-u.loading.first));"initSegment"!==
k.sn&&(this.fragPrevious=k);this.fragBufferedComplete(k,q)}},n.onError=function(k,q){switch(q.details){case hb.a.FRAG_LOAD_ERROR:case hb.a.FRAG_LOAD_TIMEOUT:case hb.a.KEY_LOAD_ERROR:case hb.a.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Hb.b.MAIN,q);break;case hb.a.LEVEL_LOAD_ERROR:case hb.a.LEVEL_LOAD_TIMEOUT:"ERROR"!==this.state&&(q.fatal?(this.warn(""+q.details),this.state="ERROR"):q.levelRetry||"WAITING_LEVEL"!==this.state||(this.state="IDLE"));break;case hb.a.BUFFER_FULL_ERROR:"main"!==q.parent||
"PARSING"!==this.state&&"PARSED"!==this.state||(k=!0,(q=this.getFwdBufferInfo(this.media,Hb.b.MAIN))&&.5<q.len&&(k=!this.reduceMaxBufferLength(q.len)),k&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState())}},n.checkBuffer=function(){var k=this.media,q=this.gapController;if(k&&q&&k.readyState){var u=xc.getBuffered(k);!this.loadedmetadata&&u.length?(this.loadedmetadata=!0,this.seekToStartPos()):q.poll(this.lastCurrentTime);
this.lastCurrentTime=k.currentTime}},n.onFragLoadEmergencyAborted=function(){this.state="IDLE";this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);this.tickImmediate()},n.onBufferFlushed=function(k,q){k=q.type;(k!==Gc.a.AUDIO||this.audioOnly&&!this.altAudio)&&this.afterBufferFlushed((k===Gc.a.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media,k,Hb.b.MAIN)},n.onLevelsUpdated=function(k,q){this.levels=q.levels},n.swapAudioCodec=function(){this.audioCodecSwap=
!this.audioCodecSwap},n.seekToStartPos=function(){var k=this.media,q=k.currentTime,u=this.startPosition;if(0<=u&&q<u){if(k.seeking)return void Ua.b.log("could not seek to "+u+", already seeking at "+q);var B=xc.getBuffered(k);B=(B.length?B.start(0):0)-u;0<B&&(B<this.config.maxBufferHole||B<this.config.maxFragLookUpTolerance)&&(Ua.b.log("adjusting start position by "+B+" to match buffer start"),u+=B,this.startPosition=u);this.log("seek to target start position "+u+" from current time "+q);k.currentTime=
u}},n._getAudioCodec=function(k){k=this.config.defaultAudioCodec||k.audioCodec;return this.audioCodecSwap&&k&&(this.log("Swapping audio codec"),k=-1!==k.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),k},n._loadBitrateTestFrag=function(k){var q=this;this._doFragLoad(k).then(function(u){var B=q.hls;if(u&&!B.nextLoadLevel&&!q.fragContextChanged(k)){q.fragLoadError=0;q.state="IDLE";q.startFragRequested=!1;q.bitrateTest=!1;var F=k.stats;F.parsing.start=F.parsing.end=F.buffering.start=F.buffering.end=self.performance.now();
B.trigger(Y.a.FRAG_LOADED,u)}})},n._handleTransmuxComplete=function(k){var q,u=this.hls,B=k.remuxResult;k=k.chunkMeta;var F=this.getCurrentContext(k);if(!F)return this.warn("The loading context changed while buffering fragment "+k.sn+" of level "+k.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(k.level);var K=F.frag,Z=F.part,ja=F.level,ya=B.video;F=B.text;var Xa=B.id3,La=B.initSegment,Wa=this.altAudio?void 0:B.audio;if(!this.fragContextChanged(K)){if(this.state=
"PARSING",La){La.tracks&&(this._bufferInitSegment(ja,La.tracks,K,k),u.trigger(Y.a.FRAG_PARSING_INIT_SEGMENT,{frag:K,id:"main",tracks:La.tracks}));var db=La.initPTS;La=La.timescale;Object(Zb.a)(db)&&(this.initPTS[K.cc]=db,u.trigger(Y.a.INIT_PTS_FOUND,{frag:K,id:"main",initPTS:db,timescale:La}))}if(ya&&!1!==B.independent){if(ja.details){B=ya.startPTS;ja=ya.endPTS;db=ya.startDTS;La=ya.endDTS;if(Z)Z.elementaryStreams[ya.type]={startPTS:B,endPTS:ja,startDTS:db,endDTS:La};else if(ya.firstKeyFrame&&ya.independent&&
(this.couldBacktrack=!0),ya.dropped&&ya.independent){if(this.getLoadPosition()+this.config.maxBufferHole<B)return void this.backtrack(K);K.setElementaryStreamInfo(ya.type,K.start,ja,K.start,La,!0)}K.setElementaryStreamInfo(ya.type,B,ja,db,La);this.bufferFragmentData(ya,K,Z,k)}}else if(!1===B.independent)return void this.backtrack(K);Wa&&(ya=Wa.startPTS,B=Wa.endPTS,ja=Wa.startDTS,db=Wa.endDTS,Z&&(Z.elementaryStreams[Gc.a.AUDIO]={startPTS:ya,endPTS:B,startDTS:ja,endDTS:db}),K.setElementaryStreamInfo(Gc.a.AUDIO,
ya,B,ja,db),this.bufferFragmentData(Wa,K,Z,k));null!=Xa&&null!==(q=Xa.samples)&&void 0!==q&&q.length&&u.trigger(Y.a.FRAG_PARSING_METADATA,{frag:K,id:"main",samples:Xa.samples});F&&u.trigger(Y.a.FRAG_PARSING_USERDATA,{frag:K,id:"main",samples:F.samples})}},n._bufferInitSegment=function(k,q,u,B){var F=this;if("PARSING"===this.state){this.audioOnly=!!q.audio&&!q.video;this.altAudio&&!this.audioOnly&&delete q.audio;var K=q.audio,Z=q.video,ja=q.audiovideo;if(K){var ya=k.audioCodec,Xa=navigator.userAgent.toLowerCase();
this.audioCodecSwitch&&(ya&&=-1!==ya.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5",1!==K.metadata.channelCount&&-1===Xa.indexOf("firefox")&&(ya="mp4a.40.5"));-1!==Xa.indexOf("android")&&"audio/mpeg"!==K.container&&(ya="mp4a.40.2",this.log("Android: force audio codec to "+ya));k.audioCodec&&k.audioCodec!==ya&&this.log('Swapping manifest audio codec "'+k.audioCodec+'" for "'+ya+'"');K.levelCodec=ya;K.id="main";this.log("Init audio buffer, container:"+K.container+", codecs[selected/level/parsed]=["+(ya||
"")+"/"+(k.audioCodec||"")+"/"+K.codec+"]")}Z&&(Z.levelCodec=k.videoCodec,Z.id="main",this.log("Init video buffer, container:"+Z.container+", codecs[level/parsed]=["+(k.videoCodec||"")+"/"+Z.codec+"]"));ja&&this.log("Init audiovideo buffer, container:"+ja.container+", codecs[level/parsed]=["+(k.attrs.CODECS||"")+"/"+ja.codec+"]");this.hls.trigger(Y.a.BUFFER_CODECS,q);Object.keys(q).forEach(function(La){var Wa=q[La].initSegment;null!=Wa&&Wa.byteLength&&F.hls.trigger(Y.a.BUFFER_APPENDING,{type:La,data:Wa,
frag:u,part:null,chunkMeta:B,parent:u.type})});this.tick()}},n.backtrack=function(k){this.couldBacktrack=!0;this.resetTransmuxer();this.flushBufferGap(k);var q=this.fragmentTracker.backtrack(k);this.fragPrevious=null;this.nextLoadPosition=k.start;q?this.resetFragmentLoading(k):this.state="BACKTRACKING"},n.checkFragmentChanged=function(){var k=this.media,q=null;if(k&&1<k.readyState&&!1===k.seeking){var u=k.currentTime;if(xc.isBuffered(k,u)?q=this.getAppendedFrag(u):xc.isBuffered(k,u+.1)&&(q=this.getAppendedFrag(u+
.1)),q)k=this.fragPlaying,u=q.level,k&&q.sn===k.sn&&k.level===u&&q.urlId===k.urlId||(this.hls.trigger(Y.a.FRAG_CHANGED,{frag:q}),k&&k.level===u||this.hls.trigger(Y.a.LEVEL_SWITCHED,{level:u}),this.fragPlaying=q)}},p=[{key:"nextLevel",get:function(){var k=this.nextBufferedFrag;return k?k.level:-1}},{key:"currentLevel",get:function(){var k=this.media;return k&&(k=this.getAppendedFrag(k.currentTime))?k.level:-1}},{key:"nextBufferedFrag",get:function(){var k=this.media;return k?(k=this.getAppendedFrag(k.currentTime),
this.followingBufferedFrag(k)):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}],Ob(z.prototype,p),z}(Xf),Ne=function(){function G(p,n,k){void 0===n&&(n=0);void 0===k&&(k=0);this.totalWeight_=this.estimate_=this.alpha_=void 0;this.alpha_=(this.halfLife=p)?Math.exp(Math.log(.5)/p):0;this.estimate_=n;this.totalWeight_=k}var z=G.prototype;return z.sample=function(p,n){var k=Math.pow(this.alpha_,p);this.estimate_=n*(1-k)+k*this.estimate_;this.totalWeight_+=p},z.getTotalWeight=
function(){return this.totalWeight_},z.getEstimate=function(){if(this.alpha_){var p=1-Math.pow(this.alpha_,this.totalWeight_);if(p)return this.estimate_/p}return this.estimate_},G}(),pi=function(){function G(p,n,k){this.fast_=this.slow_=void 0;this.defaultEstimate_=k;this.minWeight_=.001;this.minDelayMs_=50;this.slow_=new Ne(p);this.fast_=new Ne(n)}var z=G.prototype;return z.update=function(p,n){var k=this.slow_,q=this.fast_;this.slow_.halfLife!==p&&(this.slow_=new Ne(p,k.getEstimate(),k.getTotalWeight()));
this.fast_.halfLife!==n&&(this.fast_=new Ne(n,q.getEstimate(),q.getTotalWeight()))},z.sample=function(p,n){p=Math.max(p,this.minDelayMs_)/1E3;n=8*n/p;this.fast_.sample(p,n);this.slow_.sample(p,n)},z.canEstimate=function(){var p=this.fast_;return p&&p.getTotalWeight()>=this.minWeight_},z.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},z.destroy=function(){},G}(),qi=function(){function G(n){this.hls=void 0;this.lastLoadedFragLevel=
0;this._nextAutoLevel=-1;this.timer=void 0;this.onCheck=this._abandonRulesCheck.bind(this);this.partCurrent=this.fragCurrent=null;this.bitrateTestDelay=0;this.bwEstimator=void 0;this.hls=n;n=n.config;this.bwEstimator=new pi(n.abrEwmaSlowVoD,n.abrEwmaFastVoD,n.abrEwmaDefaultEstimate);this.registerListeners()}var z,p=G.prototype;return p.registerListeners=function(){var n=this.hls;n.on(Y.a.FRAG_LOADING,this.onFragLoading,this);n.on(Y.a.FRAG_LOADED,this.onFragLoaded,this);n.on(Y.a.FRAG_BUFFERED,this.onFragBuffered,
this);n.on(Y.a.LEVEL_LOADED,this.onLevelLoaded,this);n.on(Y.a.ERROR,this.onError,this)},p.unregisterListeners=function(){var n=this.hls;n.off(Y.a.FRAG_LOADING,this.onFragLoading,this);n.off(Y.a.FRAG_LOADED,this.onFragLoaded,this);n.off(Y.a.FRAG_BUFFERED,this.onFragBuffered,this);n.off(Y.a.LEVEL_LOADED,this.onLevelLoaded,this);n.off(Y.a.ERROR,this.onError,this)},p.destroy=function(){this.unregisterListeners();this.clearTimer();this.fragCurrent=this.partCurrent=this.hls=this.onCheck=null},p.onFragLoading=
function(n,k){var q;n=k.frag;n.type===Hb.b.MAIN&&(this.timer||(this.fragCurrent=n,this.partCurrent=null!=(q=k.part)?q:null,this.timer=self.setInterval(this.onCheck,100)))},p.onLevelLoaded=function(n,k){n=this.hls.config;k.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD)},p._abandonRulesCheck=function(){var n=this.fragCurrent,k=this.partCurrent,q=this.hls,u=q.autoLevelEnabled,B=q.config,F=q.media;if(n&&F){var K=k?k.stats:
n.stats,Z=k?k.duration:n.duration;if(K.aborted)return Ua.b.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);if(u&&!F.paused&&F.playbackRate&&F.readyState){u=performance.now()-K.loading.start;var ja=Math.abs(F.playbackRate);if(!(u<=500*Z/ja)){var ya=q.levels,Xa=q.minAutoLevel,La=ya[n.level],Wa=Math.max(1,K.bwEstimate?K.bwEstimate/8:1E3*K.loaded/u);La=((K.total||Math.max(K.loaded,Math.round(Z*La.maxBitrate/8)))-K.loaded)/Wa;var db=F.currentTime;
B=(xc.bufferInfo(F,db,B.maxBufferHole).end-db)/ja;if(!(B>=2*Z/ja||La<=B)){ja=Number.POSITIVE_INFINITY;for(F=n.level-1;F>Xa&&!((ja=Z*ya[F].maxBitrate/(6.4*Wa))<B);F--);ja>=La||(Z=this.bwEstimator.getEstimate(),Ua.b.warn("Fragment "+n.sn+(k?" part "+k.index:"")+" of level "+n.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+F+"\n      Current BW estimate: "+(Object(Zb.a)(Z)?(Z/1024).toFixed(3):"Unknown")+" Kb/s\n      Estimated load time for current fragment: "+
La.toFixed(3)+" s\n      Estimated load time for the next fragment: "+ja.toFixed(3)+" s\n      Time to underbuffer: "+B.toFixed(3)+" s"),q.nextLoadLevel=F,this.bwEstimator.sample(u,K.loaded),this.clearTimer(),n.loader&&(this.fragCurrent=this.partCurrent=null,n.loader.abort()),q.trigger(Y.a.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,part:k,stats:K}))}}}}},p.onFragLoaded=function(n,k){n=k.frag;k=k.part;if(n.type===Hb.b.MAIN&&Object(Zb.a)(n.sn)){var q=k?k.stats:n.stats,u=k?k.duration:n.duration;if(this.clearTimer(),
this.lastLoadedFragLevel=n.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var B=this.hls.levels[n.level],F=(B.loaded?B.loaded.bytes:0)+q.loaded;u=(B.loaded?B.loaded.duration:0)+u;B.loaded={bytes:F,duration:u};B.realBitrate=Math.round(8*F/u)}n.bitrateTest&&(this.onFragBuffered(Y.a.FRAG_BUFFERED,{stats:q,frag:n,part:k,id:n.type}),n.bitrateTest=!1)}},p.onFragBuffered=function(n,k){n=k.frag;k=(k=k.part)?k.stats:n.stats;if(!k.aborted&&n.type===Hb.b.MAIN&&"initSegment"!==n.sn){var q=
k.parsing.end-k.loading.start;this.bwEstimator.sample(q,k.loaded);k.bwEstimate=this.bwEstimator.getEstimate();n.bitrateTest?this.bitrateTestDelay=q/1E3:this.bitrateTestDelay=0}},p.onError=function(n,k){switch(k.details){case hb.a.FRAG_LOAD_ERROR:case hb.a.FRAG_LOAD_TIMEOUT:this.clearTimer()}},p.clearTimer=function(){self.clearInterval(this.timer);this.timer=void 0},p.getNextABRAutoLevel=function(){var n=this.fragCurrent,k=this.partCurrent,q=this.hls,u=q.maxAutoLevel,B=q.config,F=q.minAutoLevel;q=
q.media;n=k?k.duration:n?n.duration:0;var K=q?q.currentTime:0,Z=q&&0!==q.playbackRate?Math.abs(q.playbackRate):1;k=this.bwEstimator?this.bwEstimator.getEstimate():B.abrEwmaDefaultEstimate;q=(xc.bufferInfo(q,K,B.maxBufferHole).end-K)/Z;K=this.findBestLevel(k,F,u,q,B.abrBandWidthFactor,B.abrBandWidthUpFactor);if(0<=K)return K;Ua.b.trace((q?"rebuffering expected":"buffer is empty")+", finding optimal quality level");Z=n?Math.min(n,B.maxStarvationDelay):B.maxStarvationDelay;var ja=B.abrBandWidthFactor,
ya=B.abrBandWidthUpFactor;if(!q){var Xa=this.bitrateTestDelay;Xa&&(Z=(n?Math.min(n,B.maxLoadingDelay):B.maxLoadingDelay)-Xa,Ua.b.trace("bitrate test took "+Math.round(1E3*Xa)+"ms, set first fragment max fetchDuration to "+Math.round(1E3*Z)+" ms"),ja=ya=1)}return K=this.findBestLevel(k,F,u,q+Z,ja,ya),Math.max(K,0)},p.findBestLevel=function(n,k,q,u,B,F){var K,Z=this.fragCurrent,ja=this.partCurrent,ya=this.lastLoadedFragLevel,Xa=this.hls.levels,La=Xa[ya],Wa=!(null==La||null===(K=La.details)||void 0===
K||!K.live);K=null==La?void 0:La.codecSet;for(Z=ja?ja.duration:Z?Z.duration:0;q>=k;q--)if((La=Xa[q])&&(!K||La.codecSet===K)){La=La.details;La=(ja?null==La?void 0:La.partTarget:null==La?void 0:La.averagetargetduration)||Z;var db=q<=ya?B*n:F*n;var bb=Xa[q].maxBitrate,sb=bb*La/db;if(Ua.b.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+q+"/"+Math.round(db)+"/"+bb+"/"+La+"/"+u+"/"+sb),db>bb&&(!sb||Wa&&!this.bitrateTestDelay||sb<u))return q}return-1},z=[{key:"nextAutoLevel",
get:function(){var n=this._nextAutoLevel,k=this.bwEstimator;if(!(-1===n||k&&k.canEstimate()))return n;k=this.getNextABRAutoLevel();return-1!==n&&(k=Math.min(n,k)),k},set:function(n){this._nextAutoLevel=n}}],mc(G.prototype,z),G}(),Zf=h(13),rf=function(G){function z(n,k){var q;return(q=G.call(this,n,k,"[audio-stream-controller]")||this).videoBuffer=null,q.videoTrackCC=-1,q.waitingVideoCC=-1,q.audioSwitch=!1,q.trackId=-1,q.waitingData=null,q.mainDetails=null,q.bufferFlushed=!1,q._registerListeners(),
q}z.prototype=Object.create(G.prototype);z.prototype.constructor=z;Sc(z,G);var p=z.prototype;return p.onHandlerDestroying=function(){this._unregisterListeners();this.mainDetails=null},p._registerListeners=function(){var n=this.hls;n.on(Y.a.MEDIA_ATTACHED,this.onMediaAttached,this);n.on(Y.a.MEDIA_DETACHING,this.onMediaDetaching,this);n.on(Y.a.MANIFEST_LOADING,this.onManifestLoading,this);n.on(Y.a.LEVEL_LOADED,this.onLevelLoaded,this);n.on(Y.a.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this);n.on(Y.a.AUDIO_TRACK_SWITCHING,
this.onAudioTrackSwitching,this);n.on(Y.a.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this);n.on(Y.a.ERROR,this.onError,this);n.on(Y.a.BUFFER_RESET,this.onBufferReset,this);n.on(Y.a.BUFFER_CREATED,this.onBufferCreated,this);n.on(Y.a.BUFFER_FLUSHED,this.onBufferFlushed,this);n.on(Y.a.INIT_PTS_FOUND,this.onInitPtsFound,this);n.on(Y.a.FRAG_BUFFERED,this.onFragBuffered,this)},p._unregisterListeners=function(){var n=this.hls;n.off(Y.a.MEDIA_ATTACHED,this.onMediaAttached,this);n.off(Y.a.MEDIA_DETACHING,
this.onMediaDetaching,this);n.off(Y.a.MANIFEST_LOADING,this.onManifestLoading,this);n.off(Y.a.LEVEL_LOADED,this.onLevelLoaded,this);n.off(Y.a.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this);n.off(Y.a.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this);n.off(Y.a.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this);n.off(Y.a.ERROR,this.onError,this);n.off(Y.a.BUFFER_RESET,this.onBufferReset,this);n.off(Y.a.BUFFER_CREATED,this.onBufferCreated,this);n.off(Y.a.BUFFER_FLUSHED,this.onBufferFlushed,this);
n.off(Y.a.INIT_PTS_FOUND,this.onInitPtsFound,this);n.off(Y.a.FRAG_BUFFERED,this.onFragBuffered,this)},p.onInitPtsFound=function(n,k){n=k.frag;var q=k.initPTS;"main"===k.id&&(k=n.cc,this.initPTS[n.cc]=q,this.log("InitPTS for cc: "+k+" found from main: "+q),this.videoTrackCC=k,"WAITING_INIT_PTS"===this.state&&this.tick())},p.startLoad=function(n){if(!this.levels)return this.startPosition=n,void(this.state="STOPPED");var k=this.lastCurrentTime;this.stopLoad();this.setInterval(100);this.fragLoadError=
0;0<k&&-1===n?(this.log("Override startPosition with lastCurrentTime @"+k.toFixed(3)),this.state="IDLE"):(this.loadedmetadata=!1,this.state="WAITING_TRACK");this.nextLoadPosition=this.startPosition=this.lastCurrentTime=n;this.tick()},p.doTick=function(){switch(this.state){case "IDLE":this.doTickIdle();break;case "WAITING_TRACK":var n,k=this.levels,q=this.trackId;(k=null==k||null===(n=k[q])||void 0===n?void 0:n.details)&&!this.waitForCdnTuneIn(k)&&(this.state="WAITING_INIT_PTS");break;case "FRAG_LOADING_WAITING_RETRY":n=
performance.now();q=this.retryDate;(!q||n>=q||null!==(k=this.media)&&void 0!==k&&k.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state="IDLE");break;case "WAITING_INIT_PTS":var u=this.waitingData;u?(n=u.frag,k=u.part,q=u.cache,u=u.complete,void 0!==this.initPTS[n.cc]?(this.waitingData=null,this.waitingVideoCC=-1,this.state="FRAG_LOADING",n={frag:n,part:k,payload:q.flush(),networkDetails:null},this._handleFragmentLoadProgress(n),u&&G.prototype._handleFragmentLoadComplete.call(this,
n)):this.videoTrackCC!==this.waitingVideoCC?(Ua.b.log("Waiting fragment cc ("+n.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment()):(k=this.getLoadPosition(),k=xc.bufferInfo(this.mediaBuffer,k,this.config.maxBufferHole),0>Na(k.end,this.config.maxFragLookUpTolerance,n)&&(Ua.b.log("Waiting fragment cc ("+n.cc+") @ "+n.start+" cancelled because another fragment at "+k.end+" is needed"),this.clearWaitingFragment()))):this.state="IDLE"}this.onTickEnd()},p.clearWaitingFragment=
function(){var n=this.waitingData;n&&(this.fragmentTracker.removeFragment(n.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state="IDLE")},p.onTickEnd=function(){var n=this.media;if(n&&n.readyState){var k=(this.mediaBuffer?this.mediaBuffer:n).buffered;!this.loadedmetadata&&k.length&&(this.loadedmetadata=!0);this.lastCurrentTime=n.currentTime}},p.doTickIdle=function(){var n,k,q=this.hls,u=this.levels,B=this.media,F=this.trackId,K=q.config;if(u&&u[F]&&(B||!this.startFragRequested&&K.startFragPrefetch))if(u=
u[F].details,!u||u.live&&this.levelLastLoaded!==F||this.waitForCdnTuneIn(u))this.state="WAITING_TRACK";else if(this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,Gc.a.AUDIO,Hb.b.AUDIO)),F=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,Hb.b.AUDIO),null!==F){var Z=F.len,ja=this.getMaxBufferLength();K=this.audioSwitch;if(!(Z>=ja)||K){if(!K&&this._streamEnded(F,u))return q.trigger(Y.a.BUFFER_EOS,{type:"audio"}),void(this.state=
"ENDED");Z=u.fragments[0].start;q=F.end;K&&(q=K=this.getLoadPosition(),u.PTSKnown&&K<Z&&(F.end>Z||F.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),B.currentTime=Z+.05));(B=this.getNextFragment(q,u))?"identity"!==(null===(n=B.decryptdata)||void 0===n?void 0:n.keyFormat)||null!==(k=B.decryptdata)&&void 0!==k&&k.key?this.loadFragment(B,u,q):this.loadKey(B,u):this.bufferFlushed=!0}}},p.getMaxBufferLength=function(){var n=G.prototype.getMaxBufferLength.call(this),
k=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,Hb.b.MAIN);return null===k?n:Math.max(n,k.len)},p.onMediaDetaching=function(){this.videoBuffer=null;G.prototype.onMediaDetaching.call(this)},p.onAudioTracksUpdated=function(n,k){n=k.audioTracks;this.resetTransmuxer();this.levels=n.map(function(q){return new pf(q)})},p.onAudioTrackSwitching=function(n,k){n=!!k.url;this.trackId=k.id;k=this.fragCurrent;null!=k&&k.loader&&k.loader.abort();this.fragCurrent=null;this.clearWaitingFragment();
n?this.setInterval(100):this.resetTransmuxer();n?(this.audioSwitch=!0,this.state="IDLE"):this.state="STOPPED";this.tick()},p.onManifestLoading=function(){this.mainDetails=null;this.fragmentTracker.removeAllFragments();this.startPosition=this.lastCurrentTime=0;this.bufferFlushed=!1},p.onLevelLoaded=function(n,k){this.mainDetails=k.details},p.onAudioTrackLoaded=function(n,k){var q,u=this.levels;n=k.details;k=k.id;if(u){this.log("Track "+k+" loaded ["+n.startSN+","+n.endSN+"],duration:"+n.totalduration);
u=u[k];var B=0;if(n.live||null!==(q=u.details)&&void 0!==q&&q.live){q=this.mainDetails;if(n.fragments[0]||(n.deltaUpdateFailed=!0),n.deltaUpdateFailed||!q)return;!u.details&&n.hasProgramDateTime&&q.hasProgramDateTime?(na(n,q),B=n.fragments[0].start):B=this.alignPlaylists(n,u.details)}u.details=n;this.levelLastLoaded=k;this.startFragRequested||!this.mainDetails&&n.live||this.setStartPosition(u.details,B);"WAITING_TRACK"!==this.state||this.waitForCdnTuneIn(n)||(this.state="IDLE");this.tick()}else this.warn("Audio tracks were reset while loading level "+
k)},p._handleFragmentLoadProgress=function(n){var k,q=n.frag,u=n.part;n=n.payload;var B=this.config,F=this.trackId,K=this.levels;if(K){var Z=K[F];K=Z.details;B=B.defaultAudioCodec||Z.audioCodec||"mp4a.40.2";(Z=this.transmuxer)||(Z=this.transmuxer=new Sg(this.hls,Hb.b.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var ja=this.initPTS[q.cc],ya=null===(k=q.initSegment)||void 0===k?void 0:k.data;void 0!==ja?(k=u?u.index:-1,k=new Wf(q.level,q.sn,q.stats.chunkCount,
n.byteLength,k,-1!==k),Z.push(n,ya,B,"",q,u,K.totalduration,!1,k,ja)):(Ua.b.log("Unknown video PTS for cc "+q.cc+", waiting for video PTS before demuxing audio frag "+q.sn+" of ["+K.startSN+" ,"+K.endSN+"],track "+F),(this.waitingData=this.waitingData||{frag:q,part:u,cache:new Zf.a,complete:!1}).cache.push(new Uint8Array(n)),this.waitingVideoCC=this.videoTrackCC,this.state="WAITING_INIT_PTS")}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+q.sn+" of level "+
q.level+" will not be buffered")},p._handleFragmentLoadComplete=function(n){this.waitingData?this.waitingData.complete=!0:G.prototype._handleFragmentLoadComplete.call(this,n)},p.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null;this.loadedmetadata=!1},p.onBufferCreated=function(n,k){(n=k.tracks.audio)&&(this.mediaBuffer=n.buffer);k.tracks.video&&(this.videoBuffer=k.tracks.video.buffer)},p.onFragBuffered=function(n,k){n=k.frag;k=k.part;n.type===Hb.b.AUDIO&&(this.fragContextChanged(n)?
this.warn("Fragment "+n.sn+(k?" p: "+k.index:"")+" of level "+n.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):("initSegment"!==n.sn&&(this.fragPrevious=n,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(Y.a.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(n,k)))},p.onError=function(n,k){switch(k.details){case hb.a.FRAG_LOAD_ERROR:case hb.a.FRAG_LOAD_TIMEOUT:case hb.a.KEY_LOAD_ERROR:case hb.a.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Hb.b.AUDIO,
k);break;case hb.a.AUDIO_TRACK_LOAD_ERROR:case hb.a.AUDIO_TRACK_LOAD_TIMEOUT:"ERROR"!==this.state&&"STOPPED"!==this.state&&(this.state=k.fatal?"ERROR":"IDLE",this.warn(k.details+" while loading frag, switching to "+this.state+" state"));break;case hb.a.BUFFER_FULL_ERROR:"audio"!==k.parent||"PARSING"!==this.state&&"PARSED"!==this.state||(n=!0,(k=this.getFwdBufferInfo(this.mediaBuffer,Hb.b.AUDIO))&&.5<k.len&&(n=!this.reduceMaxBufferLength(k.len)),n&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),
this.fragCurrent=null,G.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState())}},p.onBufferFlushed=function(n,k){k.type===Gc.a.AUDIO&&(this.bufferFlushed=!0)},p._handleTransmuxComplete=function(n){var k,q=this.hls,u=n.remuxResult,B=n.chunkMeta,F=this.getCurrentContext(B);if(!F)return this.warn("The loading context changed while buffering fragment "+B.sn+" of level "+B.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(B.level);
n=F.frag;var K=F.part,Z=u.audio;F=u.text;var ja=u.id3;u=u.initSegment;if(!this.fragContextChanged(n)){if(this.state="PARSING",this.audioSwitch&&Z&&this.completeAudioSwitch(),null!=u&&u.tracks&&(this._bufferInitSegment(u.tracks,n,B),q.trigger(Y.a.FRAG_PARSING_INIT_SEGMENT,{frag:n,id:"audio",tracks:u.tracks})),Z){u=Z.startPTS;var ya=Z.endPTS,Xa=Z.startDTS,La=Z.endDTS;K&&(K.elementaryStreams[Gc.a.AUDIO]={startPTS:u,endPTS:ya,startDTS:Xa,endDTS:La});n.setElementaryStreamInfo(Gc.a.AUDIO,u,ya,Xa,La);this.bufferFragmentData(Z,
n,K,B)}null!=ja&&null!==(k=ja.samples)&&void 0!==k&&k.length&&(k=Ec({frag:n,id:"audio"},ja),q.trigger(Y.a.FRAG_PARSING_METADATA,k));F&&(k=Ec({frag:n,id:"audio"},F),q.trigger(Y.a.FRAG_PARSING_USERDATA,k))}},p._bufferInitSegment=function(n,k,q){if("PARSING"===this.state){n.video&&delete n.video;var u=n.audio;u&&(u.levelCodec=u.codec,u.id="audio",this.log("Init audio buffer, container:"+u.container+", codecs[parsed]=["+u.codec+"]"),this.hls.trigger(Y.a.BUFFER_CODECS,n),n=u.initSegment,null!=n&&n.byteLength&&
this.hls.trigger(Y.a.BUFFER_APPENDING,{type:"audio",frag:k,part:null,chunkMeta:q,parent:k.type,data:n}),this.tick())}},p.loadFragment=function(n,k,q){var u=this.fragmentTracker.getState(n);this.fragCurrent=n;(this.audioSwitch||u===zc.NOT_LOADED||u===zc.PARTIAL)&&("initSegment"===n.sn?this._loadInitSegment(n):k.live&&!Object(Zb.a)(this.initPTS[n.cc])?(this.log("Waiting for video PTS in continuity counter "+n.cc+" of live stream before loading audio fragment "+n.sn+" of level "+this.trackId),this.state=
"WAITING_INIT_PTS"):(this.startFragRequested=!0,G.prototype.loadFragment.call(this,n,k,q)))},p.completeAudioSwitch=function(){var n=this.hls,k=this.trackId;this.media&&(this.log("Switching audio track : flushing all audio"),G.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio"));this.audioSwitch=!1;n.trigger(Y.a.AUDIO_TRACK_SWITCHED,{id:k})},z}(Xf),Dd=function(G){function z(k){var q;return(q=G.call(this,k,"[audio-track-controller]")||this).tracks=[],q.groupId=null,q.tracksInGroup=
[],q.trackId=-1,q.trackName="",q.selectDefaultTrack=!0,q.registerListeners(),q}z.prototype=Object.create(G.prototype);z.prototype.constructor=z;lf(z,G);var p,n=z.prototype;return n.registerListeners=function(){var k=this.hls;k.on(Y.a.MANIFEST_LOADING,this.onManifestLoading,this);k.on(Y.a.MANIFEST_PARSED,this.onManifestParsed,this);k.on(Y.a.LEVEL_LOADING,this.onLevelLoading,this);k.on(Y.a.LEVEL_SWITCHING,this.onLevelSwitching,this);k.on(Y.a.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this);k.on(Y.a.ERROR,
this.onError,this)},n.unregisterListeners=function(){var k=this.hls;k.off(Y.a.MANIFEST_LOADING,this.onManifestLoading,this);k.off(Y.a.MANIFEST_PARSED,this.onManifestParsed,this);k.off(Y.a.LEVEL_LOADING,this.onLevelLoading,this);k.off(Y.a.LEVEL_SWITCHING,this.onLevelSwitching,this);k.off(Y.a.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this);k.off(Y.a.ERROR,this.onError,this)},n.destroy=function(){this.unregisterListeners();this.tracks.length=0;this.tracksInGroup.length=0;G.prototype.destroy.call(this)},
n.onManifestLoading=function(){this.tracks=[];this.groupId=null;this.tracksInGroup=[];this.trackId=-1;this.trackName="";this.selectDefaultTrack=!0},n.onManifestParsed=function(k,q){this.tracks=q.audioTracks||[]},n.onAudioTrackLoaded=function(k,q){k=q.id;var u=q.details,B=this.tracksInGroup[k];if(B){var F=B.details;B.details=q.details;this.log("audioTrack "+k+" loaded ["+u.startSN+"-"+u.endSN+"]");k===this.trackId&&(this.retryCount=0,this.playlistLoaded(k,q,F))}else this.warn("Invalid audio track id "+
k)},n.onLevelLoading=function(k,q){this.switchLevel(q.level)},n.onLevelSwitching=function(k,q){this.switchLevel(q.level)},n.switchLevel=function(k){k=this.hls.levels[k];if(null!=k&&k.audioGroupIds){var q=k.audioGroupIds[k.urlId];if(this.groupId!==q){this.groupId=q;k=this.tracks.filter(function(B){return!q||B.groupId===q});this.selectDefaultTrack&&!k.some(function(B){return B.default})&&(this.selectDefaultTrack=!1);this.tracksInGroup=k;var u={audioTracks:k};this.log("Updating audio tracks, "+k.length+
' track(s) found in "'+q+'" group-id');this.hls.trigger(Y.a.AUDIO_TRACKS_UPDATED,u);this.selectInitialTrack()}}},n.onError=function(k,q){G.prototype.onError.call(this,k,q);!q.fatal&&q.context&&q.context.type===Hb.a.AUDIO_TRACK&&q.context.id===this.trackId&&q.context.groupId===this.groupId&&this.retryLoadingOrFail(q)},n.setAudioTrack=function(k){var q=this.tracksInGroup;if(0>k||k>=q.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var u=q[this.trackId];this.log("Now switching to audio-track index "+
k);q=q[k];var B=q.id,F=q.groupId,K=q.name,Z=q.type,ja=q.url;if(this.trackId=k,this.trackName=K,this.selectDefaultTrack=!1,this.hls.trigger(Y.a.AUDIO_TRACK_SWITCHING,{id:B,groupId:void 0===F?"":F,name:K,type:Z,url:ja}),!q.details||q.details.live)k=this.switchParams(q.url,null==u?void 0:u.details),this.loadPlaylist(k)}},n.selectInitialTrack=function(){this.tracksInGroup;var k=this.findTrackId(this.trackName)||this.findTrackId();-1!==k?this.setAudioTrack(k):(this.warn("No track found for running audio group-ID: "+
this.groupId),this.hls.trigger(Y.a.ERROR,{type:hb.b.MEDIA_ERROR,details:hb.a.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},n.findTrackId=function(k){for(var q=this.tracksInGroup,u=0;u<q.length;u++){var B=q[u];if(!(this.selectDefaultTrack&&!B.default||k&&k!==B.name))return B.id}return-1},n.loadPlaylist=function(k){var q=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(q)){var u=q.id,B=q.groupId;q=q.url;if(k)try{q=k.addDirectives(q)}catch(F){this.warn("Could not construct new URL with HLS Delivery Directives: "+
F)}this.log("loading audio-track playlist for id: "+u);this.clearTimer();this.hls.trigger(Y.a.AUDIO_TRACK_LOADING,{url:q,id:u,groupId:B,deliveryDirectives:k||null})}},p=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(k){this.selectDefaultTrack=!1;this.setAudioTrack(k)}}],Je(z.prototype,p),z}(Me),Oe=function(G){function z(k,q){var u;return(u=G.call(this,k,q,"[subtitle-stream-controller]")||this).levels=[],u.currentTrackId=
-1,u.tracksBuffered=[],u.mainDetails=null,u._registerListeners(),u}z.prototype=Object.create(G.prototype);z.prototype.constructor=z;va(z,G);var p,n=z.prototype;return n.onHandlerDestroying=function(){this._unregisterListeners();this.mainDetails=null},n._registerListeners=function(){var k=this.hls;k.on(Y.a.MEDIA_ATTACHED,this.onMediaAttached,this);k.on(Y.a.MEDIA_DETACHING,this.onMediaDetaching,this);k.on(Y.a.MANIFEST_LOADING,this.onManifestLoading,this);k.on(Y.a.LEVEL_LOADED,this.onLevelLoaded,this);
k.on(Y.a.ERROR,this.onError,this);k.on(Y.a.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this);k.on(Y.a.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this);k.on(Y.a.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this);k.on(Y.a.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this);k.on(Y.a.BUFFER_FLUSHING,this.onBufferFlushing,this)},n._unregisterListeners=function(){var k=this.hls;k.off(Y.a.MEDIA_ATTACHED,this.onMediaAttached,this);k.off(Y.a.MEDIA_DETACHING,this.onMediaDetaching,
this);k.off(Y.a.MANIFEST_LOADING,this.onManifestLoading,this);k.off(Y.a.LEVEL_LOADED,this.onLevelLoaded,this);k.off(Y.a.ERROR,this.onError,this);k.off(Y.a.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this);k.off(Y.a.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this);k.off(Y.a.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this);k.off(Y.a.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this);k.off(Y.a.BUFFER_FLUSHING,this.onBufferFlushing,this)},n.startLoad=function(){this.stopLoad();
this.state="IDLE";this.setInterval(500);this.tick()},n.onManifestLoading=function(){this.mainDetails=null;this.fragmentTracker.removeAllFragments()},n.onLevelLoaded=function(k,q){this.mainDetails=q.details},n.onSubtitleFragProcessed=function(k,q){k=q.frag;q=q.success;if(this.fragPrevious=k,this.state="IDLE",q)if(q=this.tracksBuffered[this.currentTrackId]){for(var u,B=k.start,F=0;F<q.length;F++)if(B>=q[F].start&&B<=q[F].end){u=q[F];break}F=k.start+k.duration;u?u.end=F:(u={start:B,end:F},q.push(u));
this.fragmentTracker.fragBuffered(k)}},n.onBufferFlushing=function(k,q){k=q.startOffset;var u=q.endOffset;if(0===k&&u!==Number.POSITIVE_INFINITY){var B=this.currentTrackId,F=this.levels;if(F.length&&F[B]&&F[B].details){var K=u-F[B].details.targetduration;0>=K||(q.endOffsetSubtitles=Math.max(0,K),this.tracksBuffered.forEach(function(Z){for(var ja=0;ja<Z.length;)if(Z[ja].end<=K)Z.shift();else{if(!(Z[ja].start<K))break;Z[ja].start=K;ja++}}),this.fragmentTracker.removeFragmentsInRange(k,K,Hb.b.SUBTITLE))}}},
n.onError=function(k,q){var u;(k=q.frag)&&k.type===Hb.b.SUBTITLE&&(null!==(u=this.fragCurrent)&&void 0!==u&&u.loader&&this.fragCurrent.loader.abort(),this.state="IDLE")},n.onSubtitleTracksUpdated=function(k,q){var u=this;k=q.subtitleTracks;this.tracksBuffered=[];this.levels=k.map(function(B){return new pf(B)});this.fragmentTracker.removeAllFragments();this.fragPrevious=null;this.levels.forEach(function(B){u.tracksBuffered[B.id]=[]});this.mediaBuffer=null},n.onSubtitleTrackSwitch=function(k,q){(this.currentTrackId=
q.id,this.levels.length&&-1!==this.currentTrackId)?(k=this.levels[this.currentTrackId],null!=k&&k.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,k&&this.setInterval(500)):this.clearInterval()},n.onSubtitleTrackLoaded=function(k,q){var u;k=q.details;q=q.id;var B=this.currentTrackId,F=this.levels;if(F.length){var K=F[B];if(!(q>=F.length||q!==B)&&K){if(this.mediaBuffer=this.mediaBufferTimeRanges,k.live||null!==(u=K.details)&&void 0!==u&&u.live){u=this.mainDetails;if(k.deltaUpdateFailed||
!u)return;B=u.fragments[0];K.details?0===this.alignPlaylists(k,K.details)&&B&&M(k,B.start):k.hasProgramDateTime&&u.hasProgramDateTime?na(k,u):B&&M(k,B.start)}if(K.details=k,this.levelLastLoaded=q,this.tick(),k.live&&!this.fragCurrent&&this.media&&"IDLE"===this.state)Ia(null,k.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),K.details=void 0)}}},n._handleFragmentLoadComplete=function(k){var q=k.frag;k=k.payload;var u=q.decryptdata,B=this.hls;if(!this.fragContextChanged(q)&&
k&&0<k.byteLength&&u&&u.key&&u.iv&&"AES-128"===u.method){var F=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(k),u.key.buffer,u.iv.buffer).then(function(K){var Z=performance.now();B.trigger(Y.a.FRAG_DECRYPTED,{frag:q,payload:K,stats:{tstart:F,tdecrypt:Z}})})}},n.doTick=function(){if(this.media){if("IDLE"===this.state){var k,q=this.currentTrackId,u=this.levels;if(u.length&&u[q]&&u[q].details){q=u[q].details;var B=q.targetduration;u=this.config;var F=xc.bufferedInfo(this.mediaBufferTimeRanges,
this.media.currentTime-B,u.maxBufferHole),K=F.end;if(!(F.len>this.getMaxBufferLength()+B)){var Z;B=q.fragments;F=B.length;var ja=this.fragPrevious;K<q.edge?!(Z=Ia(ja,B,K,u.maxFragLookUpTolerance))&&ja&&ja.start<B[0].start&&(Z=B[0]):Z=B[F-1];null!==(k=Z)&&void 0!==k&&k.encrypted?(Ua.b.log("Loading key for "+Z.sn),this.state="KEY_LOADING",this.hls.trigger(Y.a.KEY_LOADING,{frag:Z})):Z&&this.fragmentTracker.getState(Z)===zc.NOT_LOADED&&this.loadFragment(Z,q,K)}}}}else this.state="IDLE"},n.loadFragment=
function(k,q,u){this.fragCurrent=k;G.prototype.loadFragment.call(this,k,q,u)},p=[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}],Ma(z.prototype,p),z}(Xf),ac,ri=function(G){function z(k){var q;return(q=G.call(this,k,"[subtitle-track-controller]")||this).media=null,q.tracks=[],q.groupId=null,q.tracksInGroup=[],q.trackId=-1,q.selectDefaultTrack=!0,q.queuedDefaultTrack=-1,q.trackChangeListener=function(){return q.onTextTracksChanged()},q.asyncPollTrackChange=
function(){return q.pollTrackChange(0)},q.useTextTrackPolling=!1,q.subtitlePollingInterval=-1,q.subtitleDisplay=!0,q.registerListeners(),q}z.prototype=Object.create(G.prototype);z.prototype.constructor=z;aa(z,G);var p,n=z.prototype;return n.destroy=function(){this.unregisterListeners();this.tracks.length=0;this.tracksInGroup.length=0;this.trackChangeListener=this.asyncPollTrackChange=null;G.prototype.destroy.call(this)},n.registerListeners=function(){var k=this.hls;k.on(Y.a.MEDIA_ATTACHED,this.onMediaAttached,
this);k.on(Y.a.MEDIA_DETACHING,this.onMediaDetaching,this);k.on(Y.a.MANIFEST_LOADING,this.onManifestLoading,this);k.on(Y.a.MANIFEST_PARSED,this.onManifestParsed,this);k.on(Y.a.LEVEL_LOADING,this.onLevelLoading,this);k.on(Y.a.LEVEL_SWITCHING,this.onLevelSwitching,this);k.on(Y.a.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this);k.on(Y.a.ERROR,this.onError,this)},n.unregisterListeners=function(){var k=this.hls;k.off(Y.a.MEDIA_ATTACHED,this.onMediaAttached,this);k.off(Y.a.MEDIA_DETACHING,this.onMediaDetaching,
this);k.off(Y.a.MANIFEST_LOADING,this.onManifestLoading,this);k.off(Y.a.MANIFEST_PARSED,this.onManifestParsed,this);k.off(Y.a.LEVEL_LOADING,this.onLevelLoading,this);k.off(Y.a.LEVEL_SWITCHING,this.onLevelSwitching,this);k.off(Y.a.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this);k.off(Y.a.ERROR,this.onError,this)},n.onMediaAttached=function(k,q){(this.media=q.media)&&(-1<this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=
!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},n.pollTrackChange=function(k){self.clearInterval(this.subtitlePollingInterval);this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,k)},n.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",
this.asyncPollTrackChange),-1<this.trackId&&(this.queuedDefaultTrack=this.trackId),ma(this.media.textTracks).forEach(function(k){O(k)}),this.subtitleTrack=-1,this.media=null)},n.onManifestLoading=function(){this.tracks=[];this.groupId=null;this.tracksInGroup=[];this.trackId=-1;this.selectDefaultTrack=!0},n.onManifestParsed=function(k,q){this.tracks=q.subtitleTracks},n.onSubtitleTrackLoaded=function(k,q){k=q.id;var u=q.details,B=this.tracksInGroup[this.trackId];if(B){var F=B.details;B.details=q.details;
this.log("subtitle track "+k+" loaded ["+u.startSN+"-"+u.endSN+"]");k===this.trackId&&(this.retryCount=0,this.playlistLoaded(k,q,F))}else this.warn("Invalid subtitle track id "+k)},n.onLevelLoading=function(k,q){this.switchLevel(q.level)},n.onLevelSwitching=function(k,q){this.switchLevel(q.level)},n.switchLevel=function(k){k=this.hls.levels[k];if(null!=k&&k.textGroupIds){var q=k.textGroupIds[k.urlId];if(this.groupId!==q){k=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;var u=this.tracks.filter(function(K){return!q||
K.groupId===q});this.tracksInGroup=u;var B=this.findTrackId(null==k?void 0:k.name)||this.findTrackId();this.groupId=q;var F={subtitleTracks:u};this.log("Updating subtitle tracks, "+u.length+' track(s) found in "'+q+'" group-id');this.hls.trigger(Y.a.SUBTITLE_TRACKS_UPDATED,F);-1!==B&&this.setSubtitleTrack(B,k)}}},n.findTrackId=function(k){for(var q=this.tracksInGroup,u=0;u<q.length;u++){var B=q[u];if(!(this.selectDefaultTrack&&!B.default||k&&k!==B.name))return B.id}return-1},n.onError=function(k,
q){G.prototype.onError.call(this,k,q);!q.fatal&&q.context&&q.context.type===Hb.a.SUBTITLE_TRACK&&q.context.id===this.trackId&&q.context.groupId===this.groupId&&this.retryLoadingOrFail(q)},n.loadPlaylist=function(k){var q=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(q)){var u=q.id,B=q.groupId;q=q.url;if(k)try{q=k.addDirectives(q)}catch(F){this.warn("Could not construct new URL with HLS Delivery Directives: "+F)}this.log("Loading subtitle playlist for id "+u);this.hls.trigger(Y.a.SUBTITLE_TRACK_LOADING,
{url:q,id:u,groupId:B,deliveryDirectives:k||null})}},n.toggleTrackModes=function(k){var q=this,u=this.media,B=this.subtitleDisplay,F=this.trackId;if(u){var K=ma(u.textTracks);u=K.filter(function(Z){return Z.groupId===q.groupId});-1===k?[].slice.call(K).forEach(function(Z){Z.mode="disabled"}):(F=u[F])&&(F.mode="disabled");(k=u[k])&&(k.mode=B?"showing":"hidden")}},n.setSubtitleTrack=function(k,q){var u,B=this.tracksInGroup;this.media?(this.trackId!==k&&this.toggleTrackModes(k),this.trackId===k&&(-1===
k||null!==(u=B[k])&&void 0!==u&&u.details)||-1>k||k>=B.length)||(this.clearTimer(),u=B[k],(this.log("Switching to subtitle track "+k),this.trackId=k,u)?(k=u.groupId,this.hls.trigger(Y.a.SUBTITLE_TRACK_SWITCH,{id:u.id,groupId:void 0===k?"":k,name:u.name,type:u.type,url:u.url}),q=this.switchParams(u.url,null==q?void 0:q.details),this.loadPlaylist(q)):this.hls.trigger(Y.a.SUBTITLE_TRACK_SWITCH,{id:k})):this.queuedDefaultTrack=k},n.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),
this.media&&this.hls.config.renderTextTracksNatively){for(var k=-1,q=ma(this.media.textTracks),u=0;u<q.length;u++)if("hidden"===q[u].mode)k=u;else if("showing"===q[u].mode){k=u;break}this.subtitleTrack!==k&&(this.subtitleTrack=k)}},p=[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(k){this.selectDefaultTrack=!1;this.setSubtitleTrack(k,this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0)}}],X(z.prototype,
p),z}(Me),si=function(){function G(p){this.queues={video:[],audio:[],audiovideo:[]};this.buffers=p}var z=G.prototype;return z.append=function(p,n){var k=this.queues[n];k.push(p);1===k.length&&this.buffers[n]&&this.executeNext(n)},z.insertAbort=function(p,n){this.queues[n].unshift(p);this.executeNext(n)},z.appendBlocker=function(p){var n,k=new Promise(function(q){n=q});return this.append({execute:n,onStart:function(){},onComplete:function(){},onError:function(){}},p),k},z.executeNext=function(p){var n=
this.buffers[p],k=this.queues[p];if(k.length){var q=k[0];try{q.execute()}catch(u){Ua.b.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),q.onError(u),n&&n.updating||(k.shift(),this.executeNext(p))}}},z.shiftAndExecuteNext=function(p){this.queues[p].shift();this.executeNext(p)},z.current=function(p){return this.queues[p][0]},G}(),qe=self.MediaSource||self.WebKitMediaSource,sf=/([ha]vc.)(?:\.[^.,]+)+/,Tc=function(){function G(p){var n=this;this._objectUrl=this.details=
null;this.hls=this.listeners=this.operationQueue=void 0;this._bufferCodecEventsTotal=this.bufferCodecEventsExpected=0;this.mediaSource=this.media=null;this.appendError=0;this.tracks={};this.pendingTracks={};this.sourceBuffer=void 0;this._onMediaSourceOpen=function(){var k=n.hls,q=n.media,u=n.mediaSource;Ua.b.log("[buffer-controller]: Media source opened");q&&(n.updateMediaElementDuration(),k.trigger(Y.a.MEDIA_ATTACHED,{media:q}));u&&u.removeEventListener("sourceopen",n._onMediaSourceOpen);n.checkPendingTracks()};
this._onMediaSourceClose=function(){Ua.b.log("[buffer-controller]: Media source closed")};this._onMediaSourceEnded=function(){Ua.b.log("[buffer-controller]: Media source ended")};this.hls=p;this._initSourceBuffer();this.registerListeners()}var z=G.prototype;return z.hasSourceTypes=function(){return 0<this.getSourceBufferTypes().length||0<Object.keys(this.pendingTracks).length},z.destroy=function(){this.unregisterListeners();this.details=null},z.registerListeners=function(){var p=this.hls;p.on(Y.a.MEDIA_ATTACHING,
this.onMediaAttaching,this);p.on(Y.a.MEDIA_DETACHING,this.onMediaDetaching,this);p.on(Y.a.MANIFEST_PARSED,this.onManifestParsed,this);p.on(Y.a.BUFFER_RESET,this.onBufferReset,this);p.on(Y.a.BUFFER_APPENDING,this.onBufferAppending,this);p.on(Y.a.BUFFER_CODECS,this.onBufferCodecs,this);p.on(Y.a.BUFFER_EOS,this.onBufferEos,this);p.on(Y.a.BUFFER_FLUSHING,this.onBufferFlushing,this);p.on(Y.a.LEVEL_UPDATED,this.onLevelUpdated,this);p.on(Y.a.FRAG_PARSED,this.onFragParsed,this);p.on(Y.a.FRAG_CHANGED,this.onFragChanged,
this)},z.unregisterListeners=function(){var p=this.hls;p.off(Y.a.MEDIA_ATTACHING,this.onMediaAttaching,this);p.off(Y.a.MEDIA_DETACHING,this.onMediaDetaching,this);p.off(Y.a.MANIFEST_PARSED,this.onManifestParsed,this);p.off(Y.a.BUFFER_RESET,this.onBufferReset,this);p.off(Y.a.BUFFER_APPENDING,this.onBufferAppending,this);p.off(Y.a.BUFFER_CODECS,this.onBufferCodecs,this);p.off(Y.a.BUFFER_EOS,this.onBufferEos,this);p.off(Y.a.BUFFER_FLUSHING,this.onBufferFlushing,this);p.off(Y.a.LEVEL_UPDATED,this.onLevelUpdated,
this);p.off(Y.a.FRAG_PARSED,this.onFragParsed,this);p.off(Y.a.FRAG_CHANGED,this.onFragChanged,this)},z._initSourceBuffer=function(){this.sourceBuffer={};this.operationQueue=new si(this.sourceBuffer);this.listeners={audio:[],video:[],audiovideo:[]}},z.onManifestParsed=function(p,n){p=2;(n.audio&&!n.video||!n.altAudio)&&(p=1);this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=p;this.details=null;Ua.b.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},z.onMediaAttaching=function(p,
n){(p=this.media=n.media)&&qe&&(n=this.mediaSource=new qe,n.addEventListener("sourceopen",this._onMediaSourceOpen),n.addEventListener("sourceended",this._onMediaSourceEnded),n.addEventListener("sourceclose",this._onMediaSourceClose),p.src=self.URL.createObjectURL(n),this._objectUrl=p.src)},z.onMediaDetaching=function(){var p=this.media,n=this.mediaSource,k=this._objectUrl;if(n){if(Ua.b.log("[buffer-controller]: media source detaching"),"open"===n.readyState)try{n.endOfStream()}catch(q){Ua.b.warn("[buffer-controller]: onMediaDetaching: "+
q.message+" while calling endOfStream")}this.onBufferReset();n.removeEventListener("sourceopen",this._onMediaSourceOpen);n.removeEventListener("sourceended",this._onMediaSourceEnded);n.removeEventListener("sourceclose",this._onMediaSourceClose);p&&(k&&self.URL.revokeObjectURL(k),p.src===k?(p.removeAttribute("src"),p.load()):Ua.b.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup"));this._objectUrl=this.media=this.mediaSource=null;this.bufferCodecEventsExpected=this._bufferCodecEventsTotal;
this.pendingTracks={};this.tracks={}}this.hls.trigger(Y.a.MEDIA_DETACHED,void 0)},z.onBufferReset=function(){var p=this;this.getSourceBufferTypes().forEach(function(n){var k=p.sourceBuffer[n];try{k&&(p.removeBufferListeners(n),p.mediaSource&&p.mediaSource.removeSourceBuffer(k),p.sourceBuffer[n]=void 0)}catch(q){Ua.b.warn("[buffer-controller]: Failed to reset the "+n+" buffer",q)}});this._initSourceBuffer()},z.onBufferCodecs=function(p,n){var k=this,q=this.getSourceBufferTypes().length;Object.keys(n).forEach(function(u){if(q){var B=
k.tracks[u];if(B&&"function"==typeof B.buffer.changeType){var F=n[u],K=F.codec,Z=F.levelCodec;F=F.container;(B.levelCodec||B.codec).replace(sf,"$1")!==(Z||K).replace(sf,"$1")&&k.appendChangeType(u,F+";codecs="+(Z||K))}}else k.pendingTracks[u]=n[u]});q||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},z.appendChangeType=function(p,n){var k=this,q=this.operationQueue;q.append({execute:function(){var u=
k.sourceBuffer[p];u&&(Ua.b.log("[buffer-controller]: changing "+p+" sourceBuffer type to "+n),u.changeType(n));q.shiftAndExecuteNext(p)},onStart:function(){},onComplete:function(){},onError:function(u){Ua.b.warn("[buffer-controller]: Failed to change "+p+" SourceBuffer type",u)}},p)},z.onBufferAppending=function(p,n){var k=this,q=this.hls;p=this.operationQueue;var u=this.tracks,B=n.data,F=n.type,K=n.frag,Z=n.part,ja=n.chunkMeta,ya=ja.buffering[F];n=self.performance.now();ya.start=n;var Xa=K.stats.buffering,
La=Z?Z.stats.buffering:null;0===Xa.start&&(Xa.start=n);La&&0===La.start&&(La.start=n);n=u.audio;var Wa="audio"===F&&1===ja.id&&"audio/mpeg"===(null==n?void 0:n.container);p.append({execute:function(){if(ya.executeStart=self.performance.now(),Wa){var db=k.sourceBuffer[F];if(db){var bb=K.start-db.timestampOffset;.1<=Math.abs(bb)&&(Ua.b.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+K.start+" (delta: "+bb+") sn: "+K.sn+")"),db.timestampOffset=K.start)}}k.appendExecutor(B,
F)},onStart:function(){},onComplete:function(){var db=self.performance.now();ya.executeEnd=ya.end=db;0===Xa.first&&(Xa.first=db);La&&0===La.first&&(La.first=db);db=k.sourceBuffer;var bb={},sb;for(sb in db)bb[sb]=xc.getBuffered(db[sb]);k.appendError=0;k.hls.trigger(Y.a.BUFFER_APPENDED,{type:F,frag:K,part:Z,chunkMeta:ja,parent:K.type,timeRanges:bb})},onError:function(db){Ua.b.error("[buffer-controller]: Error encountered while trying to append to the "+F+" SourceBuffer",db);var bb={type:hb.b.MEDIA_ERROR,
parent:K.type,details:hb.a.BUFFER_APPEND_ERROR,err:db,fatal:!1};db.code===DOMException.QUOTA_EXCEEDED_ERR?bb.details=hb.a.BUFFER_FULL_ERROR:(k.appendError++,bb.details=hb.a.BUFFER_APPEND_ERROR,k.appendError>q.config.appendErrorMaxRetry&&(Ua.b.error("[buffer-controller]: Failed "+q.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),bb.fatal=!0));q.trigger(Y.a.ERROR,bb)}},F)},z.onBufferFlushing=function(p,n){var k=this,q=this.operationQueue,u=function(B){return{execute:k.removeExecutor.bind(k,
B,n.startOffset,n.endOffset),onStart:function(){},onComplete:function(){k.hls.trigger(Y.a.BUFFER_FLUSHED,{type:B})},onError:function(F){Ua.b.warn("[buffer-controller]: Failed to remove from "+B+" SourceBuffer",F)}}};n.type?q.append(u(n.type),n.type):this.getSourceBufferTypes().forEach(function(B){q.append(u(B),B)})},z.onFragParsed=function(p,n){var k=this,q=n.frag,u=n.part;p=[];n=u?u.elementaryStreams:q.elementaryStreams;n[Gc.a.AUDIOVIDEO]?p.push("audiovideo"):(n[Gc.a.AUDIO]&&p.push("audio"),n[Gc.a.VIDEO]&&
p.push("video"));0===p.length&&Ua.b.warn("Fragments must have at least one ElementaryStreamType set. type: "+q.type+" level: "+q.level+" sn: "+q.sn);this.blockBuffers(function(){var B=self.performance.now();q.stats.buffering.end=B;u&&(u.stats.buffering.end=B);k.hls.trigger(Y.a.FRAG_BUFFERED,{frag:q,part:u,stats:u?u.stats:q.stats,id:q.type})},p)},z.onFragChanged=function(p,n){this.flushBackBuffer()},z.onBufferEos=function(p,n){var k=this;this.getSourceBufferTypes().reduce(function(q,u){var B=k.sourceBuffer[u];
return n.type&&n.type!==u||B&&!B.ended&&(B.ended=!0,Ua.b.log("[buffer-controller]: "+u+" sourceBuffer now EOS")),q&&!(B&&!B.ended)},!0)&&this.blockBuffers(function(){var q=k.mediaSource;q&&"open"===q.readyState&&q.endOfStream()})},z.onLevelUpdated=function(p,n){p=n.details;p.fragments.length&&(this.details=p,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},z.flushBackBuffer=function(){var p=this.hls,n=this.details,
k=this.media,q=this.sourceBuffer;if(k&&null!==n){var u=this.getSourceBufferTypes();if(u.length){var B=n.live&&null!==p.config.liveBackBufferLength?p.config.liveBackBufferLength:p.config.backBufferLength;if(Object(Zb.a)(B)&&!(0>B)){var F=n.levelTargetDuration,K=Math.floor(k.currentTime/F)*F-Math.max(B,F);u.forEach(function(Z){var ja=q[Z];ja&&(ja=xc.getBuffered(ja),0<ja.length&&K>ja.start(0)&&(p.trigger(Y.a.BACK_BUFFER_REACHED,{bufferEnd:K}),n.live&&p.trigger(Y.a.LIVE_BACK_BUFFER_REACHED,{bufferEnd:K}),
p.trigger(Y.a.BUFFER_FLUSHING,{startOffset:0,endOffset:K,type:Z})))})}}}},z.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState){var p=this.details,n=this.hls,k=this.mediaSource,q=p.fragments[0].start+p.totalduration,u=this.media.duration,B=Object(Zb.a)(k.duration)?k.duration:0;p.live&&n.config.liveDurationInfinity?(Ua.b.log("[buffer-controller]: Media Source duration is set to Infinity"),k.duration=1/0,this.updateSeekableRange(p)):
(q>B&&q>u||!Object(Zb.a)(u))&&(Ua.b.log("[buffer-controller]: Updating Media Source duration to "+q.toFixed(3)),k.duration=q)}},z.updateSeekableRange=function(p){var n=this.mediaSource,k=p.fragments;k.length&&p.live&&null!=n&&n.setLiveSeekableRange&&(k=Math.max(0,k[0].start),n.setLiveSeekableRange(k,Math.max(k,k+p.totalduration)))},z.checkPendingTracks=function(){var p=this.bufferCodecEventsExpected,n=this.operationQueue,k=this.pendingTracks,q=Object.keys(k).length;if(q&&!p||2===q){this.createSourceBuffers(k);
this.pendingTracks={};p=this.getSourceBufferTypes();if(0===p.length)return void this.hls.trigger(Y.a.ERROR,{type:hb.b.MEDIA_ERROR,details:hb.a.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});p.forEach(function(u){n.executeNext(u)})}},z.createSourceBuffers=function(p){var n=this.sourceBuffer,k=this.mediaSource;if(!k)throw Error("createSourceBuffers called when mediaSource was null");var q=0,u;for(u in p)if(!n[u]){var B=p[u];if(!B)throw Error("source buffer exists for track "+
u+", however track does not");var F=B.levelCodec||B.codec,K=B.container+";codecs="+F;Ua.b.log("[buffer-controller]: creating sourceBuffer("+K+")");try{var Z=n[u]=k.addSourceBuffer(K),ja=u;this.addBufferListener(ja,"updatestart",this._onSBUpdateStart);this.addBufferListener(ja,"updateend",this._onSBUpdateEnd);this.addBufferListener(ja,"error",this._onSBUpdateError);this.tracks[u]={buffer:Z,codec:F,container:B.container,levelCodec:B.levelCodec,id:B.id};q++}catch(ya){Ua.b.error("[buffer-controller]: error while trying to add sourceBuffer: "+
ya.message),this.hls.trigger(Y.a.ERROR,{type:hb.b.MEDIA_ERROR,details:hb.a.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:ya,mimeType:K})}}q&&this.hls.trigger(Y.a.BUFFER_CREATED,{tracks:this.tracks})},z._onSBUpdateStart=function(p){this.operationQueue.current(p).onStart()},z._onSBUpdateEnd=function(p){var n=this.operationQueue;n.current(p).onComplete();n.shiftAndExecuteNext(p)},z._onSBUpdateError=function(p,n){Ua.b.error("[buffer-controller]: "+p+" SourceBuffer error",n);this.hls.trigger(Y.a.ERROR,{type:hb.b.MEDIA_ERROR,
details:hb.a.BUFFER_APPENDING_ERROR,fatal:!1});(p=this.operationQueue.current(p))&&p.onError(n)},z.removeExecutor=function(p,n,k){var q=this.media,u=this.mediaSource,B=this.operationQueue,F=this.sourceBuffer[p];if(!q||!u||!F)return Ua.b.warn("[buffer-controller]: Attempting to remove from the "+p+" SourceBuffer, but it does not exist"),void B.shiftAndExecuteNext(p);q=Object(Zb.a)(q.duration)?q.duration:1/0;u=Object(Zb.a)(u.duration)?u.duration:1/0;n=Math.max(0,n);k=Math.min(k,q,u);k>n?(Ua.b.log("[buffer-controller]: Removing ["+
n+","+k+"] from the "+p+" SourceBuffer"),F.remove(n,k)):B.shiftAndExecuteNext(p)},z.appendExecutor=function(p,n){var k=this.operationQueue,q=this.sourceBuffer[n];if(!q)return Ua.b.warn("[buffer-controller]: Attempting to append to the "+n+" SourceBuffer, but it does not exist"),void k.shiftAndExecuteNext(n);q.ended=!1;q.appendBuffer(p)},z.blockBuffers=function(p,n){var k=this;if(void 0===n&&(n=this.getSourceBufferTypes()),!n.length)return Ua.b.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),
void Promise.resolve(p);var q=this.operationQueue,u=n.map(function(B){return q.appendBlocker(B)});Promise.all(u).then(function(){p();n.forEach(function(B){var F=k.sourceBuffer[B];F&&F.updating||q.shiftAndExecuteNext(B)})})},z.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},z.addBufferListener=function(p,n,k){var q=this.sourceBuffer[p];q&&(k=k.bind(this,p),this.listeners[p].push({event:n,listener:k}),q.addEventListener(n,k))},z.removeBufferListeners=function(p){var n=this.sourceBuffer[p];
n&&this.listeners[p].forEach(function(k){n.removeEventListener(k.event,k.listener)})},G}(),od={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,
169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},pd=function(G){var z=G;return od.hasOwnProperty(G)&&(z=od[G]),String.fromCharCode(z)},Qe={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},uf={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Re={25:1,
26:3,29:5,30:7,31:9,24:11,27:12,28:14},Se={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Te="white green blue cyan red yellow magenta black transparent".split(" ");!function(G){G[G.ERROR=0]="ERROR";G[G.TEXT=1]="TEXT";G[G.WARNING=2]="WARNING";G[G.INFO=2]="INFO";G[G.DEBUG=3]="DEBUG";G[G.DATA=3]="DATA"}(ac||={});var Ue=function(){function G(){this.time=null;this.verboseLevel=ac.ERROR}return G.prototype.log=function(z,p){this.verboseLevel>=z&&Ua.b.log(this.time+" ["+z+"] "+p)},G}(),jd=function(G){for(var z=
[],p=0;p<G.length;p++)z.push(G[p].toString(16));return z},sc=function(){function G(p,n,k,q,u){this.flash=this.background=this.italics=this.underline=this.foreground=void 0;this.foreground=p||"white";this.underline=n||!1;this.italics=k||!1;this.background=q||"black";this.flash=u||!1}var z=G.prototype;return z.reset=function(){this.foreground="white";this.italics=this.underline=!1;this.background="black";this.flash=!1},z.setStyles=function(p){for(var n=["foreground","underline","italics","background",
"flash"],k=0;k<n.length;k++){var q=n[k];p.hasOwnProperty(q)&&(this[q]=p[q])}},z.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},z.equals=function(p){return this.foreground===p.foreground&&this.underline===p.underline&&this.italics===p.italics&&this.background===p.background&&this.flash===p.flash},z.copy=function(p){this.foreground=p.foreground;this.underline=p.underline;this.italics=p.italics;this.background=p.background;
this.flash=p.flash},z.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},G}(),bd=function(){function G(p,n,k,q,u,B){this.penState=this.uchar=void 0;this.uchar=p||" ";this.penState=new sc(n,k,q,u,B)}var z=G.prototype;return z.reset=function(){this.uchar=" ";this.penState.reset()},z.setChar=function(p,n){this.uchar=p;this.penState.copy(n)},z.setPenState=function(p){this.penState.copy(p)},z.equals=
function(p){return this.uchar===p.uchar&&this.penState.equals(p.penState)},z.copy=function(p){this.uchar=p.uchar;this.penState.copy(p.penState)},z.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},G}(),Mc=function(){function G(p){this.logger=this.cueStartTime=this.currPenState=this.pos=void 0;this.chars=[];for(var n=0;100>n;n++)this.chars.push(new bd);this.logger=p;this.pos=0;this.currPenState=new sc}var z=G.prototype;return z.equals=function(p){for(var n=!0,k=0;100>k;k++)if(!this.chars[k].equals(p.chars[k])){n=
!1;break}return n},z.copy=function(p){for(var n=0;100>n;n++)this.chars[n].copy(p.chars[n])},z.isEmpty=function(){for(var p=!0,n=0;100>n;n++)if(!this.chars[n].isEmpty()){p=!1;break}return p},z.setCursor=function(p){this.pos!==p&&(this.pos=p);0>this.pos?(this.logger.log(ac.DEBUG,"Negative cursor position "+this.pos),this.pos=0):100<this.pos&&(this.logger.log(ac.DEBUG,"Too large cursor position "+this.pos),this.pos=100)},z.moveCursor=function(p){var n=this.pos+p;if(1<p)for(p=this.pos+1;p<n+1;p++)this.chars[p].setPenState(this.currPenState);
this.setCursor(n)},z.backSpace=function(){this.moveCursor(-1);this.chars[this.pos].setChar(" ",this.currPenState)},z.insertChar=function(p){144<=p&&this.backSpace();var n=pd(p);100<=this.pos?this.logger.log(ac.ERROR,"Cannot insert "+p.toString(16)+" ("+n+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(n,this.currPenState),this.moveCursor(1))},z.clearFromPos=function(p){for(;100>p;p++)this.chars[p].reset()},z.clear=function(){this.clearFromPos(0);this.pos=0;this.currPenState.reset()},
z.clearToEndOfRow=function(){this.clearFromPos(this.pos)},z.getTextString=function(){for(var p=[],n=!0,k=0;100>k;k++){var q=this.chars[k].uchar;" "!==q&&(n=!1);p.push(q)}return n?"":p.join("")},z.setPenStyles=function(p){this.currPenState.setStyles(p);this.chars[this.pos].setPenState(this.currPenState)},G}(),te=function(){function G(p){this.logger=this.lastOutputScreen=this.nrRollUpRows=this.currRow=this.rows=void 0;this.rows=[];for(var n=0;15>n;n++)this.rows.push(new Mc(p));this.logger=p;this.currRow=
14;this.lastOutputScreen=this.nrRollUpRows=null;this.reset()}var z=G.prototype;return z.reset=function(){for(var p=0;15>p;p++)this.rows[p].clear();this.currRow=14},z.equals=function(p){for(var n=!0,k=0;15>k;k++)if(!this.rows[k].equals(p.rows[k])){n=!1;break}return n},z.copy=function(p){for(var n=0;15>n;n++)this.rows[n].copy(p.rows[n])},z.isEmpty=function(){for(var p=!0,n=0;15>n;n++)if(!this.rows[n].isEmpty()){p=!1;break}return p},z.backSpace=function(){this.rows[this.currRow].backSpace()},z.clearToEndOfRow=
function(){this.rows[this.currRow].clearToEndOfRow()},z.insertChar=function(p){this.rows[this.currRow].insertChar(p)},z.setPen=function(p){this.rows[this.currRow].setPenStyles(p)},z.moveCursor=function(p){this.rows[this.currRow].moveCursor(p)},z.setCursor=function(p){this.logger.log(ac.INFO,"setCursor: "+p);this.rows[this.currRow].setCursor(p)},z.setPAC=function(p){this.logger.log(ac.INFO,"pacData = "+JSON.stringify(p));var n=p.row-1;if(this.nrRollUpRows&&n<this.nrRollUpRows-1&&(n=this.nrRollUpRows-
1),this.nrRollUpRows&&this.currRow!==n){for(var k=0;15>k;k++)this.rows[k].clear();k=this.currRow+1-this.nrRollUpRows;var q=this.lastOutputScreen;if(q){var u=q.rows[k].cueStartTime,B=this.logger.time;if(u&&null!==B&&u<B)for(u=0;u<this.nrRollUpRows;u++)this.rows[n-this.nrRollUpRows+u+1].copy(q.rows[k+u])}}this.currRow=n;n=this.rows[this.currRow];null!==p.indent&&(k=Math.max(p.indent-1,0),n.setCursor(p.indent),p.color=n.chars[k].penState.foreground);this.setPen({foreground:p.color,underline:p.underline,
italics:p.italics,background:"black",flash:!1})},z.setBkgData=function(p){this.logger.log(ac.INFO,"bkgData = "+JSON.stringify(p));this.backSpace();this.setPen(p);this.insertChar(32)},z.setRollUpRows=function(p){this.nrRollUpRows=p},z.rollUp=function(){if(null!==this.nrRollUpRows){this.logger.log(ac.TEXT,this.getDisplayText());var p=this.rows.splice(this.currRow+1-this.nrRollUpRows,1)[0];p.clear();this.rows.splice(this.currRow,0,p);this.logger.log(ac.INFO,"Rolling up")}else this.logger.log(ac.DEBUG,
"roll_up but nrRollUpRows not set yet")},z.getDisplayText=function(p){p=p||!1;for(var n=[],k="",q=-1,u=0;15>u;u++){var B=this.rows[u].getTextString();B&&(q=u+1,p?n.push("Row "+q+": '"+B+"'"):n.push(B.trim()))}return 0<n.length&&(k=p?"["+n.join(" | ")+"]":n.join("\n")),k},z.getTextAndFormat=function(){return this.rows},G}(),cd=function(){function G(p,n,k){this.logger=this.cueStartTime=this.writeScreen=this.currRollUpRow=this.lastOutputScreen=this.nonDisplayedMemory=this.displayedMemory=this.verbose=
this.mode=this.outputFilter=this.chNr=void 0;this.chNr=p;this.outputFilter=n;this.mode=null;this.verbose=0;this.displayedMemory=new te(k);this.nonDisplayedMemory=new te(k);this.lastOutputScreen=new te(k);this.currRollUpRow=this.displayedMemory.rows[14];this.writeScreen=this.displayedMemory;this.cueStartTime=this.mode=null;this.logger=k}var z=G.prototype;return z.reset=function(){this.mode=null;this.displayedMemory.reset();this.nonDisplayedMemory.reset();this.lastOutputScreen.reset();this.outputFilter.reset();
this.currRollUpRow=this.displayedMemory.rows[14];this.writeScreen=this.displayedMemory;this.cueStartTime=this.mode=null},z.getHandler=function(){return this.outputFilter},z.setHandler=function(p){this.outputFilter=p},z.setPAC=function(p){this.writeScreen.setPAC(p)},z.setBkgData=function(p){this.writeScreen.setBkgData(p)},z.setMode=function(p){p!==this.mode&&(this.mode=p,this.logger.log(ac.INFO,"MODE="+p),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,
this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=p)},z.insertChars=function(p){for(var n=0;n<p.length;n++)this.writeScreen.insertChar(p[n]);this.logger.log(ac.INFO,(this.writeScreen===this.displayedMemory?"DISP":"NON_DISP")+": "+this.writeScreen.getDisplayText(!0));"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(ac.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),
this.outputDataUpdate())},z.ccRCL=function(){this.logger.log(ac.INFO,"RCL - Resume Caption Loading");this.setMode("MODE_POP-ON")},z.ccBS=function(){this.logger.log(ac.INFO,"BS - BackSpace");"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},z.ccAOF=function(){},z.ccAON=function(){},z.ccDER=function(){this.logger.log(ac.INFO,"DER- Delete to End of Row");this.writeScreen.clearToEndOfRow();this.outputDataUpdate()},z.ccRU=function(p){this.logger.log(ac.INFO,
"RU("+p+") - Roll Up");this.writeScreen=this.displayedMemory;this.setMode("MODE_ROLL-UP");this.writeScreen.setRollUpRows(p)},z.ccFON=function(){this.logger.log(ac.INFO,"FON - Flash On");this.writeScreen.setPen({flash:!0})},z.ccRDC=function(){this.logger.log(ac.INFO,"RDC - Resume Direct Captioning");this.setMode("MODE_PAINT-ON")},z.ccTR=function(){this.logger.log(ac.INFO,"TR");this.setMode("MODE_TEXT")},z.ccRTD=function(){this.logger.log(ac.INFO,"RTD");this.setMode("MODE_TEXT")},z.ccEDM=function(){this.logger.log(ac.INFO,
"EDM - Erase Displayed Memory");this.displayedMemory.reset();this.outputDataUpdate(!0)},z.ccCR=function(){this.logger.log(ac.INFO,"CR - Carriage Return");this.writeScreen.rollUp();this.outputDataUpdate(!0)},z.ccENM=function(){this.logger.log(ac.INFO,"ENM - Erase Non-displayed Memory");this.nonDisplayedMemory.reset()},z.ccEOC=function(){if(this.logger.log(ac.INFO,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var p=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory;this.writeScreen=
this.nonDisplayedMemory=p;this.logger.log(ac.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},z.ccTO=function(p){this.logger.log(ac.INFO,"TO("+p+") - Tab Offset");this.writeScreen.moveCursor(p)},z.ccMIDROW=function(p){var n={flash:!1};(n.underline=1==p%2,n.italics=46<=p,n.italics)?n.foreground="white":n.foreground="white green blue cyan red yellow magenta".split(" ")[Math.floor(p/2)-16];this.logger.log(ac.INFO,"MIDROW: "+JSON.stringify(n));this.writeScreen.setPen(n)},
z.outputDataUpdate=function(p){void 0===p&&(p=!1);var n=this.logger.time;null!==n&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,n,this.lastOutputScreen),p&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:n):this.cueStartTime=n,this.lastOutputScreen.copy(this.displayedMemory))},z.cueSplitAtTime=function(p){this.outputFilter&&
(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,p,this.displayedMemory),this.cueStartTime=p))},G}(),Vd=function(){function G(p,n,k){this.channels=void 0;this.currentChannel=0;this.logger=this.cmdHistory=void 0;var q=new Ue;this.channels=[null,new cd(p,n,q),new cd(p+1,k,q)];this.cmdHistory={a:null,b:null};this.logger=q}var z=G.prototype;return z.getHandler=function(p){return this.channels[p].getHandler()},z.setHandler=function(p,n){this.channels[p].setHandler(n)},
z.addData=function(p,n){var k,q,u,B=!1;this.logger.time=p;for(p=0;p<n.length;p+=2)if(q=127&n[p],u=127&n[p+1],0!==q||0!==u){if(this.logger.log(ac.DATA,"["+jd([n[p],n[p+1]])+"] -> ("+jd([q,u])+")"),(k=this.parseCmd(q,u))||(k=this.parseMidrow(q,u)),k||=this.parsePAC(q,u),k||=this.parseBackgroundAttributes(q,u),!k&&(B=this.parseChars(q,u))){var F=this.currentChannel;F&&0<F?this.channels[F].insertChars(B):this.logger.log(ac.WARNING,"No channel found yet. TEXT-MODE?")}k||B||this.logger.log(ac.WARNING,"Couldn't parse cleaned data "+
jd([q,u])+" orig: "+jd([n[p],n[p+1]]))}},z.parseCmd=function(p,n){var k=this.cmdHistory;if(!((20===p||28===p||21===p||29===p)&&32<=n&&47>=n||(23===p||31===p)&&33<=n&&35>=n))return!1;if(k.a===p&&k.b===n)return k.a=null,k.b=null,this.logger.log(ac.DEBUG,"Repeated command ("+jd([p,n])+") is dropped"),!0;var q=20===p||21===p||23===p?1:2,u=this.channels[q];20===p||21===p||28===p||29===p?32===n?u.ccRCL():33===n?u.ccBS():34===n?u.ccAOF():35===n?u.ccAON():36===n?u.ccDER():37===n?u.ccRU(2):38===n?u.ccRU(3):
39===n?u.ccRU(4):40===n?u.ccFON():41===n?u.ccRDC():42===n?u.ccTR():43===n?u.ccRTD():44===n?u.ccEDM():45===n?u.ccCR():46===n?u.ccENM():47===n&&u.ccEOC():u.ccTO(n-32);k.a=p;k.b=n;return this.currentChannel=q,!0},z.parseMidrow=function(p,n){var k;if((17===p||25===p)&&32<=n&&47>=n){if((k=17===p?1:2)!==this.currentChannel)return this.logger.log(ac.ERROR,"Mismatch channel in midrow parsing"),!1;k=this.channels[k];return!!k&&(k.ccMIDROW(n),this.logger.log(ac.DEBUG,"MIDROW ("+jd([p,n])+")"),!0)}return!1},
z.parsePAC=function(p,n){var k=this.cmdHistory;if(!((17<=p&&23>=p||25<=p&&31>=p)&&64<=n&&127>=n||(16===p||24===p)&&64<=n&&95>=n))return!1;if(k.a===p&&k.b===n)return k.a=null,k.b=null,!0;var q=23>=p?1:2;var u=64<=n&&95>=n?1===q?Qe[p]:Re[p]:1===q?uf[p]:Se[p];var B=this.channels[q],F;if(F=!!B)B.setPAC(this.interpretPAC(u,n)),k.a=p,k.b=n,F=(this.currentChannel=q,!0);return F},z.interpretPAC=function(p,n){var k;p={color:null,italics:!1,indent:null,underline:!1,row:p};return k=95<n?n-96:n-64,p.underline=
1==(1&k),13>=k?p.color="white green blue cyan red yellow magenta white".split(" ")[Math.floor(k/2)]:15>=k?(p.italics=!0,p.color="white"):p.indent=4*Math.floor((k-16)/2),p},z.parseChars=function(p,n){var k,q,u=null,B=null;(25<=p?(k=2,B=p-8):(k=1,B=p),17<=B&&19>=B)?(q=17===B?n+80:18===B?n+112:n+144,this.logger.log(ac.INFO,"Special char '"+pd(q)+"' in channel "+k),u=[q]):32<=p&&127>=p&&(u=0===n?[p]:[p,n]);u&&(k=jd(u),this.logger.log(ac.DEBUG,"Char codes =  "+k.join(",")),k=this.cmdHistory,k.a=p,k.b=
n);return u},z.parseBackgroundAttributes=function(p,n){var k;if(!((16===p||24===p)&&32<=n&&47>=n||(23===p||31===p)&&45<=n&&47>=n))return!1;var q={};16===p||24===p?(k=Math.floor((n-32)/2),q.background=Te[k],1==n%2&&(q.background+="_semi")):45===n?q.background="transparent":(q.foreground="black",47===n&&(q.underline=!0));this.channels[23>=p?1:2].setBkgData(q);k=this.cmdHistory;k.a=p;k.b=n;return!0},z.reset=function(){for(var p=0;p<Object.keys(this.channels).length;p++){var n=this.channels[p];n&&n.reset()}this.cmdHistory=
{a:null,b:null}},z.cueSplitAtTime=function(p){for(var n=0;n<this.channels.length;n++){var k=this.channels[n];k&&k.cueSplitAtTime(p)}},G}(),Ve=function(){function G(p,n){this.timelineController=void 0;this.cueRanges=[];this.trackName=void 0;this.screen=this.endTime=this.startTime=null;this.timelineController=p;this.trackName=n}var z=G.prototype;return z.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),
this.startTime=null)},z.newCue=function(p,n,k){(null===this.startTime||this.startTime>p)&&(this.startTime=p);this.endTime=n;this.screen=k;this.timelineController.createCaptionsTrack(this.trackName)},z.reset=function(){this.cueRanges=[];this.startTime=null},G}(),We=function(){function G(q,u){if("string"!=typeof u||!Array.isArray(q))return!1;u=u.toLowerCase();return!!~q.indexOf(u)&&u}function z(q){for(var u=arguments.length,B=Array(1<u?u-1:0),F=1;F<u;F++)B[F-1]=arguments[F];for(u=1;u<arguments.length;u++){B=
arguments[u];for(var K in B)q[K]=B[K]}return q}function p(q,u,B){var F={enumerable:!0};this.hasBeenReset=!1;var K="",Z=!1,ja=q,ya=u,Xa=B,La=null,Wa="",db=!0,bb="auto",sb="start",Wb=50,tb="middle",bc=50,fc="middle";Object.defineProperty(this,"id",z({},F,{get:function(){return K},set:function(ub){K=""+ub}}));Object.defineProperty(this,"pauseOnExit",z({},F,{get:function(){return Z},set:function(ub){Z=!!ub}}));Object.defineProperty(this,"startTime",z({},F,{get:function(){return ja},set:function(ub){if("number"!=
typeof ub)throw new TypeError("Start time must be set to a number.");ja=ub;this.hasBeenReset=!0}}));Object.defineProperty(this,"endTime",z({},F,{get:function(){return ya},set:function(ub){if("number"!=typeof ub)throw new TypeError("End time must be set to a number.");ya=ub;this.hasBeenReset=!0}}));Object.defineProperty(this,"text",z({},F,{get:function(){return Xa},set:function(ub){Xa=""+ub;this.hasBeenReset=!0}}));Object.defineProperty(this,"region",z({},F,{get:function(){return La},set:function(ub){La=
ub;this.hasBeenReset=!0}}));Object.defineProperty(this,"vertical",z({},F,{get:function(){return Wa},set:function(ub){ub=G(n,ub);if(!1===ub)throw new SyntaxError("An invalid or illegal string was specified.");Wa=ub;this.hasBeenReset=!0}}));Object.defineProperty(this,"snapToLines",z({},F,{get:function(){return db},set:function(ub){db=!!ub;this.hasBeenReset=!0}}));Object.defineProperty(this,"line",z({},F,{get:function(){return bb},set:function(ub){if("number"!=typeof ub&&"auto"!==ub)throw new SyntaxError("An invalid number or illegal string was specified.");
bb=ub;this.hasBeenReset=!0}}));Object.defineProperty(this,"lineAlign",z({},F,{get:function(){return sb},set:function(ub){ub=G(k,ub);if(!ub)throw new SyntaxError("An invalid or illegal string was specified.");sb=ub;this.hasBeenReset=!0}}));Object.defineProperty(this,"position",z({},F,{get:function(){return Wb},set:function(ub){if(0>ub||100<ub)throw Error("Position must be between 0 and 100.");Wb=ub;this.hasBeenReset=!0}}));Object.defineProperty(this,"positionAlign",z({},F,{get:function(){return tb},
set:function(ub){ub=G(k,ub);if(!ub)throw new SyntaxError("An invalid or illegal string was specified.");tb=ub;this.hasBeenReset=!0}}));Object.defineProperty(this,"size",z({},F,{get:function(){return bc},set:function(ub){if(0>ub||100<ub)throw Error("Size must be between 0 and 100.");bc=ub;this.hasBeenReset=!0}}));Object.defineProperty(this,"align",z({},F,{get:function(){return fc},set:function(ub){ub=G(k,ub);if(!ub)throw new SyntaxError("An invalid or illegal string was specified.");fc=ub;this.hasBeenReset=
!0}}));this.displayState=void 0}if("undefined"!=typeof self&&self.VTTCue)return self.VTTCue;var n=["","lr","rl"],k=["start","middle","end","left","right"];return p.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},p}(),ue=function(){function G(){}return G.prototype.decode=function(z,p){if(!z)return"";if("string"!=typeof z)throw Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(z))},G}(),Xe=function(){function G(){this.values=
Object.create(null)}var z=G.prototype;return z.set=function(p,n){this.get(p)||""===n||(this.values[p]=n)},z.get=function(p,n,k){return k?this.has(p)?this.values[p]:n[k]:this.has(p)?this.values[p]:n},z.has=function(p){return p in this.values},z.alt=function(p,n,k){for(var q=0;q<k.length;++q)if(n===k[q]){this.set(p,n);break}},z.integer=function(p,n){/^-?\d+$/.test(n)&&this.set(p,parseInt(n,10))},z.percent=function(p,n){return/^([\d]{1,3})(\.[\d]*)?%$/.test(n)&&(n=parseFloat(n),0<=n&&100>=n)?(this.set(p,
n),!0):!1},G}(),Wd=new We(0,0,""),Ye="middle"===Wd.align?"middle":"center",Ed=function(){function G(){this.state="INITIAL";this.buffer="";this.decoder=new ue;this.regionList=[];this.cue=null;this.onflush=this.onparsingerror=this.oncue=void 0}var z=G.prototype;return z.parse=function(p){function n(){var B=k.buffer,F=0;for(B=B.replace(/<br(?: \/)?>/gi,"\n");F<B.length&&"\r"!==B[F]&&"\n"!==B[F];)++F;var K=B.substr(0,F);return"\r"===B[F]&&++F,"\n"===B[F]&&++F,k.buffer=B.substr(F),K}var k=this;p&&(k.buffer+=
k.decoder.decode(p,{stream:!0}));try{p="";if("INITIAL"===k.state){if(!/\r\n|\n/.test(k.buffer))return this;var q=(p=n()).match(/^(\u00ef\u00bb\u00bf)?WEBVTT([ \t].*)?$/);if(!q||!q[0])throw Error("Malformed WebVTT signature.");k.state="HEADER"}for(q=!1;k.buffer;){if(!/\r\n|\n/.test(k.buffer))return this;switch(q?q=!1:p=n(),k.state){case "HEADER":/:/.test(p)?Ha(p,function(B,F){},/:/):p||(k.state="ID");continue;case "NOTE":p||(k.state="ID");continue;case "ID":if(/^NOTE($|[ \t])/.test(p)){k.state="NOTE";
break}if(!p)continue;if(k.cue=new We(0,0,""),k.state="CUE",-1===p.indexOf("--\x3e")){k.cue.id=p;continue}case "CUE":if(!k.cue){k.state="BADCUE";continue}try{Sa(p,k.cue,k.regionList)}catch(B){k.cue=null;k.state="BADCUE";continue}k.state="CUETEXT";continue;case "CUETEXT":var u=-1!==p.indexOf("--\x3e");if(!p||u&&(q=!0)){k.oncue&&k.cue&&k.oncue(k.cue);k.cue=null;k.state="ID";continue}if(null===k.cue)continue;k.cue.text&&(k.cue.text+="\n");k.cue.text+=p;continue;case "BADCUE":p||(k.state="ID")}}}catch(B){"CUETEXT"===
k.state&&k.cue&&k.oncue&&k.oncue(k.cue),k.cue=null,k.state="INITIAL"===k.state?"BADWEBVTT":"BADCUE"}return this},z.flush=function(){try{if((this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state||"BADWEBVTT"===this.state)throw Error("Malformed WebVTT signature.");}catch(p){this.onparsingerror&&this.onparsingerror(p)}return this.onflush&&this.onflush(),this},G}(),we=h(8),xi=h(16),yi=/\r\n|\n\r|\n|\r/g,bg=function(G,z,p){return void 0===p&&(p=0),G.substr(p,z.length)===
z},Ze=function(G){for(var z=5381,p=G.length;p;)z=33*z^G.charCodeAt(--p);return(z>>>0).toString()},Xd=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,tc=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,wf={left:"start",center:"center",right:"end",start:"start",end:"end"},Wg=function(){function G(p){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks=
{},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this.hls=p,this.config=p.config,this.Cues=p.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,
languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var n=new Ve(this,"textTrack1"),k=new Ve(this,"textTrack2"),q=new Ve(this,"textTrack3"),u=new Ve(this,"textTrack4");this.cea608Parser1=new Vd(1,n,k);this.cea608Parser2=new Vd(3,q,u)}p.on(Y.a.MEDIA_ATTACHING,this.onMediaAttaching,this);p.on(Y.a.MEDIA_DETACHING,this.onMediaDetaching,this);p.on(Y.a.MANIFEST_LOADING,
this.onManifestLoading,this);p.on(Y.a.MANIFEST_LOADED,this.onManifestLoaded,this);p.on(Y.a.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this);p.on(Y.a.FRAG_LOADING,this.onFragLoading,this);p.on(Y.a.FRAG_LOADED,this.onFragLoaded,this);p.on(Y.a.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this);p.on(Y.a.FRAG_DECRYPTED,this.onFragDecrypted,this);p.on(Y.a.INIT_PTS_FOUND,this.onInitPtsFound,this);p.on(Y.a.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this);p.on(Y.a.BUFFER_FLUSHING,this.onBufferFlushing,
this)}var z=G.prototype;return z.destroy=function(){var p=this.hls;p.off(Y.a.MEDIA_ATTACHING,this.onMediaAttaching,this);p.off(Y.a.MEDIA_DETACHING,this.onMediaDetaching,this);p.off(Y.a.MANIFEST_LOADING,this.onManifestLoading,this);p.off(Y.a.MANIFEST_LOADED,this.onManifestLoaded,this);p.off(Y.a.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this);p.off(Y.a.FRAG_LOADING,this.onFragLoading,this);p.off(Y.a.FRAG_LOADED,this.onFragLoaded,this);p.off(Y.a.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,
this);p.off(Y.a.FRAG_DECRYPTED,this.onFragDecrypted,this);p.off(Y.a.INIT_PTS_FOUND,this.onInitPtsFound,this);p.off(Y.a.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this);p.off(Y.a.BUFFER_FLUSHING,this.onBufferFlushing,this);this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},z.addCues=function(p,n,k,q,u){for(var B,F,K,Z,ja=!1,ya=u.length;ya--;){var Xa=u[ya],La=(B=Xa[0],F=Xa[1],K=n,Z=k,Math.min(F,Z)-Math.max(B,K));if(0<=La&&(Xa[0]=Math.min(Xa[0],n),Xa[1]=Math.max(Xa[1],k),ja=!0,
.5<La/(k-n)))return}(ja||u.push([n,k]),this.config.renderTextTracksNatively)?this.Cues.newCue(this.captionsTracks[p],n,k,q):(n=this.Cues.newCue(null,n,k,q),this.hls.trigger(Y.a.CUES_PARSED,{type:"captions",cues:n,track:p}))},z.onInitPtsFound=function(p,n){var k=this;p=n.frag;var q=n.initPTS,u=n.timescale,B=this.unparsedVttFrags;"main"===n.id&&(this.initPTS[p.cc]=q,this.timescale[p.cc]=u);B.length&&(this.unparsedVttFrags=[],B.forEach(function(F){k.onFragLoaded(Y.a.FRAG_LOADED,F)}))},z.getExistingTrack=
function(p){var n=this.media;if(n)for(var k=0;k<n.textTracks.length;k++){var q=n.textTracks[k];if(q[p])return q}return null},z.createCaptionsTrack=function(p){this.config.renderTextTracksNatively?this.createNativeTrack(p):this.createNonNativeTrack(p)},z.createNativeTrack=function(p){if(!this.captionsTracks[p]){var n=this.captionsTracks,k=this.media,q=this.captionsProperties[p],u=q.label;q=q.languageCode;var B=this.getExistingTrack(p);B?(n[p]=B,O(n[p]),E(n[p],k)):(k=this.createTextTrack("captions",
u,q))&&(k[p]=!0,n[p]=k)}},z.createNonNativeTrack=function(p){if(!this.nonNativeCaptionsTracks[p]){var n=this.captionsProperties[p];n&&(n={_id:p,label:n.label,kind:"captions",default:!!n.media&&!!n.media.default,closedCaptions:n.media},this.nonNativeCaptionsTracks[p]=n,this.hls.trigger(Y.a.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]}))}},z.createTextTrack=function(p,n,k){var q=this.media;if(q)return q.addTextTrack(p,n,k)},z.onMediaAttaching=function(p,n){this.media=n.media;this._cleanTracks()},z.onMediaDetaching=
function(){var p=this.captionsTracks;Object.keys(p).forEach(function(n){O(p[n]);delete p[n]});this.nonNativeCaptionsTracks={}},z.onManifestLoading=function(){this.prevCC=this.lastPartIndex=this.lastSn=-1;this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}};this._cleanTracks();this.tracks=[];this.captionsTracks={};this.nonNativeCaptionsTracks={};this.textTracks=[];this.unparsedVttFrags=this.unparsedVttFrags||[];this.initPTS=[];this.timescale=[];this.cea608Parser1&&this.cea608Parser2&&
(this.cea608Parser1.reset(),this.cea608Parser2.reset())},z._cleanTracks=function(){var p=this.media;if(p&&(p=p.textTracks))for(var n=0;n<p.length;n++)O(p[n])},z.onSubtitleTracksUpdated=function(p,n){var k=this;this.textTracks=[];p=n.subtitleTracks||[];n=p.some(function(u){return"stpp.ttml.im1t"===u.textCodec});if(this.config.enableWebVTT||n&&this.config.enableIMSC1)if(n=this.tracks&&p&&this.tracks.length===p.length,this.tracks=p||[],this.config.renderTextTracksNatively){var q=this.media?this.media.textTracks:
[];this.tracks.forEach(function(u,B){var F;if(B<q.length){B=null;for(var K=0;K<q.length;K++){var Z=q[K];if(Z&&Z.label===u.name&&!Z.textTrack1&&!Z.textTrack2){B=q[K];break}}B&&(F=B)}F?O(F):(F=k.createTextTrack("subtitles",u.name,u.lang))&&(F.mode="disabled");F&&(F.groupId=u.groupId,k.textTracks.push(F))})}else!n&&this.tracks&&this.tracks.length&&(p=this.tracks.map(function(u){return{label:u.name,kind:u.type.toLowerCase(),default:u.default,subtitleTrack:u}}),this.hls.trigger(Y.a.NON_NATIVE_TEXT_TRACKS_FOUND,
{tracks:p}))},z.onManifestLoaded=function(p,n){var k=this;this.config.enableCEA708Captions&&n.captions&&n.captions.forEach(function(q){var u=/(?:CC|SERVICE)([1-4])/.exec(q.instreamId);u&&(u=k.captionsProperties["textTrack"+u[1]])&&(u.label=q.name,q.lang&&(u.languageCode=q.lang),u.media=q)})},z.onFragLoading=function(p,n){p=this.cea608Parser1;var k=this.cea608Parser2,q=this.lastSn,u=this.lastPartIndex;if(this.enabled&&p&&k&&n.frag.type===Hb.b.MAIN){var B,F,K=n.frag.sn;n=null!=(B=null==n||null===(F=
n.part)||void 0===F?void 0:F.index)?B:-1;K===q+1||K===q&&n===u+1||(p.reset(),k.reset());this.lastSn=K;this.lastPartIndex=n}},z.onFragLoaded=function(p,n){p=n.frag;var k=n.payload,q=this.initPTS,u=this.unparsedVttFrags;if(p.type===Hb.b.SUBTITLE)if(k.byteLength){if(!Object(Zb.a)(q[p.cc]))return u.push(n),void(q.length&&this.hls.trigger(Y.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:p,error:Error("Missing initial subtitle PTS")}));n=p.decryptdata;if(null==n||null==n.key||"AES-128"!==n.method)n=this.tracks[p.level],
q=this.vttCCs,q[p.cc]||(q[p.cc]={start:p.start,prevCC:this.prevCC,new:!0},this.prevCC=p.cc),n&&"stpp.ttml.im1t"===n.textCodec?this._parseIMSC1(p,k):this._parseVTTs(p,k,q)}else this.hls.trigger(Y.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:p,error:Error("Empty subtitle payload")})},z._parseIMSC1=function(p,n){var k=this,q=this.hls;pb(n,this.initPTS[p.cc],this.timescale[p.cc],function(u){k._appendCues(u,p.level);q.trigger(Y.a.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:p})},function(u){Ua.b.log("Failed to parse IMSC1: "+
u);q.trigger(Y.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:p,error:u})})},z._parseVTTs=function(p,n,k){var q=this,u=this.hls;ob(n,this.initPTS[p.cc],this.timescale[p.cc],k,p.cc,p.start,function(B){q._appendCues(B,p.level);u.trigger(Y.a.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:p})},function(B){q._fallbackToIMSC1(p,n);Ua.b.log("Failed to parse VTT cue: "+B);u.trigger(Y.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:p,error:B})})},z._fallbackToIMSC1=function(p,n){var k=this,q=this.tracks[p.level];q.textCodec||
pb(n,this.initPTS[p.cc],this.timescale[p.cc],function(){q.textCodec="stpp.ttml.im1t";k._parseIMSC1(p,n)},function(){q.textCodec="wvtt"})},z._appendCues=function(p,n){var k=this.hls;if(this.config.renderTextTracksNatively){var q=this.textTracks[n];"disabled"!==q.mode&&p.forEach(function(u){return H(q,u)})}else k.trigger(Y.a.CUES_PARSED,{type:"subtitles",cues:p,track:this.tracks[n].default?"default":"subtitles"+n})},z.onFragDecrypted=function(p,n){p=n.frag;if(p.type===Hb.b.SUBTITLE){if(!Object(Zb.a)(this.initPTS[p.cc]))return void this.unparsedVttFrags.push(n);
this.onFragLoaded(Y.a.FRAG_LOADED,n)}},z.onSubtitleTracksCleared=function(){this.tracks=[];this.captionsTracks={}},z.onFragParsingUserdata=function(p,n){p=this.cea608Parser1;var k=this.cea608Parser2;if(this.enabled&&p&&k)for(var q=0;q<n.samples.length;q++){var u=n.samples[q].bytes;u&&(u=this.extractCea608Data(u),p.addData(n.samples[q].pts,u[0]),k.addData(n.samples[q].pts,u[1]))}},z.onBufferFlushing=function(p,n){var k=n.startOffset,q=n.endOffset,u=n.endOffsetSubtitles;p=n.type;if((n=this.media)&&
!(n.currentTime<q)){if(!p||"video"===p){var B=this.captionsTracks;Object.keys(B).forEach(function(K){return R(B[K],k,q)})}if(this.config.renderTextTracksNatively&&0===k&&void 0!==u){var F=this.textTracks;Object.keys(F).forEach(function(K){return R(F[K],k,u)})}}},z.extractCea608Data=function(p){for(var n=31&p[0],k=2,q=[[],[]],u=0;u<n;u++){var B=p[k++],F=127&p[k++],K=127&p[k++],Z=3&B;0===F&&0===K||0!=(4&B)&&(0!==Z&&1!==Z||(q[Z].push(F),q[Z].push(K)))}return q},G}(),Fd,xf=function(){function G(k){this.clientRect=
this.streamController=this.timer=this.restrictedLevels=this.media=this.firstLevel=this.autoLevelCapping=void 0;this.hls=k;this.autoLevelCapping=Number.POSITIVE_INFINITY;this.firstLevel=-1;this.media=null;this.restrictedLevels=[];this.timer=void 0;this.clientRect=null;this.registerListeners()}var z,p,n=G.prototype;return n.setStreamController=function(k){this.streamController=k},n.destroy=function(){this.unregisterListener();this.hls.config.capLevelToPlayerSize&&this.stopCapping();this.hls=this.streamController=
this.clientRect=this.media=null},n.registerListeners=function(){var k=this.hls;k.on(Y.a.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this);k.on(Y.a.MEDIA_ATTACHING,this.onMediaAttaching,this);k.on(Y.a.MANIFEST_PARSED,this.onManifestParsed,this);k.on(Y.a.BUFFER_CODECS,this.onBufferCodecs,this);k.on(Y.a.MEDIA_DETACHING,this.onMediaDetaching,this)},n.unregisterListener=function(){var k=this.hls;k.off(Y.a.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this);k.off(Y.a.MEDIA_ATTACHING,this.onMediaAttaching,
this);k.off(Y.a.MANIFEST_PARSED,this.onManifestParsed,this);k.off(Y.a.BUFFER_CODECS,this.onBufferCodecs,this);k.off(Y.a.MEDIA_DETACHING,this.onMediaDetaching,this)},n.onFpsDropLevelCapping=function(k,q){G.isLevelAllowed(q.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(q.droppedLevel)},n.onMediaAttaching=function(k,q){this.media=q.media instanceof HTMLVideoElement?q.media:null},n.onManifestParsed=function(k,q){k=this.hls;this.restrictedLevels=[];this.firstLevel=q.firstLevel;k.config.capLevelToPlayerSize&&
q.video&&this.startCapping()},n.onBufferCodecs=function(k,q){this.hls.config.capLevelToPlayerSize&&q.video&&this.startCapping()},n.onMediaDetaching=function(){this.stopCapping()},n.detectPlayerSize=function(){if(this.media&&0<this.mediaHeight&&0<this.mediaWidth){var k=this.hls.levels;if(k.length){var q=this.hls;q.autoLevelCapping=this.getMaxLevel(k.length-1);q.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch();this.autoLevelCapping=q.autoLevelCapping}}},
n.getMaxLevel=function(k){var q=this,u=this.hls.levels;if(!u.length)return-1;u=u.filter(function(B,F){return G.isLevelAllowed(F,q.restrictedLevels)&&F<=k});return this.clientRect=null,G.getMaxLevelByMediaSize(u,this.mediaWidth,this.mediaHeight)},n.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1E3),this.detectPlayerSize())},
n.stopCapping=function(){this.restrictedLevels=[];this.firstLevel=-1;this.autoLevelCapping=Number.POSITIVE_INFINITY;this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},n.getDimensions=function(){if(this.clientRect)return this.clientRect;var k=this.media,q={width:0,height:0};if(k){var u=k.getBoundingClientRect();q.width=u.width;q.height=u.height;q.width||q.height||(q.width=u.right-u.left||k.width||0,q.height=u.bottom-u.top||k.height||0)}return this.clientRect=q,q},G.isLevelAllowed=function(k,
q){return void 0===q&&(q=[]),-1===q.indexOf(k)},G.getMaxLevelByMediaSize=function(k,q,u){if(!k||!k.length)return-1;for(var B,F,K=k.length-1,Z=0;Z<k.length;Z+=1){var ja=k[Z];if((ja.width>=q||ja.height>=u)&&(B=ja,!(F=k[Z+1])||B.width!==F.width||B.height!==F.height)){K=Z;break}}return K},p=[{key:"contentScaleFactor",get:function(){var k=1;try{k=self.devicePixelRatio}catch(q){}return k}}],z=[{key:"mediaWidth",get:function(){return this.getDimensions().width*G.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*
G.contentScaleFactor}}],Cc(G.prototype,z),p&&Cc(G,p),G}(),$e=function(){function G(p){this.hls=void 0;this.isVideoPlaybackQualityAvailable=!1;this.timer=void 0;this.media=null;this.lastTime=void 0;this.lastDecodedFrames=this.lastDroppedFrames=0;this.streamController=void 0;this.hls=p;this.registerListeners()}var z=G.prototype;return z.setStreamController=function(p){this.streamController=p},z.registerListeners=function(){this.hls.on(Y.a.MEDIA_ATTACHING,this.onMediaAttaching,this)},z.unregisterListeners=
function(){this.hls.off(Y.a.MEDIA_ATTACHING,this.onMediaAttaching)},z.destroy=function(){this.timer&&clearInterval(this.timer);this.unregisterListeners();this.isVideoPlaybackQualityAvailable=!1;this.media=null},z.onMediaAttaching=function(p,n){p=this.hls.config;p.capLevelOnFPSDrop&&((this.media=n=n.media instanceof self.HTMLVideoElement?n.media:null)&&"function"==typeof n.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),
p.fpsDroppedMonitoringPeriod))},z.checkFPS=function(p,n,k){p=performance.now();if(n){if(this.lastTime){var q=k-this.lastDroppedFrames,u=n-this.lastDecodedFrames,B=1E3*q/(p-this.lastTime),F=this.hls;if(F.trigger(Y.a.FPS_DROP,{currentDropped:q,currentDecoded:u,totalDroppedFrames:k}),0<B&&q>F.config.fpsDroppedMonitoringThreshold*u)q=F.currentLevel,Ua.b.warn("drop FPS ratio greater than max allowed value for currentLevel: "+q),0<q&&(-1===F.autoLevelCapping||F.autoLevelCapping>=q)&&(--q,F.trigger(Y.a.FPS_DROP_LEVEL_CAPPING,
{level:q,droppedLevel:F.currentLevel}),F.autoLevelCapping=q,this.streamController.nextLevelSwitch())}this.lastTime=p;this.lastDroppedFrames=k;this.lastDecodedFrames=n}},z.checkFPSInterval=function(){var p=this.media;if(p)if(this.isVideoPlaybackQualityAvailable){var n=p.getVideoPlaybackQuality();this.checkFPS(p,n.totalVideoFrames,n.droppedVideoFrames)}else this.checkFPS(p,p.webkitDecodedFrameCount,p.webkitDroppedFrameCount)},G}();!function(G){G.WIDEVINE="com.widevine.alpha";G.PLAYREADY="com.microsoft.playready"}(Fd||=
{});var Xg="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null,Jc,ve,cg,Yg=function(){function G(n){this._config=this._drmSystemOptions=this._requestMediaKeySystemAccess=this._emeEnabled=this._licenseResponseCallback=this._licenseXhrSetup=this._widevineLicenseUrl=this.hls=void 0;this._mediaKeysList=[];this._media=null;this._hasSetMediaKeys=!1;this._requestLicenseFailureCount=0;this.mediaKeysPromise=
null;this._onMediaEncrypted=this.onMediaEncrypted.bind(this);this.hls=n;this._config=n.config;this._widevineLicenseUrl=this._config.widevineLicenseUrl;this._licenseXhrSetup=this._config.licenseXhrSetup;this._licenseResponseCallback=this._config.licenseResponseCallback;this._emeEnabled=this._config.emeEnabled;this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc;this._drmSystemOptions=this._config.drmSystemOptions;this._registerListeners()}var z,p=G.prototype;return p.destroy=
function(){this._unregisterListeners();this._requestMediaKeySystemAccess=this.hls=this._onMediaEncrypted=null},p._registerListeners=function(){this.hls.on(Y.a.MEDIA_ATTACHED,this.onMediaAttached,this);this.hls.on(Y.a.MEDIA_DETACHED,this.onMediaDetached,this);this.hls.on(Y.a.MANIFEST_PARSED,this.onManifestParsed,this)},p._unregisterListeners=function(){this.hls.off(Y.a.MEDIA_ATTACHED,this.onMediaAttached,this);this.hls.off(Y.a.MEDIA_DETACHED,this.onMediaDetached,this);this.hls.off(Y.a.MANIFEST_PARSED,
this.onManifestParsed,this)},p.getLicenseServerUrl=function(n){switch(n){case Fd.WIDEVINE:if(this._widevineLicenseUrl)return this._widevineLicenseUrl}throw Error('no license server URL configured for key-system "'+n+'"');},p._attemptKeySystemAccess=function(n,k,q){var u=this;k=function(B,F,K,Z){switch(B){case Fd.WIDEVINE:return function(ja,ya,Xa){var La={audioCapabilities:[],videoCapabilities:[]};return ja.forEach(function(Wa){La.audioCapabilities.push({contentType:'audio/mp4; codecs="'+Wa+'"',robustness:Xa.audioRobustness||
""})}),ya.forEach(function(Wa){La.videoCapabilities.push({contentType:'video/mp4; codecs="'+Wa+'"',robustness:Xa.videoRobustness||""})}),[La]}(F,K,Z);default:throw Error("Unknown key-system: "+B);}}(n,k,q,this._drmSystemOptions);Ua.b.log("Requesting encrypted media key-system access");k=this.requestMediaKeySystemAccess(n,k);this.mediaKeysPromise=k.then(function(B){return u._onMediaKeySystemAccessObtained(n,B)});k.catch(function(B){Ua.b.error('Failed to obtain key-system "'+n+'" access:',B)})},p._onMediaKeySystemAccessObtained=
function(n,k){var q=this;Ua.b.log('Access for key-system "'+n+'" obtained');var u={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:k,mediaKeySystemDomain:n};this._mediaKeysList.push(u);var B=Promise.resolve().then(function(){return k.createMediaKeys()}).then(function(F){return u.mediaKeys=F,Ua.b.log('Media-keys created for key-system "'+n+'"'),q._onMediaKeysCreated(),F});return B.catch(function(F){Ua.b.error("Failed to create media-keys:",F)}),B},p._onMediaKeysCreated=function(){var n=this;this._mediaKeysList.forEach(function(k){k.mediaKeysSession||
(k.mediaKeysSession=k.mediaKeys.createSession(),n._onNewMediaKeySession(k.mediaKeysSession))})},p._onNewMediaKeySession=function(n){var k=this;Ua.b.log("New key-system session "+n.sessionId);n.addEventListener("message",function(q){k._onKeySessionMessage(n,q.message)},!1)},p._onKeySessionMessage=function(n,k){Ua.b.log("Got EME message event, creating license request");this._requestLicense(k,function(q){Ua.b.log("Received license data (length: "+(q?q.byteLength:q)+"), updating key-session");n.update(q)})},
p.onMediaEncrypted=function(n){var k=this;if(Ua.b.log('Media is encrypted using "'+n.initDataType+'" init data type'),!this.mediaKeysPromise)return Ua.b.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(Y.a.ERROR,{type:hb.b.KEY_SYSTEM_ERROR,details:hb.a.KEY_SYSTEM_NO_KEYS,fatal:!0});var q=function(u){k._media&&(k._attemptSetMediaKeys(u),k._generateRequestWithPreferredKeySession(n.initDataType,n.initData))};this.mediaKeysPromise.then(q).catch(q)},
p._attemptSetMediaKeys=function(n){if(!this._media)throw Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){n=this._mediaKeysList[0];if(!n||!n.mediaKeys)return Ua.b.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(Y.a.ERROR,{type:hb.b.KEY_SYSTEM_ERROR,details:hb.a.KEY_SYSTEM_NO_KEYS,fatal:!0});Ua.b.log("Setting keys for encrypted media");this._media.setMediaKeys(n.mediaKeys);this._hasSetMediaKeys=
!0}},p._generateRequestWithPreferredKeySession=function(n,k){var q=this,u=this._mediaKeysList[0];if(!u)return Ua.b.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(Y.a.ERROR,{type:hb.b.KEY_SYSTEM_ERROR,details:hb.a.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(u.mediaKeysSessionInitialized)Ua.b.warn("Key-Session already initialized but requested again");else{var B=u.mediaKeysSession;if(!B)return Ua.b.error("Fatal: Media is encrypted but no key-session existing"),
void this.hls.trigger(Y.a.ERROR,{type:hb.b.KEY_SYSTEM_ERROR,details:hb.a.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!k)return Ua.b.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(Y.a.ERROR,{type:hb.b.KEY_SYSTEM_ERROR,details:hb.a.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});Ua.b.log('Generating key-session request for "'+n+'" init data type');u.mediaKeysSessionInitialized=!0;B.generateRequest(n,k).then(function(){Ua.b.debug("Key-session generation succeeded")}).catch(function(F){Ua.b.error("Error generating key-session request:",
F);q.hls.trigger(Y.a.ERROR,{type:hb.b.KEY_SYSTEM_ERROR,details:hb.a.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},p._createLicenseXhr=function(n,k,q){var u=new XMLHttpRequest;u.responseType="arraybuffer";u.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,u,n,k,q);if(k=this._licenseXhrSetup)try{k.call(this.hls,u,n),k=void 0}catch(B){Ua.b.error(B)}try{u.readyState||u.open("POST",n,!0),k&&k.call(this.hls,u,n)}catch(B){throw Error("issue setting up KeySystem license XHR "+B);}return u},p._onLicenseRequestReadyStageChange=
function(n,k,q,u){switch(n.readyState){case 4:if(200===n.status){this._requestLicenseFailureCount=0;Ua.b.log("License request succeeded");q=n.response;var B=this._licenseResponseCallback;if(B)try{q=B.call(this.hls,n,k)}catch(F){Ua.b.error(F)}u(q)}else{if(Ua.b.error("License Request XHR failed ("+k+"). Status: "+n.status+" ("+n.statusText+")"),this._requestLicenseFailureCount++,3<this._requestLicenseFailureCount)return void this.hls.trigger(Y.a.ERROR,{type:hb.b.KEY_SYSTEM_ERROR,details:hb.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,
fatal:!0});Ua.b.warn("Retrying license request, "+(3-this._requestLicenseFailureCount+1)+" attempts left");this._requestLicense(q,u)}}},p._generateLicenseRequestChallenge=function(n,k){switch(n.mediaKeySystemDomain){case Fd.WIDEVINE:return k}throw Error("unsupported key-system: "+n.mediaKeySystemDomain);},p._requestLicense=function(n,k){Ua.b.log("Requesting content license for key-system");var q=this._mediaKeysList[0];if(!q)return Ua.b.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),
void this.hls.trigger(Y.a.ERROR,{type:hb.b.KEY_SYSTEM_ERROR,details:hb.a.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var u=this.getLicenseServerUrl(q.mediaKeySystemDomain),B=this._createLicenseXhr(u,n,k);Ua.b.log("Sending license request to URL: "+u);var F=this._generateLicenseRequestChallenge(q,n);B.send(F)}catch(K){Ua.b.error("Failure requesting DRM license: "+K),this.hls.trigger(Y.a.ERROR,{type:hb.b.KEY_SYSTEM_ERROR,details:hb.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},p.onMediaAttached=function(n,
k){this._emeEnabled&&(this._media=n=k.media,n.addEventListener("encrypted",this._onMediaEncrypted))},p.onMediaDetached=function(){var n=this._media,k=this._mediaKeysList;n&&(n.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(k.map(function(q){if(q.mediaKeysSession)return q.mediaKeysSession.close().catch(function(){})})).then(function(){return n.setMediaKeys(null)}).catch(function(){}))},p.onManifestParsed=function(n,k){this._emeEnabled&&(n=
k.levels.map(function(q){return q.audioCodec}).filter(function(q){return!!q}),k=k.levels.map(function(q){return q.videoCodec}).filter(function(q){return!!q}),this._attemptKeySystemAccess(Fd.WIDEVINE,n,k))},z=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}],id(G.prototype,z),G}();!function(G){G.MANIFEST="m";G.AUDIO="a";G.VIDEO="v";G.MUXED="av";G.INIT=
"i";G.CAPTION="c";G.TIMED_TEXT="tt";G.KEY="k";G.OTHER="o"}(Jc||={});(function(G){G.DASH="d";G.HLS="h";G.SMOOTH="s";G.OTHER="o"})(ve||={});(function(G){G.VOD="v";G.LIVE="l"})(cg||={});var Zg=function(){function G(p){var n=this;this.cid=this.sid=this.media=this.config=this.hls=void 0;this.starved=this.initialized=this.useHeaders=!1;this.buffering=!0;this.videoBuffer=this.audioBuffer=void 0;this.onWaiting=function(){n.initialized&&(n.starved=!0);n.buffering=!0};this.onPlaying=function(){n.initialized||
(n.initialized=!0);n.buffering=!1};this.applyPlaylistData=function(q){try{n.apply(q,{ot:Jc.MANIFEST,su:!n.initialized})}catch(u){Ua.b.warn("Could not generate manifest CMCD data.",u)}};this.applyFragmentData=function(q){try{var u=q.frag,B=n.hls.levels[u.level],F=n.getObjectType(u),K={d:1E3*u.duration,ot:F};F!==Jc.VIDEO&&F!==Jc.AUDIO&&F!=Jc.MUXED||(K.br=B.bitrate/1E3,K.tb=n.getTopBandwidth(F)/1E3,K.bl=n.getBufferLength(F));n.apply(q,K)}catch(Z){Ua.b.warn("Could not generate segment CMCD data.",Z)}};
this.hls=p;p=this.config=p.config;var k=p.cmcd;null!=k&&(p.pLoader=this.createPlaylistLoader(),p.fLoader=this.createFragmentLoader(),this.sid=k.sessionId||G.uuid(),this.cid=k.contentId,this.useHeaders=!0===k.useHeaders,this.registerListeners())}var z=G.prototype;return z.registerListeners=function(){var p=this.hls;p.on(Y.a.MEDIA_ATTACHED,this.onMediaAttached,this);p.on(Y.a.MEDIA_DETACHED,this.onMediaDetached,this);p.on(Y.a.BUFFER_CREATED,this.onBufferCreated,this)},z.unregisterListeners=function(){var p=
this.hls;p.off(Y.a.MEDIA_ATTACHED,this.onMediaAttached,this);p.off(Y.a.MEDIA_DETACHED,this.onMediaDetached,this);p.off(Y.a.BUFFER_CREATED,this.onBufferCreated,this);this.onMediaDetached()},z.destroy=function(){this.unregisterListeners();this.hls=this.config=this.audioBuffer=this.videoBuffer=null},z.onMediaAttached=function(p,n){this.media=n.media;this.media.addEventListener("waiting",this.onWaiting);this.media.addEventListener("playing",this.onPlaying)},z.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",
this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},z.onBufferCreated=function(p,n){var k,q;this.audioBuffer=null===(k=n.tracks.audio)||void 0===k?void 0:k.buffer;this.videoBuffer=null===(q=n.tracks.video)||void 0===q?void 0:q.buffer},z.createData=function(){var p;return{v:1,sf:ve.HLS,sid:this.sid,cid:this.cid,pr:null===(p=this.media)||void 0===p?void 0:p.playbackRate,mtp:this.hls.bandwidthEstimate/1E3}},z.apply=function(p,n){void 0===n&&(n={});pc(n,this.createData());
var k=n.ot===Jc.INIT||n.ot===Jc.VIDEO||n.ot===Jc.MUXED;if(this.starved&&k&&(n.bs=!0,n.su=!0,this.starved=!1),null==n.su&&(n.su=this.buffering),this.useHeaders)n=G.toHeaders(n),Object.keys(n).length&&(p.headers||(p.headers={}),pc(p.headers,n));else if(n=G.toQuery(n))p.url=G.appendQueryToUri(p.url,n)},z.getObjectType=function(p){var n=p.type;return"subtitle"===n?Jc.TIMED_TEXT:"initSegment"===p.sn?Jc.INIT:"audio"===n?Jc.AUDIO:"main"===n?this.hls.audioTracks.length?Jc.VIDEO:Jc.MUXED:void 0},z.getTopBandwidth=
function(p){var n=0;var k=this.hls;p===Jc.AUDIO?k=k.audioTracks:(p=k.maxAutoLevel,k=k.levels.slice(0,-1<p?p+1:k.levels.length));for(k=Zc(k);!(p=k()).done;)p=p.value,p.bitrate>n&&(n=p.bitrate);return 0<n?n:NaN},z.getBufferLength=function(p){var n=this.hls.media;return(p=p===Jc.AUDIO?this.audioBuffer:this.videoBuffer)&&n?1E3*xc.bufferInfo(p,n.currentTime,this.config.maxBufferHole).len:NaN},z.createPlaylistLoader=function(){var p=this.applyPlaylistData,n=this.config.pLoader||this.config.loader;return function(){function k(u){this.loader=
void 0;this.loader=new n(u)}var q=k.prototype;return q.destroy=function(){this.loader.destroy()},q.abort=function(){this.loader.abort()},q.load=function(u,B,F){p(u);this.loader.load(u,B,F)},zd(k,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),k}()},z.createFragmentLoader=function(){var p=this.applyFragmentData,n=this.config.fLoader||this.config.loader;return function(){function k(u){this.loader=void 0;this.loader=new n(u)}var q=
k.prototype;return q.destroy=function(){this.loader.destroy()},q.abort=function(){this.loader.abort()},q.load=function(u,B,F){p(u);this.loader.load(u,B,F)},zd(k,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),k}()},G.uuid=function(){var p=URL.createObjectURL(new Blob),n=p.toString();return URL.revokeObjectURL(p),n.substr(n.lastIndexOf("/")+1)},G.serialize=function(p){var n,k=[],q=function(ya){return!Number.isNaN(ya)&&null!=ya&&""!==
ya&&!1!==ya},u=function(ya){return Math.round(ya)},B=function(ya){return 100*u(ya/100)};B={br:u,d:u,bl:B,dl:B,mtp:B,nor:function(ya){return encodeURIComponent(ya)},rtp:B,tb:u};for(var F=Zc(Object.keys(p||{}).sort());!(n=F()).done;){n=n.value;var K=p[n];if(q(K)&&!("v"===n&&1===K||"pr"==n&&1===K)){var Z=B[n];Z&&(K=Z(K));Z=typeof K;var ja=void 0;ja="ot"===n||"sf"===n||"st"===n?n+"="+K:"boolean"===Z?n:"number"===Z?n+"="+K:n+"="+JSON.stringify(K);k.push(ja)}}return k.join(",")},G.toHeaders=function(p){for(var n=
{},k=["Object","Request","Session","Status"],q=[{},{},{},{}],u={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},B=0,F=Object.keys(p);B<F.length;B++){var K=F[B];q[null!=u[K]?u[K]:1][K]=p[K]}for(p=0;p<q.length;p++)(u=G.serialize(q[p]))&&(n["CMCD-"+k[p]]=u);return n},G.toQuery=function(p){return"CMCD="+encodeURIComponent(G.serialize(p))},G.appendQueryToUri=function(p,n){if(!n)return p;var k=p.includes("?")?"&":"?";return""+p+k+n},G}(),Gd=h(12),Yd=/^age:\s*[\d.]+\s*$/m,
kd=function(){function G(p){this.retryDelay=this.retryTimeout=this.requestTimeout=this.xhrSetup=void 0;this.callbacks=this.config=null;this.context=void 0;this.loader=null;this.stats=void 0;this.xhrSetup=p?p.xhrSetup:null;this.stats=new Gd.a;this.retryDelay=0}var z=G.prototype;return z.destroy=function(){this.callbacks=null;this.abortInternal();this.config=this.loader=null},z.abortInternal=function(){var p=this.loader;self.clearTimeout(this.requestTimeout);self.clearTimeout(this.retryTimeout);p&&
(p.onreadystatechange=null,p.onprogress=null,4!==p.readyState&&(this.stats.aborted=!0,p.abort()))},z.abort=function(){var p;this.abortInternal();null!==(p=this.callbacks)&&void 0!==p&&p.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},z.load=function(p,n,k){if(this.stats.loading.start)throw Error("Loader can only be used once.");this.stats.loading.start=self.performance.now();this.context=p;this.config=n;this.callbacks=k;this.retryDelay=n.retryDelay;this.loadInternal()},z.loadInternal=
function(){var p=this.config,n=this.context;if(p){var k=this.loader=new self.XMLHttpRequest,q=this.stats;q.loading.first=0;q.loaded=0;q=this.xhrSetup;try{if(q)try{q(k,n.url)}catch(F){k.open("GET",n.url,!0),q(k,n.url)}k.readyState||k.open("GET",n.url,!0);var u=this.context.headers;if(u)for(var B in u)k.setRequestHeader(B,u[B])}catch(F){return void this.callbacks.onError({code:k.status,text:F.message},n,k)}n.rangeEnd&&k.setRequestHeader("Range","bytes="+n.rangeStart+"-"+(n.rangeEnd-1));k.onreadystatechange=
this.readystatechange.bind(this);k.onprogress=this.loadprogress.bind(this);k.responseType=n.responseType;self.clearTimeout(this.requestTimeout);this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),p.timeout);k.send()}},z.readystatechange=function(){var p=this.context,n=this.loader,k=this.stats;if(p&&n){var q=n.readyState,u=this.config;if(!k.aborted&&2<=q)if(self.clearTimeout(this.requestTimeout),0===k.loading.first&&(k.loading.first=Math.max(self.performance.now(),k.loading.start)),4===
q)if(n.onreadystatechange=null,n.onprogress=null,q=n.status,200<=q&&300>q){var B,F;if(k.loading.end=Math.max(self.performance.now(),k.loading.first),F="arraybuffer"===p.responseType?(B=n.response).byteLength:(B=n.responseText).length,k.loaded=k.total=F,this.callbacks)if(u=this.callbacks.onProgress,u&&u(k,p,B,n),this.callbacks)this.callbacks.onSuccess({url:n.responseURL,data:B},k,p,n)}else k.retry>=u.maxRetry||400<=q&&499>q?(Ua.b.error(q+" while loading "+p.url),this.callbacks.onError({code:q,text:n.statusText},
p,n)):(Ua.b.warn(q+" while loading "+p.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,u.maxRetryDelay),k.retry++);else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),u.timeout)}},z.loadtimeout=function(){Ua.b.warn("timeout while loading "+this.context.url);
var p=this.callbacks;p&&(this.abortInternal(),p.onTimeout(this.stats,this.context,this.loader))},z.loadprogress=function(p){var n=this.stats;n.loaded=p.loaded;p.lengthComputable&&(n.total=p.total)},z.getCacheAge=function(){var p=null;this.loader&&Yd.test(this.loader.getAllResponseHeaders())&&(p=(p=this.loader.getResponseHeader("age"))?parseFloat(p):null);return p},G}(),gd=function(){function G(p){this.context=this.controller=this.response=this.request=this.requestTimeout=this.fetchSetup=void 0;this.callbacks=
this.config=null;this.stats=void 0;this.loader=null;this.fetchSetup=p.fetchSetup||bi;this.controller=new self.AbortController;this.stats=new Gd.a}var z=G.prototype;return z.destroy=function(){this.loader=this.callbacks=null;this.abortInternal()},z.abortInternal=function(){var p=this.response;p&&p.ok||(this.stats.aborted=!0,this.controller.abort())},z.abort=function(){var p;this.abortInternal();null!==(p=this.callbacks)&&void 0!==p&&p.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},
z.load=function(p,n,k){var q=this,u=this.stats;if(u.loading.start)throw Error("Loader can only be used once.");u.loading.start=self.performance.now();var B=function(ja,ya){ya={method:"GET",mode:"cors",credentials:"same-origin",signal:ya,headers:new self.Headers(Pd({},ja.headers))};ja.rangeEnd&&ya.headers.set("Range","bytes="+ja.rangeStart+"-"+String(ja.rangeEnd-1));return ya}(p,this.controller.signal),F=k.onProgress,K="arraybuffer"===p.responseType,Z=K?"byteLength":"length";this.context=p;this.config=
n;this.callbacks=k;this.request=this.fetchSetup(p,B);self.clearTimeout(this.requestTimeout);this.requestTimeout=self.setTimeout(function(){q.abortInternal();k.onTimeout(u,p,q.response)},n.timeout);self.fetch(this.request).then(function(ja){if(q.response=q.loader=ja,!ja.ok)throw new Hd(ja.statusText||"fetch, bad network response",ja.status,ja);return u.loading.first=Math.max(self.performance.now(),u.loading.start),u.total=parseInt(ja.headers.get("Content-Length")||"0"),F&&Object(Zb.a)(n.highWaterMark)?
q.loadProgressively(ja,u,p,n.highWaterMark,F):K?ja.arrayBuffer():ja.text()}).then(function(ja){var ya=q.response;self.clearTimeout(q.requestTimeout);u.loading.end=Math.max(self.performance.now(),u.loading.first);u.loaded=u.total=ja[Z];var Xa={url:ya.url,data:ja};F&&!Object(Zb.a)(n.highWaterMark)&&F(u,p,ja,ya);k.onSuccess(Xa,u,p,ya)}).catch(function(ja){if(self.clearTimeout(q.requestTimeout),!u.aborted)k.onError({code:ja.code||0,text:ja.message},p,ja.details)})},z.getCacheAge=function(){var p=null;
this.response&&(p=(p=this.response.headers.get("age"))?parseFloat(p):null);return p},z.loadProgressively=function(p,n,k,q,u){void 0===q&&(q=0);var B=new Zf.a,F=p.body.getReader();return function Z(){return F.read().then(function(ja){if(ja.done)return B.dataLength&&u(n,k,B.flush(),p),Promise.resolve(new ArrayBuffer(0));ja=ja.value;var ya=ja.length;return n.loaded+=ya,ya<q||B.dataLength?(B.push(ja),B.dataLength>=q&&u(n,k,B.flush(),p)):u(n,k,ja,p),Z()}).catch(function(){return Promise.reject()})}()},
G}(),Hd=function(G){function z(p,n,k){var q;return(q=G.call(this,p)||this).code=void 0,q.details=void 0,q.code=n,q.details=k,q}return z.prototype=Object.create(G.prototype),z.prototype.constructor=z,Lc(z,G),z}(le(Error)),Id=/\s/,Zd=Gg(Gg({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6E7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,
maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1E4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1E3,manifestLoadingMaxRetryTimeout:64E3,startLevel:void 0,levelLoadingTimeOut:1E4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1E3,levelLoadingMaxRetryTimeout:64E3,
fragLoadingTimeOut:2E4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1E3,fragLoadingMaxRetryTimeout:64E3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5E3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:kd,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:qi,bufferController:Tc,capLevelController:xf,fpsController:$e,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,
abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5E5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:Xg,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0},{cueHandler:{newCue:function(G,z,p,n){for(var k,q,u,B,F,K=[],Z=self.VTTCue||self.TextTrackCue,ja=0;ja<n.rows.length;ja++)if(u=!0,B=0,F="",!(k=n.rows[ja]).isEmpty()){for(var ya=
0;ya<k.chars.length;ya++)Id.test(k.chars[ya].uchar)&&u?B++:(F+=k.chars[ya].uchar,u=!1);k.cueStartTime=z;z===p&&(p+=1E-4);16<=B?B--:B++;k=F.trim().replace(/<br(?: \/)?>/gi,"\n");u=Fa(z,p,k);G&&G.cues&&G.cues.getCueById(u)||((q=new Z(z,p,k)).id=u,q.line=ja+1,q.align="left",q.position=10+Math.min(80,10*Math.floor(8*B/32)),K.push(q))}return G&&K.length&&(K.sort(function(Xa,La){return"auto"===Xa.line||"auto"===La.line?0:8<Xa.line&&8<La.line?La.line-Xa.line:Xa.line-La.line}),K.forEach(function(Xa){return H(G,
Xa)})),K}},enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:Oe,subtitleTrackController:ri,timelineController:Wg,audioStreamController:rf,audioTrackController:Dd,
emeController:Yg,cmcdController:Zg}),Jd=function(){function G(k){void 0===k&&(k={});this.networkControllers=this.coreComponents=this.userConfig=this.config=void 0;this._emitter=new Rg.EventEmitter;this.cmcdController=this.emeController=this.subtitleTrackController=this.audioTrackController=this.streamController=this.levelController=this.latencyController=this.capLevelController=this.bufferController=this.abrController=this._autoLevelCapping=void 0;this.url=this._media=null;if((k.liveSyncDurationCount||
k.liveMaxLatencyDurationCount)&&(k.liveSyncDuration||k.liveMaxLatencyDuration))throw Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==k.liveMaxLatencyDurationCount&&(void 0===k.liveSyncDurationCount||k.liveMaxLatencyDurationCount<=k.liveSyncDurationCount))throw Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==k.liveMaxLatencyDuration&&
(void 0===k.liveSyncDuration||k.liveMaxLatencyDuration<=k.liveSyncDuration))throw Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');var q=this.config=Eg({},G.DefaultConfig,k);this.userConfig=k;Object(Ua.a)(q.debug);this._autoLevelCapping=-1;if(q.progressive)if(k=q.loader,k!==gd&&k!==kd)Ua.b.log("[config]: Custom loader detected, cannot enable progressive streaming"),q.progressive=!1;else{a:{if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{var u=
(new self.ReadableStream({}),!0);break a}catch(Wa){}u=!1}u&&(q.loader=gd,q.progressive=!0,q.enableSoftwareAES=!0,Ua.b.log("[config]: Progressive streaming enabled, using FetchLoader"))}k=q.bufferController;var B=q.capLevelController,F=q.fpsController;u=this.abrController=new q.abrController(this);k=this.bufferController=new k(this);B=this.capLevelController=new B(this);var K=new F(this),Z=new Mg(this),ja=new Ke(this),ya=new hi(this),Xa=this.levelController=new Ng(this);F=new ji(this);var La=this.streamController=
new Cd(this,F);B.setStreamController(La);K.setStreamController(La);this.networkControllers=Xa=[Xa,La];u=[Z,ja,u,k,B,K,ya,F];this.audioTrackController=this.createController(q.audioTrackController,null,Xa);this.createController(q.audioStreamController,F,Xa);this.subtitleTrackController=this.createController(q.subtitleTrackController,null,Xa);this.createController(q.subtitleStreamController,F,Xa);this.createController(q.timelineController,null,u);this.emeController=this.createController(q.emeController,
null,u);this.cmcdController=this.createController(q.cmcdController,null,u);this.latencyController=this.createController(Le,null,u);this.coreComponents=u}G.isSupported=function(){var k=self.MediaSource||self.WebKitMediaSource;if(k){var q=self.SourceBuffer||self.WebKitSourceBuffer;k=k&&"function"==typeof k.isTypeSupported&&k.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"');q=!q||q.prototype&&"function"==typeof q.prototype.appendBuffer&&"function"==typeof q.prototype.remove;q=!!k&&!!q}else q=
!1;return q};var z,p,n=G.prototype;return n.createController=function(k,q,u){return k?(k=q?new k(this,q):new k(this),u&&u.push(k),k):null},n.on=function(k,q,u){void 0===u&&(u=this);this._emitter.on(k,q,u)},n.once=function(k,q,u){void 0===u&&(u=this);this._emitter.once(k,q,u)},n.removeAllListeners=function(k){this._emitter.removeAllListeners(k)},n.off=function(k,q,u,B){void 0===u&&(u=this);this._emitter.off(k,q,u,B)},n.listeners=function(k){return this._emitter.listeners(k)},n.emit=function(k,q,u){return this._emitter.emit(k,
q,u)},n.trigger=function(k,q){if(this.config.debug)return this.emit(k,k,q);try{return this.emit(k,k,q)}catch(u){Ua.b.error("An internal error happened while handling event "+k+'. Error message: "'+u.message+'". Here is a stacktrace:',u),this.trigger(Y.a.ERROR,{type:hb.b.OTHER_ERROR,details:hb.a.INTERNAL_EXCEPTION,fatal:!1,event:k,error:u})}return!1},n.listenerCount=function(k){return this._emitter.listenerCount(k)},n.destroy=function(){Ua.b.log("destroy");this.trigger(Y.a.DESTROYING,void 0);this.detachMedia();
this.removeAllListeners();this._autoLevelCapping=-1;this.url=null;this.networkControllers.forEach(function(k){return k.destroy()});this.networkControllers.length=0;this.coreComponents.forEach(function(k){return k.destroy()});this.coreComponents.length=0},n.attachMedia=function(k){Ua.b.log("attachMedia");this._media=k;this.trigger(Y.a.MEDIA_ATTACHING,{media:k})},n.detachMedia=function(){Ua.b.log("detachMedia");this.trigger(Y.a.MEDIA_DETACHING,void 0);this._media=null},n.loadSource=function(k){this.stopLoad();
var q=this.media,u=this.url,B=this.url=Rf.buildAbsoluteURL(self.location.href,k,{alwaysNormalize:!0});Ua.b.log("loadSource:"+B);q&&u&&u!==B&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(q));this.trigger(Y.a.MANIFEST_LOADING,{url:k})},n.startLoad=function(k){void 0===k&&(k=-1);Ua.b.log("startLoad("+k+")");this.networkControllers.forEach(function(q){q.startLoad(k)})},n.stopLoad=function(){Ua.b.log("stopLoad");this.networkControllers.forEach(function(k){k.stopLoad()})},
n.swapAudioCodec=function(){Ua.b.log("swapAudioCodec");this.streamController.swapAudioCodec()},n.recoverMediaError=function(){Ua.b.log("recoverMediaError");var k=this._media;this.detachMedia();k&&this.attachMedia(k)},n.removeLevel=function(k,q){void 0===q&&(q=0);this.levelController.removeLevel(k,q)},p=[{key:"version",get:function(){return"1.1.3"}},{key:"Events",get:function(){return Y.a}},{key:"ErrorTypes",get:function(){return hb.b}},{key:"ErrorDetails",get:function(){return hb.a}},{key:"DefaultConfig",
get:function(){return G.defaultConfig?G.defaultConfig:Zd},set:function(k){G.defaultConfig=k}}],z=[{key:"levels",get:function(){return this.levelController.levels||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(k){Ua.b.log("set currentLevel:"+k);this.loadLevel=k;this.abrController.clearTimer();this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(k){Ua.b.log("set nextLevel:"+
k);this.levelController.manualLevel=k;this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(k){Ua.b.log("set loadLevel:"+k);this.levelController.manualLevel=k}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(k){this.levelController.nextLoadLevel=k}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(k){Ua.b.log("set firstLevel:"+
k);this.levelController.firstLevel=k}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(k){Ua.b.log("set startLevel:"+k);-1!==k&&(k=Math.max(k,this.minAutoLevel));this.levelController.startLevel=k}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(k){k=!!k;k!==this.config.capLevelToPlayerSize&&(k?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),
this.config.capLevelToPlayerSize=k)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(k){this._autoLevelCapping!==k&&(Ua.b.log("set autoLevelCapping:"+k),this._autoLevelCapping=k)}},{key:"bandwidthEstimate",get:function(){var k=this.abrController.bwEstimator;return k?k.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",
get:function(){var k=this.levels,q=this.config.minAutoBitrate;if(!k)return 0;for(var u=k.length,B=0;B<u;B++)if(k[B].maxBitrate>q)return B;return 0}},{key:"maxAutoLevel",get:function(){var k=this.levels,q=this.autoLevelCapping;return-1===q&&k&&k.length?k.length-1:q}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(k){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,k)}},{key:"audioTracks",get:function(){var k=
this.audioTrackController;return k?k.audioTracks:[]}},{key:"audioTrack",get:function(){var k=this.audioTrackController;return k?k.audioTrack:-1},set:function(k){var q=this.audioTrackController;q&&(q.audioTrack=k)}},{key:"subtitleTracks",get:function(){var k=this.subtitleTrackController;return k?k.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var k=this.subtitleTrackController;return k?k.subtitleTrack:-1},set:function(k){var q=this.subtitleTrackController;q&&(q.subtitleTrack=k)}},{key:"media",
get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var k=this.subtitleTrackController;return!!k&&k.subtitleDisplay},set:function(k){var q=this.subtitleTrackController;q&&(q.subtitleDisplay=k)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(k){this.config.lowLatencyMode=k}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",
get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],Hg(G.prototype,z),p&&Hg(G,p),G}();Jd.defaultConfig=void 0}]).default});/*
 npm.im/iphone-inline-video */
var makeVideoPlayableInline=function(){function a(Q){function V(ta){ca=requestAnimationFrame(V);Q(ta-(za||ta));za=ta}var ca,za;this.start=function(){ca||V(0)};this.stop=function(){cancelAnimationFrame(ca);ca=null;za=0}}function e(Q,V,ca,za){function ta(Ka){!!Q[ca]===!!za&&Ka.stopImmediatePropagation();delete Q[ca]}return Q.addEventListener(V,ta,!1),ta}function h(Q,V,ca,za){function ta(Ka){ca[V]=Ka}za&&ta(Q[V]);Object.defineProperty(Q,V,{get:function(){return ca[V]},set:ta})}function m(Q,V,ca){ca.addEventListener(V,
function(){return Q.dispatchEvent(new Event(V))})}function t(Q,V){Promise.resolve().then(function(){Q.dispatchEvent(new Event(V))})}function y(Q){var V=new Audio;return m(Q,"play",V),m(Q,"playing",V),m(Q,"pause",V),V.crossOrigin=Q.crossOrigin,V.src=Q.src||Q.currentSrc||"data:",V}function C(Q,V,ca){(W||0)+200<Date.now()&&(Q[sa]=!0,W=Date.now());ca||(Q.currentTime=V);qa[++M%3]=100*V|0}function I(Q){this.video.readyState>=this.video.HAVE_FUTURE_DATA?(this.hasAudio||(this.driver.currentTime=this.video.currentTime+
Q*this.video.playbackRate/1E3,this.video.loop&&this.driver.currentTime>=this.video.duration&&(this.driver.currentTime=0)),C(this.video,this.driver.currentTime)):this.video.networkState!==this.video.NETWORK_IDLE||this.video.buffered.length||this.video.load();this.video.ended&&(delete this.video[sa],this.video.pause(!0))}function E(){var Q=this[fa];return this.webkitDisplayingFullscreen?void this[wa]():("data:"!==Q.driver.src&&Q.driver.src!==this.src&&(C(this,0,!0),Q.driver.src=this.src),void(this.paused&&
(Q.paused=!1,this.buffered.length||this.load(),Q.driver.play(),Q.updater.start(),Q.hasAudio||(t(this,"play"),Q.video.readyState>=Q.video.HAVE_ENOUGH_DATA&&t(this,"playing")))))}function H(Q){var V=this[fa];V.driver.pause();V.updater.stop();this.webkitDisplayingFullscreen&&this[U]();V.paused&&!Q||(V.paused=!0,V.hasAudio||t(this,"pause"),this.ended&&(this[sa]=!0,t(this,"ended")))}function O(Q,V){var ca=Q[fa]={};ca.paused=!0;ca.hasAudio=V;ca.video=Q;ca.updater=new a(I.bind(ca));V?ca.driver=y(Q):(Q.addEventListener("canplay",
function(){Q.paused||t(Q,"playing")}),ca.driver={src:Q.src||Q.currentSrc||"data:",muted:!0,paused:!0,pause:function(){ca.driver.paused=!0},play:function(){ca.driver.paused=!1;ca.driver.currentTime>=ca.video.duration&&C(Q,0)},get ended(){return ca.driver.currentTime>=ca.video.duration}});Q.addEventListener("emptied",function(){var za=!ca.driver.src||"data:"===ca.driver.src;ca.driver.src&&ca.driver.src!==Q.src&&(C(Q,0,!0),ca.driver.src=Q.src,za?ca.driver.play():ca.updater.stop())},!1);Q.addEventListener("webkitbeginfullscreen",
function(){Q.paused?V&&!ca.driver.buffered.length&&ca.driver.load():(Q.pause(),Q[wa]())});V&&(Q.addEventListener("webkitendfullscreen",function(){ca.driver.currentTime=Q.currentTime}),Q.addEventListener("seeking",function(){0>qa.indexOf(100*Q.currentTime|0)&&(ca.driver.currentTime=Q.currentTime)}))}function R(Q,V,ca){void 0===V&&(V=!0);void 0===ca&&(ca=!0);ca&&!T||Q[fa]||(O(Q,V),ca=Q[fa],Q[wa]=Q.play,Q[U]=Q.pause,Q.play=E,Q.pause=H,h(Q,"paused",ca.driver),h(Q,"muted",ca.driver,!0),h(Q,"playbackRate",
ca.driver,!0),h(Q,"ended",ca.driver),h(Q,"loop",ca.driver,!0),e(Q,"seeking"),e(Q,"seeked"),e(Q,"timeupdate",sa,!1),e(Q,"ended",sa,!1),Q.classList.add("IIV"),!V&&Q.autoplay&&Q.play(),"MacIntel"!==navigator.platform&&"Windows"!==navigator.platform||console.warn("iphone-inline-video is not guaranteed to work in emulated environments"))}var W,ea="undefined"==typeof Symbol?function(Q){return"@"+(Q||"@")+Math.random()}:Symbol,T=/iPhone|iPod/i.test(navigator.userAgent)&&void 0===document.head.style.grid,
fa=ea(),sa=ea(),wa=ea("nativeplay"),U=ea("nativepause"),qa=[],M=0;return R.isWhitelisted=T,R}();var _Group=function(){this._tweens={};this._tweensAddedDuringUpdate={}};
_Group.prototype={getAll:function(){return Object.keys(this._tweens).map(function(a){return this._tweens[a]}.bind(this))},removeAll:function(){this._tweens={}},add:function(a){this._tweens[a.getId()]=a;this._tweensAddedDuringUpdate[a.getId()]=a},remove:function(a){delete this._tweens[a.getId()];delete this._tweensAddedDuringUpdate[a.getId()]},update:function(a,e){var h=Object.keys(this._tweens);if(0===h.length)return!1;for(a=void 0!==a?a:TWEEN.now();0<h.length;){this._tweensAddedDuringUpdate={};for(var m=
0;m<h.length;m++){var t=this._tweens[h[m]];t&&!1===t.update(a)&&(t._isPlaying=!1,e||delete this._tweens[h[m]])}h=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var TWEEN=new _Group;TWEEN.Group=_Group;TWEEN._nextId=0;TWEEN.nextId=function(){return TWEEN._nextId++};
TWEEN.now="undefined"===typeof self&&"undefined"!==typeof process&&process.hrtime?function(){var a=process.hrtime();return 1E3*a[0]+a[1]/1E6}:"undefined"!==typeof self&&void 0!==self.performance&&void 0!==self.performance.now?self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()};
TWEEN.Tween=function(a,e){this._isPaused=!1;this._pauseStart=null;this._object=a;this._valuesStart={};this._valuesEnd={};this._valuesStartRepeat={};this._duration=1E3;this._repeat=0;this._repeatDelayTime=void 0;this._reversed=this._isPlaying=this._yoyo=!1;this._delayTime=0;this._startTime=null;this._easingFunction=TWEEN.Easing.Linear.None;this._interpolationFunction=TWEEN.Interpolation.Linear;this._chainedTweens=[];this._onStartCallback=null;this._onStartCallbackFired=!1;this._onStopCallback=this._onCompleteCallback=
this._onRepeatCallback=this._onUpdateCallback=null;this._group=e||TWEEN;this._id=TWEEN.nextId()};
TWEEN.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},isPaused:function(){return this._isPaused},to:function(a,e){this._valuesEnd=Object.create(a);void 0!==e&&(this._duration=e);return this},duration:function(a){this._duration=a;return this},start:function(a){this._group.add(this);this._isPlaying=!0;this._onStartCallbackFired=this._isPaused=!1;this._startTime=void 0!==a?"string"===typeof a?TWEEN.now()+parseFloat(a):a:TWEEN.now();this._startTime+=this._delayTime;
for(var e in this._valuesEnd){if(this._valuesEnd[e]instanceof Array){if(0===this._valuesEnd[e].length)continue;this._valuesEnd[e]=[this._object[e]].concat(this._valuesEnd[e])}void 0!==this._object[e]&&("undefined"===typeof this._valuesStart[e]&&(this._valuesStart[e]=this._object[e]),!1===this._valuesStart[e]instanceof Array&&(this._valuesStart[e]*=1),this._valuesStartRepeat[e]=this._valuesStart[e]||0)}return this},stop:function(){if(!this._isPlaying)return this;this._group.remove(this);this._isPaused=
this._isPlaying=!1;null!==this._onStopCallback&&this._onStopCallback(this._object);this.stopChainedTweens();return this},end:function(){this.update(Infinity);return this},pause:function(a){if(this._isPaused||!this._isPlaying)return this;this._isPaused=!0;this._pauseStart=void 0===a?TWEEN.now():a;this._group.remove(this);return this},resume:function(a){if(!this._isPaused||!this._isPlaying)return this;this._isPaused=!1;this._startTime+=(void 0===a?TWEEN.now():a)-this._pauseStart;this._pauseStart=0;
this._group.add(this);return this},stopChainedTweens:function(){for(var a=0,e=this._chainedTweens.length;a<e;a++)this._chainedTweens[a].stop()},group:function(a){this._group=a;return this},delay:function(a){this._delayTime=a;return this},repeat:function(a){this._repeat=a;return this},repeatDelay:function(a){this._repeatDelayTime=a;return this},yoyo:function(a){this._yoyo=a;return this},easing:function(a){this._easingFunction=a;return this},interpolation:function(a){this._interpolationFunction=a;return this},
chain:function(){this._chainedTweens=arguments;return this},onStart:function(a){this._onStartCallback=a;return this},onUpdate:function(a){this._onUpdateCallback=a;return this},onRepeat:function(a){this._onRepeatCallback=a;return this},onComplete:function(a){this._onCompleteCallback=a;return this},onStop:function(a){this._onStopCallback=a;return this},update:function(a){var e;if(a<this._startTime)return!0;!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),
this._onStartCallbackFired=!0);var h=(a-this._startTime)/this._duration;h=0===this._duration||1<h?1:h;var m=this._easingFunction(h);for(e in this._valuesEnd)if(void 0!==this._valuesStart[e]){var t=this._valuesStart[e]||0,y=this._valuesEnd[e];y instanceof Array?this._object[e]=this._interpolationFunction(y,m):("string"===typeof y&&(y="+"===y.charAt(0)||"-"===y.charAt(0)?t+parseFloat(y):parseFloat(y)),"number"===typeof y&&(this._object[e]=t+(y-t)*m))}null!==this._onUpdateCallback&&this._onUpdateCallback(this._object,
h);if(1===h)if(0<this._repeat){isFinite(this._repeat)&&this._repeat--;for(e in this._valuesStartRepeat)"string"===typeof this._valuesEnd[e]&&(this._valuesStartRepeat[e]+=parseFloat(this._valuesEnd[e])),this._yoyo&&(h=this._valuesStartRepeat[e],this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=h),this._valuesStart[e]=this._valuesStartRepeat[e];this._yoyo&&(this._reversed=!this._reversed);this._startTime=void 0!==this._repeatDelayTime?a+this._repeatDelayTime:a+this._delayTime;null!==
this._onRepeatCallback&&this._onRepeatCallback(this._object)}else{null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);a=0;for(e=this._chainedTweens.length;a<e;a++)this._chainedTweens[a].start(this._startTime+this._duration);return!1}return!0}};
TWEEN.Easing={Linear:{None:function(a){return a}},Quadratic:{In:function(a){return a*a},Out:function(a){return a*(2-a)},InOut:function(a){return 1>(a*=2)?.5*a*a:-.5*(--a*(a-2)-1)}},Cubic:{In:function(a){return a*a*a},Out:function(a){return--a*a*a+1},InOut:function(a){return 1>(a*=2)?.5*a*a*a:.5*((a-=2)*a*a+2)}},Quartic:{In:function(a){return a*a*a*a},Out:function(a){return 1- --a*a*a*a},InOut:function(a){return 1>(a*=2)?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)}},Quintic:{In:function(a){return a*a*a*a*a},Out:function(a){return--a*
a*a*a*a+1},InOut:function(a){return 1>(a*=2)?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)}},Sinusoidal:{In:function(a){return 1-Math.cos(a*Math.PI/2)},Out:function(a){return Math.sin(a*Math.PI/2)},InOut:function(a){return.5*(1-Math.cos(Math.PI*a))}},Exponential:{In:function(a){return 0===a?0:Math.pow(1024,a-1)},Out:function(a){return 1===a?1:1-Math.pow(2,-10*a)},InOut:function(a){return 0===a?0:1===a?1:1>(a*=2)?.5*Math.pow(1024,a-1):.5*(-Math.pow(2,-10*(a-1))+2)}},Circular:{In:function(a){return 1-Math.sqrt(1-
a*a)},Out:function(a){return Math.sqrt(1- --a*a)},InOut:function(a){return 1>(a*=2)?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)}},Elastic:{In:function(a){return 0===a?0:1===a?1:-Math.pow(2,10*(a-1))*Math.sin(5*(a-1.1)*Math.PI)},Out:function(a){return 0===a?0:1===a?1:Math.pow(2,-10*a)*Math.sin(5*(a-.1)*Math.PI)+1},InOut:function(a){if(0===a)return 0;if(1===a)return 1;a*=2;return 1>a?-.5*Math.pow(2,10*(a-1))*Math.sin(5*(a-1.1)*Math.PI):.5*Math.pow(2,-10*(a-1))*Math.sin(5*(a-1.1)*Math.PI)+
1}},Back:{In:function(a){return a*a*(2.70158*a-1.70158)},Out:function(a){return--a*a*(2.70158*a+1.70158)+1},InOut:function(a){return 1>(a*=2)?.5*a*a*(3.5949095*a-2.5949095):.5*((a-=2)*a*(3.5949095*a+2.5949095)+2)}},Bounce:{In:function(a){return 1-TWEEN.Easing.Bounce.Out(1-a)},Out:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},InOut:function(a){return.5>a?.5*TWEEN.Easing.Bounce.In(2*a):.5*TWEEN.Easing.Bounce.Out(2*
a-1)+.5}}};
TWEEN.Interpolation={Linear:function(a,e){var h=a.length-1,m=h*e,t=Math.floor(m),y=TWEEN.Interpolation.Utils.Linear;return 0>e?y(a[0],a[1],m):1<e?y(a[h],a[h-1],h-m):y(a[t],a[t+1>h?h:t+1],m-t)},Bezier:function(a,e){for(var h=0,m=a.length-1,t=Math.pow,y=TWEEN.Interpolation.Utils.Bernstein,C=0;C<=m;C++)h+=t(1-e,m-C)*t(e,C)*a[C]*y(m,C);return h},CatmullRom:function(a,e){var h=a.length-1,m=h*e,t=Math.floor(m),y=TWEEN.Interpolation.Utils.CatmullRom;return a[0]===a[h]?(0>e&&(t=Math.floor(m=h*(1+e))),y(a[(t-
1+h)%h],a[t],a[(t+1)%h],a[(t+2)%h],m-t)):0>e?a[0]-(y(a[0],a[0],a[1],a[1],-m)-a[0]):1<e?a[h]-(y(a[h],a[h],a[h-1],a[h-1],m-h)-a[h]):y(a[t?t-1:0],a[t],a[h<t+1?h:t+1],a[h<t+2?h:t+2],m-t)},Utils:{Linear:function(a,e,h){return(e-a)*h+a},Bernstein:function(a,e){var h=TWEEN.Interpolation.Utils.Factorial;return h(a)/h(e)/h(a-e)},Factorial:function(){var a=[1];return function(e){var h=1;if(a[e])return a[e];for(var m=e;1<m;m--)h*=m;return a[e]=h}}(),CatmullRom:function(a,e,h,m,t){a=.5*(h-a);m=.5*(m-e);var y=
t*t;return(2*e-2*h+a+m)*t*y+(-3*e+3*h-2*a-m)*y+a*t+e}}};(function(a){"function"===typeof define&&define.amd?define([],function(){return TWEEN}):"undefined"!==typeof module&&"object"===typeof exports?module.exports=TWEEN:void 0!==a&&(a.TWEEN=TWEEN)})(this);class AnimDataUtils{static fromData(a){return"undefined"==typeof a.speed?SphereAnimationData.fromObject(a):GLTFAnimationData.fromObject(a)}static copy(a){if(!a)return{};let e={};for(let h in a)e[h]=a[h];return e}static vectorDataHasValues(a,e){if(e)return!0;for(e=0;e<a.length;++e)if(null!==a[e])return!0;return!1}static set3DVectorData(a){let e=["x","y","z"],h={};for(let m=0;m<a.length;++m)null!=a[m]&&(h[e[m]]=a[m]);return h}static isRelative(a){for(let e in a){let h=a[e];if("string"==typeof h&&("-"==
h[0]||"+"==h[0]))return!0}return!1}static overwrite3DData(a,e){a.x=null!=e.x?e.x:a.x;a.y=null!=e.y?e.y:a.y;a.z=null!=e.z?e.z:a.z}static overwriteGlowData(a,e){a.r=null!=e.r?e.r:a.r;a.g=null!=e.g?e.g:a.g;a.b=null!=e.b?e.b:a.b;a.a=null!=e.a?e.a:a.a}}
class AnimEffectRefData{constructor(){this.gltfAnims={};this._positionAfterAnim={};this._rotationAfterAnim={};this._quaternionAfterAnim={};this._scaleAfterAnim={};this._colorAfterAnim={};this._hasAlphaChangePending=this._hasColorChangePending=this._hasScaleChangePending=this._hasQuaternionChangePending=this._hasRotationChangePending=this._hasPositionChangePending=!1}set position(a){this._hasPositionChangePending=!0;AnimDataUtils.overwrite3DData(this._positionAfterAnim,a)}set rotation(a){this._hasRotationChangePending=
!0;AnimDataUtils.overwrite3DData(this._rotationAfterAnim,a)}set quaternion(a){this._hasQuaternionChangePending=!0;AnimDataUtils.overwrite3DData(this._quaternionAfterAnim,a)}set scale(a){this._hasScaleChangePending=!0;AnimDataUtils.overwrite3DData(this._scaleAfterAnim,a)}set color(a){this._hasColorChangePending=!0;AnimDataUtils.overwriteGlowData(this._colorAfterAnim,a)}set alpha(a){this._hasAlphaChangePending=!0;this._alphaAfterAnim=a}get position(){return this._hasPositionChangePending?this._positionAfterAnim:
null}get rotation(){return this._hasRotationChangePending?this._rotationAfterAnim:null}get quaternion(){return this._hasQuaternionChangePending?this._quaternionAfterAnim:null}get scale(){return this._hasScaleChangePending?this._scaleAfterAnim:null}get color(){return this._hasColorChangePending?this._colorAfterAnim:null}get alpha(){return this._hasAlphaChangePending?this._alphaAfterAnim:null}}
class RefHolder{constructor(){if(null!=RefHolder._inst)throw Error("This class is a singleton");this._elementsRef={}}getRef(a){return this._elementsRef[a]}forEach(a,e){for(let h in this._elementsRef)if(a(this._elementsRef[h])&&e)break}}
class AnimEffectRefHolder extends RefHolder{static get inst(){return this._inst||(this._inst=new AnimEffectRefHolder)}add(a){let e=new AnimEffectRefData;e.targetId=a;return this._elementsRef[a]=e}getAlphaRef(a){let e;return(e=AnimEffectRefHolder.inst.getRef(a))&&null!=e.alpha?e.alpha:null}extract(a){let e=this._elementsRef[a];delete this._elementsRef[a];return e}}class ImplicableRefData{}
class ElementRefData extends ImplicableRefData{constructor(){super(...arguments);this._changeTimeInProgress=this._changeStateInProgress=this._changeAspectInProgress=!1;this._animEnded="";this._animChangesInProgress={};this._previousAnimStates={};this._currentAnimPlaybacks={}}setFromChangeList(a){a.state&&(this.currentStateId=a.state);a.aspect&&(this.currentAspectId=a.aspect);a.time&&(this.seekTo=a.time);if(a.anims)for(let e in a.anims)this.setAnim(e,a.anims[e])}get changeAspectInProgress(){return this._changeAspectInProgress}get changeStateInProgress(){return this._changeStateInProgress}removeInProgressFlag(){this._changeTimeInProgress=
this._changeStateInProgress=this._changeAspectInProgress=!1;this._animChangesInProgress={};this._previousAnimStates={}}get currentAspectId(){return this._currentAspectId}set currentAspectId(a){this._currentAspectId!=a&&(this._currentAspectId=a,this._changeAspectInProgress=!0,ElementsRefHolder.inst.hasAChangeInProgress=!0)}get currentStateId(){return this._currentStateId}set currentStateId(a){this._currentStateId!=a&&(this._currentStateId=a,this._changeStateInProgress=!0,ElementsRefHolder.inst.hasAChangeInProgress=
!0)}get seekTime(){return this._time}set seekTo(a){this._time=a;this._changeTimeInProgress=!0}get animEnded(){return this._animEnded}set animEnd(a){this._animEnded=a}get animPlaybackStates(){return this._currentAnimPlaybacks}get animChangesInProgress(){return this._animChangesInProgress}setAnim(a,e){this._animChangesInProgress[a]=!0;this._previousAnimStates[a]=this._currentAnimPlaybacks[a];this._currentAnimPlaybacks[a]=e}animChangeCancelled(a){this._previousAnimStates[a]&&(this._currentAnimPlaybacks[a]=
this._previousAnimStates[a])}}class ImplicationChangeRefHolder extends RefHolder{constructor(){super(...arguments);this.hasAChangeInProgress=this.callStackExceeded=!1}allPending(){this.hasAChangeInProgress=this.callStackExceeded=!1;this.forEach(a=>{a.removeInProgressFlag()})}}
class ElementsRefHolder extends ImplicationChangeRefHolder{constructor(){super();this.uuid=UUID.generate();Notifier.subscribe(this,StatefulCommand.STATEFUL_ELEMENT_CHANGE)}static get inst(){return this._inst||(this._inst=new ElementsRefHolder)}notify(a,e){var h;for(let m in e)null===(h=this._elementsRef[m])||void 0===h?void 0:h.setFromChangeList(e[m])}add(a,e){if(!this._elementsRef[a.uuid]||e){e=new ElementRefData;e.elementId=a.uuid;e.currentAspectId=a.defaultAspectUUID;e.currentStateId=a.defaultStateUUID;
e.removeInProgressFlag();if(a.animations)for(var h=0;h<a.animations.length;++h)e.animPlaybackStates[a.animations[h].uuid]=StatePlaybackType.RESET;if(a.items)for(h=0;h<a.items.length;++h)this.add(a.items[h]);this._elementsRef[e.elementId]=e}}init(a){this._elementsRef={};a.scenes.forEach(e=>{var h;(null===(h=e.elements)||void 0===h?0:h.length)&&e.elements.forEach(m=>this.add(m))});this.hasAChangeInProgress=!1}}var StatementTrigger;
(function(a){a[a.INIT=-1]="INIT";a[a.NONE=0]="NONE";a[a.CLICK=1]="CLICK";a[a.MEDIA_END=2]="MEDIA_END";a[a.ASPECT=3]="ASPECT";a[a.STATE=4]="STATE";a[a.CHANGE_SCENE=5]="CHANGE_SCENE";a[a.TIME=6]="TIME";a[a.SCORM=7]="SCORM";a[a.SCORM_END=8]="SCORM_END";a[a.ANIM=9]="ANIM";a[a.ANIM_END=10]="ANIM_END";a[a.URL_TAB=11]="URL_TAB";a[a.URL_POPUP=12]="URL_POPUP";a[a.VOICE_RECOGNIZE=13]="VOICE_RECOGNIZE";a[a.PHYSIC_DROP=14]="PHYSIC_DROP";a[a.PHYSIC_DROP_FAIL=15]="PHYSIC_DROP_FAIL";a[a.DEVICE_TYPE=16]="DEVICE_TYPE";
a[a.STORYLINE=17]="STORYLINE";a[a.VR_EXIT=18]="VR_EXIT";a[a.ASSIGN=19]="ASSIGN";a[a.FIRST_VAR_RESULT=19]="FIRST_VAR_RESULT";a[a.ADD=20]="ADD";a[a.SUBTRACT=21]="SUBTRACT";a[a.MULTIPLY=22]="MULTIPLY";a[a.DIVIDE=23]="DIVIDE";a[a.LAST_VAR_RESULT=23]="LAST_VAR_RESULT";a[a.LESS_THAN=24]="LESS_THAN";a[a.FIRST_VAR_TRIGGER=24]="FIRST_VAR_TRIGGER";a[a.GREATER_THAN=25]="GREATER_THAN";a[a.LESS_EQUAL_TO=26]="LESS_EQUAL_TO";a[a.GREATER_EQUAL_TO=27]="GREATER_EQUAL_TO";a[a.EQUAL_TO=28]="EQUAL_TO";a[a.DIFFERENT_THAN=
29]="DIFFERENT_THAN";a[a.VAR_CHANGE=30]="VAR_CHANGE";a[a.LAST_VAR_TRIGGER=30]="LAST_VAR_TRIGGER";a[a.CHECKPOINT=31]="CHECKPOINT"})(StatementTrigger||={});var TimelineTrigger;(function(a){a[a.PLAY=0]="PLAY";a[a.PAUSE=1]="PAUSE";a[a.STOP=2]="STOP";a[a.GOTO=3]="GOTO"})(TimelineTrigger||={});var UUID;
(function(a){let e=null;a.test=function(h){return/^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$/.test(h)};a.isNull=function(h){return!h||"00000000-0000-0000-0000-000000000000"==h};a.generate=function(){if(!e){e=[];for(var h=0;16>h;h++)e[h]="0"+h.toString(16);for(h=16;256>h;h++)e[h]=h.toString(16)}h=4294967295*Math.random()|0;let m=4294967295*Math.random()|0,t=4294967295*Math.random()|0,y=4294967295*Math.random()|0;return(e[h&255]+e[h>>8&255]+e[h>>16&255]+e[h>>24&255]+
"-"+e[m&255]+e[m>>8&255]+"-"+e[m>>16&15|64]+e[m>>24&255]+"-"+e[t&63|128]+e[t>>8&255]+"-"+e[t>>16&255]+e[t>>24&255]+e[y&255]+e[y>>8&255]+e[y>>16&255]+e[y>>24&255]).toUpperCase()}})(UUID||={});
class StatementData{static fromObject(a){let e=new StatementData;e.targetUUID=a.targetUUID||a.targetUuid;e.triggerType=a.triggerType;a.triggerUUID&&(e.triggerUUID=a.triggerUUID);if(e.targetUUID&&UUID.isNull(e.targetUUID)||e.triggerUUID&&UUID.isNull(e.triggerUUID))throw Error("Export: invalid target UUID in implication "+StatementData.iteratingImplicationName+"'s "+StatementData.iteratingStatementType);null!=a.time&&(e.time=parseFloat(a.time)+1E-4);null!=a.url&&(e.url=a.url);a.context&&(e.context=
a.context,e.contextRx=new RegExp(a.context));if(null!=a.toCompare){var h=parseFloat(a.toCompare);e.toCompare=isNaN(h)?a.toCompare:h}UUID.isNull(a.toCompareWith)||(e.toCompareWith=a.toCompareWith);null!=a.editValue&&(e.editValue=a.editValue);UUID.isNull(a.editWith)||(e.editWith=a.editWith);a.triggerType==StatementTrigger.ANIM&&(h=StatePlaybackTypeConverter.run(a.animState),e.animState=null!=h?h==StatePlaybackType.PLAY_LOOP||h==StatePlaybackType.PING_PONG?StatePlaybackType.PLAY:h:StatePlaybackType.PLAY);
if(a.name){h=typeof a.value;if("string"==h)h=a.value.trim().toLowerCase(),"true"==h||"false"==h?e.value="true"==h:"vrai"==h||"faux"==h?e.value="vrai"==h:(h=h.replace(/,/g,"."),isNaN(h)?e.value=a.value:e.value=parseFloat(h));else if("number"==h||"boolean"==h)e.value=a.value;else throw Error("SCORM "+a.name+" - bad statement data");e.name=a.name}return e}}
class ImplicationData{static fromObject(a){let e=new ImplicationData;e.uuid=a.uuid;e.name=a.name;if(UUID.isNull(e.uuid))throw Error("Export: invalid implication UUID");StatementData.iteratingImplicationName=e.name;a.inputStatement&&(e.inputStatement=[],StatementData.iteratingStatementType="input",a.inputStatement.forEach(h=>{e.inputStatement.push(StatementData.fromObject(h))}));a.outputStatement&&(e.outputStatement=[],StatementData.iteratingStatementType="output",a.outputStatement.forEach(h=>{e.outputStatement.push(StatementData.fromObject(h))}));
return e}}
class ImplicationProcessedData{get elements(){return this._elements}toObject(){let a={};this._scene&&(a.scene=this._scene);this._elements&&(a.elements=this._elements);this._vars&&(a.vars=this._vars);this._checkpoints&&(a.checkpoints=Object.keys(this._checkpoints));return a}add(a,e,h,m){"var"==a?(this._vars||(this._vars={}),this._vars[e]=!0):"checkpoint"==a?(this._checkpoints||(this._checkpoints={}),this._checkpoints[e]=!0):(this._elements||(this._elements={}),this._elements[e]||(this._elements[e]={}),
"anims"==a?(this._elements[e][a]||(this._elements[e][a]={}),this._elements[e][a][h]=m):this._elements[e][a]="time"==a?m:h)}changeScene(a){this._scene||(this._scene=a)}}var VisualizationContext;(function(a){a.Computer="Computer";a.Mobile="Mobile";a.Headset="Headset";a.StaticHeadset="StaticHeadset";a.MovingHeadset="MovingHeadset"})(VisualizationContext||={});var VariableType;
(function(a){a[a.BOOLEAN=0]="BOOLEAN";a[a.NUMBER=1]="NUMBER";a[a.TEXT=2]="TEXT";a[a.ENUM=3]="ENUM";a[a.FREE_TEXT=4]="FREE_TEXT"})(VariableType||={});class VariableData{static fromObject(a){let e=new VariableData;e.uuid=a.uuid;e.type=a.type;e.name=a.name;e.value=a.value;a.currentValue&&(e.currentValue=a.currentValue);e.type==VariableType.ENUM&&(e.currentValue||(e.currentValue=[]),e.enumMap={},VarUtils.initEnum(e.enumMap,e.currentValue,e.value));return e}}
class VariableRefData extends ImplicableRefData{constructor(a){super();this._type=a.type;this._changeInProgress=!1;this._prevValue=null;this._name=a.name;this._uuid=a.uuid;this._currentValue=a.enumMap?a.enumMap:a.currentValue?a.currentValue:a.value}removeInProgressFlag(){this._changeInProgress=!1}get changeInProgress(){return this._changeInProgress}get type(){return this._type}get prevValue(){return this._prevValue}get currentValue(){return this._currentValue}get name(){return this._name}get uuid(){return this._uuid}set currentValue(a){this._type==
VariableType.NUMBER&&(this._prevValue=this._currentValue);this._currentValue=a;this._changeInProgress=!0;VariableRefHolder.inst.hasAChangeInProgress=!0}}var VarUtils;
(function(a){function e(E,H,O){let R=E.currentValue,W=E.type;if(O>=StatementTrigger.EQUAL_TO){if(W==VariableType.ENUM){if("string"==typeof H)return m(R[H],O);E={};C(E,H,H);return m(!h(E,R),O)}return m(R==H,O)}return"number"==typeof R&&"number"==typeof H?t(R,H,O)&&!(I&&t(E.prevValue,H,O)):!1}function h(E,H){for(let O in E)if(E[O]&&!H[O])return!0;return!1}function m(E,H){switch(H){case StatementTrigger.EQUAL_TO:return E;case StatementTrigger.DIFFERENT_THAN:return!E}return!1}function t(E,H,O){switch(O){case StatementTrigger.LESS_THAN:return E<
H;case StatementTrigger.GREATER_THAN:return E>H;case StatementTrigger.LESS_EQUAL_TO:return E<=H;case StatementTrigger.GREATER_EQUAL_TO:return E>=H}return!1}function y(E){var H=VariableRefHolder.inst.getRef(E.targetUUID);if(H){if(E.editWith){var O=VariableRefHolder.inst.getRef(E.editWith);if(!O||O.type!=H.type)return;E.editValue=O.currentValue}if(H.type!=VariableType.ENUM){a:{O=H.currentValue;var R=H.type,W=E.triggerType;E=E.editValue;if(H.type==VariableType.NUMBER){if(isNaN(E)){H=void 0;break a}E=
parseFloat(E)}if(W==StatementTrigger.ASSIGN){if(O==E){H=void 0;break a}H.currentValue=R==VariableType.TEXT?[E]:E}if(R!=VariableType.BOOLEAN)if(W==StatementTrigger.ADD)H.currentValue=O+E;else if(R==VariableType.NUMBER&&"number"==typeof O&&"number"==typeof E)switch(W){case StatementTrigger.SUBTRACT:H.currentValue=O-E;break;case StatementTrigger.MULTIPLY:H.currentValue=O*E;break;case StatementTrigger.DIVIDE:0==E&&console.info("You enabled quantum mode by dividing by 0. Congratulations!"),H.currentValue=
O/E}H=void 0}return H}O=H.currentValue;switch(E.triggerType){case StatementTrigger.ASSIGN:C(O,E.editValue);H.currentValue=O;break;case StatementTrigger.ADD:case StatementTrigger.SUBTRACT:R=E.triggerType==StatementTrigger.ADD;E=E.editValue;W=!1;for(let T=0;T<E.length;++T){var ea=E[T];"undefined"==typeof O[ea]||R==O[ea]?ea=!1:(O[ea]=R,ea=!0);ea&&(W=!0)}W&&(H.currentValue=O)}}}function C(E,H,O){if(O)for(var R=0;R<O.length;++R)E[O[R]]=!1;else for(R in E)E[R]=!1;for(O=0;O<H.length;++O)"undefined"!=typeof E[H[O]]&&
(E[H[O]]=!0)}let I=!1;a.inStatementIsVar=function(E){return StatementTrigger.FIRST_VAR_TRIGGER<=E&&E<=StatementTrigger.LAST_VAR_TRIGGER};a.outStatementIsVar=function(E){return StatementTrigger.FIRST_VAR_RESULT<=E&&E<=StatementTrigger.LAST_VAR_RESULT};a.inStatementChecksOut=function(E,H,O){if(!H)return!1;if(E.triggerType==StatementTrigger.VAR_CHANGE)return H.changeInProgress;O&&(I=!0);if(E.toCompareWith)a:if(O=VariableRefHolder.inst.getRef(E.toCompareWith),E=E.triggerType,O)switch(H.type){case VariableType.TEXT:E=
m(H.currentValue[0]==O.currentValue[0],E);break a;case VariableType.ENUM:H=H.currentValue;O=O.currentValue;H=h(H,O)||h(O,H);E=m(!H,E);break a;default:E=e(H,O.currentValue,E)}else E=!1;else E=e(H,E.toCompare,E.triggerType);I=!1;return E};a.applyOutStatement=y;a.setVar=function(E,H,O){let R=new StatementData;E=VariableRefHolder.inst.getRefByName(E);if(!E)return!1;R.targetUUID=E.uuid;R.editValue=H;R.triggerType=StatementTrigger.ASSIGN;y(R);return O[R.targetUUID]=!0};a.initEnum=C})(VarUtils||={});
class VariableRefHolder extends ImplicationChangeRefHolder{constructor(){super();this._nameIndex={}}static get inst(){return this._inst||(this._inst=new VariableRefHolder)}init(a){for(let e=0;e<a.length;++e)this.add(a[e]);this.hasAChangeInProgress=!1}add(a,e){this._elementsRef[a.uuid]||(this._elementsRef[a.uuid]=new VariableRefData(a));e||="";this._nameIndex[e+a.name]=a.uuid}getRefByName(a,e){e||="";return this.getRef(this._nameIndex[e+a])||this.getRef(this._nameIndex[a])}}var ImplicationUtils;
(function(a){function e(h){if(h&&h.length){var m=new ImplicationProcessedData;for(let I=0;I<h.length;++I)a:{var t=h[I].name,y=h[I].outputStatement,C=m;for(let E=0;E<y.length;++E){let H=y[E],O=H.triggerType,R=ElementsRefHolder.inst.getRef(H.targetUUID);if(O==StatementTrigger.ASPECT)R.currentAspectId!=H.triggerUUID&&C.add("aspect",R.elementId,H.triggerUUID);else if(O==StatementTrigger.STATE)R.currentStateId!=H.triggerUUID&&C.add("state",R.elementId,H.triggerUUID);else if(O==StatementTrigger.TIME){if("undefined"==
typeof H.time)break a;C.add("time",R.elementId,"",H.time)}else O==StatementTrigger.ANIM?R.animPlaybackStates[H.triggerUUID]!==H.animState&&C.add("anims",R.elementId,H.triggerUUID,H.animState):O==StatementTrigger.CHANGE_SCENE?(C.changeScene(H.triggerUUID),Notifier.unleash(ImplicationCommand.CHANGE_SCENE,H.triggerUUID)):VarUtils.outStatementIsVar(O)?(VarUtils.applyOutStatement(H),VariableRefHolder.inst.getRef(H.targetUUID).changeInProgress&&C.add("var",H.targetUUID,"")):O==StatementTrigger.CHECKPOINT?
C.add("checkpoint",H.targetUUID):O==StatementTrigger.VR_EXIT?Notifier.unleash(ImplicationCommand.VR_EXIT):O==StatementTrigger.URL_POPUP||O==StatementTrigger.URL_TAB?H.url&&Notifier.unleash(ImplicationCommand.PROCESS_URL,H):O==StatementTrigger.STORYLINE?Notifier.unleash(ImplicationCommand.SET_STORYLINE_VAR,H):(O==StatementTrigger.SCORM||O==StatementTrigger.SCORM_END)&&Notifier.unleash(ImplicationCommand.MANAGE_TRACKING,{implicationName:t,statement:H})}}m=m.toObject();m.elements&&Notifier.unleash(StatefulCommand.STATEFUL_ELEMENT_CHANGE,
m.elements);m.vars&&Notifier.unleash(StatefulCommand.VARIABLE_CHANGED,m.vars);m.checkpoints&&Notifier.unleash(StatefulCommand.CHECKPOINT_TRIGGERED,m.checkpoints);Notifier.unleash(ImplicationCommand.RAW_TRACKING_INTERACTION,h);return m}}a.searchForTrigger=function(h,m){if(!m)return!1;for(let t=0;t<m.length;++t){let y=m[t].inputStatement;for(let C=0;C<y.length;++C)if(h==y[C].triggerType)return!0}return!1};a.triggerFullRun=function(h,m){if(m&&m.length){var t=[];for(let O=0;O<m.length;O++){let R=m[O];
b:{var y=R;var C=h;C||(C=StatementTrigger.NONE);let W=!1,ea=!1,T=!1,fa=!0,sa={name:y.name,value:!1};for(let wa=0;wa<y.inputStatement.length;++wa){let U=y.inputStatement[wa];var I=null,E=null;let qa=U.triggerType;StatementTrigger.FIRST_VAR_TRIGGER<=qa&&qa<=StatementTrigger.LAST_VAR_TRIGGER?I=VariableRefHolder.inst.getRef(U.targetUUID):E=ElementsRefHolder.inst.getRef(U.targetUUID);if(!I&&!E&&U.triggerType!=StatementTrigger.DEVICE_TYPE){y=sa;break b}W||=C>StatementTrigger.NONE&&(C==StatementTrigger.CLICK&&
U.triggerType==StatementTrigger.CLICK||C==StatementTrigger.ANIM_END&&U.triggerType==StatementTrigger.ANIM_END||C==StatementTrigger.MEDIA_END&&U.triggerType==StatementTrigger.MEDIA_END||C==StatementTrigger.VOICE_RECOGNIZE&&U.triggerType==StatementTrigger.VOICE_RECOGNIZE||C==StatementTrigger.PHYSIC_DROP&&U.triggerType==StatementTrigger.PHYSIC_DROP||C==StatementTrigger.PHYSIC_DROP_FAIL&&U.triggerType==StatementTrigger.PHYSIC_DROP_FAIL);if(qa==StatementTrigger.STATE)E.changeStateInProgress&&(T=!0),E.currentStateId!=
U.triggerUUID&&(fa=!1);else if(qa==StatementTrigger.ASPECT)E.changeAspectInProgress&&(T=!0),E.currentAspectId!=U.triggerUUID&&(fa=!1);else if(qa==StatementTrigger.DEVICE_TYPE)U.contextRx.test(a.CONTEXT)||(fa=!1);else if(qa==StatementTrigger.ANIM)(I=E.animPlaybackStates[U.triggerUUID]==U.animState)&&E.animChangesInProgress[U.triggerUUID]&&(T=!0),I||(fa=!1);else if(VarUtils.inStatementIsVar(qa)){I.changeInProgress&&(T=!0);if(E=T&&1==y.inputStatement.length)ea=W=!0,sa.trigger=qa;VarUtils.inStatementChecksOut(U,
I,E)||(fa=!1)}else if(qa==StatementTrigger.ANIM_END&&E.animEnded&&E.animEnded==U.triggerUUID||qa==StatementTrigger.CLICK||qa==StatementTrigger.MEDIA_END||qa==StatementTrigger.VOICE_RECOGNIZE||qa==StatementTrigger.PHYSIC_DROP||qa==StatementTrigger.PHYSIC_DROP_FAIL)ea=!0,sa.trigger=qa}sa.value=ea&&W&&fa||!ea&&!W&&fa&&T;y=sa}y.value&&(t.push(R),Notifier.unleash(ImplicationCommand.ON_TRACKING_INTERACTION,y))}h=t}else h=[];let H;try{0==ElementsRefHolder.inst.callStackExceeded&&(H=e(h))}catch(O){ElementsRefHolder.inst.callStackExceeded=
!0,console.error(O.message,O.stack)}return H};a.fastFulfillsItsStartConditions=function(h){for(let m=0;m<h.length;++m){let t=h[m];if(VarUtils.inStatementIsVar(t.triggerType)&&!VarUtils.inStatementChecksOut(t,VariableRefHolder.inst.getRef(t.targetUUID)))return!1;let y=ElementsRefHolder.inst.getRef(t.targetUUID);switch(t.triggerType){case StatementTrigger.STATE:if(y.currentStateId!=t.triggerUUID)return!1;break;case StatementTrigger.ASPECT:if(y.currentAspectId!=t.triggerUUID)return!1;break;case StatementTrigger.DEVICE_TYPE:if(!t.contextRx.test(a.CONTEXT))return!1;
break;case StatementTrigger.ANIM:if(y.animPlaybackStates[t.triggerUUID]!=t.animState)return!1}}return!0};a.processImplications=e})(ImplicationUtils||={});class Vector2{constructor(a){a||=0;this.y=this.x=a}}class Vector3{constructor(a){a||=0;this.z=this.y=this.x=a}}var GeometryUtils;
(function(a){a.degToRad=function(e){return e*Math.PI/180};a.arrayToVector=function(e){let h;for(let m=0;m<e.length;++m)if(isNaN(e[m]))return null;2==e.length?h=new Vector2:3==e.length&&(h=new Vector3,h.z=parseFloat(e[2]));h.x=parseFloat(e[0]);h.y=parseFloat(e[1]);return h}})(GeometryUtils||={});var FadeType;(function(a){a[a.BLACK=1]="BLACK";a[a.BLOOM=2]="BLOOM";a[a.WHITE=3]="WHITE";a[a.COLOR=4]="COLOR"})(FadeType||={});var FadeAction;
(function(a){a[a.NONE=0]="NONE";a[a.HIDE=1]="HIDE";a[a.SHOW=2]="SHOW"})(FadeAction||={});var ShapeType;(function(a){a[a.RECTANGLE=0]="RECTANGLE"})(ShapeType||={});
class AbstractAspectData{constructor(){this.opacity=.001;this.volume=1;this.mute=!1;this.position=new Vector3(0);this.rotation=new Vector3(0);this.rotationOrder="ZYX";this._isRadian=!0;this.scale=new Vector3(1)}fromBaseObject(a){a.uuid&&(this.uuid=a.uuid);a.name&&(this.name=a.name);UUID.isNull(a.media)||(this.media=a.media);a.opacity&&(this.opacity=Math.min(a.opacity,.999));a.position&&(this.position=a.position);a.rotation&&(a._isRadian?(this.rotation.x=a.rotation.x,this.rotation.y=a.rotation.y,this.rotation.z=
a.rotation.z):(this.rotation.x=GeometryUtils.degToRad(a.rotation.x),this.rotation.y=GeometryUtils.degToRad(a.rotation.y),this.rotation.z=GeometryUtils.degToRad(a.rotation.z)));a.scale&&(this.scale=a.scale)}}var StatePlaybackType;(function(a){a.PLAY="PLAY";a.PLAY_LOOP="PLAY_LOOP";a.PAUSE="PAUSE";a.STOP="STOP";a.PING_PONG="PING_PONG";a.RESET="RESET"})(StatePlaybackType||={});
class StatePlaybackTypeConverter{static run(a){if("number"!==typeof a&&isNaN(parseInt(a)))if("string"===typeof a){if("PLAY"==a)return StatePlaybackType.PLAY;if("PLAY_LOOP"==a)return StatePlaybackType.PLAY_LOOP;if("PAUSE"==a)return StatePlaybackType.PAUSE;if("STOP"==a)return StatePlaybackType.STOP;if("PING_PONG"==a)return StatePlaybackType.PING_PONG;if("RESET"==a)return StatePlaybackType.RESET}else return null;else{if(0==a)return StatePlaybackType.PLAY;if(1==a)return StatePlaybackType.PLAY_LOOP;if(2==
a)return StatePlaybackType.PAUSE;if(3==a)return StatePlaybackType.STOP;if(4==a)return StatePlaybackType.PING_PONG;if(5==a)return StatePlaybackType.RESET}}}
class StateData{constructor(){this.interactive=this.visible=!1;this.playback=StatePlaybackType.STOP;this.seizable=this.selected=this.contoured=!1}static fromObject(a){let e=new StateData;a.uuid&&(e.uuid=a.uuid);a.name&&(e.name=a.name);a.visible&&(e.visible=a.visible);a.interactive&&(e.interactive=a.interactive);let h=StatePlaybackTypeConverter.run(a.playback);null!=h&&(e.playback=h);a.contoured&&(e.contoured=a.contoured);a.selected&&(e.selected=a.selected);a.seizable&&(e.seizable=a.seizable);return e}static createVisibleAndInteractiveState(){let a=
new StateData;a.uuid=UUID.generate();a.name="Visible";a.visible=!0;a.interactive=!0;a.contoured=!1;return a}}var AnimType;(function(a){a[a.SPHERE=0]="SPHERE";a[a.GLTF=1]="GLTF"})(AnimType||={});var DestinationAnimType;(function(a){a[a.GOTO=0]="GOTO";a[a.LOOK_AT=1]="LOOK_AT"})(DestinationAnimType||={});var DestinationElementType;(function(a){a[a.ELEMENT=0]="ELEMENT";a[a.ASPECT=1]="ASPECT";a[a.CAMERA=2]="CAMERA"})(DestinationElementType||={});var Interpolation;
(function(a){a[a.LINEAR=0]="LINEAR";a[a.EASE_IN=1]="EASE_IN";a[a.EASE_OUT=2]="EASE_OUT";a[a.EASE_IN_OUT=3]="EASE_IN_OUT"})(Interpolation||={});class AnimationData{constructor(){this.yoyo=!1;this._isPreParsed=!0}}
class SphereAnimationData extends AnimationData{constructor(){super(...arguments);this.type=AnimType.SPHERE;this.destinationAnimType=this.destinationElementType=null;this.destinationUuid="";this.time=1E3;this.volume=1;this.interpolation=Interpolation.LINEAR;this.loop=!1;this.repeat=0;this.isSimple=this.isRelative=!1;this.playback=StatePlaybackType.PLAY;this.hasGlowValues=this.hasOpacityValue=this.hasLookAtValues=this.hasScaleValues=this.hasRotationValues=this.hasPositionValues=this.isImmediate=this.runOnFirstFrame=
!1}copyPosition(){return AnimDataUtils.copy(this.position)}copyRotation(){return AnimDataUtils.copy(this.rotation)}copyLookAt(){return AnimDataUtils.copy(this.lookAt)}copyScale(){return AnimDataUtils.copy(this.scale)}copyColor(){return AnimDataUtils.copy(this.color)}static fromObject(a){let e=new SphereAnimationData;a.uuid&&(e.uuid=a.uuid);a.name&&(e.name=a.name);a.target&&(e.target=a.target);void 0!=a.time&&(e.time=a._isPreParsed?a.time:Math.round(1E3*a.time));"undefined"!=typeof a.volume&&(e.volume=
a.volume);"undefined"!=typeof a.opacity&&(e.opacity=Math.max(Math.min(a.opacity,.999),.001),e.hasOpacityValue=!0);a.interpolation&&(e.interpolation=a.interpolation);a.isSimple&&(e.isSimple=a.isSimple);e.isSimple&&(e.runOnFirstFrame=!0);var h;null!=(h=StatePlaybackTypeConverter.run(a.playback))&&(e.playback=h);e.loop=a.loop||e.playback&&e.playback==StatePlaybackType.PLAY_LOOP;e.loop?e.repeat=Infinity:a.repeat&&(e.repeat=a.repeat);if(a.yoyo||e.playback==StatePlaybackType.PING_PONG)e.yoyo=!0,e.loop||
a._isPreParsed||(e.repeat=2*(1+e.repeat)-1);if(!UUID.isNull(a.destinationUuid))return e.destinationUuid=a.destinationUuid,e.destinationAnimType=a.destinationAnimType,e.destinationElementType=a.destinationElementType,DestinationAnimType.GOTO==e.destinationAnimType?(e.hasPositionValues=!0,e.hasLookAtValues=!0):DestinationAnimType.LOOK_AT==e.destinationAnimType&&(e.hasLookAtValues=!0),e;a.position&&AnimDataUtils.vectorDataHasValues(a.position,a._isPreParsed)&&(e.position=a._isPreParsed?a.position:AnimDataUtils.set3DVectorData(a.position),
e.hasPositionValues=0!=Object.keys(e.position).length,e.hasPositionValues&&!e.isRelative&&(e.isRelative=AnimDataUtils.isRelative(e.position)));if(a.rotation&&AnimDataUtils.vectorDataHasValues(a.rotation,a._isPreParsed)&&(e.rotation=a._isPreParsed?a.rotation:AnimDataUtils.set3DVectorData(a.rotation),e.hasRotationValues=0!=Object.keys(e.rotation).length,e.hasRotationValues)){for(let m in e.rotation)h=a._isPreParsed?e.rotation[m]:GeometryUtils.degToRad(e.rotation[m]),e.rotation[m]="string"==typeof e.rotation[m]?
0<h?"+"+h.toString():h.toString():h;e.isRelative||(e.isRelative=AnimDataUtils.isRelative(e.rotation))}a.scale&&AnimDataUtils.vectorDataHasValues(a.scale,a._isPreParsed)&&(e.scale=a._isPreParsed?a.scale:AnimDataUtils.set3DVectorData(a.scale),e.hasScaleValues=0!=Object.keys(e.scale).length,e.hasScaleValues&&!e.isRelative&&(e.isRelative=AnimDataUtils.isRelative(e.scale)));a.lookAt&&AnimDataUtils.vectorDataHasValues(a.lookAt,a._isPreParsed)&&(e.lookAt=a._isPreParsed?a.lookAt:AnimDataUtils.set3DVectorData(a.lookAt),
e.hasLookAtValues=0!=Object.keys(e.lookAt).length);return e}}
class GLTFAnimationData extends AnimationData{constructor(){super(...arguments);this.type=AnimType.GLTF;this.targets=[];this.speed=1;this.reverse=!1;this.iterations=1}static fromObject(a){let e=new GLTFAnimationData;a.uuid&&(e.uuid=a.uuid);a.name&&(e.name=a.name);a.target&&(e.target=a.target);a.speed&&(e.speed=a.speed);a.reverse&&(e.reverse=!0);a.repeat&&(e.iterations+=a.repeat);StatePlaybackType.PLAY_LOOP==StatePlaybackTypeConverter.run(a.playback)&&(e.iterations=Infinity);a.yoyo&&(e.yoyo=a.yoyo,
a._isPreParsed||(e.iterations*=2));a.animations?e.targets="string"==typeof a.animations?[a.animations]:a.animations:a.targets&&(e.targets=a.targets);return e}}
class AssetAspectData extends AbstractAspectData{constructor(){super(...arguments);this.tileDuration=500;this.numTile=1}static fromObject(a){let e=new AssetAspectData;e.fromBaseObject(a);null!=a.tileDuration&&(e.tileDuration=a.tileDuration);null!=a.numTile&&(e.numTile=a.numTile);a.colorFilter&&(e.colorFilter=a.colorFilter,e.colorThreshold=a.colorThreshold||.55);return e}}
class AudioAspectData extends AbstractAspectData{constructor(){super(...arguments);this.volume=1}static fromObject(a){let e=new AudioAspectData;e.fromBaseObject(a);null!=a.volume&&(e.volume=Math.min(a.volume,1));a.mute&&(e.volume=0);return e}}
class VideoAspectData extends AbstractAspectData{constructor(){super(...arguments);this.preload=this.loop=!1}static fromObject(a){let e=new VideoAspectData;e.fromBaseObject(a);null!=a.loop&&(e.loop=a.loop);null!=a.volume&&(e.volume=Math.min(a.volume,1));a.mute&&(e.volume=0);a.colorFilter&&(e.colorFilter=a.colorFilter,e.colorThreshold=a.colorThreshold||.55);return e}}class ModelAspectData extends AbstractAspectData{static fromObject(a){let e=new ModelAspectData;e.fromBaseObject(a);return e}}
class TriggerAspectData extends AbstractAspectData{static fromObject(a){let e=new TriggerAspectData;e.fromBaseObject(a);a.isCircle&&(e.isCircle=a.isCircle);a.color&&(e.color=a.color);return e}}class TimelineAspectData extends AbstractAspectData{static fromObject(a){let e=new TimelineAspectData;e.fromBaseObject(a);a.color&&(e.color=a.color);a.cursorColor&&(e.cursorColor=a.cursorColor);return e}}
class TextAspectData extends AbstractAspectData{constructor(){super(...arguments);this.text="";this.color="black";this.textAlign="center";this.textDecoration="none";this.fontSize="48px";this.fontFamily="sans-serif";this.fontWeight=this.fontStyle="normal";this.border=this.spaceBetweenLines=this.padding=0;this.borderColor="black";this.borderRadius=0}static fromObject(a){let e=new TextAspectData;e.fromBaseObject(a);a.text&&(e.text=a.text);a.color&&(e.color=a.color);a.backgroundColor&&(e.backgroundColor=
a.backgroundColor);a.border&&(e.border=a.border);a.borderColor&&(e.borderColor=a.borderColor);a.borderRadius&&(e.borderRadius=a.borderRadius);a.textAlign&&(e.textAlign=a.textAlign);a.textDecoration&&(e.textDecoration=a.textDecoration);a.fontSize&&(e.fontSize=a.fontSize);a.fontFamily&&(e.fontFamily=a.fontFamily);a.fontStyle&&(e.fontStyle=a.fontStyle);a.fontWeight&&(e.fontWeight=a.fontWeight);a.padding&&(e.padding=a.padding);a.spaceBetweenLines&&(e.spaceBetweenLines=a.spaceBetweenLines);a=e.fontSize.match(/([0-9.]+)/);
e._computedFontSize=1.3888888889*parseInt(a?a[1]:e.fontSize);e._lineHeight=1.1*e._computedFontSize+e.spaceBetweenLines;e._font=e.fontStyle+" "+e.fontWeight+" "+e._computedFontSize+"px "+e.fontFamily;return e}}
class ColorAspectData extends AbstractAspectData{static fromObject(a){let e=new ColorAspectData;e.fromBaseObject(a);e.shape=ShapeType.RECTANGLE;a.color&&(e.color=a.color);a.width&&(e.width=a.width);a.height&&(e.height=a.height);if(!(ShapeType.RECTANGLE!=e.shape||a.height&&a.width))throw Error("Bad Rectangle data");return e}}
class AspectDataFactory{static getData(a,e){let h;switch(a){case StatefulElementType.GROUP:h=new AbstractAspectData;h.fromBaseObject(e);break;case StatefulElementType.TEXT:h=TextAspectData.fromObject(e);break;case StatefulElementType.SPRITE:case StatefulElementType.SPRITESHEET:h=AssetAspectData.fromObject(e);break;case StatefulElementType.SOUND:h=AudioAspectData.fromObject(e);break;case StatefulElementType.VIDEO:h=VideoAspectData.fromObject(e);break;case StatefulElementType.MESH:h=ModelAspectData.fromObject(e);
break;case StatefulElementType.TRIGGER:h=TriggerAspectData.fromObject(e);break;case StatefulElementType.COLOR:h=ColorAspectData.fromObject(e)}return h}static createVideoPlaybackAspect(){return[this.createVideoControllerAspect(SimulationData.VIDEO_PLAY_BUTTON_ID),this.createVideoControllerAspect(SimulationData.VIDEO_PAUSE_BUTTON_ID)]}static createVideoProgressBarAspect(){return[this.createTimelineAspect()]}static createVideoControllerAspect(a){let e=new AssetAspectData;e.uuid=UUID.generate();e.name=
a+" aspect";e.media=a;e.opacity=1;return e}static createTimelineAspect(){let a=new TimelineAspectData;a.uuid=UUID.generate();a.name="";a.media="";a.opacity=1;a.color="#FFFFFF";a.cursorColor="#FFCC00";a.barSize={x:17.5,y:.3};a.cursorSize={x:.2,y:.8};return a}}var StatefulElementFactory;
(function(a){function e(t,y){let C={};for(let I=0;I<t.states.length;++I){let E=t.states[I];if(!y||E.visible)switch(E.playback){case StatePlaybackType.STOP:C.stop||(C.stop=[]);C.stop.push(E.uuid);break;case StatePlaybackType.PAUSE:C.pause||(C.pause=[]);C.pause.push(E.uuid);break;case StatePlaybackType.PLAY_LOOP:if(y)break;case StatePlaybackType.PLAY:C.play||(C.play=[]),C.play.push(E.uuid)}}return C}function h(){let t=new StatefulElementData;t.uuid=UUID.generate();t.opacity=1;t.rotation=new Vector3(0);
t.scale=new Vector3(1);t.states=[StateData.createVisibleAndInteractiveState()];t.defaultStateUUID=t.states[0].uuid;return t}function m(t){let y=new StateData;y.uuid=UUID.generate();y.visible=!0;y.interactive=!0;y.contoured=!1;y.name=t;y.playback=StatePlaybackTypeConverter.run(t);return y}a.getPlayableStateIds=e;a.fillMissingPlaybackStates=function(t){let y=e(t,!0);y.play||t.states.push(m("PLAY"));y.pause||t.states.push(m("PAUSE"));y.stop||t.states.push(m("STOP"))};a.createVideoPlaybackButton=function(){let t=
h();t.type=StatefulElementType.SPRITE;t.name="Play/pause";t.position={x:-8.9,y:-6.15,z:0};t.aspects=AspectDataFactory.createVideoPlaybackAspect();t.defaultAspectUUID=t.aspects[0].uuid;return t};a.createVideoProgressBar=function(){let t=h();t.type=StatefulElementType.TIMELINE;t.name="Progress bar";t.position={x:.8,y:-6.2,z:0};t.aspects=AspectDataFactory.createVideoProgressBarAspect();t.defaultAspectUUID=t.aspects[0].uuid;return t}})(StatefulElementFactory||={});var StatefulElementType;
(function(a){a[a.SCENE=0]="SCENE";a[a.GROUP=1]="GROUP";a[a.SPRITE=2]="SPRITE";a[a.SPRITESHEET=3]="SPRITESHEET";a[a.SOUND=4]="SOUND";a[a.VIDEO=5]="VIDEO";a[a.MESH=6]="MESH";a[a.TRIGGER=7]="TRIGGER";a[a.TEXT=8]="TEXT";a[a.TOOLBELT_ITEM=9]="TOOLBELT_ITEM";a[a.TIMELINE=10]="TIMELINE";a[a.COLOR=13]="COLOR"})(StatefulElementType||={});
class StatefulElementData{constructor(){this.position=new Vector3(0);this.rotation=new Vector3(0);this.rotationOrder=StatefulElementData.DEFAULT_ROTATION_ORDER;this._isRadian=!0;this.scale=new Vector3(1);this.opacity=.001;this.volume=1;this.aspects=[];this.states=[]}static fromObject(a,e){let h=new StatefulElementData;h.uuid=a.uuid;h.name=a.name;h.type=a.type;a.position&&(h.position=a.position);a.rotation&&(a._isRadian?(h.rotation.x=a.rotation.x,h.rotation.y=a.rotation.y,h.rotation.z=a.rotation.z):
(h.rotation.x=GeometryUtils.degToRad(a.rotation.x),h.rotation.y=GeometryUtils.degToRad(a.rotation.y),h.rotation.z=GeometryUtils.degToRad(a.rotation.z)));a.scale&&(h.scale=a.scale);a.opacity&&(h.opacity=Math.min(a.opacity,.999));null!=a.volume&&(h.volume=Math.min(a.volume,1));if(a.animations&&a.animations.length){h.animations=[];for(var m=0;m<a.animations.length;++m)a.animations[m]?h.animations.push(AnimDataUtils.fromData(a.animations[m])):console.warn("Nullish animation at index",m,"in element",a.name,
"of scene",StatefulElementData.iteratingSceneName)}a.aspects&&a.aspects.length&&a.aspects.forEach(t=>{t?h.aspects.push(AspectDataFactory.getData(a.type,t)):console.warn("Nullish aspect in element",a.name,"of scene",StatefulElementData.iteratingSceneName)});a.states&&a.states.length&&a.states.forEach(t=>{t?h.states.push(StateData.fromObject(t)):console.warn("Nullish state in element",a.name,"of scene",StatefulElementData.iteratingSceneName)});a.needsMediaController&&h.type==StatefulElementType.VIDEO&&
h.states.length&&(h.needsMediaController=!0);if(e&&e.length)for(m=0;m<e.length;++m)VariableRefHolder.inst.add(e[m],h.uuid);if(a.variables&&a.variables.length)for(e||=[],h.variables=[],m=0;m<a.variables.length;++m)if(a.variables[m]){let t=VariableData.fromObject(a.variables[m]);VariableRefHolder.inst.add(t,h.uuid);e.push(t);h.variables.push(t)}else console.warn("Nullish variable at index",m,"in element",a.name,"of scene",StatefulElementData.iteratingSceneName);if(h.needsMediaController)if(a.items&&
2==a.items.length)h.items=a.items;else{if(h.items=[StatefulElementFactory.createVideoPlaybackButton(),StatefulElementFactory.createVideoProgressBar()],StatefulElementFactory.fillMissingPlaybackStates(h),a.items)for(m=0;m<a.items.length;++m)a.items[m]?h.items.push(StatefulElementData.fromObject(a.items[m],e)):console.warn("Nullish item at index",m,"in video",a.name,"of scene",StatefulElementData.iteratingSceneName)}else if(a.items)for(h.items=[],m=0;m<a.items.length;++m)a.items[m]?h.items.push(StatefulElementData.fromObject(a.items[m],
e)):console.warn("Nullish item at index",m,"in element",a.name,"of scene",StatefulElementData.iteratingSceneName);if(h.aspects.length&&UUID.isNull(a.defaultAspectUUID))throw Error("Export: invalid default aspect UUID in element "+h.name+" of scene "+StatefulElementData.iteratingSceneName);h.defaultAspectUUID=a.defaultAspectUUID;if(h.states.length&&UUID.isNull(a.defaultStateUUID))throw Error("Export: invalid default aspect UUID in element "+h.name+" of scene "+StatefulElementData.iteratingSceneName);
h.defaultStateUUID=a.defaultStateUUID;return h}}StatefulElementData.DEFAULT_ROTATION_ORDER="ZYX";
class CheckpointData{static fromObject(a){var e;let h=new CheckpointData;a.uuid&&(h.uuid=a.uuid);a.name&&(h.name=a.name);if(UUID.isNull(a.sceneUuid))throw Error("Export: invalid scene target UUID on checkpoint "+h.name);h.sceneUuid=a.sceneUuid;a.goToDefaults&&(h.goToDefaults=a.goToDefaults);if(null===(e=a.targets)||void 0===e?0:e.length)h.targets=a.targets;a.exceptions&&Object.keys(a.exceptions).length&&(h.goToDefaults=!0,h.exceptions=a.exceptions);return h}}
class HUDMapData{constructor(){this.rotateViewPoint=this.showViewPoint=this.showNorth=this.visible=!1}static fromObject(a,e){e=new HUDMapData;a.visible&&(e.visible=a.visible);a.showNorth&&(e.showNorth=a.showNorth);a.showViewPoint&&(e.showViewPoint=a.showViewPoint);a.rotateViewPoint&&(e.rotateViewPoint=a.rotateViewPoint);return a}}
class HeaderData{constructor(){this.appVersion="4.0";this.description=this.uuid=this.title="";this.rightLogo=this.leftLogo=!1;this.zoomable=!0;this.startFadeEffect=FadeType.BLACK;this.startFadeDuration=1E3;this.hideInteractionHints=this.allowSync=!1;this.usePhysic=!0}static fromObject(a){let e=new HeaderData;UUID.isNull(a.uuid)||(e.uuid=a.uuid);a.appVersion&&(e.appVersion=a.appVersion);a.title&&(e.title=a.title);a.description&&(e.description=a.description);a.leftLogo&&(e.leftLogo=a.leftLogo);a.rightLogo&&
(e.rightLogo=a.rightLogo);a.leftLogoUrl&&(e.leftLogoUrl=a.leftLogoUrl);a.rightLogoUrl&&(e.rightLogoUrl=a.rightLogoUrl);if(UUID.isNull(a.startSceneUUID))throw Error("Export: missing start scene UUID");e.startSceneUUID=a.startSceneUUID;UUID.isNull(a.persistentSceneUUID)||(e.persistentSceneUUID=a.persistentSceneUUID);a.zoomable&&(e.zoomable=a.zoomable);a.startFadeEffect&&(e.startFadeEffect=a.startFadeEffect);a.startFadeDuration&&(e.startFadeDuration=a.startFadeDuration);a.allowSync&&(e.allowSync=a.allowSync);
a.usePhysic&&(e.usePhysic=a.usePhysic);a.hideInteractionHints&&(e.hideInteractionHints=!0);return e}}
class MediaData{constructor(){this.customFolder="";this.uhd=!1}static fromObject(a,e){let h=new MediaData;h.uuid=a.uuid||e;h.paths=a.paths;h.mediaFolder=a.prefix||a.mediaFolder||"";if(UUID.isNull(h.uuid))throw Error("Export: invalid media UUID");null!=a.uhd&&(h.uhd=a.uhd);null!=a.resolution&&(h.resolution=a.resolution);null!=a.scale&&(h.scale=a.scale);null!=a.bypassPath&&(h.bypassPath=a.bypassPath);null!=a.customFolder&&(h.customFolder=a.customFolder);null!=a.family&&(h.family=a.family);null!=a.weight&&
(h.weight=a.weight);null!=a.style&&(h.style=a.style);h.mediaFolder&&!/\/$/.test(h.mediaFolder)&&(h.mediaFolder+="/");h.customFolder&&!/\/$/.test(h.customFolder)&&(h.customFolder+="/");return h}}var GroupDataUtils;(function(a){function e(h){let m=[];for(let t=0;t<h.length;t++){let y=h[t];y.aspects.length&&m.push(y);y.items&&(m=m.concat(e(y.items)))}return m}a.forEachElementsWithAspectsRecursive=function(h,m){h=e(h);for(let t=0;t<h.length;++t)m(h[t])}})(GroupDataUtils||={});class ViewPointData{}
ViewPointData.defaultViewPoint={position:new Vector3,lookAt:new Vector3};class SkyData{constructor(){this.parallel=45;this.hour=12}static fromObject(a){let e=new SkyData;a.volume&&(e.parallel=Math.max(-90,Math.min(90,a.parallel)));a.hour&&(e.hour=Math.max(0,a.hour%24));return e}}var StereoType;(function(a){a[a.NONE=0]="NONE";a[a.TOP_BOTTOM=1]="TOP_BOTTOM";a[a.LEFT_RIGHT=2]="LEFT_RIGHT"})(StereoType||={});
class SceneData{constructor(){this.name="Scene";this.volume=1;this.elements=[];this.visited=!1;this.sphereRadius=1E3;this.isPersistent=!1;this.stereo=StereoType.NONE;this.meshCloneData={};this.meshRenderOrder={}}static fromObject(a,e){var h;let m=new SceneData;a.uuid&&(m.uuid=a.uuid,m.uuid==e&&(m.isPersistent=!0));a.name&&(m.name=a.name);a.volume&&(m.volume=Math.min(a.volume,1));a.mute&&(m.volume=0);UUID.isNull(a.media)||(m.media=a.media);UUID.isNull(a.startViewPoint)||(m.startViewPoint=a.startViewPoint);
if(a.viewPoints){m.viewPoints=a.viewPoints;for(let t in m.viewPoints)e=m.viewPoints[t].lookAt,0==e.x&&0==e.y&&0==e.z&&(e.z=1)}a.sphereRadius&&(m.sphereRadius=a.sphereRadius);a.stereo&&(m.stereo=a.stereo);a.sky&&(m.sky=a.sky);if(!m.isPersistent&&!m.sky&&!m.media)throw Error("Export: missing background data for scene "+m.name);if(null===(h=a.elements)||void 0===h?0:h.length)StatefulElementData.iteratingSceneName=m.name,a.elements.forEach(t=>{t=StatefulElementData.fromObject(t);if(!t.states)throw Error("Element "+
t.name+" has no state");GroupDataUtils.forEachElementsWithAspectsRecursive([t],y=>{var C;let I=!1;if(y.animations)for(let H=0;H<y.animations.length;++H){let O=y.animations[H];if(O.type==AnimType.SPHERE&&O.hasOpacityValue){I=!0;break}}I||=y.states.some(H=>H.seizable);let E=null===(C=y.aspects)||void 0===C?void 0:C.length;y.aspects.forEach(H=>{H.media&&(y.type==StatefulElementType.MESH&&(m.meshRenderOrder[H.uuid]||(m.meshRenderOrder[H.uuid]={renderTransparent:!1}),I||.99>y.opacity||.99>H.opacity)&&
(m.meshRenderOrder[H.uuid].renderTransparent=!0),!I&&.99<H.opacity&&(H.opacity=1,--E))});!E&&.99<y.opacity&&(y.opacity=1);y.type==StatefulElementType.MESH&&y.aspects.forEach(H=>{if(H.media){var O=m.meshCloneData[H.media],R=SceneData.persistentMeshCloneData[H.media];if(!O&&!R)return m.meshCloneData[H.media]={opacity:y.opacity*H.opacity,needsCloning:!1};!O&&R&&(O=R);O.needsCloning||!I&&O.opacity==y.opacity*H.opacity||(O.needsCloning=!0)}})});m.elements.push(t)});return m}}
SceneData.persistentMeshCloneData={};
class MultiplayerData{constructor(){this.persistent=!1;this.lobby=null;this.bypassLobby=!1;this.implications={};this.media={};this.variables=[]}static fromObject(a){var e;let h=new MultiplayerData;a.persistent&&(h.persistent=!0);a.bypassLobby&&(h.bypassLobby=!0);a.lobby&&(h.lobby=SceneData.fromObject(a.lobby));if(a.implications)for(let m in a.implications){if(UUID.isNull(m))throw Error("Export: invalid implication target UUID in multiplayer lobby");h.implications[m]||(h.implications[m]=[]);null===
(e=a.implications[m])||void 0===e?void 0:e.forEach(t=>{h.implications[m].push(ImplicationData.fromObject(t))})}if(a.variables&&a.variables.length)for(e=0;e<a.variables.length;++e)h.variables.push(VariableData.fromObject(a.variables[e]));if(a.media)for(let m in a.media){if(UUID.isNull(m))throw Error("Export: invalid media UUID used by multiplayer lobby");h.media[m]=MediaData.fromObject(a.media[m],m)}return h}}var ImplicationFactory;
(function(a){function e(m,t,y){let C=m.items[0].uuid,I,E,H=[];for(let O=0;O<t.length;++O)E=new ImplicationData,E.uuid=UUID.generate(),E.name=m.name+" automated control state change",E.inputStatement=[],I=new StatementData,I.triggerType=StatementTrigger.CLICK,I.targetUUID=C,E.inputStatement.push(I),I=new StatementData,I.triggerType=StatementTrigger.STATE,I.targetUUID=m.uuid,I.triggerUUID=t[O],E.inputStatement.push(I),I=new StatementData,I.triggerType=StatementTrigger.STATE,I.targetUUID=m.uuid,I.triggerUUID=
y[0],E.outputStatement=[I],H.push(E);return H}function h(m,t,y){let C=m.items[0],I,E=[];var H;for(H=0;H<C.aspects.length;++H)if(y==C.aspects[H].media){I=C.aspects[H].uuid;break}for(let O=0;O<t.length;++O)y=new ImplicationData,y.uuid=UUID.generate(),y.name=m.name+" control button aspect change",H=new StatementData,H.triggerType=StatementTrigger.STATE,H.targetUUID=m.uuid,H.triggerUUID=t[O],y.inputStatement=[H],H=new StatementData,H.triggerType=StatementTrigger.ASPECT,H.targetUUID=C.uuid,H.triggerUUID=
I,y.outputStatement=[H],E.push(y);return E}a.createEndStatement=function(m,t,y){let C=new StatementData;C.targetUUID=m;C.triggerType=t;t!=StatementTrigger.MEDIA_END&&(C.triggerUUID=y);t==StatementTrigger.ANIM&&(C.animState=StatePlaybackType.STOP);return C};a.createVideoPlaybackButton=function(m,t,y){return[].concat(e(m,t.play,y.pause),e(m,t.pause,y.play),e(m,t.stop,y.play))};a.createVideoPlaybackStateChange=function(m,t){return[].concat(h(m,t.play,SimulationData.VIDEO_PAUSE_BUTTON_ID),h(m,t.pause,
SimulationData.VIDEO_PLAY_BUTTON_ID),h(m,t.stop,SimulationData.VIDEO_PLAY_BUTTON_ID))};a.createVideoProgressBar=function(m){let t=m.items[1].uuid,y,C=new ImplicationData;C.uuid=UUID.generate();C.name=m.name+" seek";y=new StatementData;y.triggerType=StatementTrigger.CLICK;y.targetUUID=t;C.inputStatement=[y];y=new StatementData;y.triggerType=StatementTrigger.TIME;y.targetUUID=m.uuid;C.outputStatement=[y];return[C]}})(ImplicationFactory||={});
class SimulationData{constructor(){this.version=2;this.mobile=!1;this.scenes=[];this.implications={};this.checkpoints={};this.variables=[];this.media={};this.maxSoundCount=this.maxVideoCount=0}fromBinaryObject(a){a=atob(a);a=JSON.parse(a);this.fromObject(a)}fromObject(a){var e,h,m,t,y;a.version&&(this.version=a.version);a.header&&(this.header=HeaderData.fromObject(a.header));a.multi&&(this.multi=MultiplayerData.fromObject(a.multi));if(a.scenes){let C=-1;for(let I=0;I<a.scenes.length;++I){let E=SceneData.fromObject(a.scenes[I],
this.header.persistentSceneUUID);this.scenes.push(E);E.isPersistent&&(SceneData.persistentMeshCloneData=E.meshCloneData,C=I)}0<C?this.scenes.unshift(this.scenes.splice(C,1)[0]):-1==C&&(this.header.persistentSceneUUID="");(null===(e=this.multi)||void 0===e?0:e.lobby)&&this.scenes.push(this.multi.lobby)}if(a.media){for(let C in a.media)if(this.media[C]=MediaData.fromObject(a.media[C],C),UUID.isNull(C))throw Error("Export: invalid media UUID");for(let C in null===(h=this.multi)||void 0===h?void 0:h.media)this.media[C]=
this.multi.media[C];this.media[SimulationData.VIDEO_PLAY_BUTTON_ID]=MediaData.fromObject({uuid:SimulationData.VIDEO_PLAY_BUTTON_ID,uhd:!1,paths:["play.png"],prefix:"../static/assets/viewer",bypassPath:!0,resolution:25,scale:{x:1,y:1}});this.media[SimulationData.VIDEO_PAUSE_BUTTON_ID]=MediaData.fromObject({uuid:SimulationData.VIDEO_PAUSE_BUTTON_ID,uhd:!1,paths:["pause.png"],prefix:"../static/assets/viewer",bypassPath:!0,resolution:25,scale:{x:1,y:1}})}if(a.variables&&a.variables.length){for(e=0;e<
a.variables.length;++e)this.variables.push(VariableData.fromObject(a.variables[e]));null===(m=this.multi)||void 0===m?void 0:m.variables.forEach(C=>{this.variables.push(C)})}if(a.implications){for(let C in a.implications){if(UUID.isNull(C))throw Error("Export: invalid implication trigger UUID");this.implications[C]||(this.implications[C]=[]);null===(t=a.implications[C])||void 0===t?void 0:t.forEach(I=>{this.implications[C].push(ImplicationData.fromObject(I))})}for(let C in null===(y=this.multi)||
void 0===y?void 0:y.implications)this.implications[C]?this.multi.implications[C].forEach(I=>{this.implications[C].push(I)}):this.implications[C]=this.multi.implications[C]}if(a.checkpoints)for(let C in a.checkpoints)if(this.checkpoints[C]=CheckpointData.fromObject(a.checkpoints[C]),UUID.isNull(C))throw Error("Export: invalid checkpoint UUID");a.trackings&&(this.trackings=[],a.trackings.forEach(C=>{this.trackings.push(TrackingData.fromObject(C))}));this.mobile||(this.setEndOfPlaybackImplications(),
this.setVideoControllersImplications());this.countMaxMedia();this.flagPersistentMedia()}setEndOfPlaybackImplications(){this.traverseElements(a=>{let e=new MessyDictionary;if(a.states&&a.states.length)for(var h=0;h<a.states.length;++h){var m=a.states[h];if(m.playback==StatePlaybackType.STOP){var t=m.uuid;break}}if(a.animations&&a.animations.length)for(h=0;h<a.animations.length;++h)e.add(a.animations[h].uuid,[]);if(t||e.length)if(this.implications[a.uuid]){var y=this.implications[a.uuid];if(t){h=[];
for(m=0;m<y.length;++m){var C=y[m];if(C.inputStatement)for(var I=0;I<C.inputStatement.length;++I)if(C.inputStatement[I].triggerType==StatementTrigger.MEDIA_END){h.push(m);break}}if(h.length)a:for(m=0;m<h.length;++m){C=y[h[m]].outputStatement;for(I=0;I<C.length;++I){let E=C[I];if(E.triggerType==StatementTrigger.STATE&&E.targetUUID==a.uuid)break a}y[h[m]].outputStatement.push(ImplicationFactory.createEndStatement(a.uuid,StatementTrigger.STATE,t))}else this.addEndImplication(a.uuid,"End media of "+a.name,
t,StatementTrigger.MEDIA_END,StatementTrigger.STATE)}if(e.length){for(t=0;t<y.length;++t)if(h=y[t],h.inputStatement)for(m=0;m<h.inputStatement.length;++m)if(C=h.inputStatement[m],C.triggerType==StatementTrigger.ANIM_END&&e.has(C.triggerUUID)){e.get(C.triggerUUID).push(t);break}e.traverse((E,H)=>{E.length||(this.addEndImplication(a.uuid,"End anim in "+a.name,H,StatementTrigger.ANIM_END,StatementTrigger.ANIM),e.remove(H))});e.traverse((E,H)=>{a:for(let O=0;O<E.length;++O){let R=y[E[O]].outputStatement;
for(let W=0;W<R.length;++W){let ea=R[W];if(ea.triggerType==StatementTrigger.ANIM&&ea.targetUUID==a.uuid&&ea.triggerUUID==H)break a}y[E[O]].outputStatement.push(ImplicationFactory.createEndStatement(a.uuid,StatementTrigger.ANIM,H))}})}}else this.implications[a.uuid]=[],t&&this.addEndImplication(a.uuid,"End media of "+a.name,t,StatementTrigger.MEDIA_END,StatementTrigger.STATE),e.traverse((E,H)=>{this.addEndImplication(a.uuid,"End anim in "+a.name,H,StatementTrigger.ANIM_END,StatementTrigger.ANIM)})})}addEndImplication(a,
e,h,m,t){let y=new ImplicationData;y.uuid=UUID.generate();y.name=e;y.inputStatement=[ImplicationFactory.createEndStatement(a,m,h)];y.outputStatement=[ImplicationFactory.createEndStatement(a,t,h)];this.implications[a].push(y)}setVideoControllersImplications(){this.traverseElements(a=>{if(a.needsMediaController){var e=StatefulElementFactory.getPlayableStateIds(a),h=StatefulElementFactory.getPlayableStateIds(a,!0),m=ImplicationFactory.createVideoPlaybackStateChange(a,e);this.implications[a.uuid]=this.implications[a.uuid].concat(m);
this.implications[a.items[0].uuid]=ImplicationFactory.createVideoPlaybackButton(a,e,h);this.implications[a.items[1].uuid]=ImplicationFactory.createVideoProgressBar(a)}})}countMaxMedia(){var a;let e={},h={};for(let t=0;t<this.scenes.length;++t){this.videoIds=Object.assign({},e);this.soundIds=Object.assign({},h);let y=this.scenes[t];var m=null===(a=this.media[y.media])||void 0===a?void 0:a.mediaFolder;m&&/video/.test(m)&&(this.videoIds[y.media]=!0);y.elements.length&&GroupDataUtils.forEachElementsWithAspectsRecursive(y.elements,
I=>{I.type!=StatefulElementType.SOUND&&I.type!=StatefulElementType.VIDEO||this.traversePlayableAspects(I.aspects,I.type)});m=Object.keys(this.videoIds).length;let C=Object.keys(this.soundIds).length;this.header.persistentSceneUUID==y.uuid&&(e=this.videoIds,h=this.soundIds);m>this.maxVideoCount&&(this.maxVideoCount=m);C>this.maxSoundCount&&(this.maxSoundCount=C)}this.soundIds=this.videoIds=null}flagPersistentMedia(){if(this.header.persistentSceneUUID&&this.header.persistentSceneUUID==this.scenes[0].uuid){var a=
this.scenes[0];a.media&&this.media[a.media]&&(this.media[a.media].persistent=!0);a.elements.length&&GroupDataUtils.forEachElementsWithAspectsRecursive(a.elements,e=>{for(let h=0;h<e.aspects.length;++h){let m=e.aspects[h].media;m&&this.media[m]&&(this.media[m].persistent=!0)}})}}traverseElements(a){for(let e=0;e<this.scenes.length;++e){let h=this.scenes[e];h.elements.length&&GroupDataUtils.forEachElementsWithAspectsRecursive(h.elements,a)}}traversePlayableAspects(a,e){for(let h=0;h<a.length;++h)e==
StatefulElementType.SOUND?this.soundIds[a[h].media]=!0:e==StatefulElementType.VIDEO&&(this.videoIds[a[h].media]=!0)}}SimulationData.VIDEO_PLAY_BUTTON_ID="controller_play_button";SimulationData.VIDEO_PAUSE_BUTTON_ID="controller_pause_button";var AnswerType;(function(a){a[a.CLASSIC=0]="CLASSIC";a[a.VARIABLE=1]="VARIABLE"})(AnswerType||={});
class AnswerData{static fromObject(a){let e=new AnswerData;null!=a.id&&(e.id=a.id);a.uuid&&(e.uuid=a.uuid);a.name&&(e.name=a.name);a.description&&(e.description=a.description);null!=a.value&&(e.value=a.value);null!=a.answerType&&(e.answerType=a.answerType);UUID.isNull(a.varUuid)||(e.varUuid=a.varUuid);if(e.answerType==AnswerType.VARIABLE&&!e.varUuid)throw Error("Bad SCORM answer setup");return e}}
class ObjectiveData{constructor(){this.type=TrackingType.SCORM}static fromObject(a){let e=new ObjectiveData;null!=a.id&&(e.id=a.id);a.uuid&&(e.uuid=a.uuid);a.name&&(e.name=a.name);e.answers=[];a.answers&&a.answers.forEach(h=>{e.answers.push(AnswerData.fromObject(h))});return e}}var TrackingType;(function(a){a[a.SCORM=0]="SCORM"})(TrackingType||={});
class TrackingData{constructor(){this.type=TrackingType.SCORM}static fromObject(a){let e=new TrackingData;a.uuid&&(e.uuid=a.uuid);null!=a.successRate&&(e.successRate=a.successRate);null!=a.scoreMax&&(e.scoreMax=a.scoreMax);e.objectives=[];a.objectives&&a.objectives.forEach(h=>{e.objectives.push(ObjectiveData.fromObject(h))});return e}}
class AbstractDictionary{constructor(){this._items={}}has(a){return"undefined"!=typeof this._items[a]}get(a){return this._items[a]}find(a){this.traverse((e,h)=>{if(a==e)return h});return null}toObject(){return JSON.parse(JSON.stringify(this._items))}_update(a,e){this._items[a]=e}}
class MessyDictionary extends AbstractDictionary{constructor(){super(...arguments);this._count=0}add(a,e){if(this.has(a))return this._update(a,e);this._add(a,e)}_add(a,e){++this._count;this._update(a,e)}remove(a){return this.has(a)?(--this._count,delete this._items[a],!0):!1}empty(){this._items={};this._count=0;return this}get length(){return this._count}traverse(a,e){if(!this.length)return!1;if(e)for(let h in this._items){if(a(this._items[h],h))return!0}else for(let h in this._items)a(this._items[h],
h);return!1}}
class PersistentDictionary extends AbstractDictionary{constructor(){super(...arguments);this._persistent=new MessyDictionary;this._tmp=new MessyDictionary}add(a,e,h){if(this.has(a)){let m=this.isPersistent(a);!m&&h?(console.warn("Moving a temporary item to the persistent list"),this._tmp.remove(a)):m&&!h&&(console.warn("Moving a persistent item to the temporary list"),this._persistent.remove(a))}h?this._persistent.add(a,e):this._tmp.add(a,e)}has(a){return this._tmp.has(a)||this._persistent.has(a)}get(a){return this._tmp.get(a)||this._persistent.get(a)}isPersistent(a){return this._persistent.has(a)}remove(a,
e){return this._tmp.remove(a)||e&&this._persistent.remove(a)}empty(a){this._tmp.empty();a&&this._persistent.empty();return this}get length(){return this._persistent.length+this._tmp.length}traverse(a,e){this._persistent.traverse(a,e)||this._tmp.traverse(a,e)}}
class Queue{constructor(){this._iterator=0;this._items=[]}push(a){this._items.push(a)}get current(){return this.hasItem?this._items[this._iterator]:null}get length(){return this._items.length}get hasItem(){return this._iterator<this.length}move(){return++this._iterator==this.length}reset(){this._iterator=0}empty(){this._items=[];this._iterator=0}traverse(a,e=!1){e?this._items.some((h,m)=>a(h,m)):this._items.forEach(a)}}
class TidyDictionary extends AbstractDictionary{constructor(){super(...arguments);this._order=[];this._looping=!1;this._toRemove=[]}push(a,e,h){if(this.has(a)){if(!h)return this._update(a,e);if(this._looping)return;this._order.splice(this.indexOf(a),1)}this._push(a,e)}_push(a,e){this._update(a,e);this._order.push(a)}add(a,e){this.push(a,e)}unshift(a,e,h){if(this.has(a)){if(!h)return this._update(a,e);if(this._looping)return;this._order.splice(this.indexOf(a),1)}this._unshift(a,e)}_unshift(a,e){this._update(a,
e);this._order.unshift(a)}remove(a){if(!this.has(a))return!1;if(this._looping)this._toRemove.push(a);else return this._order.splice(this.indexOf(a),1),delete this._items[a],!0}pop(){if(!this._order.length||this._looping)return null;let a=this._order.pop(),e=this._items[a];delete this._items[a];return e}shift(){if(!this._order.length||this._looping)return null;let a=this._order.shift(),e=this._items[a];delete this._items[a];return e}empty(){this._items={};this._order=[];return this}get length(){return this._order.length}slice(a,
e){if(this._idxOutOfRange(a)||e<a)return[];let h=[];if(1==e-a)return[this._items[this._order[a]]];for(;a<this._order.length&&a<e;++a)h.push(this._items[this._order[a]]);return h}indexOf(a){return this._order.indexOf(a)}_idxOutOfRange(a){return 0>a||a>=this.length}traverse(a,e){if(this.length){this._looping=!0;if(e)for(e=0;e!=this._order.length&&!a(this._items[this._order[e]],e);++e);else for(e=0;e!=this._order.length;++e)a(this._items[this._order[e]],e);this._looping=!1;this._removeAfterLoop()}}reverseTraverse(a,
e){if(this.length){this._looping=!0;if(e)for(e=this._order.length-1;-1!=e&&!a(this._items[this._order[e]],e);--e);else for(e=this._order.length-1;-1!=e;--e)a(this._items[this._order[e]],e);this._looping=!1;this._removeAfterLoop()}}_removeAfterLoop(){if(this._toRemove.length){for(let a=0;a<this._toRemove.length;++a)this.remove(this._toRemove[a]);this._toRemove=[]}}}
class Command{constructor(a){this.id=a;this.bit=Command.currentBit;Command.calculateNextBit()}static calculateNextBit(){Command.currentBit*=2}}Command.currentBit=1;class Notifiable{constructor(){this.uuid=UUID.generate()}notify(a,e){}}
class NotificationBinder{constructor(){this.eventDictionnary=new MessyDictionary}notify(a,e){this.eventDictionnary.has(a.id)&&(a=this.eventDictionnary.get(a.id),document.dispatchEvent(a))}createEvent(a,e){e=new Event(e);this.eventDictionnary.add(a.id,e);Notifier.subscribe(this,a)}}
class Notifier{static unleash(a,e){Notifier.dictionary.has(a.id)&&Notifier.dictionary.get(a.id).traverse(h=>{h.notify(a,e)})}static subscribe(a,e){Notifier.dictionary.has(e.id)||Notifier.dictionary.add(e.id,new MessyDictionary);Notifier.dictionary.get(e.id).add(a.uuid,a)}static unsubscribe(a,e){if(Notifier.dictionary.has(e.id)){let h=Notifier.dictionary.get(e.id);h.remove(a.uuid);0==h.length&&Notifier.dictionary.remove(e.id)}}}Notifier.dictionary=new MessyDictionary;class ElementCommand{}
ElementCommand.ELEMENT_ADDED=new Command("ELEMENT_ADDED");ElementCommand.FLOOR_ADDED=new Command("FLOOR_ADDED");ElementCommand.ELEMENT_REMOVED=new Command("ELEMENT_REMOVED");ElementCommand.ALL_ELEMENTS_REMOVED=new Command("ALL_ELEMENTS_REMOVED");class ImplicationCommand{}ImplicationCommand.PROCESS_URL=new Command("PROCESS_URL");ImplicationCommand.CHANGE_SCENE=new Command("CHANGE_SCENE");ImplicationCommand.ON_TRACKING_INTERACTION=new Command("ON_TRACKING_INTERACTION");
ImplicationCommand.MANAGE_TRACKING=new Command("MANAGE_TRACKING");ImplicationCommand.RAW_TRACKING_INTERACTION=new Command("RAW_TRACKING_INTERACTION");ImplicationCommand.SET_STORYLINE_VAR=new Command("SET_STORYLINE_VAR");ImplicationCommand.SET_INJECTION_MAP=new Command("SET_INJECTION_MAP");ImplicationCommand.VR_EXIT=new Command("VR_EXIT");class InitCommand{}InitCommand.VR_INIT_TESTED=new Command("VR_INIT_TESTED");InitCommand.DATA_LOADED=new Command("DATA_LOADED");InitCommand.MEDIA_TAGS_READY=new Command("MEDIA_TAGS_READY");
InitCommand.VR_STARTED=new Command("VR_STARTED");InitCommand.UNLOCK=new Command("UNLOCK");InitCommand.UNLOCK_FINISHED=new Command("UNLOCK_FINISHED");InitCommand.HUD_LOAD_END=new Command("HUD_LOAD_END");InitCommand.FONT_LOAD_END=new Command("FONT_LOAD_END");class MediaLagCommand{}MediaLagCommand.BUFFERING=new Command("MEDIA_BUFFERING");MediaLagCommand.RESUMED=new Command("MEDIA_RESUMED");MediaLagCommand.SEEK=new Command("SEEK");class PointerCommand{}PointerCommand.START=new Command("START");
PointerCommand.END=new Command("END");PointerCommand.MOVE=new Command("MOVE");PointerCommand.DOUBLE=new Command("DOUBLE");PointerCommand.LONG=new Command("LONG");PointerCommand.NEED_UPDATE=new Command("NEED_UPDATE");class SceneCommand{}SceneCommand.MEDIA_TAGS_RESET=new Command("MEDIA_TAGS_RESET");SceneCommand.LOAD_START=new Command("LOAD_START");SceneCommand.LOAD_PROGRESS=new Command("LOAD_PROGRESS");SceneCommand.LOAD_END=new Command("LOAD_END");SceneCommand.GENERATION_STARTED=new Command("GENERATION_STARTED");
SceneCommand.GENERATION_FINISHED=new Command("GENERATION_FINISHED");SceneCommand.FIRST_FRAME=new Command("FIRST_FRAME");SceneCommand.VIDEO_HAS_FRAMES=new Command("VIDEO_HAS_FRAMES");SceneCommand.ALL_VIDEOS_HAVE_FRAMES=new Command("ALL_VIDEOS_HAVE_FRAMES");class StatefulCommand{}StatefulCommand.STATEFUL_ELEMENT_CHANGE=new Command("STATEFUL_ELEMENT_CHANGE");StatefulCommand.ANIM_STARTED=new Command("ANIM_STARTED");StatefulCommand.VARIABLE_CHANGED=new Command("VARIABLE_CHANGED");
StatefulCommand.CHECKPOINT_TRIGGERED=new Command("CHECKPOINT_TRIGGERED");class TimeCommand{}TimeCommand.PAUSED=new Command("TIME_PAUSED");TimeCommand.RESUMED=new Command("TIME_RESUMED");TimeCommand.SEEK=new Command("SEEK");TimeCommand.PROGRESS=new Command("PROGRESS");class ViewportCommand{}ViewportCommand.UPDATE=new Command("UPDATE");ViewportCommand.UPDATE_LOADER=new Command("UPDATE_LOADER");ViewportCommand.UPDATE_END=new Command("UPDATE_END");ViewportCommand.RESIZE=new Command("RESIZE");var __awaiter=this&&this.__awaiter||function(a,e,h,m){function t(y){return y instanceof h?y:new h(function(C){C(y)})}return new (h||=Promise)(function(y,C){function I(O){try{H(m.next(O))}catch(R){C(R)}}function E(O){try{H(m["throw"](O))}catch(R){C(R)}}function H(O){O.done?y(O.value):t(O.value).then(I,E)}H((m=m.apply(a,e||[])).next())})};
class AbstractScriptParser{static isScript(a){return this.BASE_SCRIPT_REGEX.test(a)}static getFromName(a){console.error("Overwrite me");return null}static extractBaseCode(a,e){if(!a)return null;a=a.match(this.BASE_SCRIPT_REGEX);if(!a)return null;a=a[1].replace(this.CODE_REPLACE_REGEX,"$1").toLowerCase();return e?(e=a.match(new RegExp("\\b"+e+this.SUBSET_EXTRACTOR)))?e[1]||this.NO_SUBSET_EXTRACTED:null:a}static loopOnKeys(a,e){if(!a)return null;if(this.NO_SUBSET_EXTRACTED==a)return e;a=a.split(",");
for(let h=0;h<a.length;++h){let m=a[h].split(/(?::|_)/);e.parseVal(m[0],m[1])}return e}toData(a){console.error("Missing optional override")}fromScript(a){console.error("Missing optional override")}}AbstractScriptParser.NO_SUBSET_EXTRACTED="_";AbstractScriptParser.BASE_SCRIPT_REGEX=/\[(.*)\]/;AbstractScriptParser.CODE_REPLACE_REGEX=/\s*([,(?::|_)])\s*/g;AbstractScriptParser.SUBSET_EXTRACTOR="(?::?){\\b([^}]+)";var SkyUtils;
(function(a){a.setSunPosition=function(e){if(e){var h=Math.PI*(e.inclinaison-.5),m=2*Math.PI*(e.azimuth-.5);h=new THREE.Vector3(4E5*Math.cos(m),4E5*Math.sin(m)*Math.sin(h),4E5*Math.sin(m)*Math.cos(h));e.material.uniforms.sunPosition.value.copy(h)}}})(SkyUtils||={});var ControllerType;(function(a){a.HAND="hand";a.SOLO="solo";a.BOTH="both";a.SINGLE="single"})(ControllerType||={});var ControllerEffectType;(function(a){a.GHOST="ghost";a.BASE="base"})(ControllerEffectType||={});
class SceneControllerData extends AbstractScriptParser{constructor(a=ControllerType.HAND,e=ControllerEffectType.BASE,h=1){super();this.type=ControllerType.HAND;this.effect=ControllerEffectType.BASE;this.opacity=1;this.threshold=2;this.color=new THREE.Color(9480111);this.ray=!0;this.type=a;this.effect=e;this.opacity=h}static getFromName(a){return this.loopOnKeys(this.extractBaseCode(a,"controller"),new SceneControllerData)}parseVal(a,e){"type"==a&&(e==ControllerType.HAND&&(this.type=ControllerType.HAND),
e==ControllerType.BOTH&&(this.type=ControllerType.BOTH),e==ControllerType.SINGLE&&(this.type=ControllerType.SINGLE),e==ControllerType.SOLO&&(this.type=ControllerType.SOLO));"ghost"==a&&(this.effect=ControllerEffectType.GHOST);"ray"==a&&(this.ray="true"==e);"opacity"==a&&(this.opacity=parseFloat(e));"threshold"==a&&(this.threshold=parseFloat(e));"color"==a&&(this.color=new THREE.Color(e))}}var EnvMapType;(function(a){a[a.NONE=0]="NONE";a[a.SCENE=1]="SCENE";a[a.MODEL=2]="MODEL"})(EnvMapType||={});
class ShaderScriptData extends AbstractScriptParser{constructor(){super(...arguments);this.toon=!1;this.envmap=!0;this.envmapType=Config.BASE_ENVMAP_TYPE;this.dynamic=this.roomItem=this.room=this.reflector=!1;this.rectfactor=1;this.renderMode=GLTFRenderMode.PBR;this.probe=!1}static getFromName(a){return this.loopOnKeys(this.extractBaseCode(a,"shader"),new ShaderScriptData)}parseVal(a,e){if("toon"==a)this.toon=!0;else if("envmap"==a)switch(this.envmap=!0,e){case "none":this.envmapType=EnvMapType.NONE;
break;case "scene":this.envmapType=EnvMapType.SCENE;break;case "model":case "models":case "hierarchy":this.envmapType=EnvMapType.MODEL}else if("reflector"==a)this.reflector=!0;else if("room"==a||"parallax"==a)this.envmap=this.room=!0,this.envmapType=EnvMapType.MODEL;else if("roomitem"==a||"item"==a)this.envmap=this.roomItem=!0,this.envmapType=EnvMapType.MODEL;else if("roughness"==a)this.roughness=Math.max(0,Math.min(1,parseFloat(e)));else if("metalness"==a)this.metalness=Math.max(0,Math.min(1,parseFloat(e)));
else if("glossiness"==a)this.glossiness=Math.max(0,Math.min(1,parseFloat(e)));else if("rectfactor"==a)this.rectfactor=parseFloat(e);else if("dynamic"==a)this.dynamic=!0;else if("probe"==a)this.probe=!0;else if("correctlights"==a)this.correctLights=!0;else if("rendermode"==a)switch(e){case "basic":this.renderMode=GLTFRenderMode.BASIC;break;case "phong":this.renderMode=GLTFRenderMode.PHONG;break;case "adaptative":this.renderMode=GLTFRenderMode.ADAPTATIVE;break;default:this.renderMode=GLTFRenderMode.PBR}}}
class Config{}Config.STATIC_FOLDER=!0;Config.DATA_FOLDER="./data/";Config.LANGUAGE=/^fr/i.test(navigator.language)?"fr":"en";Config.SCREEN_ORIENTATION=0;Config.LAUNCH_FROM_SPHERE_COMPANION=!1;Config.IN_TEST_WINDOW=!1;Config.HAS_PHYSICS=!1;Config.STARTED_IN_VR=!1;Config.USE_ACCELEROMETER=!1;Config.DUAL_RENDERING=!1;Config.BASE_ENVMAP_TYPE=EnvMapType.SCENE;Config.CONTROLLER_DATA=new SceneControllerData(ControllerType.BOTH,ControllerEffectType.GHOST);Config.PWA_APP=!1;Config.has3DModels=!1;
Config.RENDER_ORDER_SKYBOX=1;Config.RENDER_ORDER_OPAQUE=1E3;Config.RENDER_ORDER_TRANSPARENT=1E4;Config.CURRENT_FADE_DURATION=1E3;Config.TARGET_STANDARD_FOV=60;Config.TARGET_VIDEO_FOV=90;Config.currentFOV=Config.TARGET_STANDARD_FOV;Config.basisComrpessed=!1;Config.ALPHA_TEST=.1;Config.MAX_ANISOTROPY=1;Config.USER_STANDING_HEIGHT=1.6;Config.cameraReversedMode=!1;
class WebARReticule{constructor(a,e){this._positionSet=this._enabled=!1;this._xrReferenceSpace=null;this._scene=e;this._renderer=a}initReticule(){this.createReticule();this._scene.add(this._reticuleMesh);this._enabled=!0}set referenceSpace(a){this._xrReferenceSpace=a}resetReticule(){this._positionSet=!0;this._scene.remove(this._reticuleMesh);this._enabled=!1}set visible(a){this._reticuleMesh.visible=a}get positionSet(){return this._positionSet}updatePosition(a){let e=new THREE.Vector3,h=new THREE.Quaternion,
m=new THREE.Vector3;a.decompose(e,h,m);e.y-=Config.USER_STANDING_HEIGHT;a.compose(e,h,m);this._reticuleMesh.matrix.copy(a);this.visible=!0}createReticule(){this._reticuleMesh||(this._reticuleMesh=new THREE.Mesh((new THREE.RingBufferGeometry(.15,.2,32)).rotateX(-Math.PI/2),new THREE.MeshBasicMaterial),this._reticuleMesh.matrixAutoUpdate=!1,this._reticuleMesh.visible=!1)}get enabled(){return this._enabled}get positionMatrix(){return this._reticuleMesh.matrix}}
class UpdateMutex extends Notifiable{constructor(a){super();this.upToDate=!1;this._updateCommand=a;Notifier.subscribe(this,a)}notify(a,e){this.upToDate=!1}dispose(){Notifier.unsubscribe(this,this._updateCommand)}hasChanged(){Notifier.unleash(this._updateCommand)}update(){if(!this.upToDate)throw this.upToDate=!0,Error("Implement me!");}}
class SingleTouchDoubleTapHelper{constructor(a,e){this.touchEnd=h=>{if(!this._previousTouchEndTime)return this.started(h);if(Date.now()-this._previousTouchEndTime>this._maxInterval)return this.reset();if(h.changedTouches.length){var m=h.changedTouches[0];if((new THREE.Vector2(m.clientX,m.clientY)).distanceTo(this._previousTouchEndPos)>this._maxDistance)return this.reset();this.reset();this._handler(h)}};this._dom=a;this._handler=e;this._maxDistance=20;this._maxInterval=300;a.addEventListener("touchend",
this.touchEnd)}dispose(){this.reset();this._dom.removeEventListener("touchend",this.touchEnd);this._dom=this._handler=null}started(a){a.changedTouches.length&&(a=a.changedTouches[0],this._previousTouchEndTime=Date.now(),this._previousTouchEndPos=new THREE.Vector2(a.clientX,a.clientY),this.clearTimeout(),this._timerId=window.setTimeout(()=>{this._timerId=0;this.reset()},1.5*this._maxInterval))}reset(){this.clearTimeout();this._previousTouchEndTime=0;this._previousTouchEndPos=null}clearTimeout(){this._timerId&&
(window.clearTimeout(this._timerId),this._timerId=0)}}
class PointerManager extends UpdateMutex{constructor(){super(PointerCommand.NEED_UPDATE);this._previousPointer2DPos=new THREE.Vector2;this._startHandler=a=>{this._domHandler(a,"START",!0);"touchstart"!=a.type||this._mainTouchId||(this._mainTouchId=a.changedTouches[0].identifier);this._handlers.LONG&&(this._longPressTimeout=window.setTimeout(()=>this._domHandler(a,"LONG"),PointerManager._LONG_PRESS_DURATION))};this._endHandler=a=>{this._domHandler(a,"END",!0);"touchend"==a.type&&a.changedTouches[0].identifier==
this._mainTouchId&&(this._mainTouchId=null);this._handlers.LONG&&window.clearTimeout(this._longPressTimeout)};this._moveHandler=a=>{this._domHandler(a,"MOVE")};if(PointerManager._inst)throw Error("This is a singleton");this.RAYCAST_RECURSIVE=!1;this._disabled=!0;this._handlers={START:0,END:0,MOVE:0,DOUBLE:0,LONG:0,MOBILE:0};this._rayCaster=new THREE.Raycaster(new THREE.Vector3,new THREE.Vector3,0,1E6);Notifier.subscribe(this,SceneCommand.LOAD_START);Notifier.subscribe(this,SceneCommand.LOAD_END);
View3D.inst.dom.addEventListener("contextmenu",a=>{a.preventDefault()},!1);this._debugEvents&&this._setDebugDivs()}get rayCaster(){this.update();return this._rayCaster}static get inst(){return this._inst||(this._inst=new PointerManager)}update(){this.upToDate||(this.upToDate=!0,this._currentPositionMatrix?(this._rayCaster.ray.origin.setFromMatrixPosition(this._currentPositionMatrix),this._rayCaster.ray.direction.set(0,0,-1).applyMatrix4(this._currentRotationMatrix),this._currentRotationMatrix=this._currentPositionMatrix=
null):this._handlers.MOBILE?this._rayCaster.setFromCamera(this._defaultForward,View3D.inst.camera):this._currentPointer2DPos&&(this._update3DMousePos(),this._rayCaster.setFromCamera(this._currentPointer3DPos,View3D.inst.camera),this._currentPointer2DPos=null))}notify(a,e){ViewportCommand.UPDATE==a?this.hasChanged():SceneCommand.LOAD_START==a?this._disabled=!0:SceneCommand.LOAD_END==a?this._disabled=!1:super.notify(a,e)}setStartHandler(a){a&&Notifier.subscribe(a,PointerCommand.START);this._handlers.START++||
(View3D.inst.dom.addEventListener("mousedown",this._startHandler,!1),View3D.inst.dom.addEventListener("touchstart",this._startHandler,!1))}setEndHandler(a){if(!this._handlers.START)throw Error("Dev error: gotta track starting click before if you want the end one to work");a&&Notifier.subscribe(a,PointerCommand.END);this._handlers.END++||(View3D.inst.dom.addEventListener("mouseup",this._endHandler,!1),View3D.inst.dom.addEventListener("touchend",this._endHandler,!1))}setMoveHandler(a){Notifier.subscribe(a,
PointerCommand.MOVE);this._handlers.MOVE++||(View3D.inst.dom.addEventListener("mousemove",this._moveHandler,!1),View3D.inst.dom.addEventListener("touchmove",this._moveHandler,!1),View3D.inst.dom.addEventListener("mouseout",this._endHandler,!1))}setDoubleTapHandler(a){Notifier.subscribe(a,PointerCommand.DOUBLE);this._handlers.DOUBLE++||new SingleTouchDoubleTapHelper(View3D.inst.dom,e=>{this._domHandler(e,"DOUBLE")})}setLongPressHandler(a){Notifier.subscribe(a,PointerCommand.LONG);this._handlers.LONG++}setFromMobile(){this._handlers.MOBILE++||
(Notifier.subscribe(this,ViewportCommand.UPDATE),this._defaultForward=new THREE.Vector3(0,0,.5))}setFromAR(a){this._read2DMousePos(a);this.hasChanged()}setFromGamepad(a,e){this._currentPositionMatrix=a;this._currentRotationMatrix=e;this.hasChanged()}unsetStartHandler(a){a&&Notifier.unsubscribe(a,PointerCommand.START);this._handlers.START&&!--this._handlers.START&&(View3D.inst.dom.removeEventListener("mousedown",this._startHandler,!1),View3D.inst.dom.removeEventListener("touchstart",this._startHandler,
!1))}unsetEndHandler(a){a&&Notifier.unsubscribe(a,PointerCommand.END);this._handlers.END&&!--this._handlers.END&&(View3D.inst.dom.removeEventListener("mouseup",this._endHandler,!1),View3D.inst.dom.removeEventListener("touchend",this._endHandler,!1))}unsetMoveHandler(a){Notifier.unsubscribe(a,PointerCommand.MOVE);this._handlers.MOVE&&!--this._handlers.MOVE&&(View3D.inst.dom.removeEventListener("mousemove",this._moveHandler,!1),View3D.inst.dom.removeEventListener("touchmove",this._moveHandler,!1),View3D.inst.dom.removeEventListener("mouseout",
this._endHandler,!1))}unsetLongPressHandler(a){Notifier.unsubscribe(a,PointerCommand.LONG);this._handlers.LONG&&--this._handlers.LONG}unsetFromMobile(){this._handlers.MOBILE&&(--this._handlers.MOBILE,Notifier.unsubscribe(this,ViewportCommand.UPDATE))}_domHandler(a,e,h){a.preventDefault();if(!this._disabled){this._read2DMousePos(a);var m=new THREE.Vector2;void 0==a.changedTouches?(m.x=a.movementX,m.y=a.movementY):(m.x=this._currentPointer2DPos.x-this._previousPointer2DPos.x,m.y=this._currentPointer2DPos.y-
this._previousPointer2DPos.y,this._previousPointer2DPos=this._currentPointer2DPos);"MOVE"==e&&this._handlers.LONG&&m.lengthSq()>=PointerManager._MOUSE_MOVE_THRESHOLD_SQ&&window.clearTimeout(this._longPressTimeout);m={clickPos:this._currentPointer2DPos,movement:m};h?(m.isPrimary=this._isPrimaryControl(a),m.isSecondary=this._isSecondaryControl(a),m.isSecondary&&"START"==e&&a.touches&&(m.distance=this._distanceBetweenTouches(a))):"touchmove"==a.type&&1!=a.touches.length&&(m.distance=this._distanceBetweenTouches(a));
Notifier.unleash(PointerCommand[e],m)}}_isPrimaryControl(a){return a.changedTouches?null==this._mainTouchId||this._mainTouchId==a.changedTouches[0].identifier:null!=a.button?0==a.button:!1}_isSecondaryControl(a){return a.changedTouches?null!=this._mainTouchId&&this._mainTouchId!=a.changedTouches[0].identifier:2==a.button}_distanceBetweenTouches(a){let e=new THREE.Vector2(a.touches[0].pageX,a.touches[0].pageY);a=new THREE.Vector2(a.touches[1].pageX,a.touches[1].pageY);return e.distanceTo(a)}_read2DMousePos(a){let e=
void 0!=a.changedTouches,h=e?a.changedTouches[0].clientX:a.clientX;a=e?a.changedTouches[0].clientY:a.clientY;this._debugEvents&&this._handleDebug(h,a);this.hasChanged();this._currentPointer2DPos=new THREE.Vector2(h,a)}_update3DMousePos(){this._currentPointer3DPos=this.get3DMousePos()}get3DMousePos(){if(!this._currentPointer2DPos)return null;var a=View3D.inst.dom.getBoundingClientRect();let e=(this._currentPointer2DPos.x-a.left)/a.width;a=(this._currentPointer2DPos.y-a.top)/a.height;return(new THREE.Vector3).set(2*
e-1,2*-a+1,1)}_setDebugDivs(){this._clickVisualizer=this.__setDiv();this._dataVisualizer=this.__setDiv();this._clickVisualizer.style.right="";this._clickVisualizer.style.bottom="";this._clickVisualizer.style.fontSize="12px";this._clickVisualizer.style.backgroundColor="yellow";this._clickVisualizer.innerHTML="&nbsp;&nbsp;"}__setDiv(){let a=document.createElement("div");a.style.position="absolute";a.style.zIndex="100000";a.style.left="0px";a.style.bottom="0px";a.style.backgroundColor="red";a.style.fontSize=
"24px";a.style.color="black";a.style.fontFamily="sans-serif";View3D.inst.dom.appendChild(a);return a}_handleDebug(a,e){let h=View3D.inst.dom.getBoundingClientRect();this._dataVisualizer.innerHTML="clickX: "+Math.round(a)+"<br/>clickY: "+Math.round(e)+"<br/>left: "+h.left+"<br/>right: "+h.right+"<br/>top: "+h.top+"<br/>bottom: "+h.bottom+"<br/>width: "+h.width+"<br/>height: "+h.height;this._clickVisualizer.style.left=a+"px";this._clickVisualizer.style.top=e-12+"px"}}
PointerManager._LONG_PRESS_DURATION=300;PointerManager._MOUSE_MOVE_THRESHOLD=3;PointerManager._MOUSE_MOVE_THRESHOLD_SQ=PointerManager._MOUSE_MOVE_THRESHOLD*PointerManager._MOUSE_MOVE_THRESHOLD;class SceneARData extends AbstractScriptParser{constructor(){super(...arguments);this.ar=!1;this.scale=.02}static getFromName(a){return this.loopOnKeys(this.extractBaseCode(a,"ar"),new SceneARData)}parseVal(a,e){this.ar=!0;e=parseFloat(e);"scale"==a&&(this.scale=e)}}
class WebARManager{constructor(){this._xrReferenceSpace=this._xrViewerSpace=this._hitTestSource=null;this.onClick=a=>{this._reticule.positionSet&&(PointerManager.inst.setFromAR(a),InteractionTracker.inst.castInteraction())};this.onSelect=a=>{this._reticule.enabled&&this._reticule.visible&&(View3D.inst.sceneRef.position.setFromMatrixPosition(this._reticule.positionMatrix),View3D.inst.sceneRef.updateMatrix(),View3D.inst.sceneRef.visible=!0,this._reticule.resetReticule())};this._scene=View3D.inst.scene;
this._renderer=View3D.inst.renderer}init(a){this._reticule=new WebARReticule(this._renderer,this._scene);a.requestReferenceSpace("viewer").then(m=>{this._xrViewerSpace=m;return a.requestHitTestSource({space:m})}).then(m=>{this._hitTestSource=m}).catch(m=>{console.warn("Immersive AR reference Space (Viewer) request error",m);WebVRUtils.endSession();Notifier.unleash(InitCommand.VR_STARTED)});a.requestReferenceSpace("local").then(m=>{this._xrReferenceSpace=m;WebVRUtils.xrReferenceSpace=m;this._reticule.referenceSpace=
m}).catch(m=>{console.warn("Immersive AR reference Space (Local) request error",m);WebVRUtils.endSession();Notifier.unleash(InitCommand.VR_STARTED)});a.addEventListener("end",()=>{this._arController.removeEventListener("select",this.onSelect);View3D.inst.dom.removeEventListener("click",this.onClick);View3D.inst.sceneRef.remove(this._arController);this._hitTestSource=null});this._reticule.initReticule();View3D.inst.skyboxContainer.visible=!1;View3D.inst.sceneRef.visible=!1;let e=1,h=SceneARData.getFromName(Config.currentScene.name);
h&&(e=h.scale);View3D.inst.sceneRef.scale.set(e,e,e);View3D.inst.camera.near=1E-4;this._arController=this._renderer.xr.getController(0);this._arController.addEventListener("select",this.onSelect);View3D.inst.dom.addEventListener("click",this.onClick);View3D.inst.sceneRef.add(this._arController)}render(a){this._currentMatrix=null;if(this._reticule.enabled){let e=a.getViewerPose(this._xrReferenceSpace);this._hitTestSource&&e&&(a=a.getHitTestResults(this._hitTestSource),a.length&&(this._currentMatrix=
(new THREE.Matrix4).fromArray(a[0].getPose(this._xrReferenceSpace).transform.matrix)));this._currentMatrix?this._reticule.updatePosition(this._currentMatrix):this._reticule.visible=!1}}}var SessionType;(function(a){a[a.WebXR=0]="WebXR";a[a.WebXR_AR=1]="WebXR_AR";a[a.NONE=2]="NONE"})(SessionType||={});var HMDType;
(function(a){a[a.NONE=0]="NONE";a[a.DESKTOP_HMD=1]="DESKTOP_HMD";a[a.NO_CONTROLLER_MOBILE_HMD=2]="NO_CONTROLLER_MOBILE_HMD";a[a.SINGLE_ONE_BT_MOBILE_HMD=3]="SINGLE_ONE_BT_MOBILE_HMD";a[a.SINGLE_TWO_BT_MOBILE_HMD=4]="SINGLE_TWO_BT_MOBILE_HMD";a[a.DUAL_MOBILE_HMD=5]="DUAL_MOBILE_HMD"})(HMDType||={});
class WebVRUtils{static set xrFrame(a){this._xrFrame=a;this._arManager&&this._arManager.render(a)}static set xrReferenceSpace(a){this._referenceSpace=a}static get sessionType(){return this._sessionType}static get hasMovement(){return!!this._xrSession}static get hasHMD(){return null!=this._hmdType&&this._hmdType!=HMDType.NO_CONTROLLER_MOBILE_HMD||this._sessionType==SessionType.WebXR||this._sessionType==SessionType.WebXR_AR}static get hmdType(){return this._hmdType}static get isDesktopHMD(){return this._hmdType==
HMDType.DESKTOP_HMD}static get isMobileHMD(){return this._hmdType==HMDType.SINGLE_ONE_BT_MOBILE_HMD||this._hmdType==HMDType.SINGLE_TWO_BT_MOBILE_HMD}static get isDualMobileHMD(){return this._hmdType==HMDType.DUAL_MOBILE_HMD}static get isLikeCardboard(){return null==this._hmdType||this._hmdType==HMDType.NONE||this._hmdType==HMDType.NO_CONTROLLER_MOBILE_HMD}static parseXRProfile(a){return null==a?Device.isMobile()?HMDType.DUAL_MOBILE_HMD:HMDType.DESKTOP_HMD:this.WEBXR_PROFILE_DAYDREAM.test(a)?HMDType.SINGLE_ONE_BT_MOBILE_HMD:
this.WEBXR_PROFILE_OCULUS_GO.test(a)||this.WEBXR_PROFILE_OCULUS_GEARVR.test(a)?HMDType.SINGLE_TWO_BT_MOBILE_HMD:this.WEBXR_PROFILE_OCULUS_QUEST.test(a)||this.WEBXR_PROFILE_HTC_FOCUS.test(a)||this.WEBXR_PROFILE_PICO.test(a)?HMDType.DUAL_MOBILE_HMD:this.WEBXR_PROFILE_WMR.test(a)||this.WEBXR_PROFILE_HTC_VIVE.test(a)||this.WEBXR_PROFILE_OCULUS_RIFT.test(a)?HMDType.DESKTOP_HMD:null}static parseProfile(a,e){this._sessionType!=SessionType.NONE&&(this._hmdType=this.parseXRProfile(a)||this.parseXRProfile(e))}static init(a,
e){this._arMode=e;this._initWebXR()}static _initWebXR(){navigator.xr?navigator.xr.isSessionSupported(this._arMode?"immersive-ar":"immersive-vr").then(a=>{if(a)return this._initialized(this._arMode?SessionType.WebXR_AR:SessionType.WebXR);this._initialized(SessionType.NONE)}).catch(a=>{console.warn("Unable to get WebXR session",a);this._initialized(SessionType.NONE)}):this._initialized(SessionType.NONE)}static _initialized(a){console.info("VR session type:",SessionType[a]);this._sessionType=a;this.parseProfile();
Notifier.unleash(InitCommand.VR_INIT_TESTED)}static start(){this._sessionType==SessionType.WebXR?navigator.xr.requestSession("immersive-vr",{optionalFeatures:["local-floor","bounded-floor"]}).then(a=>{this._xrSession=a;View3D.inst.renderer.xr.enabled=!0;View3D.inst.renderer.xr.setReferenceSpaceType("local-floor");View3D.inst.renderer.xr.setSession(a);window.addEventListener("beforeunload",()=>{this._xrSession&&this.endSession()});let e=()=>{a.removeEventListener("inputsourceschange",e);this.handleXRSessionInit(a.inputSources)};
a.addEventListener("inputsourceschange",e);return a.requestReferenceSpace("local-floor")}).then(a=>{this._referenceSpace=a}).catch(a=>{console.warn("Unable to start WebXR session",a);this.endSession();Notifier.unleash(InitCommand.VR_STARTED)}):this._sessionType==SessionType.WebXR_AR?navigator.xr.requestSession("immersive-ar",{requiredFeatures:["local","hit-test"],optionalFeatures:["dom-overlay"],domOverlay:{root:document.body}}).then(a=>{this._xrSession=a;View3D.inst.renderer.xr.enabled=!0;View3D.inst.renderer.xr.setReferenceSpaceType("local");
View3D.inst.renderer.xr.setSession(a);this._arManager=new WebARManager;this._arManager.init(a);Notifier.unleash(InitCommand.VR_STARTED)}).catch(a=>{console.warn("Unable to start WebXR AR session",a);this.endSession();Notifier.unleash(InitCommand.VR_STARTED)}):this._sessionType==SessionType.NONE&&(this.endSession(),Notifier.unleash(InitCommand.VR_STARTED))}static handleXRSessionInit(a){a&&a[0]&&a[0].profiles&&this.parseProfile(a[0].profiles[0],a[0].profiles[1]);Notifier.unleash(InitCommand.VR_STARTED)}static endSession(){switch(this._sessionType){case SessionType.WebXR:case SessionType.WebXR_AR:this._xrSession.end().catch(()=>
{console.log("Failed to exit XR")})}this._arManager=this._referenceSpace=this._hmdType=null;this._sessionType=SessionType.NONE;Config.STARTED_IN_VR=!1;console.info("VR stopped")}static getGamepads(){switch(this._sessionType){case SessionType.WebXR:case SessionType.WebXR_AR:return this._xrSession.inputSources;default:return null}}static findGamepadDetails(a){var e;switch(this._sessionType){case SessionType.WebXR:case SessionType.WebXR_AR:let h=this._xrSession.inputSources,m=null;if(h||h.length){for(let t=
0,y=0;t<h.length;++t)if(h[t].gamepad&&y++==a){m=h[t];break}if(m&&m.gripSpace)return[m.gamepad,null===(e=this._xrFrame.getPose(m.gripSpace,this._referenceSpace))||void 0===e?void 0:e.transform]}}return null}}WebVRUtils._arMode=!1;WebVRUtils._sessionType=SessionType.NONE;WebVRUtils._hmdType=null;WebVRUtils._xrSession=null;WebVRUtils._referenceSpace=null;WebVRUtils._xrFrame=null;WebVRUtils.WEBXR_PROFILE_HTC_VIVE=/htc-vive-controller-mv/ig;WebVRUtils.WEBXR_PROFILE_HTC_FOCUS=/htc-vive-focus/ig;
WebVRUtils.WEBXR_PROFILE_DAYDREAM=/google-daydream/ig;WebVRUtils.WEBXR_PROFILE_PICO=/pico/ig;WebVRUtils.WEBXR_PROFILE_OCULUS_RIFT=/oculus-touch/ig;WebVRUtils.WEBXR_PROFILE_OCULUS_QUEST=/oculus-touch/ig;WebVRUtils.WEBXR_PROFILE_OCULUS_GO=/oculus-go/ig;WebVRUtils.WEBXR_PROFILE_OCULUS_GEARVR=/samsung-gearvr/ig;WebVRUtils.WEBXR_PROFILE_WMR=/(?:microsoft|windows)-mixed-reality/ig;
var ColorifyShader={uniforms:{tDiffuse:{type:"t",value:null},color:{type:"c",value:new THREE.Color(16777215)},opacity:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float opacity;\nuniform vec3 color;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\nvec3 luma = vec3( 0.299, 0.587, 0.114 );\nfloat v = dot( texel.xyz, luma );\nvec3 finalColor = vec3(\n(opacity * v * color.x) + ((1.0 - opacity) * texel.x),\n(opacity * v * color.y) + ((1.0 - opacity) * texel.y),\n(opacity * v * color.z) + ((1.0 - opacity) * texel.z)\n);\ngl_FragColor = vec4( finalColor, texel.w );\n}"};
class VRDualEffect{constructor(a){this._stereoCamera=new THREE.StereoCamera;this._size=new THREE.Vector2;this._renderer=a;this._renderer.autoClear=!0;this._stereoCamera.aspect=.5}setEyeSeparation(a){this._stereoCamera.eyeSep=a}setSize(a,e){this._renderer.setSize(a,e)}render(a,e,h,m){let t=this._renderer.getRenderTarget(),y=a.onAfterRender;a.onAfterRender=()=>{};a.updateMatrixWorld();null===e.parent&&e.updateMatrixWorld();this._stereoCamera.update(e);this._renderer.getSize(this._size);var C=this._size.x/
2;e=new THREE.Vector4(0,0,C,this._size.y);C=new THREE.Vector4(C,0,C,this._size.y);this._renderer.setRenderTarget(null);this._renderer.autoClear&&this._renderer.clear();this._renderer.setScissorTest(!0);this._renderer.setScissor(e);this._renderer.setViewport(e);this._renderer.render(a,this._stereoCamera.cameraL);this._renderer.setScissor(C);this._renderer.setViewport(C);this._renderer.render(a,this._stereoCamera.cameraR);this._renderer.setScissorTest(!1);m&&h&&(this._renderer.getContext().disable(this._renderer.getContext().DEPTH_TEST),
e=e.clone(),e.x+=4,this._renderer.setViewport(e),this._renderer.render(h,m),e=C.clone(),e.x-=4,this._renderer.setViewport(e),this._renderer.render(h,m),this._renderer.getContext().enable(this._renderer.getContext().DEPTH_TEST),this._renderer.setRenderTarget(t));a.onAfterRender=y}}
class RenderingController{constructor(a,e,h){this._intensity={value:0};this.onAfterRender=()=>{};this._renderer=a;this._scene=e;this._camera=h;this.initPostProcessing()}addHUDRendering(a,e){this._hudCamera=e;this._hudScene=a}addDualEffect(){let a=View3D.inst;this._cardboardDualEffect=new VRDualEffect(a.renderer);this._cardboardDualEffect.setSize(a.dom.offsetWidth,a.dom.offsetHeight)}addPass(a){this._effectComposer.insertPass(a,this._effectComposer.passes.length-1)}removePass(a){for(let e=0;e<this._effectComposer.passes.length;e++)if(this._effectComposer.passes[e]===
a){this._effectComposer.passes.splice(e,1);break}}deselectInOutlinePass(a){if(this._outlinePass){var e=this._outlinePass.contouredObjects,h=this._outlinePass.invisibleObjects,m;if(0<=(m=e.indexOf(a)))e.splice(m,1);else if(0<=(m=h.indexOf(a)))h.splice(m,1);else return;0==e.length+h.length&&(this.removePass(this._outlinePass),this._outlinePass=null)}}selectInOutlinePass(a,e){let h=this._renderer.xr.enabled&&this._renderer.xr.session?this._renderer.xr.getCamera(View3D.inst.camera):this._camera;this._outlinePass||
(this._outlinePass=new THREE.OutlinePass(this.getResolution(),this._scene,h),this._outlinePass.edgeThickness=1,this.addPass(this._outlinePass));e?this._outlinePass.contouredObjects.push(a):this._outlinePass.invisibleObjects.push(a)}resize(a,e){var h;this._cardboardDualEffect&&this._cardboardDualEffect.setSize(a,e);if(this._effectComposer){if(null===(h=this._antialiasPass)||void 0===h?0:h.material)h=this._antialiasPass.material.uniforms.resolution.value,h.x=1/a,h.y=1/e;this._effectComposer.setSize(a,
e)}WebVRUtils.hasHMD?(this._hudCamera.left=-a/4,this._hudCamera.right=a/4):(this._hudCamera.left=-a/2,this._hudCamera.right=a/2);this._hudCamera.top=e/2;this._hudCamera.bottom=-e/2;this._hudCamera.updateProjectionMatrix()}getResolution(){return this._renderer.getSize(new THREE.Vector2)}initPostProcessing(){this._effectComposer=new THREE.EffectComposer(this._renderer);this._colorPass=new THREE.ShaderPass(ColorifyShader);this._colorPass.enabled=!1;this._colorPass.uniforms.color.value.setHex(0);this._colorPass.uniforms.opacity.value=
0;this._colorPass.name="Colorify shader";this._effectComposer.addPass(this._colorPass);this._antialiasPass=new THREE.ShaderPass(THREE.FXAAShader);if(this._antialiasPass.material){let e=this.getResolution(),h=this._antialiasPass.material.uniforms.resolution.value;h.x=1/e.x;h.y=1/e.y}this._antialiasPass.renderToScreen=!0;this._antialiasPass.needsSwap=!1;this._antialiasPass.name="FXAAShader shader";this._effectComposer.addPass(this._antialiasPass);let a=!1;View3D.inst.scene.onAfterRender=(e,h,m)=>{e!=
this._renderer||a||(a=!0,this._outlinePass&&(this._outlinePass.renderCamera=m),this._effectComposer.render(.1),a=!1)}}render(){this._cardboardDualEffect?this._cardboardDualEffect.render(this._scene,this._camera,this._hudScene,this._hudCamera):this._renderer.render(this._scene,this._camera);this.onAfterRender()}show(a,e){this._renderer.setRenderTarget(null);if(this._currentMove!=FadeAction.SHOW){this._currentMove=FadeAction.SHOW;if(1==this._intensity.value)return this.fadeEndCallback(e);this._colorPass.enabled=
!0;(new TWEEN.Tween(this._intensity)).to({value:1},a).easing(TWEEN.Easing.Quartic.In).onUpdate(()=>{this._colorPass.uniforms.opacity.value=this._intensity.value}).onComplete(()=>{this.fadeEndCallback(e)}).start()}}hide(a,e){this._renderer.setRenderTarget(this._effectComposer.readBuffer);if(this._currentMove!=FadeAction.HIDE){this._currentMove=FadeAction.HIDE;if(0==this._intensity.value)return this.fadeEndCallback(e);this._colorPass.enabled=!0;(new TWEEN.Tween(this._intensity)).to({value:0},a).easing(TWEEN.Easing.Quartic.Out).onUpdate(()=>
{this._colorPass.uniforms.opacity.value=this._intensity.value}).onComplete(()=>{this.fadeEndCallback(e)}).start()}}fadeEndCallback(a){this._colorPass.enabled=this._currentMove==FadeAction.SHOW;this._currentMove=FadeAction.NONE;a&&a()}}
class HUDMap extends Notifiable{constructor(){super();this._mapSize=new THREE.Vector2;this._hudGroup=new THREE.Group;this._hudGroup.name="HudGroup";this._hudGroup.position.z=.9;View3D.inst.hudScene.add(this._hudGroup);this._hudMap=new THREE.Group;this._hudMap.name="HudMap";this._hudGroup.add(this._hudMap);this._hudMapPoints=new THREE.Group;this._hudMapPoints.name="HudMapPoints";this._hudMap.add(this._hudMapPoints);Notifier.subscribe(this,InitCommand.HUD_LOAD_END)}create(){this._sizeDivisor=1==Device.isPhone()?
4:3;(new THREE.TextureLoader).load("./assets/hud/map-background.png",a=>{a.generateMipmaps=!1;a.magFilter=THREE.LinearFilter;a.minFilter=THREE.LinearFilter;this._hudMaterial=new THREE.SpriteMaterial({map:a});this._mapSprite=new THREE.Sprite(this._hudMaterial);this._mapSprite.position.z=-.004;this._hudMap.add(this._mapSprite);this._mapSize.x=a.image.width;this._mapSize.y=a.image.height;this._hudMap.scale.set(this._mapSize.x/this._sizeDivisor,this._mapSize.y/this._sizeDivisor,1);this._hudMapPoints.position.set(0,
0,.01);this._hudMapPoints.scale.set(1,1,1);this._hudGroup.scale.set(1,1,1);this.resize(View3D.inst.dom.offsetWidth,View3D.inst.dom.offsetHeight)});(new THREE.TextureLoader).load("./assets/hud/map-interestpoint-unknown.png",a=>{a.generateMipmaps=!1;a.magFilter=THREE.LinearFilter;a.minFilter=THREE.LinearFilter;this._ipUnknownMaterial=new THREE.SpriteMaterial;this._ipUnknownMaterial.map=a});Notifier.subscribe(this,ViewportCommand.UPDATE);Notifier.subscribe(this,ViewportCommand.RESIZE);Notifier.subscribe(this,
SceneCommand.GENERATION_FINISHED);Notifier.subscribe(this,SceneCommand.LOAD_START);Notifier.subscribe(this,StatefulCommand.STATEFUL_ELEMENT_CHANGE)}resize(a,e){a/=2;e/=2;WebVRUtils.hasHMD?Config.STARTED_IN_VR?this._hudGroup.position.set(-a/2+this._mapSize.x/this._sizeDivisor*3/2,-e+this._mapSize.y/this._sizeDivisor*3/2,1):this._hudGroup.position.set(-a/2+this._mapSize.x/this._sizeDivisor/2,-e+this._mapSize.y/this._sizeDivisor/2,1):this._hudGroup.position.set(-a+this._mapSize.x/this._sizeDivisor/2,
-e+this._mapSize.y/this._sizeDivisor/2,1)}generatePoints(){this.updatePoints()}removePoints(){if(this._hudMapPoints.children.length){let a;for(let e=this._hudMapPoints.children.length-1;-1<e;e--){a=this._hudMapPoints.children[e];this._hudMapPoints.remove(a);let h=a.material;h&&(h.map.dispose(),h.dispose(),a.geometry.dispose())}}}updatePoints(){let a=Config.simulationData.header;1==a.hudMap.rotateViewPoint&&1==a.hudMap.showViewPoint&&this._mapSprite?this._mapSprite.material.rotation=View3D.inst.camera.rotation.y:
(1==a.hudMap.showNorth&&this._northSprite&&(this._northSprite.material.rotation=-View3D.inst.camera.rotation.y),this._hudMapPoints.traverse(e=>{e.material&&(e.material.rotation=e.userData.baseRotation-View3D.inst.camera.rotation.y-Math.PI/2)}))}notify(a,e){switch(a){case ViewportCommand.UPDATE:this.updatePoints();break;case ViewportCommand.RESIZE:this.resize(View3D.inst.dom.offsetWidth,View3D.inst.dom.offsetHeight);break;case SceneCommand.GENERATION_FINISHED:this.generatePoints();break;case SceneCommand.LOAD_START:this.removePoints();
break;case StatefulCommand.STATEFUL_ELEMENT_CHANGE:this.removePoints();this.generatePoints();break;case InitCommand.HUD_LOAD_END:Notifier.unsubscribe(this,a),this.create()}}}
class BoundingHelper{static getWorldBoundingBox(a){let e=new THREE.Box3;e.setFromObject(a);return e}static getBoxMeshFromObject(a){if(void 0===a)return null;var e=a.parent;a.parent=View3D.inst.elementsContainer;a.updateMatrixWorld();var h=new THREE.Box3;h.setFromObject(a);a.parent=e;if(h.isEmpty())return null;e=new THREE.Vector3;h.getSize(e);a=new THREE.Vector3;h.getCenter(a);h=new THREE.BoxBufferGeometry(e.x,e.y,e.z);e=new THREE.MeshBasicMaterial({color:15658734});h=new THREE.Mesh(h,e);h.position.copy(a);
return h}static getGeometryFromBox(a,e){var h=new Uint16Array([0,1,2,0,2,3,4,0,3,4,3,7,5,4,7,5,7,6,1,5,6,1,6,2,4,1,0,4,1,5,7,2,3,7,2,6]),m=new Float32Array(24);let t=new THREE.BufferGeometry;t.setIndex(new THREE.BufferAttribute(h,1));t.setAttribute("position",new THREE.BufferAttribute(m,3));h=t.attributes.position;m=h.array;m[0]=e.x;m[1]=e.y;m[2]=e.z;m[3]=a.x;m[4]=e.y;m[5]=e.z;m[6]=a.x;m[7]=a.y;m[8]=e.z;m[9]=e.x;m[10]=a.y;m[11]=e.z;m[12]=e.x;m[13]=e.y;m[14]=a.z;m[15]=a.x;m[16]=e.y;m[17]=a.z;m[18]=
a.x;m[19]=a.y;m[20]=a.z;m[21]=e.x;m[22]=a.y;m[23]=a.z;h.needsUpdate=!0;return t}static getMergedGeometry(a,e){let h,m=new THREE.BufferGeometry,t=0;a.traverse(y=>{"Mesh"==y.type&&y.hasOwnProperty("geometry")&&(h=y.geometry,h=BoundingHelper.mergeVertices(h),y.updateMatrix(),m=BoundingHelper.mergeBufferGeometries([h,m],!1),e&&e.push(y.material),t++)});m.computeBoundingBox();return m}static mergeVertices(a,e=1E-4){e=Math.max(e,Number.EPSILON);var h={},m=a.getIndex(),t=a.getAttribute("position"),y=m?m.count:
t.count,C=0;t=Object.keys(a.attributes);let I={},E={},H=[];var O=["getX","getY","getZ","getW"];for(let wa=0,U=t.length;wa<U;wa++){var R=t[wa];I[R]=[];var W=a.morphAttributes[R];W&&(E[R]=Array(W.length).fill(null).map(()=>[]))}e=Math.pow(10,Math.log10(1/e));for(R=0;R<y;R++){W=m?m.getX(R):R;let wa="";for(let U=0,qa=t.length;U<qa;U++){var ea=a.getAttribute(t[U]),T=ea.itemSize;for(var fa=0;fa<T;fa++)wa+=`${~~(ea[O[fa]](W)*e)},`}if(wa in h)H.push(h[wa]);else{for(let U=0,qa=t.length;U<qa;U++){var sa=t[U];
ea=a.getAttribute(sa);T=a.morphAttributes[sa];fa=ea.itemSize;let M=I[sa];sa=E[sa];for(let Q=0;Q<fa;Q++){let V=O[Q];M.push(ea[V](W));if(T)for(let ca=0,za=T.length;ca<za;ca++)sa[ca].push(T[ca][V](W))}}h[wa]=C;H.push(C);C++}}h=a.clone();for(let wa=0,U=t.length;wa<U;wa++)if(m=t[wa],y=a.getAttribute(m),C=new y.array.constructor(I[m]),y=new THREE.BufferAttribute(C,y.itemSize,y.normalized),h.setAttribute(m,y),m in E)for(y=0;y<E[m].length;y++)C=a.morphAttributes[m][y],O=new C.array.constructor(E[m][y]),C=
new THREE.BufferAttribute(O,C.itemSize,C.normalized),h.morphAttributes[m][y]=C;h.setIndex(H);return h}static mergeBufferGeometries(a,e){var h=null!==a[0].index,m=new Set(Object.keys(a[0].attributes)),t=new Set(Object.keys(a[0].morphAttributes)),y={};let C={};var I=a[0].morphTargetsRelative;let E=new THREE.BufferGeometry,H=0;for(let W=0;W<a.length;++W){var O=a[W];let ea=0;if(h!==(null!==O.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+
W+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let T in O.attributes){if(!m.has(T))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+W+'. All geometries must have compatible attributes; make sure "'+T+'" attribute exists among all geometries, or in none of them.'),null;void 0===y[T]&&(y[T]=[]);y[T].push(O.attributes[T]);ea++}if(ea!==m.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+
W+". Make sure all geometries have the same number of attributes."),null;if(I!==O.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+W+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let T in O.morphAttributes){if(!t.has(T))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+W+".  .morphAttributes must be consistent throughout all geometries."),
null;void 0===C[T]&&(C[T]=[]);C[T].push(O.morphAttributes[T])}E.userData.mergedUserData=E.userData.mergedUserData||[];E.userData.mergedUserData.push(O.userData);if(e){if(h)O=O.index.count;else if(void 0!==O.attributes.position)O=O.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+W+". The geometry must have either an index or a position attribute"),null;E.addGroup(H,O,W);H+=O}}if(h){e=0;h=[];for(m=0;m<a.length;++m){t=
a[m].index;for(I=0;I<t.count;++I)h.push(t.getX(I)+e);e+=a[m].attributes.position.count}E.setIndex(h)}for(var R in y){a=BoundingHelper.mergeBufferAttributes(y[R]);if(!a)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+R+" attribute."),null;E.setAttribute(R,a)}for(let W in C){y=C[W][0].length;if(0===y)break;E.morphAttributes=E.morphAttributes||{};E.morphAttributes[W]=[];for(R=0;R<y;++R){a=[];for(e=0;e<C[W].length;++e)a.push(C[W][e][R]);a=this.mergeBufferAttributes(a);
if(!a)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+W+" morphAttribute."),null;E.morphAttributes[W].push(a)}}return E}static mergeBufferAttributes(a){let e,h;var m=0;for(var t=0;t<a.length;++t){let C=a[t];if(C.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===y)var y=C.array.constructor;if(y!==C.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),
null;void 0===e&&(e=C.itemSize);if(e!==C.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;void 0===h&&(h=C.normalized);if(h!==C.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;m+=C.array.length}y=new y(m);m=0;for(t=0;t<a.length;++t)y.set(a[t].array,m),m+=
a[t].array.length;return new THREE.BufferAttribute(y,e,h)}}
class InteractionTracker extends UpdateMutex{constructor(){super(PointerCommand.NEED_UPDATE);this._remapNeeded=!1;this._trackedObjects=new PersistentDictionary;this._activeTrackedObjects=[];this._currentIntersection=this._currentElement=null;if(null!=InteractionTracker._inst)throw Error("InteractionTracker is a singleton");Notifier.subscribe(this,SceneCommand.LOAD_START)}static get inst(){return this._inst||(this._inst=new InteractionTracker)}get interactedElement(){this.update();return this._currentElement}get currentIntersection(){this.update();
return this._currentIntersection}get isStarted(){return!!this._startPoint}notify(a,e){switch(a){case PointerCommand.NEED_UPDATE:super.notify(a);break;case ViewportCommand.UPDATE:this._remapNeeded&&this._setActiveTrackedObjects();break;case PointerCommand.START:if(!e.isPrimary)break;this._startPoint=e.clickPos.clone();break;case PointerCommand.END:if(!e.isPrimary||!this._startPoint||DragNDrop.inst.isDragging)break;this._startPoint.distanceTo(e.clickPos)<PointerManager._MOUSE_MOVE_THRESHOLD&&this.castInteraction();
this._startPoint=null;break;case SceneCommand.LOAD_START:this.removeAll()}}update(){if(!this.upToDate){this.upToDate=!0;var a=PointerManager.inst.rayCaster.intersectObjects(this._activeTrackedObjects);if(a.length)for(let e=0;e<a.length;e++){let h=LiveElementsRefHolder.inst.getRef(a[e].object.userData.owneruuid);if(h&&h.interactive){this._currentElement=h;this._currentIntersection=a[e];return}}this._currentIntersection=this._currentElement=null}}castInteraction(){this.update();this._currentElement&&
this._currentElement.interaction(StatementTrigger.CLICK,this._currentIntersection.point)}add(a,e){let h=a.children;for(let m=0;m<h.length;++m){let t=h[m];if(a.type==StatefulElementType.MESH){let y=BoundingHelper.getBoxMeshFromObject(t);y?(y.userData.owneruuid=a.uuid,y.userData.uuid=t.userData.uuid,y.material.visible=!1,y.name=a.container.name+"/"+t.userData.name+" - Helper",a.container.add(y),this._trackedObjects.add(t.uuid,y,e)):(console.error("Failed to create a BoundingBox for object",a.data.name),
t.userData.owneruuid=a.uuid,this._trackedObjects.add(t.uuid,t,e))}else t.traverse(y=>{t.uuid!=y.uuid&&(y.userData.owneruuid=a.uuid,y.userData.uuid=t.userData.uuid,this._trackedObjects.add(y.uuid,y,e))})}}remove(a){let e=a.children;for(let h=0;h<e.length;++h){let m=e[h];a.type==StatefulElementType.MESH?this._trackedObjects.remove(m.uuid):m.traverse(t=>{t.userData.owneruuid=a.uuid;this._trackedObjects.remove(t.uuid)})}}removeAll(){this._activeTrackedObjects=[];this._trackedObjects.empty();this.hasChanged()}_setActiveTrackedObjects(){this._remapNeeded=
!1;this._activeTrackedObjects=[];this._trackedObjects.traverse(a=>{var e=a.userData.owneruuid;e&&(e=LiveElementsRefHolder.inst.getRef(e),e.visible&&e.currentAspectId==a.userData.uuid&&this._activeTrackedObjects.push(a))});Notifier.unsubscribe(this,ViewportCommand.UPDATE);this.hasChanged()}requestTrackedObjectsRemap(){this._remapNeeded||(this._remapNeeded=!0,Notifier.subscribe(this,ViewportCommand.UPDATE))}initDomEventHandlers(){PointerManager.inst.setStartHandler(this);PointerManager.inst.setEndHandler(this)}unsetDomEventHandlers(){PointerManager.inst.unsetEndHandler(this);
PointerManager.inst.unsetStartHandler(this)}}class PCSS{}PCSS.PCSS_shader_replacement="\n        #define LIGHT_WORLD_SIZE 0.005\n        #define LIGHT_FRUSTUM_WIDTH 3.75\n        #define LIGHT_SIZE_UV (LIGHT_WORLD_SIZE / LIGHT_FRUSTUM_WIDTH)\n        #define NEAR_PLANE 9.5\n        #define NUM_SAMPLES 17\n        #define NUM_RINGS 11\n        #define BLOCKER_SEARCH_NUM_SAMPLES NUM_SAMPLES\n        #define PCF_NUM_SAMPLES NUM_SAMPLES\n        vec2 poissonDisk[NUM_SAMPLES];\n        void initPoissonSamples( const in vec2 randomSeed ) {\n            float ANGLE_STEP = PI2 * float( NUM_RINGS ) / float( NUM_SAMPLES );\n            float INV_NUM_SAMPLES = 1.0 / float( NUM_SAMPLES );\n            // jsfiddle that shows sample pattern: https://jsfiddle.net/a16ff1p7/\n            float angle = rand( randomSeed ) * PI2;\n            float radius = INV_NUM_SAMPLES;\n            float radiusStep = radius;\n            for( int i = 0; i < NUM_SAMPLES; i ++ ) {\n                poissonDisk[i] = vec2( cos( angle ), sin( angle ) ) * pow( radius, 0.75 );\n                radius += radiusStep;\n                angle += ANGLE_STEP;\n            }\n        }\n        float penumbraSize( const in float zReceiver, const in float zBlocker ) { // Parallel plane estimation\n            return (zReceiver - zBlocker) / zBlocker;\n        }\n        float findBlocker( sampler2D shadowMap, const in vec2 uv, const in float zReceiver ) {\n            // This uses similar triangles to compute what\n            // area of the shadow map we should search\n            float searchRadius = LIGHT_SIZE_UV * ( zReceiver - NEAR_PLANE ) / zReceiver;\n            float blockerDepthSum = 0.0;\n            int numBlockers = 0;\n            for( int i = 0; i < BLOCKER_SEARCH_NUM_SAMPLES; i++ ) {\n                float shadowMapDepth = unpackRGBAToDepth(texture2D(shadowMap, uv + poissonDisk[i] * searchRadius));\n                if ( shadowMapDepth < zReceiver ) {\n                    blockerDepthSum += shadowMapDepth;\n                    numBlockers ++;\n                }\n            }\n            if( numBlockers == 0 ) return -1.0;\n            return blockerDepthSum / float( numBlockers );\n        }\n        float PCF_Filter(sampler2D shadowMap, vec2 uv, float zReceiver, float filterRadius ) {\n            float sum = 0.0;\n            for( int i = 0; i < PCF_NUM_SAMPLES; i ++ ) {\n                float depth = unpackRGBAToDepth( texture2D( shadowMap, uv + poissonDisk[ i ] * filterRadius ) );\n                if( zReceiver <= depth ) sum += 1.0;\n            }\n            for( int i = 0; i < PCF_NUM_SAMPLES; i ++ ) {\n                float depth = unpackRGBAToDepth( texture2D( shadowMap, uv + -poissonDisk[ i ].yx * filterRadius ) );\n                if( zReceiver <= depth ) sum += 1.0;\n            }\n            return sum / ( 2.0 * float( PCF_NUM_SAMPLES ) );\n        }\n        float PCSS ( sampler2D shadowMap, vec4 coords ) {\n            vec2 uv = coords.xy;\n            float zReceiver = coords.z; // Assumed to be eye-space z in this code\n            initPoissonSamples( uv );\n            // STEP 1: blocker search\n            float avgBlockerDepth = findBlocker( shadowMap, uv, zReceiver );\n            //There are no occluders so early out (this saves filtering)\n            if( avgBlockerDepth == -1.0 ) return 1.0;\n            // STEP 2: penumbra size\n            float penumbraRatio = penumbraSize( zReceiver, avgBlockerDepth );\n            float filterRadius = penumbraRatio * LIGHT_SIZE_UV * NEAR_PLANE / zReceiver;\n            // STEP 3: filtering\n            //return avgBlockerDepth;\n            return PCF_Filter( shadowMap, uv, zReceiver, filterRadius );\n        }\n        ";
PCSS.PCSS_GET_SHADOW_shader_replacement="\n        return PCSS( shadowMap, shadowCoord );\n        ";
class RectAreaLightUniformsLib{static init(){var a=new THREE.DataTexture(new Float32Array([1,0,0,2E-5,1,0,0,5.03905E-4,1,0,0,.00201562,1,0,0,.00453516,1,0,0,.00806253,1,0,0,.0125978,1,0,0,.018141,1,0,0,.0246924,1,0,0,.0322525,1,0,0,.0408213,1,0,0,.0503999,1,0,0,.0609894,1,0,0,.0725906,1,0,0,.0852058,1,0,0,.0988363,1,0,0,.113484,1,0,0,.129153,1,0,0,.145839,1,0,0,.163548,1,0,0,.182266,1,0,0,.201942,1,0,0,.222314,1,0,0,.241906,1,0,0,.262314,1,0,0,.285754,1,0,0,.310159,1,0,0,.335426,1,0,0,.361341,1,0,
0,.387445,1,0,0,.412784,1,0,0,.438197,1,0,0,.466966,1,0,0,.49559,1,0,0,.523448,1,0,0,.549938,1,0,0,.57979,1,0,0,.608746,1,0,0,.636185,1,0,0,.664748,1,0,0,.69313,1,0,0,.71966,1,0,0,.747662,1,0,0,.774023,1,0,0,.799775,1,0,0,.825274,1,0,0,.849156,1,0,0,.873248,1,0,0,.89532,1,0,0,.917565,1,0,0,.937863,1,0,0,.958139,1,0,0,.976563,1,0,0,.994658,1,0,0,1.0112,1,0,0,1.02712,1,0,0,1.04189,1,0,0,1.05568,1,0,0,1.06877,1,0,0,1.08058,1,0,0,1.09194,1,0,0,1.10191,1,0,0,1.11161,1,0,0,1.1199,1,0,0,1.12813,.999547,
-4.48815E-7,.0224417,1.99902E-5,.999495,-1.13079E-5,.0224406,5.03651E-4,.999496,-4.52317E-5,.0224406,.00201461,.999496,-1.01772E-4,.0224406,.00453287,.999495,-1.80928E-4,.0224406,.00805845,.999497,-2.82702E-4,.0224406,.0125914,.999496,-4.07096E-4,.0224406,.0181319,.999498,-5.54114E-4,.0224406,.02468,.999499,-7.23768E-4,.0224406,.0322363,.999495,-9.16058E-4,.0224405,.0408009,.999499,-.00113101,.0224408,.050375,.999494,-.00136863,.0224405,.0609586,.999489,-.00162896,.0224401,.0725537,.999489,-.00191201,
.0224414,.0851619,.999498,-.00221787,.0224413,.0987867,.999492,-.00254642,.0224409,.113426,.999507,-.00289779,.0224417,.129088,.999494,-.0032716,.0224386,.145767,.999546,-.0036673,.0224424,.163472,.999543,-.00408166,.0224387,.182182,.999499,-.00450056,.0224338,.201843,.999503,-.00483661,.0224203,.222198,.999546,-.00452928,.022315,.241714,.999508,-.00587403,.0224329,.262184,.999509,-.00638806,.0224271,.285609,.999501,-.00691028,.0224166,.309998,.999539,-.00741979,.0223989,.335262,.999454,-.00786282,
.0223675,.361154,.999529,-.00811928,.0222828,.387224,.999503,-.00799941,.0221063,.41252,.999561,-.00952753,.0223057,.438006,.999557,-.0099134,.0222065,.466735,.999541,-.0100935,.0220402,.495332,.999562,-.00996821,.0218067,.523197,.999556,-.0105031,.0217096,.550223,.999561,-.0114191,.0217215,.579498,.999588,-.0111818,.0213357,.608416,.999633,-.0107725,.0208689,.635965,.999527,-.0121671,.0210149,.664476,.999508,-.0116005,.020431,.692786,.999568,-.0115604,.0199791,.719709,.999671,-.0121117,.0197415,
.74737,.999688,-.0110769,.0188846,.773692,.99962,-.0122368,.0188452,.799534,.999823,-.0110325,.0178001,.825046,.999599,-.0114923,.0174221,.849075,.999619,-.0105923,.0164345,.872999,.999613,-.0105988,.0158227,.895371,.99964,-.00979861,.0148131,.917364,.99977,-.00967238,.0140721,.938002,.999726,-.00869175,.0129543,.957917,.99973,-.00866872,.0122329,.976557,.999773,-.00731956,.0108958,.994459,.999811,-.00756027,.0102715,1.01118,.999862,-.00583732,.00878781,1.02701,.999835,-.00631438,.00827529,1.04186,
.999871,-.00450785,.00674583,1.05569,.999867,-.00486079,.00621041,1.06861,.999939,-.00322072,.00478301,1.08064,.999918,-.00318199,.00406395,1.09181,1.00003,-.00193348,.00280682,1.10207,.999928,-.00153729,.00198741,1.11152,.999933,-6.23666E-4,9.17714E-4,1.12009,1,-1.02387E-6,9.07581E-7,1.12813,.997866,-8.96716E-7,.0448334,1.99584E-5,.997987,-2.25945E-5,.0448389,5.02891E-4,.997987,-9.03781E-5,.0448388,.00201156,.997985,-2.03351E-4,.0448388,.00452602,.997986,-3.61514E-4,.0448388,.00804629,.997987,-5.6487E-4,
.0448389,.0125724,.997988,-8.13423E-4,.0448389,.0181045,.997984,-.00110718,.0448387,.0246427,.997985,-.00144616,.0448388,.0321875,.997987,-.00183038,.044839,.0407392,.997983,-.00225987,.0448387,.0502986,.997991,-.00273467,.0448389,.0608667,.997984,-.00325481,.0448384,.0724444,.998002,-.00382043,.044839,.0850348,.997997,-.00443145,.0448396,.0986372,.998007,-.00508796,.0448397,.113255,.998008,-.00578985,.04484,.128891,.998003,-.00653683,.0448384,.145548,.997983,-.00732713,.0448358,.163221,.997985,-.00815454,
.0448358,.181899,.998005,-.00898985,.0448286,.201533,.998026,-.00964404,.0447934,.221821,.998055,-.00922677,.044611,.241282,.99804,-.0117361,.0448245,.261791,.998048,-.0127628,.0448159,.285181,.998088,-.0138055,.0447996,.30954,.998058,-.0148206,.0447669,.334751,.998099,-.0156998,.044697,.36061,.998116,-.0161976,.0445122,.386603,.998195,-.015945,.0441711,.411844,.998168,-.0183947,.0444255,.43773,.998184,-.0197913,.0443809,.466009,.998251,-.0201426,.0440689,.494574,.998305,-.0198847,.0435632,.522405,
.998273,-.0210577,.043414,.549967,.998254,-.0227901,.0433943,.578655,.998349,-.0223108,.0426529,.60758,.99843,-.0223088,.042,.635524,.998373,-.0241141,.0418987,.663621,.998425,-.0231446,.0408118,.691906,.998504,-.0233684,.0400565,.719339,.998443,-.0241652,.0394634,.74643,.99848,-.0228715,.0380002,.773086,.998569,-.023519,.0372322,.798988,.998619,-.0223108,.0356468,.824249,.998594,-.0223105,.034523,.848808,.998622,-.0213426,.0328887,.87227,.998669,-.0207912,.0314374,.895157,.998705,-.0198416,.0296925,
.916769,.998786,-.0189168,.0279634,.937773,.998888,-.0178811,.0261597,.957431,.99906,-.0166845,.0242159,.976495,.999038,-.0155464,.0222638,.994169,.999237,-.0141349,.0201967,1.01112,.999378,-.0129324,.0181744,1.02692,.999433,-.0113192,.0159898,1.04174,.999439,-.0101244,.0140385,1.05559,.999614,-.00837456,.0117826,1.06852,.999722,-.00721769,.00983745,1.08069,.999817,-.00554067,.00769002,1.09176,.99983,-.00426961,.005782,1.10211,.999964,-.00273904,.00374503,1.11152,1.00001,-.00136739,.00187176,1.12031,
.999946,3.93227E-5,-2.8919E-5,1.12804,.995847,-1.3435E-6,.0671785,1.9916E-5,.995464,-3.38387E-5,.0671527,5.01622E-4,.99547,-1.35355E-4,.0671531,.00200649,.995471,-3.0455E-4,.0671532,.00451461,.99547,-5.41423E-4,.0671531,.008026,.995471,-8.4598E-4,.0671531,.0125407,.99547,-.00121823,.0671531,.0180589,.99547,-.00165817,.0671531,.0245806,.995463,-.00216583,.0671526,.0321062,.995468,-.00274127,.0671527,.0406366,.995474,-.00338447,.0671534,.0501717,.995473,-.00409554,.0671533,.0607131,.995478,-.00487451,
.0671531,.0722618,.995476,-.00572148,.0671532,.0848191,.995477,-.00663658,.0671539,.0983882,.995498,-.00761986,.0671541,.112972,.995509,-.00867094,.0671542,.128568,.995509,-.00978951,.0671531,.145183,.995503,-.0109725,.0671491,.162808,.995501,-.012211,.0671465,.181441,.99553,-.0134565,.0671371,.201015,.99555,-.014391,.0670831,.221206,.99558,-.014351,.0668883,.240813,.995577,-.0173997,.0671055,.261257,.995602,-.0191111,.0671178,.284467,.995623,-.0206705,.0670946,.308765,.995658,-.022184,.0670472,.333905,
.995705,-.0234832,.0669417,.359677,.995719,-.0241933,.0666714,.385554,.995786,-.0243539,.066266,.410951,.995887,-.0271866,.0664367,.437163,.995944,-.0296012,.0664931,.464842,.996004,-.0301045,.0660105,.49332,.996128,-.0298311,.0652694,.521131,.996253,-.0316426,.0650739,.549167,.996244,-.0339043,.0649433,.57737,.996309,-.033329,.0638926,.606073,.996417,-.0338935,.0630849,.634527,.996372,-.0353104,.0625083,.66256,.996542,-.0348942,.0611986,.690516,.996568,-.0351614,.060069,.718317,.996711,-.0354317,
.0588522,.74528,.996671,-.0349513,.0571902,.772061,.996865,-.0345622,.0555321,.798089,.996802,-.0342566,.0537816,.823178,.996992,-.0330862,.0516095,.847949,.996944,-.0324666,.0495537,.871431,.997146,-.0309544,.0470302,.894357,.997189,-.0299372,.0446043,.916142,.997471,-.0281389,.0418812,.937193,.997515,-.0268702,.0391823,.957,.997812,-.0247166,.0361338,.975936,.998027,-.0233525,.0333945,.99391,.998233,-.0209839,.0301917,1.01075,.998481,-.0194309,.027271,1.02669,.998859,-.0169728,.0240162,1.04173,
.99894,-.0152322,.0210517,1.05551,.999132,-.0127497,.0178632,1.06856,.999369,-.0108282,.014787,1.08054,.999549,-.00845886,.0116185,1.09185,.999805,-.0063937,.00867209,1.10207,.99985,-.00414582,.00566823,1.1117,.999912,-.00207443,.00277562,1.12022,1.00001,8.70226E-5,-5.3766E-5,1.12832,.991943,-1.78672E-6,.0893382,1.98384E-5,.991952,-4.50183E-5,.089339,4.99849E-4,.991956,-1.80074E-4,.0893394,.0019994,.991955,-4.05167E-4,.0893393,.00449867,.991953,-7.20298E-4,.0893391,.00799764,.991955,-.00112548,.0893393,
.0124964,.991957,-.0016207,.0893395,.0179951,.991958,-.00220601,.0893396,.0244939,.991947,-.00288137,.0893385,.0319929,.991962,-.00364693,.0893399,.0404933,.991965,-.00450264,.0893399,.049995,.99198,-.00544862,.0893411,.0604995,.99197,-.00648491,.0893397,.0720074,.991976,-.00761164,.089341,.0845207,.99198,-.00882891,.0893405,.0980413,.991982,-.0101367,.0893396,.112571,.992008,-.011535,.0893415,.128115,.992026,-.0130228,.0893414,.144672,.992064,-.0145966,.0893418,.162241,.992041,-.0162421,.0893359,
.180801,.992086,-.0178888,.0893214,.200302,.992157,-.0190368,.0892401,.220332,.992181,-.0195584,.0890525,.240144,.992175,-.0227257,.0892153,.260728,.99221,-.0254195,.089304,.283473,.99222,-.0274883,.0892703,.307673,.992317,-.0294905,.0892027,.332729,.992374,-.0311861,.0890577,.358387,.992505,-.0320656,.0886994,.384102,.992568,-.0329715,.0883198,.409767,.992675,-.036006,.0883602,.436145,.992746,-.0392897,.0884591,.463217,.992873,-.0399337,.0878287,.491557,.992934,-.040231,.0870108,.519516,.993091,
-.0422013,.0865857,.547741,.993259,-.0443503,.0861937,.575792,.993455,-.0446368,.0851187,.604233,.993497,-.0454299,.0840576,.632925,.993694,-.0463296,.0829671,.660985,.993718,-.0470619,.0817185,.688714,.993973,-.0468838,.0800294,.716743,.994207,-.046705,.0781286,.74377,.994168,-.0469698,.0763337,.77042,.9945,-.0456816,.0738184,.796659,.994356,-.0455518,.0715545,.821868,.994747,-.0439488,.0686085,.846572,.994937,-.0430056,.065869,.870435,.995142,-.0413414,.0626446,.893272,.995451,-.0396521,.05929,
.915376,.995445,-.0378453,.0558503,.936196,.995967,-.0355219,.0520949,.956376,.996094,-.0335146,.048377,.975327,.996622,-.030682,.0442575,.993471,.996938,-.0285504,.0404693,1.01052,.997383,-.0253399,.0360903,1.02637,.997714,-.0231651,.0322176,1.04139,.998249,-.0198138,.0278433,1.05542,.998596,-.0174337,.0238759,1.06846,.998946,-.0141349,.0195944,1.08056,.99928,-.0115603,.0156279,1.09181,.999507,-.00839065,.0114607,1.10213,.999697,-.005666,.00763325,1.11169,.999869,-.00269902,.00364946,1.12042,1.00001,
6.23836E-5,-3.19288E-5,1.12832,.987221,-2.22675E-6,.111332,1.97456E-5,.98739,-5.61116E-5,.111351,4.97563E-4,.987448,-2.24453E-4,.111357,.00199031,.987441,-5.05019E-4,.111357,.0044782,.987442,-8.97816E-4,.111357,.00796129,.987442,-.00140284,.111357,.0124396,.987444,-.00202012,.111357,.0179132,.987442,-.00274964,.111357,.0243824,.987446,-.00359147,.111357,.0318474,.987435,-.00454562,.111356,.0403086,.987461,-.00561225,.111358,.0497678,.987458,-.00679125,.111358,.0602239,.987443,-.0080828,.111356,.0716792,
.987476,-.0094872,.111358,.0841364,.98749,-.0110044,.111361,.097597,.987508,-.0126344,.111362,.112062,.987494,-.0143767,.111357,.127533,.987526,-.0162307,.111359,.144015,.987558,-.0181912,.111361,.161502,.987602,-.0202393,.111355,.179979,.987692,-.022273,.111346,.199386,.987702,-.0235306,.111215,.219183,.987789,-.0247628,.111061,.239202,.987776,-.0280668,.111171,.259957,.987856,-.0316751,.111327,.282198,.987912,-.0342468,.111282,.306294,.988,-.0367205,.111198,.331219,.988055,-.0387766,.110994,.356708,
.988241,-.0397722,.110547,.382234,.988399,-.0416076,.110198,.408227,.988539,-.0448192,.110137,.434662,.988661,-.0483793,.110143,.461442,.988967,-.0495895,.109453,.489318,.989073,-.0506797,.108628,.517516,.989274,-.0526953,.108003,.545844,.989528,-.054578,.107255,.573823,.989709,-.0561503,.106294,.601944,.989991,-.056866,.104896,.630855,.990392,-.0572914,.103336,.658925,.990374,-.0586224,.10189,.686661,.990747,-.0584764,.099783,.714548,.991041,-.0582662,.0974309,.74186,.991236,-.0584118,.0951678,.768422,
.991585,-.0573055,.0921581,.794817,.991984,-.0564241,.0891167,.820336,.9921,-.0553608,.085805,.84493,.992749,-.0533816,.0820354,.868961,.99288,-.0518661,.0782181,.891931,.993511,-.0492492,.0738935,.914186,.993617,-.0471956,.0696402,.93532,.99411,-.044216,.0649659,.95543,.994595,-.0416654,.0603177,.974685,.994976,-.0384314,.0553493,.992807,.995579,-.0353491,.0503942,1.00996,.996069,-.0319787,.0452123,1.02606,.996718,-.028472,.0400112,1.04114,.997173,-.0250789,.0349456,1.05517,.997818,-.0213326,.029653,
1.0683,.998318,-.0178509,.024549,1.0805,.998853,-.0141118,.0194197,1.09177,.999218,-.0105914,.0143869,1.1022,.999594,-.00693474,.00943517,1.11175,.99975,-.00340478,.00464051,1.12056,1.00001,1.09172E-4,-1.12821E-4,1.12853,.983383,-2.66524E-6,.133358,1.96534E-5,.981942,-6.71009E-5,.133162,4.94804E-4,.981946,-2.68405E-4,.133163,.00197923,.981944,-6.03912E-4,.133163,.00445326,.981941,-.00107362,.133162,.00791693,.981946,-.00167755,.133163,.0123703,.981944,-.00241569,.133162,.0178135,.981945,-.00328807,
.133163,.0242466,.981945,-.00429472,.133162,.03167,.981955,-.00543573,.133164,.0400846,.981951,-.00671105,.133163,.0494901,.981968,-.00812092,.133165,.0598886,.981979,-.00966541,.133166,.0712811,.981996,-.0113446,.133168,.083669,.982014,-.0131585,.133169,.0970533,.982011,-.0151073,.133167,.111438,.982062,-.0171906,.133172,.126826,.9821,-.0194067,.133175,.143215,.982149,-.0217502,.133176,.160609,.982163,-.0241945,.133173,.178981,.982247,-.0265907,.133148,.198249,.982291,-.027916,.132974,.217795,.982396,
-.0299663,.132868,.238042,.982456,-.0334544,.132934,.258901,.982499,-.0378636,.133137,.280639,.982617,-.0409274,.133085,.304604,.98274,-.0438523,.132985,.329376,.982944,-.0462288,.132728,.354697,.98308,-.0475995,.132228,.380102,.983391,-.0501901,.131924,.406256,.983514,-.0535899,.131737,.432735,.98373,-.0571858,.131567,.459359,.984056,-.0592353,.130932,.486637,.984234,-.0610488,.130092,.51509,.984748,-.0630758,.12923,.543461,.985073,-.0647398,.128174,.571376,.985195,-.0671941,.127133,.599414,.985734,
-.0681345,.125576,.628134,.986241,-.0686089,.123639,.656399,.986356,-.0698511,.121834,.684258,.986894,-.0700931,.119454,.711818,.987382,-.0698321,.116718,.739511,.988109,-.0693975,.113699,.766267,.988363,-.0689584,.110454,.792456,.989112,-.0672353,.106602,.81813,.989241,-.0662034,.10267,.842889,.990333,-.0638938,.0981381,.867204,.990591,-.0618534,.0935388,.89038,.991106,-.0593117,.088553,.912576,.991919,-.0562676,.0832187,.934118,.992111,-.0534085,.0778302,.954254,.992997,-.0495459,.0720453,.973722,
.993317,-.0463707,.0663458,.991949,.994133,-.0421245,.0601883,1.00936,.994705,-.0384977,.0542501,1.02559,.995495,-.0340956,.0479862,1.04083,.996206,-.030105,.041887,1.05497,.996971,-.0256095,.0355355,1.06824,.997796,-.0213932,.0293655,1.08056,.998272,-.0169612,.0232926,1.09182,.998857,-.0126756,.0172786,1.10219,.99939,-.00832486,.0113156,1.11192,.999752,-.00410826,.00557892,1.12075,1,1.50957E-4,-1.19101E-4,1.12885,.975169,-3.09397E-6,.154669,1.95073E-5,.975439,-7.79608E-5,.154712,4.91534E-4,.975464,
-3.11847E-4,.154716,.00196617,.975464,-7.01656E-4,.154716,.00442387,.975462,-.0012474,.154715,.0078647,.975461,-.00194906,.154715,.0122886,.975464,-.00280667,.154715,.0176959,.975468,-.00382025,.154716,.0240867,.975471,-.00498985,.154716,.0314612,.975472,-.00631541,.154717,.0398199,.975486,-.00779719,.154718,.0491639,.975489,-.00943505,.154718,.0594932,.975509,-.0112295,.154721,.0708113,.97554,-.0131802,.154724,.0831176,.975557,-.0152876,.154726,.096415,.975585,-.0175512,.154728,.110705,.975605,-.0199713,
.154729,.125992,.975645,-.0225447,.154729,.142272,.975711,-.0252649,.154735,.159549,.975788,-.0280986,.154736,.177805,.975872,-.0308232,.154704,.196911,.975968,-.0324841,.154525,.216324,.976063,-.0351281,.154432,.236628,.976157,-.0388618,.15446,.257539,.976204,-.0437704,.154665,.278975,.976358,-.047514,.154652,.302606,.976571,-.0508638,.154535,.327204,.976725,-.0534995,.154221,.352276,.977013,-.0555547,.153737,.377696,.977294,-.0586728,.153403,.403855,.977602,-.0622715,.15312,.430333,.977932,-.0658166,
.152755,.456855,.978241,-.0689877,.152233,.483668,.978602,-.0712805,.15132,.512097,.979234,-.0732775,.150235,.540455,.97977,-.075163,.148978,.568486,.979995,-.0778026,.147755,.596524,.98078,-.0791854,.146019,.624825,.981628,-.0799666,.143906,.653403,.982067,-.0808532,.141561,.681445,.98271,-.0816024,.139025,.708918,.983734,-.0812511,.135764,.736594,.98431,-.0806201,.132152,.763576,.985071,-.0801605,.12846,.789797,.98618,-.0784208,.124084,.815804,.986886,-.0766643,.1193,.840869,.987485,-.0747744,.114236,
.864952,.988431,-.0716701,.108654,.888431,.988886,-.0691609,.102994,.910963,.990024,-.0654048,.0967278,.932629,.990401,-.0619765,.090384,.95313,.991093,-.0579296,.0837885,.972587,.992018,-.0536576,.0770171,.991184,.992536,-.0493719,.0701486,1.00863,.993421,-.0444813,.062953,1.02494,.993928,-.040008,.0560455,1.04017,.994994,-.0347982,.04856,1.05463,.995866,-.0301017,.0416152,1.06807,.996916,-.0248225,.0342597,1.08039,.997766,-.0199229,.0271668,1.09177,.998479,-.0147422,.0201387,1.10235,.99921,-.00980173,
.0131944,1.11206,.999652,-.0047426,.00640712,1.12104,.999998,8.91673E-5,-1.0379E-4,1.12906,.967868,-3.51885E-6,.175947,1.93569E-5,.968001,-8.86733E-5,.175972,4.87782E-4,.96801,-3.54697E-4,.175973,.00195115,.968012,-7.98063E-4,.175974,.00439006,.968011,-.00141879,.175973,.00780461,.968011,-.00221686,.175973,.0121948,.968016,-.00319231,.175974,.0175607,.968019,-.00434515,.175974,.0239027,.968018,-.00567538,.175974,.0312208,.968033,-.00718308,.175977,.0395158,.968049,-.00886836,.175979,.0487885,.968047,
-.0107312,.175978,.0590394,.968072,-.0127719,.175981,.0702705,.968108,-.0149905,.175986,.0824836,.968112,-.0173866,.175985,.0956783,.968173,-.0199611,.175993,.109862,.96827,-.0227128,.176008,.125033,.968292,-.025639,.17601,.141193,.968339,-.0287299,.176007,.158336,.968389,-.0319399,.176001,.176441,.968501,-.034941,.175962,.195359,.968646,-.0370812,.175793,.214686,.968789,-.0402329,.175708,.234973,.96886,-.0442601,.1757,.255871,.969013,-.049398,.175876,.277238,.969242,-.0539932,.17594,.300326,.969419,
-.0577299,.175781,.324702,.969763,-.0605643,.175432,.349527,.970093,-.0634488,.174992,.374976,.970361,-.0670589,.174611,.401097,.970825,-.0708246,.174226,.427496,.971214,-.0742871,.173684,.453858,.971622,-.0782608,.173186,.480637,.972175,-.0813151,.172288,.508655,.972944,-.0832678,.170979,.536973,.973595,-.0855964,.169573,.565138,.974345,-.0882163,.168152,.593222,.975233,-.0901671,.166314,.621201,.976239,-.0912111,.163931,.649919,.977289,-.0916959,.161106,.678011,.978076,-.0927061,.158272,.705717,
.979533,-.0925562,.15475,.733228,.980335,-.0918159,.150638,.760454,.981808,-.0908508,.146201,.786918,.983061,-.0896172,.141386,.812953,.984148,-.0871588,.135837,.838281,.985047,-.0850624,.130135,.862594,.986219,-.0818541,.123882,.88633,.987043,-.0784523,.117126,.908952,.988107,-.0749601,.110341,.930744,.988955,-.0703548,.102885,.951728,.989426,-.0662798,.0954167,.971166,.990421,-.0610834,.0876331,.989984,.991032,-.0562936,.0797785,1.00765,.992041,-.0508154,.0718166,1.02434,.992794,-.0454045,.0637125,
1.03976,.993691,-.0398194,.0555338,1.05418,.994778,-.0341482,.0473388,1.06772,.995915,-.028428,.0391016,1.08028,.997109,-.022642,.0309953,1.09185,.998095,-.0168738,.0230288,1.10247,.998985,-.0111274,.0150722,1.11229,.999581,-.00543881,.00740605,1.12131,1.00003,1.62239E-4,-1.05549E-4,1.12946,.959505,-3.93734E-6,.196876,1.91893E-5,.959599,-9.92157E-5,.196895,4.83544E-4,.959641,-3.96868E-4,.196903,.0019342,.959599,-8.92948E-4,.196895,.00435193,.959603,-.00158747,.196896,.0077368,.959604,-.00248042,.196896,
.0120888,.959605,-.00357184,.196896,.0174082,.959605,-.00486169,.196896,.0236949,.959613,-.00635008,.196897,.0309497,.959619,-.00803696,.196898,.0391725,.959636,-.00992255,.196901,.0483649,.959634,-.0120067,.1969,.0585266,.959675,-.0142898,.196906,.0696609,.959712,-.0167717,.196911,.0817678,.959752,-.0194524,.196918,.0948494,.959807,-.0223321,.196925,.10891,.959828,-.0254091,.196924,.123947,.959906,-.0286815,.196934,.139968,.960005,-.0321371,.196944,.156968,.960071,-.0357114,.196936,.17491,.960237,
-.0389064,.196882,.193597,.960367,-.041623,.196731,.21285,.960562,-.0452655,.196654,.233075,.960735,-.0496207,.196643,.253941,.960913,-.0549379,.196774,.275278,.961121,-.0603414,.196893,.297733,.96139,-.0644244,.196717,.321877,.961818,-.067556,.196314,.346476,.962175,-.0712709,.195917,.371907,.96255,-.0752848,.1955,.397916,.963164,-.0792073,.195026,.424229,.963782,-.0828225,.194424,.450637,.964306,-.0873119,.193831,.477288,.964923,-.0911051,.192973,.504716,.966048,-.093251,.19151,.533053,.967024,
-.0958983,.190013,.561366,.968038,-.09835,.188253,.589464,.969152,-.100754,.186257,.617433,.970557,-.102239,.183775,.645801,.972104,-.102767,.180645,.674278,.973203,-.103492,.177242,.702004,.975123,-.103793,.17345,.729529,.97641,-.102839,.168886,.756712,.978313,-.101687,.163892,.783801,.980036,-.100314,.158439,.809671,.981339,-.097836,.152211,.835402,.982794,-.0950006,.145679,.860081,.984123,-.0920994,.138949,.883757,.984918,-.0878641,.131283,.90685,.985999,-.083939,.123464,.928786,.987151,-.0791234,
.115324,.94983,.987827,-.0739332,.106854,.96962,.988806,-.0688088,.0982691,.98861,.989588,-.0628962,.0893456,1.00667,.990438,-.0573146,.0805392,1.02344,.991506,-.0509433,.0713725,1.03933,.992492,-.0448724,.0623732,1.05378,.993663,-.0383497,.0530838,1.06747,.994956,-.0319593,.0439512,1.08007,.99634,-.025401,.0347803,1.09182,.99761,-.0189687,.0257954,1.1025,.99863,-.0124441,.0169893,1.11247,.99947,-.00614003,.00829498,1.12151,1.00008,2.16624E-4,-1.46107E-4,1.12993,.950129,-4.34955E-6,.217413,1.90081E-5,
.950264,-1.0957E-4,.217444,4.7884E-4,.9503,-4.38299E-4,.217451,.00191543,.950246,-9.86124E-4,.21744,.00430951,.950246,-.00175311,.21744,.00766137,.950245,-.00273923,.21744,.011971,.950253,-.00394453,.217441,.0172385,.950258,-.00536897,.217442,.0234641,.950267,-.00701262,.217444,.030648,.950277,-.00887551,.217446,.038791,.950284,-.0109576,.217446,.0478931,.950312,-.0132591,.217451,.0579568,.950334,-.01578,.217454,.0689821,.950378,-.0185204,.217462,.0809714,.950417,-.0214803,.217467,.0939265,.950488,
-.0246594,.217479,.10785,.950534,-.0280565,.217483,.122743,.950633,-.0316685,.217498,.138611,.950698,-.0354787,.217499,.155442,.950844,-.0394003,.217507,.173208,.950999,-.0426812,.217419,.191605,.951221,-.0461302,.217317,.21084,.951412,-.0502131,.217238,.230945,.951623,-.0549183,.21722,.251745,.951867,-.0604493,.217306,.273001,.952069,-.0665189,.217466,.294874,.952459,-.0709179,.217266,.318732,.952996,-.0746112,.216891,.34318,.953425,-.0789252,.216503,.36849,.953885,-.0833293,.216042,.394373,.954617,
-.087371,.215469,.420505,.955429,-.0914054,.214802,.446907,.956068,-.0961671,.214146,.473522,.957094,-.10048,.213286,.50052,.958372,-.103248,.211796,.528715,.959654,-.106033,.21016,.557065,.961305,-.108384,.208149,.585286,.962785,-.111122,.206024,.613334,.964848,-.112981,.203442,.641334,.966498,-.113717,.19996,.669955,.968678,-.114121,.196105,.698094,.970489,-.114524,.191906,.725643,.972903,-.113792,.186963,.752856,.974701,-.112406,.181343,.780013,.976718,-.110685,.175185,.806268,.978905,-.108468,
.168535,.832073,.980267,-.105061,.161106,.857149,.981967,-.101675,.153387,.881145,.983063,-.0974492,.145199,.904255,.984432,-.0925815,.136527,.926686,.985734,-.0877983,.127584,.947901,.986228,-.081884,.118125,.968111,.98719,-.0761208,.108594,.98719,.988228,-.0698196,.0989996,1.00559,.989046,-.0632739,.0890074,1.02246,.990242,-.056522,.0790832,1.03841,.991252,-.0495272,.0689182,1.05347,.992542,-.0425373,.0588592,1.06724,.994096,-.0353198,.0486833,1.08009,.995593,-.028235,.0385977,1.09177,.99711,-.0209511,
.0286457,1.10274,.998263,-.0139289,.0188497,1.11262,.999254,-.0067359,.009208,1.12191,.999967,1.41846E-4,-6.57764E-5,1.13024,.935608,-4.74692E-6,.236466,1.87817E-5,.93996,-1.1971E-4,.237568,4.73646E-4,.939959,-4.78845E-4,.237567,.0018946,.939954,-.0010774,.237566,.00426284,.939956,-.00191538,.237566,.00757842,.939954,-.00299277,.237566,.0118413,.93996,-.00430961,.237567,.0170518,.939969,-.00586589,.237569,.02321,.939982,-.00766166,.237572,.0303164,.939987,-.00969686,.237572,.0383711,.939997,-.0119715,
.237574,.0473751,.940031,-.0144858,.237581,.0573298,.940073,-.0172399,.237589,.0682366,.94012,-.0202335,.237598,.080097,.940162,-.0234663,.237604,.0929116,.940237,-.0269387,.237615,.106686,.940328,-.0306489,.237632,.121421,.940419,-.0345917,.237645,.137115,.940522,-.0387481,.237654,.153766,.940702,-.0429906,.237661,.17133,.940871,-.0465089,.237561,.189502,.941103,-.050531,.23748,.208616,.941369,-.0550657,.237423,.228595,.941641,-.0601337,.237399,.249287,.941903,-.0658804,.237443,.270467,.942224,-.0722674,
.237597,.292024,.942633,-.0771788,.237419,.315272,.943172,-.0815623,.237068,.339579,.943691,-.0863973,.236682,.364717,.944382,-.0911536,.236213,.390435,.945392,-.0952967,.235562,.416425,.946185,-.0998948,.234832,.442772,.947212,-.104796,.234114,.469347,.948778,-.10928,.233222,.496162,.950149,-.113081,.231845,.523978,.951989,-.115893,.230005,.552295,.953921,-.11846,.227862,.580569,.955624,-.12115,.225439,.608698,.958234,-.123373,.222635,.636696,.960593,-.124519,.219093,.665208,.963201,-.124736,.214749,
.693557,.965642,-.125012,.210059,.721334,.968765,-.124661,.204935,.748613,.971753,-.122996,.198661,.776224,.973751,-.120998,.191823,.802461,.976709,-.118583,.184359,.828399,.977956,-.115102,.176437,.853693,.979672,-.111077,.167681,.877962,.981816,-.10688,.158872,.901564,.98238,-.101469,.149398,.924057,.983964,-.0960013,.139436,.945751,.984933,-.0899626,.12943,.966272,.985694,-.0832973,.11894,.985741,.986822,-.0767082,.108349,1.00407,.987725,-.0693614,.0976026,1.02154,.98877,-.06211,.086652,1.03757,
.990129,-.0544143,.0756182,1.05296,.991337,-.046744,.0645753,1.06683,.992978,-.0387931,.0534683,1.0798,.994676,-.030973,.0424137,1.09181,.99645,-.0230311,.0314035,1.10286,.997967,-.0152065,.0206869,1.11291,.99922,-.00744837,.010155,1.12237,1.00002,2.40209E-4,-7.52767E-5,1.13089,.922948,-5.15351E-6,.255626,1.86069E-5,.928785,-1.29623E-4,.257244,4.68009E-4,.928761,-5.1849E-4,.257237,.00187202,.928751,-.0011666,.257235,.00421204,.928751,-.00207395,.257234,.0074881,.928754,-.00324055,.257235,.0117002,
.92876,-.00466639,.257236,.0168486,.928763,-.00635149,.257237,.0229334,.928774,-.00829584,.257239,.029955,.928791,-.0104995,.257243,.0379139,.928804,-.0129623,.257245,.0468108,.928847,-.0156846,.257255,.0566473,.92889,-.0186661,.257263,.0674246,.928924,-.0219067,.257268,.0791433,.928989,-.0254066,.257282,.0918076,.92909,-.0291651,.257301,.105419,.92918,-.0331801,.257316,.119978,.92929,-.0374469,.257332,.135491,.929453,-.041939,.257357,.151948,.929586,-.0464612,.257347,.169275,.929858,-.0503426,.257269,
.187257,.930125,-.0548409,.257199,.206204,.930403,-.0598063,.257149,.22601,.930726,-.0652437,.257122,.246561,.931098,-.0712376,.257153,.267618,.931396,-.0777506,.257237,.288993,.931947,-.0832374,.257124,.311527,.932579,-.0883955,.25683,.335697,.933194,-.0937037,.256444,.360634,.934013,-.0987292,.255939,.386126,.935307,-.103215,.255282,.412018,.936374,-.108234,.254538,.438292,.93776,-.113234,.253728,.464805,.939599,-.118013,.25275,.491464,.941036,-.122661,.251404,.518751,.94337,-.125477,.249435,.547133,
.945318,-.128374,.247113,.575456,.947995,-.130996,.244441,.60372,.950818,-.133438,.241352,.63174,.954378,-.135004,.237849,.659971,.957151,-.135313,.233188,.688478,.960743,-.13521,.228001,.716767,.964352,-.135007,.222249,.744349,.967273,-.133523,.21542,.771786,.969767,-.131155,.208039,.798639,.973195,-.128492,.200076,.824774,.975557,-.125094,.191451,.850222,.977692,-.120578,.18184,.874761,.98026,-.115882,.172102,.898497,.981394,-.110372,.161859,.921636,.982386,-.10415,.15108,.943467,.983783,-.0978128,
.140407,.964045,.98422,-.0906171,.129058,.98398,.985447,-.0832921,.117614,1.00276,.986682,-.0754412,.10585,1.02047,.987326,-.0673885,.0940943,1.03678,.988707,-.0592565,.0822093,1.05218,.990185,-.050717,.070192,1.06652,.991866,-.0423486,.0582081,1.07965,.993897,-.0336118,.0460985,1.09188,.995841,-.0252178,.0342737,1.10307,.997605,-.0164893,.0224829,1.11324,.999037,-.00817112,.0110647,1.12262,1.00003,2.91686E-4,-1.68673E-4,1.13139,.915304,-5.52675E-6,.275999,1.83285E-5,.91668,-1.39285E-4,.276414,4.61914E-4,
.916664,-5.5713E-4,.276409,.00184763,.916653,-.00125354,.276406,.00415715,.916651,-.00222851,.276405,.00739053,.916655,-.00348205,.276406,.0115478,.916653,-.00501414,.276405,.0166291,.916667,-.00682478,.276409,.0226346,.91668,-.00891398,.276412,.0295648,.91669,-.0112817,.276413,.0374199,.916727,-.013928,.276422,.0462016,.916759,-.0168528,.276429,.0559101,.916793,-.0200558,.276436,.0665466,.916849,-.0235373,.276448,.0781139,.916964,-.0272973,.276474,.0906156,.917047,-.0313344,.276491,.104051,.917152,
-.0356465,.276511,.118424,.917286,-.0402271,.276533,.133736,.917469,-.0450408,.276564,.149978,.917686,-.0497872,.276563,.167057,.917953,-.0540937,.276493,.184846,.918228,-.0590709,.276437,.203614,.918572,-.0644277,.276398,.223212,.918918,-.0702326,.276362,.243584,.919356,-.076484,.276383,.264465,.919842,-.0830808,.276434,.285701,.920451,-.0892972,.276407,.307559,.921113,-.095016,.276128,.331501,.921881,-.100771,.275754,.356207,.923027,-.106029,.275254,.381477,.924364,-.111029,.274595,.40722,.925818,
-.116345,.273841,.433385,.92746,-.121424,.272913,.459848,.929167,-.12657,.271837,.486493,.931426,-.131581,.270575,.513432,.934001,-.135038,.268512,.541502,.936296,-.138039,.266135,.569658,.939985,-.140687,.263271,.598375,.943516,-.143247,.260058,.626563,.94782,-.145135,.256138,.654711,.951023,-.145733,.251154,.683285,.955338,-.145554,.245562,.711831,.959629,-.145008,.239265,.739573,.963123,-.144003,.232064,.767027,.966742,-.141289,.224036,.794359,.969991,-.138247,.215305,.820361,.973403,-.134786,
.206051,.846548,.975317,-.129966,.195914,.871541,.977647,-.12471,.185184,.895313,.980137,-.119086,.174161,.918398,.981031,-.112297,.162792,.940679,.982037,-.105372,.150952,.961991,.983164,-.097821,.138921,.981913,.983757,-.0897245,.126611,1.00109,.985036,-.0815974,.114228,1.01902,.986289,-.0727725,.101389,1.03604,.987329,-.0639323,.0886476,1.05149,.989193,-.0548109,.0756837,1.06619,.990716,-.045687,.0627581,1.07948,.992769,-.0364315,.0498337,1.09172,.99524,-.0271761,.0370305,1.1033,.997154,-.0179609,
.0243959,1.11353,.998845,-.00878063,.0119567,1.12319,1.00002,2.59038E-4,-1.08146E-4,1.13177,.903945,-5.91681E-6,.295126,1.81226E-5,.903668,-1.48672E-4,.295037,4.55367E-4,.903677,-5.94683E-4,.29504,.00182145,.903673,-.00133805,.295039,.00409831,.903666,-.00237872,.295036,.00728584,.903668,-.00371676,.295037,.0113842,.903679,-.00535212,.29504,.0163936,.903684,-.00728479,.295041,.0223141,.903698,-.00951473,.295044,.0291462,.903718,-.0120419,.295049,.0368904,.903754,-.0148664,.295058,.0455477,.903801,
-.017988,.29507,.0551194,.903851,-.0214064,.295082,.0656058,.903921,-.0251219,.295097,.0770109,.904002,-.0291337,.295116,.0893354,.904111,-.033441,.29514,.102583,.904246,-.0380415,.295169,.116755,.904408,-.0429258,.295202,.131853,.904637,-.0480468,.295245,.147869,.904821,-.0529208,.295214,.164658,.905163,-.0577748,.295185,.182274,.905469,-.0631763,.295143,.200828,.905851,-.068917,.295112,.2202,.906322,-.0750861,.295104,.240372,.906761,-.0815855,.295086,.261082,.90735,-.0882138,.295095,.282123,.908087,
-.095082,.295139,.303563,.908826,-.101488,.29492,.327028,.909832,-.107577,.294577,.351464,.911393,-.113033,.294115,.376497,.912804,-.118629,.293446,.402115,.914081,-.124232,.292581,.428111,.91637,-.129399,.29166,.454442,.91814,-.134892,.290422,.481024,.921179,-.140069,.289194,.507924,.924544,-.144431,.287421,.535557,.927995,-.147498,.284867,.563984,.931556,-.150197,.281722,.5923,.935777,-.152711,.278207,.620832,.940869,-.154836,.274148,.649069,.945994,-.155912,.269057,.677746,.949634,-.155641,.262799,
.706293,.955032,-.154809,.256097,.734278,.95917,-.153678,.248618,.761751,.962931,-.151253,.239794,.789032,.966045,-.147625,.230281,.815422,.96971,-.143964,.220382,.841787,.972747,-.139464,.209846,.867446,.975545,-.133459,.198189,.892004,.978381,-.127424,.186362,.915458,.979935,-.120506,.173964,.937948,.980948,-.11282,.161429,.959732,.982234,-.104941,.148557,.980118,.982767,-.0962905,.135508,.999463,.983544,-.0873625,.122338,1.01756,.984965,-.0783447,.108669,1.03492,.986233,-.0684798,.0949911,1.05087,
.987796,-.0590867,.0811386,1.0656,.989885,-.0489145,.0673099,1.0794,.991821,-.0391,.0535665,1.09174,.99448,-.029087,.0397529,1.10341,.996769,-.019114,.0261463,1.11383,.998641,-.00947007,.0128731,1.1237,.999978,4.46316E-4,-1.69093E-4,1.13253,.888362,-6.27064E-6,.312578,1.78215E-5,.889988,-1.57791E-4,.313148,4.48451E-4,.889825,-6.31076E-4,.313092,.00179356,.88984,-.00141994,.313097,.00403554,.889828,-.0025243,.313092,.00717429,.889831,-.00394421,.313093,.0112099,.889831,-.00567962,.313093,.0161425,
.889844,-.00773051,.313096,.0219724,.889858,-.0100968,.3131,.0286999,.889882,-.0127786,.313106,.0363256,.889918,-.0157757,.313116,.0448509,.889967,-.0190878,.313129,.0542758,.89003,-.022715,.313145,.0646032,.890108,-.0266566,.313165,.0758339,.890218,-.0309131,.313193,.0879729,.890351,-.0354819,.313226,.101019,.89051,-.0403613,.313263,.114979,.890672,-.0455385,.313294,.129848,.890882,-.0509444,.313333,.145616,.891189,-.0559657,.313324,.162122,.891457,-.0613123,.313281,.179524,.891856,-.0671488,.313281,
.197855,.892312,-.0732732,.313268,.216991,.892819,-.0797865,.313263,.236924,.893369,-.0865269,.313247,.257433,.894045,-.0931592,.313205,.278215,.894884,-.100532,.313276,.299467,.895832,-.107716,.313205,.322276,.897043,-.114099,.312873,.34642,.898515,-.119941,.312331,.371187,.900191,-.126044,.311731,.396656,.90188,-.131808,.310859,.422488,.904359,-.137289,.309857,.448744,.906923,-.142991,.308714,.475239,.910634,-.148253,.307465,.501983,.914502,-.153332,.305774,.529254,.919046,-.156646,.303156,.557709,
.923194,-.159612,.299928,.586267,.928858,-.162027,.296245,.614925,.934464,-.164203,.291832,.643187,.939824,-.165602,.286565,.671601,.944582,-.165383,.280073,.700213,.949257,-.164439,.272891,.728432,.954389,-.162953,.264771,.756082,.958595,-.161007,.255927,.78369,.962138,-.157243,.245769,.810769,.966979,-.152872,.235127,.836999,.969566,-.148209,.22347,.862684,.972372,-.142211,.211147,.887847,.975916,-.135458,.198606,.911843,.978026,-.128398,.185498,.934795,.979686,-.120313,.17171,.956787,.980748,-.11166,
.158159,.978046,.981622,-.103035,.144399,.997693,.982356,-.0930328,.13001,1.01642,.983308,-.0834627,.115778,1.03366,.985037,-.0732249,.101327,1.05014,.986493,-.0628145,.086554,1.06507,.988484,-.0526556,.0720413,1.07907,.991051,-.0415744,.0571151,1.09189,.993523,-.0314275,.0426643,1.10369,.99628,-.0203603,.0279325,1.11423,.998344,-.0102446,.0138182,1.12421,.999997,4.2612E-4,-1.93628E-4,1.1333,.871555,-6.60007E-6,.329176,1.74749E-5,.875255,-1.66579E-4,.330571,4.41051E-4,.875644,-6.66394E-4,.330718,
.00176441,.875159,-.00149903,.330536,.00396899,.87516,-.00266493,.330536,.007056,.875158,-.00416393,.330535,.0110251,.87516,-.00599598,.330535,.0158764,.875163,-.00816108,.330536,.0216101,.875174,-.0106591,.330538,.0282266,.875199,-.0134899,.330545,.0357266,.875257,-.0166538,.330563,.0441117,.875304,-.0201501,.330575,.0533821,.875373,-.0239785,.330595,.0635395,.875464,-.0281389,.330619,.0745872,.875565,-.0326301,.330645,.0865255,.875691,-.0374516,.330676,.0993599,.875897,-.0425993,.330733,.113093,
.876091,-.0480576,.330776,.127722,.876353,-.0537216,.330826,.143227,.876649,-.0589807,.330809,.159462,.877034,-.0647865,.330819,.176642,.877443,-.0709789,.330817,.194702,.877956,-.0774782,.330832,.213577,.878499,-.0843175,.330822,.233246,.879144,-.0912714,.330804,.253512,.879982,-.0980824,.330766,.274137,.88097,-.105823,.330864,.295209,.882051,-.113671,.330896,.317226,.883397,-.120303,.330545,.341068,.884987,-.12667,.330068,.365613,.886789,-.133118,.329418,.390807,.889311,-.139024,.328683,.416494,
.891995,-.144971,.327729,.442618,.895106,-.150747,.326521,.469131,.899527,-.156283,.325229,.495921,.90504,-.161707,.32378,.523162,.909875,-.165661,.32122,.55092,.91561,-.168755,.317942,.579928,.921225,-.171193,.313983,.608539,.927308,-.17319,.309636,.636854,.933077,-.174819,.304262,.66523,.938766,-.175002,.297563,.693609,.943667,-.173946,.289613,.722157,.949033,-.172221,.281227,.750021,.953765,-.169869,.271545,.777466,.95804,-.166578,.261034,.804853,.962302,-.161761,.249434,.831569,.966544,-.156636,
.237484,.857779,.969372,-.150784,.224395,.883051,.972486,-.143672,.210786,.907864,.975853,-.135772,.196556,.931223,.977975,-.127942,.182307,.954061,.979122,-.118347,.167607,.97531,.980719,-.109112,.152739,.995666,.981223,-.0991789,.137932,1.01475,.98216,-.0883553,.122692,1.03253,.983379,-.0780825,.107493,1.04917,.985434,-.0665646,.0917791,1.06464,.987332,-.0557714,.0764949,1.07896,.990004,-.0442805,.060721,1.09199,.992975,-.0331676,.0452284,1.10393,.995811,-.0219547,.0297934,1.11476,.9982,-.0107613,
.0146415,1.12484,1.00002,2.48678E-4,-1.4555E-4,1.13413,.859519,-6.93595E-6,.347264,1.71673E-5,.859843,-1.7503E-4,.347394,4.33219E-4,.859656,-7.00076E-4,.347319,.00173277,.859671,-.00157517,.347325,.00389875,.859669,-.00280028,.347324,.00693112,.85967,-.0043754,.347324,.01083,.859665,-.00630049,.347321,.0155954,.859685,-.0085755,.347328,.0212278,.859694,-.0112003,.347329,.0277273,.859718,-.0141747,.347336,.0350946,.85976,-.0174988,.347348,.0433314,.85982,-.0211722,.347366,.0524384,.859892,-.0251941,
.347387,.0624168,.860006,-.0295649,.347422,.0732708,.860122,-.0342825,.347453,.0849999,.860282,-.0393462,.347499,.0976102,.860482,-.0447513,.347554,.111104,.860719,-.0504775,.347614,.125479,.860998,-.0563577,.347666,.140703,.861322,-.0619473,.347662,.156681,.861724,-.0681277,.347684,.173597,.862198,-.0746567,.347709,.191371,.862733,-.0815234,.347727,.209976,.863371,-.0886643,.347744,.229351,.86414,-.0957908,.347734,.24934,.865138,-.102912,.34772,.269797,.866182,-.110924,.3478,.290654,.867436,-.119223,
.347911,.312074,.869087,-.126197,.347649,.335438,.870859,-.133145,.347222,.359732,.872997,-.139869,.346645,.38467,.875939,-.146089,.345935,.41019,.879012,-.152334,.345012,.436218,.883353,-.15821,.343924,.462641,.888362,-.164097,.342636,.489449,.895026,-.169528,.341351,.516629,.900753,-.174408,.339115,.544109,.906814,-.17751,.335809,.572857,.912855,-.180101,.331597,.601554,.919438,-.182116,.32698,.630198,.925962,-.183494,.321449,.658404,.931734,-.184159,.314595,.686625,.93762,-.18304,.306462,.71531,
.943858,-.181323,.297514,.744272,.948662,-.178683,.287447,.771462,.953299,-.175379,.276166,.798593,.957346,-.170395,.263758,.8256,.962565,-.165042,.251019,.852575,.966075,-.158655,.237011,.878316,.969048,-.151707,.222518,.90329,.972423,-.143271,.207848,.927745,.975833,-.134824,.192463,.950859,.977629,-.125444,.1768,.972947,.978995,-.114949,.161033,.993263,.980533,-.104936,.145523,1.01337,.980745,-.0935577,.129799,1.03128,.981814,-.0822956,.113486,1.04825,.983943,-.0710082,.0972925,1.06405,.986141,
-.0587931,.0808138,1.0785,.988878,-.0472755,.0644915,1.09204,.992132,-.0349128,.0478128,1.10413,.9953,-.0232407,.031621,1.11527,.998117,-.0112713,.0154935,1.12551,1.00003,3.39743E-4,-1.95763E-4,1.13504,.845441,-7.29126E-6,.364305,1.69208E-5,.843588,-1.83164E-4,.363506,4.25067E-4,.843412,-7.3253E-4,.36343,.00169999,.843401,-.00164818,.363426,.00382495,.843399,-.00293008,.363425,.00679993,.843401,-.00457822,.363425,.010625,.843394,-.00659249,.363421,.0153002,.843398,-.00897282,.363421,.0208258,.843415,
-.0117191,.363426,.0272024,.843438,-.0148312,.363432,.0344305,.843483,-.018309,.363447,.0425116,.84356,-.0221521,.363472,.0514471,.843646,-.0263597,.363499,.061238,.843743,-.0309315,.363527,.0718873,.84388,-.0358658,.363569,.0833969,.844079,-.0411624,.363631,.0957742,.844279,-.0468128,.363688,.109015,.844549,-.0527923,.363761,.123124,.844858,-.0588204,.363817,.138044,.84522,-.0647573,.36383,.153755,.845669,-.0713181,.363879,.170394,.846155,-.0781697,.363908,.187861,.846789,-.0853913,.363969,.206176,
.847502,-.0928086,.363999,.225244,.8484,-.10005,.363997,.244926,.849461,-.107615,.364008,.265188,.850562,-.115814,.364055,.28587,.851962,-.124334,.364179,.306926,.854326,-.131995,.364233,.329605,.856295,-.139338,.363856,.35359,.858857,-.146346,.363347,.37831,.862428,-.152994,.362807,.403722,.866203,-.159463,.361963,.429537,.871629,-.165623,.36112,.456,.877365,-.171649,.359917,.482773,.883744,-.177151,.35848,.509705,.890693,-.182381,.356523,.537215,.897278,-.186076,.3533,.565493,.903958,-.188602,.349095,
.594293,.910908,-.190755,.344215,.623165,.918117,-.192063,.338606,.651573,.924644,-.192758,.331544,.679869,.931054,-.192238,.323163,.708668,.937303,-.190035,.313529,.737201,.943387,-.187162,.303152,.764977,.948494,-.183876,.29146,.792683,.952546,-.178901,.277917,.819228,.958077,-.173173,.264753,.846559,.962462,-.16645,.25002,.872962,.966569,-.159452,.234873,.898729,.969108,-.15074,.218752,.923126,.973072,-.141523,.202673,.947278,.975452,-.132075,.186326,.969938,.977784,-.121257,.169396,.991325,.97899,
-.110182,.153044,1.01123,.979777,-.0989634,.136485,1.0299,.980865,-.0865894,.119343,1.04727,.982432,-.0746115,.102452,1.06341,.984935,-.0621822,.0852423,1.07834,.987776,-.0495694,.0678546,1.092,.99103,-.0372386,.0506917,1.1043,.99474,-.0244353,.0333316,1.11576,.997768,-.0121448,.0164348,1.12617,1.00003,3.1774E-4,-1.69504E-4,1.13598,.825551,-7.56799E-6,.378425,1.65099E-5,.82664,-1.90922E-4,.378923,4.16504E-4,.826323,-7.63495E-4,.378779,.0016656,.826359,-.00171789,.378795,.00374768,.82636,-.00305402,
.378795,.00666259,.826368,-.00477185,.378798,.0104104,.826364,-.00687131,.378795,.0149912,.826368,-.00935232,.378795,.0204054,.826376,-.0122146,.378797,.0266532,.826399,-.0154581,.378803,.0337355,.82646,-.0190825,.378824,.0416537,.826525,-.0230873,.378846,.0504091,.826614,-.0274719,.378876,.0600032,.82674,-.0322355,.378917,.0704393,.826888,-.0373766,.378964,.0817195,.827078,-.0428936,.379024,.0938492,.827318,-.0487778,.379099,.106828,.82764,-.0549935,.379199,.120659,.827926,-.0611058,.379227,.13526,
.828325,-.0675054,.379275,.150713,.828801,-.0743455,.379332,.167034,.8294,-.0815523,.379415,.184209,.830094,-.0890779,.379495,.202203,.8309,-.096736,.379555,.220945,.831943,-.104135,.379577,.240306,.833037,-.112106,.379604,.260317,.834278,-.120554,.379668,.2808,.836192,-.129128,.3799,.301654,.838671,-.137541,.380109,.323502,.840939,-.14523,.379809,.347176,.844575,-.15248,.379593,.371706,.848379,-.159607,.37909,.39688,.853616,-.166267,.378617,.422702,.858921,-.172698,.377746,.448919,.865324,-.178823,
.376749,.475661,.872207,-.184542,.375363,.502599,.880018,-.189836,.373657,.529914,.88694,-.194294,.370673,.557683,.894779,-.197022,.36662,.586848,.902242,-.199108,.36138,.615831,.909914,-.200398,.355434,.644478,.917088,-.20094,.348173,.672905,.923888,-.200671,.339482,.701327,.930495,-.198773,.32956,.730101,.937247,-.195394,.318363,.758383,.943108,-.191956,.306323,.786539,.948296,-.187227,.292576,.813637,.953472,-.181165,.278234,.840793,.958485,-.174119,.263054,.867712,.962714,-.166564,.246756,.893635,
.966185,-.158181,.229945,.919028,.970146,-.148275,.212633,.943413,.973491,-.138157,.195229,.966627,.975741,-.127574,.178048,.988817,.977238,-.11554,.160312,1.00924,.978411,-.10364,.142857,1.02845,.979811,-.0913122,.125317,1.04648,.98116,-.0782558,.107627,1.06284,.983543,-.0655957,.0895862,1.07798,.986789,-.0520411,.0713756,1.092,.990292,-.0389727,.053228,1.10484,.994187,-.025808,.0351945,1.11642,.997499,-.0126071,.0173198,1.12703,.999999,2.75604E-4,-1.48602E-4,1.13674,.81075,-7.8735E-6,.394456,1.61829E-5,
.808692,-1.98293E-4,.393453,4.07564E-4,.80846,-7.92877E-4,.39334,.00162965,.808595,-.00178416,.393407,.00366711,.808597,-.00317182,.393408,.00651934,.808598,-.00495589,.393408,.0101866,.808591,-.00713627,.393403,.0146689,.808592,-.00971285,.393402,.0199667,.80861,-.0126855,.393407,.0260803,.808633,-.0160538,.393413,.0330107,.80868,-.0198175,.393429,.0407589,.808748,-.0239758,.393453,.0493264,.808854,-.0285286,.39349,.0587161,.808992,-.0334748,.39354,.0689304,.809141,-.0388116,.393588,.0799707,.809352,
-.0445375,.39366,.0918432,.809608,-.0506427,.393742,.104549,.809915,-.0570708,.393834,.118085,.810253,-.0633526,.393885,.132377,.810687,-.0700966,.393953,.147537,.811233,-.0772274,.394047,.163543,.811865,-.0847629,.394148,.180394,.812648,-.0925663,.394265,.198051,.813583,-.100416,.394363,.216443,.814683,-.108119,.394402,.235502,.815948,-.11644,.394489,.255242,.817278,-.125036,.394542,.275441,.819605,-.133655,.39486,.296094,.822256,-.142682,.395248,.317309,.825349,-.150756,.395241,.340516,.829605,
-.158392,.395285,.364819,.83391,-.165801,.394922,.389736,.839808,-.172677,.394691,.415409,.845708,-.179448,.394006,.441546,.853025,-.185746,.393279,.46832,.859666,-.191684,.391655,.495302,.86789,-.197146,.390068,.52262,.875845,-.201904,.38727,.550336,.882634,-.205023,.382688,.578825,.891076,-.207098,.377543,.608103,.900589,-.208474,.371752,.63723,.90791,-.209068,.364016,.665769,.915971,-.208655,.355593,.694428,.923455,-.20729,.345439,.723224,.931514,-.203821,.334099,.751925,.937885,-.19986,.321069,
.780249,.943136,-.194993,.306571,.8077,.948818,-.189132,.291556,.83497,.954433,-.181617,.275745,.86188,.959078,-.173595,.258695,.888562,.962705,-.164855,.240825,.914008,.966753,-.155129,.22268,.939145,.970704,-.144241,.204542,.963393,.973367,-.133188,.185927,.985983,.975984,-.121146,.167743,1.00704,.976994,-.108366,.149218,1.02715,.978485,-.0956746,.13131,1.0455,.980074,-.0820733,.112513,1.06221,.98225,-.0684061,.0938323,1.07782,.98553,-.0549503,.0749508,1.09199,.989529,-.0407857,.055848,1.10508,
.993536,-.0271978,.0368581,1.11684,.997247,-.0132716,.0181845,1.12789,1,4.31817E-4,-1.98809E-4,1.13792,.785886,-8.12608E-6,.405036,1.57669E-5,.790388,-2.05278E-4,.407355,3.98297E-4,.790145,-8.20824E-4,.407231,.00159263,.790135,-.00184681,.407226,.00358336,.790119,-.00328316,.407218,.00637039,.790126,-.00512988,.40722,.0099539,.79013,-.00738684,.407221,.0143339,.790135,-.0100538,.407221,.0195107,.790134,-.0131306,.407217,.0254848,.79016,-.0166169,.407224,.0322572,.790197,-.020512,.407236,.0398284,
.790273,-.0248157,.407263,.0482014,.790381,-.029527,.407304,.0573777,.790521,-.0346446,.407355,.0673602,.790704,-.0401665,.40742,.0781522,.790925,-.0460896,.407499,.0897582,.791195,-.0524017,.407589,.10218,.791522,-.0590121,.407691,.11541,.791878,-.0654876,.407748,.12939,.792361,-.0725207,.407849,.144237,.792942,-.0799844,.407963,.159924,.79362,-.0877896,.408087,.176425,.794529,-.0958451,.408259,.193733,.795521,-.103827,.408362,.211756,.796778,-.111937,.408482,.230524,.798027,-.120521,.408547,.249967,
.799813,-.129242,.408721,.269926,.802387,-.138048,.409148,.290338,.805279,-.147301,.409641,.311193,.809251,-.155895,.410154,.333611,.813733,-.163942,.410297,.357615,.819081,-.171666,.410373,.382339,.825427,-.178905,.410348,.407828,.83172,-.185812,.409486,.434034,.83877,-.192318,.408776,.460493,.845817,-.198249,.407176,.487346,.854664,-.204034,.405719,.514832,.863495,-.208908,.403282,.542401,.871883,-.212765,.399293,.570683,.88065,-.214911,.393803,.599947,.89004,-.216214,.387536,.62932,.898476,-.216745,
.379846,.658319,.906738,-.216387,.370625,.687138,.914844,-.215053,.360139,.71601,.923877,-.212007,.348849,.745124,.931925,-.207481,.335639,.773366,.938054,-.202418,.320798,.801636,.943895,-.196507,.304772,.829055,.949468,-.189009,.288033,.856097,.955152,-.180539,.270532,.88301,.959403,-.171437,.251639,.909296,.963309,-.161661,.232563,.934868,.967399,-.150425,.213231,.959662,.972009,-.138659,.194247,.98302,.97433,-.126595,.174718,1.00517,.975823,-.113205,.155518,1.02566,.976371,-.0996096,.136709,1.04418,
.978705,-.0860754,.117571,1.06146,.981477,-.0714438,.0980046,1.07777,.984263,-.0572304,.0782181,1.09214,.988423,-.0428875,.0584052,1.10553,.993,-.0282442,.038522,1.11758,.99704,-.0140183,.0190148,1.12864,.999913,3.69494E-4,-1.45203E-4,1.13901,.777662,-8.4153E-6,.423844,1.54403E-5,.770458,-2.11714E-4,.419915,3.8845E-4,.770716,-8.46888E-4,.420055,.00155386,.770982,-.00190567,.420202,.00349653,.770981,-.00338782,.420201,.00621606,.77098,-.00529338,.4202,.00971274,.770983,-.00762223,.4202,.0139867,.770985,
-.0103741,.420198,.0190381,.770996,-.0135489,.4202,.0248677,.771029,-.0171461,.420212,.0314764,.771052,-.0211647,.420215,.0388648,.771131,-.0256048,.420245,.047036,.771235,-.0304647,.420284,.0559911,.771383,-.0357436,.420341,.0657346,.771591,-.0414392,.420423,.0762694,.771819,-.0475462,.420506,.0875984,.772123,-.0540506,.420617,.099727,.772464,-.060797,.42072,.112637,.772855,-.0675393,.420799,.126313,.773317,-.0748323,.420893,.140824,.773981,-.0825681,.421058,.15617,.774746,-.0906307,.421226,.172322,
.77566,-.0988982,.421397,.189253,.776837,-.106994,.421569,.206912,.778097,-.115528,.421704,.225359,.779588,-.124317,.421849,.24447,.781574,-.133139,.422097,.264156,.784451,-.142179,.422615,.284318,.787682,-.15165,.423269,.304902,.792433,-.160771,.424396,.3265,.797359,-.169166,.424772,.35014,.803986,-.177149,.425475,.374768,.809504,-.184745,.424996,.399928,.815885,-.19173,.424247,.425796,.823513,-.198525,.423515,.452287,.832549,-.204709,.422787,.479321,.841653,-.210447,.421187,.506718,.850401,-.215501,
.418519,.53432,.859854,-.219752,.414715,.56242,.869364,-.222305,.409462,.591558,.878837,-.223744,.402926,.621074,.888636,-.224065,.395043,.650538,.898132,-.223742,.38564,.679538,.907181,-.222308,.375378,.708674,.915621,-.219837,.363212,.737714,.9239,-.215233,.349313,.767014,.931644,-.209592,.334162,.795133,.938887,-.203644,.317943,.823228,.945282,-.196349,.300581,.850822,.950758,-.18742,.282195,.877594,.956146,-.177879,.262481,.904564,.960355,-.167643,.242487,.930741,.965256,-.156671,.222668,.955868,
.968029,-.144123,.201907,.979869,.97251,-.131305,.18202,1.00291,.974925,-.118335,.161909,1.02392,.975402,-.103714,.142129,1.0433,.976987,-.089415,.122447,1.06089,.979677,-.0748858,.102248,1.07713,.983184,-.0596086,.0814851,1.09218,.987466,-.0447671,.0609484,1.10585,.992348,-.0295217,.0401835,1.11829,.996674,-.0143917,.0198163,1.12966,1.00003,3.21364E-4,-1.49983E-4,1.1402,.757901,-8.69074E-6,.436176,1.51011E-5,.751195,-2.17848E-4,.432317,3.78533E-4,.751178,-8.71373E-4,.432307,.0015141,.751195,-.00196061,
.432317,.0034068,.751198,-.00348552,.432318,.00605659,.751195,-.00544599,.432315,.00946353,.751207,-.00784203,.43232,.013628,.751213,-.0106732,.43232,.0185499,.751221,-.0139393,.432319,.0242302,.751244,-.0176398,.432325,.0306694,.7513,-.0217743,.432348,.0378698,.751358,-.0263412,.432367,.0458321,.751458,-.0313396,.432404,.0545587,.751608,-.0367682,.432464,.0640543,.7518,-.0426246,.43254,.0743222,.752065,-.0489031,.432645,.0853668,.752376,-.0555828,.432762,.0971911,.752715,-.0623861,.432859,.109768,
.753137,-.069415,.432958,.123126,.753676,-.0770039,.433099,.137308,.754345,-.084971,.433272,.15229,.755235,-.0932681,.433504,.168075,.756186,-.10171,.433693,.184625,.757363,-.110019,.433857,.201897,.75884,-.11887,.434102,.220014,.760467,-.127881,.434306,.238778,.762969,-.136766,.434751,.258172,.765823,-.14612,.43529,.278062,.769676,-.15566,.436236,.298437,.774909,-.165177,.437754,.319532,.77994,-.17402,.438343,.342505,.785757,-.182201,.438609,.366693,.792487,-.190104,.438762,.391668,.80038,-.197438,
.438795,.417494,.808494,-.204365,.438226,.443933,.817695,-.210714,.437283,.470929,.828111,-.216651,.436087,.498569,.837901,-.221804,.433717,.526165,.847813,-.226318,.430133,.554155,.858314,-.229297,.425213,.582822,.868891,-.230999,.418576,.612847,.878941,-.231155,.410405,.642445,.888809,-.230935,.400544,.672024,.898089,-.229343,.389613,.701366,.908081,-.226886,.377197,.730763,.916819,-.222676,.363397,.759642,.924968,-.216835,.347437,.788775,.932906,-.210245,.32995,.817135,.940025,-.202992,.312262,
.844912,.946101,-.19436,.293313,.872164,.952835,-.184125,.273638,.899443,.957347,-.173657,.252385,.926389,.961434,-.162204,.231038,.951947,.965522,-.14979,.209834,.976751,.969412,-.136307,.188821,1.00022,.973902,-.122527,.168013,1.02229,.974045,-.108213,.147634,1.04199,.975775,-.0927397,.12705,1.06019,.978383,-.0778212,.106309,1.07711,.98211,-.0621216,.0849279,1.09245,.986517,-.0463847,.0633519,1.10651,.991696,-.0309353,.0419698,1.11903,.996349,-.0150914,.0206272,1.13073,1.00003,4.42449E-4,-2.31396E-4,
1.14146,.727498,-8.85074E-6,.441528,1.45832E-5,.730897,-2.23525E-4,.443589,3.68298E-4,.730796,-8.93996E-4,.443528,.00147303,.730805,-.00201149,.443533,.00331433,.730814,-.00357596,.443538,.00589222,.730815,-.00558734,.443538,.00920678,.730822,-.00804544,.44354,.0132582,.730836,-.0109501,.443545,.0180468,.730848,-.0143008,.443546,.0235732,.730871,-.0180969,.443552,.0298382,.730915,-.022338,.443567,.0368438,.730982,-.0270225,.443591,.044591,.731076,-.0321491,.443627,.0530831,.731245,-.0377166,.443699,
.0623243,.73144,-.0437216,.443777,.0723181,.7317,-.0501576,.443881,.0830691,.732034,-.0569942,.444014,.0945809,.732388,-.0638756,.444113,.106825,.732853,-.071203,.444247,.119859,.733473,-.0790076,.444442,.13369,.734195,-.0871937,.444645,.148304,.735069,-.095696,.444877,.163702,.736169,-.10426,.445133,.179861,.73747,-.112853,.44537,.196778,.738991,-.12199,.445651,.214496,.740865,-.131153,.445958,.232913,.743637,-.140245,.446548,.251977,.746797,-.149722,.447246,.271551,.751517,-.159341,.448656,.291774,
.756156,-.169106,.449866,.312455,.761519,-.178436,.450919,.334552,.768295,-.186904,.451776,.358491,.776613,-.195117,.452832,.383446,.783966,-.202695,.45249,.408945,.793542,-.20985,.452587,.435364,.803192,-.216403,.451852,.462336,.813892,-.22251,.450708,.48987,.824968,-.227676,.4486,.517697,.835859,-.232443,.445156,.545975,.846825,-.235775,.440351,.574483,.858085,-.237897,.433641,.604246,.868825,-.238074,.425354,.634101,.879638,-.237661,.415383,.664201,.889966,-.236186,.404136,.693918,.899479,-.233599,
.390917,.723481,.908769,-.229737,.376352,.75258,.917966,-.223836,.360372,.781764,.926304,-.217067,.342551,.811139,.934626,-.209309,.324238,.839585,.941841,-.20071,.304484,.867044,.94789,-.190602,.283607,.894579,.954196,-.179253,.262205,.921743,.958383,-.167646,.239847,.948026,.963119,-.155073,.218078,.973296,.966941,-.141426,.195899,.998135,.970836,-.126849,.174121,1.02021,.973301,-.112296,.153052,1.04085,.97448,-.0964965,.131733,1.05946,.977045,-.080489,.10997,1.07693,.980751,-.064844,.0881657,1.09254,
.985475,-.0481938,.0657987,1.10697,.991089,-.0319185,.0435215,1.12004,.996122,-.0158088,.0214779,1.13173,1.00001,3.72455E-4,-2.00295E-4,1.14291,.708622,-9.07597E-6,.45304,1.41962E-5,.711162,-2.28911E-4,.454662,3.58052E-4,.709812,-9.14446E-4,.453797,.00143034,.709865,-.00205819,.453834,.00321935,.709864,-.00365894,.453833,.00572331,.709855,-.00571692,.453826,.00894278,.709862,-.00823201,.453828,.012878,.709875,-.011204,.453832,.0175295,.709896,-.0146323,.453839,.0228978,.709925,-.0185163,.453847,.0289839,
.709974,-.0228551,.453866,.0357894,.710045,-.0276473,.453892,.0433161,.710133,-.032891,.453924,.0515665,.710292,-.0385851,.453992,.0605458,.710485,-.0447254,.45407,.0702574,.710769,-.0513051,.454192,.0807077,.711106,-.0582733,.454329,.091896,.711516,-.0652866,.45446,.103814,.712071,-.0728426,.454653,.116508,.712676,-.0808307,.45484,.129968,.713476,-.0892216,.455096,.144206,.714377,-.0979047,.455346,.159212,.715579,-.106531,.455647,.174973,.716977,-.115492,.455961,.191504,.71862,-.124821,.456315,.208835,
.72084,-.134079,.4568,.226869,.723786,-.143427,.457521,.245582,.727464,-.153061,.458475,.264957,.732771,-.162768,.460239,.284948,.736515,-.172627,.460899,.30522,.743519,-.182487,.463225,.326717,.750041,-.191295,.464027,.350113,.758589,-.199746,.465227,.374782,.767703,-.207584,.465877,.400226,.777484,-.214973,.465996,.426442,.788792,-.221796,.466019,.453688,.800194,-.228038,.465083,.481246,.811234,-.233346,.462506,.509086,.822859,-.238073,.459257,.537338,.835082,-.241764,.454863,.566108,.846332,-.244241,
.448163,.595126,.858355,-.244736,.439709,.625574,.87034,-.244278,.429837,.65617,.881027,-.24255,.418002,.686029,.891007,-.239912,.404325,.716039,.900874,-.236133,.389222,.745518,.911072,-.230672,.373269,.775026,.920359,-.22356,.355083,.804521,.928604,-.215591,.335533,.834045,.937175,-.206503,.315278,.861612,.942825,-.196684,.293653,.889131,.949805,-.185116,.271503,.916853,.955535,-.172703,.248821,.943541,.959843,-.159978,.225591,.970132,.964393,-.146375,.202719,.994709,.968008,-.131269,.179928,1.0186,
.971013,-.11569,.158007,1.03928,.973334,-.1003,.13624,1.05887,.975775,-.0833352,.1138,1.07652,.979579,-.0668981,.0913141,1.09297,.984323,-.0500902,.0683051,1.10734,.990351,-.0332377,.0451771,1.12084,.995823,-.0161491,.0221705,1.13296,1.0001,2.34083E-4,-1.08712E-4,1.14441,.683895,-9.24677E-6,.46015,1.37429E-5,.68833,-2.33383E-4,.463134,3.46865E-4,.688368,-9.33547E-4,.463159,.00138748,.688367,-.00210049,.463159,.00312187,.688369,-.00373415,.463159,.00555004,.688377,-.00583449,.463163,.00867216,.688386,
-.00840128,.463166,.0124884,.688398,-.0114343,.463169,.0169993,.688418,-.0149329,.463175,.0222054,.688453,-.0188964,.463188,.028108,.688515,-.0233239,.463214,.0347085,.68857,-.0282136,.463231,.0420091,.688679,-.033564,.463276,.0500132,.688854,-.0393733,.463356,.0587255,.689038,-.0456354,.46343,.0681476,.689321,-.0523433,.463553,.0782897,.689662,-.059412,.463693,.0891501,.690188,-.0665736,.4639,.100735,.690755,-.0743106,.464107,.113074,.691405,-.0824722,.464329,.126161,.692198,-.0910484,.464585,.140007,
.693196,-.0998778,.464893,.154612,.69454,-.108651,.465285,.169984,.695921,-.117855,.465596,.186106,.697749,-.12734,.466056,.203034,.700375,-.136714,.466771,.220703,.703395,-.146386,.467579,.239062,.707904,-.156096,.469067,.258188,.711673,-.165904,.469851,.277759,.717489,-.175812,.471815,.297935,.724051,-.185931,.47389,.318916,.731965,-.195238,.47587,.341591,.741151,-.204021,.477523,.366062,.751416,-.212113,.478881,.391396,.761848,-.21979,.479226,.417599,.771886,-.2267,.478495,.444401,.783998,-.232991,
.477622,.472084,.796523,-.238645,.475833,.500193,.808851,-.243396,.472568,.52865,.821191,-.247226,.467857,.557362,.834261,-.250102,.461871,.586768,.846762,-.251056,.453543,.617085,.859867,-.250604,.443494,.647659,.871948,-.248783,.431711,.678119,.882967,-.245855,.417911,.708399,.892826,-.242168,.401993,.738256,.90332,-.237062,.385371,.767999,.913633,-.22997,.366837,.798191,.922774,-.221687,.346372,.827756,.931371,-.212345,.325682,.856425,.938929,-.20206,.303665,.884299,.944821,-.190981,.280786,.912023,
.951792,-.178065,.2573,.939669,.957712,-.164634,.233448,.96655,.961912,-.150863,.209504,.992366,.966382,-.13577,.18597,1.01633,.969588,-.119593,.162905,1.03843,.971777,-.103203,.14053,1.05841,.97433,-.0865888,.117909,1.07632,.978686,-.0690829,.0944101,1.09326,.983281,-.0516568,.0705671,1.10796,.989562,-.034558,.0468592,1.12182,.995465,-.0167808,.0229846,1.1342,.999991,3.73016E-4,-2.35606E-4,1.1459,.662251,-9.39016E-6,.468575,1.32714E-5,.666634,-2.37624E-4,.471675,3.35842E-4,.666411,-9.50385E-4,.471516,
.00134321,.666399,-.00213833,.471509,.00302221,.666386,-.0038014,.471499,.00537283,.666405,-.00593958,.471511,.00839533,.666406,-.00855253,.471508,.0120898,.666428,-.0116401,.471519,.0164569,.666444,-.0152015,.471522,.0214971,.66649,-.0192362,.471543,.027212,.666537,-.0237428,.471558,.033603,.666617,-.0287198,.471591,.0406728,.666718,-.0341647,.471631,.0484238,.666889,-.0400759,.47171,.0568621,.667104,-.0464479,.471805,.0659915,.667374,-.0532677,.471923,.0758178,.667772,-.0603805,.472098,.0863425,
.668371,-.0677392,.472363,.0975917,.668971,-.0756028,.472596,.109567,.669696,-.0839293,.472869,.122272,.670481,-.0926683,.473126,.135718,.6715,-.1016,.473442,.149914,.672911,-.110566,.47389,.164882,.674512,-.119984,.474354,.180602,.67651,-.129574,.474922,.19711,.679292,-.139106,.475764,.214371,.682798,-.148993,.476886,.232405,.686955,-.158737,.478179,.251153,.691406,-.168754,.479432,.270436,.697438,-.178703,.481481,.290374,.704761,-.188955,.484143,.311044,.713599,-.198814,.487007,.333003,.723194,
-.207869,.488962,.357144,.732601,-.216189,.489815,.382169,.744193,-.22398,.490888,.408227,.754907,-.231156,.490355,.434928,.767403,-.23747,.489548,.462599,.78107,-.243503,.488274,.490908,.793893,-.248114,.484843,.519421,.807296,-.25222,.4803,.548561,.820529,-.255265,.474097,.577772,.833716,-.256741,.466041,.607782,.848403,-.25637,.456547,.638807,.860755,-.254804,.443946,.670058,.874012,-.251834,.430852,.700749,.885619,-.247867,.414903,.731446,.896069,-.242634,.397276,.761191,.906266,-.236093,.378535,
.791053,.916759,-.227543,.358038,.821298,.92523,-.21783,.335705,.850747,.93436,-.207534,.313797,.879258,.941631,-.195983,.289671,.907734,.947564,-.183567,.265319,.935206,.953681,-.169345,.240815,.962739,.960008,-.154909,.216119,.989227,.964145,-.140161,.192096,1.01465,.968171,-.123411,.167855,1.03737,.969859,-.106525,.144817,1.05767,.972666,-.0891023,.12149,1.0761,.977055,-.0718094,.0975306,1.09336,.982527,-.0534213,.0730217,1.10878,.989001,-.0355579,.0483366,1.12285,.99512,-.0176383,.023938,1.13548,
1.00007,3.68831E-4,-2.11581E-4,1.14744,.651047,-9.60845E-6,.484101,1.2922E-5,.644145,-2.41347E-4,.478968,3.24578E-4,.64396,-9.65142E-4,.478831,.00129798,.64396,-.00217154,.47883,.00292046,.643968,-.00386049,.478835,.00519202,.643974,-.00603186,.478838,.0081128,.643977,-.0086854,.478836,.011683,.643982,-.0118207,.478834,.0159031,.644024,-.0154374,.478856,.0207743,.644059,-.0195343,.478868,.0262975,.644122,-.0241103,.478896,.0324747,.644207,-.0291638,.478933,.039309,.64432,-.0346919,.478981,.0468029,
.644481,-.0406919,.479053,.0549614,.644722,-.047159,.479169,.0637909,.645013,-.0540748,.479302,.0732974,.645503,-.0612001,.479541,.0834898,.646117,-.0687303,.479829,.0943873,.646707,-.0767846,.480061,.105991,.647431,-.0852465,.480343,.11831,.64831,-.0940719,.48066,.131348,.649486,-.103056,.481083,.14514,.650864,-.112261,.481528,.159676,.652604,-.121852,.482102,.174979,.654825,-.131505,.482813,.191079,.657876,-.141189,.483876,.207927,.661339,-.151239,.48499,.225586,.665463,-.161091,.486279,.243947,
.670542,-.171235,.487968,.262957,.677361,-.181347,.49053,.282781,.685672,-.191679,.493862,.303311,.694551,-.201781,.49699,.324607,.703753,-.211164,.498884,.347916,.713703,-.219675,.500086,.372628,.725911,-.227836,.501554,.398694,.73862,-.23533,.502193,.425529,.752118,-.241786,.501811,.453209,.76579,-.247865,.500185,.481381,.779568,-.252696,.497159,.51011,.793991,-.256802,.492765,.539322,.808182,-.259942,.486827,.569078,.821698,-.261703,.478386,.598818,.836009,-.262006,.468772,.629762,.849824,-.260333,
.456352,.661366,.863888,-.257398,.442533,.69295,.876585,-.253264,.426573,.723608,.888665,-.248026,.408964,.754378,.899537,-.241487,.389677,.784761,.9094,-.233463,.368516,.814688,.920166,-.223397,.346624,.845009,.928899,-.21255,.322717,.874431,.937156,-.200869,.298698,.902922,.943861,-.188387,.273491,.931356,.949557,-.174341,.247866,.958854,.955862,-.158994,.222496,.986098,.961721,-.143664,.197522,1.01229,.965976,-.127412,.17302,1.03571,.968652,-.109798,.148954,1.05699,.971084,-.0916787,.125044,1.07587,
.975584,-.0739634,.100577,1.09372,.98122,-.055322,.0753666,1.10948,.988253,-.0366825,.0498899,1.12394,.99482,-.0180389,.024611,1.13694,1.00001,2.29839E-4,-1.88283E-4,1.14919,.613867,-9.64198E-6,.479449,1.23452E-5,.621485,-2.44534E-4,.485399,3.13091E-4,.621429,-9.78202E-4,.485353,.00125245,.62112,-.00220004,.485114,.00281687,.621119,-.0039111,.485112,.00500783,.621122,-.00611091,.485112,.00782498,.621133,-.00879922,.485117,.0112687,.621152,-.0119756,.485125,.0153394,.621183,-.0156396,.485139,.0200382,
.621227,-.0197898,.485158,.0253663,.621298,-.0244253,.485192,.0313261,.621388,-.0295441,.485233,.0379204,.621507,-.0351432,.485286,.0451523,.621693,-.0412198,.485378,.0530277,.621933,-.0477673,.485495,.0615522,.622232,-.0547574,.485635,.0707316,.622809,-.0619417,.485943,.0805883,.623407,-.069625,.486232,.0911267,.62406,-.077796,.486516,.102354,.624835,-.0863731,.486838,.114279,.625758,-.095251,.487188,.126902,.627043,-.104299,.487695,.140285,.628438,-.113724,.488163,.154397,.630325,-.123417,.488858,
.169267,.632801,-.133137,.489754,.184941,.635784,-.143052,.490815,.20136,.639406,-.153132,.492048,.218643,.643872,-.163143,.49363,.236615,.6499,-.17333,.496009,.255449,.657201,-.183622,.498994,.275006,.666221,-.194019,.502888,.295354,.674419,-.204192,.505459,.316244,.683729,-.21406,.507771,.33849,.695584,-.222854,.510245,.363166,.708583,-.231315,.512293,.389071,.721233,-.238911,.512747,.415737,.735134,-.245657,.512482,.443331,.750179,-.251879,.511526,.471891,.765073,-.256911,.508935,.500892,.779794,
-.261144,.504341,.530294,.794801,-.264316,.498515,.560144,.810339,-.266276,.491015,.590213,.824818,-.266981,.481126,.620865,.839375,-.265778,.468685,.652687,.853043,-.262748,.453925,.684759,.867335,-.258474,.437912,.716209,.88037,-.253187,.419648,.747508,.891711,-.246476,.39982,.77797,.902896,-.238735,.37879,.808586,.913601,-.22885,.355891,.838843,.923019,-.217656,.331773,.869014,.933432,-.205539,.307356,.898512,.939691,-.192595,.281321,.9269,.946938,-.178945,.255441,.955297,.952372,-.163587,.229013,
.983231,.95909,-.147214,.203179,1.00971,.963675,-.13064,.17792,1.03438,.968247,-.113121,.152898,1.05625,.97001,-.0945824,.128712,1.07598,.974458,-.0755648,.103349,1.094,.980168,-.0571998,.0776731,1.1104,.987295,-.0377994,.0514445,1.12491,.994432,-.0186417,.025429,1.13851,.999975,5.42714E-4,-2.82356E-4,1.15108,.592656,-9.80249E-6,.486018,1.19532E-5,.598467,-2.47275E-4,.490781,3.01531E-4,.597934,-9.88317E-4,.490343,.00120517,.597903,-.00222366,.490319,.0027116,.597913,-.00395315,.490327,.00482077,.597919,
-.00617653,.490329,.00753264,.597936,-.00889375,.490339,.0108478,.597956,-.0121043,.490347,.0147668,.597992,-.0158073,.490365,.0192905,.598032,-.0200017,.490382,.0244204,.598109,-.0246865,.49042,.0301593,.598215,-.0298594,.490474,.03651,.59833,-.0355167,.490524,.0434757,.598525,-.0416559,.490624,.0510629,.598778,-.0482692,.490753,.0592781,.599135,-.0553114,.49094,.0681304,.599802,-.062542,.491328,.0776467,.600361,-.0703638,.491598,.0878184,.60101,-.0786256,.491882,.0986573,.601811,-.0872962,.492232,
.11018,.602861,-.0962284,.492684,.1224,.604167,-.10538,.493213,.135354,.605693,-.114896,.493799,.149034,.607682,-.124654,.494576,.163469,.610672,-.13456,.4959,.178747,.613313,-.144581,.496713,.194723,.617603,-.154703,.498499,.211617,.622174,-.16489,.500188,.229183,.628855,-.175164,.503072,.247786,.636963,-.185565,.506798,.267116,.644866,-.195911,.509719,.28702,.653741,-.206104,.512776,.307763,.664942,-.216447,.516812,.329631,.67633,-.22552,.519181,.353515,.690012,-.234316,.521681,.379226,.704243,
-.242032,.523129,.405901,.719396,-.249172,.523768,.433585,.734471,-.255543,.522541,.462085,.750539,-.260697,.520217,.491233,.766365,-.26501,.516293,.521094,.781677,-.268409,.509708,.551014,.797132,-.270399,.501944,.581463,.812655,-.271247,.492025,.612402,.828592,-.270708,.480424,.643798,.844044,-.268085,.465955,.67682,.857305,-.263459,.448425,.708496,.87114,-.258151,.430243,.74046,.884936,-.251171,.410578,.771583,.895772,-.243305,.38862,.802234,.906961,-.234037,.365214,.833179,.917775,-.222714,.34116,
.86353,.927883,-.210175,.31572,.893557,.936617,-.196925,.289159,.922976,.943384,-.182788,.261996,.951606,.949713,-.167965,.235324,.979958,.955818,-.151109,.208408,1.00765,.961344,-.133834,.182591,1.03329,.965469,-.115987,.156958,1.0557,.968693,-.09746,.132239,1.07583,.973165,-.0778514,.106195,1.09451,.979387,-.0585067,.0797669,1.11137,.98671,-.0390409,.0530263,1.12643,.994093,-.019408,.0263163,1.14016,1.00002,5.40029E-4,-1.94487E-4,1.15299,.574483,-9.89066E-6,.494533,1.14896E-5,.574478,-2.49127E-4,
.494528,2.89403E-4,.574607,-9.96811E-4,.494637,.00115797,.574396,-.00224241,.494458,.00260498,.574377,-.00398632,.49444,.00463102,.574386,-.00622836,.494445,.00723623,.574401,-.0089683,.494453,.010421,.574419,-.0122056,.49446,.0141859,.574459,-.0159396,.494481,.0185322,.574525,-.0201692,.49452,.0234617,.574587,-.0248924,.494547,.0289762,.574697,-.0301074,.494604,.0350797,.574853,-.0358114,.494688,.0417767,.575027,-.041999,.494772,.0490718,.575294,-.0486618,.494915,.0569728,.575733,-.0557148,.495173,
.0654955,.576356,-.0630489,.495537,.0746612,.576944,-.0709285,.495836,.0844615,.57765,-.0792723,.496177,.0949142,.578491,-.0880167,.496563,.10603,.579639,-.0969462,.497096,.117841,.580989,-.10622,.497684,.130367,.582587,-.115861,.498337,.143609,.584951,-.125605,.499414,.157625,.587602,-.135608,.500518,.172413,.59076,-.145742,.501767,.187999,.594992,-.155934,.503542,.20445,.600656,-.166303,.506135,.221764,.607816,-.176681,.509542,.24002,.61522,-.187071,.51263,.258992,.623702,-.197465,.516021,.278773,
.634192,-.207816,.520422,.299377,.644936,-.218183,.524073,.320802,.657888,-.2278,.528049,.34384,.670666,-.236747,.52986,.36916,.685626,-.24484,.531892,.395867,.701304,-.252071,.532727,.423488,.717727,-.258714,.532146,.452201,.733914,-.264211,.529883,.481579,.750529,-.26859,.5259,.511558,.76747,-.272046,.51999,.542042,.785189,-.274225,.513083,.572799,.800954,-.275189,.502936,.603816,.816962,-.274946,.490921,.635461,.83336,-.272695,.47684,.6676,.848143,-.268223,.459405,.70051,.861818,-.262768,.440319,
.732902,.876828,-.255872,.420123,.765084,.889312,-.247703,.398379,.796391,.900412,-.238381,.374496,.827333,.912251,-.227783,.349874,.858385,.921792,-.214832,.323181,.888652,.931273,-.200949,.296624,.917763,.940295,-.186537,.269211,.947878,.946812,-.171538,.241447,.977016,.953588,-.155254,.213829,1.00501,.958841,-.137156,.186807,1.03179,.963746,-.118699,.160706,1.05502,.966468,-.0998358,.135504,1.07568,.971178,-.0805186,.109131,1.09479,.97831,-.0599348,.0818293,1.1123,.985886,-.0399661,.0545872,1.12771,
.994021,-.0198682,.0269405,1.14186,1.00009,2.71022E-4,-1.2989E-4,1.15514,.538716,-9.90918E-6,.486732,1.09675E-5,.550656,-2.50642E-4,.497518,2.77412E-4,.55057,-.00100265,.497441,.00110974,.550903,-.00225672,.497733,.00249779,.550568,-.00401046,.497438,.00443906,.550574,-.00626613,.49744,.00693637,.550591,-.0090226,.497449,.00998921,.550623,-.0122795,.497469,.0135984,.550667,-.0160361,.497495,.0177654,.550724,-.0202908,.497526,.0224915,.550792,-.0250421,.497557,.0277795,.550918,-.0302878,.49763,.0336334,
.551058,-.0360241,.497701,.0400573,.551276,-.0422473,.497824,.0470585,.551551,-.0489441,.497977,.0546433,.552074,-.0559596,.498312,.0628367,.552681,-.0633978,.498679,.071646,.553324,-.0713176,.499031,.0810746,.554011,-.0797268,.499365,.091129,.55488,-.0885238,.499779,.101837,.556171,-.0974417,.500444,.113239,.557498,-.106841,.501025,.125316,.559299,-.116533,.501864,.138128,.561647,-.126298,.502967,.151695,.564347,-.136388,.504129,.16604,.567863,-.146576,.505713,.181207,.572569,-.156832,.507953,.197259,
.578919,-.167323,.511186,.214258,.585387,-.177712,.514042,.232038,.593134,-.188184,.517484,.250733,.603295,-.198717,.522345,.270454,.613854,-.209177,.526751,.290807,.626092,-.219644,.531595,.312202,.637868,-.229494,.534721,.334435,.652458,-.238718,.538304,.359184,.666985,-.247061,.539875,.385637,.683301,-.254652,.541042,.41328,.69998,-.261376,.540735,.441903,.717824,-.267085,.539139,.471609,.734617,-.271465,.534958,.501446,.753663,-.27528,.53032,.532571,.770512,-.277617,.522134,.563641,.787356,-.278525,
.51206,.595067,.806252,-.278512,.50119,.627226,.822061,-.277023,.486791,.659402,.838959,-.273175,.470467,.692874,.85379,-.267238,.450688,.725702,.868268,-.260327,.429741,.75832,.881994,-.251946,.407223,.790189,.893885,-.242432,.383214,.821625,.905118,-.231904,.357297,.853011,.916045,-.219545,.330733,.883773,.927614,-.205378,.303916,.914435,.936005,-.190388,.275941,.944502,.944533,-.1749,.247493,.974439,.950758,-.158588,.218996,1.00286,.957078,-.141027,.191559,1.0304,.962448,-.121507,.164457,1.05466,
.964993,-.102068,.138636,1.0761,.970017,-.0822598,.111861,1.09541,.97661,-.062033,.0843438,1.11317,.985073,-.0409832,.0558496,1.12911,.993515,-.020146,.0275331,1.1438,1.00006,2.7329E-4,-1.07883E-4,1.15736,.525324,-9.99341E-6,.498153,1.05385E-5,.526513,-2.51605E-4,.499277,2.65329E-4,.526517,-.00100641,.499282,.0010613,.526588,-.00226466,.499337,.00238823,.526539,-.0040255,.499302,.00424535,.526547,-.00628954,.499306,.00663364,.526561,-.00905628,.499313,.00955337,.526593,-.0123253,.499334,.0130054,
.526642,-.0160957,.499365,.0169911,.5267,-.0203661,.499396,.0215122,.526792,-.0251347,.499451,.0265718,.526904,-.0303985,.499511,.0321732,.527079,-.0361554,.499617,.0383231,.527285,-.0423982,.499731,.045026,.527602,-.0491121,.499924,.0522936,.528166,-.0561127,.500306,.0601528,.52879,-.0635988,.5007,.0686059,.529421,-.071581,.501048,.0776518,.530144,-.0799854,.501421,.0873148,.531062,-.0888032,.501884,.0976084,.532374,-.0977643,.50259,.108588,.533828,-.107197,.50329,.120234,.53581,-.116887,.504312,
.132602,.538063,-.126755,.505365,.145721,.5409,-.136819,.506668,.159617,.544882,-.147117,.508731,.174369,.550238,-.157446,.511601,.190028,.556038,-.167988,.514431,.206587,.563031,-.178364,.517808,.224046,.571543,-.189007,.521937,.242503,.582255,-.199546,.527415,.261977,.59272,-.210084,.531682,.282162,.605648,-.220448,.537123,.303426,.61785,-.230593,.540664,.325323,.632223,-.240238,.544467,.348993,.648819,-.24887,.547594,.375462,.665825,-.256657,.54912,.403024,.683389,-.263711,.549294,.431773,.701495,
-.269666,.547649,.461494,.719197,-.274169,.543786,.491623,.737906,-.278124,.538644,.522994,.756652,-.280632,.531057,.554775,.775279,-.281741,.521972,.586441,.792688,-.281652,.509613,.618596,.811894,-.280345,.496497,.651462,.827938,-.277128,.47968,.684023,.844837,-.271646,.460688,.718024,.859239,-.264397,.438872,.751207,.874088,-.256144,.41577,.784232,.887693,-.246311,.391369,.816191,.899402,-.235497,.365872,.847828,.910973,-.223631,.338618,.87934,.92204,-.209874,.310803,.910325,.930987,-.194265,.281802,
.940695,.94,-.178125,.252836,.970958,.948018,-.161479,.224239,1.00078,.955141,-.144038,.195857,1.0288,.960513,-.124915,.168487,1.05371,.963964,-.104284,.141495,1.07596,.968713,-.0838732,.114437,1.09628,.975524,-.0635579,.0863105,1.11448,.98431,-.042291,.0574774,1.13069,.992916,-.0209131,.0284343,1.14568,.999926,7.43097E-4,-3.79265E-4,1.15955,.501042,-9.98428E-6,.498726,1.00306E-5,.502992,-2.52112E-4,.500665,2.53283E-4,.502417,-.00100791,.500092,.00101259,.502965,-.00226919,.500621,.00227978,.502318,
-.00403109,.499994,.00405011,.502333,-.00629832,.500005,.00632868,.502362,-.00906907,.500027,.00911446,.502369,-.0123423,.500023,.0124078,.50243,-.0161178,.500066,.016211,.502493,-.0203937,.500103,.0205256,.502592,-.0251684,.500166,.0253548,.502707,-.0304389,.50023,.0307029,.502881,-.0362015,.500335,.0365753,.503124,-.0424507,.500488,.0429798,.503443,-.0491582,.500686,.0499268,.504083,-.0561476,.501155,.0574541,.504668,-.0636846,.501524,.0655408,.505319,-.0716834,.501904,.0742072,.50609,-.0800925,
.502321,.0834699,.507122,-.0888425,.502896,.0933603,.508414,-.097855,.503603,.10391,.509955,-.107304,.504416,.115113,.512061,-.116921,.505565,.127054,.514419,-.12689,.506732,.139709,.517529,-.136934,.508338,.153173,.522085,-.147327,.510987,.167528,.526986,-.157612,.513527,.182708,.533122,-.168213,.516717,.198881,.540807,-.178688,.520832,.215986,.550687,-.189511,.52632,.234335,.560567,-.199998,.531009,.253375,.571698,-.210652,.535839,.273499,.584364,-.220917,.541091,.294355,.599066,-.23137,.546875,
.316525,.614148,-.241206,.551306,.339671,.631157,-.250379,.555187,.36531,.647919,-.258397,.556595,.392767,.666112,-.265528,.556949,.421397,.686158,-.271827,.556617,.451433,.704838,-.27674,.552975,.482131,.723957,-.280733,.547814,.513458,.74262,-.283359,.53997,.545446,.762009,-.284541,.530422,.57775,.781314,-.284507,.518546,.610434,.799116,-.283309,.504178,.643178,.817604,-.280378,.48843,.676248,.83459,-.275619,.469457,.709698,.850974,-.26856,.447698,.744245,.866747,-.260094,.424791,.777695,.881412,
-.249929,.399913,.810392,.8936,-.239137,.37308,.842872,.905943,-.226818,.345705,.874677,.916408,-.213699,.31706,.906257,.927215,-.198428,.288444,.936881,.935625,-.181643,.258329,.96795,.944076,-.164386,.228488,.998216,.951229,-.146339,.199763,1.02689,.958793,-.127709,.172153,1.0535,.963219,-.107244,.144989,1.07646,.967562,-.0857764,.11685,1.09675,.974866,-.0645377,.0880571,1.11576,.983353,-.0431732,.0587352,1.13227,.992503,-.0218356,.0294181,1.1478,1.00003,6.05203E-4,-2.31013E-4,1.16207,.482935,-1.01177E-5,
.504695,9.68142E-6,.477554,-2.51521E-4,.499071,2.40676E-4,.477904,-.00100683,.499436,9.6342E-4,.478368,-.00226636,.499899,.0021687,.477977,-.00402719,.499513,.00385384,.477993,-.00629226,.499525,.0060221,.478011,-.00906011,.499536,.00867289,.478051,-.0123305,.499566,.0118074,.478089,-.016102,.499587,.0154269,.478171,-.0203736,.499645,.0195341,.478254,-.025143,.499692,.0241318,.47839,-.0304071,.499779,.0292247,.478588,-.0361631,.499911,.0348196,.478812,-.0424023,.500046,.0409231,.479208,-.0490724,
.500326,.047552,.479841,-.0560722,.500805,.0547377,.480392,-.0636125,.501152,.0624607,.481068,-.0716134,.501561,.0707473,.481898,-.0800062,.502054,.0796118,.483022,-.0886568,.502728,.0890974,.484332,-.0977553,.503479,.0992099,.486126,-.107173,.504546,.10999,.488066,-.11677,.50557,.121476,.490521,-.126725,.506849,.133672,.494232,-.136793,.50911,.146731,.498302,-.147116,.511345,.160577,.503565,-.157446,.514344,.175335,.510902,-.168121,.518824,.191207,.519263,-.178799,.523666,.208058,.528204,-.189407,
.528296,.225875,.538854,-.200145,.533724,.244782,.551278,-.210701,.539833,.264753,.565222,-.221303,.546131,.285745,.579403,-.231688,.551496,.307592,.595469,-.241718,.556809,.330582,.610929,-.250992,.559641,.354995,.629433,-.259602,.562379,.382471,.648504,-.267038,.563676,.411126,.66756,-.273388,.562092,.440924,.689143,-.278788,.560807,.472118,.709056,-.282783,.555701,.503774,.729855,-.285836,.548698,.536364,.748954,-.287078,.538544,.56895,.768373,-.287133,.526711,.601991,.78827,-.285839,.512511,.635403,
.807465,-.283238,.496323,.668797,.825194,-.27906,.477638,.702584,.842203,-.272286,.456253,.736393,.857749,-.263854,.432412,.77096,.874799,-.253943,.407806,.80489,.887497,-.24237,.38033,.83771,.89966,-.230278,.352446,.870376,.911753,-.21646,.323268,.902256,.923011,-.202071,.294314,.933306,.932375,-.185519,.264104,.965177,.940537,-.167604,.234035,.996303,.948904,-.149068,.20412,1.0261,.955263,-.129539,.175431,1.05304,.960303,-.109932,.148116,1.07617,.965512,-.0880572,.119693,1.09742,.973466,-.0660548,
.0901619,1.11721,.98284,-.0439228,.0599875,1.13436,.992216,-.0219588,.0298975,1.15006,.999946,1.19402E-4,-2.08547E-5,1.16471,.447827,-1.00414E-5,.491543,9.14833E-6,.454778,-2.51257E-4,.499172,2.2891E-4,.453519,-.00100342,.497787,9.14184E-4,.45357,-.00225776,.497847,.00205701,.453578,-.00401371,.497855,.00365705,.45357,-.00627107,.497841,.00571453,.453598,-.00902968,.497864,.00823019,.453627,-.0122888,.497882,.0112049,.453684,-.0160475,.497923,.0146405,.453764,-.0203044,.49798,.0185394,.453866,-.0250576,
.498049,.0229054,.453996,-.0303028,.49813,.0277424,.454196,-.0360379,.498267,.0330587,.454457,-.0422521,.498445,.0388613,.454926,-.0488393,.498812,.0451767,.455525,-.0558653,.499272,.0520153,.456074,-.0633772,.499625,.0593754,.456752,-.0713606,.500049,.0672751,.457648,-.07971,.500615,.0757447,.458849,-.0883032,.501399,.0848231,.46029,-.0974095,.502293,.0945135,.462,-.106729,.503301,.104848,.464121,-.116354,.504533,.115884,.466889,-.126214,.506172,.127652,.470744,-.136324,.508667,.14024,.47488,-.146595,
.510995,.153673,.480845,-.157027,.514832,.168053,.488262,-.167658,.519506,.183508,.496547,-.178343,.524347,.199948,.506254,-.188916,.52983,.217503,.517961,-.199975,.536357,.236272,.531484,-.210624,.543641,.256096,.545496,-.221227,.550048,.277085,.559497,-.231568,.555076,.298615,.575752,-.241698,.560541,.321547,.591999,-.251172,.564156,.345602,.610654,-.260178,.567607,.371851,.630484,-.268094,.56923,.40076,.651807,-.274661,.569779,.430801,.67239,-.280331,.566791,.461939,.693024,-.284501,.562007,.493854,
.715473,-.287852,.555791,.526992,.736323,-.28929,.546345,.560102,.755771,-.289405,.534,.593543,.775424,-.2881,.519114,.627256,.795447,-.285562,.502543,.661464,.815319,-.281416,.484773,.695206,.831769,-.275523,.463445,.729044,.849464,-.267516,.440269,.764069,.866775,-.257584,.415049,.799089,.881252,-.245817,.388049,.831948,.894209,-.233127,.35889,.865526,.906922,-.219579,.329915,.89818,.919686,-.204491,.300441,.930013,.929044,-.188962,.269445,.962061,.938393,-.171079,.238402,.994214,.94661,-.15199,
.208204,1.02533,.953095,-.131953,.178653,1.0529,.958644,-.111233,.150684,1.0771,.963925,-.0903098,.122359,1.09855,.971995,-.0680505,.0923342,1.11874,.981658,-.0448512,.0614195,1.13635,.991649,-.0221931,.0303582,1.15238,.999985,3.93403E-4,-1.11086E-4,1.16772,.396806,-9.71563E-6,.457671,8.42355E-6,.429186,-2.49421E-4,.495017,2.1625E-4,.429324,-9.98052E-4,.495173,8.65322E-4,.429175,-.00224487,.494999,.00194637,.429129,-.00399041,.494952,.00346004,.429153,-.00623476,.494974,.00540684,.429168,-.0089773,
.494983,.00778714,.429207,-.0122175,.495012,.0106022,.429257,-.0159542,.495047,.0138535,.429338,-.0201864,.495106,.0175443,.429431,-.0249104,.495165,.0216774,.429587,-.0301252,.495279,.0262594,.429796,-.0358249,.495432,.0312968,.430065,-.0419972,.495621,.0367985,.430588,-.0485144,.496061,.042798,.43113,-.0555028,.496472,.0492914,.431743,-.0629852,.496904,.0562907,.432448,-.0709256,.497369,.0638056,.433414,-.0791942,.498032,.071885,.434638,-.0877346,.498854,.0805517,.43611,-.0968056,.499812,.0898047,
.437859,-.106002,.500891,.0997142,.440017,-.115648,.502198,.110289,.443236,-.125427,.504389,.121644,.44697,-.135492,.506809,.133769,.451689,-.145746,.509858,.146787,.45811,-.156219,.514247,.160793,.465305,-.166834,.518816,.175791,.474085,-.177546,.524331,.191906,.484808,-.188262,.53104,.209199,.49732,-.199346,.538511,.227825,.509693,-.209951,.544554,.247269,.524367,-.220533,.551616,.267978,.539228,-.231082,.557368,.289672,.55644,-.241342,.563782,.31268,.574204,-.250964,.568851,.33651,.593388,-.260306,
.57312,.362219,.613358,-.268667,.574916,.390322,.634512,-.275591,.575053,.420478,.65563,-.281328,.572404,.451614,.678265,-.285948,.568893,.484112,.70011,-.289408,.561878,.517348,.723005,-.291328,.55359,.551355,.743744,-.291418,.541099,.585109,.763949,-.290252,.526489,.619487,.784186,-.287648,.509496,.65404,.804304,-.283782,.491484,.688649,.823629,-.278067,.470517,.723133,.84094,-.270588,.44705,.757163,.857852,-.261188,.421252,.792816,.874934,-.249313,.394191,.827248,.888709,-.236492,.365359,.861074,
.902589,-.222185,.336016,.894417,.914201,-.207314,.30527,.926825,.925978,-.191146,.274532,.9595,.93512,-.174135,.243393,.991583,.943656,-.155231,.212414,1.02356,.951719,-.134403,.182005,1.05239,.957164,-.113023,.153043,1.07754,.962656,-.0914493,.124186,1.09984,.970695,-.0694179,.0941654,1.12,.980749,-.0466199,.0629671,1.13849,.991205,-.0227032,.0311146,1.15494,.999884,6.32388E-4,-2.54483E-4,1.1706,.379821,-9.57289E-6,.460637,7.89337E-6,.405188,-2.47483E-4,.491396,2.04064E-4,.404796,-9.89434E-4,.490914,
8.15853E-4,.40483,-.00222607,.490949,.00183559,.40473,-.00395723,.49084,.00326332,.404731,-.00618287,.490836,.00509945,.404768,-.00890258,.490871,.00734463,.404791,-.0121156,.490883,.00999992,.404857,-.0158214,.490938,.0130676,.404943,-.0200178,.491004,.0165503,.405059,-.0247027,.491093,.0204521,.405213,-.0298729,.491205,.0247788,.405399,-.0355226,.491333,.0295373,.405731,-.0416352,.491604,.034741,.406303,-.0480807,.492116,.0404255,.406814,-.0550458,.492506,.0465732,.407404,-.0624652,.492926,.0532058,
.408149,-.0702958,.493442,.0603442,.409128,-.0784623,.494136,.0680297,.410408,-.087007,.495054,.0762786,.411813,-.0959639,.495962,.0851046,.413735,-.105075,.497257,.0945878,.416137,-.114646,.498882,.104725,.41934,-.124394,.501132,.11563,.423326,-.134328,.503883,.127325,.428419,-.14458,.50747,.139911,.43484,-.154979,.511964,.153481,.442641,-.165628,.517328,.168114,.452511,-.176365,.524258,.183995,.463473,-.187298,.531248,.200953,.475564,-.198244,.538367,.219176,.488664,-.208938,.545175,.238514,.504073,
-.219599,.553227,.259129,.520832,-.230378,.560653,.280997,.538455,-.240703,.567523,.303821,.55709,-.250548,.573287,.327948,.576646,-.259964,.577795,.353362,.596705,-.268721,.580077,.380336,.618053,-.276054,.58018,.4101,.640303,-.282176,.578747,.44161,.662365,-.286931,.574294,.474106,.684542,-.290521,.567035,.507549,.707984,-.292672,.558687,.541853,.730913,-.293189,.547606,.576581,.752948,-.292199,.533471,.61172,.773452,-.289508,.516395,.646339,.794715,-.285716,.497873,.682131,.814251,-.280051,.476845,
.716396,.833057,-.272873,.453449,.751503,.84959,-.263982,.427857,.786085,.867022,-.252745,.400335,.821355,.882277,-.239655,.371304,.85646,.895375,-.225386,.340397,.890828,.909347,-.209587,.310005,.923532,.921885,-.193433,.2796,.956419,.932127,-.176135,.247276,.989445,.941869,-.157872,.216186,1.02221,.949735,-.137577,.185602,1.05195,.956617,-.115285,.155767,1.07822,.961974,-.0928418,.126103,1.10149,.96972,-.0700592,.0956758,1.12207,.98012,-.0474671,.0643269,1.1408,.990825,-.0238113,.0320863,1.1577,
.999876,3.81574E-4,-8.12203E-5,1.17403,.367636,-9.61342E-6,.469176,7.53287E-6,.380377,-2.44772E-4,.485434,1.91797E-4,.380416,-9.78857E-4,.485475,7.67015E-4,.380376,-.00220165,.485435,.00172522,.380419,-.00391408,.485487,.00306734,.380438,-.00611549,.485505,.00479332,.380462,-.00880558,.485525,.00690391,.380496,-.0119837,.485551,.00940039,.38056,-.0156487,.485605,.0122848,.38064,-.0197988,.485666,.0155601,.380767,-.0244324,.48577,.0192313,.380909,-.0295444,.485871,.0233032,.381142,-.0351321,.48606,
.0277861,.381472,-.0411535,.486336,.0326939,.382015,-.0475408,.486833,.0380565,.382523,-.0544395,.487231,.0438615,.383129,-.061784,.487683,.0501332,.383952,-.0695085,.488313,.0568996,.38498,-.0775819,.489077,.0641952,.386331,-.0860443,.490113,.0720324,.387788,-.0948406,.491099,.0804379,.389808,-.103899,.492566,.0894899,.39252,-.113313,.494601,.0992098,.395493,-.123007,.496619,.109641,.399826,-.132859,.499912,.120919,.405341,-.143077,.504061,.133107,.411932,-.153465,.508905,.146263,.420591,-.164108,
.515482,.160544,.43101,-.174893,.523191,.176123,.441881,-.185839,.53026,.192757,.453919,-.196633,.537295,.210535,.468715,-.207611,.546156,.229886,.485182,-.218517,.555173,.250543,.501926,-.229249,.562728,.27221,.51785,-.239481,.567494,.294892,.536947,-.249395,.573889,.318987,.557115,-.259,.578831,.344348,.577966,-.268075,.582055,.371223,.599489,-.276115,.583307,.399834,.62479,-.282523,.583902,.431415,.647504,-.287663,.57953,.464301,.670601,-.291538,.573103,.498123,.693539,-.293842,.563731,.532662,
.717385,-.294681,.553169,.567925,.741533,-.293717,.539908,.603502,.762142,-.291156,.521902,.639074,.783014,-.28719,.502815,.674439,.805158,-.281773,.482598,.710497,.823646,-.274682,.458949,.7456,.841879,-.266184,.433129,.781085,.859515,-.255682,.406064,.816,.875335,-.242849,.376509,.851074,.890147,-.228329,.345502,.886473,.903144,-.212491,.31428,.920751,.916618,-.195695,.282994,.954606,.927953,-.178267,.251091,.988402,.937414,-.159549,.219107,1.02141,.946823,-.140022,.18896,1.05167,.954651,-.118154,
.158667,1.07819,.959955,-.0946636,.128808,1.1025,.96858,-.0711792,.0973787,1.12391,.97938,-.0475046,.0650965,1.14322,.990498,-.024059,.0326267,1.16077,.999844,-5.12408E-5,1.12444E-4,1.17727,.316912,-9.34977E-6,.425996,6.95559E-6,.356423,-2.41372E-4,.479108,1.79562E-4,.356272,-9.65292E-4,.478897,7.1811E-4,.356262,-.00217182,.478894,.00161574,.356265,-.00386092,.478895,.00287261,.356278,-.0060324,.478905,.00448907,.356293,-.00868565,.478914,.00646572,.356346,-.0118207,.478965,.00880438,.356395,-.0154355,
.479001,.0115066,.356484,-.019529,.479075,.0145762,.356609,-.0240991,.47918,.018018,.356766,-.0291413,.479305,.0218379,.357009,-.0346498,.479512,.0260454,.357424,-.0405462,.479909,.0306657,.357899,-.0468825,.480337,.0357054,.358424,-.0536887,.480771,.0411728,.359041,-.0609416,.481242,.0470841,.359903,-.0685239,.481943,.0534831,.360932,-.0764883,.482741,.0603795,.362196,-.0848364,.483688,.0678028,.363847,-.0935002,.484947,.0758086,.365972,-.102471,.486588,.0844173,.368741,-.111751,.488787,.0937199,
.372146,-.121334,.491405,.103732,.377114,-.131147,.495604,.114608,.38226,-.141213,.499436,.126345,.389609,-.151632,.505334,.139116,.397925,-.162073,.51168,.152995,.407824,-.172819,.518876,.168071,.420014,-.183929,.527639,.184495,.434266,-.195032,.537588,.20232,.447352,-.205792,.544379,.221189,.463726,-.216704,.553422,.241616,.481406,-.227531,.562074,.263298,.498707,-.238017,.568227,.286116,.518039,-.247936,.574473,.3101,.538277,-.257437,.579191,.335401,.561166,-.266829,.584807,.362246,.583189,-.275329,
.586476,.390609,.606024,-.28234,.585578,.420998,.632419,-.287924,.584496,.454357,.656128,-.291972,.577766,.488233,.679953,-.29456,.56875,.523248,.704654,-.295816,.558388,.559168,.729016,-.295157,.544826,.595326,.752062,-.292779,.528273,.631864,.773138,-.288681,.508482,.667793,.794869,-.283358,.487341,.704035,.815101,-.27608,.46354,.739925,.834212,-.26767,.438672,.775539,.852368,-.257397,.411239,.810895,.870207,-.245689,.3829,.846472,.884063,-.231452,.351496,.881788,.898284,-.215561,.31895,.917438,
.912964,-.198208,.287367,.952422,.924666,-.180426,.254487,.987551,.934429,-.161525,.222226,1.02142,.943485,-.141197,.191143,1.05218,.9521,-.120085,.161112,1.07937,.957876,-.0975881,.130982,1.10403,.966943,-.0726842,.0990553,1.12616,.978313,-.0483705,.0662818,1.14619,.990048,-.0239072,.0329243,1.16413,.999984,4.61885E-4,-7.72859E-5,1.18099,.321287,-9.35049E-6,.455413,6.59662E-6,.332595,-2.37513E-4,.471437,1.67562E-4,.332729,-9.49964E-4,.471618,6.70192E-4,.332305,-.00213618,.471028,.00150712,.332326,
-.00379765,.471055,.00267959,.332344,-.00593353,.471072,.00418751,.332356,-.00854349,.471077,.00603172,.332403,-.0116268,.471121,.00821362,.332461,-.0151824,.47117,.0107357,.332552,-.0192088,.471251,.0136014,.332657,-.0237024,.47133,.0168152,.332835,-.0286615,.471487,.0203853,.333083,-.0340765,.471708,.0243212,.333547,-.0398563,.47219,.0286518,.333989,-.0460916,.472587,.0333763,.334532,-.0527897,.473054,.0385084,.335167,-.0599284,.473568,.0440638,.33608,-.0673514,.474362,.0500962,.337146,-.0752237,
.475231,.0566022,.338462,-.083418,.476282,.0636272,.34014,-.0919382,.477615,.0712153,.342341,-.100741,.479404,.079417,.345088,-.109905,.481618,.0882631,.349049,-.119369,.485081,.0978851,.353939,-.129033,.489317,.108336,.359893,-.139038,.494309,.119698,.366945,-.149411,.499983,.132024,.375814,-.159843,.507185,.145558,.387112,-.170664,.516392,.160433,.40023,-.181897,.526519,.176648,.412555,-.192785,.53423,.193922,.427023,-.203663,.542741,.212662,.443685,-.214695,.552066,.232944,.461499,-.225561,.560762,
.254495,.480975,-.236257,.569421,.277531,.501,-.24639,.576101,.301724,.521691,-.256101,.581493,.327112,.543478,-.265289,.585221,.353917,.566094,-.273938,.587614,.381941,.589578,-.281679,.587991,.41172,.614583,-.287655,.585928,.444148,.641813,-.292228,.582092,.478617,.666189,-.295172,.57398,.51397,.690475,-.29648,.561676,.550118,.715543,-.296203,.548758,.586933,.740405,-.293999,.532792,.62384,.762183,-.28998,.512735,.660723,.786069,-.28478,.492402,.69807,.806812,-.277568,.469058,.734422,.826987,-.268951,
.443017,.770946,.844588,-.259049,.415501,.80699,.863725,-.2471,.387328,.842107,.879137,-.234157,.356108,.878078,.894634,-.218719,.324315,.914058,.909162,-.201293,.291813,.949922,.92072,-.18267,.258474,.985337,.93158,-.163212,.225593,1.0205,.941238,-.142771,.193986,1.05273,.949293,-.120956,.163392,1.08075,.956226,-.0985743,.132934,1.10559,.96546,-.075118,.101255,1.12823,.977403,-.0497921,.0675441,1.149,.989648,-.0241574,.0334681,1.16765,1.00001,5.762E-4,-1.84807E-4,1.18519,.303474,-9.16603E-6,.4542,
6.1243E-6,.308894,-2.32869E-4,.462306,1.55592E-4,.309426,-9.31661E-4,.463093,6.22499E-4,.308643,-.0020949,.461933,.00139979,.308651,-.0037242,.461941,.00248874,.308662,-.00581873,.46195,.00388933,.308687,-.00837818,.461974,.00560247,.308728,-.0114016,.462011,.00762948,.308789,-.0148884,.462067,.00997326,.308882,-.0188369,.462151,.0126375,.309007,-.0232436,.462263,.0156271,.30918,-.0281054,.462417,.0189498,.309442,-.0334065,.462667,.0226167,.309901,-.0390589,.463162,.0266614,.310331,-.0452042,.463555,
.0310715,.310858,-.0517735,.464019,.0358698,.311576,-.0587359,.464669,.0410848,.312436,-.0660383,.465406,.0467453,.313526,-.0737266,.466339,.0528718,.314903,-.0817574,.467504,.0595039,.316814,-.090167,.469226,.0666888,.318965,-.0987555,.470981,.0744658,.322077,-.107792,.473814,.082912,.325947,-.117098,.477241,.0920846,.331008,-.126602,.48184,.102137,.337893,-.136619,.488334,.113135,.345106,-.146838,.494415,.12511,.355111,-.157357,.503275,.138356,.365095,-.167955,.510966,.152686,.378344,-.179157,.521508,
.16856,.391599,-.190143,.530455,.18561,.407786,-.20123,.541275,.204308,.425294,-.212456,.551784,.224623,.444021,-.223568,.561493,.246172,.463418,-.234154,.569886,.268979,.484077,-.244546,.577116,.293411,.505513,-.254301,.582914,.318936,.527672,-.263564,.587208,.345856,.550565,-.272332,.589277,.374054,.573656,-.280011,.588426,.403276,.59827,-.286924,.587504,.43474,.624731,-.291994,.583401,.468767,.652396,-.295159,.576997,.504411,.67732,-.296954,.565863,.54114,.703147,-.296877,.552316,.57816,.728715,
-.295147,.536773,.616124,.752448,-.291275,.51771,.653885,.775169,-.285905,.496087,.691537,.799307,-.279064,.474232,.729251,.819482,-.270294,.447676,.766267,.837659,-.260032,.419656,.802616,.856903,-.248497,.391328,.838583,.873325,-.235252,.360285,.874711,.889788,-.221126,.329215,.91077,.904486,-.204304,.296392,.94653,.917711,-.185562,.262159,.983828,.928969,-.165635,.229142,1.01955,.939707,-.14442,.19673,1.05317,.948167,-.122147,.165095,1.0823,.955222,-.099098,.13451,1.10791,.964401,-.0755332,.102476,
1.1312,.976605,-.0513817,.0689667,1.15218,.989085,-.0258499,.034506,1.17129,.999908,6.17773E-4,-2.71268E-4,1.18961,.285803,-9.05752E-6,.452348,5.72272E-6,.284689,-2.2732E-4,.450581,1.43626E-4,.285263,-9.10214E-4,.451482,5.75099E-4,.285302,-.00204784,.451553,.00129395,.285318,-.00364057,.451574,.0023006,.28533,-.00568813,.451585,.00359547,.285361,-.00819001,.451618,.00517934,.285397,-.0111458,.45165,.007054,.285447,-.0145536,.451688,.00922167,.285527,-.0184127,.451758,.0116869,.285688,-.0227207,.451929,
.0144555,.28584,-.0274712,.452055,.0175341,.286136,-.0326278,.452369,.0209406,.286574,-.0381792,.452853,.0246965,.287012,-.0441879,.453272,.0287996,.287542,-.0506096,.453752,.033268,.288299,-.0573634,.454488,.0381504,.289186,-.0645458,.455294,.0434447,.290302,-.0720405,.456301,.0491973,.291776,-.0799046,.457648,.0554453,.29372,-.088117,.459483,.0622311,.296052,-.0965328,.461571,.0695992,.299563,-.105409,.465085,.077658,.30335,-.114553,.468506,.0864176,.309167,-.123917,.474423,.0961078,.31529,-.13381,
.47995,.106643,.324163,-.144021,.488592,.118322,.333272,-.154382,.496461,.131133,.344224,-.165015,.50562,.145208,.357733,-.176168,.516719,.16073,.373046,-.187468,.528513,.177807,.38788,-.198488,.537713,.196072,.405133,-.209545,.547999,.21605,.423845,-.220724,.55759,.237484,.443777,-.231518,.566246,.26039,.464824,-.242035,.574326,.284835,.486635,-.251898,.58037,.310518,.51012,-.261304,.58568,.337678,.535301,-.270384,.590197,.366242,.559193,-.27841,.590569,.395873,.583544,-.285325,.588161,.426857,.608834,
-.291113,.584249,.459477,.635753,-.294882,.57763,.494734,.664367,-.297088,.569479,.532023,.689688,-.297364,.555064,.569629,.715732,-.295949,.539522,.608124,.741307,-.292259,.521613,.646231,.764949,-.287063,.49969,.684938,.788599,-.28012,.476747,.723548,.81048,-.27153,.45116,.761135,.831372,-.261289,.424101,.798916,.850092,-.249559,.39443,.835952,.867777,-.236348,.363849,.871606,.884632,-.221569,.332477,.907843,.90047,-.20618,.300667,.944187,.914524,-.188771,.266552,.981371,.926892,-.168362,.232349,
1.01841,.937951,-.146761,.199359,1.05308,.947236,-.123813,.1675,1.0839,.954367,-.099984,.136166,1.11047,.963907,-.0759278,.103808,1.13414,.976218,-.0511367,.0697061,1.15575,.988772,-.0267415,.0352529,1.17531,.999888,-5.20778E-4,2.89926E-4,1.19389,.263546,-8.83274E-6,.441896,5.26783E-6,.262352,-2.21849E-4,.439889,1.32311E-4,.262325,-8.86683E-4,.439848,5.28824E-4,.26228,-.00199476,.439765,.00118975,.262372,-.00354671,.439922,.00211568,.26239,-.00554141,.439941,.00330652,.262412,-.00797888,.439961,.00476346,
.262453,-.0108584,.440002,.00648818,.262528,-.0141788,.440085,.0084835,.262615,-.017938,.440166,.0107533,.262744,-.0221346,.440291,.0133044,.262939,-.026762,.440493,.0161445,.263277,-.0317573,.440889,.0192974,.26368,-.0371832,.441338,.0227699,.264106,-.0430371,.441753,.0265698,.264624,-.0493035,.442227,.0307178,.265378,-.0558669,.442985,.0352616,.266253,-.0628718,.443795,.0401968,.267478,-.0701569,.445008,.04559,.269062,-.077845,.446599,.0514539,.270926,-.0857941,.448349,.0578382,.273693,-.0940773,
.451221,.0648363,.276746,-.102704,.454097,.0724389,.281693,-.111735,.459517,.0808744,.287335,-.121004,.46531,.0901551,.29448,-.130734,.472605,.100371,.30257,-.140777,.480251,.111644,.312465,-.15111,.489444,.124111,.324856,-.16189,.500919,.137979,.33774,-.172946,.511317,.153163,.35255,-.184152,.522684,.169817,.367786,-.19522,.53248,.187886,.385474,-.20632,.543326,.207634,.404976,-.217744,.554109,.229165,.425203,-.228691,.563395,.252068,.446704,-.239299,.571565,.276471,.468951,-.249348,.577935,.302323,
.493487,-.258933,.584309,.329882,.517861,-.268009,.58773,.358525,.543309,-.276238,.589612,.388585,.569704,-.28356,.589294,.419787,.594871,-.289497,.585137,.452114,.622555,-.294452,.580356,.486466,.651167,-.296918,.57185,.523079,.677332,-.297647,.558428,.5611,.703718,-.296321,.542232,.599592,.730262,-.293339,.524541,.639138,.754304,-.288036,.502691,.677978,.778051,-.281018,.479212,.716537,.801557,-.272414,.454071,.75586,.822559,-.262419,.425952,.794477,.843051,-.250702,.397313,.832664,.86232,-.237264,
.366534,.869876,.879044,-.222716,.334816,.906973,.896362,-.206827,.303143,.943558,.910342,-.189659,.269699,.979759,.924119,-.171108,.236411,1.01718,.935374,-.149579,.202224,1.05289,.944295,-.126295,.16989,1.08496,.952227,-.101511,.138089,1.11256,.962041,-.0766392,.105053,1.1375,.97528,-.0511967,.070329,1.15983,.988476,-.025463,.0351268,1.17987,.999962,2.86808E-5,1.45564E-5,1.19901,.227089,-8.41413E-6,.404216,4.72707E-6,.239725,-2.15083E-4,.426708,1.20833E-4,.239904,-8.60718E-4,.427028,4.83555E-4,
.239911,-.00193661,.427039,.00108806,.239914,-.00344276,.42704,.00193457,.239933,-.00537907,.427064,.00302363,.239944,-.00774482,.427065,.00435604,.239993,-.01054,.427122,.00593398,.240052,-.0137626,.427179,.00775987,.240148,-.0174115,.427279,.00983854,.240278,-.021484,.42741,.0121763,.240472,-.0259729,.427618,.0147827,.240839,-.0308131,.428086,.0176837,.241201,-.0360893,.428482,.0208775,.241626,-.0417723,.428907,.0243821,.242207,-.0478337,.42952,.0282228,.24298,-.0542199,.430332,.0324333,.243881,
-.0610015,.431222,.0370252,.245123,-.0680874,.432512,.0420535,.24667,-.0755482,.434088,.0475414,.248779,-.0832873,.436323,.0535542,.251665,-.0913546,.439509,.0601716,.255305,-.0998489,.443478,.0674282,.260049,-.108576,.448713,.0754673,.266192,-.117754,.455524,.084339,.273158,-.127294,.4627,.0941683,.282131,-.137311,.472068,.10515,.293332,-.147736,.483565,.117402,.304667,-.158357,.493702,.130824,.317785,-.169274,.504708,.145724,.333245,-.180595,.517107,.16215,.349843,-.191892,.528849,.180149,.367944,
-.203168,.540301,.199746,.387579,-.214443,.551514,.221047,.408247,-.225624,.560906,.243981,.43014,-.236422,.56959,.268513,.452669,-.24654,.576098,.294409,.476196,-.256157,.580925,.322002,.501157,-.265289,.584839,.351052,.527632,-.273671,.587614,.3812,.555754,-.281254,.589119,.412994,.581682,-.287448,.585204,.445498,.608196,-.292614,.579006,.479505,.635661,-.296068,.571297,.514643,.664999,-.297395,.560855,.552213,.691039,-.296645,.544525,.591365,.7179,-.293785,.526535,.630883,.744059,-.289089,.50545,
.670932,.76863,-.282239,.482514,.710904,.793273,-.273688,.457246,.750259,.814731,-.26328,.428872,.78948,.835603,-.251526,.399384,.828597,.85489,-.238339,.368811,.866892,.872828,-.223607,.336617,.90563,.889462,-.207538,.303997,.943538,.904929,-.190297,.270812,.980591,.919101,-.172034,.237453,1.01935,.930536,-.152058,.204431,1.05498,.941223,-.129515,.172495,1.08717,.94982,-.104263,.140175,1.11551,.960592,-.0781944,.106465,1.14098,.974629,-.051688,.0711592,1.16418,.98811,-.0253929,.0354432,1.18465,1.00004,
8.04378E-4,-3.30876E-4,1.20462,.214668,-8.21282E-6,.406619,4.33582E-6,.218053,-2.08144E-4,.413025,1.09887E-4,.217987,-8.32212E-4,.412901,4.39362E-4,.217971,-.00187246,.412876,9.88623E-4,.217968,-.00332855,.41286,.00175772,.217985,-.00520055,.412882,.00274729,.218014,-.00748814,.412916,.00395842,.218054,-.0101901,.412957,.00539274,.218106,-.0133057,.413005,.00705348,.218217,-.0168342,.413139,.00894581,.218338,-.0207707,.413258,.0110754,.21855,-.0251001,.413509,.0134551,.218913,-.0297861,.413992,.0161081,
.219265,-.0348956,.414383,.0190307,.219696,-.0403909,.414839,.0222458,.220329,-.0462003,.415567,.025792,.220989,-.0524208,.41621,.0296637,.222027,-.058948,.417385,.0339323,.223301,-.0658208,.418779,.0386055,.224988,-.0730347,.420665,.0437355,.227211,-.0805274,.423198,.0493844,.230131,-.088395,.426566,.0556135,.233908,-.0966208,.43091,.0624829,.239092,-.105223,.437148,.0701636,.245315,-.11424,.444302,.0786949,.253166,-.12368,.453262,.0882382,.262374,-.133569,.463211,.0988682,.273145,-.143836,.474271,
.110727,.285512,-.154577,.4863,.123945,.299512,-.165501,.498817,.138581,.314287,-.176698,.510341,.154676,.331083,-.188066,.522583,.172459,.349615,-.199597,.534879,.191979,.369318,-.210843,.546083,.21309,.390377,-.222068,.5562,.235998,.412411,-.233059,.564704,.260518,.435715,-.24357,.572314,.286795,.461196,-.253356,.579395,.314559,.485587,-.262362,.581985,.343581,.511908,-.270895,.584347,.374367,.539798,-.278452,.58505,.406015,.567974,-.284877,.583344,.439168,.594303,-.290124,.577348,.473005,.622951,
-.294183,.570751,.508534,.652404,-.296389,.561541,.544764,.679291,-.296605,.546426,.582927,.706437,-.294095,.528599,.622681,.734485,-.28978,.508676,.663567,.758841,-.283363,.484768,.704092,.78537,-.275015,.460434,.745101,.807315,-.264689,.432166,.784712,.8271,-.252597,.401807,.824241,.849191,-.239154,.371458,.863803,.867046,-.224451,.338873,.903063,.8852,-.208342,.306175,.942763,.901771,-.190684,.272759,.981559,.915958,-.172105,.239306,1.02048,.928046,-.152214,.206071,1.05765,.939961,-.130247,.17367,
1.08999,.948711,-.10672,.142201,1.11829,.959305,-.0808688,.108454,1.14467,.973009,-.0539145,.0728109,1.16839,.987631,-.0262947,.0360625,1.19004,.999978,.00132758,-5.59424E-4,1.21058,.193925,-7.93421E-6,.391974,3.92537E-6,.196746,-2.00315E-4,.397675,9.91033E-5,.19667,-8.01099E-4,.397521,3.96342E-4,.196633,-.00180246,.397445,8.91829E-4,.196654,-.00320443,.397482,.00158582,.196659,-.00500647,.39748,.00247867,.196683,-.0072086,.397506,.00357167,.196728,-.00981001,.397562,.00486675,.196792,-.0128096,.397633,
.00636707,.19689,-.0162055,.397746,.00807752,.197017,-.0199943,.397884,.0100052,.19729,-.024139,.39827,.0121691,.197583,-.0286671,.398639,.0145755,.197927,-.0335858,.399034,.0172355,.198383,-.0388806,.399554,.0201718,.199002,-.0444736,.400289,.0234194,.199739,-.0504583,.401111,.026984,.200784,-.056729,.402349,.0309217,.202075,-.0633643,.403841,.0352496,.203898,-.0703247,.406076,.0400313,.206199,-.0775565,.408841,.0453282,.209252,-.085184,.41259,.0511794,.213638,-.0931994,.418288,.0577459,.21881,-.101617,
.424681,.0650508,.225642,-.11052,.433429,.0732759,.233717,-.119772,.442897,.0824683,.242823,-.129505,.452888,.0927484,.254772,-.139906,.466407,.104417,.266603,-.150402,.477413,.117211,.28073,-.161395,.490519,.131598,.295399,-.172465,.50201,.147407,.312705,-.183982,.515311,.165031,.331335,-.195532,.52786,.184336,.351037,-.206971,.5392,.205361,.372175,-.218117,.54941,.228043,.394548,-.229327,.558642,.25267,.419598,-.240052,.567861,.279071,.443922,-.249937,.573332,.306882,.471495,-.259407,.58013,.33661,
.496769,-.267749,.580564,.367328,.524951,-.275524,.581696,.399753,.55318,-.282148,.579885,.433134,.581577,-.287533,.575471,.467534,.609231,-.291612,.567445,.502943,.637478,-.293911,.557657,.53871,.667795,-.295096,.546535,.576568,.694272,-.294073,.529561,.614929,.722937,-.290386,.510561,.655909,.749682,-.284481,.487846,.697663,.774754,-.276188,.462487,.738515,.799301,-.266215,.43481,.779802,.820762,-.254116,.404879,.820045,.843231,-.240393,.374559,.860294,.861857,-.225503,.341582,.900965,.880815,-.209382,
.308778,.941727,.89766,-.19155,.275232,.980916,.912926,-.172346,.240938,1.02162,.926391,-.151799,.207223,1.0597,.938429,-.129968,.17484,1.09291,.947834,-.10651,.142984,1.12248,.958432,-.0824098,.109902,1.149,.972402,-.0565242,.0744454,1.1733,.987191,-.028427,.0373794,1.19538,.999975,3.85685E-5,-4.203E-5,1.21676,.178114,-7.66075E-6,.385418,3.54027E-6,.176074,-1.91966E-4,.381002,8.87135E-5,.17601,-7.67549E-4,.380861,3.54715E-4,.17598,-.00172696,.380798,7.98168E-4,.175994,-.00307012,.380824,.00141928,
.176017,-.00479684,.380858,.00221859,.176019,-.00690648,.380839,.00319714,.176072,-.00939888,.380913,.0043572,.176131,-.0122726,.380979,.005702,.176239,-.0155264,.38112,.00723689,.176371,-.0191551,.381272,.00896907,.176638,-.023117,.381669,.0109194,.176912,-.0274633,.382015,.0130903,.177279,-.032173,.382476,.0154949,.17774,-.0372219,.383041,.0181669,.178344,-.0426132,.38378,.0211209,.179153,-.0483309,.384773,.0243899,.180197,-.0543447,.386076,.0280062,.181581,-.0607122,.387809,.032004,.18344,-.0673855,
.390205,.036453,.186139,-.0743989,.393944,.0414162,.189432,-.0817731,.39832,.0469394,.193795,-.0895464,.404188,.0531442,.199641,-.0978264,.4121,.0601374,.206679,-.106499,.421425,.0680078,.214865,-.115654,.431504,.076919,.224406,-.125268,.442526,.0868835,.235876,-.135475,.455465,.0981875,.248335,-.146023,.4681,.110759,.262868,-.157016,.482069,.124885,.278962,-.168245,.496182,.140645,.295082,-.17958,.507401,.157838,.313738,-.191227,.520252,.17695,.333573,-.202718,.531708,.197817,.356433,-.214424,.544509,
.220785,.378853,-.225492,.55373,.245306,.402717,-.236236,.561348,.271593,.428375,-.246568,.568538,.299776,.454724,-.255941,.573462,.329433,.482291,-.264511,.576356,.360598,.509706,-.272129,.576446,.393204,.538805,-.278979,.575298,.427227,.568919,-.284528,.572154,.462157,.596804,-.288801,.564691,.497997,.625987,-.291334,.555134,.534467,.656414,-.292722,.545051,.571736,.683916,-.292185,.528813,.610158,.711809,-.290043,.51106,.649061,.739547,-.285246,.490103,.690081,.766914,-.277647,.465523,.732554,
.791375,-.267603,.437718,.773982,.814772,-.256109,.40882,.81609,.836691,-.242281,.377823,.856849,.856984,-.227155,.34496,.898363,.876332,-.210395,.311335,.939471,.894988,-.192612,.277703,.980799,.911113,-.173236,.243019,1.02215,.924092,-.152258,.209037,1.06139,.936828,-.129575,.175909,1.09635,.946869,-.10594,.143852,1.12707,.958284,-.081318,.110289,1.15419,.972325,-.0556133,.0747232,1.17909,.986878,-.0297899,.0383149,1.20163,.999936,-.00197169,9.12402E-4,1.22338,.151174,-7.20365E-6,.351531,3.09789E-6,
.155594,-1.8279E-4,.361806,7.8608E-5,.156099,-7.31569E-4,.362982,3.14615E-4,.156053,-.00164578,.362869,7.07845E-4,.156093,-.0029261,.362961,.00125884,.156099,-.00457155,.362959,.00196783,.15612,-.00658224,.362982,.00283622,.156168,-.00895774,.363048,.00386625,.156221,-.0116962,.363101,.00506109,.156324,-.0147973,.363241,.00642675,.156476,-.0182503,.363448,.00797175,.156731,-.0220266,.36384,.00971484,.156994,-.026176,.364179,.0116575,.157341,-.0306701,.36462,.0138207,.157867,-.0354591,.365364,.0162356,
.15846,-.0406141,.366111,.0189092,.159308,-.0460519,.367248,.021885,.160426,-.0518096,.368767,.0252004,.161877,-.0578906,.370745,.0288825,.163995,-.0642812,.373831,.0330139,.16655,-.0710067,.377366,.0376283,.170237,-.0781522,.382799,.0428493,.175096,-.0857172,.389915,.0487324,.181069,-.0938025,.398487,.0554214,.188487,-.102363,.408799,.0630189,.197029,-.111343,.419991,.071634,.206684,-.120812,.431455,.0812797,.218698,-.131033,.445746,.0923651,.230726,-.141373,.457471,.104545,.245516,-.152387,.472388,
.118449,.261551,-.163628,.486671,.133923,.277437,-.174814,.49762,.150849,.296662,-.186713,.51162,.169924,.31795,-.198513,.525435,.190848,.339422,-.210119,.536267,.213504,.362143,-.221354,.545982,.237947,.387198,-.23224,.555364,.264427,.412349,-.24257,.561489,.292519,.439274,-.252284,.566903,.322561,.466779,-.261023,.569614,.353952,.496011,-.26899,.571589,.387278,.524964,-.275498,.570325,.421356,.556518,-.281449,.568792,.457314,.584363,-.285526,.560268,.493199,.614214,-.28844,.55205,.530276,.645684,
-.289777,.541906,.56855,.673446,-.289722,.526464,.606927,.701924,-.287792,.509872,.645945,.73037,-.284315,.490649,.685564,.757405,-.278804,.467964,.726511,.784025,-.269543,.441468,.768601,.808255,-.258117,.41216,.811321,.830739,-.244728,.380606,.853496,.851914,-.229428,.348111,.895374,.872586,-.212508,.314732,.937674,.891581,-.194025,.280338,.979869,.907641,-.174711,.245203,1.02253,.922233,-.153509,.21077,1.06371,.935878,-.130418,.177399,1.09972,.946338,-.105558,.144507,1.13124,.957265,-.080059,.110508,
1.15973,.971668,-.0539766,.0742311,1.18515,.9866,-.0277101,.0375224,1.20858,1.00021,-5.15531E-4,1.35226E-4,1.23135,.137468,-6.86011E-6,.345041,2.73315E-6,.13703,-1.73378E-4,.343936,6.90761E-5,.136986,-6.93048E-4,.34383,2.76126E-4,.136964,-.00155931,.343761,6.21337E-4,.137003,-.00277211,.343863,.00110494,.137012,-.00433103,.343868,.00172744,.137043,-.00623606,.343916,.00249022,.13709,-.0084868,.343986,.00339559,.137145,-.0110814,.344045,.00444687,.137242,-.0140187,.344177,.00565007,.137431,-.0172713,
.344491,.00701868,.137644,-.0208605,.344805,.00856042,.13791,-.024792,.345172,.0102863,.138295,-.0290461,.345734,.0122185,.138764,-.0335957,.346371,.0143771,.139415,-.038467,.347298,.0167894,.140272,-.0436176,.348527,.0194895,.141457,-.0491016,.350276,.0225043,.14303,-.0548764,.352646,.0258962,.145289,-.0610096,.356206,.0297168,.148502,-.0674777,.361488,.0340562,.152188,-.074345,.367103,.0389534,.157359,-.0817442,.375247,.0445541,.16379,-.0896334,.385064,.0509535,.171376,-.098005,.396082,.0582611,
.179901,-.106817,.407418,.06654,.189892,-.116239,.420031,.075994,.201838,-.12627,.434321,.0867239,.214311,-.136701,.447631,.0987517,.228902,-.147616,.462046,.112353,.245107,-.158871,.476942,.127605,.262292,-.170261,.490285,.144469,.281215,-.182017,.503783,.163282,.301058,-.193729,.515505,.183873,.322752,-.205512,.52682,.206466,.347547,-.217214,.539473,.231194,.370969,-.227966,.546625,.257288,.397533,-.238555,.55472,.285789,.42398,-.248278,.559468,.315746,.452928,-.257422,.564095,.347724,.482121,-.265306,
.565426,.380922,.510438,-.272043,.563205,.415639,.541188,-.277614,.561087,.451702,.571667,-.281927,.554922,.48845,.602432,-.285015,.546838,.526442,.634126,-.286512,.537415,.564896,.662816,-.286388,.522906,.604037,.692411,-.284734,.507003,.643795,.720946,-.281297,.488398,.68298,.748293,-.276262,.466353,.723466,.776931,-.269978,.443573,.764565,.801065,-.260305,.415279,.805838,.825843,-.247426,.384773,.849985,.84807,-.232437,.352555,.893174,.869122,-.215806,.318642,.936564,.888963,-.197307,.28381,.980253,
.905547,-.177203,.247888,1.02463,.918554,-.155542,.212904,1.06714,.931395,-.131948,.1787,1.10451,.941749,-.106723,.145902,1.13694,.954551,-.0804939,.111193,1.1666,.970279,-.0534239,.0744697,1.19249,.986117,-.0257452,.0368788,1.21665,.999938,.00190634,-.0010291,1.23981,.118493,-6.47439E-6,.32272,2.3772E-6,.118765,-1.63023E-4,.323456,5.98573E-5,.118772,-6.5212E-4,.323477,2.39447E-4,.118843,-.00146741,.323657,5.38881E-4,.118804,-.00260846,.323553,9.5826E-4,.118826,-.00407576,.323595,.00149845,.118846,
-.00586826,.323617,.00216047,.118886,-.00798578,.32367,.00294679,.118947,-.0104273,.323753,.00386124,.119055,-.0131909,.323922,.00490999,.119241,-.0162444,.324251,.00610804,.11944,-.0196339,.324544,.00745805,.119739,-.0233378,.325026,.00897805,.12011,-.0273179,.325586,.0106895,.120571,-.0316143,.326231,.0126073,.12124,-.0361939,.327264,.0147654,.122162,-.0410511,.328733,.0172001,.123378,-.0462233,.330659,.0199375,.125183,-.0517109,.333754,.0230498,.127832,-.0575652,.338507,.026597,.130909,-.0637441,
.343666,.0306345,.135221,-.0704302,.351063,.035273,.14082,-.0776364,.360604,.0406137,.146781,-.0852293,.369638,.0466788,.155121,-.0935351,.3827,.0537628,.16398,-.102234,.39522,.0617985,.173926,-.111465,.40793,.07097,.185137,-.121296,.42105,.0813426,.19826,-.13169,.435735,.0931596,.212938,-.142614,.450932,.106547,.229046,-.153884,.465726,.121575,.246246,-.165382,.479461,.138286,.264637,-.176806,.492106,.15666,.284959,-.188793,.504774,.17728,.308157,-.200763,.518805,.19988,.330951,-.21239,.528231,.224293,
.3549,-.223521,.536376,.250541,.381502,-.234169,.544846,.278902,.409529,-.244077,.551717,.309227,.437523,-.253363,.55517,.341426,.467624,-.261659,.557772,.37518,.497268,-.268498,.556442,.41007,.528294,-.274018,.553915,.446445,.559053,-.278169,.549153,.483779,.589329,-.281229,.539878,.522249,.622503,-.282902,.53162,.561754,.652382,-.282815,.518119,.601544,.681847,-.281247,.502187,.641574,.712285,-.277986,.484824,.682633,.740094,-.273017,.463483,.723426,.768478,-.266692,.441299,.763747,.794556,-.258358,
.415238,.805565,.819408,-.248807,.386912,.847254,.843411,-.236214,.356165,.891091,.862397,-.219794,.320562,.936174,.883113,-.201768,.285322,.982562,.90023,-.181672,.249713,1.02862,.915192,-.159279,.214546,1.07163,.928458,-.134725,.180285,1.10995,.94069,-.10913,.147119,1.14354,.953409,-.0821315,.112492,1.17372,.969537,-.0542677,.0752014,1.20043,.985612,-.0259096,.0370361,1.22528,.999835,.00298198,-.00151801,1.24959,.10097,-6.02574E-6,.300277,2.02619E-6,.101577,-1.52164E-4,.302077,5.11662E-5,.101572,
-6.08889E-4,.302066,2.04751E-4,.101566,-.00136997,.302047,4.60753E-4,.101592,-.00243557,.302114,8.19497E-4,.101608,-.0038053,.30214,.00128154,.101627,-.00547906,.30216,.0018483,.101669,-.00745647,.302224,.00252223,.101732,-.00973615,.302318,.00330716,.101844,-.0123097,.302513,.00421061,.102025,-.0151681,.30285,.00524481,.102224,-.0183334,.303166,.0064154,.102515,-.0217819,.303654,.00774063,.102886,-.0255067,.304243,.0092398,.103395,-.029514,.305089,.0109339,.104109,-.0337912,.306301,.0128561,.105074,
-.0383565,.30798,.0150338,.10654,-.0432132,.310726,.0175228,.108478,-.0484244,.314351,.0203648,.111015,-.0539339,.319032,.0236325,.114682,-.0598885,.32605,.0274188,.11911,-.0663375,.334109,.0317905,.124736,-.0733011,.344013,.0368502,.131479,-.0807744,.355358,.0427104,.139283,-.0888204,.367614,.0494788,.148054,-.0973394,.380072,.0572367,.159037,-.10665,.395678,.0662704,.169794,-.116221,.40795,.0763192,.18314,-.126632,.423546,.087956,.197515,-.137383,.438213,.101042,.213514,-.148641,.453248,.115827,
.23065,-.160117,.46688,.132283,.249148,-.171807,.479962,.150644,.270219,-.183695,.494618,.171073,.292338,-.195574,.506937,.193378,.314999,-.207205,.516463,.217585,.340991,-.218955,.528123,.24428,.367982,-.229917,.537025,.272784,.39432,-.239737,.541627,.302742,.423364,-.249048,.546466,.335112,.453751,-.257329,.549466,.369032,.48416,-.264623,.549503,.404577,.515262,-.270411,.547008,.441337,.547036,-.274581,.542249,.479162,.576614,-.277266,.533015,.517904,.611143,-.279144,.525512,.558508,.640989,-.279001,
.51154,.598995,.671182,-.277324,.495641,.639935,.700848,-.273908,.477526,.681017,.729862,-.269063,.457955,.722764,.758273,-.262282,.434846,.764349,.784121,-.254281,.409203,.806206,.809798,-.24505,.382694,.848617,.834953,-.233861,.354034,.892445,.856817,-.221308,.321764,.936263,.877609,-.205996,.288118,.982401,.897489,-.186702,.253277,1.02975,.913792,-.164618,.217963,1.07488,.92785,-.140023,.183221,1.11487,.940378,-.11328,.149385,1.14947,.95273,-.0853958,.114152,1.1807,.969059,-.0568698,.0769845,1.20912,
.985574,-.0276502,.0381186,1.23498,.999943,.00239052,-.00126861,1.25987,.0852715,-5.60067E-6,.279021,1.71162E-6,.0854143,-1.40871E-4,.279483,4.30516E-5,.0854191,-5.63385E-4,.2795,1.72184E-4,.0854188,-.00126753,.279493,3.87464E-4,.0854229,-.00225337,.279501,6.8918E-4,.0854443,-.00352086,.279549,.00107803,.0854697,-.00506962,.279591,.00155536,.0855093,-.00689873,.279652,.00212354,.0855724,-.00900821,.279752,.00278703,.0856991,-.0113799,.280011,.0035551,.085855,-.0140314,.280297,.00443449,.0860682,-.016963,
.280682,.00543636,.086344,-.0201438,.281159,.0065788,.0867426,-.0235999,.281886,.00787977,.087239,-.0273069,.282745,.0093606,.0879815,-.031269,.284139,.011056,.0891258,-.035531,.28647,.0130065,.0906909,-.0400947,.289708,.0152495,.0927624,-.0449638,.293904,.0178454,.0958376,-.0502427,.300471,.0208915,.0995827,-.0559514,.30806,.0244247,.104526,-.0622152,.317874,.0285721,.110532,-.0690046,.329332,.0334227,.117385,-.0763068,.341217,.0390466,.12522,-.084184,.353968,.0455786,.134037,-.0925248,.366797,.0530773,
.144014,-.101487,.380209,.0617424,.156013,-.111273,.395956,.071777,.168872,-.121431,.41053,.0830905,.183089,-.132105,.425073,.0959341,.198763,-.143286,.439833,.110448,.216159,-.154841,.454507,.126769,.234859,-.166588,.468368,.14495,.255879,-.178626,.482846,.165233,.27677,-.190218,.493489,.187217,.301184,-.202227,.506549,.211659,.325852,-.213764,.5158,.237922,.352824,-.22487,.525442,.26632,.380882,-.235246,.532487,.296691,.410137,-.244847,.537703,.329179,.439787,-.253122,.540361,.363135,.472291,-.260517,
.542734,.399222,.501856,-.266519,.538826,.436352,.534816,-.270905,.535152,.474505,.565069,-.273826,.525979,.513988,.597154,-.275333,.516394,.554852,.630473,-.275314,.506206,.596592,.660574,-.273323,.489769,.638117,.692015,-.270008,.472578,.680457,.720647,-.265001,.452134,.723008,.750528,-.258311,.430344,.765954,.777568,-.250046,.405624,.809012,.80387,-.240114,.378339,.852425,.828439,-.228737,.349877,.895346,.851472,-.216632,.318968,.940695,.873906,-.202782,.287489,.987235,.89467,-.187059,.254394,
1.03348,.912281,-.168818,.221294,1.07812,.927358,-.146494,.18675,1.11928,.940385,-.120009,.152322,1.15609,.952672,-.0917183,.117514,1.18875,.968496,-.0620321,.0797405,1.21821,.985236,-.0314945,.0402383,1.24523,.99998,-5.75153E-4,1.10644E-4,1.27133,.0702429,-5.12222E-6,.255273,1.40947E-6,.0702981,-1.28826E-4,.255469,3.54488E-5,.0703691,-5.15562E-4,.255727,1.41874E-4,.0703805,-.00116,.255754,3.1929E-4,.0703961,-.00206224,.255813,5.67999E-4,.0704102,-.00322223,.255839,8.8871E-4,.0704298,-.00463928,.255863,
.00128272,.0704759,-.00631375,.255953,.00175283,.0705434,-.00824317,.256079,.00230342,.0706693,-.010412,.25636,.0029443,.0708189,-.0128439,.256647,.00368031,.0710364,-.0155177,.257084,.00452614,.0713223,-.0184374,.257637,.00549706,.0717182,-.0216002,.258416,.00661246,.072321,-.0249966,.259699,.00790147,.0731446,-.0286566,.261475,.0093884,.0743352,-.0325888,.264132,.0111186,.0760676,-.036843,.26815,.013145,.078454,-.0414292,.273636,.0155251,.0818618,-.0464634,.281653,.0183525,.0857382,-.0519478,.289992,
.0216642,.0908131,-.0579836,.30066,.0255956,.0967512,-.0645124,.312204,.0301954,.103717,-.0716505,.325001,.0356017,.111596,-.0793232,.338129,.041896,.120933,-.087645,.352853,.0492447,.130787,-.096492,.366192,.0576749,.142311,-.105973,.380864,.0673969,.155344,-.116182,.396575,.0785899,.169535,-.126815,.411443,.0912377,.185173,-.138015,.426256,.105607,.201755,-.149325,.439607,.121551,.221334,-.161207,.455467,.139608,.241461,-.173162,.469096,.159591,.26294,-.18504,.481014,.18156,.286776,-.196881,.493291,
.205781,.311596,-.208311,.503556,.231819,.338667,-.219671,.513268,.260274,.366021,-.230451,.519414,.290862,.395875,-.240131,.526766,.323196,.425564,-.248566,.52905,.357071,.457094,-.256195,.530796,.393262,.488286,-.262331,.528703,.430797,.522291,-.267141,.52727,.470231,.554172,-.270411,.519848,.510477,.586427,-.271986,.510307,.551594,.619638,-.27192,.499158,.593849,.650656,-.269817,.483852,.636314,.68284,-.266267,.467515,.679679,.714356,-.26113,.44931,.723884,.742717,-.254067,.425789,.767245,.770894,
-.245652,.401144,.811819,.797358,-.235554,.374224,.856315,.823377,-.223896,.346167,.901077,.847456,-.210865,.316056,.946502,.870697,-.196574,.284503,.993711,.891068,-.180814,.251628,1.04134,.909267,-.163314,.219065,1.08609,.925653,-.143304,.186446,1.12702,.940017,-.121322,.153416,1.16371,.952398,-.0973872,.120334,1.19712,.967568,-.0698785,.08352,1.22791,.984772,-.0390031,.0439209,1.25672,1.00026,-.0070087,.00315668,1.28428,.0556653,-4.59654E-6,.227325,1.12556E-6,.0565238,-1.16382E-4,.230826,2.84985E-5,
.0565717,-4.65666E-4,.231026,1.14036E-4,.0565859,-.00104773,.231079,2.56656E-4,.0565761,-.00186255,.231025,4.5663E-4,.0565913,-.00291002,.231058,7.14664E-4,.0566108,-.00418998,.231085,.00103224,.0566532,-.00570206,.231169,.00141202,.0567473,-.00743666,.231417,.00186018,.0568567,-.00940298,.231661,.00238264,.0569859,-.0115991,.231895,.00298699,.0572221,-.0140096,.232456,.00368957,.057519,-.0166508,.233096,.00450303,.0579534,-.01951,.234094,.00544945,.0585922,-.0225991,.235629,.00655564,.0595647,-.0259416,
.238106,.00785724,.0609109,-.0295661,.241557,.00939127,.0628751,-.0335126,.246652,.0112198,.0656908,-.0378604,.254091,.0134168,.0691347,-.0426543,.262666,.0160374,.0732165,-.0478967,.272029,.0191514,.0782863,-.0536716,.283007,.0228597,.0843973,-.0600683,.295732,.0272829,.0913598,-.0670095,.308779,.032484,.0994407,-.0745516,.322886,.0385886,.108189,-.082712,.336408,.0457133,.118574,-.0914927,.351692,.0539832,.129989,-.100854,.366502,.0635162,.142722,-.110837,.381675,.0744386,.156654,-.121353,.3963,
.0868483,.172151,-.132414,.411477,.100963,.188712,-.143809,.42508,.116795,.208093,-.155765,.441328,.134715,.227936,-.167608,.454328,.154396,.249495,-.179579,.467235,.176179,.27362,-.191488,.480248,.200193,.296371,-.202618,.487886,.225775,.324234,-.214133,.499632,.25441,.353049,-.225212,.509532,.285077,.381785,-.234875,.514265,.317047,.414038,-.244205,.521282,.351874,.445251,-.252145,.522931,.388279,.476819,-.258433,.520947,.425825,.509209,-.263411,.517669,.465104,.542759,-.266732,.512841,.505741,
.574822,-.268263,.503317,.547611,.609324,-.268489,.493035,.590953,.641772,-.266941,.478816,.63488,.674049,-.263297,.462863,.679072,.705071,-.257618,.442931,.723487,.734709,-.250625,.421299,.768708,.763704,-.24179,.397085,.814375,.791818,-.231115,.370577,.859907,.817439,-.21922,.34232,.906715,.843202,-.205658,.312627,.953943,.866639,-.190563,.280933,1.00185,.888129,-.173978,.248393,1.05105,.907239,-.155485,.216007,1.09704,.923893,-.134782,.183233,1.13857,.938882,-.11249,.150376,1.17539,.952464,-.0890706,
.117177,1.20924,.968529,-.0646523,.0813095,1.24055,.984763,-.038606,.0439378,1.27018,1.00053,-.01238,.00598668,1.29873,.0437928,-4.09594E-6,.204012,8.79224E-7,.0440166,-1.03395E-4,.205049,2.21946E-5,.0440529,-4.13633E-4,.205225,8.87981E-5,.0440493,-9.30594E-4,.2052,1.99858E-4,.0439884,-.00165352,.204901,3.55495E-4,.0440716,-.0025849,.205255,5.56983E-4,.0440968,-.00372222,.205311,8.05326E-4,.0441359,-.00506478,.205391,.00110333,.0442231,-.00660384,.205638,.00145768,.0443254,-.00835246,.205877,.00187275,
.0444832,-.0102992,.20627,.00235938,.0447001,-.0124449,.206796,.0029299,.0450168,-.0147935,.207593,.0036005,.0454816,-.017336,.208819,.00439246,.0462446,-.0201156,.211036,.00533864,.0473694,-.0231568,.214388,.00646984,.0490191,-.0264941,.219357,.00783856,.0512776,-.030184,.226061,.00950182,.0541279,-.0342661,.234094,.0115156,.0578989,-.0388539,.244297,.0139687,.0620835,-.0438735,.254457,.0169015,.0673497,-.04951,.266706,.0204554,.0731759,-.0556263,.278753,.0246606,.0803937,-.0624585,.29309,.0297126,
.0879287,-.0697556,.305856,.0355868,.0970669,-.0778795,.321059,.0425768,.106508,-.0863541,.333873,.05056,.11776,-.0955935,.349008,.0598972,.130081,-.105438,.363776,.0706314,.144454,-.115899,.380112,.0828822,.1596,-.126827,.394843,.0967611,.176097,-.138161,.409033,.112381,.194726,-.149904,.424257,.129952,.213944,-.161675,.436945,.149333,.235516,-.173659,.450176,.170892,.260564,-.185963,.466305,.194984,.285183,-.197582,.477328,.220805,.311095,-.208697,.486566,.248694,.338924,-.219519,.494811,.279015,
.369757,-.229766,.504065,.311725,.3996,-.238879,.507909,.345844,.430484,-.246802,.509805,.381749,.46413,-.253924,.511436,.420251,.497077,-.259319,.508787,.459957,.530434,-.263297,.50394,.501356,.565725,-.265619,.49804,.544252,.599254,-.265842,.487346,.587856,.631251,-.263978,.472975,.631969,.663972,-.26043,.457135,.677471,.697724,-.255358,.439844,.723744,.727725,-.248308,.417872,.770653,.756417,-.239181,.39273,.817357,.785419,-.22814,.367839,.864221,.81266,-.215681,.339449,.912701,.839391,-.201623,
.309279,.962419,.86366,-.185624,.278029,1.0122,.885028,-.16797,.245294,1.06186,.904639,-.148336,.212689,1.10934,.922048,-.12637,.179616,1.15063,.936952,-.102928,.146749,1.18885,.951895,-.0785268,.112733,1.22352,.967198,-.0530153,.0760056,1.25681,.984405,-.02649,.0383183,1.28762,1.00021,7.0019E-4,-2.0039E-4,1.31656,.0325964,-3.55447E-6,.176706,6.55682E-7,.0329333,-8.99174E-5,.178527,1.65869E-5,.0329181,-3.59637E-4,.178453,6.63498E-5,.0329085,-8.08991E-4,.178383,1.49332E-4,.0329181,-.00143826,.178394,
2.65873E-4,.0329425,-.00224678,.178517,4.16597E-4,.0329511,-.00323575,.17849,6.03299E-4,.033011,-.00439875,.178695,8.29422E-4,.0330733,-.00574059,.178843,.00109908,.0331857,-.00725896,.179176,.00141933,.0333445,-.00895289,.179618,.0017999,.0335674,-.0108219,.180238,.00225316,.033939,-.0128687,.181417,.00279765,.0345239,-.015114,.183395,.0034564,.0354458,-.017596,.186616,.00425864,.0368313,-.0203524,.191547,.00524936,.0386115,-.0234105,.197508,.00647033,.0410303,-.0268509,.205395,.00798121,.0442245,
-.0307481,.215365,.0098557,.0478659,-.0350863,.225595,.0121417,.0522416,-.0399506,.236946,.0149385,.0574513,-.045357,.249442,.0183189,.0631208,-.0512863,.261222,.0223644,.0701124,-.0579273,.275418,.0272418,.0777331,-.0650652,.288989,.0329458,.0862709,-.0728813,.302546,.0396819,.096103,-.081363,.317164,.04757,.106976,-.0904463,.331733,.0567012,.119175,-.100105,.34661,.067202,.132919,-.110375,.362249,.0792588,.147727,-.121115,.376978,.0928672,.163618,-.132299,.390681,.108228,.182234,-.143887,.406571,
.125502,.201809,-.155827,.42042,.144836,.225041,-.168357,.438411,.166706,.247621,-.18004,.450368,.189909,.27097,-.191536,.460083,.215251,.296658,-.203024,.469765,.243164,.325892,-.214056,.481837,.273388,.35406,-.224104,.487474,.305344,.384372,-.233489,.492773,.339741,.41749,-.241874,.498451,.376287,.45013,-.248834,.499632,.414195,.481285,-.254658,.495233,.454077,.519183,-.259367,.496401,.496352,.551544,-.261818,.487686,.538798,.587349,-.262964,.479453,.583626,.621679,-.262128,.467709,.629451,.654991,
-.258998,.452123,.67566,.686873,-.254119,.433495,.723248,.719801,-.246946,.413657,.771156,.750355,-.237709,.390366,.81989,.780033,-.226549,.364947,.868601,.809254,-.214186,.337256,.920034,.836576,-.199639,.307395,.971706,.861774,-.183169,.275431,1.02479,.885707,-.165111,.243431,1.07837,.904742,-.144363,.210921,1.12783,.915604,-.121305,.17647,1.17254,.930959,-.0962119,.143106,1.21012,.948404,-.069969,.108112,1.24474,.967012,-.0427586,.0708478,1.27718,.984183,-.0147043,.032335,1.3083,.999577,.0142165,
-.00726867,1.3382,.0229227,-2.99799E-6,.148623,4.62391E-7,.0232194,-7.58796E-5,.15054,1.17033E-5,.0232315,-3.03636E-4,.15063,4.68397E-5,.0232354,-6.83189E-4,.150624,1.05472E-4,.0232092,-.0012136,.150445,1.87744E-4,.0232523,-.00189765,.150679,2.94847E-4,.0232828,-.00273247,.150789,4.28013E-4,.0233371,-.00371287,.150995,5.91134E-4,.0234015,-.00484794,.15118,7.87642E-4,.023514,-.00612877,.151562,.00102547,.023679,-.00756125,.152116,.00131351,.0239559,-.00914651,.153162,.00166594,.0244334,-.010904,.155133,
.00210182,.025139,-.0128615,.158035,.00264406,.0262598,-.0150628,.162751,.00332923,.0277875,-.0175532,.168944,.00419773,.0298472,-.0203981,.176835,.00530034,.0325444,-.023655,.186686,.00669777,.0355581,-.0272982,.196248,.00842661,.0392841,-.0314457,.207352,.0105854,.0436815,-.0361157,.219279,.0132458,.0485272,-.0412932,.230728,.0164736,.0541574,-.0470337,.242994,.0203715,.0609479,-.0535002,.257042,.0250953,.0685228,-.0605409,.27102,.0306856,.0768042,-.0680553,.28406,.037193,.0864844,-.0765011,.299186,
.0449795,.0969415,-.0852674,.3132,.0538316,.108478,-.0947333,.327138,.0641149,.121705,-.10481,.342345,.0759185,.136743,-.115474,.358472,.0894116,.152986,-.126536,.374067,.104562,.170397,-.138061,.388267,.121632,.191392,-.150203,.406467,.140996,.211566,-.161751,.418641,.161696,.233567,-.173407,.430418,.184557,.257769,-.185397,.44277,.210092,.28531,-.197048,.457191,.237827,.311726,-.20784,.464712,.267253,.340537,-.218345,.472539,.299332,.372921,-.228306,.482331,.333988,.402924,-.236665,.484378,.369722,
.434475,-.244097,.484717,.407836,.469736,-.250547,.487093,.448465,.505045,-.25511,.485575,.490263,.540262,-.258444,.481225,.534495,.576347,-.259903,.473481,.579451,.608656,-.259572,.4603,.625604,.646679,-.257908,.450341,.674511,.679902,-.253663,.431561,.723269,.714159,-.247419,.412684,.773263,.745345,-.239122,.389388,.824182,.778248,-.228837,.365361,.876634,.807208,-.216197,.337667,.92945,.835019,-.201772,.307197,.985261,.860261,-.185291,.274205,1.04299,.877601,-.165809,.240178,1.09816,.898211,-.143897,
.207571,1.14694,.915789,-.119513,.174904,1.19008,.931831,-.0932919,.141423,1.2297,.949244,-.0656528,.105603,1.26553,.967527,-.0370262,.0679551,1.29986,.984139,-.00730117,.0283133,1.33252,.999713,.0234648,-.0121785,1.36397,.0152135,-2.45447E-6,.122795,3.04092E-7,.0151652,-6.15778E-5,.122399,7.6292E-6,.0151181,-2.45948E-4,.122023,3.04802E-5,.0151203,-5.53394E-4,.12203,6.86634E-5,.015125,-9.83841E-4,.122037,1.22463E-4,.0151427,-.00153774,.12214,1.92706E-4,.0151708,-.0022103,.122237,2.81219E-4,.0152115,
-.00300741,.12238,3.90804E-4,.0152877,-.00392494,.1227,5.26317E-4,.015412,-.00496597,.123244,6.9443E-4,.0156201,-.00613314,.124228,9.0547E-4,.0159658,-.00744113,.125945,.0011732,.0165674,-.00892546,.129098,.00151888,.017487,-.010627,.133865,.00197007,.018839,-.0126043,.140682,.0025637,.020554,-.0148814,.148534,.00333637,.0226727,-.0175123,.157381,.00433738,.0251879,-.0205266,.166685,.00561664,.0283635,-.0240319,.177796,.00725563,.0318694,-.0279432,.188251,.00928811,.0361044,-.0324313,.200038,.011835,
.0406656,-.0373527,.210685,.0149146,.0463846,-.0430132,.224182,.0187254,.0525696,-.0491013,.23634,.0232283,.0598083,-.0559175,.250013,.0286521,.0679437,-.0633657,.263981,.0350634,.0771181,-.0714602,.278072,.0425882,.0881273,-.0803502,.29511,.0514487,.0996628,-.0896903,.309976,.0615766,.112702,-.099644,.325611,.0732139,.126488,-.109829,.339321,.0862324,.142625,-.120859,.35574,.101275,.15953,-.131956,.369845,.117892,.176991,-.143145,.38146,.136205,.199715,-.155292,.40052,.157252,.220787,-.167066,.412055,
.179966,.243697,-.178396,.423133,.204418,.272106,-.190433,.439524,.232141,.297637,-.201265,.447041,.261109,.325273,-.211834,.454488,.292627,.357219,-.221889,.465004,.326669,.387362,-.230729,.468527,.362426,.423131,-.23924,.475836,.401533,.45543,-.246067,.475017,.441902,.493393,-.251557,.478017,.484239,.526253,-.255571,.4709,.528586,.560554,-.257752,.463167,.574346,.599306,-.258076,.456452,.621655,.634541,-.256471,.443725,.670492,.668907,-.253283,.428719,.721943,.705619,-.247562,.411348,.772477,.739034,
-.240626,.388939,.8264,.771408,-.231493,.36425,.881702,.803312,-.220125,.337321,.9385,.828457,-.206645,.305364,.997437,.854819,-.190664,.273715,1.05693,.878666,-.171429,.242218,1.11251,.898404,-.149235,.209556,1.16398,.917416,-.12435,.176863,1.21014,.933133,-.0972703,.142775,1.25178,.95066,-.0683607,.106735,1.29028,.968589,-.0378724,.0681609,1.32703,.984776,-.00605712,.0273966,1.36158,.99994,.0263276,-.0138124,1.3943,.00867437,-1.86005E-6,.0928979,1.73682E-7,.00864003,-4.66389E-5,.0925237,4.35505E-6,
.00864593,-1.86594E-4,.0925806,1.74322E-5,.00864095,-4.19639E-4,.0924903,3.92862E-5,.00863851,-7.46272E-4,.0924589,7.02598E-5,.00868531,-.00116456,.0929,1.11188E-4,.00869667,-.00167711,.0928529,1.63867E-4,.00874332,-.00228051,.0930914,2.3104E-4,.00882709,-.00297864,.0935679,3.1741E-4,.00898874,-.00377557,.0946165,4.30186E-4,.00929346,-.00469247,.0967406,5.80383E-4,.00978271,-.00575491,.100084,7.83529E-4,.0105746,-.00701514,.105447,.00106304,.0116949,-.00851797,.112494,.00144685,.0130419,-.0102757,
.119876,.00196439,.0148375,-.012381,.129034,.00266433,.0168725,-.01482,.137812,.00358364,.0193689,-.0176563,.147696,.00478132,.0222691,-.0209211,.157795,.00631721,.0256891,-.0246655,.168431,.00826346,.0294686,-.0288597,.178587,.0106714,.0340412,-.0336441,.190251,.0136629,.0393918,-.039033,.202999,.0173272,.0453947,-.0450087,.215655,.0217448,.0521936,-.0515461,.228686,.0269941,.0600279,-.058817,.242838,.033272,.0692398,-.0667228,.258145,.0406457,.0793832,-.0752401,.273565,.0492239,.0902297,-.0841851,
.287735,.0590105,.102014,-.0936479,.301161,.0702021,.116054,-.103967,.317438,.0832001,.13191,-.114622,.334166,.0977951,.148239,-.125452,.348192,.113985,.165809,-.136453,.361094,.131928,.184616,-.147648,.373534,.151811,.207491,-.159607,.39101,.174476,.230106,-.171119,.402504,.198798,.257036,-.182906,.418032,.225796,.281172,-.193605,.425468,.254027,.312034,-.204771,.440379,.285713,.340402,-.214988,.445406,.319196,.370231,-.224711,.44968,.35537,.407105,-.233516,.460747,.393838,.439037,-.240801,.460624,
.433747,.47781,-.24762,.465957,.477234,.510655,-.251823,.460054,.52044,.550584,-.255552,.459172,.567853,.585872,-.257036,.450311,.615943,.620466,-.257535,.437763,.667693,.660496,-.255248,.426639,.718988,.695578,-.251141,.409185,.772503,.732176,-.244718,.39015,.827023,.760782,-.236782,.362594,.885651,.79422,-.225923,.33711,.943756,.824521,-.213855,.308272,1.00874,.854964,-.197723,.278529,1.06764,.878065,-.179209,.246208,1.12836,.899834,-.157569,.21329,1.18318,.918815,-.133206,.181038,1.23161,.934934,
-.106545,.146993,1.27644,.952115,-.0780574,.111175,1.31842,.96906,-.0478279,.0728553,1.35839,.985178,-.0160014,.032579,1.39697,1.00039,.0173126,-.0095256,1.43312,.00384146,-1.24311E-6,.0613583,7.78271E-8,.00390023,-3.14043E-5,.0622919,1.96626E-6,.00389971,-1.25622E-4,.0622632,7.87379E-6,.00389491,-2.82352E-4,.0620659,1.778E-5,.00391618,-5.02512E-4,.0624687,3.20918E-5,.00392662,-7.84458E-4,.0625113,5.15573E-5,.00396053,-.00112907,.0628175,7.78668E-5,.00401911,-.00153821,.0633286,1.13811E-4,.00414994,
-.0020208,.0646443,1.6445E-4,.00441223,-.00260007,.0673886,2.37734E-4,.00484427,-.0033097,.0716528,3.45929E-4,.00549109,-.00418966,.0774998,5.05987E-4,.00636293,-.00527331,.0844758,7.39208E-4,.00746566,-.00660428,.0921325,.00107347,.00876625,-.00818826,.0997067,.00153691,.0103125,-.0100811,.107433,.00217153,.0123309,-.0123643,.117088,.00303427,.0146274,-.0150007,.126438,.00416018,.0172295,-.0180531,.135672,.00561513,.0204248,-.0215962,.146244,.007478,.0241597,-.0256234,.157481,.00981046,.0284693,
-.0302209,.169125,.0127148,.033445,-.0353333,.181659,.0162453,.0391251,-.0410845,.1944,.0205417,.0454721,-.0473451,.207082,.0256333,.0530983,-.0542858,.221656,.0317036,.0615356,-.0618384,.236036,.0388319,.0703363,-.0697631,.248398,.046974,.0810391,-.0784757,.263611,.0565246,.0920144,-.0873488,.275857,.0671724,.105584,-.0973652,.292555,.0798105,.119506,-.107271,.306333,.0935945,.134434,-.117608,.318888,.109106,.153399,-.128938,.337552,.127074,.171258,-.139944,.349955,.14643,.191059,-.151288,.361545,
.168,.215069,-.163018,.378421,.192082,.237838,-.174226,.38879,.217838,.266965,-.186063,.405857,.246931,.292827,-.196909,.414146,.277505,.324352,-.207473,.426955,.310711,.354427,-.217713,.433429,.346794,.389854,-.227183,.443966,.385237,.420749,-.235131,.44471,.424955,.459597,-.242786,.451729,.468446,.495316,-.248767,.45072,.513422,.534903,-.253351,.450924,.560618,.572369,-.256277,.445266,.609677,.612383,-.2576,.438798,.660995,.644037,-.256931,.421693,.713807,.686749,-.254036,.4109,.767616,.719814,
-.249785,.390151,.82533,.754719,-.244283,.367847,.888311,.792022,-.235076,.345013,.948177,.822404,-.225061,.316193,1.01661,.853084,-.211113,.287013,1.08075,.879871,-.19449,.255424,1.14501,.901655,-.174023,.222879,1.20203,.919957,-.1509,.18989,1.25698,.938412,-.124923,.15606,1.30588,.953471,-.0968139,.120512,1.3529,.970451,-.066734,.0828515,1.3986,.985522,-.034734,.0424458,1.44148,1.00099,-.00102222,6.78929E-4,1.48398,9.65494E-4,-6.27338E-7,.0306409,1.97672E-8,9.9168E-4,-1.58573E-5,.0314638,4.99803E-7,
9.91068E-4,-6.34012E-5,.031363,2.00682E-6,9.74567E-4,-1.4144E-4,.03036,4.57312E-6,9.98079E-4,-2.52812E-4,.031496,8.60131E-6,.00102243,-3.96506E-4,.0319955,1.48288E-5,.00107877,-5.77593E-4,.0331376,2.49141E-5,.00121622,-8.16816E-4,.0359396,4.23011E-5,.0014455,-.00113761,.0399652,7.24613E-5,.00178791,-.00156959,.0450556,1.23929E-4,.00225668,-.00214064,.0508025,2.08531E-4,.00285627,-.00287655,.0568443,3.41969E-4,.0035991,-.00380271,.0630892,5.44158E-4,.00455524,-.00496264,.0702204,8.42423E-4,.00569143,
-.0063793,.0773426,.00126704,.00716928,-.00813531,.0860839,.00186642,.00885307,-.0101946,.0944079,.00267014,.0109316,-.0126386,.103951,.00374033,.0133704,-.0154876,.113786,.0051304,.0161525,-.0187317,.123477,.00688858,.0194267,-.0224652,.133986,.00910557,.0230967,-.0265976,.143979,.0118074,.0273627,-.0312848,.154645,.0151266,.0323898,-.0365949,.166765,.0191791,.0379225,-.0422914,.177932,.0239236,.0447501,-.0487469,.19167,.0296568,.0519391,-.0556398,.203224,.0362924,.0599464,-.0631646,.215652,.0440585,
.0702427,-.0714308,.232089,.0531619,.0806902,-.0800605,.245258,.0634564,.0923194,-.0892815,.258609,.0752481,.106938,-.09931,.276654,.0888914,.121238,-.109575,.289847,.104055,.138817,-.120461,.307566,.121266,.15595,-.131209,.320117,.139944,.178418,-.143049,.339677,.161591,.197875,-.154074,.349886,.184303,.224368,-.166307,.369352,.210669,.252213,-.178051,.386242,.238895,.277321,-.189335,.395294,.269182,.310332,-.200683,.412148,.302508,.338809,-.210856,.418266,.337264,.372678,-.220655,.428723,.374881,
.405632,-.230053,.433887,.415656,.442293,-.237993,.439911,.457982,.477256,-.244897,.440175,.502831,.515592,-.250657,.441079,.550277,.550969,-.255459,.435219,.601102,.592883,-.257696,.432882,.651785,.629092,-.259894,.421054,.708961,.672033,-.258592,.41177,.763806,.709147,-.256525,.395267,.824249,.745367,-.254677,.375013,.8951,.784715,-.247892,.353906,.959317,.818107,-.240162,.327801,1.03153,.847895,-.229741,.298821,1.10601,.879603,-.213084,.269115,1.164,.902605,-.195242,.236606,1.22854,.922788,-.174505,
.203442,1.29017,.944831,-.150169,.169594,1.34157,.959656,-.124099,.135909,1.3956,.972399,-.0960626,.0990563,1.45128,.986549,-.0657097,.0602348,1.50312,1.00013,-.0333558,.0186694,1.55364,6.19747E-6,-1E-7,.00778326,7.96756E-11,2.37499E-8,-9.99999E-8,2.82592E-5,1.14596E-10,1.00292E-6,-1.66369E-6,2.50354E-4,6.77492E-9,3.50752E-6,-6.37769E-6,3.57289E-4,6.31655E-8,8.26445E-6,-1.74689E-5,5.16179E-4,3.1851E-7,2.42481E-5,-4.50868E-5,.0010223,1.30577E-6,4.55631E-5,-8.9044E-5,.00144302,3.74587E-6,9.71222E-5,
-1.78311E-4,.00241912,1.02584E-5,1.71403E-4,-3.13976E-4,.00354938,2.36481E-5,2.92747E-4,-5.20026E-4,.00513765,4.96014E-5,7.89827E-4,-.00118187,.0238621,1.39056E-4,.00114093,-.00171827,.0286691,2.44093E-4,.00176119,-.00249667,.0368565,4.20623E-4,.0022233,-.00333742,.0400469,6.5673E-4,.00343382,-.00481976,.0535751,.00109323,.00427602,-.00600755,.057099,.00155268,.00461435,-.00737637,.0551084,.00215031,.00695698,-.00971401,.0715767,.00316529,.00867619,-.0120943,.0793314,.00436995,.0106694,-.0148202,
.0869391,.0058959,.0140351,-.0183501,.101572,.00798757,.0168939,-.022006,.11018,.0104233,.020197,-.0261568,.119041,.0134167,.0254702,-.0312778,.135404,.0173009,.0298384,-.0362469,.1437,.0215428,.035159,-.042237,.15512,.0268882,.0427685,-.0488711,.17128,.033235,.0494848,-.0557997,.181813,.0404443,.0592394,-.0635578,.198745,.0490043,.0681463,-.071838,.210497,.0588239,.0804753,-.0809297,.228864,.0702835,.0942205,-.0906488,.247008,.0834012,.106777,-.100216,.258812,.0975952,.124471,-.110827,.278617,.114162,
.138389,-.121193,.287049,.131983,.159543,-.13253,.307151,.152541,.176432,-.143611,.31564,.174673,.201723,-.15548,.33538,.199842,.229721,-.167166,.355256,.227097,.250206,-.178238,.360047,.256014,.282118,-.189905,.378761,.28855,.312821,-.201033,.39181,.323348,.341482,-.211584,.397716,.360564,.377368,-.221314,.410141,.400004,.418229,-.230474,.423485,.442371,.444881,-.239443,.418874,.488796,.488899,-.245987,.427545,.535012,.520317,-.253948,.422147,.589678,.568566,-.256616,.42719,.637683,.599607,-.26376,
.415114,.703363,.64222,-.268687,.408715,.771363,.685698,-.2694,.399722,.83574,.732327,-.266642,.388651,.897764,.769873,-.267712,.369198,.983312,.806733,-.263479,.346802,1.06222,.843466,-.254575,.321368,1.13477,.873008,-.242749,.29211,1.20712,.908438,-.22725,.262143,1.27465,.936321,-.207621,.228876,1.33203,.950353,-.187932,.19484,1.40439,.96442,-.165154,.163178,1.4732,.979856,-.139302,.127531,1.53574,.982561,-.11134,.0903457,1.59982,.996389,-.0808124,.0489007,1.6577]),64,64,THREE.RGBAFormat,THREE.FloatType,
THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.LinearFilter,THREE.NearestFilter,1);let e=new THREE.DataTexture(new Float32Array([1,0,0,0,1,7.91421E-31,0,0,1,1.04392E-24,0,0,1,3.49405E-21,0,0,1,1.09923E-18,0,0,1,9.47414E-17,0,0,1,3.59627E-15,0,0,1,7.72053E-14,0,0,1,1.08799E-12,0,0,1,1.10655E-11,0,0,1,8.65818E-11,0,0,.999998,5.45037E-10,0,0,.999994,2.85095E-9,0,0,.999989,1.26931E-8,0,0,.999973,4.89938E-8,0,0,.999947,1.66347E-7,0,0,.999894,5.02694E-7,0,0,.999798,1.36532E-6,
0,0,.999617,3.35898E-6,0,0,.999234,7.52126E-6,0,0,.998258,1.52586E-5,0,0,.99504,2.66207E-5,0,0,.980816,2.36802E-5,0,0,.967553,2.07684E-6,0,0,.966877,4.03733E-6,0,0,.965752,7.41174E-6,0,0,.96382,1.27746E-5,0,0,.960306,2.02792E-5,0,0,.953619,2.80232E-5,0,0,.941103,2.78816E-5,0,0,.926619,1.60221E-5,0,0,.920983,2.35164E-5,0,0,.912293,3.11924E-5,0,.0158731,.899277,3.48118E-5,0,.0476191,.880884,2.6041E-5,0,.0793651,.870399,3.38726E-5,0,.111111,.856138,3.92906E-5,0,.142857,.837436,3.72874E-5,0,.174603,.820973,
3.92558E-5,0,.206349,.803583,4.34658E-5,0,.238095,.782168,4.0256E-5,0,.269841,.764107,4.48159E-5,0,.301587,.743092,4.57627E-5,0,.333333,.721626,4.55314E-5,0,.365079,.700375,4.77335E-5,0,.396825,.677334,4.61072E-5,0,.428571,.655702,4.84393E-5,0,.460317,.632059,4.64583E-5,0,.492064,.610125,4.83923E-5,0,.52381,.58653,4.64342E-5,0,.555556,.564508,4.77033E-5,0,.587302,.541405,4.59263E-5,0,.619048,.519556,4.6412E-5,0,.650794,.497292,4.48913E-5,0,.68254,.475898,4.45789E-5,0,.714286,.454722,4.33496E-5,0,
.746032,.434042,4.23054E-5,0,.777778,.414126,4.13737E-5,0,.809524,.394387,3.97265E-5,0,.84127,.375841,3.90709E-5,0,.873016,.357219,3.69938E-5,0,.904762,.340084,3.65618E-5,0,.936508,.322714,3.42533E-5,0,.968254,.306974,3.39596E-5,0,1,1,1.01524E-18,0,0,1,1.0292E-18,0,0,1,1.30908E-18,0,0,1,4.73331E-18,0,0,1,6.25319E-17,0,0,1,1.07932E-15,0,0,1,1.63779E-14,0,0,1,2.03198E-13,0,0,1,2.04717E-12,0,0,.999999,1.68995E-11,0,0,.999998,1.15855E-10,0,0,.999996,6.6947E-10,0,0,.999991,3.30863E-9,0,0,.999983,1.41737E-8,
0,0,.999968,5.32626E-8,0,0,.99994,1.77431E-7,0,0,.999891,5.28835E-7,0,0,.999797,1.42169E-6,0,0,.999617,3.47057E-6,0,0,.999227,7.7231E-6,0,0,.998239,1.55753E-5,0,0,.994937,2.68495E-5,0,0,.980225,2.13742E-5,0,0,.967549,2.1631E-6,0,0,.966865,4.17989E-6,0,0,.965739,7.63341E-6,0,0,.963794,1.30892E-5,0,0,.960244,2.06456E-5,0,0,.953495,2.82016E-5,0,1.48105E-4,.940876,2.71581E-5,0,.002454,.926569,1.64159E-5,0,.00867491,.920905,2.39521E-5,0,.01956,.912169,3.15127E-5,0,.035433,.899095,3.46626E-5,0,.056294,
.882209,2.90223E-5,0,.0818191,.870272,3.42992E-5,0,.111259,.855977,3.94164E-5,0,.142857,.837431,3.72343E-5,0,.174603,.820826,3.96691E-5,0,.206349,.803408,4.35395E-5,0,.238095,.782838,4.19579E-5,0,.269841,.763941,4.50953E-5,0,.301587,.742904,4.55847E-5,0,.333333,.721463,4.58833E-5,0,.365079,.700197,4.77159E-5,0,.396825,.677501,4.70641E-5,0,.428571,.655527,4.84732E-5,0,.460317,.6324,4.76834E-5,0,.492064,.609964,4.84213E-5,0,.52381,.586839,4.75541E-5,0,.555556,.564353,4.76951E-5,0,.587302,.541589,4.67611E-5,
0,.619048,.519413,4.63493E-5,0,.650794,.497337,4.53994E-5,0,.68254,.475797,4.45308E-5,0,.714286,.454659,4.35787E-5,0,.746032,.434065,4.24839E-5,0,.777778,.414018,4.1436E-5,0,.809524,.39455,4.01902E-5,0,.84127,.375742,3.90813E-5,0,.873016,.357501,3.77116E-5,0,.904762,.339996,3.6535E-5,0,.936508,.323069,3.51265E-5,0,.968254,.306897,3.39112E-5,0,1,1,1.0396E-15,0,0,1,1.04326E-15,0,0,1,1.10153E-15,0,0,1,1.44668E-15,0,0,1,3.4528E-15,0,0,1,1.75958E-14,0,0,1,1.2627E-13,0,0,1,9.36074E-13,0,0,1,6.45742E-12,
0,0,.999998,4.01228E-11,0,0,.999997,2.22338E-10,0,0,.999995,1.0967E-9,0,0,.999991,4.82132E-9,0,0,.999981,1.89434E-8,0,0,.999967,6.67716E-8,0,0,.999938,2.12066E-7,0,0,.999886,6.0977E-7,0,0,.999792,1.59504E-6,0,0,.999608,3.81191E-6,0,0,.999209,8.33727E-6,0,0,.998179,1.65288E-5,0,0,.994605,2.74387E-5,0,0,.979468,1.67316E-5,0,0,.967529,2.42877E-6,0,0,.966836,4.61696E-6,0,0,.96569,8.30977E-6,0,0,.963706,1.40427E-5,0,2.44659E-6,.960063,2.17353E-5,0,7.60774E-4,.953113,2.86606E-5,0,.00367261,.940192,2.47691E-5,
0,.00940263,.927731,1.95814E-5,0,.018333,.920669,2.52531E-5,0,.0306825,.911799,3.24277E-5,0,.0465556,.89857,3.40982E-5,0,.0659521,.883283,3.19622E-5,0,.0887677,.86989,3.5548E-5,0,.114784,.855483,3.97143E-5,0,.143618,.837987,3.91665E-5,0,.174606,.820546,4.11306E-5,0,.206349,.802878,4.36753E-5,0,.238095,.783402,4.44E-5,0,.269841,.763439,4.58726E-5,0,.301587,.742925,4.67097E-5,0,.333333,.721633,4.78887E-5,0,.365079,.69985,4.81251E-5,0,.396825,.67783,4.91811E-5,0,.428571,.655126,4.88199E-5,0,.460318,
.632697,4.96025E-5,0,.492064,.609613,4.8829E-5,0,.52381,.587098,4.92754E-5,0,.555556,.564119,4.82625E-5,0,.587302,.541813,4.82807E-5,0,.619048,.519342,4.71552E-5,0,.650794,.497514,4.66765E-5,0,.68254,.475879,4.55582E-5,0,.714286,.454789,4.46007E-5,0,.746032,.434217,4.35382E-5,0,.777778,.414086,4.21753E-5,0,.809524,.394744,4.12093E-5,0,.84127,.375782,3.96634E-5,0,.873016,.357707,3.86419E-5,0,.904762,.340038,3.70345E-5,0,.936508,.323284,3.59725E-5,0,.968254,.306954,3.436E-5,0,1,1,5.99567E-14,0,0,1,
6.00497E-14,0,0,1,6.14839E-14,0,0,1,6.86641E-14,0,0,1,9.72658E-14,0,0,1,2.21271E-13,0,0,1,8.33195E-13,0,0,1,4.03601E-12,0,0,.999999,2.06001E-11,0,0,.999998,1.01739E-10,0,0,.999997,4.70132E-10,0,0,.999993,2.00436E-9,0,0,.999988,7.83682E-9,0,0,.999979,2.80338E-8,0,0,.999962,9.17033E-8,0,0,.999933,2.74514E-7,0,0,.999881,7.53201E-7,0,0,.999783,1.89826E-6,0,0,.999594,4.40279E-6,0,0,.999178,9.3898E-6,0,0,.998073,1.81265E-5,0,0,.993993,2.80487E-5,0,0,.979982,1.49422E-5,0,0,.968145,3.78481E-6,0,0,.966786,
5.3771E-6,0,0,.965611,9.47508E-6,0,3.88934E-5,.963557,1.56616E-5,0,9.693E-4,.959752,2.35144E-5,0,.00370329,.952461,2.91568E-5,0,.00868428,.940193,2.40102E-5,0,.0161889,.929042,2.31235E-5,0,.0263948,.920266,2.73968E-5,0,.0394088,.911178,3.37915E-5,0,.0552818,.897873,3.33629E-5,0,.0740138,.884053,3.51405E-5,0,.0955539,.869455,3.78034E-5,0,.119795,.854655,3.99378E-5,0,.14656,.838347,4.19108E-5,0,.175573,.820693,4.40831E-5,0,.206388,.802277,4.45599E-5,0,.238095,.783634,4.72691E-5,0,.269841,.763159,4.76984E-5,
0,.301587,.742914,4.91487E-5,0,.333333,.721662,5.02312E-5,0,.365079,.699668,5.02817E-5,0,.396825,.677839,5.1406E-5,0,.428571,.655091,5.11095E-5,0,.460317,.632665,5.16067E-5,0,.492064,.609734,5.12255E-5,0,.52381,.587043,5.10263E-5,0,.555556,.564298,5.0565E-5,0,.587302,.541769,4.97951E-5,0,.619048,.519529,4.92698E-5,0,.650794,.497574,4.82066E-5,0,.68254,.476028,4.73689E-5,0,.714286,.454961,4.61941E-5,0,.746032,.434341,4.50618E-5,0,.777778,.414364,4.38355E-5,0,.809524,.394832,4.24196E-5,0,.84127,.376109,
4.12563E-5,0,.873016,.35779,3.96226E-5,0,.904762,.340379,3.84886E-5,0,.936508,.323385,3.68214E-5,0,.968254,.307295,3.56636E-5,0,1,1,1.06465E-12,0,0,1,1.06555E-12,0,0,1,1.07966E-12,0,0,1,1.14601E-12,0,0,1,1.37123E-12,0,0,1,2.1243E-12,0,0,.999999,4.89653E-12,0,0,.999999,1.60283E-11,0,0,.999998,6.2269E-11,0,0,.999997,2.51859E-10,0,0,.999996,9.96192E-10,0,0,.999992,3.74531E-9,0,0,.999986,1.32022E-8,0,0,.999975,4.33315E-8,0,0,.999959,1.31956E-7,0,0,.999927,3.72249E-7,0,0,.999871,9.72461E-7,0,0,.999771,
2.35343E-6,0,0,.999572,5.2768E-6,0,0,.999133,1.09237E-5,0,0,.997912,2.03675E-5,0,0,.993008,2.79396E-5,0,0,.980645,1.39604E-5,0,0,.970057,6.46596E-6,0,0,.966717,6.5089E-6,0,4.74145E-5,.965497,1.11863E-5,0,8.9544E-4,.96334,1.79857E-5,0,.0032647,.959294,2.59045E-5,0,.0075144,.951519,2.92327E-5,0,.0138734,.940517,2.49769E-5,0,.0224952,.93014,2.6803E-5,0,.0334828,.91972,3.03656E-5,0,.0468973,.910294,3.53323E-5,0,.0627703,.897701,3.51002E-5,0,.0811019,.884522,3.88104E-5,0,.10186,.869489,4.12932E-5,0,.124985,
.853983,4.15781E-5,0,.150372,.838425,4.54066E-5,0,.177868,.820656,4.71624E-5,0,.207245,.801875,4.75243E-5,0,.238143,.783521,5.05621E-5,0,.269841,.763131,5.0721E-5,0,.301587,.74261,5.23293E-5,0,.333333,.72148,5.28699E-5,0,.365079,.699696,5.38677E-5,0,.396825,.677592,5.39255E-5,0,.428571,.65525,5.46367E-5,0,.460317,.632452,5.41348E-5,0,.492064,.609903,5.44976E-5,0,.52381,.586928,5.36201E-5,0,.555556,.564464,5.35185E-5,0,.587302,.541801,5.24949E-5,0,.619048,.519681,5.1812E-5,0,.650794,.497685,5.07687E-5,
0,.68254,.47622,4.96243E-5,0,.714286,.455135,4.85714E-5,0,.746032,.4346,4.71847E-5,0,.777778,.414564,4.59294E-5,0,.809524,.395165,4.44705E-5,0,.84127,.376333,4.30772E-5,0,.873016,.358197,4.16229E-5,0,.904762,.34064,4.01019E-5,0,.936508,.323816,3.86623E-5,0,.968254,.307581,3.70933E-5,0,1,1,9.91541E-12,0,0,1,9.92077E-12,0,0,1,1.00041E-11,0,0,1,1.0385E-11,0,0,1,1.15777E-11,0,0,1,1.50215E-11,0,0,.999999,2.54738E-11,0,0,.999999,5.98822E-11,0,0,.999998,1.79597E-10,0,0,.999997,6.02367E-10,0,0,.999994,2.06835E-9,
0,0,.99999,6.94952E-9,0,0,.999984,2.23363E-8,0,0,.999972,6.78578E-8,0,0,.999952,1.93571E-7,0,0,.999919,5.16594E-7,0,0,.99986,1.28739E-6,0,0,.999753,2.99298E-6,0,0,.999546,6.48258E-6,0,0,.999074,1.29985E-5,0,0,.997671,2.32176E-5,0,0,.991504,2.56701E-5,0,0,.981148,1.31141E-5,0,0,.971965,8.69048E-6,0,2.80182E-5,.966624,8.08301E-6,0,6.95475E-4,.965344,1.35235E-5,0,.00265522,.963048,2.10592E-5,0,.00622975,.958673,2.87473E-5,0,.0116234,.950262,2.81379E-5,0,.018976,.940836,2.71089E-5,0,.0283844,.930996,
3.0926E-5,0,.0399151,.919848,3.48359E-5,0,.0536063,.909136,3.66092E-5,0,.0694793,.897554,3.84162E-5,0,.0875342,.884691,4.30971E-5,0,.107749,.869414,4.47803E-5,0,.130087,.853462,4.52858E-5,0,.154481,.838187,4.95769E-5,0,.180833,.820381,5.02709E-5,0,.209005,.801844,5.22713E-5,0,.238791,.783061,5.41505E-5,0,.269869,.763205,5.53712E-5,0,.301587,.742362,5.64909E-5,0,.333333,.721393,5.72646E-5,0,.365079,.699676,5.81012E-5,0,.396825,.677395,5.8096E-5,0,.428571,.655208,5.85766E-5,0,.460317,.632451,5.83602E-5,
0,.492064,.609839,5.80234E-5,0,.52381,.587093,5.77161E-5,0,.555556,.564467,5.68447E-5,0,.587302,.542043,5.63166E-5,0,.619048,.519826,5.5156E-5,0,.650794,.497952,5.41682E-5,0,.68254,.476477,5.28971E-5,0,.714286,.455412,5.14952E-5,0,.746032,.434926,5.02222E-5,0,.777778,.4149,4.85779E-5,0,.809524,.395552,4.72242E-5,0,.84127,.376712,4.54891E-5,0,.873016,.358622,4.40924E-5,0,.904762,.341048,4.22984E-5,0,.936508,.324262,4.08582E-5,0,.968254,.308013,3.90839E-5,0,1,1,6.13913E-11,0,0,1,6.14145E-11,0,0,1,6.17708E-11,
0,0,1,6.33717E-11,0,0,1,6.81648E-11,0,0,1,8.08291E-11,0,0,1,1.14608E-10,0,0,.999998,2.10507E-10,0,0,.999997,4.99595E-10,0,0,.999995,1.39897E-9,0,0,.999994,4.19818E-9,0,0,.999988,1.27042E-8,0,0,.999979,3.75153E-8,0,0,.999965,1.06206E-7,0,0,.999945,2.85381E-7,0,0,.999908,7.23611E-7,0,0,.999846,1.7255E-6,0,0,.999733,3.86104E-6,0,0,.999511,8.08493E-6,0,0,.998993,1.56884E-5,0,0,.997326,2.65538E-5,0,0,.989706,2.06466E-5,0,0,.981713,1.30756E-5,0,7.0005E-6,.973636,1.06473E-5,0,4.64797E-4,.966509,1.0194E-5,
0,.00201743,.965149,1.65881E-5,0,.00497549,.962669,2.49147E-5,0,.00953262,.95786,3.17449E-5,0,.0158211,.949334,2.81045E-5,0,.0239343,.941041,3.03263E-5,0,.0339372,.931575,3.56754E-5,0,.0458738,.920102,3.97075E-5,0,.059772,.908002,3.84886E-5,0,.075645,.897269,4.3027E-5,0,.0934929,.884559,4.79925E-5,0,.113302,.869161,4.8246E-5,0,.135045,.853342,5.09505E-5,0,.158678,.837633,5.42846E-5,0,.184136,.820252,5.54139E-5,0,.211325,.801872,5.81412E-5,0,.240113,.782418,5.85535E-5,0,.270306,.7631,6.10923E-5,0,
.301594,.742183,6.13678E-5,0,.333333,.721098,6.27275E-5,0,.365079,.699512,6.29413E-5,0,.396825,.677372,6.36351E-5,0,.428571,.655059,6.33555E-5,0,.460317,.632567,6.36513E-5,0,.492064,.609784,6.28965E-5,0,.52381,.587237,6.25546E-5,0,.555556,.564525,6.15825E-5,0,.587302,.542181,6.05048E-5,0,.619048,.520017,5.96329E-5,0,.650794,.498204,5.81516E-5,0,.68254,.476742,5.69186E-5,0,.714286,.455803,5.53833E-5,0,.746032,.435251,5.37807E-5,0,.777778,.415374,5.22025E-5,0,.809524,.395921,5.03421E-5,0,.84127,.377253,
4.88211E-5,0,.873016,.359021,4.68234E-5,0,.904762,.341637,4.53269E-5,0,.936508,.3247,4.33014E-5,0,.968254,.308625,4.18007E-5,0,1,1,2.86798E-10,0,0,1,2.86877E-10,0,0,1,2.88094E-10,0,0,1,2.93506E-10,0,0,1,3.09262E-10,0,0,.999999,3.48593E-10,0,0,.999999,4.44582E-10,0,0,.999998,6.88591E-10,0,0,.999996,1.34391E-9,0,0,.999993,3.17438E-9,0,0,.999989,8.35609E-9,0,0,.999983,2.28677E-8,0,0,.999974,6.23361E-8,0,0,.999959,1.65225E-7,0,0,.999936,4.19983E-7,0,0,.999896,1.01546E-6,0,0,.99983,2.32376E-6,0,0,.999709,
5.0156E-6,0,0,.999469,1.0167E-5,0,0,.998886,1.90775E-5,0,0,.996819,3.00511E-5,0,0,.988837,1.85092E-5,0,1.68222E-7,.982178,1.34622E-5,0,2.59622E-4,.975017,1.25961E-5,0,.00142595,.967101,1.3507E-5,0,.00382273,.964905,2.05003E-5,0,.00764164,.96218,2.9546E-5,0,.0130121,.956821,3.43738E-5,0,.0200253,.948829,3.05063E-5,0,.0287452,.941092,3.46487E-5,0,.039218,.931883,4.12061E-5,0,.0514748,.920211,4.44651E-5,0,.0655351,.907307,4.31252E-5,0,.0814082,.89684,4.90382E-5,0,.0990939,.884119,5.3334E-5,0,.118583,
.869148,5.4114E-5,0,.139856,.853377,5.78536E-5,0,.162882,.836753,5.92285E-5,0,.187615,.820063,6.22787E-5,0,.213991,.801694,6.45492E-5,0,.241918,.782116,6.5353E-5,0,.271267,.762673,6.74344E-5,0,.301847,.742133,6.82788E-5,0,.333333,.720779,6.91959E-5,0,.365079,.699386,6.96817E-5,0,.396826,.67732,6.99583E-5,0,.428572,.654888,6.98447E-5,0,.460318,.632499,6.94063E-5,0,.492064,.609825,6.91612E-5,0,.52381,.587287,6.81576E-5,0,.555556,.564743,6.74138E-5,0,.587302,.542409,6.61617E-5,0,.619048,.520282,6.47785E-5,
0,.650794,.498506,6.33836E-5,0,.68254,.477102,6.15905E-5,0,.714286,.456167,6.01013E-5,0,.746032,.435728,5.81457E-5,0,.777778,.415809,5.64215E-5,0,.809524,.396517,5.44997E-5,0,.84127,.377737,5.25061E-5,0,.873016,.359698,5.06831E-5,0,.904762,.342164,4.8568E-5,0,.936508,.325417,4.67826E-5,0,.968254,.309186,4.46736E-5,0,1,1,1.09018E-9,0,0,1,1.0904E-9,0,0,1,1.09393E-9,0,0,1,1.1095E-9,0,0,1,1.154E-9,0,0,1,1.26089E-9,0,0,.999999,1.5059E-9,0,0,.999997,2.07899E-9,0,0,.999994,3.48164E-9,0,0,.999993,7.05728E-9,
0,0,.999987,1.63692E-8,0,0,.999981,4.06033E-8,0,0,.999969,1.0245E-7,0,0,.999953,2.55023E-7,0,0,.999925,6.1511E-7,0,0,.999881,1.42218E-6,0,0,.99981,3.13086E-6,0,0,.99968,6.53119E-6,0,0,.999418,1.2832E-5,0,0,.998748,2.32497E-5,0,0,.996066,3.29522E-5,0,0,.988379,1.79613E-5,0,1.08799E-4,.982567,1.43715E-5,0,9.21302E-4,.976097,1.48096E-5,0,.00280738,.968475,1.78905E-5,0,.00596622,.964606,2.53921E-5,0,.0105284,.961564,3.48623E-5,0,.0165848,.955517,3.57612E-5,0,.0242,.948381,3.43493E-5,0,.03342,.941095,
4.05849E-5,0,.0442777,.931923,4.75394E-5,0,.0567958,.91996,4.84328E-5,0,.0709879,.907419,5.02146E-5,0,.086861,.89618,5.61654E-5,0,.104415,.88337,5.87612E-5,0,.123643,.869046,6.18057E-5,0,.144531,.853278,6.57392E-5,0,.167057,.836091,6.6303E-5,0,.191188,.819644,7.04445E-5,0,.216878,.801246,7.14071E-5,0,.244062,.782031,7.40093E-5,0,.272649,.762066,7.4685E-5,0,.302509,.741964,7.66647E-5,0,.333442,.720554,7.66328E-5,0,.365079,.699098,7.77857E-5,0,.396826,.677189,7.74633E-5,0,.428572,.65484,7.76235E-5,
0,.460318,.632496,7.70316E-5,0,.492064,.609908,7.62669E-5,0,.52381,.587312,7.53972E-5,0,.555556,.564938,7.39994E-5,0,.587302,.542577,7.28382E-5,0,.619048,.52062,7.1112E-5,0,.650794,.498819,6.94004E-5,0,.68254,.477555,6.75575E-5,0,.714286,.456568,6.53449E-5,0,.746032,.436278,6.36068E-5,0,.777778,.41637,6.13466E-5,0,.809524,.397144,5.94177E-5,0,.84127,.378412,5.70987E-5,0,.873016,.360376,5.50419E-5,0,.904762,.342906,5.27422E-5,0,.936508,.326136,5.06544E-5,0,.968254,.30997,4.84307E-5,0,1,1,3.54014E-9,
0,0,1,3.54073E-9,0,0,1,3.54972E-9,0,0,1,3.58929E-9,0,0,1,3.70093E-9,0,0,.999999,3.96194E-9,0,0,.999998,4.53352E-9,0,0,.999997,5.78828E-9,0,0,.999994,8.63812E-9,0,0,.999991,1.53622E-8,0,0,.999985,3.16356E-8,0,0,.999977,7.12781E-8,0,0,.999964,1.66725E-7,0,0,.999945,3.90501E-7,0,0,.999912,8.95622E-7,0,0,.999866,1.98428E-6,0,0,.999786,4.21038E-6,0,0,.999647,8.50239E-6,0,0,.999356,1.62059E-5,0,0,.998563,2.82652E-5,0,0,.994928,3.36309E-5,0,2.44244E-5,.987999,1.78458E-5,0,5.23891E-4,.982893,1.59162E-5,0,
.00194729,.977044,1.78056E-5,0,.00451099,.969972,2.30624E-5,0,.00835132,.964237,3.13922E-5,0,.013561,.960791,4.06145E-5,0,.0202056,.954292,3.72796E-5,0,.0283321,.948052,4.03199E-5,0,.0379739,.940938,4.79537E-5,0,.0491551,.931689,5.45292E-5,0,.0618918,.91987,5.4038E-5,0,.0761941,.907665,5.89909E-5,0,.0920672,.895281,6.42651E-5,0,.109511,.882621,6.59707E-5,0,.12852,.86873,7.09973E-5,0,.149085,.853008,7.42221E-5,0,.171189,.835944,7.61754E-5,0,.194809,.818949,7.97052E-5,0,.21991,.800951,8.12434E-5,0,
.246447,.781847,8.38075E-5,0,.274352,.761649,8.4501E-5,0,.303535,.74152,8.60258E-5,0,.333857,.720495,8.66233E-5,0,.365104,.698742,8.68326E-5,0,.396826,.677096,8.7133E-5,0,.428572,.654782,8.63497E-5,0,.460318,.632335,8.60206E-5,0,.492064,.610031,8.49337E-5,0,.52381,.587457,8.38279E-5,0,.555556,.56513,8.2309E-5,0,.587302,.542877,8.03542E-5,0,.619048,.5209,7.86928E-5,0,.650794,.499291,7.65171E-5,0,.68254,.477971,7.44753E-5,0,.714286,.457221,7.2209E-5,0,.746032,.436803,6.97448E-5,0,.777778,.417083,6.75333E-5,
0,.809524,.397749,6.48058E-5,0,.84127,.379177,6.25759E-5,0,.873016,.361061,5.98584E-5,0,.904762,.343713,5.75797E-5,0,.936508,.326894,5.49999E-5,0,.968254,.310816,5.27482E-5,0,1,1,1.0153E-8,0,0,1,1.01544E-8,0,0,1,1.01751E-8,0,0,1,1.02662E-8,0,0,1,1.0521E-8,0,0,.999999,1.11049E-8,0,0,.999999,1.23408E-8,0,0,.999996,1.4924E-8,0,0,.999992,2.04471E-8,0,0,.999989,3.26539E-8,0,0,.99998,6.03559E-8,0,0,.999971,1.23936E-7,0,0,.999955,2.69058E-7,0,0,.999933,5.93604E-7,0,0,.999901,1.29633E-6,0,0,.999847,2.75621E-6,
0,0,.999761,5.64494E-6,0,0,.999607,1.10485E-5,0,0,.999282,2.04388E-5,0,0,.99831,3.41084E-5,0,2.2038E-7,.993288,2.94949E-5,0,2.42388E-4,.987855,1.92736E-5,0,.0012503,.983167,1.82383E-5,0,.0032745,.977908,2.18633E-5,0,.00646321,.971194,2.90662E-5,0,.0109133,.963867,3.86401E-5,0,.0166927,.95982,4.62827E-5,0,.0238494,.953497,4.20705E-5,0,.0324178,.947621,4.77743E-5,0,.0424225,.940611,5.68258E-5,0,.0538808,.931174,6.18061E-5,0,.0668047,.919919,6.27098E-5,0,.0812014,.907856,6.94714E-5,0,.0970745,.894509,
7.35008E-5,0,.114424,.881954,7.63369E-5,0,.133246,.868309,8.21896E-5,0,.153534,.852511,8.3769E-5,0,.175275,.835821,8.81615E-5,0,.198453,.817981,8.96368E-5,0,.223042,.800504,9.30906E-5,0,.249009,.78141,9.45056E-5,0,.276304,.761427,9.63605E-5,0,.304862,.74094,9.68088E-5,0,.334584,.720233,9.81481E-5,0,.365322,.698592,9.79122E-5,0,.396826,.676763,9.81057E-5,0,.428571,.654808,9.73956E-5,0,.460318,.632326,9.62619E-5,0,.492064,.610049,9.52996E-5,0,.52381,.58763,9.33334E-5,0,.555556,.565261,9.17573E-5,0,
.587302,.543244,8.96636E-5,0,.619048,.521273,8.73304E-5,0,.650794,.499818,8.52648E-5,0,.68254,.478536,8.23961E-5,0,.714286,.457826,7.9939E-5,0,.746032,.437549,7.7126E-5,0,.777778,.41776,7.43043E-5,0,.809524,.39863,7.16426E-5,0,.84127,.379954,6.86456E-5,0,.873016,.362025,6.60514E-5,0,.904762,.344581,6.30755E-5,0,.936508,.327909,6.05439E-5,0,.968254,.311736,5.76345E-5,0,1,1,2.63344E-8,0,0,1,2.63373E-8,0,0,1,2.63815E-8,0,0,1,2.65753E-8,0,0,1,2.71132E-8,0,0,.999999,2.83279E-8,0,0,.999997,3.0833E-8,0,
0,.999995,3.58711E-8,0,0,.999992,4.61266E-8,0,0,.999985,6.7574E-8,0,0,.999977,1.1358E-7,0,0,.999966,2.13657E-7,0,0,.999948,4.31151E-7,0,0,.999923,8.96656E-7,0,0,.999884,1.86603E-6,0,0,.999826,3.81115E-6,0,0,.999732,7.54184E-6,0,0,.999561,1.43192E-5,0,0,.999191,2.57061E-5,0,0,.997955,4.05724E-5,0,7.44132E-5,.992228,2.76537E-5,0,7.16477E-4,.987638,2.08885E-5,0,.0022524,.983395,2.15226E-5,0,.00484816,.978614,2.70795E-5,0,.00860962,.972389,3.65282E-5,0,.0136083,.964392,4.74747E-5,0,.0198941,.95861,5.09141E-5,
0,.0275023,.952806,4.8963E-5,0,.0364584,.94712,5.71119E-5,0,.04678,.940104,6.71704E-5,0,.0584799,.930398,6.87586E-5,0,.0715665,.919866,7.38161E-5,0,.086045,.907853,8.13235E-5,0,.101918,.894078,8.34582E-5,0,.119186,.881177,8.92093E-5,0,.137845,.867575,9.44548E-5,0,.157891,.852107,9.69607E-5,0,.179316,.835502,1.01456E-4,0,.202106,.81756,1.03256E-4,0,.226243,.79984,1.06954E-4,0,.251704,.780998,1.08066E-4,0,.278451,.761132,1.10111E-4,0,.306436,.740429,1.10459E-4,0,.335586,.719836,1.11219E-4,0,.365796,
.698467,1.1145E-4,0,.3969,.676446,1.10393E-4,0,.428571,.654635,1.10035E-4,0,.460318,.632411,1.08548E-4,0,.492064,.609986,1.06963E-4,0,.52381,.587872,1.05238E-4,0,.555556,.565528,1.02665E-4,0,.587302,.543563,1.00543E-4,0,.619048,.52176,9.76182E-5,0,.650794,.500188,9.47099E-5,0,.68254,.479204,9.19929E-5,0,.714286,.458413,8.86139E-5,0,.746032,.438314,8.57839E-5,0,.777778,.418573,8.2411E-5,0,.809524,.39947,7.92211E-5,0,.84127,.380892,7.59546E-5,0,.873016,.362953,7.27571E-5,0,.904762,.345601,6.95738E-5,
0,.936508,.328895,6.64907E-5,0,.968254,.312808,6.34277E-5,0,1,1,6.28647E-8,0,0,1,6.28705E-8,0,0,1,6.29587E-8,0,0,1,6.33441E-8,0,0,.999999,6.44087E-8,0,0,.999998,6.67856E-8,0,0,.999997,7.15889E-8,0,0,.999995,8.09577E-8,0,0,.999989,9.92764E-8,0,0,.999983,1.35834E-7,0,0,.999974,2.10482E-7,0,0,.999959,3.65215E-7,0,0,.999939,6.86693E-7,0,0,.999911,1.3472E-6,0,0,.999868,2.6731E-6,0,0,.999804,5.24756E-6,0,0,.9997,1.00403E-5,0,0,.99951,1.85019E-5,0,0,.999078,3.22036E-5,0,6.20676E-6,.997428,4.70002E-5,0,3.41552E-4,
.99162,2.87123E-5,0,.00143727,.987479,2.34706E-5,0,.00349201,.983582,2.60083E-5,0,.0066242,.979186,3.37927E-5,0,.0109113,.97325,4.54689E-5,0,.0164064,.965221,5.73759E-5,0,.0231463,.957262,5.44114E-5,0,.0311571,.952211,5.87006E-5,0,.0404572,.946631,6.92256E-5,0,.0510592,.939391,7.87819E-5,0,.0629723,.929795,7.92368E-5,0,.0762025,.91965,8.75075E-5,0,.090753,.907737,9.50903E-5,0,.106626,.893899,9.72963E-5,0,.123822,.880239,1.0459E-4,0,.142337,.866562,1.07689E-4,0,.16217,.85164,1.13081E-4,0,.183314,.835021,
1.16636E-4,0,.20576,.817311,1.20074E-4,0,.229496,.798845,1.21921E-4,0,.254502,.780479,1.2475E-4,0,.280753,.760694,1.25255E-4,0,.308212,.740142,1.26719E-4,0,.336825,.719248,1.2636E-4,0,.366517,.698209,1.26712E-4,0,.397167,.676398,1.25769E-4,0,.428578,.654378,1.24432E-4,0,.460318,.632484,1.23272E-4,0,.492064,.610113,1.2085E-4,0,.52381,.587931,1.18411E-4,0,.555556,.565872,1.1569E-4,0,.587302,.543814,1.12521E-4,0,.619048,.522265,1.09737E-4,0,.650794,.500835,1.06228E-4,0,.68254,.479818,1.02591E-4,0,.714286,
.459258,9.91288E-5,0,.746032,.439061,9.52325E-5,0,.777778,.419552,9.1895E-5,0,.809524,.400399,8.79051E-5,0,.84127,.381976,8.44775E-5,0,.873016,.364009,8.06316E-5,0,.904762,.346761,7.71848E-5,0,.936508,.330049,7.35429E-5,0,.968254,.314018,7.02103E-5,0,1,1,1.39968E-7,0,0,1,1.39979E-7,0,0,1,1.40145E-7,0,0,1,1.4087E-7,0,0,.999999,1.42865E-7,0,0,.999998,1.47279E-7,0,0,.999997,1.56057E-7,0,0,.999992,1.7276E-7,0,0,.999989,2.04352E-7,0,0,.99998,2.6494E-7,0,0,.999969,3.83435E-7,0,0,.999953,6.18641E-7,0,0,
.999929,1.08755E-6,0,0,.999898,2.01497E-6,0,0,.999849,3.81346E-6,0,0,.999778,7.19815E-6,0,0,.999661,1.33215E-5,0,0,.999451,2.38313E-5,0,0,.998936,4.01343E-5,0,1.13724E-4,.99662,5.17346E-5,0,8.20171E-4,.991094,3.04323E-5,0,.00238143,.987487,2.81757E-5,0,.00493527,.983731,3.20048E-5,0,.00856859,.979647,4.23905E-5,0,.0133393,.973837,5.62935E-5,0,.0192863,.96584,6.77442E-5,0,.0264369,.956309,6.23073E-5,0,.03481,.951523,7.04131E-5,0,.0444184,.946003,8.36594E-5,0,.0552713,.938454,9.11736E-5,0,.0673749,
.929279,9.38264E-5,0,.0807329,.919239,1.03754E-4,0,.0953479,.907293,1.09928E-4,0,.111221,.893936,1.15257E-4,0,.128352,.879674,1.22265E-4,0,.14674,.865668,1.25733E-4,0,.166382,.850998,1.32305E-4,0,.187276,.834498,1.34844E-4,0,.209413,.816903,1.39276E-4,0,.232786,.798235,1.40984E-4,0,.257382,.779724,1.4378E-4,0,.283181,.760251,1.44623E-4,0,.310156,.739808,1.45228E-4,0,.338269,.718762,1.4539E-4,0,.367461,.697815,1.44432E-4,0,.397646,.67631,1.43893E-4,0,.428685,.654278,1.41846E-4,0,.460318,.632347,1.3935E-4,
0,.492064,.610296,1.37138E-4,0,.52381,.588039,1.33806E-4,0,.555556,.566218,1.30755E-4,0,.587302,.544346,1.27128E-4,0,.619048,.522701,1.23002E-4,0,.650794,.501542,1.19443E-4,0,.68254,.480508,1.15055E-4,0,.714286,.460092,1.11032E-4,0,.746032,.440021,1.06635E-4,0,.777778,.420446,1.02162E-4,0,.809524,.401512,9.8184E-5,0,.84127,.38299,9.36497E-5,0,.873016,.365232,8.9813E-5,0,.904762,.347865,8.53073E-5,0,.936508,.331342,8.17068E-5,0,.968254,.315202,7.73818E-5,0,1,1,2.9368E-7,0,0,1,2.937E-7,0,0,1,2.93998E-7,
0,0,1,2.95298E-7,0,0,.999999,2.98865E-7,0,0,.999998,3.067E-7,0,0,.999995,3.22082E-7,0,0,.999992,3.50767E-7,0,0,.999986,4.03538E-7,0,0,.999976,5.01372E-7,0,0,.999964,6.8562E-7,0,0,.999945,1.0374E-6,0,0,.999919,1.71269E-6,0,0,.999882,3.00175E-6,0,0,.999829,5.42144E-6,0,0,.999749,9.84182E-6,0,0,.99962,1.76213E-5,0,0,.999382,3.05995E-5,0,1.38418E-5,.998751,4.96686E-5,0,3.89844E-4,.995344,5.10733E-5,0,.00150343,.990768,3.45829E-5,0,.00352451,.987464,3.42841E-5,0,.00655379,.983846,3.99072E-5,0,.0106554,
.980007,5.33219E-5,0,.0158723,.974494,6.96992E-5,0,.0222333,.96622,7.76754E-5,0,.029758,.956273,7.47718E-5,0,.0384596,.950952,8.64611E-5,0,.0483473,.945215,1.00464E-4,0,.0594266,.937287,1.03729E-4,0,.0717019,.928649,1.11665E-4,0,.0851752,.918791,1.2353E-4,0,.0998479,.906685,1.27115E-4,0,.115721,.893706,1.3628E-4,0,.132794,.879248,1.42427E-4,0,.151067,.864685,1.48091E-4,0,.170538,.850032,1.53517E-4,0,.191204,.833853,1.57322E-4,0,.213063,.816353,1.61086E-4,0,.236107,.797834,1.64111E-4,0,.260329,.778831,
1.65446E-4,0,.285714,.759756,1.67492E-4,0,.312243,.739419,1.66928E-4,0,.339887,.718491,1.67E-4,0,.368604,.697392,1.65674E-4,0,.398329,.676102,1.63815E-4,0,.428961,.654243,1.62003E-4,0,.460331,.632176,1.58831E-4,0,.492064,.610407,1.55463E-4,0,.52381,.588394,1.52062E-4,0,.555556,.56645,1.47665E-4,0,.587302,.5449,1.4375E-4,0,.619048,.523276,1.38905E-4,0,.650794,.502179,1.34189E-4,0,.68254,.481359,1.29392E-4,0,.714286,.46092,1.24556E-4,0,.746032,.441084,1.1957E-4,0,.777778,.421517,1.14652E-4,0,.809524,
.402721,1.09688E-4,0,.84127,.384222,1.04667E-4,0,.873016,.366534,9.99633E-5,0,.904762,.349205,9.50177E-5,0,.936508,.332702,9.07301E-5,0,.968254,.316599,8.59769E-5,0,1,1,5.85473E-7,0,0,1,5.85507E-7,0,0,1,5.8602E-7,0,0,.999999,5.88259E-7,0,0,.999999,5.94381E-7,0,0,.999998,6.07754E-7,0,0,.999995,6.33729E-7,0,0,.99999,6.8137E-7,0,0,.999984,7.67003E-7,0,0,.999973,9.21212E-7,0,0,.999959,1.20218E-6,0,0,.999936,1.72024E-6,0,0,.999907,2.68088E-6,0,0,.999866,4.45512E-6,0,0,.999806,7.68481E-6,0,0,.999716,1.342E-5,
0,0,.999576,2.32473E-5,0,0,.9993,3.91694E-5,0,1.29917E-4,.998498,6.08429E-5,0,8.45035E-4,.994132,4.89743E-5,0,.00237616,.99031,3.84644E-5,0,.00484456,.987409,4.21768E-5,0,.00832472,.983981,5.04854E-5,0,.0128643,.980268,6.71028E-5,0,.0184947,.974875,8.52749E-5,0,.025237,.966063,8.5531E-5,0,.0331046,.956779,9.00588E-5,0,.0421067,.950259,1.0577E-4,0,.0522487,.944239,1.19458E-4,0,.0635343,.936341,1.22164E-4,0,.0759654,.928047,1.34929E-4,0,.0895434,.918065,1.45544E-4,0,.104269,.906267,1.50531E-4,0,.120142,
.893419,1.61652E-4,0,.137163,.878758,1.6593E-4,0,.15533,.863699,1.74014E-4,0,.174645,.848876,1.77877E-4,0,.195106,.833032,1.84049E-4,0,.21671,.815557,1.86088E-4,0,.239454,.797323,1.9054E-4,0,.263332,.778124,1.91765E-4,0,.288336,.758929,1.92535E-4,0,.314451,.738979,1.92688E-4,0,.341658,.718213,1.91522E-4,0,.369924,.696947,1.90491E-4,0,.399202,.675807,1.87913E-4,0,.429416,.654147,1.84451E-4,0,.460447,.63229,1.81442E-4,0,.492064,.610499,1.77139E-4,0,.523809,.588747,1.72596E-4,0,.555555,.566783,1.67457E-4,
0,.587301,.545359,1.62518E-4,0,.619048,.523984,1.56818E-4,0,.650794,.502917,1.51884E-4,0,.68254,.482294,1.45514E-4,0,.714286,.461945,1.40199E-4,0,.746032,.442133,1.34101E-4,0,.777778,.422705,1.28374E-4,0,.809524,.403916,1.22996E-4,0,.84127,.38554,1.16808E-4,0,.873016,.367909,1.11973E-4,0,.904762,.350651,1.05938E-4,0,.936508,.334208,1.01355E-4,0,.968254,.318123,9.57629E-5,0,1,1,1.11633E-6,0,0,1,1.11639E-6,0,0,1,1.11725E-6,0,0,1,1.12096E-6,0,0,.999999,1.1311E-6,0,0,.999997,1.15315E-6,0,0,.999995,1.1956E-6,
0,0,.999989,1.27239E-6,0,0,.999981,1.40772E-6,0,0,.999969,1.64541E-6,0,0,.999952,2.06607E-6,0,0,.999928,2.81783E-6,0,0,.999895,4.16835E-6,0,0,.999848,6.58728E-6,0,0,.999781,1.08648E-5,0,0,.999682,1.82579E-5,0,0,.999523,3.06003E-5,0,1.59122E-5,.999205,4.99862E-5,0,3.91184E-4,.998131,7.3306E-5,0,.00147534,.993334,5.13229E-5,0,.0034227,.99016,4.67783E-5,0,.00632232,.987321,5.23413E-5,0,.0102295,.984099,6.4267E-5,0,.0151794,.980432,8.43042E-5,0,.0211947,.974976,1.02819E-4,0,.0282899,.966429,9.96234E-5,
0,.0364739,.957633,1.11074E-4,0,.0457522,.949422,1.28644E-4,0,.0561278,.943045,1.40076E-4,0,.0676023,.935448,1.46349E-4,0,.0801762,.927225,1.61854E-4,0,.0938499,.917033,1.69135E-4,0,.108623,.905762,1.79987E-4,0,.124496,.892879,1.89832E-4,0,.141469,.878435,1.95881E-4,0,.159541,.863114,2.0466E-4,0,.178713,.84776,2.09473E-4,0,.198985,.832084,2.14861E-4,0,.220355,.814915,2.17695E-4,0,.242823,.796711,2.20313E-4,0,.266385,.777603,2.2313E-4,0,.291036,.757991,2.22471E-4,0,.316767,.738371,2.22869E-4,0,.343563,
.717872,2.21243E-4,0,.371402,.696619,2.18089E-4,0,.400248,.675379,2.1562E-4,0,.430047,.65411,2.1169E-4,0,.460709,.63241,2.06947E-4,0,.492079,.61046,2.01709E-4,0,.52381,.58903,1.96753E-4,0,.555556,.567267,1.89637E-4,0,.587302,.545886,1.84735E-4,0,.619048,.524714,1.77257E-4,0,.650794,.503789,1.71424E-4,0,.68254,.483204,1.64688E-4,0,.714286,.462976,1.57172E-4,0,.746032,.443294,1.51341E-4,0,.777778,.423988,1.43737E-4,0,.809524,.405325,1.38098E-4,0,.84127,.386981,1.30698E-4,0,.873016,.369436,1.25276E-4,
0,.904762,.35219,1.18349E-4,0,.936508,.335804,1.1312E-4,0,.968254,.319749,1.06687E-4,0,1,1,2.04685E-6,0,0,1,2.04694E-6,0,0,1,2.04831E-6,0,0,.999999,2.05428E-6,0,0,.999999,2.07056E-6,0,0,.999997,2.10581E-6,0,0,.999993,2.1732E-6,0,0,.999987,2.29365E-6,0,0,.999979,2.50243E-6,0,0,.999965,2.86127E-6,0,0,.999947,3.48028E-6,0,0,.999918,4.55588E-6,0,0,.999881,6.43303E-6,0,0,.999828,9.70064E-6,0,0,.999753,1.53233E-5,0,0,.999642,2.4793E-5,0,0,.999464,4.02032E-5,0,1.22947E-4,.999089,6.35852E-5,0,8.07414E-4,
.997567,8.57026E-5,0,.00227206,.992903,5.94912E-5,0,.00462812,.990011,5.78515E-5,0,.00794162,.987192,6.5399E-5,0,.0122534,.98418,8.19675E-5,0,.0175888,.980491,1.05514E-4,0,.0239635,.974779,1.21532E-4,0,.031387,.96675,1.19144E-4,0,.0398644,.958248,1.36125E-4,0,.0493982,.948884,1.55408E-4,0,.0599896,.941673,1.62281E-4,0,.0716382,.934521,1.76754E-4,0,.0843437,.926205,1.92873E-4,0,.0981056,.916089,2.00038E-4,0,.112923,.904963,2.13624E-4,0,.128796,.892089,2.21834E-4,0,.145725,.878028,2.32619E-4,0,.163709,
.86249,2.38632E-4,0,.182749,.846587,2.47002E-4,0,.202847,.830988,2.50702E-4,0,.224001,.814165,2.55562E-4,0,.246214,.796135,2.57505E-4,0,.269482,.777052,2.58625E-4,0,.293805,.757201,2.58398E-4,0,.319176,.737655,2.56714E-4,0,.345587,.717477,2.55187E-4,0,.373021,.696433,2.51792E-4,0,.401454,.675084,2.47223E-4,0,.430844,.653907,2.42213E-4,0,.461125,.632561,2.37397E-4,0,.492187,.610658,2.29313E-4,0,.52381,.589322,2.24402E-4,0,.555556,.567857,2.16116E-4,0,.587302,.54652,2.09124E-4,0,.619048,.525433,2.01601E-4,
0,.650794,.504679,1.92957E-4,0,.68254,.484203,1.86052E-4,0,.714286,.464203,1.77672E-4,0,.746032,.444549,1.70005E-4,0,.777778,.425346,1.62401E-4,0,.809524,.406706,1.544E-4,0,.84127,.388576,1.47437E-4,0,.873016,.37094,1.39493E-4,0,.904762,.353996,1.33219E-4,0,.936508,.337391,1.25573E-4,0,.968254,.321648,1.19867E-4,0,1,1,3.62511E-6,0,0,1,3.62525E-6,0,0,1,3.62739E-6,0,0,.999999,3.63673E-6,0,0,.999998,3.66214E-6,0,0,.999996,3.71698E-6,0,0,.999992,3.82116E-6,0,0,.999986,4.00554E-6,0,0,.999976,4.32058E-6,
0,0,.999961,4.85194E-6,0,0,.999938,5.74808E-6,0,0,.999908,7.26643E-6,0,0,.999865,9.84707E-6,0,0,.999807,1.42217E-5,0,0,.999723,2.15581E-5,0,0,.999602,3.36114E-5,0,1.19113E-5,.999398,5.27353E-5,0,3.55813E-4,.998946,8.05809E-5,0,.00137768,.996647,9.42908E-5,0,.00322469,.992298,6.68733E-5,0,.00597897,.989802,7.16564E-5,0,.00968903,.987019,8.21355E-5,0,.0143845,.984219,1.04555E-4,0,.0200831,.980425,1.31245E-4,0,.0267948,.974241,1.39613E-4,0,.034525,.967006,1.45931E-4,0,.0432757,.95893,1.67153E-4,0,.0530471,
.949157,1.88146E-4,0,.0638386,.94062,1.94625E-4,0,.0756487,.933509,2.13721E-4,0,.0884762,.925088,2.29616E-4,0,.10232,.915178,2.39638E-4,0,.117178,.904093,2.54814E-4,0,.133051,.891337,2.63685E-4,0,.149939,.877326,2.74789E-4,0,.167841,.861794,2.80534E-4,0,.18676,.845758,2.89534E-4,0,.206696,.829792,2.94446E-4,0,.22765,.813037,2.96877E-4,0,.249625,.795285,3.00217E-4,0,.27262,.776323,2.99826E-4,0,.296636,.756673,2.99787E-4,0,.321671,.736856,2.97867E-4,0,.347718,.716883,2.94052E-4,0,.374768,.696089,2.89462E-4,
0,.402804,.67505,2.85212E-4,0,.431796,.653509,2.7653E-4,0,.461695,.63258,2.71759E-4,0,.49242,.61104,2.62811E-4,0,.523822,.589567,2.55151E-4,0,.555556,.568322,2.46434E-4,0,.587302,.547235,2.37061E-4,0,.619048,.52616,2.28343E-4,0,.650794,.505716,2.19236E-4,0,.68254,.485274,2.09595E-4,0,.714286,.465411,2.01011E-4,0,.746032,.445854,1.9109E-4,0,.777778,.426911,1.82897E-4,0,.809524,.408222,1.73569E-4,0,.84127,.390307,1.65496E-4,0,.873016,.372624,1.56799E-4,0,.904762,.355804,1.4917E-4,0,.936508,.33924,1.40907E-4,
0,.968254,.323534,1.34062E-4,0,1,1,6.22487E-6,0,0,1,6.2251E-6,0,0,1,6.22837E-6,0,0,.999999,6.24259E-6,0,0,.999998,6.28127E-6,0,0,.999996,6.36451E-6,0,0,.999991,6.5218E-6,0,0,.999984,6.79782E-6,0,0,.999973,7.26361E-6,0,0,.999955,8.03644E-6,0,0,.999931,9.31397E-6,0,0,.999896,1.14299E-5,0,0,.999847,1.49402E-5,0,0,.999784,2.07461E-5,0,0,.999692,3.02493E-5,0,0,.999554,4.54957E-5,0,9.97275E-5,.999326,6.90762E-5,0,7.24813E-4,.998757,1.01605E-4,0,.0020972,.995367,9.58745E-5,0,.00432324,.99209,8.32808E-5,
0,.00746347,.989517,8.87601E-5,0,.0115534,.987008,1.0564E-4,0,.0166134,.98421,1.33179E-4,0,.0226552,.98021,1.61746E-4,0,.0296838,.973676,1.61821E-4,0,.0377016,.967052,1.78635E-4,0,.0467079,.959385,2.06765E-4,0,.0567013,.949461,2.2476E-4,0,.0676796,.939578,2.3574E-4,0,.0796403,.932416,2.5893E-4,0,.0925812,.923759,2.71228E-4,0,.106501,.914223,2.89165E-4,0,.121397,.902942,3.01156E-4,0,.13727,.890419,3.13852E-4,0,.15412,.876639,3.24408E-4,0,.171946,.861316,3.3249E-4,0,.190751,.84496,3.38497E-4,0,.210537,
.828427,3.45861E-4,0,.231305,.811871,3.47863E-4,0,.253057,.794397,3.50225E-4,0,.275797,.775726,3.49915E-4,0,.299525,.75617,3.47297E-4,0,.324242,.736091,3.44232E-4,0,.349947,.716213,3.40835E-4,0,.376633,.695736,3.32369E-4,0,.404289,.674961,3.27943E-4,0,.432895,.653518,3.18533E-4,0,.462415,.632574,3.10391E-4,0,.492788,.61134,3.00755E-4,0,.523909,.590017,2.90506E-4,0,.555556,.568752,2.80446E-4,0,.587302,.548061,2.69902E-4,0,.619048,.52711,2.58815E-4,0,.650794,.506682,2.48481E-4,0,.68254,.486524,2.37141E-4,
0,.714286,.466812,2.26872E-4,0,.746032,.44732,2.16037E-4,0,.777778,.428473,2.05629E-4,0,.809524,.409921,1.95691E-4,0,.84127,.392028,1.85457E-4,0,.873016,.374606,1.76436E-4,0,.904762,.357601,1.66508E-4,0,.936508,.341348,1.58385E-4,0,.968254,.32542,1.49203E-4,0,1,1,1.03967E-5,0,0,1,1.0397E-5,0,0,1,1.04019E-5,0,0,.999999,1.04231E-5,0,0,.999998,1.04806E-5,0,0,.999995,1.06042E-5,0,0,.999991,1.08366E-5,0,0,.999982,1.12415E-5,0,0,.999968,1.19174E-5,0,0,.99995,1.30227E-5,0,0,.999922,1.48176E-5,0,0,.999884,
1.77303E-5,0,0,.99983,2.24564E-5,0,0,.999758,3.00966E-5,0,0,.999654,4.23193E-5,0,5.49083E-6,.999503,6.14848E-5,0,2.96087E-4,.999237,9.03576E-5,0,.00123144,.998491,1.271E-4,0,.00295954,.994594,1.07754E-4,0,.00555829,.99178,1.03025E-4,0,.00907209,.989265,1.1154E-4,0,.0135257,.986998,1.36296E-4,0,.0189327,.984137,1.69154E-4,0,.0252993,.979798,1.96671E-4,0,.0326272,.97337,1.96678E-4,0,.0409157,.967239,2.23121E-4,0,.0501623,.959543,2.53809E-4,0,.0603638,.949466,2.65972E-4,0,.0715171,.939074,2.88372E-4,
0,.0836187,.931118,3.10983E-4,0,.0966657,.922525,3.25561E-4,0,.110656,.912983,3.45725E-4,0,.125588,.901617,3.556E-4,0,.141461,.889487,3.74012E-4,0,.158275,.875787,3.83445E-4,0,.176031,.860654,3.93972E-4,0,.19473,.844417,4.00311E-4,0,.214374,.82741,4.05004E-4,0,.234967,.810545,4.07378E-4,0,.256512,.793312,4.07351E-4,0,.279011,.774847,4.06563E-4,0,.302468,.755621,4.04903E-4,0,.326887,.735511,3.97486E-4,0,.352266,.715435,3.9357E-4,0,.378605,.695403,3.84739E-4,0,.405897,.674681,3.76108E-4,0,.43413,.65359,
3.65997E-4,0,.463277,.632471,3.54957E-4,0,.493295,.61151,3.43593E-4,0,.524106,.59064,3.31841E-4,0,.555561,.569386,3.18891E-4,0,.587302,.548785,3.072E-4,0,.619048,.528146,2.9361E-4,0,.650794,.507872,2.81709E-4,0,.68254,.487805,2.68627E-4,0,.714286,.468196,2.55887E-4,0,.746032,.448922,2.43997E-4,0,.777778,.430093,2.31662E-4,0,.809524,.411845,2.20339E-4,0,.84127,.393808,2.08694E-4,0,.873016,.376615,1.98045E-4,0,.904762,.359655,1.87375E-4,0,.936508,.343452,1.77371E-4,0,.968254,.32765,1.67525E-4,0,1,1,
1.69351E-5,0,0,1,1.69356E-5,0,0,1,1.69427E-5,0,0,.999999,1.69736E-5,0,0,.999998,1.70575E-5,0,0,.999995,1.72372E-5,0,0,.99999,1.75739E-5,0,0,.999979,1.81568E-5,0,0,.999966,1.91206E-5,0,0,.999944,2.0677E-5,0,0,.999912,2.31644E-5,0,0,.999869,2.71268E-5,0,0,.999811,3.34272E-5,0,0,.99973,4.33979E-5,0,0,.999617,5.90083E-5,0,6.80315E-5,.999445,8.29497E-5,0,6.12796E-4,.999138,1.18019E-4,0,.00187408,.998095,1.56712E-4,0,.00395791,.993919,1.25054E-4,0,.00692144,.991333,1.26091E-4,0,.0107962,.989226,1.44912E-4,
0,.0155986,.986954,1.75737E-4,0,.0213364,.983982,2.13883E-4,0,.0280114,.979128,2.34526E-4,0,.0356226,.973327,2.43725E-4,0,.0441668,.967416,2.773E-4,0,.0536399,.959729,3.08799E-4,0,.0640376,.949758,3.22447E-4,0,.0753554,.939173,3.50021E-4,0,.0875893,.9296,3.70089E-4,0,.100736,.921181,3.91365E-4,0,.114793,.91164,4.13636E-4,0,.129759,.900435,4.27068E-4,0,.145632,.888183,4.41046E-4,0,.162412,.874772,4.54968E-4,0,.180101,.859566,4.61882E-4,0,.1987,.843579,4.71556E-4,0,.218213,.826453,4.74335E-4,0,.238641,
.809164,4.77078E-4,0,.259989,.792179,4.7755E-4,0,.282262,.773866,4.72573E-4,0,.305464,.754944,4.69765E-4,0,.329599,.735133,4.62371E-4,0,.35467,.714858,4.53674E-4,0,.380678,.694829,4.43888E-4,0,.407622,.674453,4.32052E-4,0,.435493,.653685,4.20315E-4,0,.464275,.632666,4.06829E-4,0,.493938,.611676,3.92234E-4,0,.524422,.591193,3.79208E-4,0,.555624,.570145,3.6319E-4,0,.587302,.549566,3.49111E-4,0,.619048,.529278,3.34166E-4,0,.650794,.509026,3.18456E-4,0,.68254,.489186,3.0449E-4,0,.714286,.469662,2.89051E-4,
0,.746032,.450691,2.75494E-4,0,.777778,.431841,2.61437E-4,0,.809524,.413752,2.47846E-4,0,.84127,.395951,2.35085E-4,0,.873016,.378633,2.22245E-4,0,.904762,.36194,2.10533E-4,0,.936508,.345599,1.98494E-4,0,.968254,.329999,1.88133E-4,0,1,1,2.69663E-5,0,0,1,2.6967E-5,0,0,1,2.69772E-5,0,0,.999999,2.70214E-5,0,0,.999998,2.71415E-5,0,0,.999994,2.7398E-5,0,0,.999988,2.78771E-5,0,0,.999977,2.87019E-5,0,0,.999961,3.00544E-5,0,0,.999937,3.22138E-5,0,0,.999904,3.56163E-5,0,0,.999854,4.09465E-5,0,0,.99979,4.92651E-5,
0,0,.999699,6.21722E-5,0,8.8288E-7,.999572,8.19715E-5,0,2.23369E-4,.999381,1.11689E-4,0,.00105414,.999016,1.53862E-4,0,.0026493,.997437,1.87667E-4,0,.00508608,.993545,1.55672E-4,0,.00840554,.991135,1.61455E-4,0,.012629,.989157,1.88241E-4,0,.0177661,.986874,2.26229E-4,0,.0238198,.983714,2.68668E-4,0,.0307887,.978301,2.77109E-4,0,.0386688,.973227,3.03446E-4,0,.0474554,.967317,3.41851E-4,0,.0571428,.959477,3.70885E-4,0,.0677256,.950012,3.92753E-4,0,.0791988,.939484,4.2781E-4,0,.0915576,.928135,4.43866E-4,
0,.104798,.919819,4.72959E-4,0,.118918,.910049,4.91551E-4,0,.133915,.899181,5.12616E-4,0,.149788,.886881,5.23563E-4,0,.166537,.87359,5.40183E-4,0,.184164,.858613,5.47386E-4,0,.202669,.842809,5.54809E-4,0,.222056,.825727,5.58316E-4,0,.242329,.808086,5.57824E-4,0,.263492,.790728,5.56346E-4,0,.285551,.772987,5.52672E-4,0,.30851,.7541,5.43738E-4,0,.332376,.734669,5.36107E-4,0,.357153,.714411,5.23342E-4,0,.382845,.694196,5.12238E-4,0,.409454,.674252,4.97465E-4,0,.436977,.65357,4.81096E-4,0,.465404,.632999,
4.67054E-4,0,.494713,.611994,4.48771E-4,0,.524864,.591604,4.31889E-4,0,.555779,.571134,4.15238E-4,0,.587302,.550528,3.96369E-4,0,.619048,.530292,3.79477E-4,0,.650794,.510364,3.61488E-4,0,.68254,.490749,3.43787E-4,0,.714286,.471266,3.27822E-4,0,.746032,.452462,3.10626E-4,0,.777778,.433907,2.95352E-4,0,.809524,.415659,2.79179E-4,0,.84127,.398138,2.64685E-4,0,.873016,.380833,2.49905E-4,0,.904762,.364247,2.36282E-4,0,.936508,.348041,2.22905E-4,0,.968254,.332389,2.10522E-4,0,1,1,4.20604E-5,0,0,1,4.20614E-5,
0,0,1,4.20757E-5,0,0,.999999,4.2138E-5,0,0,.999997,4.23067E-5,0,0,.999993,4.26668E-5,0,0,.999986,4.33372E-5,0,0,.999974,4.44857E-5,0,0,.999956,4.63554E-5,0,0,.99993,4.93105E-5,0,0,.999892,5.39077E-5,0,0,.999838,6.10005E-5,0,0,.999767,7.18822E-5,0,0,.999666,8.84581E-5,0,3.65471E-5,.999525,1.13398E-4,0,4.85623E-4,.999311,1.50043E-4,0,.00162096,.998865,2.00063E-4,0,.00355319,.996278,2.11014E-4,0,.00633818,.992956,1.89672E-4,0,.0100043,.991017,2.10262E-4,0,.0145648,.989055,2.44292E-4,0,.0200237,.986741,
2.90481E-4,0,.0263798,.983288,3.34303E-4,0,.033629,.977784,3.40307E-4,0,.0417652,.973037,3.77864E-4,0,.0507821,.967181,4.239E-4,0,.060673,.958971,4.43854E-4,0,.0714314,.950093,4.83039E-4,0,.0830518,.939552,5.17934E-4,0,.0955288,.927678,5.39449E-4,0,.108859,.918278,5.68604E-4,0,.123038,.908449,5.88505E-4,0,.138065,.897713,6.12473E-4,0,.153938,.885533,6.25575E-4,0,.170657,.872131,6.3854E-4,0,.188224,.857517,6.47034E-4,0,.20664,.841796,6.5209E-4,0,.225909,.824726,6.544E-4,0,.246035,.807297,6.55744E-4,
0,.267022,.789058,6.46716E-4,0,.288878,.77189,6.43898E-4,0,.311607,.753082,6.29973E-4,0,.335216,.7341,6.21564E-4,0,.359713,.714094,6.05171E-4,0,.385103,.693839,5.88752E-4,0,.41139,.673891,5.73294E-4,0,.438576,.653565,5.52682E-4,0,.466656,.633326,5.33446E-4,0,.495617,.612582,5.14635E-4,0,.525431,.59205,4.9303E-4,0,.556041,.571918,4.71842E-4,0,.587338,.551572,4.51713E-4,0,.619048,.531553,4.30049E-4,0,.650794,.51175,4.10445E-4,0,.68254,.49238,3.90098E-4,0,.714286,.473143,3.70033E-4,0,.746032,.45423,
3.51205E-4,0,.777778,.435963,3.32049E-4,0,.809524,.41787,3.15021E-4,0,.84127,.400387,2.97315E-4,0,.873016,.383332,2.81385E-4,0,.904762,.366665,2.65397E-4,0,.936508,.350633,2.50601E-4,0,.968254,.334964,2.3589E-4,0,1,1,6.43736E-5,0,0,1,6.4375E-5,0,0,1,6.43947E-5,0,0,.999999,6.4481E-5,0,0,.999997,6.47143E-5,0,0,.999994,6.52119E-5,0,0,.999985,6.61359E-5,0,0,.999972,6.77116E-5,0,0,.999952,7.02599E-5,0,0,.999922,7.42517E-5,0,0,.99988,8.03906E-5,0,0,.99982,8.97315E-5,0,0,.999741,1.03838E-4,0,0,.999629,1.2496E-4,
0,1.49024E-4,.999474,1.56161E-4,0,8.61027E-4,.999229,2.01034E-4,0,.00231198,.998662,2.59069E-4,0,.00458147,.995299,2.45439E-4,0,.00770895,.992732,2.4498E-4,0,.0117126,.990847,2.73211E-4,0,.0165989,.988911,3.16492E-4,0,.0223674,.98654,3.7161E-4,0,.0290135,.982636,4.10352E-4,0,.0365309,.977346,4.21756E-4,0,.0449117,.972909,4.75578E-4,0,.0541481,.966821,5.22482E-4,0,.0642326,.958686,5.45008E-4,0,.075158,.949754,5.89286E-4,0,.0869181,.939184,6.19995E-4,0,.0995074,.927505,6.54266E-4,0,.112922,.916606,
6.82362E-4,0,.127157,.906707,7.04286E-4,0,.142212,.895937,7.25909E-4,0,.158085,.883913,7.43939E-4,0,.174776,.870642,7.55157E-4,0,.192287,.856241,7.64387E-4,0,.210619,.84069,7.71032E-4,0,.229775,.823728,7.65906E-4,0,.249761,.806481,7.67604E-4,0,.270582,.787924,7.54385E-4,0,.292243,.770588,7.49668E-4,0,.314753,.751991,7.31613E-4,0,.338118,.733407,7.17655E-4,0,.362347,.713688,7.00604E-4,0,.387447,.693595,6.78765E-4,0,.413424,.673426,6.57042E-4,0,.440284,.65359,6.35892E-4,0,.468027,.633576,6.11569E-4,
0,.496645,.613144,5.86011E-4,0,.526122,.592711,5.63111E-4,0,.556417,.572722,5.37699E-4,0,.587451,.552762,5.12556E-4,0,.619048,.532985,4.89757E-4,0,.650794,.513219,4.64139E-4,0,.68254,.493992,4.42193E-4,0,.714286,.47509,4.18629E-4,0,.746032,.456287,3.97045E-4,0,.777778,.438152,3.75504E-4,0,.809524,.420294,3.5492E-4,0,.84127,.402749,3.35327E-4,0,.873016,.385879,3.16422E-4,0,.904762,.369352,2.98333E-4,0,.936508,.353301,2.81417E-4,0,.968254,.337781,2.65203E-4,0,1,1,9.68267E-5,0,0,1,9.68284E-5,0,0,1,9.68556E-5,
0,0,.999999,9.69733E-5,0,0,.999997,9.72913E-5,0,0,.999993,9.79688E-5,0,0,.999984,9.92239E-5,0,0,.999969,1.01356E-4,0,0,.999946,1.04784E-4,0,0,.999913,1.10111E-4,0,0,.999868,1.18217E-4,0,0,.999801,1.30396E-4,0,0,.999712,1.48523E-4,0,1.24907E-5,.999589,1.75233E-4,0,3.55405E-4,.999416,2.13999E-4,0,.0013528,.999136,2.68529E-4,0,.00312557,.998367,3.33088E-4,0,.00573045,.994701,3.04757E-4,0,.00919397,.992497,3.18031E-4,0,.0135261,.990608,3.53863E-4,0,.0187278,.988715,4.09044E-4,0,.0247947,.986241,4.72967E-4,
0,.0317196,.981696,4.95104E-4,0,.039494,.977097,5.32873E-4,0,.0481087,.972583,5.94447E-4,0,.0575549,.966142,6.36867E-4,0,.0678242,.95823,6.69899E-4,0,.0789089,.949677,7.19499E-4,0,.0908023,.939226,7.50584E-4,0,.103499,.927501,7.93183E-4,0,.116993,.915199,8.1995E-4,0,.131282,.90498,8.47654E-4,0,.146364,.894243,8.68929E-4,0,.162237,.882154,8.84278E-4,0,.178902,.869161,8.98108E-4,0,.196358,.854751,9.01254E-4,0,.21461,.839368,9.0679E-4,0,.23366,.822874,9.01541E-4,0,.253512,.805514,8.97297E-4,0,.274174,
.78716,8.81856E-4,0,.29565,.769061,8.70032E-4,0,.31795,.751,8.51719E-4,0,.341081,.732614,8.30671E-4,0,.365053,.713171,8.06569E-4,0,.389874,.693472,7.8338E-4,0,.415553,.673528,7.56404E-4,0,.442098,.653397,7.26872E-4,0,.469512,.633781,7.00494E-4,0,.497794,.613877,6.7105E-4,0,.526935,.593506,6.40361E-4,0,.556908,.573667,6.13502E-4,0,.587657,.553932,5.83177E-4,0,.61906,.534345,5.54375E-4,0,.650794,.515042,5.27811E-4,0,.68254,.495674,4.99367E-4,0,.714286,.477132,4.7429E-4,0,.746032,.458609,4.47726E-4,
0,.777778,.440354,4.24205E-4,0,.809524,.422765,3.99549E-4,0,.84127,.405472,3.78315E-4,0,.873016,.388482,3.55327E-4,0,.904762,.372191,3.36122E-4,0,.936508,.356099,3.15247E-4,0,.968254,.340737,2.9794E-4,0,1,1,1.43327E-4,0,0,1,1.4333E-4,0,0,1,1.43366E-4,0,0,.999999,1.43524E-4,0,0,.999996,1.43952E-4,0,0,.999991,1.44862E-4,0,0,.999981,1.46544E-4,0,0,.999966,1.49391E-4,0,0,.999941,1.53946E-4,0,0,.999905,1.60971E-4,0,0,.999852,1.71562E-4,0,0,.99978,1.8729E-4,0,0,.999681,2.10386E-4,0,8.26239E-5,.999546,2.43906E-4,
0,6.64807E-4,.999352,2.91739E-4,0,.00196192,.999027,3.57419E-4,0,.00405941,.997886,4.22349E-4,0,.00699664,.99419,3.85008E-4,0,.0107896,.99214,4.09775E-4,0,.0154415,.990274,4.56418E-4,0,.0209488,.988455,5.27008E-4,0,.0273037,.985804,5.97685E-4,0,.0344969,.98103,6.13124E-4,0,.0425183,.976674,6.68321E-4,0,.0513575,.972021,7.36985E-4,0,.0610046,.965274,7.73789E-4,0,.0714508,.958046,8.30852E-4,0,.0826877,.949333,8.75766E-4,0,.0947085,.939135,9.17088E-4,0,.107507,.927119,9.52244E-4,0,.121078,.91469,9.90626E-4,
0,.135419,.903006,.00101304,0,.150526,.892368,.00103834,0,.166399,.880231,.00105002,0,.183038,.867432,.00106331,0,.200443,.853208,.00106783,0,.218618,.837956,.00106458,0,.237566,.821772,.00105945,0,.257291,.804328,.00104685,0,.2778,.786465,.00103178,0,.2991,.768004,.00101077,0,.321199,.74972,9.85504E-4,0,.344106,.731682,9.62893E-4,0,.36783,.712813,9.32146E-4,0,.392383,.693139,8.9871E-4,0,.417774,.673566,8.69678E-4,0,.444013,.653483,8.35525E-4,0,.471107,.633891,7.99853E-4,0,.49906,.614433,7.66838E-4,
0,.527869,.594586,7.32227E-4,0,.557517,.574769,6.96442E-4,0,.587966,.555149,6.63935E-4,0,.61913,.535898,6.29826E-4,0,.650794,.516753,5.96486E-4,0,.68254,.497816,5.67078E-4,0,.714286,.479034,5.34399E-4,0,.746032,.460975,5.07013E-4,0,.777778,.442935,4.77421E-4,0,.809524,.425263,4.51101E-4,0,.84127,.408248,4.24964E-4,0,.873016,.391339,3.9993E-4,0,.904762,.37513,3.77619E-4,0,.936508,.359172,3.54418E-4,0,.968254,.343876,3.34823E-4,0,1,1,2.09042E-4,0,0,1,2.09045E-4,0,0,1,2.09093E-4,0,0,.999999,2.09304E-4,
0,0,.999996,2.09871E-4,0,0,.999991,2.11078E-4,0,0,.999979,2.13304E-4,0,0,.999963,2.17061E-4,0,0,.999933,2.23042E-4,0,0,.999894,2.32206E-4,0,0,.999837,2.45901E-4,0,0,.999756,2.66023E-4,0,1.02927E-6,.999648,2.95204E-4,0,2.33468E-4,.999499,3.36958E-4,0,.00108237,.999283,3.95563E-4,0,.00268832,.998896,4.73785E-4,0,.00511138,.997006,5.20008E-4,0,.00837705,.993819,4.97261E-4,0,.0124928,.991632,5.23722E-4,0,.0174561,.989875,5.87258E-4,0,.0232596,.988109,6.76329E-4,0,.0298932,.985155,7.47701E-4,0,.0373453,
.980479,7.68803E-4,0,.0456045,.976271,8.41054E-4,0,.0546593,.971347,9.11469E-4,0,.0644994,.964528,9.53057E-4,0,.0751152,.957632,.00102221,0,.0864981,.948681,.00106122,0,.0986407,.938716,.00111857,0,.111537,.926629,.00114762,0,.125182,.914025,.00118995,0,.139571,.901026,.00121228,0,.154703,.890358,.00123946,0,.170576,.878283,.0012527,0,.18719,.865459,.00125536,0,.204547,.851407,.00126134,0,.222648,.836276,.00124759,0,.241498,.820436,.00124443,0,.261101,.803253,.00122071,0,.281465,.785562,.00120107,
0,.302595,.76718,.00117762,0,.324501,.748551,.00114289,0,.347192,.730564,.00110872,0,.370679,.712253,.00107636,0,.394973,.692867,.00103646,0,.420085,.673695,9.96793E-4,0,.446027,.653912,9.5675E-4,0,.47281,.634129,9.16739E-4,0,.500441,.615004,8.74401E-4,0,.528921,.595587,8.33411E-4,0,.558244,.575965,7.94556E-4,0,.588384,.5566,7.5196E-4,0,.619281,.537428,7.16381E-4,0,.650795,.518623,6.76558E-4,0,.68254,.499964,6.4074E-4,0,.714286,.481356,6.05984E-4,0,.746032,.463279,5.70256E-4,0,.777778,.445673,5.40138E-4,
0,.809524,.428032,5.07299E-4,0,.84127,.411112,4.79553E-4,0,.873016,.394444,4.50737E-4,0,.904762,.378247,4.24269E-4,0,.936508,.362415,3.99111E-4,0,.968254,.347103,3.75274E-4,0,1,1,3.00729E-4,0,0,1,3.00733E-4,0,0,1,3.00797E-4,0,0,.999998,3.01072E-4,0,0,.999996,3.01817E-4,0,0,.999989,3.03398E-4,0,0,.999977,3.06309E-4,0,0,.999958,3.11209E-4,0,0,.999927,3.18975E-4,0,0,.999884,3.30804E-4,0,0,.99982,3.4834E-4,0,0,.999733,3.73854E-4,0,3.26995E-5,.999613,4.10424E-4,0,4.77174E-4,.999447,4.62047E-4,0,.00161099,
.999204,5.33322E-4,0,.00353153,.998725,6.24964E-4,0,.00627965,.995871,6.31786E-4,0,.0098693,.993194,6.32017E-4,0,.0143011,.991541,6.8923E-4,0,.019568,.989773,7.66892E-4,0,.0256593,.987647,8.63668E-4,0,.0325625,.984193,9.22089E-4,0,.0402647,.980016,9.70749E-4,0,.0487532,.975859,.00106027,0,.058016,.970514,.00112239,0,.0680419,.963625,.00117212,0,.0788208,.956959,.00125211,0,.0903439,.947956,.00129411,0,.102604,.93809,.00135879,0,.115594,.92659,.00139309,0,.129309,.913829,.00143253,0,.143745,.90005,
.00145809,0,.158901,.888129,.0014748,0,.174774,.87607,.00148756,0,.191365,.863461,.00148714,0,.208674,.849594,.00148892,0,.226705,.834531,.00146496,0,.245461,.81903,.0014579,0,.264947,.802122,.00143039,0,.28517,.78445,.00139717,0,.306137,.766434,.00136312,0,.327857,.747816,.00132597,0,.350341,.729519,.00128323,0,.373598,.711454,.00123803,0,.397642,.692699,.00119097,0,.422485,.673723,.00114565,0,.448139,.654386,.00109552,0,.474619,.634673,.00104553,0,.501933,.615554,9.9985E-4,0,.530089,.596462,9.48207E-4,
0,.559087,.577385,9.02299E-4,0,.588913,.558257,8.56448E-4,0,.619525,.5392,8.10395E-4,0,.650826,.520543,7.68558E-4,0,.68254,.502206,7.239E-4,0,.714286,.48402,6.85794E-4,0,.746032,.465779,6.4471E-4,0,.777778,.448455,6.09583E-4,0,.809524,.431091,5.7227E-4,0,.84127,.414147,5.4042E-4,0,.873016,.39765,5.06545E-4,0,.904762,.381576,4.77635E-4,0,.936508,.365881,4.48446E-4,0,.968254,.350582,4.21424E-4,0,1,1,4.27144E-4,0,0,1,4.27151E-4,0,0,1,4.27232E-4,0,0,.999998,4.2759E-4,0,0,.999995,4.28555E-4,0,0,.999988,
4.30603E-4,0,0,.999976,4.34368E-4,0,0,.999952,4.40688E-4,0,0,.999919,4.50667E-4,0,0,.999871,4.6578E-4,0,0,.999801,4.88024E-4,0,0,.999704,5.20092E-4,0,1.29791E-4,.999572,5.65553E-4,0,8.21056E-4,.999389,6.28906E-4,0,.00225241,.999114,7.14911E-4,0,.00449109,.998488,8.19218E-4,0,.00756249,.995234,8.0415E-4,0,.0114716,.993021,8.30181E-4,0,.0162131,.991407,9.02645E-4,0,.021776,.989625,9.96934E-4,0,.0281471,.987064,.00109707,0,.0353118,.983265,.00114353,0,.0432562,.979535,.0012272,0,.0519665,.975224,.00132642,
0,.0614298,.969574,.00138092,0,.0716348,.963021,.00145896,0,.0825709,.956046,.00152834,0,.094229,.947136,.00158217,0,.106602,.937313,.0016347,0,.119682,.926073,.00168383,0,.133465,.913121,.00171627,0,.147947,.899165,.00174229,0,.163125,.885891,.00176137,0,.178998,.873783,.00176406,0,.195566,.861331,.00176156,0,.21283,.847569,.00175346,0,.230793,.832785,.00172753,0,.249459,.817442,.00170204,0,.268832,.800613,.00166576,0,.28892,.783597,.00162909,0,.30973,.76571,.0015826,0,.331271,.747021,.00153106,
0,.353554,.728593,.00148036,0,.37659,.710661,.00142808,0,.400391,.692426,.00136906,0,.424973,.673623,.00131066,0,.450347,.65494,.00125569,0,.476531,.635448,.00119517,0,.503535,.616221,.00113828,0,.531372,.597531,.0010816,0,.560047,.578795,.00102673,0,.589554,.559892,9.70985E-4,0,.619869,.541307,9.19773E-4,0,.650923,.522608,8.68479E-4,0,.68254,.504484,8.2137E-4,0,.714286,.486603,7.72916E-4,0,.746032,.468802,7.30353E-4,0,.777778,.451172,6.84955E-4,0,.809524,.434348,6.47565E-4,0,.84127,.417445,6.05863E-4,
0,.873016,.401077,5.71885E-4,0,.904762,.385039,5.36034E-4,0,.936508,.369483,5.04227E-4,0,.968254,.354272,4.73165E-4,0,1,1,5.99525E-4,0,0,1,5.99533E-4,0,0,1,5.99639E-4,0,0,.999998,6.00097E-4,0,0,.999994,6.01336E-4,0,0,.999987,6.03958E-4,0,0,.999972,6.08775E-4,0,0,.999949,6.16842E-4,0,0,.999912,6.29534E-4,0,0,.999857,6.48658E-4,0,0,.999781,6.76615E-4,0,5.38873E-6,.999674,7.16574E-4,0,3.08602E-4,.999528,7.72641E-4,0,.00127003,.999326,8.49806E-4,0,.00300783,.999009,9.52682E-4,0,.00556637,.998112,.00106394,
0,.00895889,.994496,.00102228,0,.0131827,.992806,.00108586,0,.0182277,.991211,.0011759,0,.0240795,.989415,.00128955,0,.030723,.986499,.00139038,0,.0381418,.982679,.00144539,0,.046321,.978839,.00153954,0,.0552459,.974295,.00164417,0,.0649034,.968784,.00171517,0,.0752814,.962324,.00180282,0,.0863693,.954956,.00186387,0,.0981578,.94624,.00193817,0,.110639,.936517,.00198156,0,.123806,.925186,.00203042,0,.137655,.91252,.0020664,0,.15218,.898441,.00207822,0,.16738,.884394,.0020992,0,.183253,.871273,.00208748,
0,.199799,.859057,.00208686,0,.21702,.845243,.00205519,0,.234918,.830723,.00202868,0,.253496,.815801,.00199501,0,.272761,.79914,.00194193,0,.292719,.782372,.00188824,0,.313377,.76482,.00183695,0,.334745,.746586,.00177418,0,.356833,.7281,.00170628,0,.379654,.709842,.00164063,0,.403221,.692019,.00157355,0,.427548,.67364,.00150262,0,.452651,.655277,.00143473,0,.478545,.636438,.00136371,0,.505246,.617364,.00129911,0,.532768,.598603,.00123014,0,.561122,.580195,.00116587,0,.590309,.561786,.00110398,0,.620318,
.543377,.00104148,0,.651102,.525093,9.83984E-4,0,.682545,.506791,9.2667E-4,0,.714286,.489291,8.74326E-4,0,.746032,.471811,8.21734E-4,0,.777778,.454435,7.74698E-4,0,.809524,.437493,7.27302E-4,0,.84127,.420977,6.84039E-4,0,.873016,.404729,6.4373E-4,0,.904762,.388756,6.0285E-4,0,.936508,.373344,5.6765E-4,0,.968254,.358191,5.31929E-4,0,1,1,8.32169E-4,0,0,1,8.32178E-4,0,0,1,8.3231E-4,0,0,.999998,8.32893E-4,0,0,.999995,8.34465E-4,0,0,.999985,8.37791E-4,0,0,.999969,8.43893E-4,0,0,.999944,8.54086E-4,0,0,
.999903,8.70071E-4,0,0,.999843,8.94042E-4,0,0,.999759,9.28865E-4,0,5.31805E-5,.999643,9.78242E-4,0,5.79365E-4,.99948,.00104684,0,.00182774,.999255,.00114012,0,.00387804,.998885,.00126188,0,.00675709,.997405,.00135888,0,.010468,.99424,.00133626,0,.0150018,.992458,.00140905,0,.0203443,.990929,.00152305,0,.0264786,.989116,.00165882,0,.0333875,.985624,.00174128,0,.0410536,.982003,.00182108,0,.0494609,.978336,.00194498,0,.0585941,.973184,.00202708,0,.0684396,.9678,.00212166,0,.0789851,.961348,.00221366,
0,.0902199,.953841,.00228219,0,.102134,.94534,.00235662,0,.114721,.935552,.00240572,0,.127972,.924064,.00244405,0,.141884,.911827,.00247557,0,.156451,.897731,.00248374,0,.171672,.883409,.00249863,0,.187545,.868625,.00246688,0,.20407,.856529,.00246523,0,.221249,.842999,.00242368,0,.239083,.828505,.00237354,0,.257578,.813825,.00232588,0,.276738,.797813,.00226731,0,.296569,.781097,.00219704,0,.31708,.764038,.00212394,0,.338281,.746067,.00204786,0,.360181,.727687,.00196728,0,.382794,.709571,.00188779,
0,.406133,.691503,.00180532,0,.430213,.673673,.00171849,0,.45505,.655732,.00164147,0,.480662,.637399,.00155858,0,.507065,.618616,.00147641,0,.534278,.60005,.00140125,0,.562313,.581713,.00132441,0,.59118,.563546,.00125014,0,.620875,.545605,.00118249,0,.651373,.527559,.0011116,0,.682593,.509764,.00104979,0,.714286,.49193,9.85977E-4,0,.746032,.475011,9.28592E-4,0,.777778,.457878,8.73466E-4,0,.809524,.440979,8.19585E-4,0,.84127,.424613,7.72365E-4,0,.873016,.408549,7.22195E-4,0,.904762,.392771,6.80014E-4,
0,.936508,.377317,6.36797E-4,0,.968254,.362352,5.98318E-4,0,1,1,.00114313,0,0,1,.00114314,0,0,.999999,.00114331,0,0,.999998,.00114404,0,0,.999994,.00114601,0,0,.999984,.00115019,0,0,.999967,.00115784,0,0,.999937,.0011706,0,0,.999894,.00119054,0,0,.999828,.00122031,0,0,.999735,.00126331,0,1.69263E-4,.999606,.00132382,0,9.49167E-4,.999426,.0014071,0,.00249668,.999173,.00151895,0,.00486392,.99873,.00166102,0,.00806323,.996243,.0017023,0,.0120895,.993779,.00172782,0,.0169288,.9919,.0018108,0,.0225633,
.990524,.00196028,0,.028974,.98868,.00212014,0,.036142,.984663,.00217598,0,.044049,.981457,.00230563,0,.0526781,.977608,.00243966,0,.0620137,.972215,.00251336,0,.0720418,.966798,.0026285,0,.0827499,.960241,.00271409,0,.0941271,.952489,.00278381,0,.106164,.944127,.00285399,0,.118852,.934282,.00290994,0,.132185,.923271,.00294558,0,.146157,.910803,.00296269,0,.160766,.896705,.00296803,0,.176007,.88238,.00296637,0,.19188,.867116,.00293163,0,.208385,.853636,.00289418,0,.225523,.840469,.00284663,0,.243296,
.82639,.00278594,0,.261709,.811759,.00271618,0,.280767,.796113,.00263187,0,.300476,.779518,.00254589,0,.320845,.763142,.00246003,0,.341883,.745464,.00236529,0,.363601,.727491,.00226536,0,.386011,.709414,.00216375,0,.409128,.691396,.00207127,0,.432967,.67368,.00197106,0,.457545,.656049,.00187022,0,.482881,.638188,.00177605,0,.508992,.620177,.00168482,0,.535899,.601506,.00158909,0,.563619,.58362,.00150583,0,.592165,.565496,.00141791,0,.621544,.54789,.00133693,0,.651743,.530323,.00126038,0,.682709,.512795,
.00118556,0,.714286,.495199,.00111527,0,.746032,.478101,.0010489,0,.777778,.461511,9.84264E-4,0,.809524,.444879,9.2591E-4,0,.84127,.428424,8.66582E-4,0,.873016,.412495,8.14463E-4,0,.904762,.396975,7.64498E-4,0,.936508,.381614,7.15967E-4,0,.968254,.366732,6.72483E-4,0,1,1,.00155501,0,0,1,.00155503,0,0,1,.00155524,0,0,.999998,.00155615,0,0,.999994,.0015586,0,0,.999983,.00156379,0,0,.999963,.0015733,0,0,.999932,.00158911,0,0,.999882,.00161376,0,0,.99981,.00165041,0,1.00875E-5,.999708,.00170304,0,3.67658E-4,
.999565,.00177658,0,.0014234,.999368,.00187688,0,.00327939,.999081,.00200989,0,.00596629,.99852,.00217177,0,.0094852,.99549,.0021745,0,.013824,.993252,.00222357,0,.0189642,.991727,.00235022,0,.0248856,.989951,.00250561,0,.0315669,.988029,.00268829,0,.0389882,.984029,.0027496,0,.0471302,.980683,.00289793,0,.0559754,.976554,.00303315,0,.0655081,.97139,.00313257,0,.0757138,.965544,.00323656,0,.08658,.95912,.00333432,0,.0980954,.951183,.0034039,0,.110251,.942974,.00347515,0,.123038,.932642,.00350381,
0,.13645,.922158,.00354519,0,.150482,.909404,.00353851,0,.165129,.896071,.0035435,0,.18039,.881206,.00349936,0,.196263,.866077,.00347256,0,.212748,.85093,.003415,0,.229847,.837703,.00333367,0,.247561,.823878,.003249,0,.265895,.809449,.00316347,0,.284854,.794379,.00306351,0,.304445,.778138,.0029499,0,.324675,.761997,.00284099,0,.345555,.744938,.00272104,0,.367095,.727212,.00260715,0,.389309,.709549,.00248855,0,.41221,.691704,.00236783,0,.435814,.673689,.00225178,0,.460138,.656453,.00213765,0,.485203,
.639128,.00202178,0,.511028,.621512,.00191443,0,.537634,.603598,.00180977,0,.565041,.58559,.00170456,0,.593268,.567852,.00160927,0,.622327,.5503,.00151395,0,.652217,.533033,.00142499,0,.682907,.515942,.00133955,0,.714296,.498814,.0012602,0,.746032,.481595,.00118188,0,.777778,.465117,.00111171,0,.809524,.448865,.00104091,0,.84127,.432711,9.76618E-4,0,.873016,.416822,9.1859E-4,0,.904762,.401272,8.57704E-4,0,.936508,.386226,8.07172E-4,0,.968254,.371321,7.5464E-4,0,1,1,.00209596,0,0,1,.00209598,0,0,1,
.00209624,0,0,.999997,.00209736,0,0,.999991,.00210039,0,0,.999979,.00210678,0,0,.999959,.00211847,0,0,.999925,.0021379,0,0,.99987,.00216809,0,0,.999791,.00221281,0,6.81487E-5,.999677,.00227669,0,6.58161E-4,.999521,.00236533,0,.00200635,.999301,.00248514,0,.0041779,.998977,.00264185,0,.00718648,.998191,.00281695,0,.0110239,.994801,.00278518,0,.015672,.993091,.00288774,0,.0211091,.991571,.00303931,0,.0273123,.9897,.00321643,0,.034259,.987023,.00337332,0,.0419282,.983289,.00346146,0,.0502998,.979892,
.00363704,0,.0593562,.975111,.00373601,0,.069081,.970351,.0038842,0,.0794598,.964131,.00397053,0,.0904798,.957747,.00408078,0,.10213,.949536,.00413533,0,.1144,.941372,.00420305,0,.127284,.931049,.00422815,0,.140772,.920647,.00425048,0,.154862,.908033,.0042281,0,.169548,.895028,.00422026,0,.184828,.879968,.00415042,0,.200701,.864875,.00408821,0,.217167,.84918,.00400909,0,.234227,.834934,.00391178,0,.251884,.821397,.00380066,0,.270141,.807135,.00367974,0,.289004,.792363,.00355172,0,.308479,.776661,
.003411,0,.328575,.760705,.00328123,0,.349301,.744408,.00314003,0,.370668,.726994,.0029906,0,.392689,.709598,.00285034,0,.415379,.692112,.00271179,0,.438754,.674435,.00257185,0,.46283,.65676,.00243425,0,.48763,.639982,.00230351,0,.513173,.622983,.0021777,0,.539482,.605471,.00204991,0,.566579,.58796,.00193759,0,.594488,.570463,.00181976,0,.623226,.553058,.00171497,0,.6528,.535894,.00161109,0,.683198,.519089,.00151394,0,.714354,.502454,.00142122,0,.746032,.485681,.00133488,0,.777778,.468935,.00124975,
0,.809524,.452951,.00117309,0,.84127,.437139,.00110155,0,.873016,.421446,.00103124,0,.904762,.405951,9.66387E-4,0,.936508,.391003,9.08119E-4,0,.968254,.376198,8.48057E-4,0,1,1,.00280076,0,0,1,.00280078,0,0,.999999,.00280109,0,0,.999997,.00280246,0,0,.999992,.00280616,0,0,.999979,.00281396,0,0,.999956,.00282822,0,0,.999916,.00285186,0,0,.999857,.0028885,0,0,.999768,.00294259,0,1.96026E-4,.999645,.00301946,0,.00104842,.99947,.00312541,0,.00270199,.999229,.00326733,0,.00519449,.998852,.00344992,0,.00852602,
.997558,.00361052,0,.0126804,.994417,.0035898,0,.017635,.992824,.00372393,0,.023365,.991344,.00390695,0,.0298456,.989337,.00410392,0,.0370529,.985811,.00420987,0,.0449651,.982772,.00437488,0,.0535615,.979001,.00455069,0,.0628243,.974102,.00464462,0,.0727368,.969197,.00480577,0,.0832844,.962759,.00487818,0,.0944545,.956207,.00498176,0,.106236,.947909,.00503392,0,.118619,.939596,.00507474,0,.131595,.929642,.00509798,0,.145159,.918807,.00508476,0,.159305,.906921,.00505634,0,.174028,.893312,.00498845,
0,.189327,.878933,.0049133,0,.2052,.863986,.0048259,0,.221647,.847936,.00470848,0,.23867,.832253,.00456889,0,.25627,.818619,.00442726,0,.274453,.804788,.00427677,0,.293222,.790241,.00411906,0,.312585,.775162,.00394833,0,.33255,.759463,.00377366,0,.353126,.743598,.00361026,0,.374324,.72697,.00343627,0,.396158,.709646,.00326422,0,.418641,.69277,.00309717,0,.44179,.675371,.0029356,0,.465624,.657863,.00277712,0,.490163,.640772,.00261738,0,.515429,.624441,.0024737,0,.541445,.607497,.00233125,0,.568236,
.590438,.00218994,0,.595828,.573224,.0020664,0,.624242,.556168,.00193526,0,.653496,.539232,.00182463,0,.683588,.522352,.00170735,0,.714482,.506172,.00160555,0,.746032,.489842,.00150451,0,.777778,.473463,.00140938,0,.809524,.457266,.00132568,0,.84127,.441609,.0012376,0,.873016,.426348,.00116265,0,.904762,.411002,.00108935,0,.936508,.396045,.00101946,0,.968254,.381448,9.55665E-4,0,1,1,.0037121,0,0,1,.00371213,0,0,1,.00371251,0,0,.999997,.00371417,0,0,.99999,.00371863,0,0,.999977,.00372807,0,0,.99995,
.00374529,0,0,.999908,.0037738,0,0,.999843,.00381789,0,1.23596E-5,.999745,.00388273,0,4.07442E-4,.999608,.00397443,0,.0015447,.999415,.00409998,0,.00351385,.999143,.00426662,0,.0063316,.9987,.00447625,0,.00998679,.996363,.00455323,0,.0144569,.994021,.00461052,0,.0197151,.992372,.00476359,0,.0257344,.991007,.00499101,0,.0324882,.988767,.0051972,0,.0399517,.984872,.00528407,0,.0481022,.982004,.00548926,0,.0569191,.977714,.00564385,0,.0663839,.973076,.0057693,0,.0764801,.967565,.0058924,0,.0871928,.961384,
.00599629,0,.0985095,.954435,.00605998,0,.110419,.946303,.0061133,0,.122912,.937662,.00612028,0,.13598,.927867,.00612209,0,.149617,.916475,.00604813,0,.163817,.90541,.00603088,0,.178577,.891591,.00592218,0,.193894,.877573,.00578854,0,.209767,.862511,.00566648,0,.226196,.846861,.00551481,0,.243182,.83068,.00533754,0,.260728,.815725,.00515487,0,.278837,.802321,.0049655,0,.297515,.787826,.00475421,0,.316768,.773454,.00456002,0,.336605,.758224,.00434727,0,.357034,.74265,.00414444,0,.378067,.726729,.00393738,
0,.399717,.710155,.00373575,0,.421998,.693312,.00353736,0,.444928,.67653,.00334368,0,.468523,.659444,.00315981,0,.492806,.642051,.00297809,0,.517798,.625758,.00280592,0,.543525,.609615,.00264254,0,.570012,.592919,.00248459,0,.597288,.576298,.00233327,0,.625379,.559489,.00219519,0,.654307,.542891,.00205441,0,.684084,.526255,.00193385,0,.714693,.509853,.00180745,0,.746044,.494131,.00169817,0,.777778,.478114,.0015913,0,.809524,.462274,.00148981,0,.84127,.446412,.00139537,0,.873016,.431274,.00130984,
0,.904762,.41635,.00122403,0,.936508,.401476,.00114809,0,.968254,.386993,.00107563,0,1,1,.00488216,0,0,1,.0048822,0,0,1,.00488265,0,0,.999997,.00488463,0,0,.999988,.00488999,0,0,.999974,.00490129,0,0,.999946,.00492191,0,0,.999897,.00495598,0,0,.999825,.00500855,0,7.44791E-5,.999718,.00508559,0,7.12744E-4,.999565,.005194,0,.00215249,.999352,.00534147,0,.00444576,.999046,.00553523,0,.00759218,.998492,.00577016,0,.0115714,.995564,.00578487,0,.0163557,.993339,.00586414,0,.021915,.991834,.00606002,0,.0282201,
.990496,.00633312,0,.0352433,.987826,.00651941,0,.042959,.98383,.00660842,0,.0513439,.98109,.00685523,0,.0603772,.976131,.00695778,0,.0700402,.971922,.00714236,0,.0803163,.965901,.00721437,0,.0911908,.959606,.00732017,0,.102651,.952504,.00735788,0,.114686,.944365,.00738493,0,.127286,.935652,.00737969,0,.140443,.925813,.00733612,0,.154151,.914397,.00723094,0,.168405,.903257,.00714002,0,.183201,.890015,.00700149,0,.198536,.876014,.00682813,0,.214409,.861436,.00665567,0,.23082,.845752,.00644526,0,.24777,
.829169,.00621635,0,.265263,.813435,.00597789,0,.283301,.799701,.00575694,0,.301889,.785726,.00549866,0,.321035,.77152,.0052503,0,.340746,.75683,.00499619,0,.361032,.741951,.0047543,0,.381904,.726367,.0045084,0,.403374,.710537,.00426784,0,.425457,.693965,.00403487,0,.448169,.677724,.0038075,0,.47153,.66117,.00359431,0,.495561,.644274,.00338354,0,.520284,.627449,.00318163,0,.545725,.611645,.00299672,0,.571911,.595614,.00281016,0,.598873,.579426,.00264252,0,.62664,.563016,.00247509,0,.655239,.546728,
.00232647,0,.684692,.530539,.00217803,0,.714999,.514164,.00204216,0,.746106,.498344,.00191403,0,.777778,.482957,.00179203,0,.809524,.467336,.00167695,0,.84127,.451994,.00157567,0,.873016,.436514,.00147113,0,.904762,.42178,.00138034,0,.936508,.407271,.00129219,0,.968254,.392822,.0012098,0,1,1,.00637427,0,0,1,.00637431,0,0,.999999,.00637485,0,0,.999996,.00637721,0,0,.999987,.00638357,0,0,.999971,.006397,0,0,.999939,.00642142,0,0,.999888,.00646177,0,0,.999807,.00652387,0,2.07916E-4,.999689,.00661454,
0,.00112051,.99952,.00674155,0,.00287719,.999283,.00691313,0,.00550145,.998936,.00713598,0,.00897928,.998165,.00738501,0,.0132829,.994847,.00734388,0,.01838,.993182,.00749991,0,.0242381,.991665,.0077246,0,.030826,.989708,.00797579,0,.0381152,.986663,.00813011,0,.0460794,.983288,.00830365,0,.0546951,.980104,.00853496,0,.0639411,.974855,.00861045,0,.0737988,.97045,.00879133,0,.0842516,.964509,.00886377,0,.0952848,.957594,.00890346,0,.106886,.950546,.00893289,0,.119044,.942225,.00890074,0,.131749,.933365,
.00886826,0,.144994,.923202,.0087316,0,.158772,.912605,.00863082,0,.173078,.901099,.00847403,0,.187908,.888177,.00825838,0,.203261,.873955,.00801834,0,.219134,.860091,.00779026,0,.235527,.84434,.00752478,0,.252443,.828517,.00724074,0,.269883,.81239,.00693769,0,.287851,.79721,.00664817,0,.306352,.783489,.00634763,0,.325393,.769514,.00604221,0,.344981,.755419,.00573568,0,.365126,.741083,.00544359,0,.385839,.726059,.00515515,0,.407132,.710809,.00487139,0,.42902,.695052,.00459846,0,.45152,.678886,.00433412,
0,.474651,.663042,.00407981,0,.498433,.646634,.00384264,0,.52289,.630117,.00360897,0,.548048,.613804,.00338863,0,.573936,.598338,.00318486,0,.600584,.582687,.00298377,0,.628027,.566809,.00280082,0,.656295,.550817,.00262255,0,.685417,.534937,.00245835,0,.715406,.519151,.00230574,0,.74624,.503118,.0021549,0,.777778,.487723,.00202008,0,.809524,.472725,.00189355,0,.84127,.457599,.00177108,0,.873016,.442558,.00165843,0,.904762,.427624,.00155494,0,.936508,.413171,.00145273,0,.968254,.399122,.00136454,0,
1,1,.00826496,0,0,1,.00826499,0,0,1,.00826564,0,0,.999996,.00826842,0,0,.999987,.00827589,0,0,.999967,.00829167,0,0,.999933,.00832037,0,0,.999876,.00836768,0,1.09338E-5,.999786,.00844031,0,4.27145E-4,.999655,.00854603,0,.0016384,.999468,.00869337,0,.00372392,.999203,.008891,0,.00668513,.998803,.00914387,0,.0104968,.99748,.00935838,0,.015125,.994446,.00933309,0,.0205338,.99292,.00953084,0,.0266884,.991414,.0097893,0,.0335565,.989049,.0100228,0,.0411086,.98582,.0101664,0,.0493181,.982441,.0103582,0,
.0581613,.978595,.0105292,0,.0676169,.973495,.0106274,0,.0776661,.968405,.0107261,0,.0882926,.962717,.0108234,0,.0994817,.955478,.0108102,0,.111221,.948275,.0107914,0,.123499,.940006,.0107161,0,.136308,.930831,.0106309,0,.149639,.920648,.0104083,0,.163485,.910205,.0102312,0,.177843,.898445,.0100051,0,.192707,.885986,.00971928,0,.208077,.872204,.00940747,0,.22395,.858436,.0091085,0,.240326,.843454,.00876595,0,.257208,.827437,.00839794,0,.274596,.811488,.00803692,0,.292496,.796039,.00767352,0,.310911,
.781083,.0073097,0,.329849,.767642,.00694032,0,.349316,.753901,.00657476,0,.369323,.740131,.00622699,0,.38988,.725845,.0058838,0,.410999,.710991,.00555586,0,.432696,.696002,.00523089,0,.454987,.680461,.00492494,0,.47789,.664875,.00463464,0,.501426,.649273,.00435422,0,.52562,.63302,.0040875,0,.550498,.61705,.00384075,0,.576089,.601154,.00359557,0,.602427,.586008,.00337636,0,.629544,.570699,.00316019,0,.657479,.555166,.00296033,0,.686264,.539645,.00277552,0,.715924,.524159,.00259499,0,.746459,.508682,
.00243257,0,.777789,.493163,.00227851,0,.809524,.478004,.00213083,0,.84127,.46347,.00199502,0,.873016,.448778,.00186967,0,.904762,.434105,.00174732,0,.936508,.419576,.00163861,0,.968254,.405541,.00153341,0,1,1,.0106462,0,0,1,.0106462,0,0,.999999,.010647,0,0,.999995,.0106502,0,0,.999985,.0106589,0,0,.999964,.0106773,0,0,.999925,.0107106,0,0,.999861,.0107655,0,7.12986E-5,.999763,.0108497,0,7.43959E-4,.999616,.0109716,0,.00227361,.999408,.0111408,0,.0046983,.999112,.0113659,0,.00800158,.998637,.0116475,
0,.0121493,.996223,.0117231,0,.0171023,.994006,.0118064,0,.0228218,.992444,.0120254,0,.0292711,.991028,.0123314,0,.036417,.98803,.0124954,0,.0442295,.984816,.0126538,0,.0526815,.981399,.0128537,0,.0617492,.977085,.0129694,0,.0714114,.972154,.013091,0,.0816495,.966617,.0131166,0,.0924472,.960628,.0131583,0,.10379,.953295,.0131094,0,.115665,.94575,.0129966,0,.128062,.937654,.0128796,0,.140972,.927716,.0126477,0,.154387,.917932,.0123889,0,.168301,.907719,.012131,0,.182709,.89584,.0118013,0,.197608,.883526,
.0114145,0,.212994,.870301,.0110075,0,.228867,.856272,.0106019,0,.245227,.842251,.0101938,0,.262074,.826466,.00973254,0,.279412,.810859,.0092846,0,.297244,.795051,.00883304,0,.315575,.780053,.00840272,0,.334412,.76575,.00796438,0,.35376,.752298,.00752526,0,.373631,.739153,.00711486,0,.394034,.725514,.00670361,0,.414983,.711473,.00632656,0,.436491,.696936,.00595206,0,.458575,.682126,.00559191,0,.481253,.667027,.00525362,0,.504547,.651875,.00493805,0,.528481,.636463,.00462848,0,.553081,.620641,.00433936,
0,.578377,.604931,.00407,0,.604404,.589549,.00380864,0,.631197,.574712,.00357049,0,.658795,.559775,.00334466,0,.687238,.544514,.00312505,0,.716559,.529555,.00293199,0,.746776,.514402,.00274204,0,.777849,.499302,.00256647,0,.809524,.484114,.00239901,0,.84127,.469308,.00225148,0,.873016,.455133,.00210178,0,.904762,.440939,.0019727,0,.936508,.426627,.00184382,0,.968254,.412509,.00172548,0,1,1,.013628,0,0,1,.0136281,0,0,.999999,.0136289,0,0,.999995,.0136327,0,0,.999983,.0136427,0,0,.99996,.0136638,0,
0,.999917,.0137022,0,0,.999846,.0137652,0,2.04597E-4,.999736,.0138615,0,.00116837,.999573,.0140007,0,.00303325,.99934,.0141927,0,.00580613,.999004,.0144457,0,.00945626,.998407,.0147489,0,.0139421,.995464,.014731,0,.0192202,.993328,.0148283,0,.0252495,.991799,.0150797,0,.0319921,.990397,.0154316,0,.0394138,.986835,.0155005,0,.0474843,.983938,.0157308,0,.0561763,.980154,.0158753,0,.0654661,.975659,.0159581,0,.0753326,.970171,.0159832,0,.0857571,.964803,.0160084,0,.0967236,.958366,.0159484,0,.108218,
.950613,.0158001,0,.120227,.942874,.0155845,0,.132741,.935005,.0154292,0,.145751,.924991,.0150742,0,.159249,.914814,.0146757,0,.17323,.904743,.0143097,0,.187687,.893216,.0138695,0,.202619,.880769,.0133706,0,.218021,.868136,.0128606,0,.233894,.85469,.0123403,0,.250238,.840593,.0118091,0,.267052,.825808,.011253,0,.284341,.81009,.0107099,0,.302106,.79504,.0101636,0,.320354,.779757,.00964041,0,.33909,.764697,.00911896,0,.358322,.750913,.00859533,0,.378059,.738175,.00811592,0,.398311,.725242,.00764504,
0,.41909,.711864,.00718885,0,.440412,.698009,.00675843,0,.462292,.683841,.00634984,0,.484748,.669391,.00595502,0,.507802,.654731,.00558671,0,.531477,.639805,.00523578,0,.555802,.624789,.00490834,0,.580805,.609325,.00459448,0,.606522,.593975,.00430342,0,.63299,.578983,.00403019,0,.66025,.564442,.0037707,0,.688346,.549835,.0035316,0,.717319,.535039,.00330255,0,.7472,.520403,.00308932,0,.777982,.505687,.00289335,0,.809524,.490939,.00270818,0,.84127,.476233,.0025343,0,.873016,.461624,.00237097,0,.904762,
.447833,.00222065,0,.936508,.433992,.00207561,0,.968254,.420147,.00194955,0,1,1,.0173415,0,0,1,.0173416,0,0,.999999,.0173426,0,0,.999995,.0173468,0,0,.999983,.0173582,0,0,.999954,.0173822,0,0,.999908,.0174258,0,6.69501E-6,.999828,.0174973,0,4.27399E-4,.999705,.0176063,0,.00171019,.999524,.0177631,0,.0039248,.999263,.0179781,0,.00705382,.998878,.018258,0,.0110552,.998012,.0185551,0,.0158812,.994614,.0184264,0,.0214852,.993132,.0186385,0,.0278239,.991563,.0189067,0,.0348585,.989298,.0191577,0,.0425544,
.986036,.0192522,0,.050881,.982558,.0194063,0,.059811,.978531,.019486,0,.0693209,.974198,.0195847,0,.0793895,.968148,.0194749,0,.0899984,.962565,.0194277,0,.101132,.956041,.0192991,0,.112775,.947749,.0189893,0,.124917,.94018,.018704,0,.137547,.93165,.0183458,0,.150655,.921798,.0178775,0,.164236,.911573,.0173618,0,.178281,.901569,.0168482,0,.192788,.890341,.016265,0,.207752,.877835,.0156199,0,.223171,.865472,.0149516,0,.239044,.852905,.0143274,0,.255371,.838906,.0136643,0,.272153,.824888,.0129903,
0,.289393,.809977,.0123218,0,.307093,.794697,.0116572,0,.325259,.780028,.0110307,0,.343896,.765124,.0104236,0,.363012,.750411,.0098219,0,.382617,.737264,.00924397,0,.402719,.724799,.00868719,0,.423332,.712253,.00816476,0,.444469,.699267,.00767262,0,.466146,.685618,.00719746,0,.488383,.671736,.00673916,0,.511199,.657777,.00631937,0,.534618,.643497,.00592411,0,.558668,.62889,.00553928,0,.58338,.614299,.0051934,0,.608787,.599197,.00485985,0,.634929,.584175,.00454357,0,.661849,.569541,.00425787,0,.689594,
.555193,.00397905,0,.718211,.540947,.00372364,0,.747742,.526593,.00348599,0,.778205,.512335,.00326103,0,.80953,.498017,.00305137,0,.84127,.483609,.00285485,0,.873016,.469368,.00267472,0,.904762,.455037,.00249945,0,.936508,.441493,.00234792,0,.968254,.428147,.00219936,0,1,1,.0219422,0,0,1,.0219423,0,0,.999998,.0219434,0,0,.999993,.0219481,0,0,.999981,.021961,0,0,.999949,.0219879,0,0,.999896,.0220367,0,5.93194E-5,.999808,.0221167,0,7.5364E-4,.99967,.0222383,0,.00237884,.999466,.0224125,0,.00495612,
.999174,.0226495,0,.00844887,.998725,.0229525,0,.0128058,.996979,.0231123,0,.0179742,.994317,.0230742,0,.0239047,.992781,.0232895,0,.0305526,.991191,.0235734,0,.0378786,.987787,.0236152,0,.0458475,.985092,.0237994,0,.0544287,.981121,.0238553,0,.0635952,.976924,.0238706,0,.0733233,.97218,.0238704,0,.0835922,.965956,.0236598,0,.0943839,.959998,.0234735,0,.105682,.953245,.0232277,0,.117474,.944445,.0226973,0,.129747,.937087,.0223527,0,.142491,.928341,.0218144,0,.155697,.9184,.0211516,0,.169358,.907959,
.0204553,0,.183469,.89808,.0197673,0,.198024,.887047,.0189915,0,.21302,.875221,.0182082,0,.228455,.86269,.0173584,0,.244329,.850735,.0165718,0,.260639,.837545,.0157524,0,.277389,.823639,.0149482,0,.29458,.809699,.0141431,0,.312216,.794797,.0133527,0,.3303,.780578,.0126193,0,.34884,.766019,.0118914,0,.367842,.751447,.0111839,0,.387315,.737275,.010514,0,.40727,.724545,.00987277,0,.427717,.712644,.00926569,0,.448671,.700432,.00869029,0,.470149,.687664,.00814691,0,.492167,.674288,.00763012,0,.514746,
.660966,.00714437,0,.537911,.647264,.00668457,0,.561688,.633431,.00626581,0,.586108,.619133,.00585593,0,.611206,.604935,.00548188,0,.637022,.590236,.00513288,0,.663599,.575473,.0047906,0,.690989,.561228,.00448895,0,.719242,.547054,.00420233,0,.748411,.533175,.00392869,0,.778531,.519163,.00367445,0,.809583,.505328,.00344097,0,.84127,.491446,.00322003,0,.873016,.477356,.00301283,0,.904762,.46356,.00282592,0,.936508,.449623,.00264956,0,.968254,.436068,.00246956,0,1,1,.0276135,0,0,1,.0276136,0,0,.999998,
.0276148,0,0,.999993,.0276201,0,0,.999976,.0276342,0,0,.999945,.027664,0,0,.999884,.0277179,0,1.8679E-4,.999784,.027806,0,.00119607,.99963,.0279394,0,.00318407,.999401,.0281295,0,.00613601,.999066,.0283858,0,.00999963,.998524,.0287027,0,.0147164,.995702,.0286256,0,.0202295,.993593,.0286733,0,.0264876,.992067,.0288989,0,.0334452,.990548,.0292135,0,.0410621,.986775,.0291296,0,.0493032,.984054,.0293099,0,.0581381,.979481,.0291881,0,.0675397,.975297,.0291598,0,.0774848,.96981,.028954,0,.0879528,.963524,
.028628,0,.0989258,.957398,.0283135,0,.110388,.950088,.0278469,0,.122327,.941538,.0271798,0,.134729,.933332,.0265388,0,.147587,.924392,.0257776,0,.160889,.914581,.024916,0,.174631,.904347,.0240242,0,.188806,.894324,.0231229,0,.203409,.883724,.022153,0,.218437,.872207,.0211355,0,.233888,.859927,.0201048,0,.249761,.848373,.0191263,0,.266056,.836023,.0181306,0,.282774,.82289,.0171718,0,.299917,.809324,.0162196,0,.317488,.795361,.0152622,0,.335493,.781253,.01439,0,.353936,.767338,.013533,0,.372825,.753156,
.0127244,0,.392168,.739122,.0119454,0,.411976,.725358,.0112054,0,.432259,.712949,.010487,0,.453032,.701621,.00984032,0,.47431,.689703,.00921495,0,.496111,.677216,.00862492,0,.518456,.664217,.00806882,0,.541367,.65137,.00755922,0,.564872,.638,.00705705,0,.589001,.62453,.00661266,0,.613789,.610601,.00618432,0,.639277,.59676,.00578033,0,.66551,.582433,.00540927,0,.692539,.568026,.00506104,0,.720422,.55414,.0047353,0,.749216,.540178,.00442889,0,.778974,.526513,.00414363,0,.809711,.512954,.00388237,0,
.84127,.499403,.00362875,0,.873016,.486026,.00340827,0,.904762,.472345,.00318598,0,.936508,.458828,.00297635,0,.968254,.445379,.00279447,0,1,1,.0345716,0,0,1,.0345717,0,0,.999999,.034573,0,0,.999991,.0345787,0,0,.999974,.0345941,0,0,.999937,.0346263,0,1.88589E-6,.999869,.0346847,0,4.09238E-4,.999757,.0347798,0,.0017674,.999582,.0349233,0,.00413658,.999322,.0351265,0,.00747408,.998939,.0353967,0,.0117157,.998219,.0357018,0,.0167966,.994974,.0354726,0,.0226572,.993201,.0355621,0,.0292445,.991573,.0357641,
0,.0365123,.989301,.0359252,0,.0444203,.985712,.0358017,0,.0529334,.982411,.0358353,0,.0620214,.977827,.035617,0,.0716574,.973278,.0354398,0,.0818186,.967397,.0350483,0,.0924846,.960696,.0344795,0,.103638,.954349,.0339861,0,.115263,.946066,.0331323,0,.127348,.938012,.032359,0,.13988,.929413,.0314413,0,.152849,.920355,.0304103,0,.166248,.910586,.0292785,0,.18007,.900609,.0281391,0,.194308,.890093,.0269103,0,.208958,.880013,.0257269,0,.224018,.869001,.0244671,0,.239485,.85751,.0232252,0,.255359,.84582,
.0220117,0,.271638,.834383,.0208274,0,.288324,.822158,.0196628,0,.305419,.809056,.0185306,0,.322927,.795832,.0174174,0,.340851,.782547,.0163758,0,.359199,.7689,.015391,0,.377975,.755526,.0144488,0,.397189,.741681,.0135372,0,.416851,.728178,.0126957,0,.436971,.714642,.0118812,0,.457564,.702756,.0111165,0,.478644,.69175,.0104145,0,.500229,.680159,.00974439,0,.522339,.668073,.00911926,0,.544997,.655405,.00851393,0,.56823,.642921,.00797637,0,.592068,.629993,.00745119,0,.616546,.616828,.00696972,0,.641705,
.603305,.00652425,0,.66759,.589833,.00610188,0,.694255,.575945,.00570834,0,.72176,.561745,.00533384,0,.750168,.548277,.00500001,0,.779545,.534467,.00467582,0,.809933,.521032,.00438092,0,.841272,.507877,.00410348,0,.873016,.494654,.00383618,0,.904762,.481592,.00358699,0,.936508,.468509,.00337281,0,.968254,.455293,.00316196,0,1,1,.0430698,0,0,1,.0430699,0,0,.999998,.0430713,0,0,.999991,.0430773,0,0,.99997,.0430936,0,0,.999928,.0431277,0,4.06396E-5,.999852,.0431893,0,7.44376E-4,.999724,.0432895,0,.0024806,
.999527,.0434397,0,.00524779,.99923,.0436507,0,.00898164,.998783,.0439255,0,.0136083,.997507,.0441104,0,.0190582,.994418,.0438225,0,.0252694,.992864,.0439396,0,.0321879,.991127,.0440962,0,.039767,.987331,.0438408,0,.0479667,.984819,.0438991,0,.056752,.980384,.0435906,0,.0660929,.975846,.0432543,0,.075963,.970748,.0428293,0,.0863398,.964303,.042153,0,.0972035,.95772,.0414111,0,.108537,.950747,.0405893,0,.120325,.942533,.0394887,0,.132554,.934045,.0383544,0,.145215,.924942,.037057,0,.158296,.915811,
.0356993,0,.17179,.90612,.0342401,0,.185691,.896434,.0328078,0,.199993,.886021,.031288,0,.214691,.876081,.0297776,0,.229782,.865608,.0282334,0,.245265,.854924,.026749,0,.261138,.843607,.02526,0,.277401,.832456,.0238214,0,.294056,.821342,.0224682,0,.311104,.809303,.0211297,0,.328548,.796468,.0198387,0,.346394,.784046,.0186227,0,.364645,.771262,.0174561,0,.38331,.758118,.0163806,0,.402396,.745075,.0153287,0,.421912,.731926,.0143647,0,.44187,.71863,.0134363,0,.462283,.705414,.0125603,0,.483165,.693792,
.0117508,0,.504535,.683108,.0110016,0,.52641,.67183,.0102757,0,.548816,.66015,.00962044,0,.571776,.647907,.00898031,0,.595323,.635734,.00840811,0,.619489,.623208,.00786211,0,.644317,.610438,.00734953,0,.669852,.597345,.00687688,0,.696148,.584138,.00643469,0,.723267,.5707,.00602236,0,.75128,.556966,.0056324,0,.780258,.543607,.00528277,0,.810268,.530213,.00493999,0,.841311,.516912,.00462265,0,.873016,.503916,.0043307,0,.904762,.491146,.00406858,0,.936508,.478439,.00381436,0,.968254,.465834,.00358003,
0,1,1,.0534039,0,0,1,.053404,0,0,.999998,.0534055,0,0,.999989,.0534116,0,0,.999968,.0534283,0,0,.999918,.0534633,0,1.55895E-4,.99983,.0535262,0,.00120914,.999685,.0536281,0,.00334944,.999461,.0537799,0,.00653077,.999119,.0539902,0,.0106718,.998582,.0542524,0,.0156907,.995919,.0540318,0,.0215147,.993735,.0538914,0,.0280801,.992126,.0539557,0,.0353323,.990266,.0540401,0,.0432247,.986317,.0536064,0,.0517172,.983213,.0534425,0,.0607754,.978303,.0528622,0,.0703698,.973665,.0523363,0,.0804742,.968091,.0516165,
0,.0910667,.961026,.0505434,0,.102128,.954333,.049523,0,.113641,.946372,.0481698,0,.125591,.938254,.0467674,0,.137965,.929516,.0452341,0,.150754,.920106,.0435083,0,.163947,.910899,.0417399,0,.177537,.901532,.0399389,0,.191516,.891919,.0380901,0,.205881,.882006,.0362341,0,.220626,.871965,.0343444,0,.235749,.862145,.0324832,0,.251248,.852058,.0306681,0,.267121,.84161,.0289097,0,.283368,.830806,.0272079,0,.299992,.820476,.0256089,0,.316992,.809514,.0240394,0,.334374,.797865,.0225379,0,.35214,.785621,
.0211235,0,.370296,.773765,.0197908,0,.388849,.761629,.0185235,0,.407807,.748891,.0173358,0,.427178,.736437,.0162305,0,.446974,.723707,.0151778,0,.467207,.710606,.0141791,0,.487892,.698019,.0132592,0,.509046,.686203,.0123887,0,.530687,.675692,.0115976,0,.552839,.664826,.0108325,0,.575527,.65349,.0101348,0,.59878,.641774,.00947756,0,.622634,.629794,.00886058,0,.647128,.617647,.00828526,0,.672308,.60534,.00775312,0,.698231,.592718,.00726033,0,.724958,.579746,.00679731,0,.752563,.566763,.00636111,0,
.781127,.553515,.00595228,0,.810733,.540118,.00556876,0,.841426,.527325,.00523051,0,.873016,.514265,.00490712,0,.904762,.501406,.00460297,0,.936508,.488922,.00431247,0,.968254,.476541,.0040472,0,1,1,.0659184,0,0,1,.0659185,0,0,.999998,.06592,0,0,.999988,.0659259,0,0,.999963,.0659423,0,0,.999907,.0659764,0,3.74198E-4,.999806,.0660376,0,.00182071,.999639,.0661361,0,.0043894,.999378,.0662814,0,.00800055,.998985,.0664779,0,.0125594,.998285,.0666914,0,.0179786,.995071,.0661989,0,.0241822,.993172,.0660454,
0,.031106,.991438,.0660105,0,.0386952,.988428,.0656875,0,.0469032,.985218,.0652913,0,.0556905,.981128,.0647107,0,.065023,.976015,.0638491,0,.0748717,.97097,.062993,0,.0852112,.964582,.0617927,0,.0960199,.957383,.0603626,0,.107279,.949969,.0588128,0,.118971,.941843,.0570274,0,.131084,.933624,.0551885,0,.143604,.924543,.053122,0,.156521,.914919,.0508897,0,.169825,.905773,.0486418,0,.18351,.896434,.0463364,0,.197569,.887195,.0440623,0,.211997,.877706,.0417799,0,.226789,.867719,.03945,0,.241944,.858587,
.037243,0,.257458,.849317,.0350956,0,.273331,.839585,.0329852,0,.289563,.829856,.0310028,0,.306154,.819589,.0290953,0,.323108,.809714,.0272738,0,.340426,.79934,.0255631,0,.358113,.788224,.0239175,0,.376175,.776619,.0223831,0,.394616,.76521,.0209298,0,.413445,.753716,.0195786,0,.432671,.741564,.0183001,0,.452305,.729413,.0171259,0,.472358,.717146,.0159933,0,.492845,.70436,.0149495,0,.513783,.69219,.0139681,0,.535189,.680289,.0130577,0,.557087,.669611,.0122198,0,.5795,.659113,.0114174,0,.602459,.648148,
.0106729,0,.625997,.636905,.00998997,0,.650154,.625154,.00934313,0,.674976,.613481,.00874839,0,.700518,.60154,.00818265,0,.726845,.58943,.00766889,0,.754032,.576828,.00717153,0,.782167,.564194,.00672696,0,.811344,.551501,.00630863,0,.841644,.538635,.00592177,0,.873016,.525724,.00554888,0,.904762,.513209,.00520225,0,.936508,.500457,.00488231,0,.968254,.48799,.00457153,0,1,1,.0810131,0,0,1,.0810133,0,0,.999997,.0810145,0,0,.999985,.08102,0,0,.999956,.0810347,0,1.95026E-5,.999893,.0810656,0,7.19316E-4,
.999777,.0811205,0,.00259774,.999583,.081208,0,.00561807,.999281,.0813343,0,.00967472,.998813,.0814969,0,.0146627,.997597,.0815217,0,.0204902,.994379,.0808502,0,.0270802,.992744,.0806792,0,.0343674,.990745,.0804589,0,.0422974,.986646,.0796107,0,.0508242,.983611,.0790913,0,.0599087,.978869,.0780746,0,.0695175,.973475,.0768218,0,.0796223,.967845,.0754926,0,.0901983,.960778,.0737063,0,.101224,.953333,.0718052,0,.112682,.945274,.0695946,0,.124555,.936955,.0672492,0,.136831,.928319,.0647732,0,.149496,
.919075,.0620947,0,.162542,.909114,.0591816,0,.175958,.900137,.0563917,0,.189739,.891069,.0535392,0,.203877,.882262,.0507642,0,.218368,.873232,.0479793,0,.233208,.864042,.045226,0,.248393,.855002,.0425413,0,.263923,.846569,.0400126,0,.279796,.837714,.0375269,0,.296012,.828918,.0352027,0,.312573,.819783,.0330011,0,.329479,.810129,.0308908,0,.346734,.800866,.0289112,0,.364342,.79093,.0270255,0,.382307,.780593,.0252758,0,.400637,.769511,.0236178,0,.419337,.758558,.0220652,0,.438418,.747632,.0206289,
0,.457889,.736146,.0192873,0,.477761,.724093,.0180333,0,.49805,.71234,.0168264,0,.51877,.700201,.015746,0,.53994,.687949,.0147027,0,.561581,.676163,.0137512,0,.583718,.665001,.0128655,0,.60638,.65472,.0120366,0,.629599,.644213,.0112604,0,.653415,.633382,.0105413,0,.677874,.62212,.00986498,0,.70303,.610631,.00923308,0,.728948,.599078,.00864206,0,.755706,.587519,.00811784,0,.783396,.575505,.00761237,0,.812121,.563148,.00713949,0,.841989,.550828,.00668379,0,.873035,.538458,.00627715,0,.904762,.525905,
.00588336,0,.936508,.513517,.00552687,0,.968254,.501395,.00519681,0,1,1,.0991506,0,0,1,.0991504,0,0,.999996,.0991515,0,0,.999984,.0991558,0,0,.999947,.0991672,0,1.14389E-4,.999874,.0991912,0,.00121503,.999739,.0992331,0,.00356108,.999514,.0992983,0,.00705578,.999159,.0993877,0,.011574,.998586,.0994837,0,.017003,.995731,.0988425,0,.0232484,.993384,.098276,0,.0302318,.991615,.0979269,0,.0378884,.989029,.0973432,0,.0461641,.985373,.0963539,0,.0550136,.981278,.0952306,0,.0643988,.975777,.0936233,0,.0742868,
.970526,.0920219,0,.0846501,.963755,.0898912,0,.0954644,.956676,.0876064,0,.106709,.948099,.0847751,0,.118367,.939718,.0818638,0,.130423,.931305,.078857,0,.142862,.922342,.0756127,0,.155674,.912842,.0721473,0,.168849,.903304,.0686195,0,.182378,.89411,.0650589,0,.196255,.885512,.0616022,0,.210473,.877193,.0582434,0,.225027,.86877,.0548979,0,.239915,.860267,.0516095,0,.255132,.851915,.048468,0,.270678,.843912,.0454447,0,.286551,.83604,.0425612,0,.302751,.828245,.0398752,0,.31928,.820159,.0373198,0,
.336138,.81167,.034916,0,.35333,.802659,.0326402,0,.370858,.793921,.0304901,0,.388728,.784713,.0284857,0,.406944,.774946,.0266186,0,.425515,.76448,.0248593,0,.444449,.753793,.0232114,0,.463756,.743506,.0217039,0,.483447,.732555,.0202841,0,.503535,.720965,.0189648,0,.524036,.709422,.0177189,0,.544968,.697756,.0165626,0,.56635,.685565,.015483,0,.588208,.673987,.0144892,0,.610569,.66244,.0135607,0,.633466,.651675,.0126956,0,.656936,.641598,.0118788,0,.681025,.63121,.0111261,0,.705788,.620514,.010437,
0,.731289,.609366,.00978747,0,.757606,.598137,.00917257,0,.784834,.586966,.00859778,0,.813085,.575549,.00806803,0,.842485,.563797,.00757294,0,.87313,.551758,.00710592,0,.904762,.539894,.0066841,0,.936508,.527901,.00627901,0,.968254,.515819,.00590506,0,1,1,.120864,0,0,1,.120864,0,0,.999996,.120864,0,0,.99998,.120867,0,0,.99994,.120872,0,3.23781E-4,.999852,.120884,0,.00188693,.999693,.120903,0,.00473489,.999426,.120929,0,.00872704,.999002,.120955,0,.0137237,.998235,.120918,0,.0196068,.994608,.119764,
0,.0262803,.992997,.119265,0,.0336657,.990968,.11863,0,.0416987,.987002,.117261,0,.0503261,.983524,.116009,0,.0595035,.97875,.114252,0,.0691935,.972652,.11193,0,.0793645,.966613,.109555,0,.0899894,.959275,.106612,0,.101045,.951272,.103375,0,.112512,.942323,.0996594,0,.124372,.933679,.0958841,0,.136611,.924822,.0919265,0,.149216,.915742,.0878061,0,.162176,.906348,.0834894,0,.175482,.896883,.079085,0,.189125,.88774,.0746745,0,.203098,.87986,.0705773,0,.217396,.871998,.0665005,0,.232015,.864325,.0625413,
0,.24695,.856685,.0586781,0,.2622,.84925,.0550063,0,.277761,.841719,.0514727,0,.293634,.834755,.0481398,0,.309819,.827853,.0450172,0,.326315,.820888,.0420969,0,.343126,.813616,.0393702,0,.360254,.805767,.0367771,0,.377701,.797338,.0343274,0,.395474,.789122,.0320529,0,.413577,.780601,.0299485,0,.432018,.771424,.0279812,0,.450804,.761502,.0261054,0,.469944,.751166,.0243942,0,.489451,.741276,.0228087,0,.509337,.730898,.0213265,0,.529617,.719878,.0199307,0,.550307,.708379,.0186574,0,.571428,.697165,.0174446,
0,.593003,.685554,.0163144,0,.615059,.673631,.015276,0,.637628,.662385,.0143003,0,.660746,.651059,.0134112,0,.68446,.640451,.0125794,0,.70882,.630536,.011793,0,.733893,.620316,.0110547,0,.759756,.609722,.0103668,0,.786505,.598804,.00973009,0,.814259,.587871,.00912812,0,.843157,.577121,.00858916,0,.87334,.566019,.00807333,0,.904762,.554664,.00759687,0,.936508,.543101,.00714759,0,.968254,.531558,.00673418,0,1,1,.146767,0,0,1,.146767,0,0,.999997,.146767,0,0,.999977,.146765,0,3.20658E-6,.999929,.146762,
0,6.82576E-4,.999823,.146753,0,.00276402,.999633,.146735,0,.00614771,.999314,.146699,0,.0106613,.998796,.14662,0,.0161546,.997124,.146107,0,.0225063,.994062,.144857,0,.0296198,.992154,.144011,0,.037417,.989186,.142712,0,.0458348,.985279,.140926,0,.0548211,.980826,.13885,0,.0643326,.975056,.136168,0,.074333,.969005,.133217,0,.0847917,.961554,.12959,0,.0956828,.954206,.125886,0,.106984,.945046,.121335,0,.118675,.935678,.116492,0,.130741,.926748,.111635,0,.143166,.917764,.106625,0,.155939,.908358,.101325,
0,.169049,.899219,.0960249,0,.182487,.890089,.0906527,0,.196245,.881488,.0853905,0,.210317,.874031,.0804177,0,.224697,.866932,.0756005,0,.23938,.859976,.0709019,0,.254364,.853375,.0664391,0,.269646,.846971,.0622012,0,.285223,.840483,.058129,0,.301096,.833969,.0542762,0,.317265,.82806,.0507042,0,.333729,.822128,.047368,0,.350491,.815989,.044272,0,.367554,.809336,.0413444,0,.38492,.802177,.038601,0,.402594,.79441,.0360227,0,.420582,.786573,.0336383,0,.438891,.778619,.0314321,0,.457527,.77,.029362,0,
.476499,.760698,.0274102,0,.49582,.750932,.0256146,0,.5155,.740993,.023974,0,.535555,.731159,.0224182,0,.556,.720836,.0209889,0,.576855,.709913,.0196411,0,.598143,.698415,.0183824,0,.619888,.68745,.0172222,0,.642123,.676154,.0161509,0,.664883,.664383,.0151397,0,.688211,.6533,.0141873,0,.71216,.642072,.0133105,0,.736792,.631412,.0124932,0,.762186,.621622,.0117408,0,.788439,.611681,.0110358,0,.815672,.60142,.0103775,0,.844034,.59083,.00975623,0,.873699,.580254,.00918084,0,.904765,.569841,.00864721,
0,.936508,.559224,.00815731,0,.968254,.548315,.00767924,0,1,1,.177563,0,0,1,.177563,0,0,.999994,.177562,0,0,.999972,.177555,0,6.64171E-5,.999914,.177536,0,.0012276,.999787,.177496,0,.00388025,.999556,.17742,0,.00783463,.999165,.177285,0,.0128953,.9985,.177037,0,.0189053,.995388,.175634,0,.025742,.993102,.174375,0,.033309,.990992,.173121,0,.0415298,.986932,.170896,0,.0503425,.982786,.16847,0,.0596964,.977592,.165455,0,.0695498,.971075,.161676,0,.0798676,.963967,.157458,0,.0906201,.956397,.152836,0,
.101783,.947489,.147467,0,.113333,.937564,.14145,0,.125254,.928182,.135383,0,.137529,.919027,.129212,0,.150144,.909618,.12276,0,.163088,.900492,.116273,0,.176351,.891671,.1098,0,.189924,.883146,.103362,0,.203799,.875151,.0970799,0,.21797,.868338,.0911732,0,.232433,.862033,.0854966,0,.247182,.856107,.0800691,0,.262216,.850644,.0749618,0,.27753,.845261,.070079,0,.293124,.839885,.0654321,0,.308997,.834609,.0610975,0,.325149,.829083,.0569741,0,.341581,.82404,.0531736,0,.358294,.818968,.049665,0,.37529,
.813496,.0463856,0,.392573,.807533,.0433217,0,.410148,.80099,.0404402,0,.428019,.793891,.0377578,0,.446192,.786281,.0352616,0,.464676,.778773,.0329577,0,.483478,.770737,.030808,0,.502608,.762094,.0287964,0,.522079,.752898,.0269254,0,.541905,.743306,.0251926,0,.5621,.733416,.023595,0,.582684,.723742,.0221155,0,.603677,.713542,.0207435,0,.625106,.702755,.019434,0,.646998,.691484,.0182046,0,.66939,.680531,.0170771,0,.692324,.66953,.0160339,0,.715849,.658126,.0150677,0,.740028,.646933,.0141551,0,.764937,
.636107,.0133179,0,.790673,.625271,.0125284,0,.817358,.615225,.0117937,0,.84515,.605678,.0111181,0,.874244,.59583,.0104759,0,.904828,.585704,.00986672,0,.936508,.575413,.00929712,0,.968254,.565373,.00876713,0,1,1,.214058,0,0,.999999,.214058,0,0,.999994,.214055,0,0,.999966,.214039,0,2.59642E-4,.999893,.213998,0,.00200075,.999737,.21391,0,.00527775,.999449,.213745,0,.00983959,.99896,.213458,0,.0154755,.9979,.212855,0,.0220249,.994278,.210779,0,.0293654,.992254,.20926,0,.0374021,.98881,.206908,0,.0460604,
.984715,.204009,0,.0552802,.979738,.200471,0,.0650127,.972884,.195813,0,.0752175,.965996,.190856,0,.0858612,.957974,.185077,0,.0969155,.949155,.17868,0,.108356,.939288,.171513,0,.120163,.928996,.163838,0,.132319,.919563,.156246,0,.144808,.910004,.148359,0,.157618,.900791,.140417,0,.170737,.892135,.132569,0,.184155,.883803,.124741,0,.197866,.876034,.117091,0,.211861,.869219,.109835,0,.226134,.863062,.102859,0,.240682,.857795,.0962928,0,.255499,.853009,.0900725,0,.270583,.848603,.0842101,0,.285931,
.844335,.0786527,0,.301542,.840208,.0734397,0,.317415,.836035,.0685334,0,.33355,.83172,.0639275,0,.349948,.827135,.0595909,0,.36661,.822797,.0556204,0,.383539,.818387,.0519394,0,.400738,.813565,.0485317,0,.41821,.808142,.0453138,0,.435961,.802212,.0423354,0,.453997,.79573,.0395553,0,.472324,.788741,.036988,0,.490951,.781093,.0345688,0,.509887,.773597,.0323297,0,.529144,.765622,.0302719,0,.548735,.757083,.0283477,0,.568674,.747992,.0265562,0,.588979,.738591,.0248844,0,.609671,.728719,.0233342,0,.630773,
.719146,.0219081,0,.652314,.709165,.0205711,0,.674328,.69875,.0193248,0,.696854,.687884,.0181582,0,.719942,.676818,.0170746,0,.743651,.666247,.0160718,0,.768057,.655284,.0151262,0,.793253,.64401,.0142561,0,.819363,.633353,.0134327,0,.846547,.622674,.012653,0,.875017,.612265,.0119354,0,.905021,.602455,.0112533,0,.936508,.593147,.0106234,0,.968254,.583592,.0100213,0,1,1,.25717,0,0,1,.25717,0,0,.999992,.257164,0,0,.999958,.257135,0,6.41715E-4,.999864,.25706,0,.00305314,.999666,.256897,0,.00700975,.999302,
.256596,0,.0122194,.998663,.25607,0,.0184622,.995607,.254123,0,.0255773,.993094,.252081,0,.0334439,.9907,.249867,0,.0419696,.98594,.246118,0,.0510823,.981214,.242049,0,.0607242,.974966,.236869,0,.0708486,.967589,.230724,0,.081417,.95915,.223635,0,.0923974,.950257,.21596,0,.103763,.940165,.207296,0,.115491,.929396,.197901,0,.127562,.919288,.188437,0,.13996,.909428,.178762,0,.15267,.900105,.169072,0,.165679,.891418,.159478,0,.178979,.883347,.15002,0,.192558,.875992,.140813,0,.20641,.869466,.13196,0,
.220529,.863699,.123501,0,.234907,.858553,.115436,0,.249542,.854379,.107901,0,.264428,.850894,.10088,0,.279564,.847632,.0942296,0,.294947,.844571,.0879861,0,.310575,.84163,.0821534,0,.326448,.838542,.0766409,0,.342566,.835412,.0715322,0,.358929,.831899,.0666883,0,.37554,.828177,.0622175,0,.392399,.82416,.0580452,0,.409511,.820393,.054267,0,.426878,.816068,.0507172,0,.444506,.811201,.0474041,0,.4624,.805785,.0443174,0,.480566,.799878,.0414562,0,.499013,.793469,.0388147,0,.517749,.786473,.0363453,0,
.536785,.778874,.0340225,0,.556134,.771277,.0318599,0,.575809,.763426,.0298859,0,.595827,.755044,.0280357,0,.616207,.746161,.0262979,0,.636973,.737124,.0247295,0,.65815,.72761,.0232514,0,.679772,.717822,.0218755,0,.701876,.708279,.0205942,0,.724509,.698333,.0193947,0,.74773,.68802,.0182717,0,.771609,.677321,.0172044,0,.79624,.666504,.0162122,0,.821743,.656184,.0152924,0,.84828,.64556,.0144326,0,.876069,.634636,.0136157,0,.905404,.624124,.0128612,0,.936508,.613914,.0121435,0,.968254,.603589,.0114887,
0,1,1,.307946,0,0,.999999,.307945,0,0,.999988,.307934,0,2.04479E-5,.999944,.307886,0,.00127833,.999824,.307756,0,.00445047,.999565,.30748,0,.00914673,.999085,.306966,0,.0150498,.998103,.306004,0,.0219367,.994249,.303028,0,.0296485,.991807,.300435,0,.038068,.987773,.296554,0,.0471062,.982673,.2916,0,.0566942,.976623,.285641,0,.0667768,.968757,.27815,0,.0773099,.959849,.269529,0,.088257,.950663,.260248,0,.0995879,.940129,.249704,0,.111277,.92895,.238291,0,.123304,.917996,.226501,0,.13565,.907813,.214669,
0,.148299,.898305,.202835,0,.161237,.889626,.191158,0,.174455,.88175,.179695,0,.187941,.874715,.168548,0,.201687,.868746,.15792,0,.215687,.863703,.147807,0,.229933,.859315,.138149,0,.24442,.855538,.128993,0,.259145,.852428,.120414,0,.274103,.850168,.112498,0,.289293,.848132,.105054,0,.304711,.846291,.0981087,0,.320357,.844431,.0915942,0,.33623,.842493,.0855056,0,.35233,.840368,.0798204,0,.368658,.83798,.0745097,0,.385214,.83523,.0695424,0,.402002,.832091,.0649092,0,.419023,.828667,.0606291,0,.436282,
.824805,.0566523,0,.453782,.820988,.0530229,0,.471529,.816635,.0496364,0,.489528,.811725,.0464658,0,.507788,.806316,.0435082,0,.526317,.800469,.0407873,0,.545124,.794107,.038255,0,.564221,.787218,.0358825,0,.583621,.779872,.0336785,0,.603341,.772097,.0316379,0,.623397,.764484,.0297379,0,.643812,.756428,.0279581,0,.664611,.748022,.0263153,0,.685824,.739268,.0247799,0,.707488,.73024,.0233385,0,.729646,.720893,.0220035,0,.752354,.71119,.0207555,0,.77568,.701791,.0195843,0,.799715,.692184,.0184891,0,
.824574,.682258,.0174541,0,.850417,.67206,.0164873,0,.877466,.661717,.0155959,0,.90604,.651462,.0147519,0,.936528,.641467,.0139727,0,.968254,.631229,.0132363,0,1,1,.367573,0,0,.999999,.367571,0,0,.999984,.367553,0,1.83382E-4,.999925,.367473,0,.00225254,.999759,.367259,0,.00628165,.99941,.366801,0,.0117858,.998739,.365946,0,.0184359,.995529,.363191,0,.0260114,.992875,.360171,0,.0343581,.989135,.355981,0,.0433637,.984166,.350401,0,.0529438,.977871,.343348,0,.0630334,.96951,.334341,0,.0735805,.959964,
.323862,0,.0845437,.950162,.312521,0,.095889,.938882,.299577,0,.107588,.926992,.285573,0,.119617,.915589,.271212,0,.131957,.904791,.256611,0,.144591,.895177,.242224,0,.157503,.886403,.227952,0,.170682,.878957,.214192,0,.184117,.872418,.200795,0,.197799,.867029,.188015,0,.21172,.862835,.175975,0,.225873,.859411,.164526,0,.240253,.856655,.153693,0,.254854,.854519,.14352,0,.269673,.852828,.13397,0,.284707,.851412,.124984,0,.299953,.850609,.116748,0,.315408,.849855,.10905,0,.331073,.849017,.101839,0,
.346946,.848079,.0951359,0,.363028,.846911,.0888774,0,.379318,.845445,.0830375,0,.395818,.84362,.0775844,0,.41253,.841411,.0725054,0,.429457,.838768,.0677691,0,.446602,.835801,.0634016,0,.463968,.832341,.0593095,0,.481561,.828424,.0555121,0,.499386,.824312,.052024,0,.51745,.819918,.0487865,0,.535761,.815072,.0457801,0,.554328,.809863,.0430184,0,.573162,.804164,.0404245,0,.592275,.798034,.0380146,0,.611681,.791436,.0357436,0,.631398,.784498,.0336475,0,.651445,.777125,.0316666,0,.671845,.769365,.0298122,
0,.692628,.761579,.0281001,0,.713827,.753746,.0265049,0,.735484,.745573,.0250067,0,.75765,.737083,.0236026,0,.78039,.728545,.0223302,0,.803789,.719691,.0211243,0,.82796,.710569,.0199983,0,.853056,.701216,.0189569,0,.879298,.692094,.0179702,0,.907014,.682909,.0170418,0,.936691,.673509,.0161732,0,.968254,.663863,.0153406,0,1,1,.437395,0,0,.999998,.437394,0,0,.99998,.437363,0,6.16704E-4,.999891,.437232,0,.00367925,.999656,.436877,0,.00867446,.999148,.436121,0,.0150679,.997959,.434564,0,.022531,.993464,
.430134,0,.0308507,.990606,.426077,0,.0398805,.985027,.419397,0,.0495148,.978491,.41118,0,.0596749,.969643,.40048,0,.0703001,.959189,.38769,0,.0813427,.948223,.373575,0,.0927641,.935955,.357622,0,.104533,.923237,.34043,0,.116624,.911074,.322735,0,.129015,.899724,.30479,0,.141687,.890189,.287392,0,.154626,.881796,.270248,0,.167818,.874781,.253659,0,.181252,.869166,.237786,0,.194918,.864725,.222618,0,.208807,.861565,.208356,0,.222913,.859284,.194867,0,.237229,.857677,.18212,0,.25175,.856714,.17018,
0,.266473,.856155,.158969,0,.281392,.8558,.148413,0,.296505,.855672,.138578,0,.311811,.855538,.129345,0,.327306,.855689,.120861,0,.342991,.855767,.112969,0,.358864,.855618,.105593,0,.374925,.85525,.0987451,0,.391176,.854583,.0923727,0,.407616,.853534,.0864143,0,.424249,.852061,.0808338,0,.441076,.850253,.0756771,0,.4581,.848004,.0708612,0,.475324,.845333,.0663784,0,.492754,.842376,.0622631,0,.510394,.838956,.0584112,0,.528251,.835121,.0548328,0,.546331,.830842,.0514838,0,.564644,.826212,.048355,0,
.583198,.821522,.0454714,0,.602005,.816551,.0428263,0,.621078,.811211,.0403612,0,.640434,.805479,.038039,0,.660089,.799409,.0358739,0,.680066,.79306,.0338727,0,.70039,.786395,.0319985,0,.721094,.779416,.030241,0,.742215,.77214,.0285951,0,.7638,.764636,.0270747,0,.785912,.756836,.0256354,0,.808628,.749315,.0243027,0,.832055,.741561,.0230497,0,.856338,.733589,.0218801,0,.88169,.725479,.020784,0,.908441,.717255,.0197702,0,.937125,.708829,.0188168,0,.968254,.700191,.0179113,0,1,1,.518937,0,0,.999998,
.518933,0,0,.999967,.518883,0,.00147741,.999832,.51866,0,.00573221,.999466,.518057,0,.011826,.998644,.516752,0,.0192116,.994458,.512347,0,.027573,.991223,.507675,0,.0367099,.985515,.500188,0,.046487,.978308,.490408,0,.0568071,.968359,.477357,0,.0675984,.95682,.461752,0,.0788059,.943929,.443796,0,.090386,.930224,.423893,0,.102304,.916514,.402682,0,.114532,.903653,.380914,0,.127047,.892315,.359212,0,.139828,.882942,.338102,0,.152861,.875438,.31773,0,.16613,.869642,.298186,0,.179624,.865304,.279491,
0,.193332,.862382,.261804,0,.207247,.860666,.245146,0,.22136,.859788,.229406,0,.235666,.859608,.214605,0,.250158,.859912,.200691,0,.264832,.86053,.187623,0,.279684,.861368,.17539,0,.294711,.862237,.163901,0,.309911,.863127,.153175,0,.32528,.863923,.143147,0,.340819,.864567,.133781,0,.356524,.865013,.125042,0,.372397,.86539,.116952,0,.388438,.865591,.109476,0,.404645,.865517,.102542,0,.421022,.865084,.0960688,0,.437569,.864309,.0900499,0,.454287,.863151,.0844328,0,.471181,.861649,.0792218,0,.488253,
.859742,.0743482,0,.505507,.857446,.0697963,0,.522947,.854757,.0655364,0,.54058,.851783,.061608,0,.558412,.848516,.0579701,0,.576449,.844897,.0545742,0,.594701,.840956,.0514167,0,.613178,.836676,.0484598,0,.631892,.832075,.0456934,0,.650856,.827191,.0431178,0,.670088,.822295,.0407718,0,.689606,.817294,.0386032,0,.709434,.812013,.0365675,0,.7296,.806465,.0346547,0,.750138,.800691,.0328717,0,.771093,.794709,.031211,0,.792519,.788493,.0296504,0,.814488,.782049,.0281782,0,.837097,.775403,.0267965,0,.860481,
.76857,.0255002,0,.884842,.761536,.0242759,0,.910494,.754303,.0231142,0,.937985,.74692,.0220305,0,.968254,.739745,.0210192,0,1,1,.613914,0,0,.999996,.613907,0,9.63597E-5,.999942,.613814,0,.00301247,.999704,.613407,0,.00870385,.999046,.612302,0,.0160714,.995516,.608266,0,.0245899,.991726,.602863,0,.0339681,.985157,.593956,0,.0440254,.97642,.581748,0,.0546409,.964404,.565183,0,.0657284,.950601,.545273,0,.0772246,.935158,.522129,0,.0890812,.919364,.496782,0,.10126,.904754,.470571,0,.113731,.89176,.444037,
0,.126469,.881492,.418322,0,.139454,.873656,.393522,0,.15267,.868053,.369795,0,.166101,.864336,.347171,0,.179736,.862259,.325737,0,.193565,.861556,.305532,0,.207578,.861776,.286416,0,.221769,.862661,.268355,0,.23613,.864015,.251334,0,.250656,.865711,.235352,0,.265343,.867519,.220302,0,.280187,.869351,.206161,0,.295183,.871144,.192908,0,.31033,.872839,.180505,0,.325624,.874307,.168848,0,.341065,.875667,.158021,0,.35665,.876758,.147877,0,.37238,.87764,.138441,0,.388253,.878237,.129627,0,.404269,.878563,
.121415,0,.42043,.878572,.113741,0,.436735,.87842,.106652,0,.453187,.878057,.100097,0,.469786,.877413,.0940128,0,.486536,.87646,.0883462,0,.503439,.875233,.0830924,0,.520498,.8737,.0781975,0,.537717,.871873,.07364,0,.555102,.86978,.0694103,0,.572657,.867405,.0654696,0,.59039,.864751,.0617914,0,.608307,.861818,.0583491,0,.626419,.858645,.0551443,0,.644733,.855307,.0521894,0,.663264,.851736,.0494334,0,.682025,.847927,.0468504,0,.701032,.843888,.0444261,0,.720308,.839629,.0421497,0,.739875,.835158,.0400082,
0,.759764,.830509,.0380076,0,.780014,.825714,.0361488,0,.800673,.820729,.0343956,0,.821803,.815751,.0327781,0,.843492,.810752,.031275,0,.86586,.805587,.0298542,0,.889087,.800317,.0285397,0,.913466,.79489,.0272948,0,.93952,.789314,.0261139,0,.96835,.783593,.0249938,0,1,1,.724258,0,0,.999992,.724243,0,7.26889E-4,.99987,.724044,0,.00569574,.999336,.72317,0,.0131702,.996271,.719432,0,.0220738,.991159,.712576,0,.0319405,.982465,.700927,0,.0425202,.97049,.684297,0,.0536599,.953973,.661244,0,.065258,.935546,
.633804,0,.0772427,.916596,.603071,0,.0895616,.899353,.57105,0,.102175,.885216,.539206,0,.11505,.875076,.508714,0,.128164,.868334,.479571,0,.141495,.864414,.451796,0,.155026,.862678,.425328,0,.168745,.862835,.400352,0,.182639,.864067,.376532,0,.196699,.866086,.35391,0,.210915,.868557,.332424,0,.225282,.871271,.312053,0,.239792,.874058,.292764,0,.25444,.8768,.27453,0,.269223,.87939,.257297,0,.284135,.8819,.24114,0,.299174,.884187,.225934,0,.314337,.886262,.211669,0,.329622,.888119,.198311,0,.345026,
.889709,.185783,0,.360549,.891054,.174063,0,.376189,.892196,.163143,0,.391946,.893101,.152952,0,.407819,.893803,.143475,0,.423808,.894277,.134647,0,.439914,.894532,.126434,0,.456137,.894576,.1188,0,.472479,.894393,.111694,0,.48894,.893976,.105069,0,.505523,.893346,.0989077,0,.52223,.892502,.0931724,0,.539064,.891441,.0878276,0,.556028,.890276,.082903,0,.573125,.888972,.0783505,0,.590361,.887469,.0741083,0,.607741,.885785,.0701633,0,.62527,.883914,.0664835,0,.642957,.881872,.0630567,0,.660809,.879651,
.0598527,0,.678836,.877267,.0568615,0,.69705,.874717,.05406,0,.715465,.872012,.0514378,0,.734098,.869157,.0489805,0,.752968,.866155,.0466727,0,.772101,.863014,.0445056,0,.791529,.859748,.0424733,0,.81129,.856416,.0405957,0,.831438,.852958,.0388273,0,.852044,.849382,.0371619,0,.87321,.845694,.0355959,0,.89509,.841893,.0341155,0,.917932,.837981,.0327141,0,.942204,.833963,.0313856,0,.968981,.829847,.0301275,0,1,1,.85214,0,0,.999969,.852095,0,.00279627,.999483,.851408,0,.0107635,.994545,.84579,0,.0206454,
.986188,.835231,0,.0315756,.969847,.814687,0,.0432021,.945951,.783735,0,.0553396,.91917,.746074,0,.0678766,.895488,.706938,0,.0807395,.878232,.669534,0,.0938767,.868252,.635168,0,.10725,.863873,.603069,0,.120832,.863369,.572514,0,.134598,.86545,.543169,0,.148533,.868803,.514578,0,.16262,.872794,.486762,0,.176849,.87702,.459811,0,.19121,.881054,.433654,0,.205694,.884974,.408574,0,.220294,.888587,.384525,0,.235005,.891877,.36156,0,.24982,.894793,.339661,0,.264737,.89743,.318913,0,.279751,.899796,.299302,
0,.294859,.901943,.280843,0,.310058,.903858,.263481,0,.325346,.905574,.247197,0,.340721,.907069,.231915,0,.356181,.908379,.217614,0,.371725,.90952,.20425,0,.387353,.910483,.191758,0,.403063,.91128,.180092,0,.418854,.911936,.169222,0,.434727,.912454,.159098,0,.450682,.912835,.149668,0,.466718,.913078,.140884,0,.482837,.913192,.132709,0,.499038,.913175,.125095,0,.515324,.91304,.118012,0,.531695,.912781,.111417,0,.548153,.91241,.105281,0,.5647,.911924,.0995691,0,.581338,.911331,.0942531,0,.59807,.910637,
.0893076,0,.6149,.90984,.0846998,0,.63183,.908941,.0804044,0,.648865,.907944,.0763984,0,.666011,.906857,.0726638,0,.683273,.90568,.0691783,0,.700659,.904416,.0659222,0,.718176,.903067,.0628782,0,.735834,.901637,.0600307,0,.753646,.900128,.0573647,0,.771625,.898544,.0548668,0,.78979,.89689,.052527,0,.808162,.895165,.0503306,0,.826771,.893371,.0482668,0,.845654,.891572,.0463605,0,.864863,.889763,.0445998,0,.884472,.887894,.0429451,0,.904592,.885967,.0413884,0,.925407,.883984,.0399225,0,.947271,.881945,
.0385405,0,.97105,.879854,.0372362,0,1,.999804,.995833,0,0,.938155,.933611,0,.0158731,.864755,.854311,0,.0317461,.888594,.865264,0,.0476191,.905575,.863922,0,.0634921,.915125,.850558,0,.0793651,.920665,.829254,0,.0952381,.924073,.802578,0,.111111,.926304,.772211,0,.126984,.927829,.739366,0,.142857,.928924,.705033,0,.15873,.92973,.670019,0,.174603,.930339,.634993,0,.190476,.930811,.600485,0,.206349,.931191,.566897,0,.222222,.93149,.534485,0,.238095,.931737,.503429,0,.253968,.931939,.473811,0,.269841,
.932108,.445668,0,.285714,.93225,.418993,0,.301587,.932371,.393762,0,.31746,.932474,.369939,0,.333333,.932562,.347479,0,.349206,.932638,.326336,0,.365079,.932703,.306462,0,.380952,.93276,.287805,0,.396825,.932809,.270313,0,.412698,.932851,.253933,0,.428571,.932887,.23861,0,.444444,.932917,.224289,0,.460317,.932943,.210917,0,.47619,.932965,.19844,0,.492063,.932982,.186807,0,.507937,.932995,.175966,0,.52381,.933005,.165869,0,.539683,.933011,.156468,0,.555556,.933013,.147719,0,.571429,.933013,.139579,
0,.587302,.93301,.132007,0,.603175,.933004,.124965,0,.619048,.932994,.118416,0,.634921,.932982,.112326,0,.650794,.932968,.106663,0,.666667,.93295,.101397,0,.68254,.932931,.0964993,0,.698413,.932908,.0919438,0,.714286,.932883,.0877057,0,.730159,.932856,.0837623,0,.746032,.932827,.0800921,0,.761905,.932796,.0766754,0,.777778,.932762,.0734936,0,.793651,.932727,.0705296,0,.809524,.932689,.0677676,0,.825397,.93265,.0651929,0,.84127,.932609,.0627917,0,.857143,.932565,.0605515,0,.873016,.932521,.0584606,
0,.888889,.932474,.0565082,0,.904762,.932427,.0546841,0,.920635,.932377,.0529793,0,.936508,.932326,.0513851,0,.952381,.932274,.0498936,0,.968254,.93222,.0484975,0,.984127,.932164,.0471899,0,1]),64,64,THREE.RGBAFormat,THREE.FloatType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.LinearFilter,THREE.NearestFilter,1);THREE.UniformsLib.LTC_1=a;THREE.UniformsLib.LTC_2=e;a={ltc_1:{value:null},ltc_2:{value:null}};Object.assign(THREE.ShaderLib.standard.uniforms,a);Object.assign(THREE.ShaderLib.physical.uniforms,
a)}}
class TouchPanner{constructor(){this.isTouching=!1;this.rotateStart=new THREE.Vector2;this.rotateEnd=new THREE.Vector2;this.rotateDelta=new THREE.Vector2;this.theta=0;this.orientation=new THREE.Quaternion}getOrientation(){this.orientation.setFromEuler(new THREE.Euler(0,0,this.theta,"XYZ"));return this.orientation}getTheta(){return this.theta}resetWithOffset(a){this.theta=a}resetSensor(){this.theta=0}connect(){window.addEventListener("touchstart",this.onTouchStart.bind(this));window.addEventListener("touchmove",this.onTouchMove.bind(this));
window.addEventListener("touchend",this.onTouchEnd.bind(this))}disconnect(){window.removeEventListener("touchstart",this.onTouchStart.bind(this));window.removeEventListener("touchmove",this.onTouchMove.bind(this));window.removeEventListener("touchend",this.onTouchEnd.bind(this))}onTouchStart(a){1==a.touches.length&&(this.rotateStart.set(a.touches[0].pageX,a.touches[0].pageY),this.isTouching=!0)}onTouchMove(a){this.isTouching&&(this.rotateEnd.set(a.touches[0].pageX,a.touches[0].pageY),this.rotateDelta.subVectors(this.rotateEnd,
this.rotateStart),this.rotateStart.copy(this.rotateEnd),this.theta+=2*Math.PI*this.rotateDelta.x/document.body.clientWidth*TouchPanner.ROTATE_SPEED)}onTouchEnd(){this.isTouching=!1}}TouchPanner.ROTATE_SPEED=.5;
class BaseDeviceController{constructor(){this._alphaOffset=0;this._deviceOrientation={};this._screenOrientation=0;this._enabled=!1;this.onDeviceOrientationChangeEvent=a=>{this._deviceOrientation=a};this.onScreenOrientationChangeEvent=()=>{let a=0;if(window.orientation)a=window.orientation;else if(window.screen&&window.screen.orientation){let e=window.screen.orientation;/landscape/.test(e.type)&&!e.angle&&(a=90)}this._screenOrientation=a};this._target=new THREE.Vector3;this._camera=View3D.inst.camera;
this.touchPanner=new TouchPanner}reset(){}forceOrientation(a){this._screenOrientation=a;Config.SCREEN_ORIENTATION=parseInt(this._screenOrientation)}connect(){this.touchPanner.connect();this.onScreenOrientationChangeEvent();"undefined"!=typeof DeviceOrientationEvent&&"function"===typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(a=>{"granted"===a&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent,!1),window.addEventListener("deviceorientation",
this.onDeviceOrientationChangeEvent,!1))}).catch(console.error):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent,!1),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent,!1));Config.LAUNCH_FROM_SPHERE_COMPANION&&(this._screenOrientation=Config.SCREEN_ORIENTATION);this._enabled=!0}disconnect(){this.touchPanner.disconnect();window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent,!1);window.removeEventListener("deviceorientation",
this.onDeviceOrientationChangeEvent,!1);this._enabled=!1}update(){if(this._enabled){var a=this._deviceOrientation.alpha?THREE.MathUtils.degToRad(this._deviceOrientation.alpha)+this._alphaOffset:0,e=this._deviceOrientation.beta?THREE.MathUtils.degToRad(this._deviceOrientation.beta):0,h=this._deviceOrientation.gamma?THREE.MathUtils.degToRad(this._deviceOrientation.gamma):0,m=this._screenOrientation?THREE.MathUtils.degToRad(this._screenOrientation):0;this.setObjectQuaternion(this._camera.quaternion,
a,e,h,m)}}changeOffsetAngle(a){this.touchPanner.resetWithOffset(a)}setTarget(a){this._target=a}getTarget(){return this._target}setMaxFOV(a){}setObjectQuaternion(a,e,h,m,t){let y=new THREE.Vector3(0,0,1),C=new THREE.Euler,I=new THREE.Quaternion,E=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5));C.set(h,e+this.touchPanner.getTheta(),-m,"YXZ");a.setFromEuler(C);a.multiply(E);a.multiply(I.setFromAxisAngle(y,-t))}}
class OrbitalController extends THREE.EventDispatcher{constructor(){super();this.uuid="orbit_control";this.enabled=!0;this.reversed=!1;this._keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};this._states={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5};this._noZoom=!1;this._zoomSpeed=2;this._smoothFactor=1.5;this._minDistance=20;this._maxDistance=Infinity;this._noKeys=!1;this._noPan=!0;this._panSpeed=1;this._keyPanSpeed=7;this._autoRotate=!1;this._rotateSpeed=.2;this._autoRotateSpeed=
2;this._minPolarAngle=0;this._maxPolarAngle=Math.PI;this._minAzimuthAngle=-Infinity;this._maxAzimuthAngle=Infinity;this._EPS=1E-6;this._disconnected=!1;this._rotateDelta=new THREE.Vector2;this._panStart=new THREE.Vector2;this._panDelta=new THREE.Vector2;this._panOffset=new THREE.Vector3;this._offset=new THREE.Vector3;this._thetaDelta=this._phiDelta=this._previousDistance=0;this._scale=1;this._panVector=new THREE.Vector3;this._rotatePreDividedValue=2*Math.PI/60/60;this._autoRotationAngle=this._rotatePreDividedValue*
this._autoRotateSpeed;this._lastPosition=new THREE.Vector3;this._lastQuaternion=new THREE.Quaternion;this._target=new THREE.Vector3;this._changeEvent={type:"change"};this._startEvent={type:"start"};this._endEvent={type:"end"};this.onMouseWheel=a=>{a.preventDefault();if(this.enabled&&!this._noZoom&&!this._disconnected){var e=0;void 0!==a.wheelDelta?e=a.wheelDelta:void 0!==a.detail&&(e=-a.detail);0<e?this.dollyOut():this.dollyIn();this.dispatchEvent(this._startEvent);this.dispatchEvent(this._endEvent)}};
this.onKeyDown=a=>{if(this.enabled&&!this._disconnected)switch(a.keyCode){case this._keys.UP:this.pan(0,this._keyPanSpeed);break;case this._keys.BOTTOM:this.pan(0,-this._keyPanSpeed);break;case this._keys.LEFT:this.pan(this._keyPanSpeed,0);break;case this._keys.RIGHT:this.pan(-this._keyPanSpeed,0)}};this.reversed=Config.cameraReversedMode;this._camera=View3D.inst.camera;this._maxDistance=Config.currentFOV;this._rotateSpeedPreCalculated=2*Math.PI*this._rotateSpeed;this._target0=this._target.clone();
this._position0=this._camera.position.clone();this._quat=(new THREE.Quaternion).setFromUnitVectors(this._camera.up,new THREE.Vector3(0,1,0));this._quatInverse=this._quat.clone().invert();this._currentState=this._states.NONE;this._disconnected=!0;this.connect();this.update()}forceOrientation(a){}changeOffsetAngle(a){}setTarget(a){this._target=a}getTarget(){return this._target}setMaxFOV(a){this._maxDistance=a}setAzimuthalAngle(a=null){this._minAzimuthAngle=-Infinity;this._maxAzimuthAngle=Infinity;a&&
(this._minAzimuthAngle=this._theta-a/2,this._maxAzimuthAngle=this._theta+a/2)}setPolarAngle(a=null){this._minPolarAngle=0;this._maxPolarAngle=Math.PI;a&&(this._minPolarAngle=this._phi-a/2,this._maxPolarAngle=this._phi+a/2)}rotateLeft(a){void 0===a&&(a=this._autoRotationAngle);this._thetaDelta-=a/2}rotateUp(a){void 0===a&&(a=this._autoRotationAngle);this._phiDelta-=a/2}panLeft(a){let e=this._camera.matrix.elements;this._panOffset.set(e[0],e[1],e[2]);this._panOffset.multiplyScalar(-a);this._panVector.add(this._panOffset)}panUp(a){let e=
this._camera.matrix.elements;this._panOffset.set(e[4],e[5],e[6]);this._panOffset.multiplyScalar(a);this._panVector.add(this._panOffset)}pan(a,e){let h=View3D.inst.dom;if(void 0!==this._camera.fov){let m=this._camera.position.clone().sub(this._target).length();m*=Math.tan(this._camera.fov/2*Math.PI/180);this.panLeft(2*a*m/h.clientHeight);this.panUp(2*e*m/h.clientHeight)}else void 0!==this._camera.top?(this.panLeft(a*(this._camera.right-this._camera.left)/h.clientWidth),this.panUp(e*(this._camera.top-
this._camera.bottom)/h.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")}dollyIn(a=null){null==a&&(a=this._zoomSpeed);a=this._camera.fov+a;a>this._maxDistance||(this._camera.fov=a,this._camera.updateProjectionMatrix())}dollyOut(a=null){null==a&&(a=this._zoomSpeed);a=this._camera.fov-a;a<this._minDistance||(this._camera.fov=a,this._camera.updateProjectionMatrix())}update(){if(this.enabled){var a=this._camera.position;this._offset.copy(a).sub(this._target);
this._offset.applyQuaternion(this._quat);this._theta=Math.atan2(this._offset.x,this._offset.z);this._phi=Math.atan2(Math.sqrt(this._offset.x*this._offset.x+this._offset.z*this._offset.z),this._offset.y);this._autoRotate&&this.rotateLeft(this._autoRotationAngle);this._theta+=this._thetaDelta;this._phi+=this._phiDelta;var e=2*Math.PI,h=this._minAzimuthAngle,m=this._maxAzimuthAngle;isFinite(h)&&isFinite(m)&&(h<-Math.PI?h+=e:h>Math.PI&&(h-=e),m<-Math.PI?m+=e:m>Math.PI&&(m-=e),this._theta=h<=m?Math.max(h,
Math.min(m,this._theta)):this._theta>(h+m)/2?Math.max(h,this._theta):Math.min(m,this._theta));this._phi=Math.max(this._minPolarAngle,Math.min(this._maxPolarAngle,this._phi));this._phi=Math.max(this._EPS,Math.min(Math.PI-this._EPS,this._phi));e=this._offset.length();this._target.add(this._panOffset);this._offset.x=e*Math.sin(this._phi)*Math.sin(this._theta);this._offset.y=e*Math.cos(this._phi);this._offset.z=e*Math.sin(this._phi)*Math.cos(this._theta);this._offset.applyQuaternion(this._quatInverse);
a.copy(this._target).add(this._offset);this._camera.lookAt(this._target);this._thetaDelta/=this._smoothFactor;this._phiDelta/=this._smoothFactor;this._scale=1;this._panOffset.set(0,0,0);if(this._lastPosition.distanceToSquared(this._camera.position)>this._EPS||8*(1-this._lastQuaternion.dot(this._camera.quaternion))>this._EPS)this.dispatchEvent(this._changeEvent),this._lastPosition.copy(this._camera.position),this._lastQuaternion.copy(this._camera.quaternion)}}reset(){this._currentState=this._states.NONE;
this._target.copy(this._target0);this._camera.position.copy(this._position0);this.update()}_interactionStart(a){if(!this._disconnected&&this.enabled){if(a.isPrimary)this._currentState=this._states.ROTATE;else if(a.isSecondary)if(Device.isMobile()){if(this._noZoom)return;this._currentState=this._states.TOUCH_DOLLY;this._previousDistance=a.distance}else{if(this._noPan)return;this._currentState=this._states.PAN;this._panStart.copy(a.clickPos)}PointerManager.inst.setMoveHandler(this);PointerManager.inst.setEndHandler(this);
this.dispatchEvent(this._startEvent)}}_interactionMove(a){if(!this._disconnected&&this.enabled)if(this._currentState==this._states.ROTATE){var e=View3D.inst.dom;this._rotateDelta.copy(a.movement);this.reversed||this._rotateDelta.negate();this.rotateLeft(this._rotateSpeedPreCalculated*this._rotateDelta.x/e.clientWidth);this.rotateUp(this._rotateSpeedPreCalculated*this._rotateDelta.y/e.clientHeight)}else this._currentState==this._states.TOUCH_DOLLY?(e=a.distance-this._previousDistance,0<e?this.dollyOut(e):
this.dollyIn(-e),this._previousDistance=a.distance):this._currentState==this._states.PAN&&(this._panDelta.subVectors(a.clickPos,this._panStart).multiplyScalar(this._panSpeed),this.pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(a.clickPos))}_interactionEnd(){!this._disconnected&&this.enabled&&(PointerManager.inst.unsetMoveHandler(this),PointerManager.inst.unsetEndHandler(this),this.dispatchEvent(this._endEvent),this._currentState=this._states.NONE)}connect(){PointerManager.inst.setStartHandler(this);
this._noZoom||(View3D.inst.dom.addEventListener("mousewheel",this.onMouseWheel,!1),View3D.inst.dom.addEventListener("DOMMouseScroll",this.onMouseWheel,!1));this._noKeys||this._noPan||window.addEventListener("keydown",this.onKeyDown,!1);this._disconnected=!1}disconnect(){PointerManager.inst.unsetStartHandler(this);PointerManager.inst.unsetEndHandler(this);PointerManager.inst.unsetMoveHandler(this);this._noZoom||(View3D.inst.dom.removeEventListener("mousewheel",this.onMouseWheel,!1),View3D.inst.dom.removeEventListener("DOMMouseScroll",
this.onMouseWheel,!1));this._noKeys||this._noPan||window.removeEventListener("keydown",this.onKeyDown,!1);this._disconnected=!0;this.dispatchEvent(this._endEvent);this._currentState=this._states.NONE}notify(a,e){switch(a){case PointerCommand.START:this._interactionStart(e);break;case PointerCommand.MOVE:this._interactionMove(e);break;case PointerCommand.END:this._interactionEnd()}}}var Motion;
(function(a){function e(E,H,O,R){var W=new THREE.Raycaster(E,new THREE.Vector3(0,-1,0),0,a.RAY_FAR);W=W.intersectObjects(O,PointerManager.inst.RAYCAST_RECURSIVE);if(0==W.length)return!1;var ea=!1,T=I;I=h.crouch?Math.max(.6*Config.USER_STANDING_HEIGHT,I-.04):Math.min(Config.USER_STANDING_HEIGHT,I+.04);T!=I&&(ea=!0);if(!Config.STARTED_IN_VR||Device.isMobile()&&!WebVRUtils.hasHMD)W[0].point.y+=I;E.y<=W[0].point.y?(W=new THREE.Vector2,h.forward&&(W.y+=.06),h.back&&(W.y-=.06),h.right&&(W.x+=.06),h.left&&
(W.x-=.06),m.x=W.y*H.x-W.x*H.z,m.z=W.y*H.z+W.x*H.x,h.jump&&!t&&(m.y+=.17)):m.y-=.01;m.equals(new THREE.Vector3)||(ea=!0);h.jump&&(t=!0);if(!ea)return C=!1;R.copy(E).add(m);m.set(0,0,0);W=new THREE.Raycaster(R,new THREE.Vector3(0,-1,0),0,a.RAY_FAR);W=W.intersectObjects(O,PointerManager.inst.RAYCAST_RECURSIVE);if(0==W.length)return!1;if(!Config.STARTED_IN_VR||Device.isMobile()&&!WebVRUtils.hasHMD)W[0].point.y+=I;if(ea=R.y<W[0].point.y)R.y=W[0].point.y-1E-8;W=R.clone().sub(E);T=(new THREE.Vector2(W.x,
W.z)).length();if(ea&&T&&W.y>1*T){H=H.clone().multiplyScalar(.5).add(E);W=new THREE.Raycaster(H,new THREE.Vector3(0,-1,0),0,a.RAY_FAR);W=W.intersectObjects(O,PointerManager.inst.RAYCAST_RECURSIVE);if(0==W.length)return!1;H.copy(W[0].point);if(!Config.STARTED_IN_VR||Device.isMobile()&&!WebVRUtils.hasHMD)H.y+=I;W=H.clone().sub(E);T=(new THREE.Vector2(W.x,W.z)).length();if(W.y>1*T)return!1;R.y-=.8*(R.y-E.y);W=R.clone().sub(E)}m.copy(W);return 1E-8>m.manhattanLength()?!1:!0}a.PIVOT_OFFSET=1E-4;a.RAY_FAR=
1E4;let h={left:!1,forward:!1,right:!1,back:!1,rotateLeft:!1,rotateRight:!1,jump:!1,crouch:!1},m=new THREE.Vector3,t=!1,y=!1,C=!1,I=Config.USER_STANDING_HEIGHT;a.setMoveFromKey=function(E,H){C=!0;switch(E.toLowerCase()){case "arrowup":case "z":case "w":h.forward=H;break;case "arrowdown":case "s":h.back=H;break;case "arrowleft":case "q":case "a":h.left=H;break;case "arrowright":case "d":h.right=H;break;case " ":(h.jump=H)||(t=!1);break;case "c":H&&!y&&(h.crouch=!h.crouch),y=H}};a.applyMoves=function(E){if(C){var H=
View3D.inst.controlsManager.orbitControl;H instanceof OrbitalController&&(H.setAzimuthalAngle(null),H.setPolarAngle(null));var O;if(!(!E||0==E.length||Config.STARTED_IN_VR&&WebVRUtils.hasHMD)){H=View3D.inst.camera;var R=(new THREE.Vector3(0,0,-1)).applyQuaternion(H.quaternion),W=R.clone().multiplyScalar(-a.PIVOT_OFFSET),ea=H.position.clone().sub(W),T=new THREE.Vector3;e(ea,R,E,T)?(H.position.copy(T),E=H.position.clone(),H.position.add(W),H.updateProjectionMatrix(),H.updateMatrix(),View3D.inst.controlsManager.setStartTarget(H.position,
E),null===(O=View3D.inst.controlsManager.orbitControl)||void 0===O?void 0:O.update()):m.set(0,0,0)}E=0;h.rotateLeft&&(E-=.004);h.rotateRight&&(E+=.004);E&&(O=View3D.inst.controlsManager.orbitControl,O instanceof OrbitalController&&O.rotateLeft(2*Math.PI*E))}}})(Motion||={});
class FloorData extends AbstractScriptParser{constructor(){super(...arguments);this.visible=!1}static getFromName(a){return this.loopOnKeys(this.extractBaseCode(a,"floor"),new FloorData)}parseVal(a,e){if("visible"==a||"keepvisible"==a)this.visible=e?"true"==e:!1}}
class MotionZone extends UpdateMutex{constructor(){super(PointerCommand.NEED_UPDATE);this.FADE_IN_DURATION=this.FADE_OUT_DURATION=500;this._initialized=!1;this._player=null;this._depth=this._width=1;this._teleportPreviews=[];this._remapNeeded=this._previousVisibility=this._isPreviewing=!1;this._floorList=[];this._activeFloorList=[];this._currentIntersection=null;this._floorData=new FloorData;this._fadeOutNeeded=!1;if(MotionZone._inst)throw Error("This is a singleton");Notifier.subscribe(this,InitCommand.VR_INIT_TESTED);
Notifier.subscribe(this,SceneCommand.LOAD_START)}static get inst(){return this._inst||(this._inst=new MotionZone)}get floorIntersection(){this.update();return this._currentIntersection}init(a,e){this._initialized||(this._initialized=!0,this._width=a,this._depth=e,this.setContainer(),PointerManager.inst.setStartHandler(this),PointerManager.inst.setEndHandler(this),PointerManager.inst.setMoveHandler(this),PointerManager.inst.setDoubleTapHandler(this),document.onkeydown=h=>{Motion.setMoveFromKey(h.key,
!0)},document.onkeyup=h=>{Motion.setMoveFromKey(h.key,!1)})}disable(){PointerManager.inst.unsetStartHandler(this);PointerManager.inst.unsetEndHandler(this);PointerManager.inst.unsetMoveHandler(this)}notify(a,e){switch(a){case ViewportCommand.UPDATE:this._fadeOutNeeded&&(this._fadeOutNeeded=!1,View3D.inst.renderingController.hide(this.FADE_OUT_DURATION),this._activeFloorList.length||Notifier.unsubscribe(this,a));this._remapNeeded&&this._setActiveFloorList();Motion.applyMoves(this._activeFloorList);
break;case PointerCommand.NEED_UPDATE:super.notify(a,e);break;case PointerCommand.MOVE:this._manageMoveEvent();break;case PointerCommand.START:this._startMoveManagement(e.isSecondary);break;case PointerCommand.DOUBLE:this._isPreviewing=!0;case PointerCommand.END:this._endMoveManagement();break;case SceneCommand.LOAD_START:this._floorList=[];this._activeFloorList=[];this.hasChanged();this.moveTo(new THREE.Vector3(0,Config.STARTED_IN_VR&&WebVRUtils.hasHMD?-Config.USER_STANDING_HEIGHT:0,0));break;case InitCommand.VR_INIT_TESTED:Notifier.unsubscribe(this,
a),this.registerPlayer()}}update(){if(!this.upToDate){this.upToDate=!0;var a=PointerManager.inst.rayCaster.intersectObjects(this._activeFloorList);this._currentIntersection=a.length?a[0].point:null}}_startMoveManagement(a){a&&this._activeFloorList.length?(a=!1,this.update(),this._currentIntersection&&(a=this._isPreviewing=!0,this.setPreviewTeleportLocation(0,this._currentIntersection)),this.previewTeleportVisibility(0,a)):(this._isPreviewing=!1,this.previewTeleportVisibility(0,!1))}_manageMoveEvent(){if(this._isPreviewing){var a=
!1;this.update();this._currentIntersection&&(a=!0,this.setPreviewTeleportLocation(0,this._currentIntersection));this.previewTeleportVisibility(0,a)}}_endMoveManagement(){this._isPreviewing&&(this.update(),this._currentIntersection&&this.moveToPreviewPosition(0,this._currentIntersection),this.previewTeleportVisibility(0,!1),this._isPreviewing=!1,this._currentIntersection=null)}requestFloorListRemap(){this._remapNeeded||(this._remapNeeded=!0,Notifier.subscribe(this,ViewportCommand.UPDATE))}_setActiveFloorList(){this._remapNeeded=
!1;this._activeFloorList=[];this._floorList.forEach(a=>{var e;let h=a.userData?a.userData.owneruuid:"";(!h||(null===(e=LiveElementsRefHolder.inst.getRef(h))||void 0===e?0:e.interactive))&&this._activeFloorList.push(a)});this.hasChanged();this._activeFloorList.length?Notifier.subscribe(this,ViewportCommand.UPDATE):this._fadeOutNeeded||Notifier.unsubscribe(this,ViewportCommand.UPDATE)}addFloor(a,e){a&&("Group"==a.type?a.traverse(h=>{"Mesh"==h.type&&this._floorList.push(h)}):this._floorList.push(a));
e&&(this._floorData=e);this.requestFloorListRemap()}moveToPreviewPosition(a,e=null){let h=e;!e&&this._teleportPreviews[a]&&1==this._teleportPreviews[a].visible&&(h=this._teleportPreviews[a].position);if(!Config.STARTED_IN_VR||Device.isMobile()&&!WebVRUtils.hasHMD)h.y+=Config.USER_STANDING_HEIGHT;View3D.inst.renderingController.show(this.FADE_IN_DURATION,()=>{this.moveTo(h);this._fadeOutNeeded=!0;this._activeFloorList.length||Notifier.subscribe(this,ViewportCommand.UPDATE)})}moveTo(a){if(Config.STARTED_IN_VR&&
WebVRUtils.hasHMD)this.container.position.copy(a);else{let e=new THREE.Vector3(0,0,-1);e.applyQuaternion(View3D.inst.camera.quaternion).multiplyScalar(Motion.PIVOT_OFFSET).add(a);View3D.inst.camera.position.copy(a);View3D.inst.camera.updateProjectionMatrix();View3D.inst.controlsManager.setStartTarget(a,e);a=View3D.inst.controlsManager.orbitControl;a instanceof OrbitalController&&(a.setAzimuthalAngle(null),a.setPolarAngle(null));null===a||void 0===a?void 0:a.update()}}previewTeleportVisibility(a,e){var h;
this._previousVisibility!=e&&(this._previousVisibility=e,null==this._teleportPreviews[a]&&(this._teleportPreviews[a]=MotionZone.createTeleportPreview(),View3D.inst.scene.add(this._teleportPreviews[a])),this._teleportPreviews[a].visible=e,(null===(h=this._floorData)||void 0===h?0:h.visible)&&this._activeFloorList.forEach(m=>{m instanceof THREE.Mesh&&(m.material.opacity=1==e?1:0,m.material.transparent=!0,m.material.needsUpdate=!0)}))}setPreviewTeleportLocation(a,e){null==this._teleportPreviews[a]&&
(this._teleportPreviews[a]=MotionZone.createTeleportPreview(),View3D.inst.scene.add(this._teleportPreviews[a]));this._teleportPreviews[a].position.copy(e)}registerPlayer(){null==this._player&&(this._player=new THREE.Group,this._player.name="MotionZonePlayer",this._player.add(View3D.inst.camera),this._player.position.copy(this.getGroundPosition()),this.setContainer(),this.container.add(this._player))}static createTeleportPreview(){var a={baseColor:{type:"c",value:new THREE.Color(16777215)},maxDist:{type:"f",
value:3}};a=new THREE.ShaderMaterial({uniforms:a,vertexShader:"        varying vec3 vPosition;\n        void main(){\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n            vPosition = position;\n        }",fragmentShader:"        varying vec3 vPosition;\n        uniform float maxDist;\n        uniform vec3 baseColor;\n        void main() {\n            float d = distance(vPosition, vec3(0.0));\n            float alpha = (maxDist-d) / maxDist;\n            gl_FragColor = vec4(baseColor, alpha);\n        }",
transparent:!0,side:THREE.BackSide,blendDstAlpha:1,alphaTest:.05});let e=new THREE.Group;e.name="TeleportPreview";let h=new XMLHttpRequest;h.open("GET",MotionZone.MOTION_TARGET_PATH+MotionZone.MOTION_TARGET_NAME,!0);h.responseType="arraybuffer";h.onreadystatechange=function(){if(4==this.readyState&&(200==this.status||0==this.status)){let m=new Uint8Array(h.response);try{let t=pako.inflate(m),y=Decoder.decode(t.buffer),C=(new SPHParser("",!1)).generate(y,MotionZone.MOTION_TARGET_PATH);C.scale.set(.5,
.5,.5);e.add(C)}catch(t){console.log(t)}}};h.send();a=new THREE.Line(new THREE.BufferGeometry,a);a.geometry.setAttribute("position",new THREE.Float32BufferAttribute([0,0,0,0,3,0],3));e.add(a);return e}setContainer(){this.container||(this.container=new THREE.Group,this.container.name="MotionZoneContainer",View3D.inst.scene.add(this.container))}getGroundPosition(){var a=new THREE.Raycaster(new THREE.Vector3,new THREE.Vector3,1,1E5);a.set(this._player.position,new THREE.Vector3(0,-1,0));a=a.intersectObjects(this._activeFloorList,
PointerManager.inst.RAYCAST_RECURSIVE);return a.length?a[0].point:this._player.position}}MotionZone.MOTION_TARGET_PATH="static/assets/target/";MotionZone.MOTION_TARGET_NAME="target.sph3d";
class DRACOLoader{constructor(a){this.timeLoaded=0;this.materials=null;this.verbosity=0;this.attributeOptions={};this.drawMode=THREE.TrianglesDrawMode;this.nativeAttributeMap={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"};this.manager=a||THREE.DefaultLoadingManager}load(a,e,h,m){let t=new THREE.FileLoader(this.manager);t.setPath(this.path);t.setResponseType("arraybuffer");t.load(a,y=>{this.decodeDracoFile(y,e)},h,m)}setPath(a){this.path=a}setCrossOrigin(a){this.crossOrigin=a}setVerbosity(a){this.verbosity=
a}setDrawMode(a){this.drawMode=a}setSkipDequantization(a,e){let h=!0;"undefined"!==typeof e&&(h=e);this.getAttributeOptions(a).skipDequantization=h}decodeDracoFile(a,e,h,m){let t=this;DRACOLoader.getDecoderModule().then(function(y){t.decodeDracoFileInternal(a,y.decoder,e,h||{},m||{})})}decodeDracoFileInternal(a,e,h,m,t){let y=new e.DecoderBuffer;y.Init(new Int8Array(a),a.byteLength);a=new e.Decoder;let C=a.GetEncodedGeometryType(y);if(C==e.TRIANGULAR_MESH)0<this.verbosity&&console.log("Loaded a mesh.");
else if(C==e.POINT_CLOUD)0<this.verbosity&&console.log("Loaded a point cloud.");else throw console.error("DRACOLoader: Unknown geometry type."),Error("DRACOLoader: Unknown geometry type.");h(this.convertDracoGeometryTo3JS(e,a,C,y,m,t))}addAttributeToGeometry(a,e,h,m,t,y,C,I){if(0===y.ptr)throw a="DRACOLoader: No attribute "+m,console.error(a),Error(a);let E=y.num_components(),H=h.num_points()*E;switch(t){case Float32Array:t=new a.DracoFloat32Array;e.GetAttributeFloatForAllPoints(h,y,t);I[m]=new Float32Array(H);
e=THREE.Float32BufferAttribute;break;case Int8Array:t=new a.DracoInt8Array;e.GetAttributeInt8ForAllPoints(h,y,t);I[m]=new Int8Array(H);e=THREE.Int8BufferAttribute;break;case Int16Array:t=new a.DracoInt16Array;e.GetAttributeInt16ForAllPoints(h,y,t);I[m]=new Int16Array(H);e=THREE.Int16BufferAttribute;break;case Int32Array:t=new a.DracoInt32Array;e.GetAttributeInt32ForAllPoints(h,y,t);I[m]=new Int32Array(H);e=THREE.Int32BufferAttribute;break;case Uint8Array:t=new a.DracoUInt8Array;e.GetAttributeUInt8ForAllPoints(h,
y,t);I[m]=new Uint8Array(H);e=THREE.Uint8BufferAttribute;break;case Uint16Array:t=new a.DracoUInt16Array;e.GetAttributeUInt16ForAllPoints(h,y,t);I[m]=new Uint16Array(H);e=THREE.Uint16BufferAttribute;break;case Uint32Array:t=new a.DracoUInt32Array;e.GetAttributeUInt32ForAllPoints(h,y,t);I[m]=new Uint32Array(H);e=THREE.Uint32BufferAttribute;break;default:throw console.error("DRACOLoader: Unexpected attribute type."),Error("DRACOLoader: Unexpected attribute type.");}for(h=0;h<H;h++)I[m][h]=t.GetValue(h);
C.setAttribute(m,new e(I[m],E));a.destroy(t)}convertDracoGeometryTo3JS(a,e,h,m,t,y){!0===this.getAttributeOptions("position").skipDequantization&&e.SkipAttributeTransform(a.POSITION);let C;performance.now();if(h===a.TRIANGULAR_MESH){C=new a.Mesh;var I=e.DecodeBufferToMesh(m,C)}else C=new a.PointCloud,I=e.DecodeBufferToPointCloud(m,C);if(!I.ok()||0==C.ptr)throw h="DRACOLoader: Decoding failed: "+I.error_msg(),console.error(h),a.destroy(e),a.destroy(C),Error(h);performance.now();a.destroy(m);h==a.TRIANGULAR_MESH?
(I=C.num_faces(),0<this.verbosity&&console.log("Number of faces loaded: "+I.toString())):I=0;m=C.num_points();var E=C.num_attributes();0<this.verbosity&&(console.log("Number of points loaded: "+m.toString()),console.log("Number of attributes loaded: "+E.toString()));m=e.GetAttributeId(C,a.POSITION);if(-1==m)throw console.error("DRACOLoader: No position attribute found."),a.destroy(e),a.destroy(C),Error("DRACOLoader: No position attribute found.");E=e.GetAttribute(C,m);let H={};m=new THREE.BufferGeometry;
for(var O in this.nativeAttributeMap)if(void 0===t[O]){var R=e.GetAttributeId(C,a[this.nativeAttributeMap[O]]);-1!==R&&(0<this.verbosity&&console.log("Loaded "+O+" attribute."),R=e.GetAttribute(C,R),this.addAttributeToGeometry(a,e,C,O,Float32Array,R,m,H))}for(var W in t)O=y[W]||Float32Array,R=e.GetAttributeByUniqueId(C,t[W]),this.addAttributeToGeometry(a,e,C,W,O,R,m,H);if(h==a.TRIANGULAR_MESH)if(this.drawMode===THREE.TriangleStripDrawMode){I=new a.DracoInt32Array;e.GetTriangleStripsFromMesh(C,I);
H.indices=new Uint32Array(I.size());for(t=0;t<I.size();++t)H.indices[t]=I.GetValue(t);a.destroy(I)}else{H.indices=new Uint32Array(3*I);t=new a.DracoInt32Array;for(y=0;y<I;++y)e.GetFaceFromMesh(C,y,t),W=3*y,H.indices[W]=t.GetValue(0),H.indices[W+1]=t.GetValue(1),H.indices[W+2]=t.GetValue(2);a.destroy(t)}m.drawMode=this.drawMode;h==a.TRIANGULAR_MESH&&m.setIndex(new (65535<H.indices.length?THREE.Uint32BufferAttribute:THREE.Uint16BufferAttribute)(H.indices,1));h=new a.AttributeQuantizationTransform;if(h.InitFromAttribute(E))for(m.attributes.position.isQuantized=
!0,m.attributes.position.maxRange=h.range(),m.attributes.position.numQuantizationBits=h.quantization_bits(),m.attributes.position.minValues=new Float32Array(3),I=0;3>I;++I)m.attributes.position.minValues[I]=h.min_value(I);a.destroy(h);a.destroy(e);a.destroy(C);return m}isVersionSupported(a,e){DRACOLoader.getDecoderModule().then(function(h){e(h.decoder.isVersionSupported(a))})}getAttributeOptions(a){"undefined"===typeof this.attributeOptions[a]&&(this.attributeOptions[a]={});return this.attributeOptions[a]}static setDecoderPath(a){DRACOLoader.decoderPath=
a}static setDecoderConfig(a){let e=DRACOLoader.decoderConfig.wasmBinary;DRACOLoader.decoderConfig=a||{};DRACOLoader.releaseDecoderModule();e&&(DRACOLoader.decoderConfig.wasmBinary=e)}static releaseDecoderModule(){DRACOLoader.decoderModulePromise=null}static getDecoderModule(){let a=DRACOLoader.decoderPath,e=DRACOLoader.decoderConfig,h=DRACOLoader.decoderModulePromise;if(h)return h;"undefined"!==typeof DracoDecoderModule?h=Promise.resolve():"object"!==typeof WebAssembly||"js"===e.type?h=DRACOLoader._loadScript(a+
"draco_decoder.js"):(e.wasmBinaryFile=a+"draco_decoder.wasm",h=DRACOLoader._loadScript(a+"draco_wasm_wrapper.js").then(()=>DRACOLoader._loadArrayBuffer(e.wasmBinaryFile)).then(m=>{e.wasmBinary=m}));h=h.then(()=>new Promise(m=>{e.onModuleLoaded=t=>{m({decoder:t})};DracoDecoderModule(e)}));return DRACOLoader.decoderModulePromise=h}static _loadScript(a){let e=document.getElementById("decoder_script");null!==e&&e.parentNode.removeChild(e);let h=document.getElementsByTagName("head")[0],m=document.createElement("script");
m.id="decoder_script";m.type="text/javascript";m.src=a;return new Promise(t=>{m.onload=t;h.appendChild(m)})}static _loadArrayBuffer(a){let e=new THREE.FileLoader;e.setResponseType("arraybuffer");return new Promise(function(h,m){e.load(a,h,void 0,m)})}}DRACOLoader.decoderPath="./";DRACOLoader.decoderConfig={};DRACOLoader.decoderModulePromise=null;
class GLTFMeshStandardSGMaterial extends THREE.MeshStandardMaterial{constructor(a){super();this.isGLTFSpecularGlossinessMaterial=!0;const e={specular:{value:(new THREE.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=e;this.onBeforeCompile=function(h){for(const m in this.uniforms)h.uniforms[m]=this.uniforms[m];h.fragmentShader=h.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;",
"uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>","#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif").replace("#include <metalnessmap_pars_fragment>","#ifdef USE_GLOSSINESSMAP\n\tuniform sampler2D glossinessMap;\n#endif").replace("#include <roughnessmap_fragment>","vec3 specularFactor = specular;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture\n\tspecularFactor *= texelSpecular.rgb;\n#endif").replace("#include <metalnessmap_fragment>",
"float glossinessFactor = glossiness;\n#ifdef USE_GLOSSINESSMAP\n\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );\n\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture\n\tglossinessFactor *= texelGlossiness.a;\n#endif").replace("#include <lights_physical_fragment>","PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.\nmaterial.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\nmaterial.specularColor = specularFactor;")};
Object.defineProperties(this,{specular:{get:function(){return e.specular.value},set:function(h){e.specular.value=h}},specularMap:{get:function(){return e.specularMap.value},set:function(h){(e.specularMap.value=h)?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return e.glossiness.value},set:function(h){e.glossiness.value=h}},glossinessMap:{get:function(){return e.glossinessMap.value},set:function(h){(e.glossinessMap.value=h)?(this.defines.USE_GLOSSINESSMAP=
"",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}});delete this.metalness;delete this.roughness;delete this.metalnessMap;delete this.roughnessMap;this.setValues(a)}copy(a){super.copy(a);this.specularMap=a.specularMap;this.specular.copy(a.specular);this.glossinessMap=a.glossinessMap;this.glossiness=a.glossiness;delete this.metalness;delete this.roughness;delete this.metalnessMap;delete this.roughnessMap;return this}}
class GLTFMaterialPBRSpecularGlossinessExtension{constructor(){this.name=GLTFUtils.GLTF_EXTENSION.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS;this.specularGlossinessParams="color map lightMap lightMapIntensity aoMap aoMapIntensity emissive emissiveIntensity emissiveMap bumpMap bumpScale normalMap normalMapType displacementMap displacementScale displacementBias specularMap specular glossinessMap glossiness alphaMap envMap envMapIntensity refractionRatio".split(" ")}getMaterialType(){return GLTFMeshStandardSGMaterial}extendParams(a,
e,h){var m=e.extensions[this.name];a.color=new THREE.Color(1,1,1);a.opacity=1;e=[];if(Array.isArray(m.diffuseFactor)){let t=m.diffuseFactor;a.color.fromArray(t);a.opacity=t[3]}void 0!==m.diffuseTexture&&e.push(h.assignTexture(a,"map",m.diffuseTexture));a.emissive=new THREE.Color(0,0,0);a.glossiness=void 0!==m.glossinessFactor?m.glossinessFactor:1;a.specular=new THREE.Color(1,1,1);Array.isArray(m.specularFactor)&&a.specular.fromArray(m.specularFactor);void 0!==m.specularGlossinessTexture&&(m=m.specularGlossinessTexture,
e.push(h.assignTexture(a,"glossinessMap",m)),e.push(h.assignTexture(a,"specularMap",m)));return Promise.all(e)}createMaterial(a){let e=new GLTFMeshStandardSGMaterial(a);e.fog=!0;e.color=a.color;e.map=void 0===a.map?null:a.map;e.lightMap=null;e.lightMapIntensity=1;e.aoMap=void 0===a.aoMap?null:a.aoMap;e.aoMapIntensity=1;e.emissive=a.emissive;e.emissiveIntensity=1;e.emissiveMap=void 0===a.emissiveMap?null:a.emissiveMap;e.bumpMap=void 0===a.bumpMap?null:a.bumpMap;e.bumpScale=1;e.normalMap=void 0===a.normalMap?
null:a.normalMap;e.normalMapType=THREE.TangentSpaceNormalMap;a.normalScale&&(e.normalScale=a.normalScale);e.displacementMap=null;e.displacementScale=1;e.displacementBias=0;e.specularMap=void 0===a.specularMap?null:a.specularMap;e.specular=a.specular;e.glossinessMap=void 0===a.glossinessMap?null:a.glossinessMap;e.glossiness=a.glossiness;e.alphaMap=null;e.envMap=void 0===a.envMap?null:a.envMap;e.envMapIntensity=1;e.refractionRatio=.98;return e}}
class GLTFLightsExtension{constructor(a){this.name=GLTFUtils.GLTF_EXTENSION.KHR_LIGHTS_PUNCTUAL;this.parser=a;this.cache={refs:{},uses:{}}}_markDefs(){let a=this.parser,e=this.parser.json.nodes||[];for(let h=0,m=e.length;h<m;h++){let t=e[h];t.extensions&&t.extensions[this.name]&&void 0!==t.extensions[this.name].light&&a._addNodeRef(this.cache,t.extensions[this.name].light)}}_loadLight(a){let e=this.parser,h="light:"+a;var m=e.cache.get(h);if(m)return m;m=e.json;m=((m.extensions&&m.extensions[this.name]||
{}).lights||[])[a];var t=new THREE.Color(16777215);void 0!==m.color&&t.fromArray(m.color);let y=void 0!==m.range?m.range:0;switch(m.type){case "directional":t=new THREE.DirectionalLight(t);t.target.position.set(0,0,-1);t.add(t.target);break;case "point":t=new THREE.PointLight(t);t.distance=y;break;case "spot":t=new THREE.SpotLight(t);t.distance=y;m.spot=m.spot||{};m.spot.innerConeAngle=void 0!==m.spot.innerConeAngle?m.spot.innerConeAngle:0;m.spot.outerConeAngle=void 0!==m.spot.outerConeAngle?m.spot.outerConeAngle:
Math.PI/4;t.angle=m.spot.outerConeAngle;t.penumbra=1-m.spot.innerConeAngle/m.spot.outerConeAngle;t.target.position.set(0,0,-1);t.add(t.target);break;default:throw Error("THREE.GLTFLoader: Unexpected light type: "+m.type);}t.position.set(0,0,0);t.decay=2;void 0!==m.intensity&&(t.intensity=m.intensity);t.name=e.createUniqueName(m.name||"light_"+a);m=Promise.resolve(t);e.cache.add(h,m);return m}createNodeAttachment(a){let e=this,h=this.parser;a=h.json.nodes[a];let m=(a.extensions&&a.extensions[this.name]||
{}).light;return void 0===m?null:this._loadLight(m).then(t=>h._getNodeRef(e.cache,m,t))}}class GLTFHeader{}
class GLTFBinaryExtension{constructor(a){this.name=GLTFUtils.GLTF_EXTENSION.KHR_BINARY_GLTF;this.body=this.content=null;var e=new DataView(a,0,GLTFUtils.BINARY_EXTENSION_HEADER_LENGTH);this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(a.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)};if(this.header.magic!==GLTFUtils.BINARY_EXTENSION_HEADER_MAGIC)throw Error("GLTFLoader: Unsupported glTF-Binary header.");if(2>this.header.version)throw Error("GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");
e=this.header.length-GLTFUtils.BINARY_EXTENSION_HEADER_LENGTH;let h=new DataView(a,GLTFUtils.BINARY_EXTENSION_HEADER_LENGTH),m=0;for(;m<e;){let y=h.getUint32(m,!0);m+=4;var t=h.getUint32(m,!0);m+=4;t===GLTFUtils.BINARY_EXTENSION_CHUNK_TYPES.JSON?(t=new Uint8Array(a,GLTFUtils.BINARY_EXTENSION_HEADER_LENGTH+m,y),this.content=THREE.LoaderUtils.decodeText(t)):t===GLTFUtils.BINARY_EXTENSION_CHUNK_TYPES.BIN&&(t=GLTFUtils.BINARY_EXTENSION_HEADER_LENGTH+m,this.body=a.slice(t,t+y));m+=y}if(null===this.content)throw Error("GLTFLoader: JSON content not found.");
}}
class GLTFUtils{static resolveURL(a,e){if("string"!==typeof a||""===a)return"";/^https?:\/\//i.test(e)&&/^\//.test(a)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1"));return/^(https?:)?\/\//i.test(a)||/^data:.*,.*$/i.test(a)||/^blob:.*$/i.test(a)?a:/\.bin.*$/i.test(a)?e+a:/\.jp[e]?g|png.*$/i.test(a)?a:e+a}static createDefaultMaterial(a){void 0===a.DefaultMaterial&&(a.DefaultMaterial=new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide}));return a.DefaultMaterial}static addUnknownExtensionsToUserData(a,
e,h){var m;for(let t in h.extensions)void 0===a[t]&&((m=e.userData).gltfExtensions||(m.gltfExtensions={}),e.userData.gltfExtensions[t]=h.extensions[t])}static assignExtrasToUserData(a,e){void 0!==e.extras&&("object"===typeof e.extras?Object.assign(a.userData,e.extras):console.warn("GLTFLoader: Ignoring primitive type .extras, "+e.extras))}static addMorphTargets(a,e,h){let m=!1,t=!1,y=!1;for(let R=0,W=e.length;R<W;R++){var C=e[R];void 0!==C.POSITION&&(m=!0);void 0!==C.NORMAL&&(t=!0);void 0!==C.COLOR_0&&
(y=!0);if(m&&t&&y)break}if(!m&&!t&&!y)return Promise.resolve(a);C=[];let I=[],E=[];for(let R=0,W=e.length;R<W;R++){var H=e[R];if(m){var O=void 0!==H.POSITION?h.getDependency("accessor",H.POSITION):a.attributes.position;C.push(O)}t&&(O=void 0!==H.NORMAL?h.getDependency("accessor",H.NORMAL):a.attributes.normal,I.push(O));y&&(H=void 0!==H.COLOR_0?h.getDependency("accessor",H.COLOR_0):a.attributes.color,E.push(H))}return Promise.all([Promise.all(C),Promise.all(I),Promise.all(E)]).then(function(R){const W=
R[0],ea=R[1];R=R[2];m&&(a.morphAttributes.position=W);t&&(a.morphAttributes.normal=ea);y&&(a.morphAttributes.color=R);a.morphTargetsRelative=!0;return a})}static updateMorphTargets(a,e){a.updateMorphTargets();if(void 0!==e.weights)for(let h=0,m=e.weights.length;h<m;h++)a.morphTargetInfluences[h]=e.weights[h];if(e.extras&&Array.isArray(e.extras.targetNames))if(e=e.extras.targetNames,a.morphTargetInfluences.length===e.length){a.morphTargetDictionary={};for(let h=0,m=e.length;h<m;h++)a.morphTargetDictionary[e[h]]=
h}else console.warn("GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}static createPrimitiveKey(a){let e=a.extensions&&a.extensions[GLTFUtils.GLTF_EXTENSION.KHR_DRACO_MESH_COMPRESSION];return e?"draco:"+e.bufferView+":"+e.indices+":"+GLTFUtils.createAttributesKey(e.attributes):a.indices+":"+GLTFUtils.createAttributesKey(a.attributes)+":"+a.mode}static getNormalizedComponentScale(a){switch(a){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/
65535;default:throw Error("GLTFLoader: Unsupported normalized accessor component type.");}}static createAttributesKey(a){let e="",h=Object.keys(a).sort();for(let m=0,t=h.length;m<t;m++)e+=h[m]+":"+a[h[m]]+";";return e}static isPrimitiveEqual(a,e){let h=a.extensions?a.extensions[GLTFUtils.GLTF_EXTENSION.KHR_DRACO_MESH_COMPRESSION]:void 0,m=e.extensions?e.extensions[GLTFUtils.GLTF_EXTENSION.KHR_DRACO_MESH_COMPRESSION]:void 0;return h&&m?h.bufferView!==m.bufferView?!1:GLTFUtils.isObjectEqual(h.attributes,
m.attributes):a.indices!==e.indices?!1:GLTFUtils.isObjectEqual(a.attributes,e.attributes)}static isObjectEqual(a,e){if(Object.keys(a).length!==Object.keys(e).length)return!1;for(let h in a)if(a[h]!==e[h])return!1;return!0}static isArrayEqual(a,e){if(a.length!==e.length)return!1;for(let h=0,m=a.length;h<m;h++)if(a[h]!==e[h])return!1;return!0}static cloneBufferAttribute(a){if(a.isInterleavedBufferAttribute){let e=a.count,h=a.itemSize,m=a.array.slice(0,e*h);for(let t=0,y=0;t<e;++t)m[y++]=a.getX(t),2<=
h&&(m[y++]=a.getY(t)),3<=h&&(m[y++]=a.getZ(t)),4<=h&&(m[y++]=a.getW(t));return new THREE.BufferAttribute(m,h,a.normalized)}return a.clone()}}GLTFUtils.BINARY_EXTENSION_HEADER_MAGIC="glTF";GLTFUtils.BINARY_EXTENSION_HEADER_LENGTH=12;GLTFUtils.BINARY_EXTENSION_CHUNK_TYPES={JSON:1313821514,BIN:5130562};
GLTFUtils.GLTF_EXTENSION={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",
KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",GLTF_MATERIALS_PBR_METALLIC_ROUGHNESS:"GLTFMaterialMetallicRoughnessExtension",SOLIDWORKS:"Solidworks_material"};
GLTFUtils.WEBGL_CONSTANTS={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123};GLTFUtils.WEBGL_COMPONENT_TYPES={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};
GLTFUtils.WEBGL_FILTERS={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipMapNearestFilter,9985:THREE.LinearMipMapNearestFilter,9986:THREE.NearestMipMapLinearFilter,9987:THREE.LinearMipmapLinearFilter};GLTFUtils.WEBGL_WRAPPINGS={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping};GLTFUtils.WEBGL_TYPE_SIZES={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};
GLTFUtils.ATTRIBUTES={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"};GLTFUtils.PATH_PROPERTIES={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"};GLTFUtils.INTERPOLATION={CUBICSPLINE:void 0,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete};GLTFUtils.ALPHA_MODES={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};
GLTFUtils.MIME_TYPE_FORMATS={"image/png":THREE.RGBAFormat,"image/jpeg":THREE.RGBFormat};class GLTFRegistry{constructor(){this.objects={}}get(a){return this.objects[a]}add(a,e){this.objects[a]=e}remove(a){delete this.objects[a]}removeAll(){this.objects={}}}
class GLTFCubicSplineInterpolant extends THREE.Interpolant{constructor(a,e,h,m){super(a,e,h,m);this.afterEnd_=this.beforeStart_=GLTFCubicSplineInterpolant.prototype.copySampleValue_}copySampleValue_(a){let e=this.resultBuffer,h=this.sampleValues,m=this.valueSize;a=a*m*3+m;for(let t=0;t!==m;t++)e[t]=h[a+t];return e}interpolate_(a,e,h,m){let t=this.resultBuffer,y=this.sampleValues,C=this.valueSize,I=2*C;var E=3*C;m-=e;e=(h-e)/m;h=e*e;var H=h*e;a*=E;E=a-E;let O=-2*H+3*h;H-=h;let R=1-O;e=H-h+e;for(h=
0;h!==C;h++)t[h]=R*y[E+h+C]+e*y[E+h+I]*m+O*y[a+h+C]+H*y[a+h]*m;return t}}const _q=new THREE.Quaternion;class GLTFCubicSplineQuaternionInterpolant extends GLTFCubicSplineInterpolant{interpolate_(a,e,h,m){a=super.interpolate_(a,e,h,m);_q.fromArray(a).normalize().toArray(a);return a}}
class BasisTextureLoader extends THREE.Loader{constructor(a){super(a);this.transcoderPath="";this._transcoderPending=this._transcoderBinary=null;this.workerLimit=4;this.workerPool=[];this.workerNextTaskID=1;this.workerSourceURL="";this.workerConfig=null;BasisTextureLoader.taskCache=new WeakMap;BasisTextureLoader.ETC1S_OPTIONS=BasisTextureLoader.FORMAT_OPTIONS.sort((e,h)=>e.priorityETC1S-h.priorityETC1S);BasisTextureLoader.UASTC_OPTIONS=BasisTextureLoader.FORMAT_OPTIONS.sort((e,h)=>e.priorityUASTC-
h.priorityUASTC)}set transcoderPath(a){this._transcoderPath=a}get transcoderPath(){return this._transcoderPath}detectSupport(a){this.workerConfig||(this.workerConfig={astcSupported:View3D.inst.renderer.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:View3D.inst.renderer.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:View3D.inst.renderer.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:View3D.inst.renderer.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:View3D.inst.renderer.extensions.has("EXT_texture_compression_bptc"),
pvrtcSupported:View3D.inst.renderer.extensions.has("WEBGL_compressed_texture_pvrtc")||View3D.inst.renderer.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")})}load(a,e,h,m){let t=new THREE.FileLoader(this.manager);t.setCrossOrigin("Anonymous");t.setResponseType("arraybuffer");t.setWithCredentials(this.withCredentials);let y=new THREE.CompressedTexture(null,null,null);t.load(a,C=>{if(BasisTextureLoader.taskCache.has(C))return BasisTextureLoader.taskCache.get(C).promise.then(e).catch(m);this._createTexture([C]).then(I=>
{y.copy(I);y.needsUpdate=!0;e&&e(y)}).catch(m)},h,m);return y}parseInternalAsync(a){let e=new Set;for(let h=0;h<a.length;h++)e.add(a[h].data.buffer);return this._createTexture(Array.from(e),Object.assign(Object.assign({},a),{lowLevel:!0}))}_createTexture(a,e){let h,m,t=e||{},y=0;for(e=0;e<a.length;e++)y+=a[e].byteLength;e=this._allocateWorker(y).then(C=>{h=C;m=this.workerNextTaskID++;return new Promise((I,E)=>{h._callbacks[m]={resolve:I,reject:E};h.postMessage({type:"transcode",id:m,buffers:a,taskConfig:t},
a)})}).then(C=>{let {mipmaps:I,width:E,height:H,format:O}=C;C=new THREE.CompressedTexture(I,E,H,O,THREE.UnsignedByteType);C.minFilter=1===I.length?THREE.LinearFilter:THREE.LinearMipmapLinearFilter;C.magFilter=THREE.LinearFilter;C.generateMipmaps=!1;C.needsUpdate=!0;return C});e.catch(()=>!0).then(()=>{h&&m&&(h._taskLoad-=y,delete h._callbacks[m])});BasisTextureLoader.taskCache.set(a[0],{promise:e});return e}_initTranscoder(){if(!this._transcoderPending){let a=new THREE.FileLoader(this.manager);a.setPath(this.transcoderPath);
a.setWithCredentials(this.withCredentials);let e=new Promise((t,y)=>{a.load("basis_transcoder.js",t,void 0,y)}),h=new THREE.FileLoader(this.manager);h.setPath(this.transcoderPath);h.setResponseType("arraybuffer");h.setWithCredentials(this.withCredentials);let m=new Promise((t,y)=>{h.load("basis_transcoder.wasm",t,void 0,y)});this._transcoderPending=Promise.all([e,m]).then(([t,y])=>{let C=BasisTextureLoader.BasisWorker.toString();t=["/* constants */","var _EngineFormat = "+JSON.stringify(BasisTextureLoader.EngineFormat),
"var _TranscoderFormat = "+JSON.stringify(BasisTextureLoader.TranscoderFormat),"var _BasisFormat = "+JSON.stringify(BasisTextureLoader.BasisFormat),"/* basis_transcoder.js */",t,"/* worker */",C.substring(C.indexOf("{")+1,C.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([t]));this._transcoderBinary=y})}return this._transcoderPending}_allocateWorker(a){return this._initTranscoder().then(()=>{if(this.workerPool.length<this.workerLimit){let h=new Worker(this.workerSourceURL);
h._callbacks={};h._taskLoad=0;h.postMessage({type:"init",config:this.workerConfig,transcoderBinary:this._transcoderBinary});h.onmessage=m=>{m=m.data;switch(m.type){case "transcode":h._callbacks[m.id].resolve(m);break;case "error":h._callbacks[m.id].reject(m);break;default:console.error('BasisTextureLoader: Unexpected message, "'+m.type+'"')}};this.workerPool.push(h)}else this.workerPool.sort((h,m)=>h._taskLoad>m._taskLoad?-1:1);let e=this.workerPool[this.workerPool.length-1];e._taskLoad+=a;return e})}dispose(){for(let a=
0;a<this.workerPool.length;a++)this.workerPool[a].terminate();this.workerPool.length=0}}BasisTextureLoader.BasisFormat={ETC1S:0,UASTC_4x4:1};BasisTextureLoader.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16};
BasisTextureLoader.EngineFormat={RGBAFormat:THREE.RGBAFormat,RGBA_ASTC_4x4_Format:THREE.RGBA_ASTC_4x4_Format,RGBA_BPTC_Format:THREE.RGBA_BPTC_Format,RGBA_ETC2_EAC_Format:THREE.RGBA_ETC2_EAC_Format,RGBA_PVRTC_4BPPV1_Format:THREE.RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT5_Format:THREE.RGBA_S3TC_DXT5_Format,RGB_ETC1_Format:THREE.RGB_ETC1_Format,RGB_ETC2_Format:THREE.RGB_ETC2_Format,RGB_PVRTC_4BPPV1_Format:THREE.RGB_PVRTC_4BPPV1_Format,RGB_S3TC_DXT1_Format:THREE.RGB_S3TC_DXT1_Format};
BasisTextureLoader.FORMAT_OPTIONS=[{if:"astcSupported",basisFormat:[BasisTextureLoader.BasisFormat.UASTC_4x4],transcoderFormat:[BasisTextureLoader.TranscoderFormat.ASTC_4x4,BasisTextureLoader.TranscoderFormat.ASTC_4x4],engineFormat:[BasisTextureLoader.EngineFormat.RGBA_ASTC_4x4_Format,BasisTextureLoader.EngineFormat.RGBA_ASTC_4x4_Format],priorityETC1S:Infinity,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[BasisTextureLoader.BasisFormat.ETC1S,BasisTextureLoader.BasisFormat.UASTC_4x4],
transcoderFormat:[BasisTextureLoader.TranscoderFormat.BC7_M5,BasisTextureLoader.TranscoderFormat.BC7_M5],engineFormat:[BasisTextureLoader.EngineFormat.RGBA_BPTC_Format,BasisTextureLoader.EngineFormat.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[BasisTextureLoader.BasisFormat.ETC1S,BasisTextureLoader.BasisFormat.UASTC_4x4],transcoderFormat:[BasisTextureLoader.TranscoderFormat.BC1,BasisTextureLoader.TranscoderFormat.BC3],engineFormat:[BasisTextureLoader.EngineFormat.RGB_S3TC_DXT1_Format,
BasisTextureLoader.EngineFormat.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[BasisTextureLoader.BasisFormat.ETC1S,BasisTextureLoader.BasisFormat.UASTC_4x4],transcoderFormat:[BasisTextureLoader.TranscoderFormat.ETC1,BasisTextureLoader.TranscoderFormat.ETC2],engineFormat:[BasisTextureLoader.EngineFormat.RGB_ETC2_Format,BasisTextureLoader.EngineFormat.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",
basisFormat:[BasisTextureLoader.BasisFormat.ETC1S,BasisTextureLoader.BasisFormat.UASTC_4x4],transcoderFormat:[BasisTextureLoader.TranscoderFormat.ETC1,BasisTextureLoader.TranscoderFormat.ETC1],engineFormat:[BasisTextureLoader.EngineFormat.RGB_ETC1_Format,BasisTextureLoader.EngineFormat.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[BasisTextureLoader.BasisFormat.ETC1S,BasisTextureLoader.BasisFormat.UASTC_4x4],transcoderFormat:[BasisTextureLoader.TranscoderFormat.PVRTC1_4_RGB,
BasisTextureLoader.TranscoderFormat.PVRTC1_4_RGBA],engineFormat:[BasisTextureLoader.EngineFormat.RGB_PVRTC_4BPPV1_Format,BasisTextureLoader.EngineFormat.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}];
BasisTextureLoader.BasisWorker=function(){function a(T){C=(new Promise(fa=>{I={wasmBinary:T,onRuntimeInitialized:fa};BASIS(I)})).then(()=>{I.initializeBasis()})}function e(T){function fa(){sa.close();sa.delete()}let sa=new I.BasisFile(new Uint8Array(T));var wa=sa.isUASTC()?O.UASTC_4x4:O.ETC1S;T=sa.getImageWidth(0,0);let U=sa.getImageHeight(0,0),qa=sa.getNumLevels(0),M=sa.getHasAlpha(),{transcoderFormat:Q,engineFormat:V}=h(wa,T,U,M);if(!T||!U||!qa)throw fa(),Error("BasisTextureLoader Error : Invalid texture (Could be a 404 error)");
if(!sa.startTranscoding())throw fa(),Error("BasisTextureLoader Error: .startTranscoding failed");wa=[];for(let ca=0;ca<qa;ca++){let za=sa.getImageWidth(0,ca),ta=sa.getImageHeight(0,ca),Ka=new Uint8Array(sa.getImageTranscodedSizeInBytes(0,ca,Q));if(!sa.transcodeImage(Ka,0,ca,Q,0,M))throw fa(),Error("BasisTextureLoader: .transcodeImage failed.");wa.push({data:Ka,width:za,height:ta})}fa();return{width:T,height:U,hasAlpha:M,mipmaps:wa,format:V}}function h(T,fa,sa,wa){let U=T===O.ETC1S?W:ea;for(let qa=
0;qa<U.length;qa++){let M=U[qa];if(y[M.if]&&M.basisFormat.includes(T)&&(!M.needsPowerOfTwo||(2>=fa||0===(fa&fa-1)&&0!==fa)&&(2>=sa||0===(sa&sa-1)&&0!==sa)))return T=M.transcoderFormat[wa?1:0],wa=M.engineFormat[wa?1:0],{transcoderFormat:T,engineFormat:wa}}console.warn("BasisTextureLoader: No suitable compressed texture format found. Decoding to RGBA32.");T=H.RGBA32;wa=E.RGBAFormat;return{transcoderFormat:T,engineFormat:wa}}function m(T,fa){if(!T)throw Error(fa);}function t(T,fa,sa){let wa=I.getBytesPerBlockOrPixel(T);
return I.formatIsUncompressed(T)?fa*sa*wa:T===H.PVRTC1_4_RGB||T===H.PVRTC1_4_RGBA?(Math.max(8,fa+3&-4)*Math.max(8,sa+3&-4)*4+7)/8:Math.ceil(fa/I.getFormatBlockWidth(T))*Math.ceil(sa/I.getFormatBlockHeight(T))*wa}let y,C,I,E=_EngineFormat,H=_TranscoderFormat,O=_BasisFormat;onmessage=function(T){let fa=T.data;switch(fa.type){case "init":y=fa.config;a(fa.transcoderBinary);break;case "transcode":C.then(()=>{try{if(fa.taskConfig.lowLevel){var sa=fa.taskConfig;let {basisFormat:ta,width:Ka,height:cb,hasAlpha:gb}=
sa,{transcoderFormat:Ya,engineFormat:na}=h(ta,Ka,cb,gb),Ia=I.getBytesPerBlockOrPixel(Ya);m(I.isFormatSupported(Ya),"BasisTextureLoader: Unsupported format.");let Na=[];if(ta===O.ETC1S){var wa=new I.LowLevelETC1SImageTranscoder;let {endpointCount:$a,endpointsData:rb,selectorCount:lb,selectorsData:jb,tablesData:yb}=sa.globalData;try{let wb;wb=wa.decodePalettes($a,rb,lb,jb);m(wb,"BasisTextureLoader: decodePalettes() failed.");wb=wa.decodeTables(yb);m(wb,"BasisTextureLoader: decodeTables() failed.");
for(var U=0;U<sa.levels.length;U++){let Bb=sa.levels[U],Tb=sa.globalData.imageDescs[U],Ob=t(Ya,Bb.width,Bb.height),Ab=new Uint8Array(Ob);wb=wa.transcodeImage(Ya,Ab,Ob/Ia,Bb.data,Math.ceil(Bb.width/I.getFormatBlockWidth(Ya)),Math.ceil(Bb.height/I.getFormatBlockHeight(Ya)),Bb.width,Bb.height,Bb.index,Tb.rgbSliceByteOffset,Tb.rgbSliceByteLength,Tb.alphaSliceByteOffset,Tb.alphaSliceByteLength,Tb.imageFlags,gb,!1,0,0);m(wb,"BasisTextureLoader: transcodeImage() failed for level "+Bb.index+".");Na.push({data:Ab,
width:Bb.width,height:Bb.height})}}finally{wa.delete()}}else for(wa=0;wa<sa.levels.length;wa++){U=sa.levels[wa];let $a=t(Ya,U.width,U.height),rb=new Uint8Array($a),lb=I.transcodeUASTCImage(Ya,rb,$a/Ia,U.data,Math.ceil(U.width/I.getFormatBlockWidth(Ya)),Math.ceil(U.height/I.getFormatBlockHeight(Ya)),U.width,U.height,U.index,0,U.data.byteLength,0,gb,!1,0,0,-1,-1);m(lb,"BasisTextureLoader: transcodeUASTCImage() failed for level "+U.index+".");Na.push({data:rb,width:U.width,height:U.height})}var qa={width:Ka,
height:cb,hasAlpha:gb,mipmaps:Na,format:na}}else qa=e(fa.buffers[0]);let {width:M,height:Q,hasAlpha:V,mipmaps:ca,format:za}=qa;qa=[];for(sa=0;sa<ca.length;++sa)qa.push(ca[sa].data.buffer);self.postMessage({type:"transcode",id:fa.id,width:M,height:Q,hasAlpha:V,mipmaps:ca,format:za},qa)}catch(M){console.warn(M),self.postMessage({type:"error",id:fa.id,error:M.message})}})}};let R=[{if:"astcSupported",basisFormat:[O.UASTC_4x4],transcoderFormat:[H.ASTC_4x4,H.ASTC_4x4],engineFormat:[E.RGBA_ASTC_4x4_Format,
E.RGBA_ASTC_4x4_Format],priorityETC1S:Infinity,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[O.ETC1S,O.UASTC_4x4],transcoderFormat:[H.BC7_M5,H.BC7_M5],engineFormat:[E.RGBA_BPTC_Format,E.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[O.ETC1S,O.UASTC_4x4],transcoderFormat:[H.BC1,H.BC3],engineFormat:[E.RGB_S3TC_DXT1_Format,E.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[O.ETC1S,
O.UASTC_4x4],transcoderFormat:[H.ETC1,H.ETC2],engineFormat:[E.RGB_ETC2_Format,E.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[O.ETC1S,O.UASTC_4x4],transcoderFormat:[H.ETC1,H.ETC1],engineFormat:[E.RGB_ETC1_Format,E.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[O.ETC1S,O.UASTC_4x4],transcoderFormat:[H.PVRTC1_4_RGB,H.PVRTC1_4_RGBA],engineFormat:[E.RGB_PVRTC_4BPPV1_Format,E.RGBA_PVRTC_4BPPV1_Format],
priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],W=R.sort(function(T,fa){return T.priorityETC1S-fa.priorityETC1S}),ea=R.sort(function(T,fa){return T.priorityUASTC-fa.priorityUASTC})};class GLTFJson{}class GLTFParams{}
class GLTFParser{constructor(a,e){this.cache=new GLTFRegistry;this.associations=new Map;this.meshCache={refs:{},uses:{}};this.cameraCache={refs:{},uses:{}};this.lightCache={refs:{},uses:{}};this.textureCache={};this.nodeNamesUsed={};this.hasLight=this.isVisualizeAssembly=this.isSolidworksAssembly=!1;this.json=a||{};this.extensions={};this.options=e||{};this.cache=new GLTFRegistry;this.nodeNamesUsed={};this.primitiveCache={};"undefined"===typeof createImageBitmap||!1!==/Firefox/.test(navigator.userAgent)||
Config.IN_TEST_WINDOW?this.textureLoader=new THREE.TextureLoader(this.options.manager):this.textureLoader=new THREE.ImageBitmapLoader(this.options.manager);this.textureLoader.setCrossOrigin(this.options.crossOrigin);this.textureLoader.setRequestHeader(this.options.requestHeader);this.isSolidworksAssembly=a.asset&&a.asset.generator&&"solidworksgltf"===a.asset.generator.toLowerCase();this.isVisualizeAssembly=a.asset&&a.asset.generator&&"visualizegltf"===a.asset.generator.toLowerCase();this.fileLoader=
new THREE.FileLoader(this.options.manager);this.fileLoader.setResponseType("arraybuffer");this.basisLoader=new BasisTextureLoader(THREE.DefaultLoadingManager);this.basisLoader.transcoderPath="static/js/basis/";this.basisLoader.detectSupport(View3D.inst.renderer);"use-credentials"===this.options.crossOrigin&&(this.fileLoader.setWithCredentials(!0),this.basisLoader.setWithCredentials(!0))}setExtensions(a){this.extensions=a}setPlugins(a){this.plugins=a}parse(a,e){this.cache.removeAll();this._invokeAll(h=>
h._markDefs&&h._markDefs());Promise.all([this.getDependencies("scene"),this.getDependencies("animation")]).then(h=>{h={scene:h[0][this.json.scene||0],scenes:h[0],animations:h[1],asset:this.json.asset,parser:this,userData:{}};GLTFUtils.addUnknownExtensionsToUserData(this.extensions,h,this.json);GLTFUtils.assignExtrasToUserData(h,this.json);a(h)}).catch(e)}_markDefs(){let a=this.json.nodes||[];var e=this.json.skins||[];let h=this.json.meshes||[];for(let m=0,t=e.length;m<t;m++){let y=e[m].joints;for(let C=
0,I=y.length;C<I;C++)a[y[C]].isBone=!0}for(let m=0,t=a.length;m<t;m++)e=a[m],void 0!==e.mesh&&(this._addNodeRef(this.meshCache,e.mesh),void 0!==e.skin&&(h[e.mesh].isSkinnedMesh=!0))}_addNodeRef(a,e){void 0!==e&&(void 0===a.refs[e]&&(a.refs[e]=a.uses[e]=0),a.refs[e]++)}_getNodeRef(a,e,h){if(1>=a.refs[e])return h;h=h.clone();h.name+="_instance_"+a.uses[e]++;return h}_invokeOne(a){let e=Object.values(this.plugins);e.push(this);for(let h=0;h<e.length;h++){let m=a(e[h]);if(m)return m}return null}_invokeAll(a){let e=
Object.values(this.plugins);e.unshift(this);let h=[];for(let m=0;m<e.length;m++){let t=a(e[m]);t&&h.push(t)}return h}getDependency(a,e){let h=a+":"+e,m=this.cache.get(h);if(!m){switch(a){case "scene":m=this.loadScene(e);break;case "node":m=this.loadNode(e);break;case "mesh":m=this._invokeOne(t=>t.loadMesh&&t.loadMesh(e));break;case "accessor":m=this.loadAccessor(e);break;case "bufferView":m=this._invokeOne(t=>t.loadBufferView&&t.loadBufferView(e));break;case "buffer":m=this.loadBuffer(e);break;case "material":m=
this._invokeOne(t=>t.loadMaterial&&t.loadMaterial(e));break;case "texture":m=this._invokeOne(t=>t.loadTexture&&t.loadTexture(e));break;case "skin":m=this.loadSkin(e);break;case "animation":m=this.loadAnimation(e);break;case "camera":m=this.loadCamera(e);break;default:throw Error("Unknown type: "+a);}this.cache.add(h,m)}return m}getDependencies(a){let e=this.cache.get(a);e||(e=Promise.all((this.json[a+("mesh"===a?"es":"s")]||[]).map((h,m)=>this.getDependency(a,m))),this.cache.add(a,e));return e}loadBuffer(a){let e=
this.json.buffers[a],h=this.fileLoader;if(e.type&&"arraybuffer"!==e.type)throw Error("GLTFLoader: "+e.type+" buffer type is not supported.");if(void 0===e.uri&&0===a)return Promise.resolve(this.extensions[GLTFUtils.GLTF_EXTENSION.KHR_BINARY_GLTF].body);let m=this.options;return new Promise((t,y)=>{let C=GLTFUtils.resolveURL(e.uri,Config.DATA_FOLDER+"3D/"+m.basename+"/");this.options.ignoreDataPath&&(C=GLTFUtils.resolveURL(e.uri,this.options.path));h.load(C,t,void 0,()=>{y(Error('GLTFLoader: Failed to load buffer "'+
C+'".'))})})}loadBufferView(a){let e=this.json.bufferViews[a];return this.getDependency("buffer",e.buffer).then(h=>{let m=e.byteOffset||0;return h.slice(m,m+(e.byteLength||0))})}loadAccessor(a){let e=this.json.accessors[a];if(void 0===e.bufferView&&void 0===e.sparse)return Promise.resolve(null);a=[];void 0!==e.bufferView?a.push(this.getDependency("bufferView",e.bufferView)):a.push(null);void 0!==e.sparse&&(a.push(this.getDependency("bufferView",e.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",
e.sparse.values.bufferView)));return Promise.all(a).then(h=>{var m=h[0];let t=GLTFUtils.WEBGL_TYPE_SIZES[e.type],y=GLTFUtils.WEBGL_COMPONENT_TYPES[e.componentType];var C=y.BYTES_PER_ELEMENT,I=e.byteOffset||0,E=void 0!==e.bufferView?this.json.bufferViews[e.bufferView].byteStride:void 0;let H=!0===e.normalized;if(E&&E!==C*t){var O=Math.floor(I/E);let R="InterleavedBuffer:"+e.bufferView+":"+e.componentType+":"+O+":"+e.count,W=this.cache.get(R);W||(O=new y(m,O*E,e.count*E/C),W=new THREE.InterleavedBuffer(O,
E/C),this.cache.add(R,W));C=new THREE.InterleavedBufferAttribute(W,t,I%E/C,H)}else O=null===m?new y(e.count*t):new y(m,I,e.count*t),C=new THREE.BufferAttribute(O,t,H);if(void 0!==e.sparse){E=e.sparse.values.byteOffset||0;I=new GLTFUtils.WEBGL_COMPONENT_TYPES[e.sparse.indices.componentType](h[1],e.sparse.indices.byteOffset||0,e.sparse.count*GLTFUtils.WEBGL_TYPE_SIZES.SCALAR);h=new y(h[2],E,e.sparse.count*t);null!==m&&(C=new THREE.BufferAttribute(C.array.slice(),C.itemSize,C.normalized));for(let R=
0,W=I.length;R<W;R++)if(m=I[R],C.setX(m,h[R*t]),2<=t&&C.setY(m,h[R*t+1]),3<=t&&C.setZ(m,h[R*t+2]),4<=t&&C.setW(m,h[R*t+3]),5<=t)throw Error("GLTFLoader: Unsupported itemSize in sparse BufferAttribute.");}return C})}loadTexture(a){let e=this.json.textures[a];return this.loadTextureImage(a,e.source,this.textureLoader,!!(e.extensions||{})[GLTFUtils.GLTF_EXTENSION.KHR_TEXTURE_BASISU])}loadTextureImage(a,e,h,m){return __awaiter(this,void 0,void 0,function*(){try{const I=this.json.textures[a],E=this.json.images[e],
H=(E.uri||E.bufferView)+":"+I.sampler;if(this.textureCache[H])return this.textureCache[H];const O=self.URL||self.webkitURL;let R=E.uri;var t=0===(null===R||void 0===R?void 0:R.search(/^data:/));let W;if(!t)if(this.options.ignoreDataPath){var y=this.options.path+E.uri;W=this.options.path+E.uri}else y=Config.DATA_FOLDER+"3D/"+this.options.basename+"/std/"+E.uri,W=Config.DATA_FOLDER+"3D/"+this.options.basename+"/uhd/"+E.uri;let ea=!1,T=!0;var C=R&&(0<R.search(/\.jpe?g($|\?)/i)||0===R.search(/^data:image\/jpeg/));
if("image/jpeg"===E.mimeType||C)T=!1;let fa;void 0!==E.bufferView?(W=this.getDependency("bufferView",E.bufferView).then(sa=>{if("image/png"===E.mimeType){const wa=(new DataView(sa,25,1)).getUint8(0,!1);T=6===wa||4===wa||3===wa}ea=!0;sa=new Blob([sa],{type:E.mimeType});return W=O.createObjectURL(sa)}),fa=this.loadImageFile(h,W)):(C="",Config.basisComrpessed?(t=y,y=W,t=t.substr(0,t.lastIndexOf("."))+".basis",y=y.substr(0,y.lastIndexOf("."))+".basis",C=yield this.getCorrectUrl(t,y),fa=this.loadImageFile(this.basisLoader,
C)):Config.basisComrpessed&&null!=fa||(C=t?E.uri:yield this.getCorrectUrl(y,W),fa=this.loadImageFile(h,C)));if(fa)return fa.then(sa=>{!0===ea&&O.revokeObjectURL(R);return this.finalizeTexture(sa,I,T,a)}),this.textureCache[H]=fa}catch(I){console.log("Error retrieving textures",I)}})}fileExist(a){return __awaiter(this,void 0,void 0,function*(){if(navigator.onLine)return new Promise((e,h)=>{try{let m=new XMLHttpRequest;m.onreadystatechange=()=>{4==m.readyState&&e(404!=m.status)};m.open("HEAD",a,!0);
m.send()}catch(m){e(!1)}});try{return yield CacheService.inst.fileExist(a)}catch(e){return!1}})}getCorrectUrl(a,e){return __awaiter(this,void 0,void 0,function*(){let h=Device.isPhone()||Device.isTablet()||Device.getMaxResolutionFlag()!==ResolutionFlags.UHD?a:e,m=h==e?a:e,t=yield this.fileExist(h);return t||(h=m,t=yield this.fileExist(h),t)?h:(console.warn("*404 : Texture",h,"doesn't exist"),null)})}loadImageFile(a,e){return Promise.resolve(e).then(h=>(new Promise((m,t)=>{let y=m;!0===a.isImageBitmapLoader&&
(y=C=>{C=new THREE.Texture(C);C.needsUpdate=!0;m(C)});a.load(h,y,void 0,t)})).catch(m=>{console.log("Unable to load texture",m);return null})).catch(h=>{console.log("Unable to load texture",h);return null})}finalizeTexture(a,e,h,m){if(a){void 0!==e.name&&(a.name=e.name);let t=(this.json.samplers||{})[e.sampler]||{};Config.basisComrpessed?(a.magFilter=THREE.LinearFilter,a.minFilter=THREE.LinearFilter):(a.flipY=!1,e.name&&(a.name=e.name),h||(a.format=THREE.RGBFormat),a.magFilter=GLTFUtils.WEBGL_FILTERS[t.magFilter]||
THREE.LinearFilter,a.minFilter=GLTFUtils.WEBGL_FILTERS[t.minFilter]||THREE.LinearMipmapLinearFilter);a.wrapS=GLTFUtils.WEBGL_WRAPPINGS[t.wrapS]||THREE.RepeatWrapping;a.wrapT=GLTFUtils.WEBGL_WRAPPINGS[t.wrapT]||THREE.RepeatWrapping;this.associations.set(a,{type:"textures",index:m})}return a}assignTexture(a,e,h){let m=this.getDependency("texture",h.index);return m?m.then(t=>{if(t){void 0===h.texCoord||0==h.texCoord||"aoMap"===e&&1==h.texCoord||console.warn("GLTFLoader: Custom UV set "+h.texCoord+" for texture "+
e+" not yet supported.");if(this.extensions[GLTFUtils.GLTF_EXTENSION.KHR_TEXTURE_TRANSFORM]){const y=void 0!==h.extensions?h.extensions[GLTFUtils.GLTF_EXTENSION.KHR_TEXTURE_TRANSFORM]:void 0;if(y){const C=this.associations.get(t);t=this.extensions[GLTFUtils.GLTF_EXTENSION.KHR_TEXTURE_TRANSFORM].extendTexture(t,y);this.associations.set(t,C)}}return a[e]=t}}):a[e]=null}assignFinalMaterial(a){var e,h,m,t,y;let C=a.geometry,I=a.material,E=void 0!==(null===(e=C.attributes)||void 0===e?void 0:e.tangent);
e=void 0!==(null===(h=C.attributes)||void 0===h?void 0:h.color);h=void 0===(null===(m=C.attributes)||void 0===m?void 0:m.normal);if(a.isPoints){m="PointsMaterial:"+I.uuid;var H=this.cache.get(m);H||(H=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(H,I),H.color.copy(I.color),H.map=I.map,H.sizeAttenuation=!1,this.cache.add(m,H));I=H}else a.isLine&&(m="LineBasicMaterial:"+I.uuid,H=this.cache.get(m),H||(H=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(H,I),H.color.copy(I.color),
this.cache.add(m,H)),I=H);if(E||e||h)m="ClonedMaterial:"+I.uuid+":",I.isGLTFSpecularGlossinessMaterial&&(m+="specular-glossiness:"),E&&(m+="vertex-tangents:"),e&&(m+="vertex-colors:"),h&&(m+="flat-shading:"),H=this.cache.get(m),H||(H=I.clone(),e&&(H.vertexColors=!0),h&&(H.flatShading=!0),E&&(H.normalScale&&(H.normalScale.y*=-1),H.clearcoatNormalScale&&(H.clearcoatNormalScale.y*=-1)),this.cache.add(m,H),this.associations.set(H,this.associations.get(I))),I=H;I.aoMap&&void 0===(null===(t=C.attributes)||
void 0===t?void 0:t.uv2)&&void 0!==(null===(y=C.attributes)||void 0===y?void 0:y.uv)&&C.setAttribute("uv2",C.attributes.uv);a.material=I}getMaterialType(){return THREE.MeshStandardMaterial}loadMaterial(a){const e=this;let h=this.json.materials[a],m,t={};var y=h.extensions||{};let C=[],I;y[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS]?(I=this.extensions[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS],m=I.getMaterialType(),I.getMaterialParam(t,y,C,this)):y[GLTFUtils.GLTF_EXTENSION.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]?
(I=this.extensions[GLTFUtils.GLTF_EXTENSION.GLTF_MATERIALS_PBR_METALLIC_ROUGHNESS],m=I.getMaterialType(h),I.convertSGtoMR(h,t),C.push(I.extendParams(t,h,this))):y[GLTFUtils.GLTF_EXTENSION.KHR_MATERIALS_UNLIT]?(y=this.extensions[GLTFUtils.GLTF_EXTENSION.KHR_MATERIALS_UNLIT],m=y.getMaterialType(h),C.push(y.extendParams(t,h,this))):(I=this.extensions[GLTFUtils.GLTF_EXTENSION.GLTF_MATERIALS_PBR_METALLIC_ROUGHNESS],m=I.getMaterialType(h),C.push(I.extendParams(t,h,this)));!0===h.doubleSided&&(t.side=THREE.DoubleSide);
y=h.alphaMode||GLTFUtils.ALPHA_MODES.OPAQUE;y===GLTFUtils.ALPHA_MODES.BLEND||this.options.manageAlpha?(t.transparent=!0,t.alphaTest=Config.ALPHA_TEST,t.blending=THREE.CustomBlending):(t.blending=THREE.NoBlending,t.transparent=!1,y===GLTFUtils.ALPHA_MODES.MASK&&(t.alphaTest=void 0!==h.alphaCutoff?h.alphaCutoff:Config.ALPHA_TEST));void 0!==h.normalTexture&&m!==THREE.MeshBasicMaterial&&(C.push(this.assignTexture(t,"normalMap",h.normalTexture)),t.normalScale=new THREE.Vector2(1,-1),void 0!==h.normalTexture.scale&&
t.normalScale.set(h.normalTexture.scale,-h.normalTexture.scale));void 0!==h.occlusionTexture&&m!==THREE.MeshBasicMaterial&&(C.push(this.assignTexture(t,"aoMap",h.occlusionTexture)),void 0!==h.occlusionTexture.strength&&(t.aoMapIntensity=h.occlusionTexture.strength));void 0!==h.emissiveFactor&&m!==THREE.MeshBasicMaterial&&(t.emissive=(new THREE.Color).fromArray(h.emissiveFactor));void 0!==h.emissiveTexture&&m!==THREE.MeshBasicMaterial&&C.push(this.assignTexture(t,"emissiveMap",h.emissiveTexture));
return Promise.all(C).then(()=>{let E;E=m===GLTFMeshStandardSGMaterial?this.extensions[GLTFUtils.GLTF_EXTENSION.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(t):new m(t);void 0!==h.name&&(E.name=h.name);E.map&&(E.map.encoding=this.options.textureEncoding);E.emissiveMap&&(E.emissiveMap.encoding=this.options.textureEncoding);GLTFUtils.assignExtrasToUserData(E,h);this.associations.set(E,{type:"materials",index:a});h.extensions&&GLTFUtils.addUnknownExtensionsToUserData(e.extensions,E,h);t.roughness&&
(E.roughness=t.roughness,e.isSolidworksAssembly&&(E.roughness=Math.min(1,Math.max(.4,1.3*E.roughness))));t.metalness&&(E.metalness=t.metalness);E.userData.baseOpacity=t.opacity;return E})}createUniqueName(a){let e=a=THREE.PropertyBinding.sanitizeNodeName(a||"");for(let h=1;this.nodeNamesUsed[e];++h)e=a+"_"+h;this.nodeNamesUsed[e]=!0;return e}loadGeometries(a){function e(y,C){return this.extensions[GLTFUtils.GLTF_EXTENSION.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(y,C).then(I=>C.addPrimitiveAttributes(I,
y,C))}let h=this.primitiveCache,m=[];for(let y=0,C=a.length;y<C;y++){let I=a[y],E=GLTFUtils.createPrimitiveKey(I);var t=h[E];t?m.push(t.promise):(t=I.extensions&&I.extensions[GLTFUtils.GLTF_EXTENSION.KHR_DRACO_MESH_COMPRESSION]?e(I,this):this.addPrimitiveAttributes(new THREE.BufferGeometry,I,this),h[E]={primitive:I,promise:t},m.push(t))}return Promise.all(m)}loadMesh(a){let e=this.extensions,h=this.json.meshes[a],m=h.primitives,t=[];for(let y=0,C=m.length;y<C;y++){let I=void 0===m[y].material?GLTFUtils.createDefaultMaterial(this.cache):
this.getDependency("material",m[y].material);t.push(I)}t.push(this.loadGeometries(m));return Promise.all(t).then(y=>{var C=y.slice(0,y.length-1);let I=y[y.length-1];y=[];for(let H=0,O=I.length;H<O;H++){var E=I[H];let R=m[H],W=C[H];if(R.mode===GLTFUtils.WEBGL_CONSTANTS.TRIANGLES||R.mode===GLTFUtils.WEBGL_CONSTANTS.TRIANGLE_STRIP||R.mode===GLTFUtils.WEBGL_CONSTANTS.TRIANGLE_FAN||void 0===R.mode){E=!0===h.isSkinnedMesh?new THREE.SkinnedMesh(E,W):new THREE.Mesh(E,W);if(Config.basisComrpessed){const ea=
E.geometry.attributes.uv;for(let T=0;T<ea.count;T++)ea.setY(T,1-ea.getY(T))}!0!==E.isSkinnedMesh||E.geometry.attributes.skinWeight.normalized||E.normalizeSkinWeights();R.mode===GLTFUtils.WEBGL_CONSTANTS.TRIANGLE_STRIP?E.geometry=this.toTrianglesDrawMode(E.geometry,THREE.TriangleStripDrawMode):R.mode===GLTFUtils.WEBGL_CONSTANTS.TRIANGLE_FAN&&(E.geometry=this.toTrianglesDrawMode(E.geometry,THREE.TriangleFanDrawMode))}else if(R.mode===GLTFUtils.WEBGL_CONSTANTS.LINES)E=new THREE.LineSegments(E,W);else if(R.mode===
GLTFUtils.WEBGL_CONSTANTS.LINE_STRIP)E=new THREE.Line(E,W);else if(R.mode===GLTFUtils.WEBGL_CONSTANTS.LINE_LOOP)E=new THREE.LineLoop(E,W);else if(R.mode===GLTFUtils.WEBGL_CONSTANTS.POINTS)E=new THREE.Points(E,W);else throw Error("GLTFLoader: Primitive mode unsupported: "+R.mode);E.geometry&&E.geometry.morphAttributes&&0<Object.keys(E.geometry.morphAttributes).length&&GLTFUtils.updateMorphTargets(E,h);E.name=this.createUniqueName(h.name||"mesh_"+a);GLTFUtils.assignExtrasToUserData(E,h);R.extensions&&
GLTFUtils.addUnknownExtensionsToUserData(e,E,R);this.assignFinalMaterial(E);E.renderOrder=W.transparent?Config.RENDER_ORDER_TRANSPARENT++:Config.RENDER_ORDER_OPAQUE++;y.push(E)}if(1===y.length)return y[0];C=new THREE.Group;for(let H=0,O=y.length;H<O;H++)C.add(y[H]);return C})}loadCamera(a){}loadSkin(a){a=this.json.skins[a];let e={joints:a.joints};return void 0===a.inverseBindMatrices?Promise.resolve(e):this.getDependency("accessor",a.inverseBindMatrices).then(h=>{e.inverseBindMatrices=h;return e})}loadAnimation(a){let e=
this.json.animations[a],h=[],m=[],t=[],y=[],C=[];for(let E=0,H=e.channels.length;E<H;E++){var I=e.channels[E];let O=e.samplers[I.sampler];I=I.target;let R=void 0!==e.parameters?e.parameters[O.input]:O.input,W=void 0!==e.parameters?e.parameters[O.output]:O.output;h.push(this.getDependency("node",void 0!==I.node?I.node:I.id));m.push(this.getDependency("accessor",R));t.push(this.getDependency("accessor",W));y.push(O);C.push(I)}return Promise.all([Promise.all(h),Promise.all(m),Promise.all(t),Promise.all(y),
Promise.all(C)]).then(E=>{let H=E[0],O=E[1],R=E[2],W=E[3];E=E[4];let ea=[];for(let wa=0,U=H.length;wa<U;wa++){var T=H[wa];let qa=O[wa];var fa=R[wa];let M=W[wa],Q=E[wa];if(void 0===T)continue;T.updateMatrix();T.matrixAutoUpdate=!0;let V;switch(GLTFUtils.PATH_PROPERTIES[Q.path]){case GLTFUtils.PATH_PROPERTIES.weights:V=THREE.NumberKeyframeTrack;break;case GLTFUtils.PATH_PROPERTIES.rotation:V=THREE.QuaternionKeyframeTrack;break;default:V=THREE.VectorKeyframeTrack}var sa=T.name?T.name:T.uuid;let ca=void 0!==
M.interpolation?GLTFUtils.INTERPOLATION[M.interpolation]:THREE.InterpolateLinear,za=[];GLTFUtils.PATH_PROPERTIES[Q.path]===GLTFUtils.PATH_PROPERTIES.weights?T.traverse(ta=>{ta.morphTargetInfluences&&za.push(ta.name?ta.name:ta.uuid)}):za.push(sa);T=fa.array;if(fa.normalized){fa=GLTFUtils.getNormalizedComponentScale(T.constructor);sa=new Float32Array(T.length);for(let ta=0,Ka=T.length;ta<Ka;ta++)sa[ta]=T[ta]*fa;T=sa}for(let ta=0,Ka=za.length;ta<Ka;ta++)fa=new V(za[ta]+"."+GLTFUtils.PATH_PROPERTIES[Q.path],
qa.array,T,ca),"CUBICSPLINE"===M.interpolation&&(fa.createInterpolant=function(cb){return new (this instanceof THREE.QuaternionKeyframeTrack?GLTFCubicSplineQuaternionInterpolant:GLTFCubicSplineInterpolant)(this.times,this.values,this.getValueSize()/3,cb)},fa.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),ea.push(fa)}return new THREE.AnimationClip(void 0!==e.name?e.name:"animation_"+a,void 0,ea)})}createNodeMesh(a){const e=this,h=this.json.nodes[a];return void 0===h.mesh?null:e.getDependency("mesh",
h.mesh).then(m=>{m=e._getNodeRef(e.meshCache,h.mesh,m);void 0!==h.weights&&m.traverse(t=>{if(t.isMesh)for(let y=0,C=h.weights.length;y<C;y++)t.morphTargetInfluences[y]=h.weights[y]});return m})}loadNode(a){let e=this.extensions;const h=this;let m=this.json.nodes[a],t=m.name?this.createUniqueName(m.name):"";return function(){let y=[];const C=h._invokeOne(I=>I.createNodeMesh&&I.createNodeMesh(a));C&&y.push(C);h._invokeAll(function(I){return I.createNodeAttachment&&I.createNodeAttachment(a)}).forEach(I=>
{y.push(I)});return Promise.all(y)}().then(y=>{let C;C=!0===m.isBone?new THREE.Bone:1<y.length?new THREE.Group:1===y.length?y[0]:new THREE.Object3D;if(C!==y[0])for(let I=0,E=y.length;I<E;I++)C.add(y[I]);m.name&&(C.userData.name=m.name,C.name=t);GLTFUtils.assignExtrasToUserData(C,m);m.extensions&&GLTFUtils.addUnknownExtensionsToUserData(e,C,m);void 0!==m.matrix?(y=new THREE.Matrix4,y.fromArray(m.matrix),C.applyMatrix4(y)):(void 0!==m.translation&&C.position.fromArray(m.translation),void 0!==m.rotation&&
C.quaternion.fromArray(m.rotation),void 0!==m.scale&&C.scale.fromArray(m.scale));this.associations.set(C,{type:"nodes",index:a});return C})}loadScene(a){let e=this.json;var h=this.extensions;a=this.json.scenes[a];let m=new THREE.Group;void 0!==a.name&&(m.name=this.createUniqueName(a.name));GLTFUtils.assignExtrasToUserData(m,a);a.extensions&&GLTFUtils.addUnknownExtensionsToUserData(h,m,a);h=a.nodes||[];a=[];for(let t=0,y=h.length;t<y;t++)a.push(this.buildNodeHierachy(h[t],m,e,this));return Promise.all(a).then(()=>
{m.userData.hasLight=this.hasLight;m.userData.isSolidworksAssembly=this.isSolidworksAssembly;m.userData.isVisualizeAssembly=this.isVisualizeAssembly;return m})}buildNodeHierachy(a,e,h,m){let t=h.nodes[a];return m.getDependency("node",a).then(y=>{if(void 0===t.skin)return y;let C;return m.getDependency("skin",t.skin).then(I=>{C=I;I=[];for(let E=0,H=C.joints.length;E<H;E++)I.push(m.getDependency("node",C.joints[E]));return Promise.all(I)}).then(I=>{y.traverse(E=>{if(E.isMesh){var H=[],O=[];for(let W=
0,ea=I.length;W<ea;W++){var R=I[W];R?(H.push(R),R=new THREE.Matrix4,void 0!==C.inverseBindMatrices&&R.fromArray(C.inverseBindMatrices.array,16*W),O.push(R)):console.warn('GLTFLoader: Joint "%s" could not be found.',C.joints[W])}E.bind(new THREE.Skeleton(H,O),E.matrixWorld)}});return y})}).then(y=>{e.add(y);let C=[];if(t.children){let I=t.children;for(let E=0,H=I.length;E<H;E++)C.push(m.buildNodeHierachy(I[E],y,h,m))}return Promise.all(C)})}computeBounds(a,e,h){var m=e.attributes;let t=new THREE.Box3;
if(void 0!==m.POSITION){m=h.json.accessors[m.POSITION];var y=m.min,C=m.max;if(void 0!==y&&void 0!==C){t.set(new THREE.Vector3(y[0],y[1],y[2]),new THREE.Vector3(C[0],C[1],C[2]));m.normalized&&(m=GLTFUtils.getNormalizedComponentScale(GLTFUtils.WEBGL_COMPONENT_TYPES[m.componentType]),t.min.multiplyScalar(m),t.max.multiplyScalar(m));e=e.targets;if(void 0!==e){m=new THREE.Vector3;y=new THREE.Vector3;for(let I=0,E=e.length;I<E;I++)if(C=e[I],void 0!==C.POSITION){C=h.json.accessors[C.POSITION];let H=C.min,
O=C.max;void 0!==H&&void 0!==O?(y.setX(Math.max(Math.abs(H[0]),Math.abs(O[0]))),y.setY(Math.max(Math.abs(H[1]),Math.abs(O[1]))),y.setZ(Math.max(Math.abs(H[2]),Math.abs(O[2]))),C.normalized&&(C=GLTFUtils.getNormalizedComponentScale(GLTFUtils.WEBGL_COMPONENT_TYPES[C.componentType]),y.multiplyScalar(C)),m.max(y)):console.warn("GLTFLoader: Missing min/max properties for accessor POSITION.")}t.expandByVector(m)}a.boundingBox=t;h=new THREE.Sphere;t.getCenter(h.center);h.radius=t.min.distanceTo(t.max)/2;
a.boundingSphere=h}else console.warn("GLTFLoader: Missing min/max properties for accessor POSITION.")}}addPrimitiveAttributes(a,e,h){function m(C,I){return h.getDependency("accessor",C).then(E=>{a.setAttribute(I,E)})}var t=e.attributes;let y=[];for(let C in t){let I=GLTFUtils.ATTRIBUTES[C]||C.toLowerCase();I&&(I in a.attributes||y.push(m(t[C],I)))}void 0===e.indices||a.index||(t=h.getDependency("accessor",e.indices).then(C=>{a.setIndex(C)}),y.push(t));GLTFUtils.assignExtrasToUserData(a,e);this.computeBounds(a,
e,h);return Promise.all(y).then(()=>void 0!==e.targets?GLTFUtils.addMorphTargets(a,e.targets,h):a)}toTrianglesDrawMode(a,e){var h=a.getIndex();if(null===h){var m=[];h=a.getAttribute("position");if(void 0!==h){for(var t=0;t<h.count;t++)m.push(t);a.setIndex(m);h=a.getIndex()}else return console.error("GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),a}t=h.count-2;m=[];if(e===THREE.TriangleFanDrawMode)for(e=1;e<=t;e++)m.push(h.getX(0)),m.push(h.getX(e)),m.push(h.getX(e+
1));else for(e=0;e<t;e++)0===e%2?(m.push(h.getX(e)),m.push(h.getX(e+1)),m.push(h.getX(e+2))):(m.push(h.getX(e+2)),m.push(h.getX(e+1)),m.push(h.getX(e)));m.length/3!==t&&console.error("GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");a=a.clone();a.setIndex(m);return a}}
class GLTFMaterialSolidworksExtension{constructor(){}getMaterialType(){return THREE.MeshStandardMaterial}getMaterialParam(a,e,h,m){a.color=new THREE.Color(e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.color[0]*e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.color_strength,e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.color[1]*e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.color_strength,e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.color[2]*e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.color_strength);
e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.color_texture&&(h.push(m.assignTexture(a,"map",e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.color_texture.index)),e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.width&&(m.json.textures[e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.color_texture.index].scalex=parseFloat(e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.width),m.json.textures[e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.color_texture.index].scaley=e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.height?
parseFloat(e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.height):parseFloat(e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.width)));e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.bump_texture&&h.push(m.assignTexture(a,"normalMap",e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.bump_texture.index));e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.bump_strength&&(a.normalScale=new THREE.Vector2(e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.bump_strength,e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.bump_strength));
a.specular=new THREE.Color(e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.specular_color[0]*e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.specular_spread,e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.specular_color[1]*e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.specular_spread,e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.specular_color[2]*e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.specular_spread);a.shininess=10*e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.specular;if(!e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.reflectivity||
isNaN(e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.reflectivity))e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.reflectivity=1;a.metalness=e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.reflectivity;a.roughness=e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.blurry_reflections?e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.specular_spread:1;isNaN(e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.transparency)||(a.opacity=1-e[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS].values.transparency)}}
class GLTFDracoMeshCompressionExtension{constructor(a,e){this.name=GLTFUtils.GLTF_EXTENSION.KHR_DRACO_MESH_COMPRESSION;if(!e)throw Error("GLTFLoader: No DRACOLoader instance provided.");this.dracoLoader=e;this.json=a;this.dracoLoader.preload()}decodePrimitive(a,e){let h=a.extensions[this.name].bufferView,m=a.extensions[this.name].attributes,t={},y={},C={},I;for(I in m){var E=GLTFUtils.ATTRIBUTES[I]||I.toLowerCase();t[E]=m[I]}for(I in a.attributes)if(E=GLTFUtils.ATTRIBUTES[I]||I.toLowerCase(),void 0!==
m[I]){let H=this.json.accessors[a.attributes[I]];C[E]=GLTFUtils.WEBGL_COMPONENT_TYPES[H.componentType];y[E]=!0===H.normalized}return e.getDependency("bufferView",h).then(H=>new Promise(O=>{this.dracoLoader.decodeDracoFile(H,R=>{for(let W in R.attributes){let ea=R.attributes[W],T=y[W];void 0!==T&&(ea.normalized=T)}O(R)},t,C)}))}}
class GLTFMaterialsUnlitExtension{constructor(){this.name=GLTFUtils.GLTF_EXTENSION.KHR_MATERIALS_UNLIT}getMaterialType(){return THREE.MeshBasicMaterial}extendParams(a,e,h){let m=[];a.color=new THREE.Color(1,1,1);a.opacity=1;if(e=e.pbrMetallicRoughness){if(Array.isArray(e.baseColorFactor)){let t=e.baseColorFactor;a.color.fromArray(t);a.opacity=t[3]}void 0!==e.baseColorTexture&&m.push(h.assignTexture(a,"map",e.baseColorTexture))}return Promise.all(m)}}
class GLTFTextureTransformExtension{constructor(){this.name=GLTFUtils.GLTF_EXTENSION.KHR_TEXTURE_TRANSFORM}extendTexture(a,e){if(void 0===e.offset&&void 0===e.rotation&&void 0===e.scale)return a;a=a.clone();void 0!==e.offset&&a.offset.fromArray(e.offset);void 0!==e.rotation&&(a.rotation=e.rotation);void 0!==e.scale&&a.repeat.fromArray(e.scale);void 0!==e.texCoord&&console.warn('GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.');a.needsUpdate=!0;return a}}
class GLTFMeshQuantizationExtension{constructor(){this.name=GLTFUtils.GLTF_EXTENSION.KHR_MESH_QUANTIZATION}}
class GLTFMaterialsClearcoatExtension{constructor(a){this.name=GLTFUtils.GLTF_EXTENSION.KHR_MATERIALS_CLEARCOAT;this.parser=a}getMaterialType(a){a=this.parser.json.materials[a];return a.extensions&&a.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(a,e){var h=this.parser,m=h.json.materials[a];if(!m.extensions||!m.extensions[this.name])return Promise.resolve();a=[];m=m.extensions[this.name];void 0!==m.clearcoatFactor&&(e.clearcoat=m.clearcoatFactor);void 0!==m.clearcoatTexture&&
a.push(h.assignTexture(e,"clearcoatMap",m.clearcoatTexture));void 0!==m.clearcoatRoughnessFactor&&(e.clearcoatRoughness=m.clearcoatRoughnessFactor);void 0!==m.clearcoatRoughnessTexture&&a.push(h.assignTexture(e,"clearcoatRoughnessMap",m.clearcoatRoughnessTexture));void 0!==m.clearcoatNormalTexture&&(a.push(h.assignTexture(e,"clearcoatNormalMap",m.clearcoatNormalTexture)),void 0!==m.clearcoatNormalTexture.scale&&(h=m.clearcoatNormalTexture.scale,e.clearcoatNormalScale=new THREE.Vector2(h,-h)));return Promise.all(a)}}
class GLTFTextureBasisUExtension{constructor(a){this.name=GLTFUtils.GLTF_EXTENSION.KHR_TEXTURE_BASISU;this.parser=a}loadTexture(a){let e=this.parser,h=e.json;var m=h.textures[a];if(!m.extensions||!m.extensions[this.name])return null;m=m.extensions[this.name];let t=e.options.ktx2Loader;if(!t){if(h.extensionsRequired&&0<=h.extensionsRequired.indexOf(this.name))throw Error("GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(a,m.source,t)}}
class GLTFTextureWebPExtension{constructor(a){this.name=GLTFUtils.GLTF_EXTENSION.EXT_TEXTURE_WEBP;this.isSupported=null;this.parser=a}loadTexture(a){let e=this.name,h=this.parser,m=h.json,t=m.textures[a];if(!t.extensions||!t.extensions[e])return null;let y=m.images[t.extensions[e].source],C=y.uri?h.options.manager.getHandler(y.uri):h.textureLoader;return this.detectSupport().then(I=>{if(I)return h.loadTextureImage(a,y,C);if(m.extensionsRequired&&0<=m.extensionsRequired.indexOf(e))throw Error("GLTFLoader: WebP required by asset but unsupported.");
return h.loadTexture(a)})}detectSupport(){this.isSupported||(this.isSupported=new Promise(a=>{let e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA";e.onload=e.onerror=()=>{a(1===e.height)}}));return this.isSupported}}
class GLTFMeshoptCompression{constructor(a){this.name=GLTFUtils.GLTF_EXTENSION.EXT_MESHOPT_COMPRESSION;this.parser=a}loadBufferView(a){let e=this.parser.json;a=e.bufferViews[a];if(a.extensions&&a.extensions[this.name]){let h=a.extensions[this.name];a=this.parser.getDependency("buffer",h.buffer);let m=this.parser.options.meshoptDecoder;if(!m||!m.supported){if(e.extensionsRequired&&0<=e.extensionsRequired.indexOf(this.name))throw Error("GLTFLoader: setMeshoptDecoder must be called before loading compressed files");
return null}return Promise.all([a,m.ready]).then(function(t){let y=h.byteOffset||0,C=h.byteLength||0,I=h.count,E=h.byteStride,H=new ArrayBuffer(I*E);t=new Uint8Array(t[0],y,C);m.decodeGltfBuffer(new Uint8Array(H),I,E,t,h.mode,h.filter);return H})}return null}}
class GLTFMaterialsTransmissionExtension{constructor(a){this.name=GLTFUtils.GLTF_EXTENSION.KHR_MATERIALS_TRANSMISSION;this.parser=a}getMaterialType(a){a=this.parser.json.materials[a];return a.extensions&&a.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(a,e){let h=this.parser;var m=h.json.materials[a];if(!m.extensions||!m.extensions[this.name])return Promise.resolve();a=[];m=m.extensions[this.name];void 0!==m.transmissionFactor&&(e.transmission=m.transmissionFactor);void 0!==
m.transmissionTexture&&a.push(h.assignTexture(e,"transmissionMap",m.transmissionTexture));return Promise.all(a)}}
class GLTFMaterialsSpecularExtension{constructor(a){this.name=GLTFUtils.GLTF_EXTENSION.KHR_MATERIALS_SPECULAR;this.parser=a}getMaterialType(a){a=this.parser.json.materials[a];return a.extensions&&a.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(a,e){let h=this.parser;var m=h.json.materials[a];if(!m.extensions||!m.extensions[this.name])return Promise.resolve();a=[];m=m.extensions[this.name];e.specularIntensity=void 0!==m.specularFactor?m.specularFactor:1;void 0!==m.specularTexture&&
a.push(h.assignTexture(e,"specularIntensityMap",m.specularTexture));const t=m.specularColorFactor||[1,1,1];e.specularTint=new THREE.Color(t[0],t[1],t[2]);void 0!==m.specularColorTexture&&a.push(h.assignTexture(e,"specularTintMap",m.specularColorTexture).then(function(y){y.encoding=THREE.sRGBEncoding}));return Promise.all(a)}}
class GLTFMaterialsIorExtension{constructor(a){this.name=GLTFUtils.GLTF_EXTENSION.KHR_MATERIALS_IOR;this.parser=a}getMaterialType(a){a=this.parser.json.materials[a];return a.extensions&&a.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(a,e){a=this.parser.json.materials[a];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();a=a.extensions[this.name];e.ior=void 0!==a.ior?a.ior:1.5;return Promise.resolve()}}
class GLTFMaterialsVolumeExtension{constructor(a){this.name=GLTFUtils.GLTF_EXTENSION.KHR_MATERIALS_VOLUME;this.parser=a}getMaterialType(a){a=this.parser.json.materials[a];return a.extensions&&a.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(a,e){var h=this.parser,m=h.json.materials[a];if(!m.extensions||!m.extensions[this.name])return Promise.resolve();a=[];m=m.extensions[this.name];e.thickness=void 0!==m.thicknessFactor?m.thicknessFactor:0;void 0!==m.thicknessTexture&&
a.push(h.assignTexture(e,"thicknessMap",m.thicknessTexture));e.attenuationDistance=m.attenuationDistance||0;h=m.attenuationColor||[1,1,1];e.attenuationColor=new THREE.Color(h[0],h[1],h[2]);return Promise.all(a)}}
class GLTFMaterialMetallicRoughnessExtension{constructor(){this.name=GLTFUtils.GLTF_EXTENSION.GLTF_MATERIALS_PBR_METALLIC_ROUGHNESS;this._params="color map lightMap lightMapIntensity aoMap aoMapIntensity emissive emissiveIntensity emissiveMap bumpMap bumpScale normalMap displacementMap displacementScale displacementBias alphaMap envMap envMapIntensity refractionRatio roughness metalness roughnessMap metalnessMap".split(" ")}getMaterialType(a){return THREE.MeshStandardMaterial}extendParams(a,e,h){let m=
[];this.getMaterialType(e);e=e.pbrMetallicRoughness||{};a.color=new THREE.Color(1,1,1);a.opacity=1;if(Array.isArray(e.baseColorFactor)){let t=e.baseColorFactor;a.color.fromArray(t);a.opacity=t[3]}void 0!==e.baseColorTexture&&m.push(h.assignTexture(a,"map",e.baseColorTexture));a.metalness=void 0!==e.metallicFactor?e.metallicFactor:1;a.roughness=void 0!==e.roughnessFactor?e.roughnessFactor:1;void 0!==e.metallicRoughnessTexture&&(m.push(h.assignTexture(a,"metalnessMap",e.metallicRoughnessTexture)),m.push(h.assignTexture(a,
"roughnessMap",e.metallicRoughnessTexture)));return Promise.all(m)}convertSGtoMR(a,e){const h=a.extensions[GLTFUtils.GLTF_EXTENSION.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];a.pbrMetallicRoughness={};a.pbrMetallicRoughness.metallicFactor=1;a.pbrMetallicRoughness.roughnessFactor=h.glossinessFactor?1-h.glossinessFactor:0;a.pbrMetallicRoughness.baseColorFactor=h.diffuseFactor;h.diffuseTexture&&(a.pbrMetallicRoughness.baseColorTexture=h.diffuseTexture);h.specularGlossinessTexture&&(a.pbrMetallicRoughness.metallicRoughnessTexture=
h.specularGlossinessTexture);e.emissive=new THREE.Color(0,0,0);e.specular=new THREE.Color(1,1,1);h.specularFactor&&Array.isArray(h.specularFactor)&&e.specular.fromArray(h.specularFactor)}}var GLTFRenderMode;(function(a){a[a.ADAPTATIVE=0]="ADAPTATIVE";a[a.BASIC=1]="BASIC";a[a.PHONG=2]="PHONG";a[a.PBR=3]="PBR"})(GLTFRenderMode||={});class GLTFObjectGroup{}
class GLTFLoader extends THREE.Loader{constructor(a){super(THREE.DefaultLoadingManager);this.ignoreDataPath=this.needsAlpha=!1;this.basename=a;this.crossOrigin="anonymous";this.meshoptDecoder=this.basisLoader=this.dracoLoader=null;this.pluginCallbacks=[];this.register(e=>new GLTFMaterialsClearcoatExtension(e));this.register(e=>new GLTFTextureBasisUExtension(e));this.register(e=>new GLTFTextureWebPExtension(e));this.register(e=>new GLTFMaterialsTransmissionExtension(e));this.register(e=>new GLTFMaterialsVolumeExtension(e));
this.register(e=>new GLTFMaterialsIorExtension(e));this.register(e=>new GLTFMaterialsSpecularExtension(e));this.register(e=>new GLTFLightsExtension(e));this.register(e=>new GLTFMeshoptCompression(e))}setDRACOLoader(a){this.dracoLoader=a}setBasisLoader(a){this.basisLoader=a}setMeshoptDecoder(a){this.meshoptDecoder=a}register(a){-1===this.pluginCallbacks.indexOf(a)&&this.pluginCallbacks.push(a)}unregister(a){-1!==this.pluginCallbacks.indexOf(a)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(a),
1)}load(a,e,h,m){this.manager.itemStart(a);let t=THREE.LoaderUtils.extractUrlBase(a),y=I=>{m?m(I):console.error(I);this.manager.itemError(a);this.manager.itemEnd(a)},C=new THREE.FileLoader(this.manager);C.setCrossOrigin("Anonymous");C.setResponseType("arraybuffer");C.setRequestHeader(this.requestHeader);C.setWithCredentials(this.withCredentials);C.load(a,I=>{try{this.parse(I,t,E=>{e(E);this.manager.itemEnd(a)},y)}catch(E){y(E)}},h,y)}parse(a,e,h,m){let t={},y={};if("string"!==typeof a)if(THREE.LoaderUtils.decodeText(new Uint8Array(a,
0,4))===GLTFUtils.BINARY_EXTENSION_HEADER_MAGIC){try{t[GLTFUtils.GLTF_EXTENSION.KHR_BINARY_GLTF]=new GLTFBinaryExtension(a)}catch(E){m&&m(E);return}a=t[GLTFUtils.GLTF_EXTENSION.KHR_BINARY_GLTF].content}else a=THREE.LoaderUtils.decodeText(new Uint8Array(a));a=decodeURI(a);const C=JSON.parse(a);if(void 0===C.asset||2>C.asset.version[0])m&&m(Error("GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var I=new GLTFParser(C,{path:e||this.path||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,
manager:this.manager,basisLoader:this.basisLoader,meshoptDecoder:this.meshoptDecoder,basename:this.basename,manageAlpha:this.needsAlpha,ignoreDataPath:this.ignoreDataPath,textureEncoding:View3D.inst.renderer.outputEncoding});I.fileLoader.setRequestHeader(this.requestHeader);for(e=0;e<this.pluginCallbacks.length;e++)a=this.pluginCallbacks[e](I),y[a.name]=a,t[a.name]=!0;if(C.extensionsUsed)for(e=0;e<C.extensionsUsed.length;++e){a=C.extensionsUsed[e];let E=C.extensionsRequired||[];switch(a){case GLTFUtils.GLTF_EXTENSION.KHR_MATERIALS_UNLIT:t[a]=
new GLTFMaterialsUnlitExtension;break;case GLTFUtils.GLTF_EXTENSION.KHR_DRACO_MESH_COMPRESSION:t[a]=new GLTFDracoMeshCompressionExtension(C,this.dracoLoader);break;case GLTFUtils.GLTF_EXTENSION.KHR_TEXTURE_TRANSFORM:t[GLTFUtils.GLTF_EXTENSION.KHR_TEXTURE_TRANSFORM]=new GLTFTextureTransformExtension;break;case GLTFUtils.GLTF_EXTENSION.KHR_MESH_QUANTIZATION:t[a]=new GLTFMeshQuantizationExtension;break;default:0<=E.indexOf(a)&&void 0===y[a]&&console.warn('GLTFLoader: Unknown extension "'+a+'".')}}t[GLTFUtils.GLTF_EXTENSION.SOLIDWORKS]=
new GLTFMaterialSolidworksExtension;t[GLTFUtils.GLTF_EXTENSION.GLTF_MATERIALS_PBR_METALLIC_ROUGHNESS]=new GLTFMaterialMetallicRoughnessExtension;I.setExtensions(t);I.setPlugins(y);I.parse(E=>{h({scene:E.scene,scenes:E.scenes,animations:E.animations,asset:C.asset,parser:I,userData:{}})},m)}}}var GamepadUtils;
(function(a){a.load3DModel=function(e,h,m){try{let t=new BasisTextureLoader(THREE.DefaultLoadingManager);t.transcoderPath="static/js/basis/";DRACOLoader.setDecoderPath("static/js/draco/");DRACOLoader.setDecoderConfig({type:"js"});new DRACOLoader(null);let y=new GLTFLoader("gamepad");y.setDRACOLoader(this._dracoLoader);y.setBasisLoader(this._basisLoader);t.detectSupport(View3D.inst.renderer);y.ignoreDataPath=!0;y.load(e+h,m)}catch(t){console.log(t)}}})(GamepadUtils||={});
class Time{static getDelta(){return Time._delta}static calculate(){Time._delta=Time.clock.getDelta()}static getElapsedTime(){return Time.clock.elapsedTime}}Time.clock=new THREE.Clock(!0);var ControllerInteraction;(function(a){a.INTERACT="interact";a.GRIP="grip";a.TELEPORT="teleport";a.IDLE="idle"})(ControllerInteraction||={});var Handedness;(function(a){a.NONE="none";a.LEFT="left";a.RIGHT="right"})(Handedness||={});
class AbstractController{constructor(a){this.animationsRef=new MessyDictionary;this.animationsAction=new MessyDictionary;this.uuid=UUID.generate();this.handednes=a}notify(a,e){a==ViewportCommand.UPDATE&&this.mixer&&this.mixer.update(Time.getDelta())}load3DModel(a){throw Error("method load3DModel need to be overridden");}load(a,e,h){GamepadUtils.load3DModel(a,e,m=>{m.scene.scale.set("left"!=this.handednes?-.01:.01,.01,.01);this.model=m.scene;this.initAnimation(m.animations);this.setEffect();h(m)})}initAnimation(a){if(a&&
0<a.length){Notifier.subscribe(this,ViewportCommand.UPDATE);this.mixer=new THREE.AnimationMixer(this.model);let e;a.forEach(h=>{e=this.mixer.clipAction(h,null);e.clampWhenFinished=!0;this.animationsRef.traverse((m,t)=>{m==h.name&&this.animationsAction.add(t,e)})})}}setEffect(){if(Config.CONTROLLER_DATA.effect==ControllerEffectType.GHOST){let a=THREE.extendMaterial(THREE.MeshBasicMaterial,{header:"varying vec3 vVertexWorldPosition; varying vec3 vVertexNormal;uniform float threshold;",vertex:{"#include <fog_vertex>":"\n                    vVertexNormal = normalize( normalMatrix * normal );\n                    vVertexWorldPosition = (modelMatrix * vec4(position, 1.0)).xyz;"},
fragment:{"gl_FragColor = vec4( outgoingLight, diffuseColor.a );":"\n                    vec3 worldCameraToVertex = vVertexWorldPosition - cameraPosition;\n                    vec3 viewCameraToVertex = (viewMatrix * vec4(worldCameraToVertex, 0.0)).xyz;\n                    viewCameraToVertex = normalize(viewCameraToVertex);\n                    float intensity = min( 1.0, max( (1.0 - pow(dot(vVertexNormal, viewCameraToVertex), 1.0)) / threshold, 0.0) );\n                    gl_FragColor.rgb = diffuseColor.rgb + 1.0-intensity;\n                    gl_FragColor.a = opacity;"},
uniforms:{diffuse:Config.CONTROLLER_DATA.color,opacity:Config.CONTROLLER_DATA.opacity,threshold:Config.CONTROLLER_DATA.threshold}});a.skinning=!0;a.transparent=1>Config.CONTROLLER_DATA.opacity;this.model.traverse(e=>{e instanceof THREE.Mesh&&e.material&&(e.material=a)})}}manageInteraction(a){if(this.mixer)try{let e=a?this.animationsAction.get(a):null;e!=this.currentAction&&(this.playModifierAnimation(this.currentAction,e,.3),this.currentAction=e)}catch(e){console.warn("Controller manageInteraction : Animations seems to not be well defined",
e)}}playModifierAnimation(a,e,h){a&&a.fadeOut(h);e&&e.reset().setEffectiveTimeScale(1).setEffectiveWeight(1).fadeIn(h).setLoop(THREE.LoopOnce,1).play()}}
class BothController extends AbstractController{constructor(a){super(a);this.animationsRef.add(ControllerInteraction.INTERACT,"main_gachette");this.animationsRef.add(ControllerInteraction.GRIP,"main_bouton");this.animationsRef.add(ControllerInteraction.TELEPORT,"main_gachette")}load3DModel(a){this.load(BothController.BOTH_CONTROLLER_PATH,BothController.BOTH_CONTROLLER_MODEL,a)}}BothController.BOTH_CONTROLLER_PATH="./static/assets/vrcontroller/hand/";BothController.BOTH_CONTROLLER_MODEL="main_manette_test.gltf";
class HandController extends AbstractController{constructor(a){super(a);this.animationsRef.add(ControllerInteraction.INTERACT,"pointe_doigt");this.animationsRef.add(ControllerInteraction.GRIP,"pince_2");this.animationsRef.add(ControllerInteraction.TELEPORT,"spiderman")}load3DModel(a){this.load(HandController.HAMD_CONTROLLER_PATH,HandController.HAMD_CONTROLLER_MODEL,a)}}HandController.HAMD_CONTROLLER_PATH="./static/assets/vrcontroller/hand/";HandController.HAMD_CONTROLLER_MODEL="main.gltf";
class SingleController extends AbstractController{constructor(a){super(a)}load3DModel(a){this.load(SingleController.SINGLE_CONTROLLER_PATH,SingleController.SINGLE_CONTROLLER_MODEL,a)}}SingleController.SINGLE_CONTROLLER_PATH="./static/assets/vrcontroller/single/";SingleController.SINGLE_CONTROLLER_MODEL="Controller_VR.gltf";var GAMEPAD_RAY_STATE;(function(a){a[a.INTERACTIVE=0]="INTERACTIVE";a[a.FLOOR=1]="FLOOR";a[a.INACTIVE=2]="INACTIVE"})(GAMEPAD_RAY_STATE||={});
class GamePadRenderer extends THREE.Object3D{constructor(){super(...arguments);this.controllerId=0;this.name="Gamepad";this.highlightMesh=this.touched=null;this.tempMatrix=new THREE.Matrix4;this.colorNeutral=new THREE.Color(16777215);this.colorInteractive=new THREE.Color(16711680);this.colorFloor=new THREE.Color(40672);this.maxRayLength=10;this.minRayLength=.1;this.triggerButtonIdx=0;this.gripButtonIdx=1;this.gripsArePressed=this.triggerIsPressed=!1}createControllerVisual(a,e,h=null){this.setGamepadRay(!0);
this.setGamepadModel(a,e,h)}setGamepadModel(a,e,h=null){this._controller=e;this._controller.load3DModel(m=>{this.add(m.scene);this._gamepadtarget.material.visible=Config.CONTROLLER_DATA.ray;if(Config.HAS_PHYSICS){this.highlightMesh=m.scene.clone();let t=new THREE.MeshBasicMaterial({color:13421568,side:THREE.BackSide,opacity:1});this.highlightMesh.traverse(y=>{y.material&&(y.material=t)});this.highlightMesh.scale.multiplyScalar(1.05);this.highlightMesh.name="Highlight_"+this.controllerId;this.highlightMesh.visible=
!1;this.add(this.highlightMesh)}h&&h()})}setGamepadRay(a){this._uniforms={baseColor:{type:"c",value:this.colorNeutral},maxDist:{type:"f",value:this.maxRayLength}};var e=new THREE.BufferGeometry;let h=new THREE.ShaderMaterial({uniforms:this._uniforms,vertexShader:"        varying vec4 vPosition;\n        void main(){\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n            vPosition = gl_Position;\n        }",fragmentShader:"        varying vec4 vPosition;\n        uniform float maxDist;\n        uniform vec3 baseColor;\n        void main(){\n            float alpha = max(0.0, 1.0 - length(vPosition) / maxDist);\n            gl_FragColor = vec4(baseColor, alpha);\n        }",
transparent:!0,side:THREE.BackSide,blendDstAlpha:1,alphaTest:.05});this._gamepadray=new THREE.Line(e,h);e.setAttribute("position",new THREE.Float32BufferAttribute([0,0,-this.minRayLength,0,0,-this.maxRayLength],3));Config.simulationData.header.hideInteractionHints&&(this.colorInteractive=this.colorNeutral);e=new THREE.BufferGeometry;let m=new THREE.PointsMaterial({size:12,sizeAttenuation:!1,map:(new THREE.TextureLoader).load("./static/assets/vrcontroller/target.png"),alphaTest:.5,transparent:!0,opacity:.9});
this._gamepadtarget=new THREE.Points(e,m);e.setAttribute("position",new THREE.Float32BufferAttribute([0,0,0],3));this._gamepadtarget.renderOrder=Config.RENDER_ORDER_TRANSPARENT++;h.depthTest=!0;m.depthTest=!1;this._camera=new THREE.OrthographicCamera(-.01,.01,.01,-.01,this.minRayLength,this.maxRayLength);this._pickingTexture=new THREE.WebGLRenderTarget(1,1);this._renderer=new THREE.WebGLRenderer;this._renderer.setSize(1,1);this._renderer.setRenderTarget(this._pickingTexture);this._camera.add(this._gamepadray);
this._camera.add(this._gamepadtarget);this.add(this._camera);m.visible=a;h.visible=a&&Config.CONTROLLER_DATA.ray;this._gamepadray.renderOrder=Config.RENDER_ORDER_TRANSPARENT++}update(){this.updateGamepadRef()&&(this.checkRayTargetAction(),this.updateExtra())}updateGamepadRef(){let a=WebVRUtils.findGamepadDetails(this.controllerId);this._gamepad&&!a&&console.warn("Lost gamepad source",this.controllerId);this._gamepad=null;if(!a)return!1;this._gamepad=a[0];return this.updateCoordinates(a[1])}checkRayTargetAction(){this._controller&&
(this.updateRayCaster(),this.triggerIsPressed===this._gamepad.buttons[this.triggerButtonIdx].pressed?(this.findPointerTarget(),this.triggerIsPressed&&(this._floorIntersection?(MotionZone.inst.previewTeleportVisibility(0,!0),MotionZone.inst.setPreviewTeleportLocation(0,this._floorIntersection),this._controller.manageInteraction(ControllerInteraction.TELEPORT)):(MotionZone.inst.previewTeleportVisibility(this.controllerId,!1),this._controller.manageInteraction(ControllerInteraction.INTERACT)))):(this.triggerIsPressed=
this._gamepad.buttons[this.triggerButtonIdx].pressed,this.triggerEvent(this.triggerIsPressed),this.triggerIsPressed||(this._elementTouched?this._elementTouched.interaction(StatementTrigger.CLICK):this._floorIntersection&&(MotionZone.inst.moveToPreviewPosition(0,this._floorIntersection),MotionZone.inst.previewTeleportVisibility(0,!1)),this._controller.manageInteraction(null))))}updateRayCaster(){this.updateMatrixWorld(!0);PointerManager.inst.setFromGamepad(this.matrixWorld,this.tempMatrix.identity().extractRotation(this.matrixWorld))}findPointerTarget(){this._elementTouched=
InteractionTracker.inst.interactedElement;this._elementIntersection=InteractionTracker.inst.currentIntersection;var a=this._camera;if(a){if(this._elementIntersection&&this._elementTouched){var e=this._elementIntersection.object,h=new THREE.Vector3;e.getWorldPosition(h);h.add(e.geometry.boundingSphere.center);var m=new THREE.Vector3;a.getWorldPosition(m);h=h.clone().sub(m);m=new THREE.Vector3;a.getWorldDirection(m);e=e.geometry.boundingSphere.radius;a.far=h.dot(m);a.far<e&&(a.far=.5*(a.far+e));a.updateProjectionMatrix()}else a.rotation.set(0,
0,0),a.far!=this.maxRayLength&&(a.far=this.maxRayLength,a.updateProjectionMatrix());h=this._manager.getControllers();for(e=0;e<h.length;++e)h[e].visible=!1;View3D.inst.scene.traverseVisible(t=>{if(t.material){var y=t.material;t.userData.material=y;t.material=new THREE.MeshDepthMaterial({depthPacking:THREE.RGBADepthPacking});t.material.map=y.map;t.material.visible=y.visible}});this._renderer.render(View3D.inst.scene,a);e=new Uint8Array(4);this._renderer.readRenderTargetPixels(this._pickingTexture,
0,0,1,1,e);View3D.inst.scene.traverseVisible(t=>{t.material&&(t.material=t.userData.material,delete t.userData.material)});for(m=0;m<h.length;++m)h[m].visible=!0;h=1;m=0;for(let t=3;0<=t;t--)m+=e[t]*(h/=256);m||=1;a=a.near+(a.far-a.near)*m;this._elementIntersection&&this._elementTouched?(this.updateRay(a,this.colorInteractive,GAMEPAD_RAY_STATE.INTERACTIVE),this._floorIntersection=null):(this._elementTouched=null,this.readFloorIntersection(),this._floorIntersection?this.updateRay(a,this.colorFloor,
GAMEPAD_RAY_STATE.FLOOR):this.updateRay(a,this.colorNeutral,GAMEPAD_RAY_STATE.INACTIVE))}}readFloorIntersection(){var a;this._floorIntersection=null===(a=MotionZone.inst.floorIntersection)||void 0===a?void 0:a.clone()}updateRay(a,e,h){this._gamepadtarget.visible=h==GAMEPAD_RAY_STATE.INTERACTIVE;this._gamepadtarget.position.z=-a;h=this._gamepadray.geometry.attributes.position;h.setZ(1,-a);h.needsUpdate=!0;this._uniforms.baseColor.value=e}onHoverStart(a){a.target.userData.owneruuid&&LiveElementsRefHolder.inst.getRef(a.target.userData.owneruuid)&&
(this.highlightMesh&&(this.highlightMesh.visible=!0),this.touched=a.target)}onHoverEnd(a){this.touched&&(this.highlightMesh&&(this.highlightMesh.visible=!1),this.touched=null)}}
class MobileGamepad extends GamePadRenderer{constructor(a){super();this.verticalOffset=.5;this._manager=a;this.matrixAutoUpdate=!1}updateCoordinates(a){if(!a)return!1;switch(WebVRUtils.sessionType){case SessionType.WebXR:case SessionType.WebXR_AR:a=a.orientation,this.quaternion.set(a.x,a.y,a.z,a.w)}this.updateMatrix();return!0}triggerEvent(a){this.carriedObject=a&&!this.carriedObject&&this.touched?this.touched:null}updateExtra(){}}
class MobileGamepadManager{constructor(){this.needToBeAttached=[];if(MobileGamepadManager._inst)throw Error("This is a singleton");}static get inst(){return this._inst||(this._inst=new MobileGamepadManager)}init(a){this._container=a}lookForGamepad(){if(!this.controller){var a=WebVRUtils.getGamepads();if(a&&a.length&&null!=a[0]){var e=a[0].gamepad;var h=a[0].handedness}this.createGamepad(e,h)}}createGamepad(a,e){this.controller=new MobileGamepad(this);this.controller.createControllerVisual(a,new SingleController(e),
null);this.controller.position.set(0,Config.USER_STANDING_HEIGHT-this.controller.verticalOffset,0);this._container.add(this.controller);this.needToBeAttached.length&&(this.needToBeAttached.forEach(h=>{this.controller.add(h)}),this.needToBeAttached=[])}update(){this.lookForGamepad();this.controller&&this.controller.update()}attachToController(a){this.controller?this.controller.add(a):this.needToBeAttached.push(a)}detachToController(a){this.controller&&this.controller.remove(a)}getControllers(){return[this.controller]}}
var CoordUtils;
(function(a){function e(h,m){null!=m.x&&(h.x=m.x);null!=m.y&&(h.y=m.y);null!=m.z&&(h.z=m.z)}a.set3dTransforms=function(h,m){m&&h&&(m.rotation&&e(h.rotation,m.rotation),m.position&&e(h.position,m.position),m.scale&&e(h.scale,m.scale),m.quaternion&&h.quaternion.set(m.quaternion.x,m.quaternion.y,m.quaternion.z,m.quaternion.w))};a.set3dTransformToRatio=function(h,m,t){m&&h&&e(h.position,{x:m.position.x*t.x,y:m.position.y*t.y,z:m.position.z})};a.set3dVector=e;a.setAndTransform3dVector=function(h,m,t){null!=
m.x&&(h.x=t(m.x));null!=m.y&&(h.y=t(m.y));null!=m.z&&(h.z=t(m.z))};a.degToRad=function(h){return Config.simulationData.mobile?h:THREE.MathUtils.degToRad(h)};a.getClosestRotationVector=function(h,m,t,y=!1){let C=y?180:Math.PI/2;y=I=>{let E=Math.abs(m[I]-h[I]);return(E>C?Math.abs(m[I])>Math.abs(h[I])?"-":"+":Math.abs(m[I])>Math.abs(h[I])?"+":"-")+(E>C?C-E:E)};t.x=y("x");t.y=y("y");t.z=y("z")};a.almostEqual=function(h,m){return.001>Math.abs(h.x-m.x)&&.001>Math.abs(h.y-m.y)&&.001>Math.abs(h.z-m.z)};a.lerpObjectToMatrix=
function(h,m,t){let y=new THREE.Vector3,C=new THREE.Quaternion,I=new THREE.Vector3;m.decompose(y,C,I);h.position.lerp(y,t);h.quaternion.slerp(C,t);h.scale.lerp(I,t)}})(CoordUtils||={});var PhysicInteractionResult;(function(a){a[a.NONE=0]="NONE";a[a.STATIC=1]="STATIC";a[a.INTERACTIVE=2]="INTERACTIVE"})(PhysicInteractionResult||={});
class PhysicInteractionScriptData extends AbstractScriptParser{constructor(){super(...arguments);this.drop=!1;this.targetPosition=new THREE.Vector3;this.targetRotation=new THREE.Euler;this.result=PhysicInteractionResult.NONE}static getFromName(a){return this.loopOnKeys(this.extractBaseCode(a,"drop"),new PhysicInteractionScriptData)}parseVal(a,e){if(e){this.drop=!0;if("target"==a){var h=e.split(" ");let m=[];for(let t=0;t<h.length;++t)m[t]=parseFloat(h[t]);3<=m.length&&(this.targetPosition=new THREE.Vector3(m[0],
m[1],m[2]));6<=m.length&&(this.targetRotation=new THREE.Euler(THREE.MathUtils.degToRad(m[3]),THREE.MathUtils.degToRad(m[4]),THREE.MathUtils.degToRad(m[5]),"ZYX"))}if("fallback"==a){a=e.split(" ");e=[];for(h=0;h<a.length;++h)e[h]=parseFloat(a[h]);3<=e.length&&(this.fallbackPosition=new THREE.Vector3(e[0],e[1],e[2]));6<=e.length&&(this.fallbackRotation=new THREE.Euler(THREE.MathUtils.degToRad(e[3]),THREE.MathUtils.degToRad(e[4]),THREE.MathUtils.degToRad(e[5]),"ZYX"))}else if("chain"==a)this.chainTo=
e;else if("fallback"==a)this.fallbackTo=e;else if("result"==a)switch(e){case "static":this.result=PhysicInteractionResult.STATIC;break;case "interactive":this.result=PhysicInteractionResult.INTERACTIVE;break;default:this.result=PhysicInteractionResult.NONE}}}}
class PhysicInteractionManager{static manageDrop(a,e){var h=ArrayUtils.find(a.data.states,"uuid",ElementsRefHolder.inst.getRef(a.uuid).currentStateId);console.log("-> Drop state ",h);if(!h)return e();h=PhysicInteractionScriptData.getFromName(h.name);if(!h)return e();console.log("-> As drop data : ",h);let m=a.currentAspectContainer;var t=m.getWorldScale(new THREE.Vector3);PhysicsHelper.getLowerWorldScale(m,t);var y=new THREE.Vector3(-Infinity,-Infinity,-Infinity),C=new THREE.Vector3(Infinity,Infinity,
Infinity);let I=BoundingHelper.getMergedGeometry(m),E=I.getAttribute("position"),H=E.count,O=0,R;for(;O<H;O++)R=new THREE.Vector3(E.getX(O),E.getY(O),E.getZ(O)),C.min(R),y.max(R);I.dispose();y=BoundingHelper.getGeometryFromBox(C,y);y.computeBoundingBox();m.parent.updateMatrixWorld();PhysicInteractionManager.helperBase=new THREE.Mesh(y.clone(),new THREE.MeshBasicMaterial({color:65280}));PhysicInteractionManager.helperBase.matrixAutoUpdate=!1;C=(new THREE.Quaternion).setFromEuler(m.rotation);PhysicInteractionManager.helperBase.quaternion.set(C.x,
C.y,C.z,C.w);PhysicInteractionManager.helperBase.scale.set(t.x,t.y,t.z);PhysicInteractionManager.helperBase.updateMatrix();PhysicInteractionManager.helperTarget=new THREE.Mesh(y.clone(),new THREE.MeshBasicMaterial({color:16711680}));PhysicInteractionManager.helperTarget.matrixAutoUpdate=!1;PhysicInteractionManager.helperTarget.position.set(h.targetPosition.x,h.targetPosition.y,h.targetPosition.z);C=(new THREE.Quaternion).setFromEuler(h.targetRotation);PhysicInteractionManager.helperTarget.quaternion.set(C.x,
C.y,C.z,C.w);PhysicInteractionManager.helperTarget.scale.set(t.x,t.y,t.z);PhysicInteractionManager.helperTarget.updateMatrix();PhysicInteractionManager.helperBase.geometry.computeBoundingBox();PhysicInteractionManager.helperTarget.geometry.computeBoundingBox();PhysicInteractionManager.helperBase.updateMatrixWorld();PhysicInteractionManager.helperTarget.updateMatrixWorld();t=PhysicInteractionManager.helperBase.geometry.boundingBox.clone();t.applyMatrix4(PhysicInteractionManager.helperBase.matrixWorld);
C=PhysicInteractionManager.helperTarget.geometry.boundingBox.clone();C.applyMatrix4(PhysicInteractionManager.helperTarget.matrixWorld);y.dispose();t.intersectsBox(C)?(m.userData.gripIdle=!0,this.chainDrop(a,h,!0)):this.chainDrop(a,h,!1);e();PhysicInteractionManager.helperBase.geometry.dispose();PhysicInteractionManager.helperTarget.geometry.dispose()}static chainDrop(a,e,h){let m,t,y;h?(m=e.chainTo,t=e.targetPosition,e=e.targetRotation,y=StatementTrigger.PHYSIC_DROP):(m=e.fallbackTo,t=e.fallbackPosition,
e=e.fallbackRotation,y=StatementTrigger.PHYSIC_DROP_FAIL);h||this.commitPosition(a.currentAspectContainer,e,t);if(m){var C,I=new RegExp("id:"+m);a.data.states.forEach(E=>{I.test(E.name)&&(C=a.uuid)});C&&(h&&this.commitPosition(a.currentAspectContainer,e,t),ImplicationUtils.triggerFullRun(y,Config.simulationData.implications[a.uuid]))}}static commitPosition(a,e,h){if(h||e)PhysicInteractionManager.worldMatrixSource=(new THREE.Matrix4).makeRotationFromEuler(e).setPosition(h),PhysicInteractionManager.newMatrix.identity(),
a.matrix.copy(PhysicInteractionManager.worldMatrixSource),a.applyMatrix4(PhysicInteractionManager.newMatrix.copy(a.parent.matrixWorld).invert()),a.matrixWorldNeedsUpdate=!0,e=new PhysicParameter,e.carried=!0,e.position=a.getWorldPosition(new THREE.Vector3),e.quaternion=a.getWorldQuaternion(new THREE.Quaternion),e.gravity=new THREE.Vector3(0,0,0),View3D.inst.engine.setupPosition(a,e)}}PhysicInteractionManager.helperBase=null;PhysicInteractionManager.helperTarget=null;
PhysicInteractionManager.worldMatrixSource=new THREE.Matrix4;PhysicInteractionManager.newMatrix=new THREE.Matrix4;var PhysicProfileType;(function(a){a[a.FLOOR=0]="FLOOR";a[a.STATIC=1]="STATIC";a[a.DYNAMIC=2]="DYNAMIC";a[a.INTERACTIVE=3]="INTERACTIVE";a[a.GAMEPAD=4]="GAMEPAD"})(PhysicProfileType||={});var PhysicObjectType;(function(a){a[a.BOX=1]="BOX";a[a.REAL=2]="REAL"})(PhysicObjectType||={});
class PhysicProfile{constructor(a,e,h,m){this.ghost=a;this.emitEvents=e;this.receiveEvents=h;this.type=m}}PhysicProfile.STATIC=new PhysicProfile(!1,!1,!1,PhysicProfileType.STATIC);PhysicProfile.FLOOR=new PhysicProfile(!1,!1,!1,PhysicProfileType.FLOOR);PhysicProfile.DYNAMIC=new PhysicProfile(!1,!1,!1,PhysicProfileType.DYNAMIC);PhysicProfile.INTERACTIVE=new PhysicProfile(!1,!0,!0,PhysicProfileType.INTERACTIVE);PhysicProfile.GAMEPAD=new PhysicProfile(!0,!0,!0,PhysicProfileType.GAMEPAD);
class PhysicParameter{constructor(){this.profileType=PhysicProfileType.STATIC;this.physicObjectType=PhysicObjectType.BOX;this.emitEvents=this.receiveEvents=this.ghost=!1;this.mass=5;this.carried=!1;this.enabled=!0;this.friction=.5;this.restitution=0}getTransfertData(){let a={profileType:this.profileType,physicObjectType:this.physicObjectType,name:this.name,id:this.id,uuid:this.uuid,vertices:this.vertices,ghost:this.ghost,receiveEvents:this.receiveEvents,emitEvents:this.emitEvents,mass:this.mass,friction:this.friction,
restitution:this.restitution,carried:this.carried};this.gravity&&(a.gravity={x:this.gravity.x,y:this.gravity.y,z:this.gravity.z});this.position&&(a.position={x:this.position.x,y:this.position.y,z:this.position.z});this.scale&&(a.scale={x:this.scale.x,y:this.scale.y,z:this.scale.z});this.quaternion&&(a.quaternion={x:this.quaternion.x,y:this.quaternion.y,z:this.quaternion.z,w:this.quaternion.w});this.size&&(a.size={x:this.size.x,y:this.size.y,z:this.size.z});this.center&&(a.center={x:this.center.x,
y:this.center.y,z:this.center.z});this.linearVelocity&&(a.linearVelocity={x:this.linearVelocity.x,y:this.linearVelocity.y,z:this.linearVelocity.z});this.angularVelocity&&(a.angularVelocity={x:this.angularVelocity.x,y:this.angularVelocity.y,z:this.angularVelocity.z});return a}}var MESSAGE_TYPE;
(function(a){a[a.ADD=0]="ADD";a[a.REMOVE=1]="REMOVE";a[a.INIT=2]="INIT";a[a.STEP=3]="STEP";a[a.COLLISION_START=4]="COLLISION_START";a[a.COLLISION_END=5]="COLLISION_END";a[a.SET=6]="SET";a[a.AMMO_LOADED=9]="AMMO_LOADED";a[a.ADDED=10]="ADDED";a[a.GRAVITY=11]="GRAVITY";a[a.SWITCH_TYPE=12]="SWITCH_TYPE";a[a.SET_PROPS=13]="SET_PROPS"})(MESSAGE_TYPE||={});
class InterestPoint{constructor(a){this.data=a;this.uuid=a.uuid;this._container=new THREE.Group;this._container.name=a.name;this._container.rotation.order=this.data.rotationOrder;this._container.userData.uuid=a.uuid}get container(){return this._container}placeContainer(a){a?CoordUtils.set3dTransforms(this._container,a):(CoordUtils.set3dTransforms(this._container,this.data),CoordUtils.set3dTransforms(this._container,AnimEffectRefHolder.inst.getRef(this.uuid)));this._container.updateMatrix()}}
class BaseAspectScriptData extends AbstractScriptParser{constructor(){super(...arguments);this.followCam=!1}static getFromName(a){return this.loopOnKeys(this.extractBaseCode(a,"asset"),new BaseAspectScriptData)}parseVal(a,e){"followcam"==a&&(this.followCam=!0)}}
class PhysicScriptData extends AbstractScriptParser{constructor(){super(...arguments);this.physic=!1;this.profile=PhysicProfile.STATIC;this.mass=5;this.friction=.5;this.restitution=0;this.gravity=new THREE.Vector3(0,-9.81,0);this.type=PhysicObjectType.BOX;this.local=this.debug=!1;this.upscale=1;this.enabled=!0}static getFromName(a){return this.loopOnKeys(this.extractBaseCode(a,"physic"),new PhysicScriptData)}parseVal(a,e){this.physic=!0;if("mass"==a)this.mass=parseFloat(e);else if("type"==a)this.type=
"real"==e?PhysicObjectType.REAL:PhysicObjectType.BOX;else if("friction"==a)this.friction=parseFloat(e);else if("bounce"==a||"restitution"==a)this.restitution=Math.min(1,parseFloat(e));else if("dynamic"==a)this.profile=PhysicProfile.DYNAMIC;else if("interactive"==a)this.profile=PhysicProfile.INTERACTIVE;else if("gamepad"==a)this.profile=PhysicProfile.GAMEPAD;else if("static"==a)this.profile=PhysicProfile.STATIC,this.mass=0;else if("floor"==a)this.profile=PhysicProfile.FLOOR,this.mass=0;else if("gravity"==
a){let h=e.split(" ");h&&h.length&&(this.gravity.x=parseFloat(h[0]),h[1]&&(this.gravity.y=parseFloat(h[1])),h[2]&&(this.gravity.z=parseFloat(h[2])))}"debug"==a&&(this.local=this.debug=!0);"local"==a&&(this.local=!0);"enabled"==a&&(this.enabled="true"==e);"upscale"==a&&(this.upscale=parseFloat(e))}}
class PhysicsHelper{static addPhysicObject(a,e,h){a.updateMatrixWorld(!0);View3D.inst.scene.updateMatrixWorld(!0);var m=new THREE.Vector3(-Infinity,-Infinity,-Infinity);let t=new THREE.Vector3(Infinity,Infinity,Infinity),y=(new THREE.Vector3).setFromMatrixPosition(a.matrixWorld),C=(new THREE.Quaternion).setFromRotationMatrix(a.matrixWorld),I=a.getWorldScale(new THREE.Vector3);PhysicsHelper.getLowerWorldScale(a,I);I.multiplyScalar(h.upscale);let E=BoundingHelper.getMergedGeometry(a);var H=E;let O=
new THREE.Vector3,R=new THREE.Vector3,W=new THREE.Vector3;if(h.type==PhysicObjectType.BOX){H=E.getAttribute("position");let ea=H.count,T=0,fa;for(;T<ea;T++)fa=new THREE.Vector3(H.getX(T),H.getY(T),H.getZ(T)),t.min(fa),m.max(fa);E.dispose();H=BoundingHelper.getGeometryFromBox(t,m);H.computeBoundingBox();O.subVectors(H.boundingBox.max,H.boundingBox.min);O.multiplyScalar(.5);O.add(E.boundingBox.min);O.applyMatrix4(a.matrixWorld);R.subVectors(O,y);H.boundingBox.getSize(W)}H.getAttribute("position");H.dispose();
m=new PhysicParameter;m.uuid=a.uuid;m.container=e;m.profileType=h.profile.type;m.target=a;m.vertices=H.getAttribute("position").array;m.size=W;m.center=R;m.position=y;m.quaternion=C;m.scale=I;m.ghost=h.profile.ghost;m.receiveEvents=h.profile.receiveEvents;m.emitEvents=h.profile.emitEvents;m.mass=h.mass;m.friction=h.friction;m.restitution=h.restitution;m.physicObjectType=h.type;m.enabled=h.enabled;m.carried=h.profile==PhysicProfile.GAMEPAD;console.log("add phy : ",a.name,m.scale);View3D.inst.engine.add(m);
return m}static getLowerWorldScale(a,e){a.traverse(h=>{e.multiply(h.scale)})}}var AssetAnimType;(function(a){a.TB="tb";a.BT="bt";a.CIRCULAR="circular";a.LR="lr";a.RADIAL="radial";a.WAVE="wave";a.SELF="self"})(AssetAnimType||={});
class AssetAnimator{constructor(a){this._animationReversed=this._animated=this._selected=!1;this._animationStartTime=this._selectionStartTime=0;this.SELECTION_DURATION=1E3;this.animationDuration=AssetAnimator.ANIMATION_DURATION;this.animateShader=()=>{let e=2*(Date.now()-this._selectionStartTime)*Math.PI/this.SELECTION_DURATION,h=Math.min(1,(Date.now()-this._animationStartTime)/this.animationDuration);this.container.traverse(m=>{m.userData.shader&&(m.userData.shader.uniforms.selectionVariation.value=
e,m.userData.shader.uniforms.gradientVariation.value=h)});this._selectionAnimationRef=window.requestAnimationFrame(this.animateShader)};this.initAnimAfterUpdate=()=>{this.changeSelection(this._selected,!1);this.setupAnim(this._animationKind,this.animationDuration,this._animationReversed);this.manageShaderAnimation()};this.container=a}static getGradientTexture(a){return AssetAnimator._textures.get(a)}static init(){AssetAnimator._inited||(AssetAnimator._inited=!0,AssetAnimator.addGradientEntry(AssetAnimType.BT,
"./static/assets/gradients/bt.jpg"),AssetAnimator.addGradientEntry(AssetAnimType.TB,"./static/assets/gradients/tb.jpg"),AssetAnimator.addGradientEntry(AssetAnimType.CIRCULAR,"./static/assets/gradients/circular.jpg"),AssetAnimator.addGradientEntry(AssetAnimType.LR,"./static/assets/gradients/lr.jpg"),AssetAnimator.addGradientEntry(AssetAnimType.RADIAL,"./static/assets/gradients/radial.jpg"),AssetAnimator.addGradientEntry(AssetAnimType.WAVE,"./static/assets/gradients/wave.jpg"))}static addGradientEntry(a,
e){AssetAnimator._loader.load(e,h=>{AssetAnimator._textures.add(a,h)})}setupAnim(a,e,h=!1){this._animated=!0;this.animationDuration=e;this._animationReversed=h;this._animationKind=a;this.setupShaderUniforms(this._selected,this._animated,this._animationReversed,this._animationKind)}startAnimation(){this._animationStartTime=Date.now();this.manageShaderAnimation()}changeSelection(a,e=!0){this._selected!=a&&(this._selected=a,this._selectionStartTime=Date.now(),e&&this.manageShaderAnimation())}manageShaderAnimation(){this.setupShaderUniforms(this._selected,
this._animated,this._animationReversed,this._animationKind)&&(this._selected||this._animated?this._selectionAnimationRef=window.requestAnimationFrame(this.animateShader):window.cancelAnimationFrame(this._selectionAnimationRef))}setupShaderUniforms(a,e,h,m){let t=!1;this.container.traverse(y=>{y.userData.shader&&(t=!0,y.userData.shader.uniforms.selected.value=a,y.userData.shader.uniforms.animated.value=e,y.userData.shader.uniforms.reversed.value=h,y.userData.shader.uniforms.animateSelf.value=m==AssetAnimType.SELF,
y.userData.shader.uniforms.selectionVariation.value=0,y.userData.shader.uniforms.gradientVariation.value=0,y.userData.shader.uniforms.gradientTexture.value=AssetAnimator._textures.get(m))});return t}prepareShaderForAnim(a=null){this.updateShader(()=>{this.initAnimAfterUpdate();a&&a()})}prepareShader(a=null){this.updateShader(a)}updateShader(a=null){let e=[],h=[],m;m=(t,y)=>{e.length>=t.length&&a&&a()};this.container.traverse(t=>{const y=t.material;y&&-1==e.indexOf(y.name)&&(e.push(y.name),y.onBeforeCompile=
C=>{C.uniforms.animated={value:!1};C.uniforms.animateSelf={value:!1};C.uniforms.selected={value:!1};C.uniforms.reversed={value:!1};C.uniforms.selectionVariation={value:0};C.uniforms.gradientVariation={value:0};C.uniforms.gradientTexture={type:"t",value:null};C.vertexShader="                                            #define USE_UV\n                                            "+C.vertexShader;C.fragmentShader="                                            #define USE_UV\n                                            uniform bool selected;\n                                            uniform bool animated;\n                                            uniform bool reversed;\n                                            uniform bool animateSelf;\n                                            uniform float selectionVariation;\n                                            uniform float gradientVariation;\n                                            uniform sampler2D gradientTexture;\n                                            \n                                            "+
C.fragmentShader;C.fragmentShader=C.fragmentShader.replace("gl_FragColor = vec4( outgoingLight, diffuseColor.a );","\n                        float outputAlpha = diffuseColor.a;\n                        vec4 testColor = vec4(outgoingLight.r, outgoingLight.g, outgoingLight.b, 1.0);\n                        if(animated) {\n                            if(animateSelf) {\n                                if(reversed) {\n                                    if(testColor.r <= gradientVariation) discard;\n                                }\n                                else {\n                                    if (testColor.r > gradientVariation) discard;\n                                }\n                            }\n                            else {\n                                testColor = texture2D(gradientTexture, vUv);\n                                if(reversed) {\n                                    if (testColor.r <= gradientVariation) discard;\n                                }\n                                else {\n                                    if (testColor.r > gradientVariation) discard;\n                                }\n                            }\n                        }\n                        gl_FragColor = vec4( outgoingLight, outputAlpha );\n                        \n                        if(selected) {\n                            gl_FragColor.rgb += 0.2 * sin( selectionVariation );\n                        }\n                        ");
t.userData.shader=C;h.push(y.name);m(e,h)})})}}AssetAnimator.ANIMATION_DURATION=6E3;AssetAnimator._inited=!1;AssetAnimator._textures=new MessyDictionary;AssetAnimator._loader=new THREE.TextureLoader(THREE.DefaultLoadingManager);
class AbstractAspect extends InterestPoint{constructor(a){super(a);this.regFloor=/__floor__/i;this.regRoom=/__room_(.*)_(.*)_(.*)__/i;this.regRoomItem=/__roomitem__/i;this.regStatic=/__static__/i;this.regRectLight=/__rectlight_(.*)_(.*)_(.*)__/i;this._selected=!1;this._selectionStartTime=0;this._positionToCam=this._followCam=this._visible=!1;this._container.visible=!1;this._elementOpacity=.999;this.assetAnimator=new AssetAnimator(this._container);(this.baseScript=BaseAspectScriptData.getFromName(this.data.name))&&
this.baseScript.followCam&&this.setFollowCam()}notify(a,e){a==ViewportCommand.UPDATE&&(this._followCam&&this._container.lookAt(View3D.inst.camera.position),this._positionToCam&&(Config.STARTED_IN_VR&&WebVRUtils.hasHMD?this._container.position.copy(MotionZone.inst.container.position).add(this._positionToCamOffset):(View3D.inst.camera.updateMatrixWorld(!0),this._container.position.copy(View3D.inst.camera.position).add(this._positionToCamOffset)),this._container.updateMatrixWorld(!0)))}get opacity(){return this._elementOpacity}setFollowCam(){this._followCam=
!0;Notifier.subscribe(this,ViewportCommand.UPDATE)}setPositionToCam(a){this._positionToCam=!0;this._positionToCamOffset=a;Notifier.subscribe(this,ViewportCommand.UPDATE)}setVisibility(a){this._visible!=a&&(this._visible=a,this._container.visible=this._visible,InteractionTracker.inst.requestTrackedObjectsRemap())}generatePhysic(){let a=PhysicScriptData.getFromName(this.data.name);return Config.HAS_PHYSICS&&a&&this._container.children[0]?(PhysicsHelper.addPhysicObject(this._container,this,a),a.profile.type):
null}elementOpacityChange(a){this._elementOpacity=a;this._setOpacity(a*this.data.opacity)}aspectOpacityChange(a){this.data.opacity=a;this._setOpacity(this._elementOpacity*a)}dispose(){Notifier.unsubscribe(this,ViewportCommand.UPDATE)}_setOpacity(a,e){this._container.traverse(h=>{if(h instanceof THREE.Mesh&&h.material){var m=this.regFloor.test(h.name)?0:a;m*=h.material.userData.baseOpacity||1;h.material.transparent=e||1!=m;h.material.opacity=m}})}launchAnim(a,e=AssetAnimator.ANIMATION_DURATION,h=!1){this.assetAnimator.setupAnim(a,
e,h);this.assetAnimator.startAnimation()}changeSelection(a){this.assetAnimator.changeSelection(a,!0)}updateShader(){this.assetAnimator.prepareShaderForAnim()}callbackAfterCompile(){this.materialShaderCompiled>=this.materialShaderModified&&this.changeSelection(this._selected)}get size(){return new THREE.Vector2(1,1)}bindParent(a){}updateSizeRatio(a){}onHoverEnd(a){}onHoverStart(a){}}
class Decoder{static decode(a){Decoder.position=0;a=new DataView(a);return Decoder.decodeRecursive(a)}static decodeRecursive(a){var e=a.getInt32(Decoder.position,!0);Decoder.position+=4;return Decoder.DECODERS[e](a)}static decodeObject(a,e=null){var h=a.getInt16(Decoder.position,!0);Decoder.position+=2;for(null==e&&(e={});0<h;--h)e[Decoder.decodeString(a)]=Decoder.decodeRecursive(a);return e}static decodeArray(a){var e=[],h=a.getInt16(Decoder.position,!0);for(Decoder.position+=2;0<h;--h)e.push(Decoder.decodeRecursive(a));
return e}static decodeString(a){var e=a.getInt16(Decoder.position,!0);Decoder.position+=2;var h=new ArrayBuffer(2*e);h=new Uint16Array(h);for(var m=0;m<e;++m)h[m]=a.getUint8(Decoder.position+m);Decoder.position+=e;return String.fromCharCode.apply(null,h)}static decodeInteger(a){a=a.getInt32(Decoder.position,!0);Decoder.position+=4;return a}static decodeUnsignedInteger(a){a=a.getUint32(Decoder.position,!0);Decoder.position+=4;return a}static decodeFloat(a){a=a.getFloat32(Decoder.position,!0);Decoder.position+=
4;return a}static decodeBytes(a){Decoder.decodeBoolean(a);var e=a.getInt32(Decoder.position,!0);Decoder.position+=4;if(e){var h=new ArrayBuffer(e);h=new Uint8Array(h);for(var m=0;m<e;m++)h[m]=a.getUint8(Decoder.position+m);Decoder.position+=e;return h}return null}static decodeBoolean(a){a=a.getInt8(Decoder.position);Decoder.position+=1;return 1==a}static decodeCustomObject(a){return Decoder.decodeObject(a)}static decodeBitmapData(a){a.getInt16(Decoder.position,!0);Decoder.position+=2;a.getInt16(Decoder.position,
!0);Decoder.position+=2;return null}}Decoder.position=0;Decoder.DECODERS=[Decoder.decodeCustomObject,Decoder.decodeObject,Decoder.decodeArray,Decoder.decodeInteger,Decoder.decodeUnsignedInteger,Decoder.decodeFloat,Decoder.decodeString,Decoder.decodeBytes,Decoder.decodeBoolean,Decoder.decodeBitmapData];var ArrayUtils;
(function(a){a.find=function(e,h,m){for(let t=0;t<e.length;t++)if(e[t][h]==m)return e[t];return null};a.dictionaryFind=function(e,h,m){for(let t in e)if(e[t][h]==m)return e[t];return null};a.regexFind=function(e,h,m){m=new RegExp(m,"i");for(let t=0;t<e.length;++t)if(m.test(e[t][h]))return e[t];return null}})(ArrayUtils||={});var ResolutionFlags;(function(a){a[a.UHD=1]="UHD";a[a.HD=2]="HD";a[a.STD=4]="STD"})(ResolutionFlags||={});
class Device{static isModernGPU(a){if(Device.MODERN_GPU)return Device.MODERN_GPU;var e=a.match(/([0-9]+)/g);e=e?parseInt(e[0]):null;Device.isMobile()?a.match(/apple/i)?Device.MODERN_GPU=10<=e:a.match(/adreno/i)?Device.MODERN_GPU=540<e:a.match(/mali-t/i)?Device.MODERN_GPU=860<=e:a.match(/mali-g/i)?Device.MODERN_GPU=71<=e:Device.MODERN_GPU=!1:Device.MODERN_GPU=!0;return Device.MODERN_GPU}static getMaxResolutionFlag(){if(Device._resolutionFound)return Device._GL_RESOLUTION;let a=ResolutionFlags.HD;var e=
document.getElementById("glcanvas").getContext("experimental-webgl",{stencil:!0});let h=Device.isMobile()?2:4;navigator.deviceMemory&&(h=navigator.deviceMemory);const m=e.getParameter(e.MAX_TEXTURE_SIZE),t=e.getExtension("WEBGL_debug_renderer_info");e=e.getParameter(t.UNMASKED_RENDERER_WEBGL);window.console.info("Performance level : ",Device.isModernGPU(e)?"High":"Standard","(GPU : ",e," Memory : ",h,")");window.console.info("    - In 'High' performance mode on desktop, all effect can be used (lights, static and dynamic shadows)");
window.console.info("    - In 'High' performance mode on mobile, only lights can be used");window.console.info("    - In 'Standard' performance mode, lights (except ambient lighting) and shadows are disabled");m&&4096<=m?a=ResolutionFlags.UHD:m&&2048>m&&(a=ResolutionFlags.STD);a==ResolutionFlags.UHD&&(4>h||!Device.isModernGPU(e))&&(a=ResolutionFlags.HD);Device._resolutionFound=!0;Device._GL_RESOLUTION=a;Device.isIOS()&&(Device._GL_RESOLUTION=Device.isIpod()?ResolutionFlags.STD:ResolutionFlags.HD);
return Device._GL_RESOLUTION}static projectedSize(a,e,h){switch(PathUtils.getFlagResolutionPath(a)){case PathUtils.UHD_PATH:a=.01;break;case PathUtils.STD_PATH:a=.04;break;default:a=.02}let m=new THREE.Vector2;m.x=e*a;m.y=h*a;return m}static projectedSizeForMaxResolution(a,e){const h=new Vector2;let m;switch(Device.getMaxResolutionFlag()){case ResolutionFlags.UHD:m=.01;break;case ResolutionFlags.STD:m=.04;break;default:m=.02}h.x=a*m;h.y=e*m;return h}static getMaxResolutionDivisor(){let a=1;switch(Device.getMaxResolutionFlag()){case ResolutionFlags.HD:a=
2;break;case ResolutionFlags.STD:a=4}return a}static isInFrame(){return!!window.frameElement}static isMobile(){return null!=this._isMobile?this._isMobile:this._isMobile=Device.isPhone()||Device.isIPad()}static isIOS(){return null!=this._isIOS?this._isIOS:this._isIOS=Device.isIPhone()||Device.isIpod()||Device.isIPad()}static iOSVersion(){if(null!=this._iOSVersion)return this._iOSVersion;let a=navigator.userAgent.match(/OS ((\d+_?){2,3})\s/);return a?this._iOSVersion=parseInt(a[1].split("_")[0],10):
(a=navigator.userAgent.match(/Version\/(\d+)/))?this._iOSVersion=parseInt(a[1]):this._iOSVersion=-1}static launchedFromSphereApp(){return/sphereapp/i.test(navigator.userAgent)}static get isOculusBrowser(){return/OculusBrowser/.test(navigator.userAgent)}static orientationFromSphereApp(){return Device.launchedFromSphereApp()?parseInt(navigator.userAgent.match(/{(.*)}/i)[1]):0}static isAndroid(){return null!=this._isAndroid?this._isAndroid:this._isAndroid=/android/i.test(navigator.userAgent)||/android/i.test(navigator.appVersion)}static isFirefox(){return null!=
this._isFirefox?this._isFirefox:this._isFirefox=/firefox/i.test(navigator.userAgent)&&!Device.isMobile()}static isFirefoxReality(){return null!=this._isFirefoxReality?this._isFirefoxReality:this._isFirefoxReality=/firefox/i.test(navigator.userAgent)&&Device.isMobile()}static isWindowsPhone(){return null!=this._isWindowsPhone?this._isWindowsPhone:this._isWindowsPhone=/windows phone/i.test(navigator.userAgent)}static isIpod(){return null!=this._isIPod?this._isIPod:this._isIPod=/iPod/i.test(navigator.userAgent)}static isIPhone(){return null!=
this._isIPhone?this._isIPhone:this._isIPhone=/iPhone/i.test(navigator.userAgent)}static isIPad(){return null!=this._isIPad?this._isIPad:this._isIPad=/iPad/i.test(navigator.userAgent)||Device.isSafari()&&!Device.isIPhone()&&2<navigator.maxTouchPoints||/Mac OS/.test(navigator.userAgent)&&!/like Mac OS/.test(navigator.userAgent)&&2<navigator.maxTouchPoints}static getBrowserVersion(){if(null!=this._browserVersion)return this._browserVersion;if(this.isChrome()){var a=navigator.userAgent.match(/Chrom(?:e|ium)\/([0-9]+)\./);
return this._browserVersion=a?parseInt(a[1],10):-1}return this.isSafari()?this._browserVersion=(a=navigator.userAgent.match(/Version\/([0-9]+)\./))?parseInt(a[1],10):-1:this.isFirefox()?this._browserVersion=(a=navigator.userAgent.match(/Firefox\/([0-9]+)/))?parseInt(a[1],10):-1:-1}static isPhone(){return null!=this._isPhone?this._isPhone:this._isPhone=Device.isIPhone()||Device.isAndroid()||Device.isWindowsPhone()}static isSafari(){return null!=this._isSafari?this._isSafari:this._isSafari=/safari/i.test(navigator.userAgent)&&
!Device.isChrome()&&!Device.isEdge()}static isChrome(){return null!=this._isChrome?this._isChrome:this._isChrome=(/chrom(e|ium)/i.test(navigator.userAgent)||/crios/i.test(navigator.userAgent))&&!Device.isEdge()}static isTablet(){return null!=this._isTablet?this._isTablet:this._isTablet=Device.isIPad()||/(tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/i.test(navigator.userAgent)}static isIE11(){return null!=this._isIE11?this._isIE11:this._isIE11=
11==Device.internetExplorerVersion}static isIE(){return null!=this._isIE?this._isIE:this._isIE="Microsoft Internet Explorer"==navigator.appName&&/MSIE/.test(navigator.userAgent)||"Netscape"==navigator.appName&&/Trident/.test(navigator.userAgent)&&!/Edg/.test(navigator.userAgent)}static isEdge(){return null!=this._isEdge?this._isEdge:this._isEdge="Netscape"==navigator.appName&&/Edg?\//.test(navigator.userAgent)}static canUseWebAudio(){return null!=this._hasWebAudioAPI?this._hasWebAudioAPI:this._hasWebAudioAPI=
!(!window.AudioContext&&!window.webkitAudioContext)&&!Device.isIE()&&!(Device.isSafari()&&!Device.isMobile())&&!(Device.isSafari()&&14==Device.getBrowserVersion())}static hasActiveWebAudio(){return Device.canUseWebAudio()&&!(!View3D.inst.audioListener||!View3D.inst.audioListener.context)}static stringContainExtensions(a,e,h){return(new RegExp("^(.*\\.(("+e+"|"+h+")$))?[^.]*$","igm")).test(a)}static get internetExplorerVersion(){let a,e,h=-1;"Microsoft Internet Explorer"==navigator.appName?(e=navigator.userAgent,
a=RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),null!=a.exec(e)&&(h=parseFloat(RegExp.$1))):"Netscape"==navigator.appName&&(e=navigator.userAgent,a=RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),null!=a.exec(e)&&(h=parseFloat(RegExp.$1)));return h}}Device._resolutionFound=!1;Device._isMobile=null;Device._isIOS=null;Device._isAndroid=null;Device._isWindowsPhone=null;Device._isIPod=null;Device._isIPhone=null;Device._isIPad=null;Device._isPhone=null;Device._isTablet=null;Device._isFirefox=null;
Device._isFirefoxReality=null;Device._isSafari=null;Device._isChrome=null;Device._isIE=null;Device._isIE11=null;Device._isEdge=null;Device._iOSVersion=null;Device._browserVersion=null;Device._hasWebAudioAPI=null;Device.isInStoryline=null;Device.MODERN_GPU=!1;var PathUtils;
(function(a){a.UHD_PATH="uhd/";a.HD_PATH="hd/";a.STD_PATH="std/";a.stringIsVideo=function(e){return/(?:mp4|mpeg4|webm)(?:\.png)?$/ig.test(e)};a.fullPath=function(e){return e.bypassPath?(e=e.mediaFolder+e.paths[0],Config.IN_TEST_WINDOW?e.substr(1):Config.DATA_FOLDER+e):a.fullFolderPath(e)+e.paths[0]};a.fullFolderPath=function(e){let h=e.resolution?a.getFlagResolutionPath(e.resolution):"";return Config.DATA_FOLDER+e.customFolder+h+e.mediaFolder};a.getFlagResolutionPath=function(e){let h=Device.getMaxResolutionFlag(),
m;for(;0<h;){m=e&h;if(m==ResolutionFlags.UHD)return a.UHD_PATH;if(m==ResolutionFlags.HD)return a.HD_PATH;if(m==ResolutionFlags.STD)return a.STD_PATH;h>>=1}}})(PathUtils||={});class AudioLoader{load(a,e,h,m){let t=new THREE.FileLoader(new THREE.LoadingManager);t.setResponseType("arraybuffer");t.setPath(this.path);t.load(a,y=>{y=y.slice(0);View3D.inst.audioListener.context.decodeAudioData(y,e,m)},h,m)}}
class Loader3D{constructor(){this._edge=256;this._currentPercent=0;this.afterShaderRevealInit=()=>{this._revealAnim.setupAnim("loader",0,!0)};this.afterShaderMaskInit=()=>{this._maskAnim.setupAnim("loader",0,!1)};this._planeMaterialStart=new THREE.MeshBasicMaterial({color:0});this._planeMaterialEnd=new THREE.MeshBasicMaterial({color:0});var a=PathUtils.fullPath({bypassPath:!0,mediaFolder:"../static/assets/loader/",paths:["loader-start.png"]});let e=PathUtils.fullPath({bypassPath:!0,mediaFolder:"../static/assets/loader/",
paths:["loader-end.png"]});const h=new THREE.TextureLoader;h.load(a,m=>{this._planeMaterialStart.color=new THREE.Color(16777215);this._planeMaterialStart.map=m;this._planeMaterialStart.map.wrapS=this._planeMaterialStart.map.wrapT=THREE.RepeatWrapping;this._planeMaterialStart.map.needsUpdate=!0;this._planeMaterialStart.needsUpdate=!0});h.load(e,m=>{this._planeMaterialEnd.color=new THREE.Color(16777215);this._planeMaterialEnd.map=m;this._planeMaterialEnd.map.wrapS=this._planeMaterialEnd.map.wrapT=THREE.RepeatWrapping;
this._planeMaterialEnd.map.needsUpdate=!0;this._planeMaterialEnd.needsUpdate=!0});this._planeMaterialStart.transparent=!0;this._planeMaterialStart.alphaTest=Config.ALPHA_TEST;this._planeMaterialStart.blending=THREE.CustomBlending;this._planeMaterialStart.side=THREE.DoubleSide;this._planeMaterialEnd.transparent=!0;this._planeMaterialEnd.alphaTest=Config.ALPHA_TEST;this._planeMaterialEnd.blending=THREE.CustomBlending;this._planeMaterialEnd.side=THREE.DoubleSide;a=new THREE.Vector2(this._edge,this._edge);
this._meshStart=new THREE.Mesh(new THREE.PlaneBufferGeometry(a.x,a.y),this._planeMaterialStart);this._meshStart.scale.multiplyScalar(.1);this._meshStart.position.z=-100;this._meshEnd=new THREE.Mesh(new THREE.PlaneBufferGeometry(a.x,a.y),this._planeMaterialEnd);this._meshEnd.scale.multiplyScalar(.1);this._meshEnd.position.z=-100;View3D.inst.loadingCamera.add(this._meshEnd);View3D.inst.loadingCamera.add(this._meshStart);AssetAnimator.addGradientEntry("loader","./static/assets/loader/gradient.jpg");
this._revealAnim=new AssetAnimator(this._meshStart);this._maskAnim=new AssetAnimator(this._meshEnd);this._revealAnim.prepareShader(this.afterShaderRevealInit);this._maskAnim.prepareShader(this.afterShaderMaskInit)}resetValue(){this._currentPercent=0;this.setValue(0)}setValue(a){this._currentPercent=Math.max(this._currentPercent,a);this._meshStart.userData.shader&&(this._meshStart.userData.shader.uniforms.gradientVariation.value=this._currentPercent,this._meshEnd.userData.shader.uniforms.gradientVariation.value=
this._currentPercent)}}
class LoadProgressManager extends Notifiable{constructor(){super();if(null!=LoadProgressManager._inst)throw Error("LoadingScene is a singleton");document.getElementById("load_label").innerHTML=Localisation.inst.LOAD_LABEL;this._loadTotal=document.getElementById("load_total");this._loadProgress=document.getElementById("load_progress");this._loadBlock=document.getElementById("load_explain");Notifier.subscribe(this,InitCommand.VR_INIT_TESTED);Notifier.subscribe(this,InitCommand.UNLOCK_FINISHED)}static get inst(){return this._inst||(this._inst=
new LoadProgressManager)}notify(a,e){Notifier.unsubscribe(this,a);a==InitCommand.VR_INIT_TESTED?this.init():a==InitCommand.UNLOCK_FINISHED&&this.toggleLabels(!0)}init(){this.progressRing=new Loader3D;this.reset()}reset(){this.total=0;this.currentItem=1;this.percentPerItem=0;this._loadProgress.innerHTML="0";this.progressRing.resetValue()}toggleLabels(a){this._loadBlock.style.display=a?"block":""}addLength(a){this._loadTotal.innerHTML=(this.total+=a).toString();this.percentPerItem=100/this.total}update(a){this.setValue((this.currentItem+
a)*this.percentPerItem);a||(this._loadProgress.innerHTML=(this.currentItem++).toString())}setValue(a){this.progressRing.setValue(Math.min(a/100,1));Notifier.unleash(SceneCommand.LOAD_PROGRESS,a)}}class SPHHeader{static fromObject(a){let e=new SPHHeader;a.version&&(e.version=a.version);return e}}
class SPHTexture{constructor(){this.wrapT=this.wrapS=THREE.ClampToEdgeWrapping;this.repeatY=this.repeatX=0}static fromObject(a){let e=new SPHTexture;a.name&&(e.name=a.name);a.width&&(e.width=a.width);a.height&&(e.height=a.height);a.data&&(e.data=a.data);a.wrapS&&(e.wrapS=1001==a.wrapS?THREE.ClampToEdgeWrapping:1E3==a.wrapS?THREE.RepeatWrapping:THREE.MirroredRepeatWrapping);a.wrapT&&(e.wrapT=1001==a.wrapT?THREE.ClampToEdgeWrapping:1E3==a.wrapT?THREE.RepeatWrapping:THREE.MirroredRepeatWrapping);a.repeatX&&
(e.repeatX=a.repeatX);a.repeatY&&(e.repeatY=a.repeatY);return e}}class SPHFile{static fromObject(a){let e=new SPHFile;a.info&&(e.info=SPHHeader.fromObject(a.info));a.content&&(e.content=SPHGroup.fromObject(a.content));a.textures&&a.textures.length&&(e.textures=[],a.textures.forEach(h=>{e.textures.push(SPHTexture.fromObject(h))}));a.lights&&a.lights.length&&(e.lights=[],a.lights.forEach(h=>{e.lights.push(SPHLight.fromObject(h))}));return e}}var SPHNodeType;
(function(a){a[a.GROUP=1]="GROUP";a[a.MESH=2]="MESH"})(SPHNodeType||={});class SPHNode{populateBaseObject(a){a.matrix&&(this.matrix=a.matrix);a.name&&(this.name=a.name);a.type&&(this.type=a.type)}}
class SPHGroup extends SPHNode{constructor(){super();this.type=SPHNodeType.GROUP}static fromObject(a){let e=new SPHGroup;e.populateBaseObject(a);a.childs&&a.childs.length&&(e.childs=[],a.childs.forEach((h,m,t)=>{h.type==SPHNodeType.GROUP?e.childs.push(SPHGroup.fromObject(h)):h.type==SPHNodeType.MESH&&e.childs.push(SPHMesh.fromObject(h))}));return e}}
class SPHGeometry{static fromObject(a){let e=new SPHGeometry;a.vertexFormat&&(e.vertexFormat=a.vertexFormat);a.indexStream&&(e.indexStream=a.indexStream);a.vertexStream&&(e.vertexStream=a.vertexStream);a.vertexStreams&&(e.vertexStreams=a.vertexStreams);return e}}class MaterialType{}MaterialType.BASIC="BASIC";MaterialType.PHONG="PHONG";MaterialType.LAMBERT="LAMBERT";MaterialType.PBR="PBR";
class SPHMaterial{constructor(){this.shading=THREE.SmoothShading;this.premultipliedAlpha=!0;this.side=THREE.FrontSide;this.castShadow=this.receiveShadow=!1;this.emissiveIntensity=1;this.refractionRatio=.98;this.shininess=1}static getMaterial(a,e){let h=null;if(a&&0!=a.hasOwnProperty("type"))switch(a.type){case MaterialType.PHONG:h=new THREE.MeshPhongMaterial;break;case MaterialType.LAMBERT:h=new THREE.MeshLambertMaterial;break;case MaterialType.PBR:h=new THREE.MeshStandardMaterial;break;case MaterialType.BASIC:h=
new THREE.MeshBasicMaterial}else h=new THREE.MeshPhongMaterial;h.premultipliedAlpha=!0;h.side=THREE.DoubleSide;a&&1>a.alphaTest&&(h.premultipliedAlpha=!0,h.transparent=!0,h.alphaTest=a.alphaTest);h.opacity=a&&a.alphaTest?a.alphaTest:1;if(!a)return h;a.color&&(h.color=new THREE.Color(a.color.red,a.color.green,a.color.blue));a.map&&(h.map=e.get(a.map));a.lightMap&&(h.lightMap=e.get(a.lightMap),a.lightMapIntensity&&(h.lightMapIntensity=a.lightMapIntensity));a.aoMap&&(h.aoMap=e.get(a.aoMap),a.aoMapIntensity&&
(h.aoMapIntensity=a.aoMapIntensity));a.emissive&&(h.emissive=new THREE.Color(a.emissive.red,a.emissive.green,a.emissive.blue),a.emissiveIntensity&&(h.emissiveIntensity=a.emissiveIntensity));a.emissiveMap&&(h.emissiveMap=e.get(a.emissiveMap));a.refractionRatio&&(h.refractionRatio=a.refractionRatio);a.alphaMap&&(h.alphaMap=e.get(a.alphaMap));a.envMap&&(h.needsUpdate=!0);if(a.type==MaterialType.PHONG||a.type==MaterialType.LAMBERT)a.specularMap&&(h.specularMap=e.get(a.specularMap)),a.reflectivity&&(h.reflectivity=
a.reflectivity);if(a.type==MaterialType.PHONG||a.type==MaterialType.PBR)a.bumpMap&&(h.bumpMap=e.get(a.bumpMap),a.bumpScale&&(h.bumpScale=a.bumpScale)),a.normalMap&&(h.normalMap=e.get(a.normalMap)),a.displacementMap&&(h.displacementMap=e.get(a.displacementMap),a.displacementScale&&(h.displacementScale=a.displacementScale),a.displacementBias&&(h.displacementBias=a.displacementBias));a.type==MaterialType.PHONG&&(a.specular&&(h.specular=new THREE.Color(a.specular.red,a.specular.green,a.specular.blue)),
a.shininess&&(h.shininess=a.shininess));a.type==MaterialType.PBR&&(a.roughness&&(h.roughness=Math.max(Math.min(a.roughness,1),0)),a.metalness&&(h.metalness=Math.max(Math.min(a.metalness,1),0)),a.roughnessMap&&(h.roughnessMap=e.get(a.roughnessMap)),a.metalnessMap&&(h.metalnessMap=e.get(a.metalnessMap)),a.envMapIntensity&&(h.envMapIntensity=a.envMapIntensity));return h}static fromObject(a){let e=new SPHMaterial;a.type&&"PHONG"==a.type&&(e.type=MaterialType.PHONG);e.type=a.type&&"LAMBERT"==a.type?MaterialType.LAMBERT:
a.type&&"PBR"==a.type?MaterialType.PBR:MaterialType.BASIC;a.color&&(e.color=a.color);a.alphaThreshold&&(e.alphaTest=a.alphaThreshold);a.map&&(e.map=a.map);a.lightMap&&(e.lightMap=a.lightMap);a.lightMapIntensity&&(e.lightMapIntensity=a.lightMapIntensity);a.aoMap&&(e.aoMap=a.aoMap);a.aoMapIntensity&&(e.aoMapIntensity=a.aoMapIntensity);a.emissive&&(e.emissive=a.emissive);a.emissiveIntensity&&(e.emissiveIntensity=a.emissiveIntensity);a.emissiveMap&&(e.emissiveMap=a.emissiveMap);a.refractionRatio&&(e.refractionRatio=
a.refractionRatio);a.alphaMap&&(e.alphaMap=a.alphaMap);a.envMap&&(e.envMap=a.envMap);a.receiveShadow&&(e.receiveShadow=a.receiveShadow);a.castShadow&&(e.castShadow=a.castShadow);a.shadowBias&&(e.shadowBias=a.shadowBias);a.specularMap&&(e.specularMap=a.specularMap);a.reflectivity&&(e.reflectivity=a.reflectivity);a.bumpMap&&(e.bumpMap=a.bumpMap);a.bumpScale&&(e.bumpScale=a.bumpScale);a.normalMap&&(e.normalMap=a.normalMap);a.displacementMap&&(e.displacementMap=a.displacementMap);a.displacementScale&&
(e.displacementScale=a.displacementScale);a.displacementBias&&(e.displacementBias=a.displacementBias);a.specular&&(e.specular=a.specular);a.shininess&&(e.shininess=a.shininess);a.roughness&&(e.roughness=a.roughness);a.metalness&&(e.metalness=a.metalness);a.roughnessMap&&(e.roughnessMap=a.roughnessMap);a.metalnessMap&&(e.metalnessMap=a.metalnessMap);a.envMapIntensity&&(e.envMapIntensity=a.envMapIntensity);return e}}
class SPHMesh extends SPHNode{constructor(){super();this.type=SPHNodeType.MESH}static fromObject(a){let e=new SPHMesh;e.populateBaseObject(a);a.geometry&&(e.geometry=SPHGeometry.fromObject(a.geometry));a.material&&(e.material=SPHMaterial.fromObject(a.material));return e}}
class SPHLight{constructor(){this.distance=30}static fromObject(a){let e=new SPHLight;a.name&&(e.name=a.name);a.type&&(e.type=a.type);a.matrix&&(e.matrix=a.matrix);a.target&&(e.target=a.target);a.intensity&&(e.intensity=a.intensity);a.color&&(e.color=a.color);a.distance&&(e.distance=a.distance);a.angle&&(e.angle=a.angle);a.penumbra&&(e.penumbra=a.penumbra);a.castShadows&&(e.castShadows=a.castShadows);a.shadowBias&&(e.shadowBias=a.shadowBias);return e}}
class SPHParser{constructor(a,e=!0){this.typeGroup=0;this._useMultiresolutionFor3D=e;this.basename=a;SPHParser.SHADOW_MAP_SIZE_WIDTH=Device.isMobile()?256:1024;SPHParser.SHADOW_MAP_SIZE_HEIGHT=Device.isMobile()?256:1024}getTexturesList(a){if(a.textures){const e=[];a.textures.forEach(h=>{0!=h.hasOwnProperty("data")&&null!=h.data&&0!=h.data.length||-1!=e.indexOf(h.name)||(console.log("textures : "+e),e.push(h.name))});return e}return null}generate(a,e=""){this._preferablePath=e;this.version=a.info?
a.info.version:"3.0";if(this.version==SPHParser.V1||this.version==SPHParser.V2)this.typeGroup=1;null!=a.textures&&this.generateTextures(a.textures);this._currentGroupId=THREE.MathUtils.generateUUID();e=this.generateGroup(a.content);const h=new THREE.Group;e.userData.hasLights=!1;a.lights&&(e.userData.hasLights=!0,a.lights.forEach((m,t,y)=>{m=this.generateLight(m);h.add(m);m.target&&h.add(m.target)}));e.add(h);return e}generateLight(a){var e=new DataView(a.color.buffer,0,16),h=new THREE.Color,m=e.getFloat32(0,
!0);const t=e.getFloat32(4,!0);e=e.getFloat32(8,!0);h.setRGB(m,t,e);switch(a.type){case SPHParser.POINT_LIGHT:var y=new THREE.PointLight(h.getHex(),a.intensity,a.distance);Device.isMobile()?y.castShadow=!1:(y.castShadow=a.castShadows,y.shadow.bias=.001,y.shadow.mapSize.width=SPHParser.SHADOW_MAP_SIZE_WIDTH,y.shadow.mapSize.height=SPHParser.SHADOW_MAP_SIZE_HEIGHT,y.shadow.camera.near=.1,y.shadow.camera.far=2E4);break;case SPHParser.SPOT_LIGHT:y=new THREE.SpotLight(h.getHex(),a.intensity,a.distance,
a.angle/2,a.penumbra,2);y.penumbra=a.penumbra;Device.isMobile()?y.castShadow=!1:(y.castShadow=a.castShadows,y.shadow.bias=a.shadowBias,y.shadow.mapSize.width=SPHParser.SHADOW_MAP_SIZE_WIDTH,y.shadow.mapSize.height=SPHParser.SHADOW_MAP_SIZE_HEIGHT,y.shadow.camera.near=.1,y.shadow.camera.far=2E4);break;case SPHParser.DIRECTIONAL_LIGHT:y=new THREE.DirectionalLight(h.getHex(),a.intensity);Device.isMobile()?y.castShadow=!1:(y.castShadow=a.castShadows,y.shadow.bias=a.shadowBias,y.shadow.mapSize.width=SPHParser.SHADOW_MAP_SIZE_WIDTH,
y.shadow.mapSize.height=SPHParser.SHADOW_MAP_SIZE_HEIGHT,y.shadow.camera.near=.1,y.shadow.camera.far=2E4);break;case SPHParser.HEMI_LIGHT:y=new THREE.Color(Math.max(0,h.r-25),Math.max(0,h.g-25),Math.max(0,h.b-25));y=new THREE.HemisphereLight(h.getHex(),y.getHex(),a.intensity);break;case SPHParser.AMBIENT_LIGHT:y=new THREE.AmbientLight(h.getHex(),a.intensity)}h=new DataView(a.matrix.buffer,0,64);m=new THREE.Matrix4;this.populateMatrix(m,h);m.decompose(y.position,y.quaternion,y.scale);y.updateMatrix();
y.uuid=THREE.MathUtils.generateUUID();y.name=a.name;return y}generateLightHelper(a){let e;switch(a.type){case "PointLight":e=new THREE.PointLightHelper(a);break;case "SpotLight":e=new THREE.SpotLightHelper(a);break;case "DirectionalLight":e=new THREE.DirectionalLightHelper(a);break;case "HemisphereLight":e=new THREE.HemisphereLightHelper(a)}e.update();return e}generateGroup(a){const e=new THREE.Group;e.name=a.name;const h=new DataView(a.matrix.buffer),m=new THREE.Matrix4;this.populateMatrix(m,h);
m.decompose(e.position,e.quaternion,e.scale);e.updateMatrix();a.childs&&a.childs.forEach((t,y,C)=>{if(t.type==this.typeGroup)e.add(this.generateGroup(t));else if(t=this.generateMesh(t))t.uuid=THREE.MathUtils.generateUUID(),e.add(t)});return e}generateMesh(a){var e,h=new THREE.BufferGeometry,m=0,t=0,y=0,C=0,I=0;if(a.geometry){a.geometry.vertexFormat&SPHParser.VERTEX_XYZ&&(m+=3);a.geometry.vertexFormat&SPHParser.VERTEX_RGB&&(y=m,m+=3);a.geometry.vertexFormat&SPHParser.VERTEX_RGBA&&(C=m,m+=4);a.geometry.vertexFormat&
SPHParser.VERTEX_UV&&(I=m,m+=2);a.geometry.vertexFormat&SPHParser.VERTEX_NORMAL&&(t=m,m+=3);a.geometry.vertexFormat&SPHParser.VERTEX_TANGENT&&(m+=3);var E=a.geometry.indexStream.buffer.byteLength/4;var H=[];var O=new DataView(a.geometry.indexStream.buffer);for(e=0;e<E;e++)H[e]=O.getUint32(4*e,!0);H=H.reverse();e=new Uint32Array(H);h.setIndex(new THREE.BufferAttribute(e,1));e=this.version===SPHParser.V3?a.geometry.vertexStream.buffer:a.geometry.vertexStreams[0].buffer;E=e.byteLength/4/m;O=new DataView(e);
var R=new Float32Array(3*E);for(H=e=0;e<E;e++,H+=3)R[H]=O.getFloat32(e*m*4,!0),R[H+1]=O.getFloat32(e*m*4+4,!0),R[H+2]=O.getFloat32(e*m*4+8,!0);h.setAttribute("position",new THREE.BufferAttribute(R,3));if(0<y){R=new Float32Array(3*E);for(H=e=0;e<E;e++,H+=3)R[H]=O.getFloat32(4*y+e*m*4,!0),R[H+1]=O.getFloat32(4*y+e*m*4+4,!0),R[H+2]=O.getFloat32(4*y+e*m*4+8,!0);h.setAttribute("color",new THREE.BufferAttribute(R,3))}if(0<C){R=new Float32Array(3*E);y=this.version===SPHParser.V3?0:4;for(H=e=0;e<E;e++,H+=
3)R[H]=O.getFloat32(4*C+e*m*4+y,!0),R[H+1]=O.getFloat32(4*C+e*m*4+y+4,!0),R[H+2]=O.getFloat32(4*C+e*m*4+y+8,!0);h.setAttribute("color",new THREE.BufferAttribute(R,3))}if(0<I){C=new Float32Array(2*E);for(H=e=0;e<E;e++,H+=2)C[H]=O.getFloat32(4*(I+e*m),!0),C[H+1]=O.getFloat32(4*(I+e*m)+4,!0);h.setAttribute("uv",new THREE.BufferAttribute(C,2));h.uvsNeedUpdate=!0}if(0<t){I=new Float32Array(3*E);for(H=e=0;e<E;e++,H+=3)I[H]=O.getFloat32(4*(t+e*m),!0),I[H+1]=O.getFloat32(4*(t+e*m)+4,!0),I[H+2]=O.getFloat32(4*
(t+e*m)+8,!0);h.setAttribute("normal",new THREE.BufferAttribute(I,3))}}m=this.generateMaterial(a.material);h=new THREE.Mesh(h,m);h.name=a.name;a.material&&a.material.envMap&&a.material.envMap.length&&(h.userData={envMap:!0});a.material&&(h.receiveShadow=a.material.receiveShadow,h.castShadow=a.material.castShadow);a=new DataView(a.matrix.buffer);t=new THREE.Matrix4;this.populateMatrix(t,a);t.decompose(h.position,h.quaternion,h.scale);h.updateMatrix();h.renderOrder=1==m.transparent?Config.RENDER_ORDER_TRANSPARENT++:
Config.RENDER_ORDER_OPAQUE++;return h}populateMatrix(a,e){a.set(e.getFloat32(0,!0),e.getFloat32(4,!0),e.getFloat32(8,!0),e.getFloat32(12,!0),e.getFloat32(16,!0),e.getFloat32(20,!0),e.getFloat32(24,!0),e.getFloat32(28,!0),e.getFloat32(32,!0),e.getFloat32(36,!0),e.getFloat32(40,!0),e.getFloat32(44,!0),e.getFloat32(48,!0),e.getFloat32(52,!0),e.getFloat32(56,!0),e.getFloat32(60,!0))}populateVector3(a,e){a.set(e.getFloat32(0,!0),e.getFloat32(4,!0),e.getFloat32(8,!0))}generateMaterial(a){return SPHMaterial.getMaterial(a,
this.textures)}generateTextures(a){this.textures=new MessyDictionary;a.forEach(e=>{0==e.hasOwnProperty("data")||null==e.data||0==e.data.length?this.generateTextureFromImage(e):this.generateTextureFromData(e)})}generateTextureFromData(a){if(null!=a.data){var e=new DataView(a.data.buffer);var h=a.data.buffer.byteLength;var m=new Uint8Array(h);var t;if(this.version==SPHParser.V3)for(t=0;t<h;t+=4)m[t]=e.getUint8(t),m[t+1]=e.getUint8(t+1),m[t+2]=e.getUint8(t+2),m[t+3]=e.getUint8(t+3);else for(t=0;t<h;t+=
4)m[t]=e.getUint8(t+1),m[t+1]=e.getUint8(t+2),m[t+2]=e.getUint8(t+3),m[t+3]=e.getUint8(t);e=new THREE.DataTexture(m,a.width,a.height,THREE.RGBAFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.MirroredRepeatWrapping,THREE.MirroredRepeatWrapping,THREE.NearestFilter,THREE.NearestFilter,8);e.anisotropy=0;e.generateMipmaps=!0;this.textures.add(a.name,e)}}generateTextureFromImage(a){if(null!=a.name&&0!=a.name.length){var e=Config.DATA_FOLDER+"3D/"+this.basename+"/"+(this._useMultiresolutionFor3D?"uhd/":
"")+a.name;this._preferablePath&&this._preferablePath.length&&(e=this._preferablePath+a.name);var h=new THREE.TextureLoader;this.textures.add(a.name,h.load(e,m=>{m.anisotropy=0;m.generateMipmaps=!0;m.wrapS=a.wrapS;m.wrapT=a.wrapT;m.magFilter=THREE.LinearFilter;m.minFilter=THREE.LinearMipmapLinearFilter}))}}}SPHParser.V1="1.0";SPHParser.V2="2.0";SPHParser.V3="3.0";SPHParser.VERTEX_XYZ=1;SPHParser.VERTEX_RGB=2;SPHParser.VERTEX_RGBA=4;SPHParser.VERTEX_UV=8;SPHParser.VERTEX_NORMAL=16;
SPHParser.VERTEX_TANGENT=32;SPHParser.POINT_LIGHT=1;SPHParser.SPOT_LIGHT=2;SPHParser.DIRECTIONAL_LIGHT=3;SPHParser.AMBIENT_LIGHT=4;SPHParser.HEMI_LIGHT=5;SPHParser.SHADOW_MAP_SIZE_WIDTH=1024;SPHParser.SHADOW_MAP_SIZE_HEIGHT=1024;
class CinematicAnimationData extends AbstractScriptParser{constructor(){super(...arguments);this.kind=CinematicAnimationData.ANIM_STOP;this.reverse=!1;this.time=null;this.speed=1;this.duration=null;this.useFrame=!0}static fromName(a){return this.loopOnKeys(a,new CinematicAnimationData)}parseVal(a,e){"playonce"==a?this.kind=CinematicAnimationData.ANIM_PLAY_ONCE:"playloop"==a?this.kind=CinematicAnimationData.ANIM_PLAY_LOOP:"playpingpong"==a?this.kind=CinematicAnimationData.ANIM_PLAY_PINGPONG:"pause"==
a?this.kind=CinematicAnimationData.ANIM_PAUSE:"stop"==a?this.kind=CinematicAnimationData.ANIM_STOP:"r"==a||"reverse"==a?this.reverse=!0:"t"==a||"time"==a?this.time=parseFloat(e):"s"==a||"speed"==a?this.speed=parseFloat(e):"d"==a||"duration"==a?this.duration=parseFloat(e):"target"==a||"targets"==a?this.targets=e.split("|"):"second"==a&&(this.useFrame=!1)}}CinematicAnimationData.ANIM_STOP="stop";CinematicAnimationData.ANIM_STOP_SMOOTH="stopsmooth";CinematicAnimationData.ANIM_PAUSE="pause";
CinematicAnimationData.ANIM_PLAY_ONCE="playonce";CinematicAnimationData.ANIM_PLAY_LOOP="playloop";CinematicAnimationData.ANIM_PLAY_PINGPONG="playpingpong";CinematicAnimationData.SPEED_RATIO=.1664;
class CinematicData extends AbstractScriptParser{constructor(){super(...arguments);this.time=1;this.opacity=this.scalez=this.scaley=this.scalex=this.translatez=this.translatey=this.translatex=this.rotatez=this.rotatey=this.rotatex=null;this.target="element";this.otarget=this.starget=this.ttarget=this.rtarget=null;this.runOnFirstFrame=!1;this.owner=null;this.loop=this.keep=!1;this.repeat=Infinity;this.yoyo=this.reverse=!1;this.ease="linear"}hasScaleValues(){return null!=this.scalex||null!=this.scaley||
null!=this.scalez}hasTranlationValues(){return null!=this.translatex||null!=this.translatey||null!=this.translatez}hasRotationValues(){return null!=this.rotatex||null!=this.rotatey||null!=this.rotatez}hasOpacityValue(){return null!=this.opacity}getTweeningRotationObject(){let a={};null!=this.rotatex&&(a.x=THREE.MathUtils.degToRad(parseFloat(this.rotatex)));null!=this.rotatey&&(a.y=THREE.MathUtils.degToRad(parseFloat(this.rotatey)));null!=this.rotatez&&(a.z=THREE.MathUtils.degToRad(parseFloat(this.rotatez)));
return a}getTweeningTranslationObject(){let a={};null!=this.translatex&&(a.x=parseFloat(this.translatex));null!=this.translatey&&(a.y=parseFloat(this.translatey));null!=this.translatez&&(a.z=parseFloat(this.translatez));return a}getTweeningScaleObject(){let a={};null!=this.scalex&&(a.x=parseFloat(this.scalex));null!=this.scaley&&(a.y=parseFloat(this.scaley));null!=this.scalez&&(a.z=parseFloat(this.scalez));return a}static getFromName(a){var e=this.extractBaseCode(a);if(!e)return null;var h=e.match(/animation(.*)\}/g);
a="";h&&h[0]&&(a=h[0],e.replace(a,""),e=e.replace(",,",","));(h=e.match(/glow(.*)\}/g))&&h[0]&&(e=e.replace(h[0],""),e=e.replace(",,",","));e=this.loopOnKeys(e,new CinematicData);a&&(a=a.replace("animation:{",""),a=a.replace("}",""),e.animation=CinematicAnimationData.fromName(a));return e}parseVal(a,e){if("keep"==a)this.keep=!0;else if("owner"==a)this.owner=e;else if("r"==a||"reverse"==a)this.reverse=!0;else if("y"==a||"yoyo"==a)this.yoyo=!0;else if("l"==a||"loop"==a)this.loop=!0,e&&(this.repeat=
parseInt(e));else if("id"==a)this.id=e;else if("chain"==a)this.chain=e;else if("target"==a)this.target=e&&"aspect"==e?"aspect":"element";else if("rtarget"==a)this.rtarget=e&&"aspect"==e?"aspect":"element";else if("ttarget"==a)this.ttarget=e&&"aspect"==e?"aspect":"element";else if("starget"==a)this.starget=e&&"aspect"==e?"aspect":"element";else if("otarget"==a)this.otarget=e&&"aspect"==e?"aspect":"element";else if("rx"==a||"rotatex"==a)this.rotatex=parseFloat(e);else if("ry"==a||"rotatey"==a)this.rotatey=
parseFloat(e);else if("rz"==a||"rotatez"==a)this.rotatez=parseFloat(e);else if("tx"==a||"translatex"==a)this.translatex=parseFloat(e);else if("ty"==a||"translatey"==a)this.translatey=parseFloat(e);else if("tz"==a||"translatez"==a)this.translatez=parseFloat(e);else if("sx"==a||"scalex"==a)this.scalex=parseFloat(e);else if("sy"==a||"scaley"==a)this.scaley=parseFloat(e);else if("sz"==a||"scalez"==a)this.scalez=parseFloat(e);else if("t"==a||"time"==a)this.time=1E3*parseFloat(e);else if("in"==a||"easein"==
a)this.ease=CinematicData.EASE_IN;else if("out"==a||"easeout"==a)this.ease=CinematicData.EASE_OUT;else if("inout"==a||"easeinout"==a)this.ease=CinematicData.EASE_IN_OUT;else if("linear"==a||"easelinear"==a)this.ease=CinematicData.EASE_LINEAR;else if("o"==a||"opacity"==a)this.opacity=parseFloat(e)}}CinematicData.EASE_IN="easein";CinematicData.EASE_OUT="easeout";CinematicData.EASE_IN_OUT="easeinout";CinematicData.EASE_LINEAR="easelinear";
class GlowAnimationScriptData extends AbstractScriptParser{constructor(){super(...arguments);this.runOnFirstFrame=this.animationglow=!1;this.time=1;this.loop=!1;this.repeat=Infinity;this.reverse=!1;this.ease="linear";this.alpha=this.color=void 0}static getFromName(a){return this.loopOnKeys(this.extractBaseCode(a,"glow"),new GlowAnimationScriptData)}parseVal(a,e){this.animationglow=!0;if("color"==a)this.color=new THREE.Color(e);else if("alpha"==a)this.alpha=parseFloat(e);else if("time"==a||"t"==a)this.time=
1E3*parseFloat(e);else if("loop"==a||"l"==a)this.loop=!0,e&&(this.repeat=parseInt(e));else if("reverse"==a)this.reverse=!0;else if("in"==a||"easein"==a)this.ease=CinematicData.EASE_IN;else if("out"==a||"easeout"==a)this.ease=CinematicData.EASE_OUT;else if("inout"==a||"easeinout"==a)this.ease=CinematicData.EASE_IN_OUT;else if("linear"==a||"easelinear"==a)this.ease=CinematicData.EASE_LINEAR}}var ScriptingHelpers;
(function(a){a.implicationFromScript=function(e,h,m,t,y){let C=new ImplicationData;C.uuid=UUID.generate();C.inputStatement=[];C.outputStatement=[];let I=new StatementData;I.targetUUID=e;I.triggerUUID=h;I.triggerType=m;C.inputStatement.push(I);h=new StatementData;h.targetUUID=e;h.triggerUUID=t;h.triggerType=y;y==StatementTrigger.ANIM&&(h.animState=StatePlaybackType.PLAY);C.outputStatement.push(h);Config.simulationData.implications[e]||(Config.simulationData.implications[e]=[]);Config.simulationData.implications[e].push(C)}})(ScriptingHelpers||=
{});var AnimationScripting;
(function(a){function e(t,y,C){if(C.owner&&"camera"==C.owner)return null;y=h(t,y,C);y.isImmediate=C.owner&&"self"==C.owner||C.time&&0==C.time;C.yoyo&&(y.yoyo=C.yoyo);C.target&&(y.target=C.target);C.hasOpacityValue()&&(y.opacity=Math.max(Math.min(C.opacity,.999),.001),y.hasOpacityValue=!0);C.hasTranlationValues()&&(y.position=C.getTweeningTranslationObject(),y.hasPositionValues=!0);C.hasRotationValues()&&(y.rotation=C.getTweeningRotationObject(),y.hasRotationValues=!0);C.hasScaleValues()&&(y.scale=
C.getTweeningScaleObject(),y.hasScaleValues=!0);if(C.chain){let I="";t.states.forEach(E=>{var H;if(null===(H=E.name)||void 0===H?0:H.match("id:"+C.chain))I=E.uuid});if(!I)return y;ScriptingHelpers.implicationFromScript(t.uuid,y.uuid,StatementTrigger.ANIM_END,I,StatementTrigger.STATE)}return y}function h(t,y,C){let I=new SphereAnimationData;I.uuid=UUID.generate();I.runOnFirstFrame=C.runOnFirstFrame;ScriptingHelpers.implicationFromScript(t.uuid,y.uuid,StatementTrigger.STATE,I.uuid,StatementTrigger.ANIM);
y.name&&(I.name=y.name);I.time=C.time&&1!=C.time?C.time:100;switch(C.ease){case CinematicData.EASE_IN:I.interpolation=Interpolation.EASE_IN;break;case CinematicData.EASE_IN_OUT:I.interpolation=Interpolation.EASE_IN_OUT;break;case CinematicData.EASE_OUT:I.interpolation=Interpolation.EASE_OUT;break;default:I.interpolation=Interpolation.LINEAR}C.loop&&(I.loop=C.loop,C.repeat&&(I.repeat=C.repeat));return I}function m(t,y,C){let I=new GLTFAnimationData,E=C.animation;I.uuid=UUID.generate();I.target="";
ScriptingHelpers.implicationFromScript(t.uuid,y.uuid,StatementTrigger.STATE,I.uuid,StatementTrigger.ANIM);switch(E.kind){case CinematicAnimationData.ANIM_PLAY_LOOP:I.kind=StatePlaybackType.PLAY_LOOP;break;case CinematicAnimationData.ANIM_PLAY_PINGPONG:I.kind=StatePlaybackType.PING_PONG;break;case CinematicAnimationData.ANIM_PAUSE:I.kind=StatePlaybackType.PAUSE;break;case CinematicAnimationData.ANIM_STOP:case CinematicAnimationData.ANIM_STOP_SMOOTH:I.kind=StatePlaybackType.STOP;break;default:I.kind=
StatePlaybackType.PLAY}E.speed&&(I.speed=E.speed);E.targets&&(I.targets=E.targets);E.reverse&&(I.reverse=!0);if(C.chain){let H="";t.states.forEach(O=>{var R;if(null===(R=O.name)||void 0===R?0:R.match("id:"+C.chain))H=O.uuid});if(!H)return I;ScriptingHelpers.implicationFromScript(t.uuid,I.uuid,StatementTrigger.ANIM_END,H,StatementTrigger.STATE)}return I}a.fromCinematicData=function(t,y,C){return"undefined"==typeof C.animation?e(t,y,C):m(t,y,C)};a.fromGlowAnimationScript=function(t,y,C){t=h(t,y,C);
C.color&&(t.color={},t.color.r=C.color.r,t.color.g=C.color.g,t.color.b=C.color.b,t.hasGlowValues=!0);C.alpha&&(t.color||(t.color={}),t.color.a=C.alpha,t.hasGlowValues=!0);return t}})(AnimationScripting||={});
class JsonScriptConverter extends AbstractScriptParser{static loopOnKeys(a,e){if(!a)return null;if(this.NO_SUBSET_EXTRACTED==a)return e;e.fromScript(this.jsonConvert(a));return e}static jsonConvert(a){a=a.replace(/([a-zA-Z0-9_. \-]+)/g,'"$1"');try{return JSON.parse(a)}catch(e){console.error("JSON script error",a,e)}}parseVal(a,e){}}JsonScriptConverter.SUBSET_EXTRACTOR="(?::?)(.+)";
class CheckpointScriptData extends JsonScriptConverter{constructor(a){super();this.points=[];this._scene=a;if(!a)throw Error("No scene to parse data from");}static getFromName(a,e){return this.loopOnKeys(this.extractBaseCode(a,"checkpoint"),new CheckpointScriptData(e))}fromScript(a){this.points=[];if(a instanceof Array)for(let e=0;e<a.length;++e)this.toData(a[e]);else a&&this.toData(a);this._scene=null}toData(a){if("object"==typeof a){if(!a.name)return console.error("Checkpoint with no name have been skipped",
a);var e={uuid:UUID.generate(),sceneUuid:this._scene.uuid,name:a.name};e.goToDefaults=!(!a.default&&!a.reset);if(a.targets){let t=[];var h=y=>{(y=this._parsePartialElement(y,e.goToDefaults))&&t.push(y)};if(a.targets instanceof Array&&a.targets.length)for(var m=0;m<a.targets.length;++m)h(a.targets[m]);else h(a.targets);t.length&&(e.targets=t)}if(a.except){let t={};h=y=>{(y=this._parsePartialElement(y,!0))&&(t[y.uuid]=!0)};if(a.except instanceof Array&&a.except.length)for(m=0;m<a.except.length;++m)h(a.except[m]);
else h(a.except);Object.keys(t).length&&(e.exceptions=t,e.goToDefaults=!0)}if(e.targets&&e.exceptions)return console.error("Invalid checkpoint, cannot have reset exceptions and target items at the same time",a);if(!e.targets&&!e.exceptions)return console.error("Checkpoint does nothing",a,e);this.points.push(e)}}_parsePartialElement(a,e){var h,m;"string"==typeof a&&(a={name:a});let t=ArrayUtils.regexFind(this._scene.elements,"name",a.name),y={},C;if(!t)return console.error("Did not find element",a.name,
"in checkpoint",a),null;y.uuid=t.uuid;y.name=t.name;if(e)return y;for(let I in a)switch(I){case "state":y.defaultStateUUID=null===(h=ArrayUtils.regexFind(t.states,"name",a[I]))||void 0===h?void 0:h.uuid;y.defaultStateUUID||(C="Invalid state in checkpoint");break;case "aspect":y.defaultAspectUUID=null===(m=ArrayUtils.regexFind(t.aspects,"name",a[I]))||void 0===m?void 0:m.uuid;y.defaultAspectUUID||(C="Invalid aspect in checkpoint");break;case "position":case "rotation":case "scale":y[I]=GeometryUtils.arrayToVector(a[I]);
break;case "name":break;default:C="Invalid data in checkpoint"}C&&console.error(C,a);return y}parseVal(a,e){}}CheckpointScriptData.SUBSET_EXTRACTOR="(?::?)(.+)";class VoiceRecognitionScriptData extends AbstractScriptParser{constructor(){super(...arguments);this.lang="fr-FR"}static getFromName(a){return this.loopOnKeys(this.extractBaseCode(a,"voice"),new VoiceRecognitionScriptData)}parseVal(a,e){"lang"==a?this.lang=e:"chain"==a?this.chain=e:"pattern"==a?this.pattern=e:"speak"==a&&(this.speak=e)}}var SimulationDataStartup;
(function(a){a.parseScriptData=function(e){var h;for(let C=0;C<e.length;++C){let I=e[C];var m=CheckpointScriptData.getFromName(I.name,I);if(m&&m.points.length)for(var t=0;t<m.points.length;++t){var y=m.points[t];Config.simulationData.checkpoints[y.uuid]=y}!Config.simulationData.multi&&(null===(h=MultiPlayerScript.getFromName(I.name))||void 0===h?0:h.isLobby)&&(m=new MultiplayerData,m.lobby=I,Config.simulationData.multi=m);if(I.elements)for(m=0;m<I.elements.length;++m)if(t=I.elements[m],t.states)for(y=
0;y<t.states.length;++y){let E=t.states[y];if(!E.name)continue;if(!AbstractScriptParser.isScript(E.name))continue;let H=CinematicData.getFromName(E.name),O=GlowAnimationScriptData.getFromName(E.name),R=VoiceRecognitionScriptData.getFromName(E.name),W=PhysicInteractionScriptData.getFromName(E.name);t.animations||(t.animations=[]);!H||H.owner&&"camera"==H.owner||(H.runOnFirstFrame=t.defaultStateUUID==E.uuid,t.animations.push(AnimationScripting.fromCinematicData(t,E,H)));O&&(O.runOnFirstFrame=t.defaultStateUUID==
E.uuid,t.animations.push(AnimationScripting.fromGlowAnimationScript(t,E,O)));if(R){let ea;t.states.forEach(T=>{var fa;if(null===(fa=T.name)||void 0===fa?0:fa.match("id:"+R.chain))ea=T.uuid});ea&&ScriptingHelpers.implicationFromScript(t.uuid,E.uuid,StatementTrigger.VOICE_RECOGNIZE,ea,StatementTrigger.STATE)}if(W){let ea;t.states.forEach(fa=>{var sa;if(null===(sa=fa.name)||void 0===sa?0:sa.match("id:"+W.chainTo))ea=fa.uuid});ea&&ScriptingHelpers.implicationFromScript(t.uuid,E.uuid,StatementTrigger.PHYSIC_DROP,
ea,StatementTrigger.STATE);let T;t.states.forEach(fa=>{var sa;if(null===(sa=fa.name)||void 0===sa?0:sa.match("id:"+W.fallbackTo))T=fa.uuid});T&&ScriptingHelpers.implicationFromScript(t.uuid,E.uuid,StatementTrigger.PHYSIC_DROP_FAIL,T,StatementTrigger.STATE)}}}}})(SimulationDataStartup||={});
class GeomScriptData extends AbstractScriptParser{constructor(){super(...arguments);this.onlyForMobile=this.simplify=this.merge=!1;this.simplifyCount=.8}static getFromName(a){return this.loopOnKeys(this.extractBaseCode(a,"geom"),new GeomScriptData)}parseVal(a,e){"merge"==a?this.merge=!0:"mobile"==a?this.simplify=(this.onlyForMobile=!0,!Device.isMobile()):"simplify"==a&&(e&&(this.simplifyCount=parseFloat(e)/100),this.simplify=this.onlyForMobile?!Device.isMobile():!0)}}
class AssetsStore{constructor(){this.sceneTexture=new PersistentDictionary;this.modelElements=new PersistentDictionary;this.assetElements=new PersistentDictionary;this.audioElements=new PersistentDictionary;this.animations=new PersistentDictionary;this.fonts=[];this.fonts.push("Arial");this.fonts.push("Arial Black");this.fonts.push("Comic Sans MS");this.fonts.push("Courier New");this.fonts.push("Georgia");this.fonts.push("Impact");this.fonts.push("Verdana")}emptyTextures(){this.sceneTexture.empty();
this.modelElements.empty();this.assetElements.empty();this.animations.empty()}getModel(a){var e=this.modelElements.get(a);if(!e)return null;if(e.taken){e=e.object.clone();let h;(h=Config.currentScene.meshCloneData[a])&&h.needsCloning&&e.traverse(m=>{m.material&&(m.material=m.material.clone())});return e}e.taken=!0;return e.object}}var LoadableElementType;
(function(a){a.TEXTURE="TEXTURE";a.TEXTURE360="TEXTURE360";a.MODEL="MODEL";a.AUDIO="AUDIO";a.VIDEO="VIDEO";a.VIDEO360="VIDEO360"})(LoadableElementType||={});
class LoadableElement{constructor(a,e,h){this.type=a;this.mediaUUID=e.uuid;this.path=e.mediaFolder+e.paths[0];this.fullPath=PathUtils.fullPath(e);this.persistent=e.persistent;h?this.options=h:a==LoadableElementType.MODEL&&(this.options={renderMode:GLTFRenderMode.PBR,merge:!1,simplify:!1,simplifyCount:.8})}loaded(a){let e;switch(this.type){case LoadableElementType.TEXTURE360:e=Config.assets.sceneTexture;break;case LoadableElementType.TEXTURE:e=Config.assets.assetElements;break;case LoadableElementType.MODEL:e=
Config.assets.modelElements;break;case LoadableElementType.AUDIO:e=Config.assets.audioElements}e.add(this.mediaUUID,a,this.persistent)}}
class SimulationLoader extends Notifiable{constructor(){super();if(null!=SimulationLoader._inst)throw Error("SimulationLoader is a singleton");Config.assets=new AssetsStore;this._imageLoader=new THREE.ImageLoader;this._imageLoader.setCrossOrigin("Anonymous");this._basisLoader=new BasisTextureLoader(THREE.DefaultLoadingManager);this._basisLoader.transcoderPath="static/js/basis/";DRACOLoader.setDecoderPath("static/js/draco/");DRACOLoader.setDecoderConfig({type:"js"});this._dracoLoader=new DRACOLoader(null);
this.toLoadSeries=new Queue;this.toLoadParallel=new Queue;this.parallelItemsLoaded=0;LoadProgressManager.inst;Notifier.subscribe(this,SceneCommand.MEDIA_TAGS_RESET);Notifier.subscribe(this,InitCommand.DATA_LOADED)}static get inst(){return this._inst||(this._inst=new SimulationLoader)}notify(a,e){switch(a){case SceneCommand.MEDIA_TAGS_RESET:this.loadNextMedia();break;case InitCommand.DATA_LOADED:this._loadFonts()}}set currentScene(a){this._currentScene&&(this._currentScene.uuid==a.uuid?console.warn("Current scene did not change"):
this._currentScene.visited=!0);this._currentScene=a;Config.currentScene=a}loadSimulationData(a){const e=/\.sphere$/.test(a);let h=new XMLHttpRequest;h.open("GET",a,!0);e?h.responseType="arraybuffer":h.overrideMimeType("application/json");let m;h.onreadystatechange=()=>{h.response&&(m=e?h.response.byteLength:h.response.length);if(4==h.readyState&&(200==h.status||0==h.status)&&0<m){try{var t=new Uint8Array(h.response);let y=pako.inflate(t,{to:"string"}),C=JSON.parse(y);Config.simulationData=new SimulationData;
Config.simulationData.fromObject(C);SimulationDataStartup.parseScriptData(Config.simulationData.scenes)}catch(y){console.error(y),alert(Localisation.inst.PROJECT_ERROR+"\n"+y.message)}t=Config.simulationData.header;console.info("App version :",t.appVersion);this.currentScene=this.getScene(t.startSceneUUID);Config.CURRENT_FADE_DURATION=t.startFadeDuration;if(t=SceneControllerData.getFromName(Config.currentScene.name))Config.CONTROLLER_DATA=t;Notifier.unleash(InitCommand.DATA_LOADED)}};h.send()}_loadFonts(){return __awaiter(this,
void 0,void 0,function*(){let a=Object.keys(Config.simulationData.media);for(let e=0;e<a.length;e++){let h=Config.simulationData.media[a[e]];if("fonts/"==h.mediaFolder){h.family=TextUtils.fixFamilyName(h.family);const m=new FontFace(h.family,"url("+encodeURI(Config.DATA_FOLDER+"fonts/"+h.paths[0])+")",{style:h.style,weight:h.weight});yield m.load();document.fonts.add(m);document.body.classList.add("fonts-loaded");Config.assets.fonts.push(h.family);Notifier.unleash(InitCommand.FONT_LOAD_END,h.family)}}})}loadHUDAndFirstScene(){Notifier.unleash(InitCommand.HUD_LOAD_END);
this._loadExtra=Config.simulationData.header.persistentSceneUUID;this.initSceneLoad(Config.simulationData.header.startSceneUUID)}initSceneLoad(a){this.currentScene=this.getScene(a);LoadProgressManager.inst.reset();this.setLoadList();Notifier.unleash(SceneCommand.LOAD_START)}getScene(a){a||(a=Config.simulationData,a=a.multi&&a.multi.lobby&&!a.multi.bypassLobby?a.multi.lobby.uuid:Config.simulationData.header.startSceneUUID);return ArrayUtils.find(Config.simulationData.scenes,"uuid",a)}initProgress(){this.toLoadSeries.reset();
this.toLoadParallel.reset();this.parallelItemsLoaded=0;this.toLoadIndexedPath={}}finishProgress(){if(this.parallelItemsLoaded!=this.toLoadParallel.length)return setTimeout(()=>this.finishProgress(),100);let a=this._loadExtra;this.toLoadIndexedPath={};this.toLoadSeries.empty();this.toLoadParallel.empty();this.parallelItemsLoaded=0;this._loadExtra="";Notifier.unleash(SceneCommand.LOAD_END,a)}mustLoadPath(a){let e;return a&&a.paths&&(e=a.paths[0])&&!this.toLoadIndexedPath[e]?(this.toLoadIndexedPath[e]=
!0,e):""}setLoadList(){this.initProgress();Config.assets.emptyTextures();if(this._loadExtra){let a=ArrayUtils.find(Config.simulationData.scenes,"uuid",this._loadExtra);a&&this._parseLoadList(a)}this._parseLoadList(this._currentScene);LoadProgressManager.inst.addLength(this.toLoadSeries.length+this.toLoadParallel.length)}_parseLoadList(a){if(a.media){let e=Config.simulationData.media[a.media],h;(h=this.mustLoadPath(e))&&!PathUtils.stringIsVideo(h)&&this.toLoadParallel.push(new LoadableElement(LoadableElementType.TEXTURE360,
e))}a.elements.length&&GroupDataUtils.forEachElementsWithAspectsRecursive(a.elements,e=>{e.aspects.forEach(h=>{let m=Config.simulationData.media[h.media];if(this.mustLoadPath(m)){var t=this.toLoadParallel;switch(e.type){case StatefulElementType.MESH:var y=LoadableElementType.MODEL;Config.has3DModels=!0;EffectsManager.inst.setupBackgroundRenderTarget();if(!AbstractScriptParser.isScript(h.name))break;var C={};let I=GeomScriptData.getFromName(h.name);I&&(C.merge=I.merge,C.simplify=I.simplify,C.simplifyCount=
I.simplifyCount);if(h=ShaderScriptData.getFromName(h.name))C.renderMode=h.renderMode;I||h||(C=null);break;case StatefulElementType.SPRITE:case StatefulElementType.TEXT:case StatefulElementType.SPRITESHEET:y=LoadableElementType.TEXTURE;break;case StatefulElementType.SOUND:y=LoadableElementType.AUDIO}y&&t.push(new LoadableElement(y,m,C))}})})}loadNextMedia(){let a;if(a=this.toLoadParallel.current)return this.toLoadParallel.move(),a.type==LoadableElementType.MODEL?this.loadModel(a,!0):a.type==LoadableElementType.AUDIO?
this.loadAudio(a,!0):this.loadTexture(a,!0),this.loadNextMedia();setTimeout(()=>{if(!(a=this.toLoadSeries.current))return this.finishProgress();this.toLoadSeries.move();a.type==LoadableElementType.MODEL?this.loadModel(a):a.type==LoadableElementType.AUDIO?this.loadAudio(a):this.loadTexture(a)},100)}loadAudio(a,e){Device.hasActiveWebAudio()?(new AudioLoader).load(a.fullPath,h=>{a.loaded(h);this.updateState(e)},h=>{this.updateState(e,h)},h=>{console.error("Load audio",a.path,"error :",h);this.updateState(e)}):
this.updateState(e)}loadModel(a,e){let h=a.path.match(/\/?([^/]+)\.\w{2,4}/i)[1];if(/gl(?:b|tf)$/i.test(a.path)){let m=new GLTFLoader(h);m.setDRACOLoader(this._dracoLoader);m.setBasisLoader(this._basisLoader);this._basisLoader.detectSupport(View3D.inst.renderer);m.load(a.fullPath,t=>{a.loaded({taken:!1,object:t.scene});t.animations&&t.animations.length&&Config.assets.animations.add(a.mediaUUID,t.animations);this.updateState(e)},t=>{this.updateState(e,t)},t=>{console.error("gLTF load error :",t);this.updateState(e)})}else{let m=
new XMLHttpRequest;m.open("GET",a.fullPath,!0);m.responseType="arraybuffer";m.onprogress=t=>{this.updateState(e,t)};m.onreadystatechange=()=>{if(4==m.readyState&&(200==m.status||0==m.status)){var t=null;try{const y=new Uint8Array(m.response);t=pako.inflate(y)}catch(y){}t=Decoder.decode(t.buffer);t=(new SPHParser(h,!0)).generate(t);t.traverse(y=>{y.material&&(y.material.isMeshStandardMaterial||y.material.isMeshPhysicalMaterial||y.material.isShaderMaterial&&void 0!==y.material.envMap)&&(y.userData.needEnvMapUpdate=
!0)});a.loaded({taken:!1,object:t});this.updateState(e)}};m.send()}}loadTexture(a,e){if(Config.basisComrpessed){let h=a.fullPath.substr(0,a.fullPath.lastIndexOf("."))+".basis";this._basisLoader.detectSupport(View3D.inst.renderer);this._basisLoader.load(h,m=>{a.loaded(m);this.updateState(e)},m=>{this.updateState(e,m)},m=>{console.error("Image load error:",m);this.updateState(e)})}else this._imageLoader.load(a.fullPath,h=>{h=new THREE.Texture(h);let m=/\.(jpg|jpeg)$/i.test(a.path);h.format=m?THREE.RGBFormat:
THREE.RGBAFormat;h.needsUpdate=!0;h.generateMipmaps=!0;h.magFilter=THREE.LinearFilter;h.minFilter=THREE.LinearMipmapLinearFilter;h.anisotropy=View3D.inst.renderer.capabilities.getMaxAnisotropy();a.loaded(h);this.updateState(e)},h=>{this.updateState(e,h)},()=>{this.updateState(e)})}updateState(a,e){if(e)return e.loaded==e.total?void 0:LoadProgressManager.inst.update(e.loaded/e.total);LoadProgressManager.inst.update(0);a?++this.parallelItemsLoaded:this.loadNextMedia()}}
class LightDescriptor{constructor(a,e,h,m,t,y){this.color=16777215;this.intensity=1;this.positionZ=this.positionY=this.positionX=0;this.isAmbient=!1;a&&(this.color=a);e&&(this.intensity=e);h&&(this.positionX=h);m&&(this.positionY=m);t&&(this.positionZ=t);y&&(this.isAmbient=y)}}
class LightPreset{constructor(a,e,h,m,t){this._id=a;this._ambient=e;this._key=h;this._fill=m;this._rim=t}get id(){return this._id}set id(a){this._id=a}get ambient(){return this._ambient}get key(){return this._key}get fill(){return this._fill}get rim(){return this._rim}static getFromId(a){switch(a){case "NONE":a=LightPreset.NONE;break;case "AMBIENT":a=LightPreset.AMBIENT;break;case "THREE_POINTS":a=LightPreset.THREE_POINTS;break;case "TWO_POINTS":a=LightPreset.TWO_POINTS;break;default:a=LightPreset.ONE_POINT}return a}}
LightPreset.NONE=new LightPreset("NONE",null,null,null,null);LightPreset.AMBIENT=new LightPreset("AMBIENT",new LightDescriptor(16777215,1,0,0,0,!0));LightPreset.ONE_POINT=new LightPreset("ONE_POINT",new LightDescriptor(16777215,0,0,0,0,!0),new LightDescriptor(16777215,.8,0,-100,-100));LightPreset.TWO_POINTS=new LightPreset("TWO_POINTS",new LightDescriptor(16777215,0,0,0,0,!0),new LightDescriptor(16777215,.8,-25,-4,25),new LightDescriptor(16777215,.5,100,0,0));
LightPreset.THREE_POINTS=new LightPreset("THREE_POINTS",new LightDescriptor(16777215,0,0,0,0,!0),new LightDescriptor(16777215,.8,-25,-4,25),new LightDescriptor(16777215,.5,100,0,0),new LightDescriptor(16777215,4,0,-1E3,-1E4));
class GLTFAnimationScriptData extends AbstractScriptParser{constructor(){super(...arguments);this.resetHard=!1}static getFromName(a){return this.loopOnKeys(this.extractBaseCode(a),new GLTFAnimationScriptData)}parseVal(a,e){if("resethard"==a||"hard"==a)this.resetHard=!0;if("re"==a||"reset"==a||"resets"==a)this.resetActions=e.split("|")}}
class GLTFAnimator{constructor(a,e,h){this._actions=new MessyDictionary;this._actionsInLoop=new MessyDictionary;this._actionsOnAir=new MessyDictionary;this._fadeDuration=.2;this._finished=t=>{let y=t.action.getClip().name;this._actionsInLoop.length&&this.manageActiveActions(!1,y);this._actionsOnAir.remove(y);this._animEnded(t.action)};this._looped=t=>{if(t=this._getRefData(t.action.getClip().name))t.iterations--,t.yoyo&&(t.reverse=!t.reverse)};this._clips=e;this._mixer=new THREE.AnimationMixer(h);
this._endCallbacks={};this._targetUuid=a;this._mixer.addEventListener("finished",this._finished);this._mixer.addEventListener("loop",this._looped);let m;this._clips.forEach(t=>{m=this._mixer.clipAction(t,null);m.clampWhenFinished=!0;this._actions.add(t.name,m)})}dispose(){this._mixer.removeEventListener("finished",this._finished);this._mixer.removeEventListener("loop",this._looped);this._mixer.stopAllAction();this._glowMixer&&(this._glowMixer.stopAllAction(),this._glowMixer=null);this._clipMixer&&
(this._clipMixer.stopAllAction(),this._clipMixer=null);this._endCallbacks=this._clips=this._mixer=null;this._actions.empty();this._actionsInLoop.empty();this._actionsOnAir.empty();this._actionsOnAir=this._actionsInLoop=this._actions=null}updateMixers(a){this._mixer.update(a);this._glowMixer&&this._glowMixer.update(a);this._clipMixer&&this._clipMixer.update(a)}addMixer(a,e){let h;"glow"==a?h=this._glowMixer=new THREE.AnimationMixer(e):"clip"==a&&(h=this._clipMixer=new THREE.AnimationMixer(e));if(h){let m;
this._clips.forEach((t,y,C)=>{m=h.clipAction(t,null);m.clampWhenFinished=!0;this._actions.add(t.name+"_"+a,m)});h=null}}_stopped(a){this._animEnded(a)}updateCinematic(a,e){let h=GLTFAnimationScriptData.getFromName(a.name);if(h&&h.resetHard)return this.resetHard(e);h&&h.resetActions&&h.resetActions.forEach(m=>{let t=this._actions.get(m);t&&(this._actionsOnAir.remove(m),t.reset())});a.targets?a.targets.forEach(m=>{let t=this._actions.get(m);t?this.updateAction(t,a,e):(t=this._actions.get(m+"_clip"))?
this.updateAction(t,a):(t=this._actions.get(m+"_glow"))&&this.updateAction(t,a)}):this._actions.traverse(m=>{this.updateAction(m,a,e)})}resetHard(a){this._actionsOnAir.empty();this._actions.traverse(h=>{h.stop();h.reset()});this._actions.empty();let e;this._clips.forEach(h=>{e=this._mixer.clipAction(h,null);e.clampWhenFinished=!0;this._actions.add(h.name,e)});a&&a()}updateAction(a,e,h){h&&(this._endCallbacks[e.uuid]=h);var m=a.getClip();h=m.name;this._actionsInLoop.remove(h);this._actionsOnAir.remove(h);
switch(e.kind){case StatePlaybackType.STOP:a.play();a.paused=!0;a.time=m.duration;this._stopped(a);return;case StatePlaybackType.RESET:delete AnimEffectRefHolder.inst.getRef(this._targetUuid).gltfAnims[h];this._endCallbacks[e.uuid]=null;a.stop();return;case StatePlaybackType.PAUSE:a.paused=!0;this._getRefData(h).time=a.time;return}a.animUuid&&e.uuid!=a.animUuid&&this._stopped(a);let t=(m=this._isInProgress(a,m))?a.time:0;var y=this._getRefData(h);let C=(null===y||void 0===y?0:y.iterations)?y.iterations:
1;y=y?y.reverse:e.reverse;0>=C&&(C=1);m&&y&&--C;a.animUuid=e.uuid;a.reset();a.time=t;a.setLoop(e.yoyo?THREE.LoopPingPong:THREE.LoopRepeat,C);a.setEffectiveTimeScale(y?-e.speed:e.speed);a.play();this._actionsInLoop.length&&this.manageActiveActions(!0,h);Infinity==e.iterations?this._actionsInLoop.add(h,a):this._actionsOnAir.add(h,a)}_isInProgress(a,e){return a.time&&a.time!=e.duration}_getRefData(a){let e=AnimEffectRefHolder.inst.getRef(this._targetUuid);return e&&e.gltfAnims?e.gltfAnims[a]:null}_animEnded(a){let e=
a.animUuid;a.animUuid="";e&&this._endCallbacks[e]&&(this._endCallbacks[e](),delete this._endCallbacks[e])}manageActiveActions(a,e){a?(this._actionsInLoop.traverse(h=>{h.getClip().name==e&&h.fadeOut(this._fadeDuration)}),this._actionsOnAir.traverse(h=>{h.getClip().name==e&&h.fadeOut(this._fadeDuration)})):this._actionsInLoop.traverse(h=>{if(h.getClip().name==e){var m=this._isInProgress(h,h.getClip())?h.time:0;h.reset();h.repetitions=Infinity;h.time=m;h.play();h.fadeIn(this._fadeDuration)}})}}
class ClippingScriptData extends AbstractScriptParser{constructor(){super(...arguments);this.clip=!1;this.clipPlanes=[];this.clipNormals=[];this.clipEuler=[];this.clipDistances=[];this.clipColor=new THREE.Color(3355443)}static getFromName(a,e="ZYX"){var h=this.extractBaseCode(a);if(!h)return null;h=this.loopOnKeys(h,new ClippingScriptData);if(!h.clip)return null;a=this.extractBaseCode(a,"planes");if(!a)return h;a=a.split("|");let m;for(let I=0;I<a.length;++I)if((m=a[I].split(" "))&&2<=m.length){var t=
THREE.MathUtils.degToRad(parseFloat(m[0]));var y=THREE.MathUtils.degToRad(parseFloat(m[1]));var C=THREE.MathUtils.degToRad(parseFloat(m[2]?m[2]:"0"));t=new THREE.Euler(t,y,C,e);y=(new THREE.Vector3(1,0,0)).applyQuaternion((new THREE.Quaternion).setFromEuler(t));C=new THREE.Vector3;m[3]&&(C.x=parseFloat(m[3]));m[4]&&(C.y=parseFloat(m[4]));m[5]&&(C.z=parseFloat(m[5]));h.clipPlanes.push(new THREE.Plane(y,0));h.clipDistances.push(C);h.clipNormals.push(y);h.clipEuler.push(t)}return h}parseVal(a,e){"clip"==
a?this.clip=!0:"clipcolor"==a&&(this.clipColor=new THREE.Color(e))}}
class GlowEffectScriptData extends AbstractScriptParser{constructor(){super(...arguments);this.glow=!1;this.color=new THREE.Color(16777215);this.direction=1;this.size=1E-4;this.power=1.2;this.alpha=.98;this.ontop=!1}static getFromName(a){return(a=this.loopOnKeys(this.extractBaseCode(a,"glow"),new GlowEffectScriptData))&&a.glow?a:null}parseVal(a,e){this.glow=!0;"color"==a?this.color=new THREE.Color(e):"direction"==a?this.direction=parseFloat(e):"size"==a?this.size=1E-4*parseFloat(e):"power"==a?this.power=
parseFloat(e):"alpha"==a?this.alpha=parseFloat(e):"ontop"==a&&(this.ontop=!0)}}
class GlowShader{constructor(a){this.material=new THREE.ShaderMaterial({uniforms:{glowpower:{type:"f",value:a.power},glowdirection:{type:"f",value:a.direction},glowcolor:{type:"c",value:a.color},glowsize:{type:"f",value:a.size},glowalpha:{type:"f",value:a.alpha}},vertexShader:"                        uniform float glowsize;\n                        varying vec3 vVertexWorldPosition;\n                        varying vec3 vVertexNormal;\n                        vec3 localNormal;\n                        void main()\n                        {\n                            vec3 vNormal = normalize( normalMatrix * normal );\n                            vec3 vNormel = normalize( normalMatrix * cameraPosition );\n                            \n                            vVertexNormal = normalize( normalMatrix * normal );\n                            localNormal = normalize( normal );\n                            \n                            vVertexWorldPosition = (modelMatrix * vec4(position, 1.0)).xyz;\n                            vec3 newPosition = position + (localNormal * glowsize);\n                            gl_Position = projectionMatrix * modelViewMatrix * vec4( newPosition, 1.0 );\n                        }\n                        ",fragmentShader:"                        uniform vec3 glowcolor;\n                        uniform float glowdirection;\n                        uniform float glowpower;\n                        uniform float glowalpha;\n                        varying vec3 vVertexWorldPosition;\n                        varying vec3 vVertexNormal;\n                        void main()\n                        {\n                            vec3 worldCameraToVertex = vVertexWorldPosition - cameraPosition;\n                            vec3 viewCameraToVertex\t= (viewMatrix * vec4(worldCameraToVertex, 0.0)).xyz;\n                            viewCameraToVertex= normalize(viewCameraToVertex);\n                            float intensity = pow(glowdirection + dot(vVertexNormal, viewCameraToVertex), glowpower);\n                            float finalAlpha = intensity;\n                            if( (finalAlpha * glowalpha) <= 0.0) {\n                                discard;\n                            }\n                            gl_FragColor = vec4( glowcolor, finalAlpha * glowalpha );\n                        }\n                        ",
side:THREE.FrontSide,transparent:!0,depthWrite:!1,blending:THREE.AdditiveBlending,depthTest:!a.ontop})}}
class AbstractAnimation{constructor(a,e){this.parent=e;this.data=a;this.uuid=a.uuid;this.parentUuid=e.uuid;this.isBeingSetToDefault=this.playing=this.completed=!1;if(this.targetIsElement="element"==a.target||a.target==e.uuid)this.targetUuid=e.uuid,this.targetRef=e.container;else if(UUID.test(a.target)){if(!e.aspects.has(a.target)){this.focusOnCurrentAspect=!0;console.warn("Invalid animation data on element "+e.data.name+": target could not be found");return}this.targetUuid=a.target;this.targetRef=
e.aspects.get(a.target).container}this.refData=AnimEffectRefHolder.inst.getRef(this.targetUuid);this.focusOnCurrentAspect=!this.targetRef}dispose(){this.refData=this.parent=this.targetRef=this.data=null}onComplete(){if(!this.completed&&(this.completed=!0,this.playing=!1,this._updatePhysics(!1,!0),!this.isBeingSetToDefault)){this.isBeingSetToDefault=!1;var a=ElementsRefHolder.inst.getRef(this.parentUuid);a.animEnd=this.uuid;ImplicationUtils.triggerFullRun(StatementTrigger.ANIM_END,Config.simulationData.implications[this.parentUuid]);
a.animEnd=""}}stateChangeCancelled(){ElementsRefHolder.inst.getRef(this.parentUuid).animChangeCancelled(this.uuid)}setCurrentTarget(a){this.focusOnCurrentAspect&&(this.targetRef=a.container,this.targetUuid=a.uuid)}setPlayback(a,e){if(this.targetUuid&&a)switch(this.data.kind=a,this.isBeingSetToDefault=e||!1,a){case StatePlaybackType.PLAY:case StatePlaybackType.PLAY_LOOP:this.run(e);break;case StatePlaybackType.PAUSE:this.pause();break;case StatePlaybackType.STOP:this.stop();break;case StatePlaybackType.RESET:this.reset()}}_setRefData(){this.refData=
null;(this.refData=AnimEffectRefHolder.inst.getRef(this.targetUuid))||(this.refData=AnimEffectRefHolder.inst.add(this.targetUuid))}_updatePhysics(a,e){if(Config.HAS_PHYSICS){this.targetRef.updateMatrixWorld();var h=new PhysicParameter,m=this.targetIsElement?this.parent.currentAspectContainer:this.targetRef;e&&(h.position=m.getWorldPosition(new THREE.Vector3),h.quaternion=m.getWorldQuaternion(new THREE.Quaternion));h.carried=a;View3D.inst.engine.setupPosition(m,h)}}}
class StatefulTweensManager extends Notifiable{constructor(){super();this.rotations=new MessyDictionary;this.translations=new MessyDictionary;this.scales=new MessyDictionary;this.alphas=new MessyDictionary;this.glows=new MessyDictionary;if(StatefulTweensManager._inst)throw Error("This is a singleton");Notifier.subscribe(this,SceneCommand.LOAD_START)}static get inst(){return this._inst||(this._inst=new StatefulTweensManager)}notify(a,e){SceneCommand.LOAD_START==a&&this.stopAndRemoveAll()}stopAndRemoveAll(){this.rotations.empty();
this.translations.empty();this.scales.empty();this.alphas.empty();this.glows.empty()}removeAll(a){this.removeRotation(a);this.removeTranslation(a);this.removeScale(a);this.removeAlpha(a);this.removeGlow(a)}pauseAll(a){let e={};e.rotation=this.pauseRotation(a);e.position=this.pauseTranslation(a);e.scale=this.pauseScale(a);e.alpha=this.pauseAlpha(a);e.glow=this.pauseGlow(a);return e}_add(a,e,h){this._remove(a,e);e.add(a,h)}_pause(a,e){var h;return null===(h=e.get(a))||void 0===h?void 0:h.pause()}_remove(a,
e){var h;null===(h=e.get(a))||void 0===h?void 0:h.stop();e.remove(a)}addRotation(a,e){this._add(a,this.rotations,e)}pauseRotation(a){return this._pause(a,this.rotations)}removeRotation(a){this._remove(a,this.rotations)}addTranslation(a,e){this._add(a,this.translations,e)}pauseTranslation(a){return this._pause(a,this.translations)}removeTranslation(a){this._remove(a,this.translations)}addScale(a,e){this._add(a,this.scales,e)}pauseScale(a){return this._pause(a,this.scales)}removeScale(a){this._remove(a,
this.scales)}addAlpha(a,e){this._add(a,this.alphas,e)}pauseAlpha(a){return this._pause(a,this.alphas)}removeAlpha(a){this._remove(a,this.alphas)}addGlow(a,e){this._add(a,this.glows,e)}pauseGlow(a){return this._pause(a,this.glows)}removeGlow(a){this._remove(a,this.glows)}}
class LiveElementsRefHolder extends RefHolder{constructor(){super();this.uuid=THREE.MathUtils.generateUUID();this._persistentElements={};Notifier.subscribe(this,SceneCommand.LOAD_START);Notifier.subscribe(this,StatefulCommand.STATEFUL_ELEMENT_CHANGE);Notifier.subscribe(this,StatefulCommand.VARIABLE_CHANGED)}static get inst(){return this._inst||(this._inst=new LiveElementsRefHolder)}notify(a,e){var h;if(a==SceneCommand.LOAD_START)return this.disposeAndEmpty();for(let m in e)null===(h=this._elementsRef[m]||
this._persistentElements[m])||void 0===h?void 0:h.trigger(e),ImplicationUtils.triggerFullRun(StatementTrigger.NONE,Config.simulationData.implications[m])}add(a,e){e?this._persistentElements[a.uuid]=a:this._elementsRef[a.uuid]=a}getRef(a){return super.getRef(a)||this._persistentElements[a]}disposeAndEmpty(){this.forEach(a=>{a.dispose()});this._elementsRef={}}searchFor(a){let e=null,h=this._elementsRef[a]||this._persistentElements[a];if(h)return h.container;this.forEach(m=>{if(h=m.aspects.get(a))return e=
h.container},!0);if(e)return e;for(let m in this._persistentElements)if(h=this._persistentElements[m].aspects.get(a))return h.container}}
class SphereAnimation extends AbstractAnimation{constructor(a,e){a.hasGlowValues&&e.type!=StatefulElementType.MESH&&(a.hasGlowValues=!1,console.warn('Scripting error: Incorrect glow target "'+e.data.name+'"'));super(a,e);this.reachedDestination=!1;this.pausedTweens={};this.startingCoordinates={};Notifier.subscribe(this,StatefulCommand.ANIM_STARTED);Interpolation.LINEAR==a.interpolation?this.ease=TWEEN.Easing.Linear.None:Interpolation.EASE_IN==a.interpolation?this.ease=TWEEN.Easing.Quadratic.In:Interpolation.EASE_OUT==
a.interpolation?this.ease=TWEEN.Easing.Quadratic.Out:Interpolation.EASE_IN_OUT==a.interpolation&&(this.ease=TWEEN.Easing.Quadratic.InOut);a.destinationUuid&&Notifier.subscribe(this,SceneCommand.GENERATION_FINISHED)}notify(a,e){a==StatefulCommand.ANIM_STARTED&&e.parent==this.parentUuid?(this.reachedDestination=!1,this.pausedTweens={},e.anim==this.uuid||this.completed||(a=ElementsRefHolder.inst.getRef(this.parentUuid),a.animPlaybackStates[this.uuid]!=StatePlaybackType.RESET&&(a.animPlaybackStates[this.uuid]=
StatePlaybackType.STOP),this.playing=!1)):a==SceneCommand.GENERATION_FINISHED&&(Notifier.unsubscribe(this,a),this.destCoordSource=this.data.destinationElementType==DestinationElementType.CAMERA?View3D.inst.camera:LiveElementsRefHolder.inst.searchFor(this.data.destinationUuid))}dispose(){this.startingCoordinates=this.destCoordSource=this.pausedTweens=this.ease=null;this.timeoutId&&(window.clearTimeout(this.timeoutId),this.timeoutId=0);this.playing&&StatefulTweensManager.inst.removeAll(this.targetUuid);
Notifier.unsubscribe(this,StatefulCommand.ANIM_STARTED);super.dispose()}onComplete(){this.completed||(this.pausedTweens={},super.onComplete(),this.data&&!this.data.isRelative&&(this.reachedDestination=!0))}updateStartCoord(){this.startingCoordinates.position&&(this.startingCoordinates.position=this.targetRef.position.clone());this.startingCoordinates.rotation&&(this.startingCoordinates.rotation=this.targetRef.rotation.clone());this.startingCoordinates.scale&&(this.startingCoordinates.scale=this.targetRef.scale.clone());
this.startingCoordinates.quaternion&&(this.startingCoordinates.quaternion=this.targetRef.quaternion.clone())}run(a){if(this.playing)return this.stateChangeCancelled();this.reachedDestination&&this.reset();this._setRefData();this.completed=!1;this.data.loop||this.data.time&&!this.data.isImmediate&&!a?this.setTweens():this.applyImmediately(!0);Notifier.unleash(StatefulCommand.ANIM_STARTED,{parent:this.parentUuid,anim:this.uuid})}pause(){if(this.completed||!this.playing||!this.data.time||this.data.isImmediate)return this.stateChangeCancelled();
this.playing=!1;this.pausedTweens=StatefulTweensManager.inst.pauseAll(this.targetUuid)}stop(){if(this.reachedDestination)return this.stateChangeCancelled();this.refData||this._setRefData();this.completed||this.applyImmediately(!1);this.onComplete()}reset(){if(!Object.keys(this.startingCoordinates).length)return this.stateChangeCancelled();StatefulTweensManager.inst.removeAll(this.targetUuid);this.revert3DData(this.targetRef.position,this.startingCoordinates.position);this.revert3DData(this.targetRef.rotation,
this.startingCoordinates.rotation);this.revert3DData(this.targetRef.quaternion,this.startingCoordinates.quaternion);this.revert3DData(this.targetRef.scale,this.startingCoordinates.scale);this.revertOpacity();this.revertColor();this.playing=this.completed=this.reachedDestination=!1;this.pausedTweens={};this.startingCoordinates={};this.data.hasGlowValues||this.targetRef.updateMatrixWorld(!0)}applyImmediately(a){StatefulTweensManager.inst.removeAll(this.targetUuid);this.immediateRotation();this.immediateLookAt();
this.immediateTranslation();this.immediateScale();this.immediateOpacity();this.immediateGlow();this.data.hasGlowValues||this.targetRef.updateMatrixWorld(!0);if(a)if(this.data.time)this.timeoutId=window.setTimeout(()=>{this.timeoutId=0;this.onComplete()},this.data.time);else this.onComplete()}setTweens(){this.playing=!0;this.tweenRotation();this.tweenLookAt();this.tweenTranslation();this.tweenScale();this.tweenOpacity();this.tweenGlow()}immediateRotation(){this.data.hasRotationValues&&(this.startingCoordinates.rotation||
(this.startingCoordinates.rotation=this.targetRef.rotation.clone()),AnimFactory.apply3DData(this.data.rotation,this.targetRef.rotation),this.refData.rotation=this.targetRef.rotation)}immediateTranslation(){if(this.data.hasPositionValues){this.startingCoordinates.position||(this.startingCoordinates.position=this.targetRef.position.clone());var a=this.destCoordSource?this._extractPositionFromDestination():this.data.position;AnimFactory.apply3DData(a,this.targetRef.position);this.refData.position=this.targetRef.position}}immediateScale(){this.data.hasScaleValues&&
(this.startingCoordinates.scale||(this.startingCoordinates.scale=this.targetRef.scale.clone()),AnimFactory.apply3DData(this.data.scale,this.targetRef.scale),this.refData.scale=this.targetRef.scale)}immediateLookAt(){if(this.data.hasLookAtValues){this.startingCoordinates.quaternion||(this.startingCoordinates.quaternion=this.targetRef.quaternion.clone());var a=this.destCoordSource?this._extractPositionFromDestination():this.data.copyLookAt();this.targetRef.lookAt(a.x,a.y,a.z);this.refData.quaternion=
this.targetRef.quaternion}}immediateOpacity(){this.data.hasOpacityValue&&("undefined"==typeof this.startingCoordinates.opacity&&(this.startingCoordinates.opacity=this.targetIsElement?this.parent.data.opacity:this.parent.aspects.get(this.targetUuid).data.opacity),this._setOpacity(this.data.opacity))}immediateGlow(){if(this.data.hasGlowValues){var a=this.data.copyColor(),e=this.parent.aspects.get(this.targetUuid);this.startingCoordinates.color||(this.startingCoordinates.color={r:e.currentEffectColor.r,
g:e.currentEffectColor.g,b:e.currentEffectColor.b,a:e.currentEffectAlpha});this._setColor(a,e)}}revert3DData(a,e){e&&a.copy(e)}revertOpacity(){"undefined"!=typeof this.startingCoordinates.opacity&&this._setOpacity(this.startingCoordinates.opacity)}revertColor(){this.startingCoordinates.color&&this._setColor(this.startingCoordinates.color,this.parent.aspects.get(this.targetUuid))}tweenRotation(){this.data.hasRotationValues&&(this.pausedTweens.rotation?this.pausedTweens.rotation.resume():(this.startingCoordinates.rotation||
(this.startingCoordinates.rotation=this.targetRef.rotation.clone()),StatefulTweensManager.inst.addRotation(this.targetUuid,this.tween3DProperty(this.data.copyRotation(),this.targetRef.rotation,"rotation"))))}tweenScale(){this.data.hasScaleValues&&(this.pausedTweens.scale?this.pausedTweens.scale.resume():(this.startingCoordinates.scale||(this.startingCoordinates.scale=this.targetRef.scale.clone()),StatefulTweensManager.inst.addScale(this.targetUuid,this.tween3DProperty(this.data.copyScale(),this.targetRef.scale,
"scale"))))}tweenTranslation(){if(this.data.hasPositionValues)if(this.pausedTweens.position)this.pausedTweens.position.resume();else{this.startingCoordinates.position||(this.startingCoordinates.position=this.targetRef.position.clone());var a=this.destCoordSource?this._extractPositionFromDestination():this.data.copyPosition();StatefulTweensManager.inst.addTranslation(this.targetUuid,this.tween3DProperty(a,this.targetRef.position,"position"))}}tweenOpacity(){if(this.data.hasOpacityValue)if(this.pausedTweens.alpha)this.pausedTweens.alpha.resume();
else{var a=this.targetIsElement?this.parent.data:this.parent.aspects.get(this.targetUuid).data;"undefined"==typeof this.startingCoordinates.opacity&&(this.startingCoordinates.opacity=a.opacity);StatefulTweensManager.inst.addAlpha(this.targetUuid,AnimFactory.baseTween(a,{opacity:this.data.opacity},this).onUpdate(this._opacityUpdateWrapper()))}}tweenLookAt(){if(this.data.hasLookAtValues)if(this.pausedTweens.rotation)this.pausedTweens.rotation.resume();else{var a=this.data.destinationAnimType==DestinationAnimType.GOTO,
e=this.destCoordSource?this._extractPositionFromDestination(a?View3D.inst.camera:null):this.data.copyLookAt();a=this.targetRef;var h=a.quaternion.clone();if(this.data.hasPositionValues){var m=a.position.clone();var t=this.destCoordSource?this._extractPositionFromDestination():this.data.copyPosition();a.position.set(t.x,t.y,t.z)}a.lookAt(e.x,e.y,e.z);a.updateMatrixWorld(!0);e=a.quaternion.clone();this.data.hasPositionValues&&a.position.copy(m);a.quaternion.copy(h);a.updateMatrixWorld(!0);this.startingCoordinates.quaternion||
(this.startingCoordinates.quaternion=h);(this.data.hasPositionValues||this.data.hasScaleValues)&&1E-4>h.angleTo(e)||StatefulTweensManager.inst.addRotation(this.targetUuid,this.tween3DProperty(e,a.quaternion,"quaternion"))}}tweenGlow(){let a=this.parent.aspects.get(this.targetUuid);if(this.data.hasGlowValues&&a.effectScript)if(this.pausedTweens.glow)this.pausedTweens.glow.resume();else{var e=this.data.copyColor(),h={r:a.currentEffectColor.r,g:a.currentEffectColor.g,b:a.currentEffectColor.b,a:a.currentEffectAlpha};
this.startingCoordinates.color||(this.startingCoordinates.color=JSON.parse(JSON.stringify(h)));AnimFactory.fillGlowData(e,a);StatefulTweensManager.inst.addGlow(this.targetUuid,AnimFactory.baseTween(h,e,this).onUpdate(m=>{a.applyColor(m);this.refData.color=m}))}}tween3DProperty(a,e,h){AnimFactory.fill3DData(a,e);let m={x:e.x,y:e.y,z:e.z},t={x:a.x,y:a.y,z:a.z},y="position"==h;"undefined"!=typeof e.w&&(m.w=e.w,t.w=a.w);return AnimFactory.baseTween(m,t,this).onUpdate(C=>{e.set(C.x,C.y,C.z,C.w);this.refData&&
(this.refData[h]=C);this._updatePhysics(!0,y)})}_setOpacity(a){this.targetIsElement?this.parent.aspects.traverse(e=>{e.elementOpacityChange(a)}):this.parent.aspects.get(this.targetUuid).aspectOpacityChange(a);this.refData.alpha=a}_setColor(a,e){AnimFactory.fillGlowData(a,e);e.applyColor(a);this.refData.color=a}_opacityUpdateWrapper(){return this.targetIsElement?a=>{this.parent.aspects.traverse(e=>{e.elementOpacityChange(a.opacity)});this.refData.alpha=a.opacity}:a=>{this.parent.aspects.get(this.targetUuid).aspectOpacityChange(a.opacity);
this.refData.alpha=a.opacity}}_extractPositionFromDestination(a){let e=new THREE.Vector3,h=new THREE.Quaternion,m=new THREE.Vector3;a=a||this.destCoordSource;if(this.data.destinationElementType==DestinationElementType.ASPECT)if(a=AnimFactory.localToWorld(a.parent.matrix,a.matrix),this.targetIsElement)a.decompose(e,h,m);else{a=AnimFactory.worldToLocal(this.targetRef.parent.matrix,a);var t=this.targetRef.matrix.clone();t.copyPosition(a);t.decompose(e,h,m)}else this.targetIsElement?e=a.position:(a=AnimFactory.worldToLocal(this.targetRef.parent.matrix,
a.matrix),t=this.targetRef.matrix.clone(),t.copyPosition(a),t.decompose(e,h,m));return e}}
class GLTFAnimation extends AbstractAnimation{constructor(a,e){var h;super(a,e);this.started=!1;if(this.refData){a=0;for(e=0;e<this.data.targets.length;++e)(null===(h=this.refData.gltfAnims[this.data.targets[e]])||void 0===h?void 0:h.kind)==StatePlaybackType.STOP&&++a;this.data.targets.length==a&&(this.completed=!0)}}run(){if(this.playing)return this.stateChangeCancelled();this.completed&&this.reset();this.completed=!1;this.started=this.playing=!0;this._setRefData();this.parent.aspects.get(this.targetUuid).updateAnimation(this.data,
()=>this.onComplete())}pause(){if(this.completed||!this.playing||!this.started)return this.stateChangeCancelled();this.playing=!1;this.parent.aspects.get(this.targetUuid).updateAnimation(this.data)}stop(){this.completed||this.parent.aspects.get(this.targetUuid).updateAnimation(this.data);this.onComplete()}reset(){if(!this.started)return this.stateChangeCancelled();this.started=this.playing||!this.completed;this.completed=!1;this.parent.aspects.get(this.targetUuid).updateAnimation(this.data)}onComplete(){if(!this.completed&&
(super.onComplete(),this.data))for(let a=0;a<this.data.targets.length;++a){let e=this.refData.gltfAnims[this.data.targets[a]];e&&(e.kind=StatePlaybackType.STOP,e.time=0,e.iterations=0)}}_setRefData(){var a;super._setRefData();for(let e=0;e<this.data.targets.length;++e)(null===(a=this.refData.gltfAnims[this.data.targets[e]])||void 0===a?void 0:a.uuid)!=this.uuid&&(this.refData.gltfAnims[this.data.targets[e]]={uuid:this.uuid,kind:this.data.kind,reverse:this.data.reverse,speed:this.data.speed,iterations:this.data.iterations,
yoyo:this.data.yoyo})}}
class AnimFactory{static create(a,e){switch(a.type){case AnimType.SPHERE:return new SphereAnimation(a,e);case AnimType.GLTF:return new GLTFAnimation(a,e)}}static fill3DData(a,e){a.x=null!=a.x?a.x:e.x;a.y=null!=a.y?a.y:e.y;a.z=null!=a.z?a.z:e.z}static fillGlowData(a,e){a.r=null!=a.r?a.r:e.currentEffectColor.r;a.g=null!=a.g?a.g:e.currentEffectColor.g;a.b=null!=a.b?a.b:e.currentEffectColor.b;a.a=null!=a.a?a.a:e.currentEffectAlpha}static apply3DData(a,e){e.x=AnimFactory.relativeToAbsolute(a.x,e.x);e.y=
AnimFactory.relativeToAbsolute(a.y,e.y);e.z=AnimFactory.relativeToAbsolute(a.z,e.z)}static relativeToAbsolute(a,e){return null!=a?"string"==typeof a?e+parseFloat(a):a:e}static localToWorld(a,e){let h=new THREE.Matrix4;h.copy(a);return h.multiply(e)}static worldToLocal(a,e){return(new THREE.Matrix4).copy(a).invert().multiply(e)}static baseTween(a,e,h){let m=h.data.yoyo&&h.data.isRelative,t=(new TWEEN.Tween(a)).easing(h.ease).repeat(m?0:h.data.repeat).yoyo(h.data.yoyo&&!h.data.isRelative).to(e,h.data.time);
if(!h.data.loop&&!m)t.onComplete(()=>{h.onComplete();t.onComplete(null)});if(m){let y=h.data.repeat;t.onComplete(()=>{y--?setTimeout(()=>{t.to(this.reverseRelativeData(e),h.data.time).start()},50):(h.onComplete(),t.onComplete(null))})}return t.start()}static reverseRelativeData(a){for(let e in a){let h=a[e];if("string"!=typeof h||"-"!=h[0]&&"+"!=h[0])continue;let m=h.split("");m[0]="-"==h[0]?"+":"-";a[e]=m.join("")}return a}}
class GLTFCellShadingExtension{constructor(){this.name=GLTFUtils.GLTF_EXTENSION.GLTF_MATERIALS_CELL_SHADING;this._params="color map lightMap lightMapIntensity aoMap aoMapIntensity emissive emissiveIntensity emissiveMap bumpMap bumpScale normalMap displacementMap displacementScale displacementBias alphaMap envMap envMapIntensity refractionRatio".split(" ")}getMaterialType(a){return THREE.MeshToonMaterial}extendParams(a,e,h){let m=[],t=e.pbrMetallicRoughness||{};a.color=new THREE.Color(1,1,1);a.opacity=
1;a.alphaMode=e.alphaMode;Array.isArray(t.baseColorFactor)&&(e=t.baseColorFactor,a.color.fromArray(e),a.opacity=e[3]);void 0!==t.baseColorTexture&&m.push(h.assignTexture(a,"map",t.baseColorTexture));a.emissive=new THREE.Color(0,0,0);return Promise.all(m)}static cloneFromMaterial(a,e){let h;h=new THREE.MeshToonMaterial({opacity:a.opacity,transparent:a.transparent});h.color=a.color;h.map=a.map;h.bumpMap=a.map;h.bumpScale=1;h.envMap=e?a.envMap:null;h.envMapIntensity=1;h.refractionRatio=.98;return h}createMaterial(a){let e;
e=new THREE.MeshToonMaterial({opacity:a.opacity,transparent:a.transparent});e.extensions={shaderTextureLOD:!0,derivatives:!0};e.isGLTFRoughnessMetalnessMaterial=!0;e.color=a.color;e.map=void 0===a.map?null:a.map;e.lightMap=null;e.lightMapIntensity=1;e.aoMap=void 0===a.aoMap?null:a.aoMap;e.aoMapIntensity=1;e.emissive=a.emissive;e.emissiveIntensity=1;e.emissiveMap=void 0===a.emissiveMap?null:a.emissiveMap;e.bumpMap=void 0===a.bumpMap?null:a.bumpMap;e.bumpScale=1;e.normalMap=void 0===a.normalMap?null:
a.normalMap;a.normalScale&&(e.normalScale=a.normalScale);e.displacementMap=null;e.displacementScale=1;e.displacementBias=0;e.alphaMap=null;e.envMap=void 0===a.envMap?null:a.envMap;e.envMapIntensity=1;e.refractionRatio=.98;return e}cloneMaterial(a){let e=a.clone();e.isGLTFRoughnessMetalnessMaterial=!0;let h=this._params;for(let m=0,t=h.length;m<t;m++)e[h[m]]=a[h[m]];return e}}
class ClipShader{constructor(a){this.material=new THREE.MeshBasicMaterial({color:a.clipColor,side:THREE.BackSide});this.material.clippingPlanes=a.clipPlanes;this.material.clipIntersection=!0}}class ParallaxShaderParts{}ParallaxShaderParts.worldposReplace="#define BOX_PROJECTED_ENV_MAP\n#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n   vec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n   #ifdef BOX_PROJECTED_ENV_MAP\n       vWorldPosition = worldPosition.xyz;\n   #endif\n#endif\n";
ParallaxShaderParts.envmapPhysicalParsReplace="#if defined( USE_ENVMAP )\n#define BOX_PROJECTED_ENV_MAP\n#ifdef BOX_PROJECTED_ENV_MAP\nuniform vec3 cubeMapSize;\nuniform vec3 cubeMapPos;\nvarying vec3 vWorldPosition;\nvec3 parallaxCorrectNormal( vec3 v, vec3 cubeSize, vec3 cubePos ) {\n    vec3 nDir = normalize( v );\n    vec3 rbmax = ( .5 * cubeSize + cubePos - vWorldPosition ) / nDir;\n    vec3 rbmin = ( -.5 * cubeSize + cubePos - vWorldPosition ) / nDir;\n    vec3 rbminmax;\n    rbminmax.x = ( nDir.x > 0. ) ? rbmax.x : rbmin.x;\n    rbminmax.y = ( nDir.y > 0. ) ? rbmax.y : rbmin.y;\n    rbminmax.z = ( nDir.z > 0. ) ? rbmax.z : rbmin.z;\n    float correction = min( min( rbminmax.x, rbminmax.y ), rbminmax.z );\n    vec3 boxIntersection = vWorldPosition + nDir * correction;\n    return boxIntersection - cubePos;\n}\n#endif\n#ifdef ENVMAP_MODE_REFRACTION\nuniform float refractionRatio;\n#endif\nvec3 getLightProbeIndirectIrradiance( /*const in SpecularLightProbe specularLightProbe,*/ const in GeometricContext geometry, const in int maxMIPLevel ) {\n    vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n    #ifdef ENVMAP_TYPE_CUBE\n    #ifdef BOX_PROJECTED_ENV_MAP\n    worldNormal = parallaxCorrectNormal( worldNormal, cubeMapSize, cubeMapPos );\n    #endif\n    vec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n    // TODO: replace with properly filtered cubemaps and access the irradiance LOD level, be it the last LOD level\n    // of a specular cubemap, or just the default level of a specially created irradiance cubemap.\n    #ifdef TEXTURE_LOD_EXT\n    vec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n    #else\n    // force the bias high to get the last LOD level as it is the most blurred.\n    vec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n    #endif\n    envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n    #elif defined( ENVMAP_TYPE_CUBE_UV )\n    vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n    #else\n    vec4 envMapColor = vec4( 0.0 );\n    #endif\n    return PI * envMapColor.rgb * envMapIntensity;\n}\n// Trowbridge-Reitz distribution to Mip level, following the logic of http://casual-effects.blogspot.ca/2011/08/plausible-environment-lighting-in-two.html\nfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n    float maxMIPLevelScalar = float( maxMIPLevel );\n    float sigma = PI * roughness * roughness / ( 1.0 + roughness );\n    float desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n    // clamp to allowable LOD ranges.\n    return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n}\nvec3 getLightProbeIndirectRadiance( /*const in SpecularLightProbe specularLightProbe,*/ const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n    #ifdef ENVMAP_MODE_REFLECTION\n    vec3 reflectVec = reflect( -viewDir, normal );\n    // Mixing the reflection with the normal is more accurate and keeps rough objects from gathering light from behind their tangent plane.\n    reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n    #else\n    vec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n    #endif\n    reflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n    float specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n    #ifdef ENVMAP_TYPE_CUBE\n    #ifdef BOX_PROJECTED_ENV_MAP\n    reflectVec = parallaxCorrectNormal( reflectVec, cubeMapSize, cubeMapPos );\n    #endif\n    vec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n    #ifdef TEXTURE_LOD_EXT\n    vec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n    #else\n    vec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n    #endif\n    envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n    #elif defined( ENVMAP_TYPE_CUBE_UV )\n    vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n    #endif\n    return envMapColor.rgb * envMapIntensity;\n}\n#endif\n";
class ModelLightEffectData extends AbstractScriptParser{constructor(){super(...arguments);this.light=!1;this.distance=2;this.intensity=this.angle=10;this.visible=!1;this.color=new THREE.Color(16777215);this.double=!1}static getFromName(a){return this.loopOnKeys(this.extractBaseCode(a,"light"),new ModelLightEffectData)}parseVal(a,e){this.light=!0;"distance"==a?this.distance=parseFloat(e):"color"==a?this.color=new THREE.Color(e):"intensity"==a?this.intensity=parseFloat(e):"angle"==a?this.angle=parseFloat(e)*
THREE.MathUtils.DEG2RAD:"double"==a?this.double=!0:"visible"==a&&(this.visible=!0)}}
class CanvasTexture{constructor(a){this._canvas=document.createElement("canvas");this._canvas.id=a+"canvas";document.getElementById("videocanvas").appendChild(this._canvas);this._2dContext=this._canvas.getContext("2d");this._texture=new THREE.Texture(this._canvas);this._texture.generateMipmaps=!0}get texture(){return this._texture}update(a){(this._texture.needsUpdate=a)&&this._draw()}dispose(){document.getElementById("videocanvas").removeChild(this._canvas);this._canvas=this._2dContext=null}}
class TextUtils{static replaceUnicodeChars(a){for(let e=0;e<this.defaultDiacriticsRemovalMap.length;e++)a=a.replace(this.defaultDiacriticsRemovalMap[e].letters,this.defaultDiacriticsRemovalMap[e].base);return a}static fixFamilyName(a){return a.replace(/[0-9]/gm,e=>String.fromCharCode(Number(e)+65))}static generateText(a,e="#000"){let h=new THREE.Texture,m=new Image;var t=document.createElement("p");t.style.font="100px sans-serif";t.style.margin="10px";t.style.fill="#000";t.style.color=e;t.style.stroke=
"none";t.style.textAlign="center";t.setAttribute("xmlns","http://www.w3.org/1999/xhtml");e=document.createElement("span");t.appendChild(e);e.innerHTML=a;document.body.appendChild(t);a=e.offsetWidth+20;e=e.offsetHeight+20;var y=Device.getMaxResolutionDivisor();y=Device.projectedSizeForMaxResolution(a/y,e/y);h.width=y.x/10;h.height=y.y/10;document.body.removeChild(t);let C=document.createElement("canvas");C.width=a;C.height=e;let I=C.getContext("2d");t='<svg xmlns="http://www.w3.org/2000/svg" width="'+
a+'" height="'+e+'"><foreignObject width="100%" height="100%">'+t.outerHTML+"</foreignObject></svg>";m.onload=()=>{I.drawImage(m,0,0);h.image=C;h.needsUpdate=!0};m.src="data:image/svg+xml,"+encodeURIComponent(t);return h}}
TextUtils.defaultDiacriticsRemovalMap=[{base:"_",letters:/[\u0020]/g},{base:"A",letters:/[\u0041\u24B6\uFF21\u00C0\u00C1\u00C2\u1EA6\u1EA4\u1EAA\u1EA8\u00C3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\u00C4\u01DE\u1EA2\u00C5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F]/g},{base:"AA",letters:/[\uA732]/g},{base:"AE",letters:/[\u00C6\u01FC\u01E2]/g},{base:"AO",letters:/[\uA734]/g},{base:"AU",letters:/[\uA736]/g},{base:"AV",letters:/[\uA738\uA73A]/g},{base:"AY",letters:/[\uA73C]/g},
{base:"B",letters:/[\u0042\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181]/g},{base:"C",letters:/[\u0043\u24B8\uFF23\u0106\u0108\u010A\u010C\u00C7\u1E08\u0187\u023B\uA73E]/g},{base:"D",letters:/[\u0044\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779]/g},{base:"DZ",letters:/[\u01F1\u01C4]/g},{base:"Dz",letters:/[\u01F2\u01C5]/g},{base:"E",letters:/[\u0045\u24BA\uFF25\u00C8\u00C9\u00CA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\u00CB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E]/g},
{base:"F",letters:/[\u0046\u24BB\uFF26\u1E1E\u0191\uA77B]/g},{base:"G",letters:/[\u0047\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E]/g},{base:"H",letters:/[\u0048\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D]/g},{base:"I",letters:/[\u0049\u24BE\uFF29\u00CC\u00CD\u00CE\u0128\u012A\u012C\u0130\u00CF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197]/g},{base:"J",letters:/[\u004A\u24BF\uFF2A\u0134\u0248]/g},{base:"K",letters:/[\u004B\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2]/g},
{base:"L",letters:/[\u004C\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780]/g},{base:"LJ",letters:/[\u01C7]/g},{base:"Lj",letters:/[\u01C8]/g},{base:"M",letters:/[\u004D\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C]/g},{base:"N",letters:/[\u004E\u24C3\uFF2E\u01F8\u0143\u00D1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4]/g},{base:"NJ",letters:/[\u01CA]/g},{base:"Nj",letters:/[\u01CB]/g},{base:"O",letters:/[\u004F\u24C4\uFF2F\u00D2\u00D3\u00D4\u1ED2\u1ED0\u1ED6\u1ED4\u00D5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\u00D6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\u00D8\u01FE\u0186\u019F\uA74A\uA74C]/g},
{base:"OI",letters:/[\u01A2]/g},{base:"OO",letters:/[\uA74E]/g},{base:"OU",letters:/[\u0222]/g},{base:"P",letters:/[\u0050\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754]/g},{base:"Q",letters:/[\u0051\u24C6\uFF31\uA756\uA758\u024A]/g},{base:"R",letters:/[\u0052\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782]/g},{base:"S",letters:/[\u0053\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784]/g},{base:"T",
letters:/[\u0054\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786]/g},{base:"TZ",letters:/[\uA728]/g},{base:"U",letters:/[\u0055\u24CA\uFF35\u00D9\u00DA\u00DB\u0168\u1E78\u016A\u1E7A\u016C\u00DC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244]/g},{base:"V",letters:/[\u0056\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245]/g},{base:"VY",letters:/[\uA760]/g},{base:"W",letters:/[\u0057\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72]/g},
{base:"X",letters:/[\u0058\u24CD\uFF38\u1E8A\u1E8C]/g},{base:"Y",letters:/[\u0059\u24CE\uFF39\u1EF2\u00DD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE]/g},{base:"Z",letters:/[\u005A\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762]/g},{base:"a",letters:/[\u0061\u24D0\uFF41\u1E9A\u00E0\u00E1\u00E2\u1EA7\u1EA5\u1EAB\u1EA9\u00E3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\u00E4\u01DF\u1EA3\u00E5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250]/g},
{base:"aa",letters:/[\uA733]/g},{base:"ae",letters:/[\u00E6\u01FD\u01E3]/g},{base:"ao",letters:/[\uA735]/g},{base:"au",letters:/[\uA737]/g},{base:"av",letters:/[\uA739\uA73B]/g},{base:"ay",letters:/[\uA73D]/g},{base:"b",letters:/[\u0062\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253]/g},{base:"c",letters:/[\u0063\u24D2\uFF43\u0107\u0109\u010B\u010D\u00E7\u1E09\u0188\u023C\uA73F\u2184]/g},{base:"d",letters:/[\u0064\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A]/g},
{base:"dz",letters:/[\u01F3\u01C6]/g},{base:"e",letters:/[\u0065\u24D4\uFF45\u00E8\u00E9\u00EA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\u00EB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD]/g},{base:"f",letters:/[\u0066\u24D5\uFF46\u1E1F\u0192\uA77C]/g},{base:"g",letters:/[\u0067\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F]/g},{base:"h",letters:/[\u0068\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265]/g},
{base:"hv",letters:/[\u0195]/g},{base:"i",letters:/[\u0069\u24D8\uFF49\u00EC\u00ED\u00EE\u0129\u012B\u012D\u00EF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131]/g},{base:"j",letters:/[\u006A\u24D9\uFF4A\u0135\u01F0\u0249]/g},{base:"k",letters:/[\u006B\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3]/g},{base:"l",letters:/[\u006C\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747]/g},{base:"lj",letters:/[\u01C9]/g},
{base:"m",letters:/[\u006D\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F]/g},{base:"n",letters:/[\u006E\u24DD\uFF4E\u01F9\u0144\u00F1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5]/g},{base:"nj",letters:/[\u01CC]/g},{base:"o",letters:/[\u006F\u24DE\uFF4F\u00F2\u00F3\u00F4\u1ED3\u1ED1\u1ED7\u1ED5\u00F5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\u00F6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\u00F8\u01FF\u0254\uA74B\uA74D\u0275]/g},
{base:"oi",letters:/[\u01A3]/g},{base:"ou",letters:/[\u0223]/g},{base:"oo",letters:/[\uA74F]/g},{base:"p",letters:/[\u0070\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755]/g},{base:"q",letters:/[\u0071\u24E0\uFF51\u024B\uA757\uA759]/g},{base:"r",letters:/[\u0072\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783]/g},{base:"s",letters:/[\u0073\u24E2\uFF53\u00DF\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B]/g},
{base:"t",letters:/[\u0074\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787]/g},{base:"tz",letters:/[\uA729]/g},{base:"u",letters:/[\u0075\u24E4\uFF55\u00F9\u00FA\u00FB\u0169\u1E79\u016B\u1E7B\u016D\u00FC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289]/g},{base:"v",letters:/[\u0076\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C]/g},{base:"vy",letters:/[\uA761]/g},{base:"w",letters:/[\u0077\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73]/g},
{base:"x",letters:/[\u0078\u24E7\uFF58\u1E8B\u1E8D]/g},{base:"y",letters:/[\u0079\u24E8\uFF59\u1EF3\u00FD\u0177\u1EF9\u0233\u1E8F\u00FF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF]/g},{base:"z",letters:/[\u007A\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763]/g}];
class TextCanvasTexture extends CanvasTexture{constructor(a){super(a.uuid);this._data=a;this._width=256;this._defaultText="";this._defaultLines=[""];this._data.fontFamily=TextUtils.fixFamilyName(this._data.fontFamily)}notify(a,e){a==InitCommand.FONT_LOAD_END&&Config.assets.fonts.includes(this._data.fontFamily)&&(Notifier.unsubscribe(this,InitCommand.FONT_LOAD_END),this._drawAfterLoad())}set text(a){a=a.replace(/[ \t]+/g," ");a!=this._defaultText&&(this._defaultText=a,this._defaultLines=a.split("\n"),
this.update(!0))}dispose(){super.dispose();this._defaultText=this._defaultLines=null}_drawAfterLoad(){this._2dContext.font=this._data._font;var a=0;for(var e=0;e<this._defaultLines.length;++e){var h=this._2dContext.measureText(this._defaultLines[e]).width;a<h&&(a=h)}this._canvasResize(a);this._2dContext.font=this._data._font;this._2dContext.clearRect(0,0,this._width,this._height);if(this._data.backgroundColor||this._data.border)this._2dContext.fillStyle=this._data.backgroundColor,this._2dContext.strokeStyle=
this._data.borderColor,this._2dContext.lineWidth=this._data.border,TextCanvasTexture._roundRect(this._2dContext,.5*this._data.border,.5*this._data.border,this._width-1-this._data.border,this._height-1-this._data.border,this._data.borderRadius,""!=this._data.backgroundColor,0!=this._data.border);this._2dContext.textBaseline="middle";this._2dContext.fillStyle=this._data.color;this._2dContext.strokeStyle=this._data.color;this._2dContext.lineWidth=4;switch(this._data.textAlign){case "left":case "start":a=
this._data.padding+this._data.border;break;case "right":case "end":a=this._width-this._data.padding-this._data.border;break;default:a=.5*this._width}for(e=0;e<this._defaultLines.length;++e){h=this._data.padding+this._data.border+(e+.5)*this._data._lineHeight;this._2dContext.textAlign=this._data.textAlign;this._2dContext.fillText(this._defaultLines[e],a,h);if(""==this._data.textDecoration||"none"==this._data.textDecoration)continue;let m=this._2dContext.measureText(this._defaultLines[e]).width,t=a;
switch(this._data.textAlign){case "left":case "start":break;case "right":case "end":t-=m;break;default:t-=.5*m}this._data.textDecoration.includes("underline")&&this._fillWithChar("_",t,h,m);this._data.textDecoration.includes("line-through")&&this._fillWithChar("\u2012",t,h,m)}}_draw(){Config.assets.fonts.includes(this._data.fontFamily)?this._drawAfterLoad():Notifier.subscribe(this,InitCommand.FONT_LOAD_END)}static _roundRect(a,e,h,m,t,y=5,C=!1,I=!0){let E=Math.min(y,.5*m);y=Math.min(y,.5*t);a.beginPath();
a.moveTo(e+E,h);a.lineTo(e+m-E,h);a.quadraticCurveTo(e+m,h,e+m,h+y);a.lineTo(e+m,h+t-y);a.quadraticCurveTo(e+m,h+t,e+m-E,h+t);a.lineTo(e+E,h+t);a.quadraticCurveTo(e,h+t,e,h+t-y);a.lineTo(e,h+y);a.quadraticCurveTo(e,h,e+E,h);a.closePath();C&&a.fill();I&&a.stroke()}_fillWithChar(a,e,h,m){var t=this._2dContext.measureText(a).width;t=Math.ceil(.5*m/t);this._2dContext.textAlign="left";this._2dContext.fillText(a.repeat(t),e,h);this._2dContext.textAlign="right";this._2dContext.fillText(a.repeat(t),e+m,h)}_canvasResize(a){let e=
2*(this._data.padding+this._data.border);a+=e;a!=this._width&&(this._canvas.width=this._width=a,this._canvas.height=this._height=this._data._lineHeight*(this._defaultLines.length||1)+e,a=Device.getMaxResolutionDivisor(),a=Device.projectedSizeForMaxResolution(this._width/a,this._height/a),this._texture.width=a.x,this._texture.height=a.y)}}
class InjectionScriptData extends AbstractScriptParser{constructor(){super(...arguments);this.injection=!1;this.type="map";this.from="url";this.color="#000";this.keepUpdate=!1}static getFromName(a){return this.loopOnKeys(this.extractBaseCode(a,"inject"),new InjectionScriptData)}parseVal(a,e){this.injection=!0;"type"==a?this.type="text"==e?"text":"360"==e?"360":"map":"from"==a?this.from="js"==e?e:"lib"==e?"lib":"url":"target"==a?this.target=e:"value"==a||"name"==a?this.value=e:"update"==a||"keepupdate"==
a?this.keepUpdate=!0:"color"==a&&(this.color=e)}get texture(){let a=new THREE.Texture;var e=0<this.value.toLowerCase().search(/\.(jpg|jpeg)$/);a.format=e?THREE.RGBFormat:THREE.RGBAFormat;a.needsUpdate=!1;a.generateMipmaps=!0;a.magFilter=THREE.LinearFilter;a.minFilter=THREE.LinearMipmapLinearFilter;a.anisotropy=View3D.inst.renderer.capabilities.getMaxAnisotropy();a.width=1;a.height=1;e=new THREE.ImageLoader;e.setCrossOrigin("Anonymous");"js"==this.from?"text"==this.type?(e=new TextCanvasTexture(new TextAspectData),
e.text=window[this.value],a=e.texture):e.load(window[this.value],h=>{this.manageFinalImage(a,h)}):"text"==this.type?(e=new TextCanvasTexture(new TextAspectData),e.text=this.value,a=e.texture):"url"==this.from?e.load(this.value,h=>{this.manageFinalImage(a,h)}):"videos"==this.type||"videos360"==this.type?e.load(Config.DATA_FOLDER+this.type+"/"+this.value,h=>{this.manageFinalImage(a,h)}):"360"==this.type?e.load(Config.DATA_FOLDER+PathUtils.getFlagResolutionPath(ResolutionFlags.UHD)+"panoramas/"+this.value,
h=>{this.manageFinalImage(a,h)}):"map"==this.type&&Config.assets.assetElements.traverse(h=>{0<h.image.src.toLowerCase().search(this.value)&&this.manageFinalImage(a,h.image)},!0);return a}manageFinalImage(a,e){a.image=e;a.needsUpdate=!0;let h=Device.getMaxResolutionDivisor();e=Device.projectedSizeForMaxResolution(e.naturalWidth/h,e.naturalHeight/h);a.width=e.x/10;a.height=e.y/10}}
class LightProbeUtils{static fromCubeRenderTarget(a,e){let h=0,m=new THREE.Vector3,t=new THREE.Vector3,y=new THREE.Color,C=[0,0,0,0,0,0,0,0,0],I=new THREE.SphericalHarmonics3,E=I.coefficients;for(let R=0;6>R;R++){let W=e.width,ea=new Uint8Array(W*W*4);a.readRenderTargetPixels(e,0,0,W,W,ea,R);let T=2/W;for(let fa=0,sa=ea.length;fa<sa;fa+=4){y.setRGB(ea[fa]/255,ea[fa+1]/255,ea[fa+2]/255);LightProbeUtils.convertColorToLinear(y,e.texture.encoding);var H=fa/4;var O=-1+(H%W+.5)*T;H=1-(Math.floor(H/W)+.5)*
T;switch(R){case 0:m.set(1,H,-O);break;case 1:m.set(-1,H,O);break;case 2:m.set(O,1,-H);break;case 3:m.set(O,-1,H);break;case 4:m.set(O,H,1);break;case 5:m.set(-O,H,-1)}O=m.lengthSq();O=4/(Math.sqrt(O)*O);h+=O;t.copy(m).normalize();THREE.SphericalHarmonics3.getBasisAt(t,C);for(H=0;9>H;H++)E[H].x+=C[H]*y.r*O,E[H].y+=C[H]*y.g*O,E[H].z+=C[H]*y.b*O}}a=4*Math.PI/h;for(e=0;9>e;e++)E[e].x*=a,E[e].y*=a,E[e].z*=a;return new THREE.LightProbe(I)}static convertColorToLinear(a,e){switch(e){case THREE.sRGBEncoding:a.convertSRGBToLinear();
break;case THREE.LinearEncoding:break;default:console.warn("WARNING: LightProbeGenerator convertColorToLinear() encountered an unsupported encoding.")}return a}}
class GLTFModelPickerScript extends Notifiable{constructor(){super();this._colorPickers=new MessyDictionary;this._matPickers=new MessyDictionary;this._interactiveObjects=[];this._interact=!1}notify(a,e){switch(a){case PointerCommand.START:this.process(e)}}process(a){var e=PointerManager.inst.rayCaster.intersectObjects(this._interactiveObjects);let h,m,t=new THREE.WebGLRenderTarget(1,1);if(e.length)for(let y=0;y<e.length;y++){h=e[y];if(m=this._colorPickers.get(h.object.name)){e=View3D.inst.renderer.getRenderTarget();
View3D.inst.camera.setViewOffset(View3D.inst.renderer.domElement.width,View3D.inst.renderer.domElement.height,a.clickPos.x*window.devicePixelRatio|0,a.clickPos.y*window.devicePixelRatio|0,1,1);View3D.inst.renderer.setRenderTarget(t);View3D.inst.renderer.render(View3D.inst.scene,View3D.inst.camera);View3D.inst.camera.clearViewOffset();View3D.inst.renderer.setRenderTarget(e);a=new Uint8Array(4);View3D.inst.renderer.readRenderTargetPixels(t,0,0,1,1,a);m.material.color&&(m.material.color=new THREE.Color(a[0]/
255,a[1]/255,a[2]/255));break}if((m=this._matPickers.get(h.object.name))&&m.material){m.material=h.object.material;break}}}addColorPicker(a,e){this._colorPickers.add(a.name,e);this._interactiveObjects.push(a)}addMatPicker(a,e){this._matPickers.add(a.name,e);this._interactiveObjects.push(a)}addPickerGroup(a){this._pickerGroup=a}dispose(){this._pickerGroup&&View3D.inst.camera.remove(this._pickerGroup);this._colorPickers.empty();this._matPickers.empty();this._interactiveObjects=[];Notifier.unsubscribe(this,
PointerCommand.START)}start(){this._pickerGroup&&(this._pickerGroup.position.set(0,0,0),View3D.inst.camera.add(this._pickerGroup));Notifier.subscribe(this,PointerCommand.START)}static parseHierarchy(a){let e,h,m;a.traverse(t=>{GLTFModelPickerScript._regPicker.test(t.name)&&(e||=new GLTFModelPickerScript,e.addPickerGroup(t));GLTFModelPickerScript._regColorPicker.test(t.name)&&(h=GLTFModelPickerScript._regColorPicker.exec(t.name),h[1]&&(e||=new GLTFModelPickerScript,m=h[1],a.traverse(y=>{y.name==m&&
e.addColorPicker(t,y)})));GLTFModelPickerScript._regMatPicker.test(t.name)&&(h=GLTFModelPickerScript._regMatPicker.exec(t.name),h[1]&&(e||=new GLTFModelPickerScript,m=h[1],a.traverse(y=>{y.name==m&&e.addMatPicker(t,y)})))});return e}}GLTFModelPickerScript._regColorPicker=/__colorpicker_(.*)__/i;GLTFModelPickerScript._regMatPicker=/__matpicker_(.*)__/i;GLTFModelPickerScript._regPicker=/__picker__/i;
class ModelAspect extends AbstractAspect{constructor(){super(...arguments);this.name="ModelAspect";this._envmaps=[];this._envmapType=Config.BASE_ENVMAP_TYPE;this._needEnvMapUpdate=!1;this._clippingOrder="ZYX";this._hasRoomShader=!1;this._parallaxNode=[]}notify(a,e){var h,m;super.notify(a,e);a==ViewportCommand.UPDATE?this._container.visible&&(this._gltfAnimator&&this._gltfAnimator.updateMixers(Time.getDelta()),this._needEnvMapUpdate&&EffectsManager.inst.backgroundRenderTarget&&(this._gltfAnimator||
Notifier.unsubscribe(this,a),this._needEnvMapUpdate&&(this._needEnvMapUpdate=!1,this._container.visible=this._hasRoomShader,this._parallaxNode.forEach(t=>{t.visible=!1}),a=new THREE.Vector3,this._envmapType==EnvMapType.MODEL&&(this._container.getWorldPosition(a),EffectsManager.inst.updateBackgroundRenderTarget(a)),this.shaderScript&&this.shaderScript.probe&&this._lightProbe.copy(LightProbeUtils.fromCubeRenderTarget(View3D.inst.renderer,EffectsManager.inst.backgroundRenderTarget)),this._envmaps.forEach(t=>
{t.material.envMap=EffectsManager.inst.backgroundRenderTarget.texture;t.material.needsUpdate=!0}),this._container.visible=!0,this._parallaxNode.forEach(t=>{t.visible=!0})))):a==SceneCommand.FIRST_FRAME?(Notifier.unsubscribe(this,a),(null===(h=this.clipScript)||void 0===h?0:h.clipPlanes.length)&&this.clipScript.clipPlanes.forEach((t,y)=>{var C=new THREE.Vector3,I=new THREE.Quaternion;let E=new THREE.Vector3;this._container.matrixWorld.decompose(C,I,E);let H=(new THREE.Euler(0,0,0,this._clippingOrder)).setFromQuaternion(I);
H.x+=this.clipScript.clipEuler[y].x;H.y+=this.clipScript.clipEuler[y].y;H.z+=this.clipScript.clipEuler[y].z;I.setFromEuler(H);this._container.matrixWorld.compose(C,I,E);this.clipScript.clipEuler[y]=H;C=new THREE.Vector3;C=C.set(this._container.matrixWorld.elements[8],this._container.matrixWorld.elements[9],this._container.matrixWorld.elements[10]).normalize();this.clipScript.clipNormals[y]=C;t.normal=this.clipScript.clipNormals[y];C=(new THREE.Vector3).copy(this.clipScript.clipNormals[y]);I=this._container.localToWorld(this._container.position.clone());
t.constant=-C.dot(I.add(this.clipScript.clipDistances[y]))})):a==SceneCommand.ALL_VIDEOS_HAVE_FRAMES?(Notifier.unsubscribe(this,a),this._needEnvMapUpdate&&(this._envmapType==EnvMapType.MODEL&&EffectsManager.inst.setupBackgroundRenderTarget(),this.setEnvMapLightProbe(),Notifier.subscribe(this,ViewportCommand.UPDATE))):a==ImplicationCommand.SET_INJECTION_MAP&&(Notifier.unsubscribe(this,a),(null===(m=this.injectionScript)||void 0===m?void 0:m.value)==e&&this.setInjectionMap())}updateAnimation(a,e){this._gltfAnimator&&
this._gltfAnimator.updateCinematic(a,e)}manageClipIntersection(a){this._gr.traverse(e=>{this.clipScript&&e.material&&(a?(e.material.clippingPlanes=this.clipScript.clipPlanes,e.material.clipIntersection=!0):(e.material.clippingPlanes=null,e.material.clipIntersection=!1))})}create(){var a;if(this.data.media&&(this._needEnvMapUpdate=!1,this._gr=Config.assets.getModel(this.data.media))){this._container.add(this._gr);var e=!1,h=!1,m=!1;if(AbstractScriptParser.isScript(this.data.name)){var t=ShadowEffectData.getFromName(this.data.name);
t&&(e=t.cast,h=t.receive);this.clipScript=ClippingScriptData.getFromName(this.data.name,this._clippingOrder);this.effectScript=GlowEffectScriptData.getFromName(this.data.name);this.shaderScript=ShaderScriptData.getFromName(this.data.name);this.injectionScript=InjectionScriptData.getFromName(this.data.name)}this._envmapType=this.shaderScript?this.shaderScript.envmapType:this._envmapType;m=this._envmapType!=EnvMapType.NONE;if(null===(a=this.shaderScript)||void 0===a?0:a.correctLights)View3D.inst.renderer.physicallyCorrectLights=
!0;this.injectionScript&&(this.setInjectionMap(),this.injectionScript.keepUpdate&&Notifier.subscribe(this,ImplicationCommand.SET_INJECTION_MAP));this.clipScript&&(Notifier.subscribe(this,SceneCommand.FIRST_FRAME),View3D.inst.renderer.localClippingEnabled=!0);var y=(Config.currentScene.meshRenderOrder[this.uuid]||Config.simulationData.scenes[0].meshRenderOrder[this.uuid]).renderTransparent;a=[];var C=!1,I;this._gr.traverse(E=>{-1===E.name.toLowerCase().indexOf("__noshadow__")&&(E.castShadow=e,E.receiveShadow=
h);(I=E.material)&&this.shaderScript&&this.shaderScript.toon&&(I=GLTFCellShadingExtension.cloneFromMaterial(I,this.shaderScript.envmap),I.needsUpdate=!0);if(m&&(C=I&&((I.isMeshStandardMaterial||I.isMeshPhysicalMaterial||I.isGLTFRoughnessMetalnessMaterial)&&0<I.metalness||I.isShaderMaterial&&void 0!==I.envMap))){this._envmaps.push({material:I,node:E});this._needEnvMapUpdate=!0;if(this.regRoom.test(E.name)){this._hasRoomShader=!0;var H=this.regRoom.exec(E.name);var O=H[1]?parseFloat(H[1]):1,R=H[2]?
parseFloat(H[2])/100:1,W=H[3]?parseFloat(H[3])/100:1;H=new ShaderScriptData;H.room=!0;H.envmap=!0;H.roughness=R;H.metalness=W;H.envmapHeight=O;this.shaderScript&&(H.roughness=this.shaderScript.roughness,H.metalness=this.shaderScript.metalness,H.glossiness=this.shaderScript.glossiness)}else this.regRoomItem.test(E.name)?(H=new ShaderScriptData,H.roomItem=!0,H.envmap=!0):H=this.shaderScript;if(null===H||void 0===H?0:H.room){this._parallaxNode.push(E);E.userData.hasParallax=!0;O=new THREE.Box3;O.setFromObject(this._container);
let ea=new THREE.Vector3;O.getSize(ea);let T=H.envmapHeight?H.envmapHeight:ea.y;I.onBeforeCompile=fa=>{fa.uniforms.cubeMapSize={value:new THREE.Vector3(ea.x,T,ea.z)};fa.uniforms.cubeMapPos={value:new THREE.Vector3(0,this._container.position.y,0)};fa.uniforms.flipEnvMap.value=!0;fa.vertexShader="varying vec3 vWorldPosition;\n"+fa.vertexShader;fa.vertexShader=fa.vertexShader.replace("#include <worldpos_vertex>",ParallaxShaderParts.worldposReplace);fa.fragmentShader=fa.fragmentShader.replace("#include <envmap_pars_fragment>",
ParallaxShaderParts.envmapPhysicalParsReplace);fa.fragmentShader=fa.fragmentShader.replace("#include <envmap_physical_pars_fragment>",ParallaxShaderParts.envmapPhysicalParsReplace);fa.uniforms.selected={value:0};fa.uniforms.selectionVariation={value:0};fa.fragmentShader="uniform float selected;\nuniform float selectionVariation;\n"+fa.fragmentShader;fa.fragmentShader=fa.fragmentShader.replace("gl_FragColor = vec4( outgoingLight, diffuseColor.a );","\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );\nif(selected > 0.0) {\n    gl_FragColor += 0.2 * sin( selectionVariation );\n}\n");
E.userData.selected=fa.uniforms.selected;E.userData.selectionVariation=fa.uniforms.selectionVariation;this.materialShaderCompiled++;this.callbackAfterCompile()}}if(null===H||void 0===H?0:H.metalness)I.metalness=null===H||void 0===H?void 0:H.metalness;null!=(null===H||void 0===H?void 0:H.roughness)&&(I.roughness=null===H||void 0===H?void 0:H.roughness);null!=(null===H||void 0===H?void 0:H.glossiness)&&(I.glossiness=null===H||void 0===H?void 0:H.glossiness)}if(this.regRectLight.test(E.name)&&!Device.isMobile()){E.castShadow=
!1;E.receiveShadow=!1;R=this.regRectLight.exec(E.name);H=R[1]?new THREE.Color(R[1]):new THREE.Color(16777215);O=R[2]?parseFloat(R[2]):1;R=R[3]?1==parseFloat(R[3]):!1;O*=this.shaderScript?this.shaderScript.rectfactor:1;W=new THREE.Vector3;E.getWorldPosition(W);let ea=new THREE.Quaternion;E.getWorldQuaternion(ea);let T=new THREE.Vector3;E.getWorldScale(T);T.multiplyScalar(2);this.createRectLight(W,ea,T,H,O,R);E.visible=!1;this._gr.userData.hasLight=!0}this.clipScript&&I&&(E.material.clippingPlanes=
this.clipScript.clipPlanes,E.material.clipIntersection=!0);this.regFloor.test(E.name)?(E.castShadow=!1,E.receiveShadow=!1,this._parallaxNode.push(E),MotionZone.inst.addFloor(E,FloorData.getFromName(E.name)),E.material&&(E.material.transparent=!0),E.renderOrder=Config.RENDER_ORDER_TRANSPARENT++):y&&(E.renderOrder=Config.RENDER_ORDER_TRANSPARENT++)});(t=ModelLightEffectData.getFromName(this.data.name))&&this.createRectLighting(t);for(t=0;t<a.length;t++)a[t].parent.remove(a[t]);if(a=Config.assets.animations.get(this.data.media))this._gltfAnimator=
new GLTFAnimator(this.uuid,a,this._gr);if(this.clipScript){this._clipGr=this._gr.clone(!0);let E=(new ClipShader(this.clipScript)).material;this._container.add(this._clipGr);a&&this._gltfAnimator.addMixer("clip",this._clipGr);this._clipGr.traverse(H=>{if(H.material){let O=H.geometry.clone();H.geometry=O.scale(.98,.98,.98);H.material=E}})}if(this.effectScript){this._effectGr=this._gr.clone(!0);this._container.add(this._effectGr);a&&this._gltfAnimator.addMixer("glow",this._effectGr);let E=(new GlowShader(this.effectScript)).material;
this.currentEffectColor=this.effectScript.color;this.currentEffectAlpha=this.effectScript.alpha;this._effectGr.traverse(H=>{var O;if(H instanceof THREE.Mesh&&H.material){H.material=E;if(null===(O=this.clipScript)||void 0===O?0:O.clipPlanes.length)H.material.clippingPlanes=this.clipScript.clipPlanes,H.material.clipIntersection=!0;H.renderOrder=Config.RENDER_ORDER_TRANSPARENT++}})}(this._picker=GLTFModelPickerScript.parseHierarchy(this._gr))&&this._picker.start();this._needEnvMapUpdate?(Notifier.subscribe(this,
SceneCommand.ALL_VIDEOS_HAVE_FRAMES),Notifier.subscribe(this,SceneCommand.FIRST_FRAME)):a?Notifier.subscribe(this,ViewportCommand.UPDATE):Notifier.unsubscribe(this,ViewportCommand.UPDATE)}}setEnvMapLightProbe(){this.shaderScript&&this.shaderScript.probe&&(this._lightProbe=new THREE.LightProbe,this._container.add(this._lightProbe))}setInjectionMap(){let a;this._gr.traverse(e=>{a=e.material;this.injectionScript.target&&e.name==this.injectionScript.target&&a?a.map=this.injectionScript.texture:a&&(a.map=
this.injectionScript.texture)})}createRectLighting(a){let e=BoundingHelper.getWorldBoundingBox(this._gr);if(e){let h=new THREE.Vector3,m=new THREE.Quaternion,t=new THREE.Vector3;m.setFromAxisAngle(new THREE.Vector3(1,0,0),Math.PI-a.angle);e.getSize(t);e.getCenter(h);this.createRectLight(h.clone().set(h.x,h.y+a.distance*t.y,h.z-a.distance*t.y),m,t,a.color,a.intensity,a.visible);a.double&&(m.setFromAxisAngle(new THREE.Vector3(1,0,0),Math.PI+a.angle),this.createRectLight(h.clone().set(h.x,h.y+a.distance*
t.y,h.z+a.distance*t.y),m,t,a.color,a.intensity,a.visible))}}createRectLight(a,e,h,m,t,y){let C=new THREE.Quaternion;C.setFromAxisAngle(new THREE.Vector3(1,0,0),Math.PI/2);e.multiply(C);h=new THREE.RectAreaLight(m,t,h.x,h.z);h.position.copy(a);h.quaternion.copy(e);this._container.add(h);this._parallaxNode.push(h);y&&(a=new THREE.Mesh(new THREE.PlaneBufferGeometry,new THREE.MeshBasicMaterial({side:THREE.BackSide,color:m})),a.scale.x=h.width,a.scale.y=h.height,h.add(a),e=new THREE.Mesh(new THREE.PlaneBufferGeometry,
new THREE.MeshBasicMaterial({side:THREE.FrontSide,color:526344})),a.add(e))}generatePhysic(){let a=super.generatePhysic();if(a)return this._gr.traverse(e=>{let h;this.regFloor.test(e.name)?h=PhysicProfile.FLOOR:this.regStatic.test(e.name)?h=PhysicProfile.STATIC:this.regStatic.test(e.name)&&(h=PhysicProfile.DYNAMIC);if(h){var m=new PhysicScriptData;m.profile=h;m.type=PhysicObjectType.REAL;m.physic=!0;m.mass=h.type==PhysicProfileType.DYNAMIC?5:0;PhysicsHelper.addPhysicObject(e,this,m)}}),a}placeContainer(){CoordUtils.set3dTransforms(this._container,
this.data);var a=AnimEffectRefHolder.inst.getRef(this.uuid);if(a){CoordUtils.set3dTransforms(this._container,a);if(a.gltfAnims)for(let e in a.gltfAnims){let h=new GLTFAnimationData,m=a.gltfAnims[e];h.name="";h.uuid=m.uuid;h.targets=[e];h.kind=m.kind;h.iterations=m.iterations;h.reverse=m.reverse;h.speed=m.speed;h.yoyo=m.yoyo;this._gltfAnimator.updateCinematic(h,null)}a.color&&(a=AnimDataUtils.copy(a.color),AnimFactory.fillGlowData(a,this),this.applyColor(a))}this._container.updateMatrix()}applyColor(a){a&&
this.effectScript&&(this.currentEffectColor=new THREE.Color(a.r,a.g,a.b),this.currentEffectAlpha=a.a,this._effectGr.traverse(e=>{e instanceof THREE.Mesh&&e.material&&(e.material.uniforms.glowcolor.value=new THREE.Color(a.r,a.g,a.b),e.material.uniforms.glowalpha.value=a.a,e.material.uniforms.glowcolor.needsUpdate=!0)}))}dispose(){super.dispose();this._picker&&this._picker.dispose();this._parallaxNode=[];this._gltfAnimator&&(this._gltfAnimator.dispose(),this._gltfAnimator=null);this._effectGr&&(this._effectGr.traverse(a=>
{this.disposeMeshes(a)}),this._container.remove(this._effectGr),this._effectGr=null);this._clipGr&&(this._clipGr.traverse(a=>{this.disposeMeshes(a)}),this._container.remove(this._clipGr),this._clipGr=null);this._gr&&(Notifier.unsubscribe(this,ImplicationCommand.SET_INJECTION_MAP),this._container.traverse(a=>{this.disposeMeshes(a)}),this._container.remove(this._gr),this._gr=null);this._container=this.currentEffectColor=this.clipScript=this.effectScript=null;this._envmaps=[]}disposeMeshes(a){if("Mesh"==
a.type&&(a.geometry&&a.geometry.dispose(),a=a.material)){null!=a.map&&a.map.dispose();null!=a.lightMap&&a.lightMap.dispose();null!=a.aoMap&&a.aoMap.dispose();null!=a.emissiveMap&&a.emissiveMap.dispose();null!=a.bumpMap&&a.bumpMap.dispose();null!=a.normalMap&&a.normalMap.dispose();null!=a.displacementMap&&a.displacementMap.dispose();null!=a.alphaMap&&a.alphaMap.dispose();null!=a.envMap&&a.envMap.dispose();null!=a.roughnessMap&&a.roughnessMap.dispose();null!=a.metalnessMap&&a.metalnessMap.dispose();
null!=a.glossinessMap&&a.glossinessMap.dispose();null!=a.specularMap&&a.specularMap.dispose();if(a instanceof Array){for(let e=0;e<a.length;++e)a[e].dispose(),a[e]=null;a=[]}a.dispose()}}}
class StereoSound extends THREE.PositionalAudio{constructor(){super(...arguments);this._isReady=!1}get isReady(){return this._isReady}seekTo(a){this.isPlaying?(this.stop(),this.offset=a,this.play()):this.offset=a}stop(){Device.isSafari()?this.isPlaying&&super.stop():super.stop();return this}initWithReadyBuffer(a){this.setVolume(0);this.setBuffer(a);this.setRefDistance(1);this._isReady=!0;this.isPlaying=!1;try{this.play(),this.autoplay||this.stop()}catch(e){console.warn(e)}}}
class Debug{constructor(){this.active=!1;if(Debug._inst)throw Error("This is a singleton");let a=location.search.match(/debug=(\w+)/);this.active=a&&"true"==a[1];let e=console.debug;console.debug=(...m)=>{this.active&&e.apply(console,m)};let h=console.error;console.error=(...m)=>{h.apply(console,m);alert(Localisation.inst.ERROR)}}static get inst(){return this._inst||(this._inst=new Debug)}activate(){this.active=!0}mobileLog(a){if(this.active){var e=new XMLHttpRequest,h="/debug?time="+Date.now();for(let m in a){let t=
a[m];"object"==typeof t&&(t=JSON.stringify(t));h+="&"+m+"="+t}e.open("GET",h);e.send()}}}
class DomMedia{constructor(a){this._loaded=this._loop=!1;this._hasEmptied=this._empty=!0;this.isPlaying=!1;this.finish=()=>{if(this._domElem){this._loaded=!0;this._hasEmptied&&(this._domElem.removeEventListener("loadedmetadata",this.finish,!1),this._domElem.removeEventListener("loadeddata",this.finish,!1),this._domElem.removeEventListener("canplay",this.finish,!1),this._domElem.removeEventListener("canplaythrough",this.finish,!1));try{this._domElem.currentTime&&(this._domElem.currentTime=.001)}catch(e){console.info(e)}this._loadedCallback&&
this._loadedCallback();this._loadedCallback=null}};this.tagFactory();this.set({data:a});this._domElem.setAttribute("crossorigin","anonymous");Device.isIE()||(this._domElem.setAttribute("playsinline","true"),this._domElem.setAttribute("webkit-playsinline","true"))}get isPersistent(){return this._data.persistent}get uuid(){return this._data.uuid}get name(){return this._data.paths[0].split("/").pop()}set(a){a.data&&(this._data=a.data)}play(a=!1){try{this._loop=a;let e=this._domElem.play();this.isPlaying=
!0;return e}catch(e){this.isPlaying=!1,window.console.log("error on play : "+e+" ( "+this._domElem.currentTime+" )")}return null}stop(){try{this._domElem.pause(),this._domElem.currentTime=.001,this.isPlaying=!1}catch(a){window.console.log("error on stop : "+a)}}pause(){try{this._domElem.pause(),this.isPlaying=!1}catch(a){window.console.log("error on pause : "+a)}}seekTo(a){this._domElem&&(this._domElem.currentTime=a)}dispose(){this._empty||(this.isPlaying&&this._domElem&&this.stop(),this.isPlaying=
this._loop=!1,this._loadedCallback=null)}unlock(a=null){if(this._domElem){this._domElem.volume=0;this._domElem.muted=!0;try{this.play(),this.stop(),a&&a(),this._domElem.volume=1,this._domElem.muted=!1}catch(e){window.console.log("error on unlock : "+e),a&&a()}}}empty(){if(this._domElem&&!(this._domElem.children&&this._domElem.children.length&&(new RegExp(this._data.paths[0])).test(this._domElem.children[0].src))){this._loaded&&this.seekTo(.001);for(var a=this._domElem.children.length;a--;){let e=
this._domElem.children[a];e.removeAttribute("src");e.removeAttribute("type");this._domElem.removeChild(e)}this._empty=!0;this._loaded=!1}}setOnLoadHandlers(){this._domElem.addEventListener("loadedmetadata",this.finish,!1);this._domElem.addEventListener("loadeddata",this.finish,!1);this._domElem.addEventListener("canplay",this.finish,!1);this._domElem.addEventListener("canplaythrough",this.finish,!1);this._domElem.load()}}
class DomAudio extends DomMedia{get dom(){return this._domElem}load(a){if(this._domElem){this._domElem&&!this._domElem.paused&&this.stop();this._loadedCallback=a;this.empty();this._domElem.id=this._data.paths[0];if(this._empty){let e=PathUtils.fullFolderPath(this._data);this._data.paths.forEach(h=>{let m=document.createElement("source");m.src=e+h;m.src.match(/(.*)mp3/)?m.type="audio/mp3":m.src.match(/(.*)ogg/)&&(m.type="audio/ogg");this._domElem.appendChild(m)});this._empty=!1}this.setOnLoadHandlers();
this._domElem.onended=()=>{this._loop&&this.isPlaying&&(this.isPlaying=!1,this.play())}}}tagFactory(){this._domElem=document.createElement("audio");document.getElementById("audios").appendChild(this._domElem)}}var VideoStreamType;(function(a){a.DASH="dash";a.HLS="hls"})(VideoStreamType||={});
class VideoScriptData extends AbstractScriptParser{constructor(){super(...arguments);this.bucket=this.videoFolder=""}static getFromName(a){return this.loopOnKeys(this.extractBaseCode(a,"video"),new VideoScriptData)}parseVal(a,e){if("bucket"==a)this.bucket=e;else if("folder"==a)this.videoFolder=e;else if("uri"==a)this.streamUri=e;else if("stream"==a)switch(e){case "hls":this.streamType=VideoStreamType.HLS;break;case "DASH":this.streamType=VideoStreamType.DASH}}}
class DomVideo extends DomMedia{constructor(a,e){super(a);this._skippedFrames=this._previousTime=0;this.set({name:e})}set(a){super.set(a);a.name&&(this._elementName=a.name)}get dom(){return this._domElem}get hasEnoughBuffer(){return this._domElem.readyState==HTMLMediaElement.HAVE_ENOUGH_DATA}set volume(a){this._domElem.volume=a}dispose(){super.dispose();this._hlsPlayer&&this._hlsPlayer.destroy();this._hlsPlayer=null}empty(){this._hlsPlayer&&this._hlsPlayer.destroy();this._hlsPlayer=null;super.empty()}play(a=
!1){var e;let h=null;try{return this._loop=a,this._skippedFrames=0,this.isPlaying=!0,h=null===(e=this._domElem.play())||void 0===e?void 0:e.catch(m=>{})}catch(m){this.isPlaying=!1,console.log(m)}return h}stop(){try{this.isPlaying=!1,this._domElem.pause(),this._domElem.currentTime=.001}catch(a){console.log(a)}}pause(){try{this.isPlaying=!1,this._domElem.pause()}catch(a){console.log(a)}}seekTo(a){this._domElem&&(this._domElem.currentTime=a)}load(a){console.info(this._elementName);if(this._domElem){this._domElem&&
!this._domElem.paused&&this.stop();this._loadedCallback=a;this._domElem.id=this._data.paths[0];this.empty();this._hasEmptied=this._empty;var e=PathUtils.fullFolderPath(this._data);this._data.paths[0].split("/").slice(-1).join().split(".").shift();var h;a=0;if(this._empty){this._elementName&&(h=VideoScriptData.getFromName(this._elementName))&&(h.bucket?e="https://"+h.bucket:h.videoFolder&&(e=h.videoFolder.replace(/\.\/(.*)\//i,"./$1/")),h.streamType&&(this.streamType=h.streamType,this.streamUri=h.streamUri));
if(this.streamType&&this.streamUri)this.streamType==VideoStreamType.HLS&&(h=document.createElement("source"),e+=this.streamUri,h.setAttribute("src",e),this._domElem.appendChild(h),this._domElem.canPlayType("application/vnd.apple.mpegurl")?this._domElem.src=e:(this._hlsPlayer=new Hls,this._hlsPlayer.loadSource(e),this._hlsPlayer.attachMedia(this._domElem)));else{if(window.WEBM_COMPRESSED){h=document.createElement("source");h.setAttribute("type","video/webm");let m=this._data.paths[0].substr(0,this._data.paths[0].lastIndexOf("."))+
".webm";h.setAttribute("src",e+m);this._domElem.appendChild(h)}h=document.createElement("source");h.setAttribute("type","video/mp4");h.setAttribute("src",e+this._data.paths[0]);this._domElem.appendChild(h)}this._empty=!1}else++a;this.streamType||(this._hasEmptied?this.setOnLoadHandlers():++a);(this.streamType||2==a)&&setTimeout(()=>this.finish(),100)}}tagFactory(){this._domElem=document.createElement("video");document.getElementById("videos").appendChild(this._domElem);this._domElem.style.setProperty("width",
"100%")}}
class MediaTagsManager extends Notifiable{constructor(){super();this._videoControllers=new TidyDictionary;this._audioControllers=new TidyDictionary;this._tmpVideoControllers=new MessyDictionary;this._tmpAudioControllers=new MessyDictionary;this._loaded=this._currentSceneAudioCount=this._currentSceneVideoCount=0;this.unlocked=!1;if(null!=MediaTagsManager._inst)throw Error("MediaTagsManager is a singleton");Notifier.subscribe(this,InitCommand.DATA_LOADED);Notifier.subscribe(this,SceneCommand.LOAD_START);Notifier.subscribe(this,
SceneCommand.FIRST_FRAME);Notifier.subscribe(this,SceneCommand.VIDEO_HAS_FRAMES)}static get inst(){return this._inst||(this._inst=new MediaTagsManager)}notify(a,e){a==SceneCommand.LOAD_START?(this.stopAll(),this.resetTagsAndLoadNext()):a==InitCommand.DATA_LOADED?(Notifier.unsubscribe(this,a),this.firstLoad()):a==SceneCommand.VIDEO_HAS_FRAMES?(--this._currentSceneVideoCount,this._currentSceneVideoCount||Notifier.unleash(SceneCommand.ALL_VIDEOS_HAVE_FRAMES)):a==SceneCommand.FIRST_FRAME&&(this._currentSceneVideoCount||
Notifier.unleash(SceneCommand.ALL_VIDEOS_HAVE_FRAMES))}testAudioContext(){this._hasContext=Device.canUseWebAudio()}initContext(){this._hasContext&&(this.context=new (window.AudioContext||window.webkitAudioContext))}firstLoad(){this._loadEndCallback=()=>{Notifier.unleash(InitCommand.MEDIA_TAGS_READY)};this.testAudioContext();let a=Config.simulationData,e=a.maxVideoCount,h=a.maxSoundCount;for(let m=0;m<a.scenes.length&&!(this._videoControllers.length>=e&&this._audioControllers.length>=h);++m){let t=
a.scenes[m];if(t.media&&this._videoControllers.length<e){const y=a.media[t.media];y&&PathUtils.stringIsVideo(y.paths[0])&&this.createVideoController(y,t.name)}t.elements.length&&GroupDataUtils.forEachElementsWithAspectsRecursive(t.elements,y=>{if(y.type==StatefulElementType.VIDEO)for(var C=0;C<y.aspects.length;++C){var I=y.aspects[C];I.media&&this._videoControllers.length<e&&this.createVideoController(a.media[I.media],I.name)}else if(y.type==StatefulElementType.SOUND&&!this._hasContext)for(C=0;C<
y.aspects.length;++C)I=y.aspects[C],I.media&&this._audioControllers.length<h&&this.createSoundController(a.media[I.media])})}if(!this._currentSceneVideoCount&&!this._currentSceneAudioCount)return this.loadEnd();this.loadQueuedAudio();this.loadQueuedVideos()}loadQueuedAudio(){const a=this._currentSceneAudioCount+this._currentSceneVideoCount;let e=0;this._tmpAudioControllers.length&&(this._tmpAudioControllers.traverse((h,m)=>{this._audioControllers.unshift(m,h)}),this._tmpAudioControllers.empty());
this._audioControllers.traverse(h=>{if(e++==this._currentSceneAudioCount)return!0;h.load(()=>{this._loaded++;LoadProgressManager.inst.update(0);this._loaded>=a&&this.loadEnd()})},!0)}loadQueuedVideos(){this._tmpVideoControllers.length&&(this._tmpVideoControllers.traverse((h,m)=>{this._videoControllers.unshift(m,h)}),this._tmpVideoControllers.empty());this._videoQueue=new Queue;let a=0,e=this._currentSceneVideoCount;for(;a<e;)this._videoQueue.push(this._videoControllers.slice(a,a+=Math.min(5,Math.abs(e-
a))));this._currentSubQueueLoaded=0;this.treatCurrentVideoSubQueue()}treatCurrentVideoSubQueue(){this._videoQueue.hasItem?this._videoQueue.current.forEach(a=>{a.load(()=>{this.videoLoadEndCallback()})}):this._loaded>=this._currentSceneVideoCount+this._currentSceneAudioCount&&(this._videoQueue.empty(),this.loadEnd())}videoLoadEndCallback(){LoadProgressManager.inst.update(0);this._currentSubQueueLoaded++;this._loaded++;this._currentSubQueueLoaded>=this._videoQueue.current.length&&(this._currentSubQueueLoaded=
0,setTimeout(()=>{this._videoQueue.move();this.treatCurrentVideoSubQueue()},100))}loadEnd(){this._videoQueue=this._tmpVideoControllers=this._tmpAudioControllers=null;this._loadEndCallback&&(this._loadEndCallback(),this._loadEndCallback=null)}createVideoController(a,e=""){this._videoControllers.has(a.uuid)||(this._videoControllers.push(a.uuid,new DomVideo(a,e)),++this._currentSceneVideoCount)}createSoundController(a){this._audioControllers.has(a.uuid)||(this._audioControllers.push(a.uuid,new DomAudio(a)),
++this._currentSceneAudioCount)}updateVideoController(a,e=""){if(a&&!this._tmpVideoControllers.has(a.uuid)){++this._currentSceneVideoCount;var h;(h=this._videoControllers.get(a.uuid))?this._videoControllers.remove(a.uuid):(Config.simulationData.header.persistentSceneUUID?(this._videoControllers.reverseTraverse(m=>{if(!m.isPersistent)return h=m,!0},!0),this._videoControllers.remove(h.uuid)):h=this._videoControllers.pop(),h.set({data:a,name:e}));this._tmpVideoControllers.add(a.uuid,h)}}updateSoundController(a,
e){if(e&&a&&!this._tmpAudioControllers.has(e)){++this._currentSceneAudioCount;var h;(h=this._audioControllers.get(e))?this._audioControllers.remove(e):(Config.simulationData.header.persistentSceneUUID?this._audioControllers.reverseTraverse(m=>{if(!m.isPersistent)return h=m,!0},!0):h=this._audioControllers.pop(),h.set({data:a}));this._tmpAudioControllers.add(e,h)}}resetTagsAndLoadNext(){this._loadEndCallback=()=>{Notifier.unleash(SceneCommand.MEDIA_TAGS_RESET)};this._tmpVideoControllers=new MessyDictionary;
this._tmpAudioControllers=new MessyDictionary;this._currentSceneAudioCount=this._currentSceneVideoCount=this._loaded=0;let a=Config.currentScene;if(a.media){const e=Config.simulationData.media[a.media];e&&PathUtils.stringIsVideo(e.paths[0])&&this.updateVideoController(e,a.name)}a.elements&&GroupDataUtils.forEachElementsWithAspectsRecursive(a.elements,e=>{if(e.type==StatefulElementType.VIDEO&&e.aspects)for(var h=0;h<e.aspects.length;++h){var m=e.aspects[h];m.media&&this.updateVideoController(Config.simulationData.media[m.media],
"")}else if(e.type==StatefulElementType.SOUND&&!this._hasContext&&e.aspects)for(h=0;h<e.aspects.length;++h)m=e.aspects[h],m.media&&this.updateSoundController(Config.simulationData.media[m.media],m.media)});LoadProgressManager.inst.addLength(this._currentSceneAudioCount+this._currentSceneVideoCount);this._currentSceneAudioCount&&this.loadQueuedAudio();this._currentSceneVideoCount&&this.loadQueuedVideos();this._currentSceneVideoCount||this._currentSceneAudioCount||this.loadEnd()}stopAll(){this._audioControllers.traverse(a=>
{a.isPersistent||a.stop()});Config.assets.audioElements.empty()}activateAll(){this._hasContext&&(this.initContext(),this.context.resume());Notifier.unleash(InitCommand.UNLOCK,this._hasContext);if(Device.isMobile()||Device.isSafari())this._audioControllers.traverse(a=>{try{a.unlock()}catch(e){console.warn(e)}}),this._videoControllers.traverse(a=>{try{a.unlock()}catch(e){console.warn(e)}});this.unlocked=!0;Notifier.unleash(InitCommand.UNLOCK_FINISHED)}getVideo(a){return this._videoControllers.get(a)}getSound(a){return this._audioControllers.get(a)}}
class AudioAspect extends AbstractAspect{constructor(a){super(a);this._notified=this._generationFinished=this._needAPlayAfterUnlock=!1;this._volume=this._lastStart=0;Notifier.subscribe(this,InitCommand.UNLOCK_FINISHED);Notifier.subscribe(this,SceneCommand.GENERATION_FINISHED)}notify(a,e){a==ViewportCommand.UPDATE?!this._loop&&!this._notified&&this.currentTime>=this.duration&&(Notifier.unsubscribe(this,ViewportCommand.UPDATE),this._notified=!0,this.ipSound?this.ipSound.stop():this._domAudio&&this._domAudio.stop(),
this.callEndCallback()):a==SceneCommand.GENERATION_FINISHED?this._generationFinished=!0:a==InitCommand.UNLOCK_FINISHED&&this._needAPlayAfterUnlock&&(this._needAPlayAfterUnlock=!1,this.play())}get isPlaying(){if(this.ipSound)return this.ipSound.isPlaying;if(this._domAudio)return this._domAudio.isPlaying}get currentTime(){if(this.ipSound)return this.ipSound.context.currentTime-this._lastStart;if(this._domAudio)return this._domAudio.dom.currentTime}get duration(){return this.ipSound&&this.ipSound.source&&
this.ipSound.source.buffer?this.ipSound.source.buffer.duration:this._domAudio?this._domAudio.dom.duration:this.ipSound&&this.ipSound.buffer?this.ipSound.buffer.duration:0}play(){var a;0==MediaTagsManager.inst.unlocked?this._needAPlayAfterUnlock=!0:!this.isPlaying&&this._generationFinished&&(this._loop||Notifier.subscribe(this,ViewportCommand.UPDATE),(null===(a=this.ipSound)||void 0===a?0:a.isReady)?(this._lastStart=this.ipSound.context.currentTime,this.ipSound.play()):this._domAudio&&this._domAudio.play())}pause(){0==
MediaTagsManager.inst.unlocked&&1==this._needAPlayAfterUnlock?this._needAPlayAfterUnlock=!1:(Notifier.unsubscribe(this,ViewportCommand.UPDATE),this.isPlaying&&(this.ipSound&&this.ipSound.pause(),this._domAudio&&this._domAudio.pause()))}stop(){0==MediaTagsManager.inst.unlocked&&1==this._needAPlayAfterUnlock?this._needAPlayAfterUnlock=!1:(Notifier.unsubscribe(this,ViewportCommand.UPDATE),this.ipSound&&this.ipSound.stop(),this._domAudio&&this._domAudio.stop())}setLoop(a){this._loop=a;this.ipSound&&this.ipSound.setLoop(a);
this._domAudio&&(this._domAudio.dom.loop=a)}create(){const a=Config.simulationData.media[this.data.media];Device.hasActiveWebAudio()?(this.ipSound=new StereoSound(View3D.inst.audioListener),a.paths[0]&&(this.ipSound.initWithReadyBuffer(Config.assets.audioElements.get(this.data.media)),this._volume=this.data.volume?this.data.volume:.99,this.ipSound.onEnded=()=>{this.ipSound&&(this.ipSound.isPlaying=!1,0==this._loop&&0==this._notified&&(this.ipSound.stop(),this._notified=!0,this.callEndCallback()))},
this._container.add(this.ipSound))):a&&a.paths[0]&&(this._domAudio=MediaTagsManager.inst.getSound(this.data.media),this._domAudio.dom.onended=()=>{this.currentTime>=this.duration&&0==this._loop&&0==this._notified&&(isNaN(this._domAudio.dom.duration)||(this._domAudio.dom.currentTime=0),this._domAudio.stop(),this._notified=!0,this.callEndCallback())})}callEndCallback(){this.endCallback&&this.endCallback()}dispose(){super.dispose();this.endCallback=null;this.stop();Notifier.unsubscribe(this,InitCommand.UNLOCK_FINISHED);
Notifier.unsubscribe(this,SceneCommand.GENERATION_FINISHED);this._domAudio&&(this._domAudio.dom.onended=null,this._domAudio.dispose(),this._domAudio=null);this.ipSound&&(this.ipSound.onEnded=null,this.ipSound.disconnect(),this.ipSound.autoplay=!1,this.ipSound.setBuffer(null),this.ipSound.context=null,this._container.remove(this.ipSound),this.ipSound=null);this._container=null}seekTo(a){this.ipSound?this.ipSound.seekTo(a):this._domAudio.seekTo(a)}setVolume(a){a=Math.max(0,Math.min(1,a*this.data.volume));
this.ipSound&&View3D.inst.audioListener&&View3D.inst.audioListener.context?this.ipSound.setVolume(a):this._domAudio&&(this._domAudio.dom.volume=a)}setPlayback(a){this._notified=!1;switch(a){case StatePlaybackType.PAUSE:this.pause();break;case StatePlaybackType.STOP:this.stop();break;case StatePlaybackType.PLAY:this.setLoop(!1);this.play();break;case StatePlaybackType.PLAY_LOOP:this.setLoop(!0),this.play()}}}
class VideoCanvasTexture extends CanvasTexture{constructor(a){super(a.id);this._targetHeight=this._targetWidth=0;this._texture.format=THREE.RGBFormat;this._videoDom=a;a=Device.isIOS()?Math.min(1,3072/this._videoDom.videoWidth):1;this._targetWidth=this._videoDom.videoWidth*a;this._targetHeight=this._videoDom.videoHeight*a;this._canvas.width=this._targetWidth;this._canvas.height=this._targetHeight}_draw(){this._2dContext.drawImage(this._videoDom,0,0,this._targetWidth,this._targetHeight)}dispose(){super.dispose();
this._videoDom=null}}
class VideoRenderer{constructor(a){this._canvasTextureRef=null;this._useCanvasTexture=Device.isIE();this._needsAPlayAfterUnlock=this._notified=this._wasPlayingBeforeBuffering=this._isPlaying=this._seeking=this._buffering=!1;this._frameCheckIntervalId=0;this.uuid=a}notify(a,e){a==ViewportCommand.UPDATE?(this.needsUpdate=this.ticker(),this._onEndHandler()):a==MediaLagCommand.SEEK&&e.id==this._mediaControllerId?this.seekTo(e.progress*this.duration*.01):a==InitCommand.UNLOCK_FINISHED?(Notifier.unsubscribe(this,
a),this._needsAPlayAfterUnlock&&this.play()):a==SceneCommand.ALL_VIDEOS_HAVE_FRAMES&&(Notifier.unsubscribe(this,a),this._frameCheckIntervalId&&(window.clearInterval(this._frameCheckIntervalId),this._frameCheckIntervalId=0))}setLoop(a){this._loop=a;this._domVideo.dom.loop=a}seekTo(a){this._seeking=!0;this._domVideo.seekTo(Math.round(a))}setVolume(a){this._domVideo.volume=Math.max(0,Math.min(1,this._volumeMaths(a)))}_volumeMaths(a){return a}set needsUpdate(a){this._canvasTextureRef?this._canvasTextureRef.update(a):
this._texture.needsUpdate=a}bindController(a){this._mediaControllerId=a;Notifier.subscribe(this,MediaLagCommand.SEEK)}setPlayback(a){switch(a){case StatePlaybackType.PAUSE:this.pause();break;case StatePlaybackType.STOP:this.stop();break;case StatePlaybackType.PLAY:this.setLoop(!1);this.play();break;case StatePlaybackType.PLAY_LOOP:this.setLoop(!0),this.play()}}play(a){a&&(this._wasPlayingBeforeBuffering=!0);this._notified=!1;MediaTagsManager.inst.unlocked?(this._seeking=this._needsAPlayAfterUnlock=
!1,this._isPlaying||(Notifier.subscribe(this,ViewportCommand.UPDATE),this._domVideo.play(),this._isPlaying=!0)):this._needsAPlayAfterUnlock=!0}pause(a){a&&(this._wasPlayingBeforeBuffering=!1);MediaTagsManager.inst.unlocked?(this._buffering||Notifier.unsubscribe(this,ViewportCommand.UPDATE),this.needsUpdate=!0,this._isPlaying?(this._isPlaying=!1,this._domVideo.pause()):0==this.currentTime&&this._domVideo.stop()):this._needsAPlayAfterUnlock=!1}stop(a){a&&(this._wasPlayingBeforeBuffering=!1);MediaTagsManager.inst.unlocked?
(Notifier.unsubscribe(this,ViewportCommand.UPDATE),this._domVideo&&(this._isPlaying=!1,this._domVideo.stop(),this.needsUpdate=!0,this._mediaControllerId&&Notifier.unleash(TimeCommand.PROGRESS,{id:this._mediaControllerId,progress:0}))):this._needsAPlayAfterUnlock=!1}create(){if(this._domVideo=MediaTagsManager.inst.getVideo(this.uuid))this._useCanvasTexture?(this._canvasTextureRef=new VideoCanvasTexture(this._domVideo.dom),this._texture=this._canvasTextureRef.texture):this._texture=new THREE.VideoTexture(this._domVideo.dom),
this._setTextureSettings(),this._frameCheckIntervalId=window.setInterval(()=>{this._domVideo.dom.readyState>HTMLMediaElement.HAVE_METADATA&&(window.clearInterval(this._frameCheckIntervalId),this._frameCheckIntervalId=0,Notifier.unleash(SceneCommand.VIDEO_HAS_FRAMES))},50),Notifier.subscribe(this,SceneCommand.ALL_VIDEOS_HAVE_FRAMES),this._domVideo.dom.onended=()=>{this._onEndHandler()},this._domVideo.dom.onseeked=()=>{this.needsUpdate=!0},this.needsUpdate=!Device.isSafari(),MediaTagsManager.inst.unlocked||
Notifier.subscribe(this,InitCommand.UNLOCK_FINISHED)}_onEndHandler(){!this._loop&&this.currentTime>=this.duration&&(this._isPlaying=!1,this._domVideo.dom.currentTime=.001,this.needsUpdate=!0,this._notified||(Notifier.unsubscribe(this,ViewportCommand.UPDATE),this.endCallback&&this.endCallback()),this._notified=!0)}_setTextureSettings(){this._texture.generateMipmaps=!1;this._texture.minFilter=THREE.LinearFilter;this._texture.magFilter=THREE.LinearFilter}dispose(){this._mediaControllerId&&Notifier.unsubscribe(this,
MediaLagCommand.SEEK);this._disposeObjects();this._nullObjects()}_disposeObjects(){this.stop();this._canvasTextureRef&&this._canvasTextureRef.dispose();this.needsUpdate=!1;this._texture.dispose();this._domVideo&&(this._domVideo.dom.onended=null,this._domVideo.dom.onseeked=null,this._domVideo.dispose())}_nullObjects(){this._texture=this._domVideo=this._canvasTextureRef=this.endCallback=null}get currentTime(){return this._domVideo.dom.currentTime}get duration(){return this._domVideo.dom.duration}ticker(){if(!(this._isPlaying||
this._buffering||this._seeking))return!1;if(this._domVideo.hasEnoughBuffer)return this._buffering&&(this._buffering=!1,this._wasPlayingBeforeBuffering&&this._resumePlaybackFromTicker()),this._mediaControllerId&&Notifier.unleash(TimeCommand.PROGRESS,{id:this._mediaControllerId,progress:this.currentTime/this.duration}),!0;this._buffering||(this._buffering=!0,this._wasPlayingBeforeBuffering=this._isPlaying,this._pausePlaybackFromTicker());return!1}}
class FlatVideoRenderer extends VideoRenderer{constructor(a){super(a.media);this._createMeshElement=()=>{let e;(e=AspectFactory.chromaTexture(this._texture,this.data))?(e.transparent=!0,e.alphaTest=this.data.opacity):e=new THREE.MeshBasicMaterial({map:this._texture,blending:THREE.NormalBlending,side:THREE.DoubleSide,transparent:!0});var h=Device.getMaxResolutionDivisor();h=Device.projectedSizeForMaxResolution(this._domVideo.dom.videoWidth/h,this._domVideo.dom.videoHeight/h);h=new THREE.PlaneGeometry(h.x,
h.y);this.mesh=new THREE.Mesh(h,e);this.mesh.material.side=THREE.DoubleSide;this.needsUpdate=!0;this.mesh.renderOrder=Config.RENDER_ORDER_OPAQUE++};this.data=a}get created(){return!!this._domVideo}create(){this._useCanvasTexture||(this._useCanvasTexture=Device.isFirefox());super.create();this.created&&this._createMeshElement()}setPlayback(a){this.mesh&&(this.mesh.material.needsUpdate=!0);super.setPlayback(a)}_disposeObjects(){super._disposeObjects();this.mesh.geometry.dispose();let a=this.mesh.material,
e=a.map;e&&e.dispose();a.dispose()}_nullObjects(){this.mesh=null;super._nullObjects()}_volumeMaths(a){return a*this.data.volume}_resumePlaybackFromTicker(){this.play()}_pausePlaybackFromTicker(){this.pause();this._domVideo.dom.currentTime+=.01}}
class VideoAspect extends AbstractAspect{constructor(a){super(a);this.renderer=new FlatVideoRenderer(a)}get size(){let a=this.renderer.mesh.geometry;return new THREE.Vector2(a.parameters.width/19.2,a.parameters.height/10.8)}set endCallback(a){this.renderer.endCallback=a}create(){this.renderer.create();this.renderer.created&&(this.renderer.mesh?this._container.add(this.renderer.mesh):setTimeout(()=>{this._container.add(this.renderer.mesh)},150))}bindParent(a){this.renderer.bindController(a)}dispose(){super.dispose();
this.renderer.created&&this._container.remove(this.renderer.mesh);this.renderer.dispose();this._container=null}setPlayback(a){this.renderer.setPlayback(a)}setVolume(a){this.renderer.setVolume(a)}seekTo(a){this.renderer.seekTo(a)}}
class TextureAnimator{constructor(a,e,h=null,m=null){this._isReversed=this._isPlayingOnce=this._isPlaying=this._loopAndReverse=!1;this._target=a;this._currentTile=0;this._materialWidth=e;this._slideshow=h;this._slideshowMaterial=m}dispose(){this._isPlaying&&this.clear();this._target&&(this._target.dispose(),this._target=null);this._deferredCallback=null}get currentFrame(){return this._currentTile}set currentFrame(a){this._currentTile=a;this._target.offset.x=this._currentTile*this._tileWidth/this._materialWidth}isReversed(){return this._isReversed}isPlaying(){return this._isPlaying}setUp(a,
e,h=!1){let m=!1;this._isPlaying&&(m=!0,this.pause());this._loopAndReverse=h;this._numTile=a;this._tileWidth=this._materialWidth/this._numTile;this._duration=e;m&&this.resume()}setNumTile(a){let e=!1;this._isPlaying&&(e=!0,this.pause());this._numTile=a;this._tileWidth=this._materialWidth/this._numTile;e&&this.resume()}setDuration(a){let e=!1;this._isPlaying&&(e=!0,this.pause());this._duration=a;e&&this.resume()}start(a=!1,e){this._isPlayingOnce=a;this._deferredCallback=e;this._currentTile=0;this.clear();
this._currentInterval=window.setInterval(()=>{this._slideshow?(this._slideshowInTween||(this._slideshowInTween=new TWEEN.Tween(this._slideshowMaterial),this._slideshowMaterial.transparent=!0),this._slideshowInTween.to({opacity:.01},300).easing(TWEEN.Easing.Quadratic.In).delay(this._slideshow.delay).onUpdate(()=>{this._slideshowMaterial.needsUpdate=!0}).onComplete(()=>{this.update()}).start()):this.update()},this._duration);this._isPlaying=!0}resume(){this.start(this._isPlayingOnce)}pause(){this.clear()}stop(a){a&&
(this._currentTile=a);this._isReversed=!1;this._target.offset.x=this._currentTile*this._tileWidth/this._materialWidth;this.clear()}toEnd(){this.stop(this._numTile-1)}clear(){this._currentInterval&&(clearInterval(this._currentInterval),this._currentInterval=null);this._isPlaying=!1}update(){let a=!1;0==this._loopAndReverse?(this._currentTile++,this._currentTile==this._numTile&&this._isPlayingOnce?(this._isPlayingOnce=!1,a=!0):this._currentTile==this._numTile&&(this._currentTile=0)):(this._currentTile+=
1==this._isReversed?-1:1,0>=this._currentTile?(this._isReversed=!this._isReversed,this._isPlayingOnce&&(this._isPlayingOnce=!1,a=!0)):this._currentTile>=this._numTile-1&&(this._isReversed=!this._isReversed,this._isPlayingOnce&&(this._isPlayingOnce=!1,a=!0)));this.currentFrame=this._currentTile;this._slideshow&&(this._slideshowOutTween||(this._slideshowOutTween=new TWEEN.Tween(this._slideshowMaterial),this._slideshowMaterial.transparent=!0),this._slideshowOutTween.to({opacity:1},300).easing(TWEEN.Easing.Quadratic.Out).onUpdate(()=>
{this._slideshowMaterial.needsUpdate=!0}).start());1==a&&(this.clear(),this._deferredCallback&&this._deferredCallback(!this._isReversed))}}class SlideshowScriptData extends AbstractScriptParser{constructor(){super(...arguments);this.delay=0}static getFromName(a){return(a=this.loopOnKeys(this.extractBaseCode(a,"slideshow"),new SlideshowScriptData))&&null!=a.delay?a:null}parseVal(a,e){"delay"==a&&(this.delay=parseFloat(e))}}
class SpritesheetScriptData extends AbstractScriptParser{constructor(){super(...arguments);this.frame=null}static getFromName(a){return this.loopOnKeys(this.extractBaseCode(a,"sprite"),new SpritesheetScriptData)}parseVal(a,e){if("frame"==a||"f"==a)this.frame=parseInt(e)}}
class AssetAspect extends AbstractAspect{notify(a,e){var h;super.notify(a,e);a==ImplicationCommand.SET_INJECTION_MAP&&(null===(h=this._injectionScript)||void 0===h?void 0:h.value)==e&&(this.mesh.geometry.dispose(),null!=this.mesh.material.map&&this.mesh.material.map.dispose(),a=this._injectionScript.texture,this.mesh.geometry=new THREE.PlaneBufferGeometry(a.width,a.height),this.planeMaterial.map=a,this.planeMaterial.map.needsUpdate=!0,this.planeMaterial.needsUpdate=!0)}create(a){let e;(this._injectionScript=
InjectionScriptData.getFromName(this.data.name))?(e=this._injectionScript.texture,this._injectionScript.keepUpdate&&Notifier.subscribe(this,ImplicationCommand.SET_INJECTION_MAP)):a?e=a:this.data.media&&Config.assets.assetElements.has(this.data.media)&&(e=1<this.data.numTile?Config.assets.assetElements.get(this.data.media).clone():Config.assets.assetElements.get(this.data.media));e&&!(this.planeMaterial=AspectFactory.chromaTexture(e,this.data))&&(this.planeMaterial=new THREE.MeshBasicMaterial({map:e,
blending:THREE.CustomBlending,side:THREE.DoubleSide}));if(this.planeMaterial){this.planeMaterial.transparent=!0;this.planeMaterial.opacity=this.data.opacity;this.planeMaterial.needsUpdate=!0;this._usesPng=this.planeMaterial.map.format==THREE.RGBAFormat;this.planeMaterial.map&&(this.planeMaterial.map.needsUpdate=!0);if(this._injectionScript)var h=new THREE.Vector2(e.width,e.height);else this.planeMaterial.map&&(h=Config.simulationData.media[this.data.media],h=Device.projectedSize(h.resolution,this.planeMaterial.map.image.naturalWidth/
(this.planeMaterial.map.image.naturalWidth*h.scale.x/this.planeMaterial.map.image.naturalWidth)/this.data.numTile,this.planeMaterial.map.image.naturalHeight/(this.planeMaterial.map.image.naturalHeight*h.scale.y/this.planeMaterial.map.image.naturalHeight)),1<this.data.numTile?(this.planeMaterial.map.wrapS=this.planeMaterial.map.wrapT=THREE.RepeatWrapping,this.planeMaterial.map.repeat.x=this.planeMaterial.map.image.naturalWidth/this.data.numTile/this.planeMaterial.map.image.naturalWidth,a=SlideshowScriptData.getFromName(this.data.name),
this._textureAnimator=new TextureAnimator(this.planeMaterial.map,this.planeMaterial.map.image.naturalWidth,a,a?this.planeMaterial:null),this._textureAnimator.setUp(this.data.numTile,this.data.tileDuration),a=SpritesheetScriptData.getFromName(this.data.name),this._textureAnimator.currentFrame=a&&a.frame?a.frame:0):(this.planeMaterial.map.wrapS=this.planeMaterial.map.wrapT=THREE.ClampToEdgeWrapping,this.planeMaterial.map.repeat.x=1,this.planeMaterial.map.offset.x=0),this.planeMaterial.map.repeat.y=
1);null==h&&(h=new THREE.Vector2(2,2));this.mesh=new THREE.Mesh(new THREE.PlaneBufferGeometry(h.x,h.y),this.planeMaterial);this.mesh.renderOrder=Config.RENDER_ORDER_TRANSPARENT++;this._container.add(this.mesh)}}dispose(){super.dispose();Notifier.unsubscribe(this,ImplicationCommand.SET_INJECTION_MAP);this.mesh?(this._container.remove(this.mesh),this.mesh.geometry.dispose(),null!=this.mesh.material.map&&this.mesh.material.map.dispose(),this.mesh.material.dispose(),this.mesh.material=null,this._textureAnimator&&
(this._textureAnimator.dispose(),this._textureAnimator=null),this.planeMaterial=this._container=this.mesh=null):this._container=null}updateSizeRatio(a){this.mesh&&(this.mesh.scale.setX(a.x),this.mesh.scale.setY(a.y))}setVolume(a){}seekTo(a){}setPlayback(a){if(null!=this._textureAnimator)switch(a){case StatePlaybackType.PAUSE:this._textureAnimator.pause();break;case StatePlaybackType.STOP:this._textureAnimator.stop(0);break;case StatePlaybackType.PLAY:this._textureAnimator.start(!0,this.endCallback);
break;case StatePlaybackType.PLAY_LOOP:this._textureAnimator.start(!1,null)}}_setOpacity(a){this._usesPng&&(this.planeMaterial.alphaTest=Math.min(a-1E-5,Config.ALPHA_TEST));super._setOpacity(a,this._usesPng)}}
class TriggerAspect extends AbstractAspect{create(){let a=new THREE.Color(this.data.color);this._geom=this.data.isCircle?new THREE.SphereBufferGeometry(.5,32,16):new THREE.BoxBufferGeometry(1,1,1);let e=this._geom.attributes.position.count,h=new THREE.BufferAttribute(new Float32Array(3*e),3);this._geom.attributes.color=h;for(let m=0;m<e;m++)h.setXYZ(m,a.r,a.g,a.b);this._material=new THREE.MeshBasicMaterial({transparent:!0,opacity:0});this._mesh=new THREE.Mesh(this._geom,this._material);this._container.add(this._mesh)}elementOpacityChange(a){}dispose(){super.dispose();
View3D.inst.renderingController.deselectInOutlinePass(this._container);this._geom.dispose();this._geom=null;null!=this._material.map&&this._material.map.dispose();this._material.dispose();this._material=null;this._container.remove(this._mesh);this._container=this._mesh=null}}
class TimelineAspect extends AbstractAspect{constructor(a){super(a);this._barWidth=this.data.barSize.x;this._cursorStartX=.5*-this._barWidth;this._widthScaleFactor=1}clicked(a){a=this._barMesh.worldToLocal(a).x*this._widthScaleFactor;this._cursorMesh.position.setX(a);Notifier.unleash(MediaLagCommand.SEEK,{id:this._mediaControllerId,progress:100*(a-this._cursorStartX)/this._barWidth})}notify(a,e){a==TimeCommand.PROGRESS&&e.id==this._mediaControllerId?this._updateCursor(e.progress):super.notify(a,e)}_updateCursor(a){this._cursorMesh.position.setX(a*
this._barWidth+this._cursorStartX)}create(){this._barMaterial=this._createBaseMaterial(this.data.color);this._cursorMaterial=this._createBaseMaterial(this.data.cursorColor);this._barMesh=new THREE.Mesh(new THREE.PlaneBufferGeometry(this.data.barSize.x,this.data.barSize.y),this._barMaterial);this._cursorMesh=new THREE.Mesh(new THREE.PlaneBufferGeometry(this.data.cursorSize.x,this.data.cursorSize.y),this._cursorMaterial);this._cursorMesh.position.x=this._cursorStartX;this._cursorMesh.position.z=.1;
this._container.add(this._barMesh);this._container.add(this._cursorMesh)}bindParent(a){this._mediaControllerId=a;Notifier.subscribe(this,TimeCommand.PROGRESS)}updateSizeRatio(a){this._widthScaleFactor=a.x;this._barWidth=this.data.barSize.x*a.x;this._cursorStartX=.5*-this._barWidth;this._cursorMesh.position.x=this._cursorStartX;this._barMesh.scale.setX(a.x);this._barMesh.scale.setY(a.y);this._cursorMesh.scale.setX(a.x);this._cursorMesh.scale.setY(a.y)}dispose(){super.dispose();this._mediaControllerId&&
Notifier.unsubscribe(this,TimeCommand.PROGRESS);this._container.remove(this._barMesh);this._container.remove(this._cursorMesh);this._barMesh.geometry.dispose();this._cursorMesh.geometry.dispose();this._barMaterial.dispose();this._cursorMaterial.dispose();this._container=this._cursorMesh=this._barMesh=this._cursorMaterial=this._barMaterial=null}_createBaseMaterial(a){a=new THREE.MeshBasicMaterial({color:new THREE.Color(a),premultipliedAlpha:!0,side:THREE.DoubleSide,transparent:!0,alphaTest:Config.ALPHA_TEST,
opacity:this.data.opacity});a.needsUpdate=!0;return a}}
class ColorAspect extends AbstractAspect{create(){this._material=new THREE.MeshBasicMaterial({color:new THREE.Color(this.data.color),premultipliedAlpha:!0,side:THREE.DoubleSide,transparent:!0,alphaTest:Config.ALPHA_TEST,opacity:this.data.opacity});this._material.needsUpdate=!0;let a;ShapeType.RECTANGLE==this.data.shape&&(a=new THREE.PlaneBufferGeometry(this.data.width,this.data.height));this._mesh=new THREE.Mesh(a,this._material);this._container.add(this._mesh)}dispose(){super.dispose();this._container.remove(this._mesh);
this._mesh.geometry.dispose();this._material.dispose();this._container=this._mesh=this._material=null}}
class TextAspect extends AbstractAspect{constructor(){super(...arguments);this._variables={}}notify(a,e){super.notify(a,e);if(a==StatefulCommand.VARIABLE_CHANGED)for(let h in this._variables)if(this._variables[h].uuid in e){this._updateVars();break}}create(){this._canvasTexture=new TextCanvasTexture(this.data);this._initVars();this._texture=this._canvasTexture.texture;let a=new THREE.MeshBasicMaterial({map:this._texture,blending:THREE.CustomBlending,side:THREE.DoubleSide,transparent:!0,alphaTest:Config.ALPHA_TEST}),
e=new THREE.PlaneGeometry(1,1);this._mesh=new THREE.Mesh(e,a);this._mesh.renderOrder=Config.RENDER_ORDER_TRANSPARENT++;this._canvasTexture.update(!0);this._container.add(this._mesh);Object.keys(this._variables).length?(this._updateVars(),Notifier.subscribe(this,StatefulCommand.VARIABLE_CHANGED)):this._setText(this.data.text)}dispose(){super.dispose();Notifier.unsubscribe(this,StatefulCommand.VARIABLE_CHANGED);this._container.remove(this._mesh);this._canvasTexture.dispose();this._texture.needsUpdate=
!1;this._texture.dispose();this._mesh.geometry.dispose();let a=this._mesh.material;a.map&&a.map.dispose();a.dispose();this._container=this._texture=this._mesh=this._canvasTexture=null}_initVars(){let a=this.data.text.match(/\{[^}]+\}/g);if(a)for(let h=0;h<a.length;++h){var e=a[h];e=e.substr(1,e.length-2);let m=null;!this._variables[e]&&(m=VariableRefHolder.inst.getRefByName(e,this.parentUUID))&&(this._variables[e]=m)}}_updateVars(){let a=this.data.text;for(let h in this._variables){var e=this._variables[h];
switch(e.type){case VariableType.TEXT:e=e.currentValue[0];break;case VariableType.ENUM:let m=[];for(let t in e.currentValue)e.currentValue[t]&&m.push(t);e=m.join(", ");break;case VariableType.BOOLEAN:e=e.currentValue?"fr"==Config.LANGUAGE?"vrai":"true":"fr"==Config.LANGUAGE?"faux":"false";break;case VariableType.NUMBER:e=e.currentValue.toLocaleString();break;default:e=e.currentValue}a=a.replace(new RegExp("{"+h+"}","g"),e)}this._setText(a)}_setText(a){a&&(this._canvasTexture.text=a);this._mesh.scale.set(this._texture.width,
this._texture.height,1)}}
class ChromakeyEffect extends THREE.ShaderMaterial{constructor(a,e=new THREE.Color(0,1,0),h=.55){super({vertexShader:ChromakeyEffect.vertexShader,fragmentShader:ChromakeyEffect.fragmentShader,uniforms:{inTexture:{type:"t",value:a},inColor:{type:"c",value:e},threshold:{type:"f",value:h},opacity:{type:"f",value:1}},transparent:!0,side:THREE.DoubleSide,alphaTest:.05});this._map=a}get map(){return this._map}set opacity(a){this.uniforms&&(this.uniforms.opacity.value=a);this._opacity=a}get opacity(){return this._opacity}}
ChromakeyEffect.fragmentShader="        uniform sampler2D inTexture;\n        uniform vec3 inColor;\n        uniform float threshold;\n        uniform float opacity;\n        varying vec2 vUv;\n        void main(void) {\n            vec3 tColor = texture2D( inTexture, vUv ).rgb;\n            vec3 diff = tColor.xyz - inColor.xyz;\n            if(dot(diff, diff) < threshold) {\n                discard;\n            }\n            else {\n                gl_FragColor = vec4(tColor, opacity);\n            }\n        }";
ChromakeyEffect.vertexShader="        varying vec2 vUv;\n        void main(){\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }";
class ChromaEffectScriptData extends AbstractScriptParser{constructor(){super(...arguments);this.chroma=!1;this.color=new THREE.Color(0,1,0);this.threshold=.55}static getFromName(a){return this.loopOnKeys(this.extractBaseCode(a,"chroma"),new ChromaEffectScriptData)}parseVal(a,e){this.chroma=!0;"color"==a?this.color=new THREE.Color(e):"threshold"==a&&(this.threshold=parseFloat(e))}}
class VariableTextScriptData extends AbstractScriptParser{constructor(){super(...arguments);this.color="black";this.textAlign="center";this.fontSize="48px";this.fontFamily="sans-serif";this.fontWeight=this.fontStyle="normal";this.border=this.margin=0;this.borderColor="black"}static getFromName(a){return this.loopOnKeys(this.extractBaseCode(a,"var"),new VariableTextScriptData)}toData(a){let e=new TextAspectData;for(let h in a)e[h]=a[h];e.text=this.text;e.color=this.color;e.backgroundColor=this.backgroundColor;
e.textAlign=this.textAlign;e.fontSize=this.fontSize;e.fontFamily=this.fontFamily;e.fontStyle=this.fontStyle;e.fontWeight=this.fontWeight;e.padding=this.margin;e.border=this.border;e.borderColor=this.borderColor;return e}parseVal(a,e){"color"==a?this.color=e:"background"==a||"bg"==a?this.backgroundColor=e:"varname"==a?this.varName=e:"text"==a?this.text=e:"textalign"==a||"align"==a?this.textAlign=e:"fontSize"==a?this.fontSize=e:"fontFamily"==a?this.fontFamily=e:"fontStyle"==a?this.fontStyle=e:"fontWeight"==
a?this.fontWeight=e:"border"==a?this.border=parseInt(e):"bordercolor"==a||"bc"==a?this.borderColor=e:"margin"==a&&(this.margin=parseFloat(e))}}
class AspectFactory{static create(a,e){switch(a.type){case StatefulElementType.MESH:e=new ModelAspect(e);break;case StatefulElementType.TRIGGER:e=new TriggerAspect(e);break;case StatefulElementType.TIMELINE:e=new TimelineAspect(e);break;case StatefulElementType.COLOR:e=new ColorAspect(e);break;case StatefulElementType.SOUND:e=new AudioAspect(e);e.endCallback=()=>{AspectFactory.processStatefulImplication(a)};break;case StatefulElementType.VIDEO:e=new VideoAspect(e);e.endCallback=()=>{AspectFactory.processStatefulImplication(a)};
break;case StatefulElementType.TEXT:e=new TextAspect(e);break;default:let h=VariableTextScriptData.getFromName(e.name);h?e=new TextAspect(h.toData(e)):(e=new AssetAspect(e),e.endCallback=()=>{AspectFactory.processStatefulImplication(a)})}e.parentUUID=a.uuid;e.create();e.updateShader();e.placeContainer();e.elementOpacityChange(a.data.opacity);return e}static processStatefulImplication(a){ImplicationUtils.triggerFullRun(StatementTrigger.MEDIA_END,Config.simulationData.implications[a.data.uuid])}static chromaTexture(a,
e){let h,m,t;e.colorFilter?(m=new THREE.Color(e.colorFilter),t=e.colorThreshold):(h=ChromaEffectScriptData.getFromName(e.name))&&h.chroma&&(m=h.color,t=h.threshold);return m?new ChromakeyEffect(a,m,t):null}}
class LightContext{constructor(a){this.camera=a}get ambient(){return this._ambient}get key(){return this._key}set preset(a){this.removeCurrentPreset();(this._preset=a)&&this.initPreset()}removeCurrentPreset(){this._ambient&&(this.camera.remove(this._ambient),this._ambient=null);this._secondAmbient&&(this._secondCamera.remove(this._secondAmbient),this._secondAmbient=null);this._key&&(this.camera.remove(this._key),this._key=null);this._fill&&(this.camera.remove(this._fill),this._fill=null);this._rim&&
(this.camera.remove(this._rim),this._rim=null)}generateLight(a){if(1==a.isAmbient)return new THREE.AmbientLight(a.color,1);let e=new THREE.PointLight(a.color,a.intensity,3E3);e.castShadow=!0;e.position.set(a.positionX,a.positionY,a.positionZ);return e}initPreset(){this._preset.ambient&&(this._ambient=this.generateLight(this._preset.ambient),this.camera.add(this._ambient),this._secondCamera&&(this._secondAmbient=this._ambient.clone(),this._secondCamera.add(this._secondAmbient)));this._preset.key&&
(this._key=this.generateLight(this._preset.key),this.camera.add(this._key));this._preset.fill&&(this._fill=this.generateLight(this._preset.fill),this.camera.add(this._fill));this._preset.rim&&(this._rim=this.generateLight(this._preset.rim),this.camera.add(this._rim))}forkOn(a){this._secondCamera=a}}
class SceneAmbientEffectData extends AbstractScriptParser{constructor(){super(...arguments);this.ambient=!1;this.color=new THREE.Color(16777215);this.noambient=!1;this.intensity=1;this.toneMapping=THREE.NoToneMapping;this.toneMappingExposure=1}static getFromName(a){return this.loopOnKeys(this.extractBaseCode(a,"ambient"),new SceneAmbientEffectData)}parseVal(a,e){this.ambient=!0;if("color"==a)this.color=new THREE.Color(e);else if("noambient"==a)this.noambient=!0;else if("intensity"==a)this.intensity=
parseFloat(e);else if("exposure"==a)this.toneMappingExposure=parseFloat(e);else if("tonemapping"==a)switch(e){case "aces":this.toneMapping=THREE.ACESFilmicToneMapping;break;case "cineon":this.toneMapping=THREE.CineonToneMapping;break;case "linear":this.toneMapping=THREE.LinearToneMapping;break;case "reinhard":this.toneMapping=THREE.ReinhardToneMapping;break;default:this.toneMapping=THREE.NoToneMapping}}}
class SceneFogEffectData extends AbstractScriptParser{constructor(){super(...arguments);this.fog=!1;this.color=new THREE.Color(15658734);this.far=2E3;this.density=.0025}static getFromName(a){return this.loopOnKeys(this.extractBaseCode(a,"fog"),new SceneFogEffectData)}parseVal(a,e){this.fog=!0;"color"!=a&&(e=parseFloat(e));"color"==a?this.color=new THREE.Color(e):"near"==a?this.near=e:"far"==a?this.far=e:"density"==a&&(this.density=e)}}
class SceneLightEffectData extends AbstractScriptParser{constructor(){super(...arguments);this.light=!1;this.offset=new THREE.Vector3(0,0,0);this.type="spot";this.attachedToController=!0;this.intensity=.5;this.penumbra=1;this.decay=2;this.angle=.52;this.color=new THREE.Color(16777215)}static getFromName(a){return this.loopOnKeys(this.extractBaseCode(a,"light"),new SceneLightEffectData)}parseVal(a,e){this.light=!0;"novr"==a?this.attachedToController=!1:"type"==a?this.type="directional"==e?"directional":
"spot":"color"==a?this.color=new THREE.Color(e):"distance"==a?this.distance=parseFloat(e):"intensity"==a?this.intensity=parseFloat(e):"angle"==a?this.angle=parseFloat(e)*THREE.MathUtils.DEG2RAD:"penumbra"==a?this.penumbra=parseFloat(e):"decay"==a?this.decay=parseFloat(e):"offset"==a&&(a=e.split(" "),a[0]?this.offset.x=parseFloat(a[0]):a[1]?this.offset.y=parseFloat(a[1]):a[2]&&(this.offset.z=parseFloat(a[2])))}}
class SceneEffectData extends AbstractScriptParser{constructor(){super(...arguments);this.stereo=StereoType.NONE}static getFromName(a){return this.loopOnKeys(this.extractBaseCode(a),new SceneEffectData)}parseVal(a,e){"stereo"==a&&(this.stereo="leftright"==e?StereoType.LEFT_RIGHT:StereoType.TOP_BOTTOM)}}
class SceneSkyEffectData extends AbstractScriptParser{constructor(){super(...arguments);this.sky=!1;this.parallel=45;this.hour=12;this.depth=.2;this.sunsize=8;this.luminance=this.rayleigh=1;this.mieCoefficient=.001;this.mieDirectionalG=.973;this.nobackground=!1}static getFromName(a){return this.loopOnKeys(this.extractBaseCode(a,"sky"),new SceneSkyEffectData)}parseVal(a,e){this.sky=!0;e=parseFloat(e);"halo"==a||"turbidity"==a||"sunsize"==a?this.sunsize=Math.max(0,e):"rayleigh"==a||"power"==a?this.rayleigh=
e:"parallel"==a?this.parallel=Math.max(-90,Math.min(90,e)):"hour"==a?this.hour=Math.max(0,e%24):"luminance"==a?this.luminance=e:"miecoefficient"==a?this.mieCoefficient=e:"miedirectionalg"==a?this.mieDirectionalG=e:"depth"==a?this.depth=parseFloat(e):"nobackground"==a&&(this.nobackground=!0)}}
class ShadowEffectData extends AbstractScriptParser{constructor(){super(...arguments);this.shadow=!1;this.size=1024;this.dynamic=this.receive=this.cast=!1;this.intensity=1;this.near=.1;this.far=5E3;this.bias=0;this.decay=this.radius=1;this.frustum=10;this.mobile=!1}static getFromName(a){return this.loopOnKeys(this.extractBaseCode(a,"shadow"),new ShadowEffectData)}parseVal(a,e){this.shadow=!0;"size"==a?this.size=Device.isMobile()?512:parseInt(e):"cast"==a?this.cast=!0:"receive"==a?this.receive=!0:
"dynamic"==a?this.dynamic=!0:"intensity"==a?this.intensity=parseFloat(e):"near"==a?this.near=parseFloat(e):"far"==a?this.far=parseFloat(e):"bias"==a?this.bias=parseFloat(e):"mobile"==a?this.mobile=!0:"radius"==a?this.radius=parseFloat(e):"decay"==a?this.decay=parseFloat(e):"frustum"==a&&(this.frustum=parseFloat(e))}}
class SceneBloomEffectData extends AbstractScriptParser{constructor(){super(...arguments);this.bloom=!1;this.threshold=.98;this.strength=1;this.radius=.1}static getFromName(a){return this.loopOnKeys(this.extractBaseCode(a,"bloom"),new SceneBloomEffectData)}parseVal(a,e){this.bloom=!0;e=parseFloat(e);"threshold"==a?this.threshold=e:"strength"==a?this.strength=e:"radius"==a&&(this.radius=e)}}
class EffectsManager extends Notifiable{constructor(){super();this.noSkyBackground=!1;if(null!=EffectsManager._inst)throw Error("This is a singleton");this._lightNeedsUpdate=!1;this._lookAtVector=new THREE.Vector3(0,0,1);this.lightContext=new LightContext(View3D.inst.camera)}static get inst(){return this._inst||(this._inst=new EffectsManager)}get skySunPosition(){return this.sky?this.sky.material.uniforms.sunPosition.value.normalize().multiplyScalar(800):new THREE.Vector3(0,800,0)}notify(a,e){this.updateFlashLight()}disposeEffects(){this.removeAmbientEffect();
this.removeFlashLightEffect();this.removeFogEffect();this.removeShadowLight();this.removeSky();this.removeBloom()}createAmbientEffect(a){this.lightContext.ambient.color=a.color;this.lightContext.ambient.intensity=a.intensity;View3D.inst.renderer.toneMapping=a.toneMapping;View3D.inst.renderer.toneMappingExposure=a.toneMappingExposure;a.noambient&&(this.lightContext.preset=LightPreset.NONE)}createFogEffect(a){View3D.inst.scene.fog=a.near?new THREE.Fog(a.color.getHex(),a.near,a.far):new THREE.FogExp2(a.color.getHex(),
a.density)}createFlashLightEffect(a,e){a.attachedToController&&WebVRUtils.hasHMD||(Notifier.subscribe(this,ViewportCommand.UPDATE),this._lightNeedsUpdate=!0,this._useXRCamera=Config.STARTED_IN_VR&&WebVRUtils.hasHMD&&!WebVRUtils.isDesktopHMD);"spot"==a.type?(this._flashLight=new THREE.SpotLight(a.color,2*a.intensity),this._flashLight.penumbra=a.penumbra,this._flashLight.distance=a.distance,this._flashLight.decay=a.decay,this._flashLight.angle=a.angle):this._flashLight=new THREE.DirectionalLight(a.color,
a.intensity);this._flashLight.castShadow=!!e;if(this._lightNeedsUpdate)this._flashLight.target.position.set(0,0,-1E-4),View3D.inst.scene.add(this._flashLight),View3D.inst.scene.add(this._flashLight.target);else if(this._flashLight.position.set(0,0,0),this._flashLight.target.position.set(0,0,-1E-4),this._flashLight.target.updateMatrixWorld(!0),e=View3D.inst.controlsManager.gamePadManager)e.attachToController(this._flashLight),e.attachToController(this._flashLight.target);this._lightEffectData=a}createSunLight(a,
e){this.shadowLight=new THREE.DirectionalLight(a.color,(a?a.intensity:1)*(a&&!e?.1:1));this.shadowLight.castShadow=e&&(!Device.isMobile()||e.mobile);this.shadowLight.shadow.bias=e?e.bias:0;this.shadowLight.target=View3D.inst.camera;var h=e?e.frustum:5;this.shadowLight.shadow.camera.left=-h;this.shadowLight.shadow.camera.right=h;this.shadowLight.shadow.camera.top=h;this.shadowLight.shadow.camera.bottom=-h;e&&(View3D.inst.renderer.shadowMap.enabled=e.shadow,View3D.inst.renderer.shadowMap.autoUpdate=
!0,View3D.inst.renderingController.onAfterRender=()=>{View3D.inst.renderer.shadowMap.autoUpdate=e.dynamic},this.shadowLight.shadow.mapSize.width=e.size,this.shadowLight.shadow.mapSize.height=e.size,this.shadowLight.shadow.camera.near=e.near,this.shadowLight.shadow.camera.far=e.far,this.shadowLight.shadow.bias=e.bias);h=this.skySunPosition.clone().multiplyScalar(a.depth);this.shadowLight.position.copy(h);this.sunEffectData=a;View3D.inst.scene.add(this.shadowLight)}createSky(a){this.sky=new THREE.Sky;
this.sky.scale.setScalar(Config.currentScene.sphereRadius);a.nobackground||(this.noSkyBackground=!0,View3D.inst.skyboxContainer.add(this.sky));this.sky.inclinaison=a.parallel/180;this.sky.azimuth=a.hour/24-.25;this.sky.renderOrder=Config.RENDER_ORDER_SKYBOX++;let e=this.sky.material.uniforms;e.turbidity.value=a.sunsize;e.rayleigh.value=a.rayleigh;e.luminance.value=a.luminance;e.mieCoefficient.value=a.mieCoefficient;e.mieDirectionalG.value=a.mieDirectionalG;SkyUtils.setSunPosition(this.sky);this.updateBackgroundRenderTarget();
View3D.inst.renderer.render(View3D.inst.scene,View3D.inst.camera)}createSimpleSky(a){this.sky=new THREE.Sky;this.sky.scale.setScalar(Config.currentScene.sphereRadius);View3D.inst.skyboxContainer.add(this.sky);this.sky.inclinaison=a.parallel/180;this.sky.azimuth=a.hour/24-.25;this.sky.renderOrder=Config.RENDER_ORDER_SKYBOX++;a=this.sky.material.uniforms;a.turbidity.value=8;a.mieCoefficient.value=.001;a.mieDirectionalG.value=.973;SkyUtils.setSunPosition(this.sky);this.updateBackgroundRenderTarget();
View3D.inst.renderer.render(View3D.inst.scene,View3D.inst.camera)}setupBackgroundRenderTarget(){if(!this._envCubeCamera){var a=new THREE.WebGLCubeRenderTarget(512,{format:THREE.RGBFormat,generateMipmaps:!0,minFilter:THREE.LinearMipmapLinearFilter});this._envCubeCamera=new THREE.CubeCamera(.01,5E4,a)}}updateBackgroundRenderTarget(a=null){this._envCubeCamera&&(a&&(this._envCubeCamera.position.copy(a),this._envCubeCamera.update(View3D.inst.renderer,View3D.inst.scene)),this._envCubeCamera.update(View3D.inst.renderer,
View3D.inst.scene))}get backgroundRenderTarget(){return this._envCubeCamera?this._envCubeCamera.renderTarget:null}addBloom(a){let e=View3D.inst.renderer.getSize(new THREE.Vector2);this._bloomPass=new THREE.UnrealBloomPass(e,1.5,.4,.85);this._bloomPass.threshold=a.threshold;this._bloomPass.strength=a.strength;this._bloomPass.radius=a.radius;this._bloomPass.name="bloom pass";View3D.inst.renderingController.addPass(this._bloomPass);this._bloomPass.setSize(e.x,e.y)}updateFlashLight(){var a=View3D.inst.camera;
let e=this._useXRCamera?View3D.inst.renderer.xr.getCamera(a):a;this._lookAtVector.set(0,0,0);this._lookAtVector.applyQuaternion(a.quaternion);this._lookAtVector.add(this._lightEffectData.offset);a=this._lookAtVector.clone().unproject(a).sub(a.position).normalize();this._flashLight.position.copy(e.position);this._flashLight.target.position.copy(e.position).add(a)}removeAmbientEffect(){View3D.inst.renderer.toneMapping=THREE.NoToneMapping;this.lightContext.ambient&&(this.lightContext.ambient.color=new THREE.Color(16777215),
this.lightContext.ambient.intensity=1);this.lightContext.preset=LightPreset.AMBIENT}removeFogEffect(){View3D.inst.scene.fog=null}removeFlashLightEffect(){if(this._flashLight){if(this._lightNeedsUpdate)Notifier.unsubscribe(this,ViewportCommand.UPDATE),View3D.inst.scene.remove(this._flashLight),View3D.inst.scene.remove(this._flashLight.target);else{let a=View3D.inst.controlsManager.gamePadManager;a&&(a.detachToController(this._flashLight),a.detachToController(this._flashLight.target))}this._lightEffectData=
this._flashLight=null;this._useXRCamera=this._lightNeedsUpdate=!1}}removeShadowLight(){var a;this.shadowLight&&(null===(a=this.shadowLight.shadow.map)||void 0===a?void 0:a.dispose(),View3D.inst.scene.remove(this.shadowLight),this.sunEffectData=this.shadowLight=null)}removeSky(){this.sky&&(--Config.RENDER_ORDER_SKYBOX,View3D.inst.skyboxContainer.remove(this.sky),this.sky.geometry.dispose(),this.sky.material.dispose(),this.sky=null)}removeBloom(){this._bloomPass&&(View3D.inst.renderingController.removePass(this._bloomPass),
this._bloomPass=null)}}EffectsManager._inst=null;
class SceneEffectAnimation{static manageSceneAnimationEffect(a){var e=EffectsManager.inst;let h=e.lightContext;e=e.sky;null!=a.ambientIntensity&&(new TWEEN.Tween(h.ambient)).to({intensity:a.ambientIntensity},a.time).easing(a.ease).start();null!=a.ambientColor&&(new TWEEN.Tween(h.ambient.color)).to({r:a.ambientColor.r,g:a.ambientColor.g,b:a.ambientColor.b},a.time).easing(a.ease).start();null!=a.parallel&&e&&(new TWEEN.Tween(e)).to({inclinaison:a.parallel/180},a.time).easing(a.ease).repeat(a.repeat).onUpdate(SceneEffectAnimation.onUpdate).start();
null!=a.hour&&e&&(new TWEEN.Tween(e)).to({azimuth:a.hour/24-.25},a.time).easing(a.ease).repeat(a.repeat).onUpdate(SceneEffectAnimation.onUpdate).start()}}
SceneEffectAnimation.onUpdate=()=>{SkyUtils.setSunPosition(EffectsManager.inst.sky);let a=EffectsManager.inst.shadowLight;if(a){a.position.copy(EffectsManager.inst.skySunPosition);let e=EffectsManager.inst.sunEffectData;e&&e.depth&&a.position.multiplyScalar(e.depth)}Device.MODERN_GPU&&!Device.isMobile()&&(View3D.inst.renderer.shadowMap.needsUpdate=!0)};
class StateTimelineScriptData extends AbstractScriptParser{static getFromName(a){return this.loopOnKeys(this.extractBaseCode(a,"timeline"),new StateTimelineScriptData)}parseVal(a,e){a==StateTimelineScriptData.TIMELINE_PLAY?this.kind=StateTimelineScriptData.TIMELINE_PLAY:a==StateTimelineScriptData.TIMELINE_STOP?this.kind=StateTimelineScriptData.TIMELINE_STOP:a==StateTimelineScriptData.TIMELINE_PAUSE?this.kind=StateTimelineScriptData.TIMELINE_PAUSE:a==StateTimelineScriptData.TIMELINE_GOTO&&(this.goto=
parseFloat(e))}}StateTimelineScriptData.TIMELINE_STOP="stop";StateTimelineScriptData.TIMELINE_PLAY="play";StateTimelineScriptData.TIMELINE_PAUSE="pause";StateTimelineScriptData.TIMELINE_GOTO="goto";class ClippingStateScriptData extends AbstractScriptParser{constructor(){super(...arguments);this.clipVisible=!1}static getFromName(a){return this.loopOnKeys(this.extractBaseCode(a,"clip"),new ClippingStateScriptData)}parseVal(a,e){"visible"==a&&(this.clipVisible=!0)}}
class SceneAnimationEffectData extends AbstractScriptParser{constructor(){super(...arguments);this.time=1;this.repeat=0;this.ease=TWEEN.Easing.Linear.None}static getFromName(a){return this.loopOnKeys(this.extractBaseCode(a,"scene"),new SceneAnimationEffectData)}parseVal(a,e){e&&"ambient"!=a&&"ambientcolor"!=a&&"lightcolor"!=a&&(e=parseFloat(e));if("sunsize"==a||"turbidity"==a)this.sunsize=e;else if("parallel"==a)this.parallel=e;else if("hour"==a)this.hour=e;else if("luminance"==a)this.luminance=e;
else if("rayleigh"==a)this.rayleigh=e;else if("miecoefficient"==a)this.mieCoefficient=e;else if("miedirectional"==a||"miedirectionalg"==a)this.mieDirectionalG=e;else if("ambient"==a||"ambientcolor"==a)this.ambientColor=new THREE.Color(e);else if("ambientintensity"==a)this.ambientIntensity=e;else if("exposure"==a)this.toneMappingExposure=e;else if("gammafactor"==a)this.gammaFactor=e;else if("lightangle"==a)this.lightAngle=e;else if("lightcolor"==a)this.lightColor=new THREE.Color(e);else if("lightintensity"==
a)this.lightIntensity=e;else if("time"==a||"t"==a)this.time=1E3*e;else if("repeat"==a)this.repeat=e?e:Infinity;else if("in"==a||"easein"==a)this.ease=TWEEN.Easing.Quadratic.In;else if("out"==a||"easeout"==a)this.ease=TWEEN.Easing.Quadratic.Out;else if("inout"==a||"easeinout"==a)this.ease=TWEEN.Easing.Quadratic.InOut;else if("linear"==a||"easelinear"==a)this.ease=TWEEN.Easing.Linear.None}}
class CamScriptData extends AbstractScriptParser{constructor(){super(...arguments);this.attachedToCamera=!1}static getFromName(a){if(!/\[attachedtocam\]/gi.test(a))return null;a=new CamScriptData;a.attachedToCamera=!0;return a}parseVal(a,e){}}var Promisify;
(function(a){a.onEvent=function(e,h,m){return new Promise((t,y)=>{e[h]=C=>{t([e,C])};m&&(e[m]=y)})};a.addEventListener=function(e,h,m){return new Promise((t,y)=>{e.addEventListener(h,t);m&&e.addEventListener(m,y)})};a.promiseCallback=function(e,h,...m){return new Promise(t=>{m&&m.length?(h?m.unshift(t):m.push(t),e.apply(null,m)):e(t)})}})(Promisify||={});var Connection;
(function(a){function e(M){H.send(JSON.stringify(M))}function h(M){clearInterval(sa);a.onLine=!1;console.info("Disconnected from WebSocket server")}function m(M){try{var Q=JSON.parse(M.data)}catch(ca){console.error("Received invalid json:",M.data);return}switch(Q.action){case "updateAvatar":wa?C(W[Q.senderId].object,Q):(W[Q.senderId].data.position=Q.position,W[Q.senderId].data.rotation=Q.rotation);break;case "setGamePads":if(!wa)break;if(!U[Q.senderId]||2!=U[Q.senderId].length){if(qa[Q.senderId])break;
qa[Q.senderId]=!0;U[Q.senderId]=[];E(Q.senderId);E(Q.senderId);console.info("Loading gamepad models for user #%s",Q.senderId);break}M=U[Q.senderId];for(var V=0;V<M.length;++V)C(M[V],{position:Q.positions[V],rotation:Q.rotations[V]}).updateMatrix();break;case "updateState":V=Q.changes;V.elements&&Notifier.unleash(StatefulCommand.STATEFUL_ELEMENT_CHANGE,V.elements);V.checkpoints&&Notifier.unleash(StatefulCommand.CHECKPOINT_TRIGGERED,V.checkpoints);if(!V.scene)break;if(Q.senderId==R||null==Q.senderId){y(Q);
a.inLobby=!1;Notifier.unleash(ImplicationCommand.CHANGE_SCENE,V.scene);break}(M=W[Q.senderId])?(V=Config.currentScene.uuid==V.scene,wa&&(Q.users[Q.senderId]&&(M.data=Q.users[Q.senderId]),M.object||null==M.data.avatar||I(Q.senderId,M.data.avatar)),M.object&&(M.object.visible=V),V?ea.push(Q.senderId):(Q=ea.indexOf(Q.senderId),0<=Q&&ea.splice(Q,1))):(W[Q.senderId]={data:{},object:null},Config.currentScene.uuid==V.scene&&ea.push(Q.senderId));break;case "setName":Q.name&&(W[Q.senderId].data.name=Q.name);
break;case "setAvatar":M=W[Q.senderId];M.data.avatar=Q.avatar;wa?(I(Q.senderId,Q.avatar),M.object.visible=-1!=ea.indexOf(Q.senderId),C(M.object,Q)):(M.data.position=Q.position,M.data.rotation=Q.rotation);break;case "acceptConnection":R=Q.senderId;y(Q);SimulationLoader.inst.initSceneLoad(Q.changes.scene);break;default:console.error("Unknown action:",Q.action)}}function t(){var M;let Q=View3D.inst.camera;if(Q){var V=new THREE.Vector3,ca=new THREE.Quaternion,za=new THREE.Vector3;Q.matrixWorld.decompose(V,
ca,za);(1E-4<V.distanceTo(T)||1E-4<ca.angleTo(fa))&&e({action:"updateAvatar",position:V.toArray(),rotation:ca.toArray()});T=V;fa=ca;var ta;if((ta=null===(M=View3D.inst.controlsManager.gamePadManager)||void 0===M?void 0:M.getControllers())&&2==ta.length){M={action:"setGamePads",positions:[],rotations:[]};for(let Ka of ta)Ka.matrix.decompose(V,ca,za),M.positions.push(V.toArray()),M.rotations.push(ca.toArray());e(M)}}}function y(M){ea=M.changes.usersInScene;for(let Q in M.users)W[Q]={data:M.users[Q]}}
function C(M,Q){M.position.fromArray(Q.position);M.quaternion.fromArray(Q.rotation);return M}function I(M,Q){View3D.inst.avatarsContainer.add(W[M].object=MultiPlayerScript.getAvatarClone(Q))}function E(M){(new SoloController(null)).load3DModel(Q=>{Q=Q.scene;U[M].push(Q);W[M].object.add(Q)})}let H,O,R,W={},ea,T=new THREE.Vector3,fa=new THREE.Quaternion,sa=0,wa=!1,U={},qa={};a.init=function(){return __awaiter(this,void 0,void 0,function*(){if(Config.simulationData.multi&&location.hostname&&/http/g.test(location.protocol))O=
"ws://"+window.location.hostname;else return!1;try{H=(yield Promisify.onEvent(new WebSocket(O),"onopen","onerror"))[0],H.onclose=h,H.onmessage=m,a.onLine=!0,console.info("Connected to WebSocket server")}catch(M){a.onLine=!1,console.info("No WebSocket server available")}return a.onLine})};a.send=e;a.onAvatarObjectsGenerated=function(){wa=!0;for(var M in W){let Q=W[M];Q.object&&(Q.object.visible=!1)}if(ea)for(let Q of ea)Q!=R&&(M=W[Q],wa&&!M.object&&null!=M.data.avatar&&I(Q,M.data.avatar),M.object&&
(M.object.visible=!0,M.data.position&&(C(M.object,M.data),delete M.data.position,delete M.data.rotation)))};a.onAvatarSelected=function(M){let Q=View3D.inst.camera;a.send({action:"setAvatar",avatar:M,position:Q.position.toArray(),rotation:Q.quaternion.toArray()});sa=window.setInterval(t,50)}})(Connection||={});
class MultiPlayerScript extends AbstractScriptParser{get isInteractive(){return this.isSetNameItem||this.isAvatarSelect||this.isReadyButton||!!this.swapAvatarItem}static getAvatarClone(a){return this.avatarList[a]?this.avatarList[a].clone(!0):null}static getFromName(a){return Connection.onLine?this.loopOnKeys(this.extractBaseCode(a,"multi"),new MultiPlayerScript):null}parseVal(a,e){"user"==a||"avatar"==a?this.avatarName=MultiPlayerScript.lastAvatarName++:"avatars"==a?this.isAvatarsHolder=!0:"name"==
a?this.isSetNameItem=!0:"lobby"==a?(this.isLobby=!0,Connection.inLobby=!0):"select"==a?this.isAvatarSelect=!0:"ready"==a?this.isReadyButton=!0:"arrow"==a?this.swapAvatarItem=parseInt(e):"hide"==a?this.visible=!1:"show"==a&&(this.visible=!0)}handleElementCreation(a){if(null!=this.avatarName)return a.position.set(0,0,0),a.rotation.set(0,0,0),a.userData.isAvatar=!0,a.visible=0==this.avatarName,MultiPlayerScript.avatarList[this.avatarName]=a,MultiPlayerScript.avatarGroup&&MultiPlayerScript.avatarGroup.add(a),
!0;if(this.isAvatarsHolder){MultiPlayerScript.avatarGroup=a;for(let e in MultiPlayerScript.avatarList)MultiPlayerScript.avatarGroup.add(MultiPlayerScript.avatarList[e])}return!1}handleInteraction(){var a;if(this.isSetNameItem){let e=null===(a=prompt(Localisation.inst.NAME_SET_PROMPT))||void 0===a?void 0:a.trim();if(!e||25<e.length)throw Error(Localisation.inst.NAME_SET_ERROR);Connection.send({action:"setName",name:e})}else if(this.swapAvatarItem)a=MultiPlayerScript.currentlyShownAvatar+this.swapAvatarItem,
0>a?a=MultiPlayerScript.lastAvatarName-1:a>=MultiPlayerScript.lastAvatarName&&(a=0),a!=MultiPlayerScript.currentlyShownAvatar&&(MultiPlayerScript.avatarList[MultiPlayerScript.currentlyShownAvatar].visible=!1,MultiPlayerScript.avatarList[a].visible=!0,MultiPlayerScript.currentlyShownAvatar=a);else if(this.isAvatarSelect)Connection.onAvatarSelected(MultiPlayerScript.currentlyShownAvatar);else this.isReadyButton&&Connection.send({action:"ready"})}setVisibility(a){"boolean"==typeof this.visible&&(a.visible=
this.visible)}forceHide(a){this.isSetNameItem||this.isReadyButton?a.visible=!1:this.isAvatarSelect&&(a.visible=!1,MultiPlayerScript.avatarGroup.visible=!1)}}MultiPlayerScript.avatarList={};MultiPlayerScript.avatarGroup=null;MultiPlayerScript.lastAvatarName=0;MultiPlayerScript.currentlyShownAvatar=0;
class RevertScriptData extends JsonScriptConverter{static getFromName(a){return this.loopOnKeys(this.extractBaseCode(a,"checkpoint"),new RevertScriptData)}fromScript(a){a.name?this.checkpointName=a.name:a.explain&&(this._explain=a.explain)}explain(){if(this._explain){var a=[],e=h=>{(h=ArrayUtils.regexFind(Config.currentScene.elements,"name",h))&&a.push(h)};if("string"==typeof this._explain)e(this._explain);else if(this._explain instanceof Array)for(let h=0;h<this._explain.length;++h)e(this._explain[h]);
if(!a.length)return console.error("Did not find element(s) for the explain request");alert(JSON.stringify(this.toData(a)).replace(/["']/g,""))}}toData(a){let e=[];for(let h=0;h<a.length;++h){let m=a[h],t=ElementsRefHolder.inst.getRef(m.uuid),y=LiveElementsRefHolder.inst.getRef(m.uuid).container,C={name:m.name};t.currentAspectId!=m.defaultAspectUUID&&(C.aspect=ArrayUtils.find(m.aspects,"uuid",t.currentAspectId).name);t.currentStateId!=m.defaultStateUUID&&(C.state=ArrayUtils.find(m.states,"uuid",t.currentStateId).name);
CoordUtils.almostEqual(y.position,m.position)||(C.position=y.position.toArray());CoordUtils.almostEqual(y.rotation,m.rotation)||(C.rotation=y.rotation.toArray().slice(0,3));CoordUtils.almostEqual(y.scale,m.scale)||(C.scale=y.scale.toArray());e.push(C)}return e}parseVal(a,e){}}
class VoiceRecognition{constructor(){this.uuid="VoiceRecognition";if(null!=VoiceRecognition._inst)throw Error("VoiceRecognition is a singleton");this.recognition=new (webkitSpeechRecognition||SpeechRecognition);this.currentSpeak=new SpeechSynthesisUtterance;this.voices=window.speechSynthesis.getVoices()}static get inst(){return this._inst||(this._inst=new VoiceRecognition)}update(a){this.scriptData=a;this.patternReg=new RegExp(a.pattern,"i");this.recognition.lang=a.lang;this.recognition.continuous=
!0;this.recognition.interimResults=!0;this.recognition.onend=()=>{this.recognition.start()};this.recognition.onerror=e=>{this.recognition.stop();this.recognition.start()};this.recognition.onresult=e=>{this.processResult(e)};a.speak&&"speechSynthesis"in window&&(this.currentSpeak.text=a.speak,this.voices.forEach((e,h)=>{e.lang==a.lang&&(this.currentSpeak.voice=e)}),window.speechSynthesis.speak(this.currentSpeak))}processResult(a){var e="";for(let h=a.resultIndex;h<a.results.length;++h)a.results[h].isFinal&&
(e+=a.results[h][0].transcript),e&&0<e.length&&e.match(this.patternReg)&&(this.recognition.onend=null,this.recognition.onerror=null,this.recognition.onresult=null,e="",this.elmChainTo=this.patternReg=null,ImplicationUtils.triggerFullRun(StatementTrigger.VOICE_RECOGNIZE,Config.simulationData.implications[this.elmChainTo]))}startRecognitionFromScript(a){this.scriptData.chain&&(a.states.forEach(e=>{var h;if(null===(h=e.name)||void 0===h?0:h.match("id:"+this.scriptData.chain))this.chainTo=e.uuid;this.elmChainTo=
a.uuid}),this.chainTo&&this.recognition.start())}}
class SceneCameraEffectData extends AbstractScriptParser{constructor(){super(...arguments);this.camera=!1;this.fov=60;this.duration=500;this.kind=Interpolation.LINEAR;this.direction=this.reversed=!1;this.polarangle=this.azimuthangle=null;this._forward=new THREE.Vector3;this._currentLookAt=new THREE.Vector3;this._uuid=UUID.generate()}static getFromName(a){return this.loopOnKeys(this.extractBaseCode(a,"camera"),new SceneCameraEffectData)}parseVal(a,e){this.camera=!0;"fov"==a&&(this.fov=parseFloat(e));
"reversed"==a&&(this.reversed=!0);if("pos"==a){var h=e.split(" ");this.camPosition=new THREE.Vector3;this.camPosition.x=parseFloat(h[0]);this.camPosition.y=h[1]?parseFloat(h[1]):0;this.camPosition.z=h[2]?parseFloat(h[2]):0}"target"==a&&(h=e.split(" "),this.targetCam=new THREE.Vector3,this.targetCam.x=parseFloat(h[0]),this.targetCam.y=h[1]?parseFloat(h[1]):0,this.targetCam.z=h[2]?parseFloat(h[2]):0);"direction"==a&&(this.direction=!0);"duration"==a&&(this.duration=parseFloat(e));"in"==a?this.kind=
Interpolation.EASE_IN:"out"==a?this.kind=Interpolation.EASE_OUT:"inout"==a&&(this.kind=Interpolation.EASE_IN_OUT);"chain"==a&&(this.chain=e);"azimuth"==a&&(this.azimuthangle=THREE.MathUtils.DEG2RAD*parseFloat(e));"polar"==a&&(this.polarangle=THREE.MathUtils.DEG2RAD*parseFloat(e))}get ease(){if(Interpolation.LINEAR==this.kind)return TWEEN.Easing.Linear.None;if(Interpolation.EASE_IN==this.kind)return TWEEN.Easing.Quadratic.In;if(Interpolation.EASE_OUT==this.kind)return TWEEN.Easing.Quadratic.Out;if(Interpolation.EASE_IN_OUT==
this.kind)return TWEEN.Easing.Quadratic.InOut}manageCamera(a){var e;let h=View3D.inst.controlsManager.orbitControl;h instanceof OrbitalController&&(h.reversed=this.reversed!=Config.cameraReversedMode,h.setAzimuthalAngle(null),h.setPolarAngle(null));this.camPosition||(this.camPosition=View3D.inst.camera.position);this.targetCam||(this.targetCam=View3D.inst.controlsManager.orbitControl.getTarget());View3D.inst.camera.getWorldDirection(this._forward);this._currentLookAt.copy(View3D.inst.camera.position).add(this._forward);
View3D.inst.controlsManager.setStartTarget(View3D.inst.camera.position,this._currentLookAt);null===(e=View3D.inst.controlsManager.orbitControl)||void 0===e?void 0:e.update();let m={px:View3D.inst.camera.position.x,py:View3D.inst.camera.position.y,pz:View3D.inst.camera.position.z,tx:this._currentLookAt.x,ty:this._currentLookAt.y,tz:this._currentLookAt.z},t,y;(new TWEEN.Tween(m)).easing(this.ease).to({px:this.camPosition.x,py:this.camPosition.y,pz:this.camPosition.z,tx:this.targetCam.x,ty:this.targetCam.y,
tz:this.targetCam.z},this.duration).onUpdate(()=>{var C,I;t=new THREE.Vector3(m.px,m.py,m.pz);y=new THREE.Vector3(m.tx,m.ty,m.tz);if(this.direction){let E=(new THREE.Vector3).subVectors(y,t).multiplyScalar(Motion.PIVOT_OFFSET);y.copy(t).add(E)}View3D.inst.camera.position.copy(t);View3D.inst.camera.updateProjectionMatrix();null===(C=View3D.inst.controlsManager.orbitControl)||void 0===C?void 0:C.setTarget(y);null===(I=View3D.inst.controlsManager.orbitControl)||void 0===I?void 0:I.update()}).onComplete(()=>
{var C,I=View3D.inst.controlsManager.orbitControl;I instanceof OrbitalController&&(I.reversed=this.reversed!=Config.cameraReversedMode,this.azimuthangle&&I.setAzimuthalAngle(this.azimuthangle),this.polarangle&&I.setPolarAngle(this.polarangle));if(this.chain&&(null===(C=null===a||void 0===a?void 0:a.data)||void 0===C?0:C.states)){let E;a.data.states.forEach(H=>{var O;if(null===(O=H.name)||void 0===O?0:O.match("id:"+this.chain))E=H.uuid});E&&(C=new ImplicationData,C.uuid=UUID.generate(),C.inputStatement=
[],C.outputStatement=[],I=new StatementData,I.targetUUID=a.data.uuid,I.triggerType=StatementTrigger.CLICK,C.inputStatement.push(I),I=new StatementData,I.targetUUID=a.data.uuid,I.triggerUUID=E,I.triggerType=StatementTrigger.STATE,C.outputStatement.push(I),ImplicationUtils.triggerFullRun(StatementTrigger.CLICK,[C]))}}).start()}}
class GraphicAnimationScriptData extends AbstractScriptParser{constructor(){super(...arguments);this.kind=AssetAnimType.LR;this.anim=!1;this.duration=AssetAnimator.ANIMATION_DURATION;this.reversed=!1}static getFromName(a){return(a=this.loopOnKeys(this.extractBaseCode(a,"anim"),new GraphicAnimationScriptData))&&a.anim?a:null}parseVal(a,e){this.anim=!0;"kind"==a?this.kind=e:"duration"==a?this.duration=parseFloat(e):"reversed"==a&&(this.reversed=!0)}}
class StatefulElement extends InterestPoint{constructor(a,e){super(a);this._loaded=this._trackable=this._seizable=this._contoured=!1;this._parentInteractivity=this._parentVisibility=this._interactive=this._visible=!0;this._regInteract=/__interact__/ig;this._regFloor=/__floor__/ig;this._regStatic=/__static__/ig;this.type=a.type;this._isPersistent=e;LiveElementsRefHolder.inst.add(this,e);Notifier.subscribe(this,SceneCommand.FIRST_FRAME);if(a.items){this._children=[];for(let h=0;h<a.items.length;++h)this._children.push(new StatefulElement(a.items[h],
e))}}get currentAspectContainer(){return this.aspects.get(this._currentAspectId).container}get currentAspectId(){return this._currentAspectId}get visible(){return this._visible&&this._parentVisibility}get interactive(){return this._interactive&&this._parentInteractivity}get seizable(){return this._seizable}get children(){let a=[];this._trackable?this.aspects.traverse(e=>{a.push(e.container)}):Config.HAS_PHYSICS&&this.aspects.traverse(e=>{e.generatePhysic()==PhysicProfileType.INTERACTIVE&&a.push(e.container)});
return a}get seekable(){return null!=this._seekable?this._seekable:this._seekable=this.type==StatefulElementType.TIMELINE||this.type==StatefulElementType.VIDEO||this.type==StatefulElementType.SOUND}get playable(){return null!=this._playable?this._playable:this._playable=this.type==StatefulElementType.SPRITESHEET||this.type==StatefulElementType.SOUND||this.type==StatefulElementType.VIDEO}get hasVolume(){return null!=this._hasVolume?this._hasVolume:this._hasVolume=this.type==StatefulElementType.SOUND||
this.type==StatefulElementType.VIDEO}get hasClickMap(){return null!=this._hasClickMap?this._hasClickMap:this._hasClickMap=this.type==StatefulElementType.TIMELINE}notify(a){a==SceneCommand.FIRST_FRAME&&(Notifier.unsubscribe(this,a),this._loaded=!0,this.setAnimations(ElementsRefHolder.inst.getRef(this.uuid).animPlaybackStates,!0),Config.HAS_PHYSICS&&!this._trackable&&InteractionTracker.inst.add(this,this._isPersistent),this.setVolume(this.data.volume),this._currentPlayback&&this.setPlayback(this._currentPlayback),
this.playAnimsIfNeeded())}trigger(a){let e;(e=a[this.uuid].aspect)&&this.setAspect(e);(e=a[this.uuid].state)&&this.setState(e);(e=a[this.uuid].time)&&this.seekTo(e);(e=a[this.uuid].anims)&&this.setAnimations(e,!1)}interaction(a,e){if(0!=this._interactive){if(Connection.onLine)if(Connection.inLobby){let h=MultiPlayerScript.getFromName(this.data.name);null===h||void 0===h?void 0:h.handleInteraction();ImplicationUtils.triggerFullRun(a,Config.simulationData.implications[this.uuid]);null===h||void 0===
h?void 0:h.forceHide(this._container)}else Connection.send({action:"interaction",elmUuid:this.uuid,trigger:a});else ImplicationUtils.triggerFullRun(a,Config.simulationData.implications[this.uuid]);this.hasClickMap&&e&&this.aspects.traverse(h=>{h.clicked(e)})}}setAspect(a){if(a&&this._currentAspectId!=a){var e=this.aspects.get(a);if(e){var h;this._currentAspectId&&(h=this.aspects.get(this._currentAspectId))&&(h.setVisibility(!1),this.playable&&h.setPlayback(StatePlaybackType.STOP));this._currentAspectId=
a;e.setVisibility(!0);this.playable&&e.setPlayback(this._currentPlayback);this.hasVolume&&e.setVolume(this.data.volume);this._animations.traverse(m=>{m.setCurrentTarget(e)});this.setChildrenSizeRatio(e.size,!0)}}}setState(a,e){a&&this._currentStateId!=a&&(a=ArrayUtils.find(this.data.states,"uuid",a))&&(this.setInteractivity(a.interactive),this.setVisibility(a.visible),this.setVolume(this._loaded?this.data.volume:0),this.setPlayback(a.playback,e),this.setContoured(a.contoured),this.setSelected(a.selected),
this.setSeizable(a.seizable),this.setChildrenState(a),this._currentStateId=a.uuid,this.checkStateScript(a.name))}bindParent(a){this.aspects&&this.aspects.traverse(e=>{e.bindParent(a)})}bypassState(a){this._parentVisibility=a.visible;this._parentInteractivity=a.interactive;this.setChildrenState(a)}setChildrenSizeRatio(a,e){if(this._children)for(let h=0;h<this._children.length;++h)this._children[h].setChildrenSizeRatio(a);e||(CoordUtils.set3dTransformToRatio(this._container,this.data,a),this.aspects.traverse(h=>
{h.updateSizeRatio(a)}),this._container.updateMatrix())}setChildrenState(a){if(this._children)for(let e=0;e<this._children.length;++e)this._children[e].bypassState(a)}seekTo(a){var e;this.seekable&&(null===(e=this.aspects.get(this._currentAspectId))||void 0===e?void 0:e.seekTo(a))}setAnimations(a,e){var h;for(let m in a)null===(h=this._animations.get(m))||void 0===h?void 0:h.setPlayback(a[m],e)}setVisibility(a){this._visible!=a&&(this._visible=a,this._container.visible=this._visible,InteractionTracker.inst.requestTrackedObjectsRemap())}setInteractivity(a){this._interactive=
this.type!=StatefulElementType.SOUND&&a;this._regFloor.test(this.data.name)&&MotionZone.inst.requestFloorListRemap()}setPlayback(a,e){this._currentPlayback=a;e||this.playable&&this._currentAspectId&&this.aspects.get(this._currentAspectId).setPlayback(a)}setVolume(a){this.hasVolume&&this._currentAspectId&&this.aspects.get(this._currentAspectId).setVolume(a)}launchAnim(a,e,h){this.type!=StatefulElementType.MESH&&this.type!=StatefulElementType.SPRITE&&this.type!=StatefulElementType.TEXT&&this.type!=
StatefulElementType.VIDEO&&this.type!=StatefulElementType.SPRITESHEET||this.aspects.traverse(m=>{m.launchAnim(a,e,h)})}setSelected(a){this.type!=StatefulElementType.MESH&&this.type!=StatefulElementType.SPRITE&&this.type!=StatefulElementType.TEXT&&this.type!=StatefulElementType.VIDEO&&this.type!=StatefulElementType.SPRITESHEET||this.aspects.traverse(e=>{e.changeSelection(a)})}setContoured(a){this._contoured!=a&&(this._contoured=a);this.type==StatefulElementType.TRIGGER&&(a?View3D.inst.renderingController.selectInOutlinePass(this._container,
a):View3D.inst.renderingController.deselectInOutlinePass(this._container))}setSeizable(a){this._seizable!=a&&(this._seizable=a);a=this._trackable;this.checkTracking();a!=this._trackable&&(this._trackable?InteractionTracker.inst.add(this,this._isPersistent):InteractionTracker.inst.remove(this),InteractionTracker.inst.requestTrackedObjectsRemap())}playAnimsIfNeeded(){this._animations.traverse(a=>{a.data.runOnFirstFrame&&(a.data.runOnFirstFrame=!1,a.setPlayback(a.data.playback,!1))})}animStartPointChanged(){this._animations.traverse(a=>
{a.updateStartCoord()})}create(){this.placeContainer();this.checkTracking();this.createAspects();this.createAnimations();this.createChildren();this.setToDefaults();this._trackable&&InteractionTracker.inst.add(this,this._isPersistent);var a=MultiPlayerScript.getFromName(this.data.name);if(a&&(!this._trackable&&a.isInteractive&&(this._trackable=!0,InteractionTracker.inst.add(this,this._isPersistent)),a.handleElementCreation(this._container)))return;this._container.parent||((a=CamScriptData.getFromName(this.data.name))&&
a.attachedToCamera?(this._container.position.set(0,0,0),View3D.inst.camera.add(this._container)):this._isPersistent?View3D.inst.persistentContainer.add(this._container):View3D.inst.elementsContainer.add(this._container))}checkTracking(){this._trackable=ImplicationUtils.searchForTrigger(StatementTrigger.CLICK,Config.simulationData.implications[this.uuid])||this.seizable||this.data.name&&this._regInteract.test(this.data.name)}createAspects(){this.aspects=new MessyDictionary;if(this.data&&this.data.aspects&&
this.data.aspects.length){var a=AnimEffectRefHolder.inst.getAlphaRef(this.uuid),e=this._regFloor.test(this.data.name)?new FloorData:FloorData.getFromName(this.data.name);a==this.data.opacity&&(a=null);this.data.aspects.forEach(h=>{let m=AspectFactory.create(this,h);this._children&&m.bindParent(this.uuid);null!=a&&m.elementOpacityChange(a);let t=AnimEffectRefHolder.inst.getAlphaRef(m.uuid);null!=t&&t!=h.opacity&&m.aspectOpacityChange(t);m.container.userData.owneruuid=this.uuid;this.aspects.add(h.uuid,
m);this._container.add(m.container);this.checkFloorScript(m,e)})}}get opacity(){let a=this.aspects.get(this._currentAspectId);return a?a.opacity:1}set opacity(a){var e;null===(e=this.aspects.get(this._currentAspectId))||void 0===e?void 0:e.elementOpacityChange(a)}createAnimations(){this._animations=new MessyDictionary;if(this.data&&this.data.animations)for(let a=0;a<this.data.animations.length;++a){let e=this.data.animations[a];this._animations.add(e.uuid,AnimFactory.create(e,this))}}createChildren(){if(this._children)for(let a=
0;a<this._children.length;++a){let e=this._children[a];this._container.add(e.container);e.create();e.bindParent(this.uuid)}}setToDefaults(){let a=ElementsRefHolder.inst.getRef(this.uuid);this.setAspect(a.currentAspectId);this.setState(a.currentStateId,!0);ImplicationUtils.triggerFullRun(StatementTrigger.INIT,Config.simulationData.implications[this.uuid])}dispose(){Notifier.unsubscribe(this,SceneCommand.FIRST_FRAME);this._children=this._currentPlayback=this.type=this.data=null;this._animations.traverse(a=>
{a.dispose()});this._animations.empty();this._animations=null;this.aspects&&!this._container.userData.isAvatar&&(this.aspects.traverse(a=>{a.dispose()}),this._container.children.forEach(a=>{this._container.remove(a)}),this.aspects.empty());this._container=this.aspects=null}checkFloorScript(a,e){if(e){var h=this.data.name;if(this._trackable||e||this._regInteract.test(h)||this._regStatic.test(h)){a=a.container;var m=e.visible?this.data.opacity:0;MotionZone.inst.addFloor(a,e);a.traverse(t=>{"Mesh"==
t.type&&(t.material=t.material.clone(),t.material.transparent=!0,t.material.opacity=m)})}}}checkStateScript(a){var e;if(AbstractScriptParser.isScript(a)){var h=SceneCameraEffectData.getFromName(a);h&&h.manageCamera(this);StateTimelineScriptData.getFromName(a)&&console.error("Scripted timeline events are deprecated, please update your project.");Connection.inLobby&&(null===(e=MultiPlayerScript.getFromName(a))||void 0===e?void 0:e.setVisibility(this._container));if(e=this.aspects.get(this._currentAspectId))this.computeCinematic(CinematicData.getFromName(a)),
(h=ClippingStateScriptData.getFromName(a))&&e.clipScript&&this.type==StatefulElementType.MESH&&e.manageClipIntersection(h.clipVisible),h=PhysicScriptData.getFromName(a),Config.HAS_PHYSICS&&h&&View3D.inst.engine.setProps(e.container,h);(e=SceneAnimationEffectData.getFromName(a))&&SceneEffectAnimation.manageSceneAnimationEffect(e);if(e=VoiceRecognitionScriptData.getFromName(a))VoiceRecognition.inst.update(e),VoiceRecognition.inst.startRecognitionFromScript(this.data);if(e=RevertScriptData.getFromName(a))e.explain(),
CheckpointManager.inst.execute(e.checkpointName);(a=GraphicAnimationScriptData.getFromName(a))&&this.launchAnim(a.kind,a.duration,a.reversed)}}computeCinematic(a){var e;a&&"camera"==(null===(e=a.owner)||void 0===e?void 0:e.toLowerCase())&&(a=new THREE.Vector3(a.translatex,Config.STARTED_IN_VR&&WebVRUtils.hasHMD?a.translatey-Config.USER_STANDING_HEIGHT:a.translatey,a.translatez),MotionZone.inst.moveTo(a))}}
class DragNDrop extends Notifiable{constructor(){super();this._movedElementsData=[];this._dragging=!1;this._camSpaceStartTranslation=[0,0];this._droppedObjectsData=[];this._viewUpdateSubscriptions=0;if(null!=DragNDrop._inst)throw Error("This is a singleton");Notifier.subscribe(this,SceneCommand.LOAD_START)}get _movedElemCount(){return this._movedElementsData.length}static get inst(){return this._inst||(this._inst=new DragNDrop)}get isDragging(){return this._dragging||0!=this._movedElemCount}initDomEventHandlers(){PointerManager.inst.setStartHandler(this);
PointerManager.inst.setEndHandler(this);PointerManager.inst.setLongPressHandler(this);PointerManager.inst.setMoveHandler(this)}unsetDomEventHandlers(){PointerManager.inst.unsetEndHandler(this);PointerManager.inst.unsetStartHandler(this);PointerManager.inst.unsetLongPressHandler(this);PointerManager.inst.unsetMoveHandler(this)}notify(a,e){switch(a){case ViewportCommand.UPDATE:this._onUpdate();break;case PointerCommand.START:e.isPrimary&&this._onStartClick();break;case PointerCommand.MOVE:this._onMoveClick();
break;case PointerCommand.END:e.isPrimary&&this._onEndClick();break;case PointerCommand.LONG:this._onLongPress()}}_onUpdate(){for(var a=0;a<this._movedElemCount;++a){var e=this._movedElementsData[a],h=e.element.container;e=(new THREE.Matrix4).copy(h.parent.matrixWorld).invert().multiply(e.controlCamera.matrixWorld).multiply(e.targetMatrix);CoordUtils.lerpObjectToMatrix(h,e,DragNDrop._MOVE_INTERPOLATION_FACTOR)}for(a=this._droppedObjectsData.length;a--;)h=this._droppedObjectsData[a],CoordUtils.lerpObjectToMatrix(h.element.container,
h.targetMat,DragNDrop._ADJUST_INTERPOLATION_FACTOR),++h.animIter==DragNDrop._MAX_ITER&&(this._droppedObjectsData.splice(a,1),this.unsubscribeFromViewUpdate(),h.element.animStartPointChanged(),e={},VarUtils.setVar(h.element.uuid+"targetReached",!0,e),Notifier.unleash(StatefulCommand.VARIABLE_CHANGED,e))}_onStartClick(){if(this._movedElemCount){var a=this._movedElementsData[0],e=InteractionTracker.inst.interactedElement;if(this._dragging=e&&e==a.element)this._toggleOrbitControl(!1),this._camSpaceStartTranslation[0]=
a.targetMatrix.elements[12],this._camSpaceStartTranslation[1]=a.targetMatrix.elements[13],this._dragStartTouchedPosToCam=InteractionTracker.inst.currentIntersection.point.clone().applyMatrix4(View3D.inst.camera.matrixWorldInverse)}}_onEndClick(){Device.isMobile()&&this._dragging?(this._dragging=!1,this._toggleOrbitControl(!0)):!Device.isMobile()&&this._movedElemCount&&(document.exitPointerLock(),this._stopMoving(0),this._invertOrbitControl())}_onMoveClick(){if(this._dragging&&this._movedElemCount){var a=
this._movedElementsData[0],e=View3D.inst.camera,h=PointerManager.inst.get3DMousePos().applyMatrix4(e.projectionMatrixInverse);a.targetMatrix.elements[12]=this._camSpaceStartTranslation[0]-this._dragStartTouchedPosToCam.z*h.x/e.far-this._dragStartTouchedPosToCam.x;a.targetMatrix.elements[13]=this._camSpaceStartTranslation[1]-this._dragStartTouchedPosToCam.z*h.y/e.far-this._dragStartTouchedPosToCam.y}}onGripPressed(a,e,h){for(let m=0;m<this._movedElemCount;++m)if(this._movedElementsData[m].element===
a){this._stopMoving(m);break}this._startMoving(a,e,h)}onGripReleased(a){for(let e=0;e<this._movedElemCount;++e)if(this._movedElementsData[e].controlCamera===a){this._stopMoving(e);break}}_onLongPress(){Device.isMobile()&&this._movedElemCount?this._stopMoving(0):this._startMoving(InteractionTracker.inst.interactedElement,InteractionTracker.inst.currentIntersection,View3D.inst.camera)}_startMoving(a,e,h){if(null!==a&&void 0!==a&&a.seizable){var m=a.container,t=new THREE.Vector3;h.getWorldPosition(t);
e=t.clone().sub(e.point);t=e.length();t=t<DragNDrop._HAND_DISTANCE?new THREE.Vector3:e.clone().multiplyScalar(1-DragNDrop._HAND_DISTANCE/t);e=new THREE.Object3D;m.parent.add(e);e.matrix.copy(m.matrix);for(let y=0;3>y;++y)e.matrix.elements[12+y]+=t.getComponent(y);e.matrixAutoUpdate=!1;e.updateMatrixWorld(!0);m.parent.remove(e);this.subscribeToViewUpdate();a.opacity*=DragNDrop._ALPHA_FACTOR_ON_MOVE;Device.isMobile()||Config.STARTED_IN_VR||(View3D.inst.renderer.domElement.requestPointerLock(),this._invertOrbitControl());
for(m=0;m<this._droppedObjectsData.length;++m)if(this._droppedObjectsData[m].element.container===a.container){this._droppedObjectsData.splice(m,1);this.unsubscribeFromViewUpdate();break}this._movedElementsData.push({element:a,controlCamera:h,targetMatrix:h.matrixWorldInverse.clone().multiply(e.matrixWorld)})}}_stopMoving(a){var e;let h=this._movedElementsData[a].element;h.opacity/=DragNDrop._ALPHA_FACTOR_ON_MOVE;this._movedElementsData.splice(a,1);this.unsubscribeFromViewUpdate();h.animStartPointChanged();
a=h.container.position;let m={};for(var t=0;3>t;t++)VarUtils.setVar(h.uuid+"pos"+t,a.getComponent(t),m);t=new THREE.Vector3;let y=new THREE.Vector3;for(var C=0;3>C;C++){let I=VariableRefHolder.inst.getRefByName("targetPos"+C,h.uuid);I&&t.setComponent(C,I.currentValue);(I=VariableRefHolder.inst.getRefByName("targetRot"+C,h.uuid))&&y.setComponent(C,GeometryUtils.degToRad(I.currentValue))}C=(null===(e=VariableRefHolder.inst.getRefByName("targetRadius",h.uuid))||void 0===e?void 0:e.currentValue)||-1;
a.distanceToSquared(t)<=C*C?(e=(new THREE.Quaternion).setFromEuler(new THREE.Euler(y.x,y.y,y.z,StatefulElementData.DEFAULT_ROTATION_ORDER)),this._droppedObjectsData.push({element:h,targetPos:t,targetMat:(new THREE.Matrix4).compose(t,e,h.container.scale),animIter:0}),this.subscribeToViewUpdate()):(VarUtils.setVar(h.uuid+"targetReached",!1,m),Notifier.unleash(StatefulCommand.VARIABLE_CHANGED,m))}_invertOrbitControl(){let a=View3D.inst.controlsManager.orbitControl;a instanceof OrbitalController&&(a.reversed=
!a.reversed)}_toggleOrbitControl(a){let e=View3D.inst.controlsManager.orbitControl;e instanceof OrbitalController&&(e.enabled=a)}subscribeToViewUpdate(){this._viewUpdateSubscriptions++||Notifier.subscribe(this,ViewportCommand.UPDATE)}unsubscribeFromViewUpdate(){--this._viewUpdateSubscriptions||Notifier.unsubscribe(this,ViewportCommand.UPDATE)}}DragNDrop._HAND_DISTANCE=Config.STARTED_IN_VR?.2:.5;DragNDrop._ALPHA_FACTOR_ON_MOVE=.75;DragNDrop._MOVE_INTERPOLATION_FACTOR=.5;
DragNDrop._ADJUST_INTERPOLATION_FACTOR=.1;DragNDrop._MAX_ITER=200;
class DualGamePad extends GamePadRenderer{constructor(a,e){super();this._carriedObjectLastMat=new THREE.Matrix4;this._carriedObjectVelocity=new THREE.Vector3;this._carriedObjectAngularVelocity=new THREE.Euler;this._manager=e;this.matrixAutoUpdate=!1;this.standingMatrix=new THREE.Matrix4;this.controllerId=a;this.name="Gamepad "+a}updateCoordinates(a){if(!a)return!1;switch(WebVRUtils.sessionType){case SessionType.WebXR:case SessionType.WebXR_AR:let e=a.position;a=a.orientation;this.position.set(e.x,
e.y,e.z);this.quaternion.setFromEuler(new THREE.Euler(.25*-Math.PI,0,0)).premultiply(new THREE.Quaternion(a.x,a.y,a.z,a.w))}this.matrix.compose(this.position,this.quaternion,this.scale);this.matrix.multiplyMatrices(this.standingMatrix,this.matrix);return!0}updateExtra(){this.physicParameter&&(this.physicParameter.position=(new THREE.Vector3).setFromMatrixPosition(this.matrixWorld),this.physicParameter.quaternion=this.quaternion,View3D.inst.engine.setupPosition(this.physicParameter.target,this.physicParameter));
if(this.carriedObject){var a=(new THREE.Matrix4).copy(this._carriedObjectLastMat).invert();this._carriedObjectAngularVelocity.setFromRotationMatrix(a.premultiply(this.carriedObject.matrixWorld.clone()));a=new THREE.Vector3;let e=new THREE.Vector3;a.setFromMatrixPosition(this._carriedObjectLastMat);e.setFromMatrixPosition(this.carriedObject.matrixWorld);this._carriedObjectVelocity.subVectors(a,e);this._carriedObjectLastMat.copy(this.carriedObject.matrixWorld);a=new PhysicParameter;a.position=(new THREE.Vector3).setFromMatrixPosition(this.carriedObject.matrixWorld);
a.quaternion=(new THREE.Quaternion).setFromRotationMatrix(this.carriedObject.matrixWorld);a.carried=!0;View3D.inst.engine.setupPosition(this.carriedObject,a)}}checkRayTargetAction(){super.checkRayTargetAction();this.gripsArePressed!==this._gamepad.buttons[this.gripButtonIdx].pressed&&(this.gripsArePressed=this._gamepad.buttons[this.gripButtonIdx].pressed,this.gripsEvent(this.gripsArePressed))}gripsEvent(a){if(a)if(!this.touched||this.touched.userData.gripIdle)DragNDrop.inst.onGripPressed(this._elementTouched,
this._elementIntersection,this._camera);else this._controller.manageInteraction(ControllerInteraction.GRIP),this.carriedObject=this.touched,this._carriedTargetParent=this.carriedObject.parent,this.physicParameter.target.attach(this.carriedObject),a=new PhysicParameter,a.carried=!0,a.gravity=new THREE.Vector3(0,0,0),View3D.inst.engine.setupPosition(this.carriedObject,a);else if(this.carriedObject){this._carriedTargetParent.attach(this.carriedObject);a=new PhysicParameter;var e=this._deltaTime/2;a.angularVelocity=
new THREE.Vector3(this._carriedObjectAngularVelocity.x/e,this._carriedObjectAngularVelocity.y/e,this._carriedObjectAngularVelocity.z/e);a.linearVelocity=new THREE.Vector3(this._carriedObjectVelocity.x/e,this._carriedObjectVelocity.y/e,this._carriedObjectVelocity.z/e);a.carried=!1;a.gravity=new THREE.Vector3(0,-9.81,0);View3D.inst.engine.setupPosition(this.carriedObject,a);this._controller.manageInteraction(null);(a=LiveElementsRefHolder.inst.getRef(this.carriedObject.userData.owneruuid))?PhysicInteractionManager.manageDrop(a,
()=>{this.carriedObject=null}):this.carriedObject=null}else DragNDrop.inst.onGripReleased(this._camera)}triggerEvent(a){}onHoverStart(a){this._manager.controllerIsDragging||(this._manager.controllerIsDragging=!0,super.onHoverStart(a))}onHoverEnd(a){this._manager.controllerIsDragging=!1;super.onHoverEnd(a)}}
class SoloController extends AbstractController{constructor(a){super(a);this.animationsRef.add(ControllerInteraction.INTERACT,"main_gachette");this.animationsRef.add(ControllerInteraction.GRIP,"main_bouton");this.animationsRef.add(ControllerInteraction.TELEPORT,"main_gachette")}load3DModel(a){this.load(SoloController.SOLO_CONTROLLER_PATH,SoloController.SOLO_CONTROLLER_MODEL,a)}}SoloController.SOLO_CONTROLLER_PATH="./static/assets/vrcontroller/hand/";SoloController.SOLO_CONTROLLER_MODEL="manette.gltf";
class DualGamePadManager{constructor(){this.controllerIsDragging=!1;this.controllers=[];this._needToBeAttached=[];if(DualGamePadManager._inst)throw Error("This is a singleton");}static get inst(){return this._inst||(this._inst=new DualGamePadManager)}init(a){this._container=a}lookForGamepad(){if(!(1<this.controllers.length)){var a=WebVRUtils.getGamepads();for(let m=0;m<a.length;++m){var e=a[m].gamepad;var h=a[m].handedness;this.controllers[m]||null==e||this.createGamepad(m,e,h)}}}createGamepad(a,
e,h){null==h&&(h=Handedness.LEFT);0==a?this._firstControllerHandedness=h:h==this._firstControllerHandedness&&(h=this._firstControllerHandedness==Handedness.RIGHT?Handedness.LEFT:Handedness.RIGHT);window.console.log("controller ",a,h,"-handedness");let m=new DualGamePad(a,this),t;Config.CONTROLLER_DATA.type==ControllerType.HAND?t=new HandController(h):Config.CONTROLLER_DATA.type==ControllerType.BOTH?t=new BothController(h):Config.CONTROLLER_DATA.type==ControllerType.SOLO?t=new SoloController(h):Config.CONTROLLER_DATA.type==
ControllerType.SINGLE&&(t=new SingleController(h));m.createControllerVisual(e,t,()=>{if(Config.HAS_PHYSICS){this._container.updateMatrixWorld(!0);let y=new PhysicScriptData;y.profile=PhysicProfile.GAMEPAD;y.type=PhysicObjectType.BOX;y.physic=!0;y.mass=0;m.physicParameter=PhysicsHelper.addPhysicObject(m,m,y)}});this._container.add(m);this.controllers.push(m);0==a&&this._needToBeAttached.length&&(this._needToBeAttached.forEach(y=>{this.controllers[0].add(y)}),this._needToBeAttached=[])}attachToController(a){this.controllers&&
this.controllers[0]?this.controllers[0].add(a):this._needToBeAttached.push(a)}detachToController(a){this.controllers&&this.controllers[0]&&this.controllers[0].remove(a)}update(){this.lookForGamepad();for(let a=0;a<this.controllers.length;++a)this.controllers[a].update()}getControllers(){return this.controllers}}
class MouseTracker extends Notifiable{constructor(){if(MouseTracker._inst)throw Error("This is a singleton");super();this._skipHints=Config.simulationData.header.hideInteractionHints;this._cursorState="default";this._timeout=0}static get inst(){return this._inst||(this._inst=new MouseTracker)}notify(a,e){this._timeout||(this._timeout=window.setTimeout(()=>this._processMove(),50))}init(){this._skipHints||PointerManager.inst.setMoveHandler(this)}disable(){this._skipHints||(window.clearTimeout(this._timeout),
PointerManager.inst.unsetMoveHandler(this),this._cursorState="default")}_processMove(){this._timeout=0;InteractionTracker.inst.isStarted||this._setCursorState(InteractionTracker.inst.interactedElement?"pointer":"default")}_setCursorState(a){this._cursorState!=a&&(View3D.inst.dom.style.cursor=this._cursorState=a)}}
class MobileTracker extends Notifiable{constructor(){super();this._previousRotation=new THREE.Quaternion;this._trackable=!1;this._hidden=!0;this._currentTarget="";if(null!=MobileTracker._inst)throw Error("Tracker is a singleton");this._tweenedValues={alpha:MobileTracker.BASE_ALPHA,percent:0};this._tweenShow=new TWEEN.Tween(this._tweenedValues);this._tweenHide=new TWEEN.Tween(this._tweenedValues);this._tweenShowProgress=new TWEEN.Tween(this._tweenedValues);this._tweenHideProgress=new TWEEN.Tween(this._tweenedValues)}static get inst(){return this._inst||
(this._inst=new MobileTracker)}notify(a,e){this.update()}init(){PointerManager.inst.setFromMobile();Notifier.subscribe(this,ViewportCommand.UPDATE);if(!this._planeMaterial){this._planeMaterial=new THREE.MeshBasicMaterial;let a=PathUtils.fullPath({bypassPath:!0,mediaFolder:"../static/assets/",paths:["tex_tracker.png"]});(new THREE.TextureLoader).load(a,e=>{this._planeMaterial.map=e;this._planeMaterial.map.wrapS=this._planeMaterial.map.wrapT=THREE.RepeatWrapping;this._planeMaterial.map.repeat.set(MobileTracker.TRACKER_EDGE/
e.image.naturalWidth,MobileTracker.TRACKER_EDGE/e.image.naturalHeight);this._planeMaterial.map.offset.x=0;this._planeMaterial.map.offset.y=1-this._planeMaterial.map.repeat.y;this._planeMaterial.map.needsUpdate=!0;this._planeMaterial.needsUpdate=!0});this._planeMaterial.transparent=!0;this._planeMaterial.alphaTest=.05;this._planeMaterial.blending=THREE.CustomBlending;this._planeMaterial.side=THREE.DoubleSide;this._planeMaterial.opacity=MobileTracker.BASE_ALPHA;this._mesh=new THREE.Mesh(new THREE.PlaneBufferGeometry(MobileTracker.TRACKER_EDGE/
3,MobileTracker.TRACKER_EDGE/3),this._planeMaterial);this._mesh.position.z=100}View3D.inst.hudScene.add(this._mesh)}disable(){this._planeMaterial&&(this.hideTracker(),PointerManager.inst.unsetFromMobile(),Notifier.unsubscribe(this,ViewportCommand.UPDATE),View3D.inst.hudScene.remove(this._mesh))}update(){var a=View3D.inst.camera.quaternion.clone();let e=this._previousRotation.angleTo(a);this._previousRotation=a;if(e>MobileTracker.LIMIT)return this.hideTracker();if(!this._trackable)return this.showTracker();
if(a=InteractionTracker.inst.interactedElement)return this.showClickProgress(a.uuid);this.hideClickProgress()}showTracker(){this._hidden&&(this._hidden=!1,this.startTweenShow())}hideTracker(){this._hidden||(this._trackable=!1,this._hidden=!0,this._tweenShow.stop(),this.hideClickProgress(),this.startTweenHide())}showClickProgress(a){this._currentTarget!=a&&(this._currentTarget=a,this._planeMaterial.opacity=.8,this._tweenHideProgress.stop(),this.startTweenProgressShow())}hideClickProgress(){this._currentTarget&&
(this._currentTarget="",this._tweenShowProgress.stop(),this.startTweenProgressHide())}startTweenShow(){this._tweenShow.isPlaying()||(this._tweenShow=(new TWEEN.Tween(this._tweenedValues)).to({alpha:.6},MobileTracker.ALPHA_DURATION).easing(TWEEN.Easing.Quartic.In).delay(MobileTracker.ALPHA_DELAY).onStart(()=>{this._tweenHide.stop()}).onUpdate(()=>{this.updateAlpha()}).onComplete(()=>{this._trackable=!0}).start())}startTweenHide(){this._tweenHide.isPlaying()||(this._tweenHide=(new TWEEN.Tween(this._tweenedValues)).to({alpha:.4},
MobileTracker.ALPHA_DURATION).easing(TWEEN.Easing.Quartic.Out).delay(MobileTracker.ALPHA_DELAY).onUpdate(()=>{this.updateAlpha()}).start())}startTweenProgressShow(){this._tweenShowProgress.isPlaying()||(this._tweenShowProgress=(new TWEEN.Tween(this._tweenedValues)).to({percent:100},MobileTracker.CLICK_DURATION).easing(TWEEN.Easing.Linear.None).onUpdate(()=>{this.updateProgress()}).onComplete(()=>{InteractionTracker.inst.castInteraction();this.hideClickProgress()}).start())}startTweenProgressHide(){this._tweenHideProgress.isPlaying()||
(this._tweenHideProgress=(new TWEEN.Tween(this._tweenedValues)).to({percent:0},MobileTracker.ALPHA_DURATION).easing(TWEEN.Easing.Quartic.In).onUpdate(()=>{this.updateProgress()}).start())}updateAlpha(){this._planeMaterial.opacity=this._tweenedValues.alpha}updateProgress(){if(this._planeMaterial.map){var a=Math.floor(this._tweenedValues.percent)%10;this._planeMaterial.map.offset.y=1-this._planeMaterial.map.repeat.y-Math.floor(this._tweenedValues.percent/10)*this._planeMaterial.map.repeat.y;this._planeMaterial.map.offset.x=
a*this._planeMaterial.map.repeat.x}}}MobileTracker.LIMIT=.01;MobileTracker.ALPHA_DURATION=600;MobileTracker.ALPHA_DELAY=400;MobileTracker.CLICK_DURATION=1E3;MobileTracker.TRACKER_EDGE=93.091;MobileTracker.BASE_ALPHA=.4;var ControlsMode;(function(a){a[a.HEADSET=1]="HEADSET";a[a.MOBILE_ACCELEROMETER=2]="MOBILE_ACCELEROMETER";a[a.POINTER=3]="POINTER"})(ControlsMode||={});
class ControlsManager extends Notifiable{constructor(){super();this._enabled=!0;this._gamePadManager=this._orbitControl=null;this._startTarget=new THREE.Vector3;MotionZone.inst}updateFOV(){View3D.inst.camera.fov=Config.currentFOV;this._orbitControl&&this._orbitControl.setMaxFOV(Config.currentFOV)}get orbitControl(){return this._orbitControl}get gamePadManager(){return this._gamePadManager}notify(a,e){WebVRUtils.endSession()}setStartTarget(a,e){a=new THREE.Vector3(0,0,.001);this._startAngle=e.angleTo(a);
0>e.x&&(this._startAngle=2*Math.PI-this._startAngle);this._startTarget=e;this._orbitControl&&(this._orbitControl.setTarget(e),Config.USE_ACCELEROMETER&&this._orbitControl.changeOffsetAngle(this._startAngle))}init(){this.enable(!1);this.reset();MotionZone.inst.init(4,4);Config.STARTED_IN_VR&&WebVRUtils.hasHMD?(Notifier.subscribe(this,ImplicationCommand.VR_EXIT),WebVRUtils.isDesktopHMD||WebVRUtils.isDualMobileHMD?this._gamePadManager=DualGamePadManager.inst:WebVRUtils.isMobileHMD&&(this._gamePadManager=
MobileGamepadManager.inst),this._gamePadManager?(this._gamePadManager.init(MotionZone.inst.container),this._orbitControl=null):WebVRUtils.isLikeCardboard&&MobileTracker.inst.init(),this._mode=ControlsMode.HEADSET):Config.STARTED_IN_VR?(this._mode=null,MobileTracker.inst.init()):Config.USE_ACCELEROMETER?(this._quaternionBeforeCompass=View3D.inst.camera.quaternion.clone(),this._orbitControl=new BaseDeviceController,this._orbitControl.setTarget(this._startTarget),this._orbitControl.changeOffsetAngle(this._startAngle||
0),this._mode?(InteractionTracker.inst.initDomEventHandlers(),DragNDrop.inst.initDomEventHandlers()):MobileTracker.inst.init(),this._mode=ControlsMode.MOBILE_ACCELEROMETER):(this._quaternionBeforeCompass&&(View3D.inst.camera.quaternion.set(0,0,0,1),this._quaternionBeforeCompass=null),Device.isMobile()||MouseTracker.inst.init(),this._orbitControl=new OrbitalController,this._orbitControl.update(),InteractionTracker.inst.initDomEventHandlers(),DragNDrop.inst.initDomEventHandlers(),this._mode=ControlsMode.POINTER);
this.enable(!0)}reset(){var a;this._gamePadManager=null;null===(a=this._orbitControl)||void 0===a?void 0:a.disconnect();this._orbitControl=null;InteractionTracker.inst.unsetDomEventHandlers();DragNDrop.inst.unsetDomEventHandlers();MouseTracker.inst.disable();MobileTracker.inst.disable();MotionZone.inst.disable()}update(){this._enabled&&(this._orbitControl&&this._orbitControl.update(),this._gamePadManager&&this._gamePadManager.update())}enable(a){this._enabled=a;this._orbitControl&&(a?this._orbitControl.connect():
this._orbitControl.disconnect())}}class PhysicSharedData{constructor(){this.position={x:0,y:0,z:0};this.quaternion={x:0,y:0,z:0,w:0}}setPosition(a,e,h){this.position.x=a;this.position.y=e;this.position.z=h}setQuaternion(a,e,h,m){this.quaternion.x=a;this.quaternion.y=e;this.quaternion.z=h;this.quaternion.w=m}}
class PhysicEngineLocal{constructor(){this._idCounter=0;this._objectsDictionnary=new MessyDictionary;this._objectsFocusDictionnary=new MessyDictionary;this._currentCollisions=[];this._steppedCollision=[];this._tempPosition=new THREE.Vector3;this._tempQuaternion=new THREE.Quaternion;this._newMatrix=new THREE.Matrix4;this.onMessageCollisionStart=a=>{let e=this._objectsFocusDictionnary.get(a.target);a=this._objectsFocusDictionnary.get(a.focused);if(void 0!==a&&void 0!=a.container.onHoverStart)a.container.onHoverStart(e);
if(void 0!==e&&void 0!=e.container.onHoverStart)e.container.onHoverStart(a)};this.onMessageCollisionEnd=a=>{let e=this._objectsFocusDictionnary.get(a.target);a=this._objectsFocusDictionnary.get(a.focused);if(void 0!==a&&void 0!=a.container.onHoverEnd)a.container.onHoverEnd(e);if(void 0!==e&&void 0!=e.container.onHoverStart)e.container.onHoverEnd(a)}}backgroundEngine(){return!1}init(a,e){Ammo().then(h=>{this._callbackInited=a;this._tempAmmoTransform=new h.btTransform;this._tempAmmoVector=new h.btVector3(0,
0,0);this._tempAmmoQuaternion=new h.btQuaternion(0,0,0,1);this._collisionConfiguration=new h.btDefaultCollisionConfiguration;this._dispatcher=new h.btCollisionDispatcher(this._collisionConfiguration);this._broadphase=new h.btDbvtBroadphase;this._solver=new h.btSequentialImpulseConstraintSolver;this._ammoWorld=new h.btDiscreteDynamicsWorld(this._dispatcher,this._broadphase,this._solver,this._collisionConfiguration);this._callbackInited()})}setDebugAndGravity(a){console.log(" -> gravity : ",a.gravity);
console.log(" -> debug : ",a.debug);a.debug&&(this._debugDrawer=new THREE.AmmoDebugDrawer(View3D.inst.scene,this._ammoWorld),this._debugDrawer.enable());this._gravity=new Ammo.btVector3(a.gravity.x,a.gravity.y,a.gravity.z);this._ammoWorld.setGravity(this._gravity)}add(a){a.target.userData.name=a.name;a.target.matrixAutoUpdate=!1;var e=new Ammo.btVector3(0,0,0);var h=new Ammo.btVector3(0,0,0);var m=new Ammo.btVector3(0,0,0);new Ammo.btVector3(0,0,0);let t=new Ammo.btTransform;if(a.physicObjectType==
PhysicObjectType.REAL){var y=new Ammo.btTriangleMesh;for(let C=0,I=a.vertices.length;C<I;C+=9)e.setValue(a.vertices[C],a.vertices[C+1],a.vertices[C+2]),h.setValue(a.vertices[C+3],a.vertices[C+4],a.vertices[C+5]),m.setValue(a.vertices[C+6],a.vertices[C+7],a.vertices[C+8]),y.addTriangle(e,h,m,!0);h=0===a.mass?new Ammo.btBvhTriangleMeshShape(y,!0,!0):new Ammo.btConvexTriangleMeshShape(y,!0)}else m=new Ammo.btBoxShape(new Ammo.btVector3(.5*a.size.x,.5*a.size.y,.5*a.size.z)),h=new Ammo.btCompoundShape,
t.setIdentity(),y=new Ammo.btVector3(a.center.x,a.center.y,a.center.z),t.setOrigin(y),h.addChildShape(t,m);h.setLocalScaling(new Ammo.btVector3(a.scale.x,a.scale.y,a.scale.z));h.setMargin(.01);m=0===a.mass;t.setIdentity();y=new Ammo.btVector3(a.position.x,a.position.y,a.position.z);t.setOrigin(y);y=new Ammo.btQuaternion(a.quaternion.x,a.quaternion.y,a.quaternion.z,a.quaternion.w);t.setRotation(y);e.setValue(0,0,0);h.calculateLocalInertia(a.mass,e);y=new Ammo.btDefaultMotionState(t);e=new Ammo.btRigidBodyConstructionInfo(a.mass,
y,h,e);e=new Ammo.btRigidBody(e);e.setFriction(a.friction);e.setRestitution(a.restitution);e.setWorldTransform(t);e.activate(!0);if(a.profileType==PhysicProfileType.GAMEPAD)e.setCollisionFlags(e.getCollisionFlags()|4),e.setActivationState(4),m=!1;else if(a.receiveEvents||a.emitEvents)0===a.mass&&e.setCollisionFlags(e.getCollisionFlags()|2),e.setActivationState(4),m=!1;this._ammoWorld.addRigidBody(e,m?2:1,m||2==(e.getCollisionFlags()&2)?-3:-1);a.id=this._idCounter++;this._objectsDictionnary.add(a.uuid,
a);a.body=e;e.setUserIndex(a.id);a.profileType!=PhysicProfileType.INTERACTIVE&&a.profileType!=PhysicProfileType.GAMEPAD||this._objectsFocusDictionnary.add(a.uuid,a)}remove(a){let e=this._objectsDictionnary.get(a.uuid);e&&(this._objectsDictionnary.remove(a.uuid),this._ammoWorld.removeRigidBody(e.body),Ammo.destroy(e.body),this._objectsFocusDictionnary.remove(a.uuid))}setProps(a,e){let h=this._objectsDictionnary.get(a.uuid);h&&(h.enabled=e.enabled,this.updateMass(a,e.mass))}updateMass(a,e){if(a=this._objectsDictionnary.get(a.uuid))this._ammoWorld.removeRigidBody(a.body),
a.body.setMassProps(e,new Ammo.btVector3(0,0,0)),this._ammoWorld.addRigidBody(a.body),a.body.activate()}setupPosition(a,e){if(a&&(a=this._objectsFocusDictionnary.get(a.uuid))){let m=new Ammo.btTransform;m.setIdentity();a.carried=e.carried;if(e.position&&e.quaternion){var h=new Ammo.btVector3(e.position.x,e.position.y,e.position.z);m.setOrigin(h);h=new Ammo.btQuaternion(e.quaternion.x,e.quaternion.y,e.quaternion.z,e.quaternion.w);m.setRotation(h);a.body.getMotionState().setWorldTransform(m);a.body.setWorldTransform(m)}e.gravity&&
(h=new Ammo.btVector3(e.gravity.x,e.gravity.y,e.gravity.z),a.body.setGravity(h));e.angularVelocity&&(h=new Ammo.btVector3(e.angularVelocity.x,e.angularVelocity.y,e.angularVelocity.z),a.body.setAngularVelocity(h));e.linearVelocity&&(h=new Ammo.btVector3(e.linearVelocity.x,e.linearVelocity.y,e.linearVelocity.z),a.body.setLinearVelocity(h))}}render(){this._ammoWorld&&(this._ammoWorld.stepSimulation(.016,1),this._debugDrawer&&this._debugDrawer.update());this._objectsDictionnary.traverse(a=>{0!=a.mass&&
a.enabled&&!a.carried&&(this._tempMotionState=a.body.getMotionState())&&(this._tempAmmoTransform=a.body.getCenterOfMassTransform(),this._tempAmmoVector=this._tempAmmoTransform.getOrigin(),this._tempAmmoQuaternion=this._tempAmmoTransform.getRotation(),this._tempPosition.set(this._tempAmmoVector.x(),this._tempAmmoVector.y(),this._tempAmmoVector.z()),this._tempQuaternion.set(this._tempAmmoQuaternion.x(),this._tempAmmoQuaternion.y(),this._tempAmmoQuaternion.z(),this._tempAmmoQuaternion.w()),this._worldMatrixSource=
(new THREE.Matrix4).makeRotationFromQuaternion(this._tempQuaternion).setPosition(this._tempPosition),this._newMatrix.identity(),a.target.matrix.copy(this._worldMatrixSource),a.target.applyMatrix4(this._newMatrix.copy(a.target.parent.matrixWorld).invert()),a.target.matrixWorldNeedsUpdate=!0)});this.checkCollision()}checkCollision(){var a;this._dispatcher&&(a=this._dispatcher.getNumManifolds());this._steppedCollision=[];let e=0;for(;e<a;e++)if(this._tempManifold=this._dispatcher.getManifoldByIndexInternal(e),
0!==this._tempManifold.getNumContacts()){var h=this._tempManifold.getBody0();var m=this._tempManifold.getBody1();h&&m&&(h=this.getCollisionDataByBody(h),m=this.getCollisionDataByBody(m),h&&m&&h.uuid!==m.uuid&&this._steppedCollision.push(h.uuid+"_"+m.uuid))}for(e=0;e<this._steppedCollision.length;e++){a=!0;for(h=0;h<this._currentCollisions.length;h++)if(this._currentCollisions[h]==this._steppedCollision[e]){a=!1;break}a&&(this._currentCollisions.push(this._steppedCollision[e]),a=this._steppedCollision[e].split("_"),
h=this.getCollisionDataByUUID(a[0]),m=this.getCollisionDataByUUID(a[1]),this.onMessageCollisionStart({message:MESSAGE_TYPE.COLLISION_START,focused:h.uuid,target:m.uuid}))}for(e=this._currentCollisions.length-1;0<=e;e--){a=!0;for(h=0;h<this._steppedCollision.length;h++)if(this._currentCollisions[e]==this._steppedCollision[h]){a=!1;break}a&&(a=this._currentCollisions[e].split("_"),h=this.getCollisionDataByUUID(a[0]),m=this.getCollisionDataByUUID(a[1]),this._currentCollisions.splice(e,1),this.onMessageCollisionEnd({message:MESSAGE_TYPE.COLLISION_END,
focused:h.uuid,target:m.uuid}))}}getCollisionDataByUUID(a){let e=null;this._objectsFocusDictionnary.traverse(h=>{if(h.uuid==a)return e=h,!0},!0);return e}getCollisionDataByBody(a){let e=null,h=a.getUserIndex();this._objectsFocusDictionnary.traverse(m=>{if(m.id===h)return e=m,!0},!0);return e}}
class PhysicEngine{constructor(){this._idCounter=0;this._objectsDictionnary=new MessyDictionary;this._objectsFocusDictionnary=new MessyDictionary;this._newMatrix=new THREE.Matrix4;this._currentQuaternion=new THREE.Quaternion;this._currentPosition=new THREE.Vector3;this.onMessageStep=a=>{this._sharedData=a.sharedData;for(a=0;a<this._sharedData.length;a++)if(this._tempObject=this._objectsDictionnary.get(this._sharedData[a].uuid))this._currentQuaternion.set(this._sharedData[a].quaternion.x,this._sharedData[a].quaternion.y,
this._sharedData[a].quaternion.z,this._sharedData[a].quaternion.w),this._currentPosition.set(this._sharedData[a].position.x,this._sharedData[a].position.y,this._sharedData[a].position.z),this._worldMatrixSource=(new THREE.Matrix4).makeRotationFromQuaternion(this._currentQuaternion).setPosition(this._currentPosition),this._newMatrix.identity(),this._tempObject.target.matrix.copy(this._worldMatrixSource),this._tempObject.target.applyMatrix4(this._newMatrix.copy(this._tempObject.target.parent.matrixWorld).invert()),
this._tempObject.target.matrixWorldNeedsUpdate=!0};this.onMessageCollisionStart=a=>{let e=this._objectsFocusDictionnary.get(a.target);a=this._objectsFocusDictionnary.get(a.focused);if(void 0!==a&&void 0!=a.container.onHoverStart)a.container.onHoverStart(e);if(void 0!==e&&void 0!=e.container.onHoverStart)e.container.onHoverStart(a)};this.onMessageCollisionEnd=a=>{let e=this._objectsFocusDictionnary.get(a.target);a=this._objectsFocusDictionnary.get(a.focused);if(void 0!==a&&void 0!=a.container.onHoverEnd)a.container.onHoverEnd(e);
if(void 0!==e&&void 0!=e.container.onHoverStart)e.container.onHoverEnd(a)};this.onmessage=a=>{a=new Uint8Array(a.data);a=this.UintArrayToString(a);this._tempData=JSON.parse(a);switch(this._tempData.message){case MESSAGE_TYPE.STEP:case "step":this.onMessageStep(this._tempData);break;case MESSAGE_TYPE.COLLISION_START:this.onMessageCollisionStart(this._tempData);break;case MESSAGE_TYPE.COLLISION_END:this.onMessageCollisionEnd(this._tempData);break;case MESSAGE_TYPE.AMMO_LOADED:console.log("Ammo (Bullet) physic engine loaded");
a=this.str2ab(JSON.stringify({message:MESSAGE_TYPE.INIT}));this._worker.postMessage(a.buffer,[a.buffer]);break;case MESSAGE_TYPE.INIT:console.log("Physic engine inited with Y gravity set to -9.81"),this._callbackInited()}}}backgroundEngine(){return!0}init(a,e){this._callbackInited=a;this._sharedData=[];this._worker=new Worker("./static/js/physics/physic-worker.js");this._worker.onerror=h=>{console.log("There is an error with the physic worker",h);e(event)};this._worker.onmessage=this.onmessage;(Device.isIE11()||
Device.isEdge())&&this._callbackInited()}setDebugAndGravity(a){a=this.str2ab(JSON.stringify({message:MESSAGE_TYPE.GRAVITY,gravity:a.gravity}));this._worker.postMessage(a.buffer,[a.buffer])}add(a){a.target.matrixAutoUpdate=!1;a.target.userData.name=a.name;a.id=this._idCounter++;this._objectsDictionnary.add(a.uuid,a);a.profileType!=PhysicProfileType.INTERACTIVE&&a.profileType!=PhysicProfileType.GAMEPAD||this._objectsFocusDictionnary.add(a.uuid,a);a={message:MESSAGE_TYPE.ADD,param:a.getTransfertData()};
a=this.str2ab(JSON.stringify(a));this._worker.postMessage(a.buffer,[a.buffer])}remove(a){this._objectsDictionnary.get(a.uuid)&&(this._objectsDictionnary.remove(a.uuid),this._objectsFocusDictionnary.remove(a.uuid),void 0!=a.userData.physicId&&(a=this.str2ab(JSON.stringify({message:MESSAGE_TYPE.REMOVE,uuid:a.uuid})),this._worker.postMessage(a.buffer,[a.buffer])))}str2ab(a){a=self.btoa(a);a=Array.prototype.slice.call(a).map(e=>e.charCodeAt(0));return new Uint8Array(a)}setProps(a,e){this._objectsDictionnary.get(a.uuid)&&
(a=this.str2ab(JSON.stringify({message:MESSAGE_TYPE.SET_PROPS,uuid:a.uuid,enabled:e.enabled,mass:e.mass})),this._worker.postMessage(a.buffer,[a.buffer]))}setupPosition(a,e){a={message:MESSAGE_TYPE.SET,param:e.getTransfertData()};a=this.str2ab(JSON.stringify(a));this._worker.postMessage(a.buffer,[a.buffer])}render(){let a=this.str2ab(JSON.stringify({message:MESSAGE_TYPE.STEP,delta:.016}));this._worker.postMessage(a.buffer,[a.buffer])}UintArrayToString(a){for(var e="",h=0,m=a.length;h<m;h++)e+=String.fromCharCode(a[h]);
return atob(e)}}
class StatsInfo extends Notifiable{constructor(){super();this.data={performance:null,objects:null,scene:null,shaders:null};this._prevTime=this._beginTime=(performance||Date).now();this._frames=0;Notifier.subscribe(this,SceneCommand.LOAD_START);Notifier.subscribe(this,SceneCommand.LOAD_END);Notifier.subscribe(this,SceneCommand.GENERATION_STARTED);Notifier.subscribe(this,SceneCommand.FIRST_FRAME)}notify(a,e){switch(a){case SceneCommand.LOAD_START:this._beginLoadSceneTime=(performance||Date).now();break;
case SceneCommand.LOAD_END:a=(performance||Date).now();this._sceneLoadingTime=a-this._beginLoadSceneTime;break;case SceneCommand.GENERATION_STARTED:this._beginUploadSceneTime=(performance||Date).now();break;case SceneCommand.FIRST_FRAME:a=(performance||Date).now(),this._sceneUploadTime=a-this._beginUploadSceneTime}}begin(){this._beginTime=(performance||Date).now()}end(){this._frames++;let a=(performance||Date).now();a>=this._prevTime+1E3&&(this._fps=1E3*this._frames/(a-this._prevTime),this._ms=1E3/
this._fps,this._prevTime=a,this._frames=0);return a}update(){this._beginTime=this.end()}realtime(a){window.setInterval(()=>{window.console.log(Math.round(this._ms)+" ms",Math.round(this._fps)+" fps")},a)}get info(){let a=performance.memory;a&&(this._mem=a.usedJSHeapSize/1048576,this._memLimit=a.jsHeapSizeLimit/1048576);let e=0,h;View3D.inst.scene.traverse(m=>{m.geometry&&m.geometry instanceof THREE.BufferGeometry&&(h=m.geometry.getAttribute("position"))&&(e+=h.count)});this.estimateDrawCalls();this.data.performance=
{frame:Math.round(this._ms)+" ms",fps:Math.round(this._fps)+" fps",memorySize:Math.round(this._mem)+" Mo",memorySizeLimit:Math.round(this._memLimit)+" Mo",drawcalls:{estimated:this._estimatedDrawcalls,max:this._maxPossibleDrawcalls}};this.data.objects={sceneElements:this._sceneElements,sceneMaterials:this._sceneMaterials,realtimeGeometries:View3D.inst.renderer.info.memory.geometries,realtimeTextures:View3D.inst.renderer.info.memory.textures,totalOfObjects:View3D.inst.renderer.info.memory.geometries+
View3D.inst.renderer.info.memory.textures,totalOfVertices:e};this.data.scene={loadingTime:Math.round(this._sceneLoadingTime)+" ms",uploadTime:Math.round(this._sceneUploadTime)+" ms"};this.data.shaders={programs:View3D.inst.renderer.info.programs};return this.data}estimateDrawCalls(){const a=Config.currentScene;this._maxPossibleDrawcalls=this._sceneMaterials=this._sceneElements=this._estimatedDrawcalls=1;let e=null,h=new Map,m=new Map;a.elements.forEach(t=>{var y,C,I;if(t.type==StatefulElementType.SPRITE||
t.type==StatefulElementType.SPRITESHEET||t.type==StatefulElementType.TEXT||t.type==StatefulElementType.VIDEO||t.type==StatefulElementType.TRIGGER)this._maxPossibleDrawcalls++,this._sceneElements++,this._sceneMaterials+=t.type==StatefulElementType.TRIGGER?0:1,1==(null===(y=t.states[t.defaultStateUUID])||void 0===y?void 0:y.visible)&&this._estimatedDrawcalls++;if(t.type==StatefulElementType.MESH&&(y=t.aspects.find(E=>E.uuid==t.defaultAspectUUID))&&(e=null===(C=Config.assets.modelElements.get(y.media))||
void 0===C?void 0:C.object)){e.traverse(H=>{if(H instanceof THREE.Mesh&&H.material){let O=1,R=null;H.material&&(R=H.material.uuid,H.material.map&&O++,H.material.lightMap&&O++,H.material.aoMap&&O++,H.material.emissiveMap&&O++,H.material.bumpMap&&O++,H.material.normalMap&&O++,H.material.displacementMap&&O++,H.material.alphaMap&&O++,H.material.envMap&&O++,H.material.roughnessMap&&O++,H.material.metalnessMap&&O++,m.has(R)||m.set(R,O));h.set(H.uuid,R)}this._sceneElements++});let E=0;h.forEach(H=>{E+=H?
m.get(H):1});this._maxPossibleDrawcalls+=E;1==(null===(I=t.states[t.defaultStateUUID])||void 0===I?void 0:I.visible)&&(this._estimatedDrawcalls+=E)}})}}
class View3D extends Notifiable{constructor(){super();this.idle=!0;this.engine=this._compass=null;this.resizeEventHandler=()=>{Device.isIOS()?window.setTimeout(()=>{this.resizeView()},100):this.resizeView()};if(null!=View3D._inst)throw Error("View3D is a singleton");Notifier.subscribe(this,InitCommand.VR_INIT_TESTED);Notifier.subscribe(this,InitCommand.DATA_LOADED);Notifier.subscribe(this,InitCommand.UNLOCK);Notifier.subscribe(this,InitCommand.UNLOCK_FINISHED);Notifier.subscribe(this,SceneCommand.LOAD_START);
Notifier.subscribe(this,SceneCommand.GENERATION_FINISHED);Notifier.subscribe(this,SceneCommand.GENERATION_STARTED);Notifier.subscribe(this,ImplicationCommand.CHANGE_SCENE)}static get inst(){return this._inst||(this._inst=new View3D)}get renderingController(){return this._renderingController}init(a){this.shadersHack();RectAreaLightUniformsLib.init();null==a?(this.dom=document.createElement("div"),this.dom.className="Panel",this.dom.id="viewport",this.dom.style.position="absolute"):this.dom=a;a=this.dom.offsetWidth;
let e=this.dom.offsetHeight;var h=Config.TARGET_STANDARD_FOV;this.camera=new THREE.PerspectiveCamera(h,a/e,.1,5E4);this.loadingCamera=new THREE.PerspectiveCamera(h,a/e,.1,5E4);h=new THREE.OrthographicCamera(-a/2,a/2,e/2,-e/2,-500,1E3);this.camera.name="MainCamera";this.loadingCamera.name="LoadingCamera";h.name="HudCamera";this.camera.position.z=1E-4;this.loadingCamera.position.z=1E-4;h.position.z=500;this.scene=new THREE.Scene;this.hudScene=new THREE.Scene;this.scene.name="MainScene";this.hudScene.name=
"HudScene";this.sceneRef=new THREE.Group;this.sceneRef.name="SceneRef";this.loadingScene=new THREE.Scene;this.loadingScene.name="LoadingScene";this.scene.add(this.sceneRef);this.skyboxContainer=new THREE.Group;this.avatarsContainer=new THREE.Group;this.elementsContainer=new THREE.Group;this.persistentContainer=new THREE.Group;this.skyboxContainer.name="SkyBoxContainer";this.avatarsContainer.name="AvatarsContainer";this.elementsContainer.name="ElementsContainer";this.persistentContainer.name="PersistentContainer";
this.sceneRef.add(this.camera);this.sceneRef.add(this.skyboxContainer);this.sceneRef.add(this.elementsContainer);this.sceneRef.add(this.persistentContainer);this.sceneRef.add(this.avatarsContainer);this.sceneRef.add(h);this.loadingScene.add(this.loadingCamera);this.controlsManager=new ControlsManager;this.stats=new StatsInfo;this.renderer=new THREE.WebGLRenderer({alpha:!0,depth:!0,stencil:!0,antialias:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default",xrCompatible:!0});this.renderer.xr.enabled=
!0;this.renderer.shadowMap.enabled=!1;this.renderer.shadowMap.autoUpdate=!1;this.renderer.shadowMap.type=THREE.PCFSoftShadowMap;this.renderer.outputEncoding=THREE.LinearEncoding;Config.MAX_ANISOTROPY=this.renderer.capabilities.getMaxAnisotropy();this.renderer.autoClear=!1;this.renderer.sortObjects=!0;this.renderer.setSize(a,e,!1);this.renderer.setClearColor(0,0);this.renderer.setPixelRatio(Device.isIPad()?1:window.devicePixelRatio);this._renderingController=new RenderingController(this.renderer,this.scene,
this.camera);this._renderingController.addHUDRendering(this.hudScene,h);this.dom.appendChild(this.renderer.domElement);this.renderer.domElement.addEventListener("touchstart",m=>{m.preventDefault()},!1);this.renderer.domElement.addEventListener("touchend",m=>{m.preventDefault()},!1);(window.frameElement?window.frameElement.contentWindow:window).addEventListener("resize",this.resizeEventHandler);window.console.log("WebGL version",this.renderer.capabilities.isWebGL2?"2.0":"1.1")}shadersHack(){var a=
THREE.ShaderChunk.shadowmap_pars_fragment;a=a.replace("#ifdef USE_SHADOWMAP","#ifdef USE_SHADOWMAP"+PCSS.PCSS_shader_replacement);a=a.replace("#if defined( SHADOWMAP_TYPE_PCF )",PCSS.PCSS_GET_SHADOW_shader_replacement+"#if defined( SHADOWMAP_TYPE_PCF )");THREE.ShaderChunk.shadowmap_pars_fragment=a;a=RegExp("gl_FragColor =","g");var e=[THREE.ShaderLib.phong,THREE.ShaderLib.lambert,THREE.ShaderLib.basic,THREE.ShaderLib.physical];for(var h of e)e=h.fragmentShader,e=e.replace(a,"if(diffuseColor.a < 0.01) discard;\n\tgl_FragColor ="),
h.fragmentShader=e;h=THREE.ShaderLib.depth;h.fragmentShader=h.fragmentShader.replace(a,"if(diffuseColor.a < 0.01) discard;\n\t\n\tgl_FragColor =")}setCameraPositionForVR(){Config.STARTED_IN_VR&&WebVRUtils.hasHMD&&!WebVRUtils.isDesktopHMD&&(this.camera.position.y=-Config.USER_STANDING_HEIGHT)}init3DAudio(){this.audioListener=new THREE.AudioListener;this.audioListener.matrixWorld=new THREE.Matrix4;this.audioListener.position.set(0,0,0);this.camera.add(this.audioListener)}setupPhysic(){let a=!1;for(let e=
0;e<Config.simulationData.scenes.length;++e){let h=PhysicScriptData.getFromName(Config.simulationData.scenes[e].name);if(h){Config.HAS_PHYSICS=!0;h.local&&(a=!0);break}}Config.HAS_PHYSICS?(console.log("Simulation contains physics : initializing..."),a?(console.log("LOCAL physics engine..."),this.engine=new PhysicEngineLocal):(console.log("BACKGROUND physics engine..."),this.engine=new PhysicEngine),this.engine.init(()=>{console.log("Physic engine ready")},e=>{})):console.log("No physics engine needed")}startRendering(){this.stats.begin();
this.renderer.setAnimationLoop((a,e)=>this.render(e))}render(a){this.renderer.clear();Time.calculate();this.stats.update();if(this.idle)try{this.renderer.render(this.loadingScene,this.loadingCamera)}catch(e){console.log("Loader 3D rendering error")}else try{a&&(WebVRUtils.xrFrame=a),TWEEN.update(),Config.HAS_PHYSICS&&this.engine.render(),ElementsRefHolder.inst.hasAChangeInProgress&&ElementsRefHolder.inst.allPending(),VariableRefHolder.inst.hasAChangeInProgress&&VariableRefHolder.inst.allPending(),
Notifier.unleash(ViewportCommand.UPDATE),this.controlsManager.update(),this.scene.updateMatrixWorld(!1),this._renderingController.render(),this._compass&&(this._compass.style.transform="rotate("+(this.camera.rotation.y+3*Math.PI/4)+"rad)")}catch(e){console.log(e)}}resizeView(){let a;if(Config.STARTED_IN_VR){var e=this.renderer.getSize(new THREE.Vector2);let h=this.renderer.xr.currentPixelRatio||1;a=e.x/h;e=e.y/h}else e=window.frameElement?window.frameElement.contentWindow:window,a=e.innerWidth,e=
e.innerHeight,this.renderer.setSize(a,e,!1);this.camera.aspect=a/e;this.camera.updateProjectionMatrix();this.loadingCamera.aspect=a/e;this.loadingCamera.updateProjectionMatrix();this._renderingController.resize(a,e);Notifier.unleash(ViewportCommand.RESIZE)}setControls(a){let e=document.getElementById("compass");if(0==Config.STARTED_IN_VR||0==Config.USE_ACCELEROMETER)Config.USE_ACCELEROMETER=a,0==Config.USE_ACCELEROMETER&&(e.style.transform="rotate(0deg)");this._compass=Config.USE_ACCELEROMETER&&"block"==
e.style.display?e:null;this.controlsManager.init()}setRenderEffect(){Config.DUAL_RENDERING&&(Device.isOculusBrowser&&this.setCameraPositionForVR(),0==Config.STARTED_IN_VR&&this._renderingController.addDualEffect());this.renderer.xr.addEventListener("sessionstart",()=>{this.resizeView()});this.renderer.xr.addEventListener("sessionend",()=>{this.resizeView()});this.resizeView()}removeAll(){var a=Object.keys(TWEEN.getAll()).length;a&&console.log(a,"tweens are still running. Attempting to clean them...");
for(a=this.elementsContainer.children.length-1;0<=a;a--)this.elementsContainer.remove(this.elementsContainer.children[a])}swapScenes(){LoadProgressManager.inst.toggleLabels(this.idle=!this.idle)}notify(a,e){var h;switch(a){case SceneCommand.GENERATION_FINISHED:(a=Object.keys(TWEEN.getAll()).length)&&console.log(a,"leftover tweens have not been cleared from previous scene.");this._renderingController.hide(Config.CURRENT_FADE_DURATION);setTimeout(()=>{var y,C;this.swapScenes();null===(y=this.controlsManager)||
void 0===y?void 0:y.enable(!0);this.renderer.shadowMap.needsUpdate=!0;Notifier.unleash(SceneCommand.FIRST_FRAME);InteractionTracker.inst.requestTrackedObjectsRemap();Config.LAUNCH_FROM_SPHERE_COMPANION&&(null===(C=this.controlsManager.orbitControl)||void 0===C?void 0:C.forceOrientation(Config.SCREEN_ORIENTATION))},100);break;case SceneCommand.GENERATION_STARTED:var m=Config.currentScene.viewPoints[Config.currentScene.startViewPoint]||ViewPointData.defaultViewPoint;this.camera.updateProjectionMatrix();
if(a=this.controlsManager.orbitControl){a.update();var t=(new THREE.Vector3(m.lookAt.x,m.lookAt.y,m.lookAt.z)).divideScalar(1E4);m=new THREE.Vector3(m.position.x,m.position.y,m.position.z);this.camera.position.set(m.x,m.y,m.z);this.camera.updateProjectionMatrix();this.controlsManager.setStartTarget(m,t);a.update()}break;case SceneCommand.LOAD_START:this.removeAll();break;case ImplicationCommand.CHANGE_SCENE:null===(t=this.controlsManager)||void 0===t?void 0:t.enable(!1);this._renderingController.show(Config.CURRENT_FADE_DURATION,
()=>{this.swapScenes();SimulationLoader.inst.initSceneLoad(e)});break;case InitCommand.VR_INIT_TESTED:Notifier.unsubscribe(this,a);this.startRendering();break;case InitCommand.DATA_LOADED:Notifier.unsubscribe(this,a);ElementsRefHolder.inst.init(Config.simulationData);VariableRefHolder.inst.init(Config.simulationData.variables);this.setupPhysic();(null===(h=null===(m=Config.simulationData.header)||void 0===m?void 0:m.hudMap)||void 0===h?0:h.visible)&&new HUDMap;break;case InitCommand.UNLOCK:Notifier.unsubscribe(this,
a);e&&this.init3DAudio();break;case InitCommand.UNLOCK_FINISHED:Notifier.unsubscribe(this,a),this.setControls(Config.USE_ACCELEROMETER),this.setRenderEffect()}}}
class PanoramaVideoRenderer extends VideoRenderer{get texture(){return this._texture}notify(a,e){super.notify(a,e);a==TimeCommand.PAUSED?this.pause(e):a==TimeCommand.RESUMED?this.play(e):a==TimeCommand.SEEK&&this.seekTo(e)}create(){super.create();Notifier.subscribe(this,TimeCommand.PAUSED);Notifier.subscribe(this,TimeCommand.RESUMED);Notifier.subscribe(this,TimeCommand.SEEK)}dispose(){Notifier.unsubscribe(this,TimeCommand.PAUSED);Notifier.unsubscribe(this,TimeCommand.RESUMED);Notifier.unsubscribe(this,
TimeCommand.SEEK);super.dispose()}_setTextureSettings(){super._setTextureSettings();this._texture.format=THREE.RGBFormat;this._texture.wrapS=THREE.ClampToEdgeWrapping;this._texture.wrapT=THREE.ClampToEdgeWrapping}_resumePlaybackFromTicker(){Notifier.unleash(MediaLagCommand.RESUMED)}_pausePlaybackFromTicker(){Notifier.unleash(MediaLagCommand.BUFFERING);this._domVideo.dom.currentTime+=.01}}
class NameOptionsData extends AbstractScriptParser{constructor(){super(...arguments);this.mobilevr=this.HMD=this.desktop=this.mobile=!1}canBeAdded(){return this.mobilevr&&WebVRUtils.hasHMD&&!WebVRUtils.isDesktopHMD||this.HMD&&WebVRUtils.isDesktopHMD||this.mobile&&!WebVRUtils.hasHMD&&Device.isMobile()||this.desktop&&!WebVRUtils.hasHMD&&!Device.isMobile()}static getFromName(a){return(a=this.loopOnKeys(this.extractBaseCode(a),new NameOptionsData))&&(a.mobile||a.desktop||a.HMD||a.mobilevr)?a:null}parseVal(a,
e){if("mobile"==a||"m"==a)this.mobile=!0;else if("desktop"==a||"d"==a)this.desktop=!0;else if("hmd"==a||"vive"==a||"rift"==a)this.HMD=!0;else if("mobilevr"==a||"daydream"==a||"day"==a)this.mobilevr=!0}}
class ScenePanoDepthData extends AbstractScriptParser{constructor(){super(...arguments);this.scale=1}static getFromName(a){return this.loopOnKeys(this.extractBaseCode(a,"depth"),new ScenePanoDepthData)}parseVal(a,e){if("scale"==a)this.scale=parseFloat(e);else if("ref"==a||"reference"==a||"referencemap"==a)this.referencemap=e}}
class SceneSunEffectData extends AbstractScriptParser{constructor(){super(...arguments);this.sun=!1;this.intensity=this.depth=1;this.color=new THREE.Color(16777215)}static getFromName(a){return this.loopOnKeys(this.extractBaseCode(a,"sun"),new SceneSunEffectData)}parseVal(a,e){this.sun=!0;"color"==a&&(this.color=new THREE.Color(e));e=parseFloat(e);"depth"==a?this.depth=parseFloat(e):"intensity"==a&&(this.intensity=parseFloat(e))}}
class Timeline extends StatefulElement{constructor(a){super(Timeline.defaultTimelineData());this._elapsedTime=this.nextEvent=0;this.clock=new THREE.Clock(!1);this.triggers=[];this.implicationStack=[];ElementsRefHolder.inst.add(this.data,!0);this.create();a&&(this.events=a,this.setupTriggers(),this.triggers.length&&(Notifier.subscribe(this,MediaLagCommand.BUFFERING),Notifier.subscribe(this,MediaLagCommand.RESUMED)))}get elapsedTime(){return this._elapsedTime+=this.clock.getDelta()}dispose(){Notifier.unsubscribe(this,
ViewportCommand.UPDATE);Notifier.unsubscribe(this,MediaLagCommand.BUFFERING);Notifier.unsubscribe(this,MediaLagCommand.RESUMED);super.dispose();this.clock=this.implicationStack=this.events=this.triggers=null}notify(a,e){if(a==ViewportCommand.UPDATE)return this.tick();if(a==MediaLagCommand.RESUMED)return this.resume();if(a==MediaLagCommand.BUFFERING)return this.pause()}start(){this.reset();this.resume()}resume(a){Notifier.unleash(TimeCommand.RESUMED,a);Notifier.subscribe(this,ViewportCommand.UPDATE);
this.clock.start()}pause(a){Notifier.unleash(TimeCommand.PAUSED,a);Notifier.unsubscribe(this,ViewportCommand.UPDATE);this._elapsedTime+=this.clock.getDelta();this.clock.stop()}stop(a){Notifier.unleash(TimeCommand.PAUSED,a);Notifier.unsubscribe(this,ViewportCommand.UPDATE);this.clock.stop();this.reset()}reset(){Notifier.unleash(TimeCommand.SEEK,0);this._elapsedTime=this.nextEvent=0}seekTo(a=0){let e=this.triggers.length;this.clock.getDelta();this._elapsedTime=a;this.nextEvent=e--;for(Notifier.unleash(TimeCommand.SEEK,
a);-1<e;--e){if(a>this.triggers[e].time)return;this.nextEvent=e}this.clock.running&&this.nextEvent!=this.triggers.length&&Notifier.subscribe(this,ViewportCommand.UPDATE)}setupTriggers(){for(let a=0;a<this.events.length;++a){let e=this.events[a];for(let h=0;h<e.inputStatement.length;++h){let m=e.inputStatement[h];m.triggerType==StatementTrigger.TIME&&this.triggers.push({time:m.time,idx:a})}}this.triggers.sort((a,e)=>a.time-e.time)}tick(){this.checkNextTrigger();this.implicationStack.length&&(ImplicationUtils.processImplications(this.implicationStack),
this.implicationStack=[])}checkNextTrigger(){if(this.nextEvent==this.triggers.length)return Notifier.unsubscribe(this,ViewportCommand.UPDATE);if(!(this.triggers[this.nextEvent].time>this.elapsedTime)){var a=this.events[this.triggers[this.nextEvent++].idx];ImplicationUtils.fastFulfillsItsStartConditions(a.inputStatement)&&this.implicationStack.push(a);this.checkNextTrigger()}}setToDefaults(){ImplicationUtils.triggerFullRun(StatementTrigger.NONE,Config.simulationData.implications[this.data.uuid])}setPlayback(a){a==
StatePlaybackType.PAUSE?this.pause(!0):a==StatePlaybackType.PLAY?this.resume(!0):a==StatePlaybackType.STOP&&this.stop(!0)}setVisibility(){}setVolume(){}setInteractivity(){}computeCinematic(){}checkFloorScript(){}static defaultTimelineData(){return StatefulElementData.fromObject({uuid:"le_timeline",name:"timeline",type:StatefulElementType.TIMELINE,defaultAspectUUID:"le_timeline_aspect",defaultStateUUID:"le_timeline_play",opacity:0,volume:0,states:[{uuid:"le_timeline_play",name:"playing",visible:!1,
interactive:!0,playback:0},{uuid:"le_timeline_pause",name:"pause",visible:!1,interactive:!0,playback:2},{uuid:"le_timeline_stop",name:"stop",visible:!1,interactive:!0,playback:3}]})}}
class SceneBuilder extends Notifiable{constructor(){super();this._isVideo360=this._isStereoscopic=!1;if(null!=SceneBuilder._inst)throw Error("SceneBuilder is a singleton");Notifier.subscribe(this,SceneCommand.LOAD_START);Notifier.subscribe(this,SceneCommand.LOAD_END);Notifier.subscribe(this,SceneCommand.FIRST_FRAME)}static get inst(){return this._inst||(this._inst=new SceneBuilder)}notify(a,e){switch(a){case SceneCommand.LOAD_START:this._disposeTimeline();EffectsManager.inst.disposeEffects();this._disposeSkyBox();
Config.RENDER_ORDER_OPAQUE=1;Config.RENDER_ORDER_SKYBOX=1E3;Config.RENDER_ORDER_TRANSPARENT=2E3;break;case SceneCommand.LOAD_END:this.generateScene(e);break;case SceneCommand.FIRST_FRAME:this.timeline&&this.timeline.start()}}generateScene(a){Notifier.unleash(SceneCommand.GENERATION_STARTED);let e;a&&(e=ArrayUtils.find(Config.simulationData.scenes,"uuid",a))&&this._loadSceneItems(e,!0);e=Config.currentScene;this._generateTimeline(e.uuid);this._loadSceneItems(e);Notifier.unleash(SceneCommand.GENERATION_FINISHED,
e)}_loadSceneItems(a,e){var h;let m=new ShadowEffectData,t,y,C,I=null;!Config.simulationData.media[a.media]&&a.sky&&EffectsManager.inst.createSimpleSky(a.sky);if(AbstractScriptParser.isScript(a.name)){t=SceneEffectData.getFromName(a.name);y=SceneSkyEffectData.getFromName(a.name);C=SceneSunEffectData.getFromName(a.name);I=SceneCameraEffectData.getFromName(a.name);let E=ShadowEffectData.getFromName(a.name),H=SceneFogEffectData.getFromName(a.name),O=SceneAmbientEffectData.getFromName(a.name),R=SceneLightEffectData.getFromName(a.name),
W=SceneBloomEffectData.getFromName(a.name),ea=PhysicScriptData.getFromName(a.name);MultiPlayerScript.getFromName(a.name);t&&(a.stereo=t.stereo);E&&(m=E);ea&&View3D.inst.engine.setDebugAndGravity(ea);O&&EffectsManager.inst.createAmbientEffect(O);R&&(R.distance=R.distance?R.distance:2*a.sphereRadius,EffectsManager.inst.createFlashLightEffect(R,m));H&&EffectsManager.inst.createFogEffect(H);W&&W.bloom&&EffectsManager.inst.addBloom(W);y&&EffectsManager.inst.createSky(y);C&&(!Device.isMobile()||(null===
m||void 0===m?0:m.mobile))&&EffectsManager.inst.createSunLight(C,m)}a.media&&this._generateSkyBox(a);Config.currentFOV=this._isVideo360?Config.TARGET_VIDEO_FOV:Config.TARGET_STANDARD_FOV;I&&(Config.currentFOV=I.fov);View3D.inst.controlsManager.updateFOV();View3D.inst.camera.updateProjectionMatrix();if(null===(h=a.elements)||void 0===h?0:h.length)this._generateStatefulElements(a.elements,e),Connection.onAvatarObjectsGenerated()}_generateStatefulElements(a,e){let h=[],m=[];a.forEach(t=>{t.type==StatefulElementType.TRIGGER?
m.push(t):t.type==StatefulElementType.VIDEO?h.push(t):this._generateElement(t,e)});h.forEach(t=>{this._generateElement(t,e)});m.forEach(t=>{this._generateElement(t,e)})}_generateElement(a,e){let h=NameOptionsData.getFromName(a.name);h&&!h.canBeAdded()||(new StatefulElement(a,e)).create()}_generateTimeline(a){this.timeline=new Timeline(Config.simulationData.implications[a])}_disposeTimeline(){this.timeline=null}_disposeSkyBox(){this._isVideo360=this._isStereoscopic=!1;this._skyBoxMeshL&&(this._disposeSkyMesh(this._skyBoxMeshL),
this._skyBoxMeshL=null);this._skyBoxMeshR&&(this._disposeSkyMesh(this._skyBoxMeshR),this._skyBoxMeshR=null);this._skyBoxVideoAspect&&(this._skyBoxVideoAspect.dispose(),this._skyBoxVideoAspect=null)}_disposeSkyMesh(a){Config.RENDER_ORDER_SKYBOX--;View3D.inst.skyboxContainer.remove(a);a.geometry.dispose();a=a.material;a.map.dispose();a.dispose()}_generateSkyBox(a){if(!EffectsManager.inst.sky||!EffectsManager.inst.noSkyBackground){a.stereo!=StereoType.NONE&&(this._isStereoscopic=!0);const y=Config.simulationData.media[a.media];
if(y){const C=ScenePanoDepthData.getFromName(a.name);var e=C?256:128,h=a.sphereRadius;var m=new THREE.SphereBufferGeometry(h,e,e);null==this._skyBoxMeshL?(this._skyBoxMeshL=new THREE.Mesh(m,null),this._skyBoxMeshL.scale.set(-1,1,1),View3D.inst.skyboxContainer.add(this._skyBoxMeshL),this._skyBoxMeshL.renderOrder=Config.RENDER_ORDER_SKYBOX++,this._skyBoxMeshL.name="LeftSkyBox"):this._skyBoxMeshL.geometry=m;if(this._isStereoscopic){m=m.attributes.uv;for(var t=0;t<m.count;t++){let I=m.getX(t),E=m.getY(t);
a.stereo==StereoType.TOP_BOTTOM?E*=.5:I*=.5;m.setXY(t,I,E)}m.needsUpdate=!0;if(Config.STARTED_IN_VR||Config.DUAL_RENDERING){e=new THREE.SphereBufferGeometry(h,e,e);null==this._skyBoxMeshR?(this._skyBoxMeshR=new THREE.Mesh(e,null),this._skyBoxMeshR.scale.set(-1,1,1),View3D.inst.skyboxContainer.add(this._skyBoxMeshR),this._skyBoxMeshR.renderOrder=Config.RENDER_ORDER_SKYBOX++,this._skyBoxMeshR.name="RightSkyBox"):this._skyBoxMeshR.geometry=e;e=e.attributes.uv;for(h=0;h<e.count;h++)m=e.getX(h),t=e.getY(h),
a.stereo==StereoType.TOP_BOTTOM?(t*=.5,t+=.5):(m*=.5,m+=.5),e.setXY(h,m,t);e.needsUpdate=!0}}e=ChromaEffectScriptData.getFromName(a.name);PathUtils.stringIsVideo(y.paths[0])?(this._isVideo360=!0,this._skyBoxVideoAspect=new PanoramaVideoRenderer(a.media),this._skyBoxVideoAspect.create(),this._skyBoxVideoAspect.setVolume(a.volume),e&&e.chroma?(a=new ChromakeyEffect(this._skyBoxVideoAspect.texture,e.color,e.threshold),a.transparent=!0):(a=new THREE.MeshBasicMaterial,a.map=this._skyBoxVideoAspect.texture,
a.blending=THREE.NormalBlending,a.side=THREE.BackSide,a.transparent=!1)):(this._isVideo360=!1,a=Config.assets.sceneTexture.get(a.media),e&&e.chroma?(a=new ChromakeyEffect(a,e.color,e.threshold),a.transparent=!0):C?(a=new THREE.MeshStandardMaterial({map:a}),a.side=THREE.BackSide,a.displacementScale=-C.scale,a.displacementMap=(new THREE.TextureLoader).load(PathUtils.fullFolderPath(y)+C.referencemap,I=>{I.minFilter=THREE.NearestFilter;I.format=THREE.RGBFormat;I.generateMipmaps=!1})):(a=new THREE.MeshBasicMaterial({map:a}),
a.side=THREE.BackSide));this._skyBoxMeshL.material=a;this._skyBoxMeshR&&(this._skyBoxMeshL.layers.set(1),this._skyBoxMeshR.material=a,this._skyBoxMeshR.layers.set(2))}this._skyBoxMeshL&&(this._skyBoxMeshL.renderOrder=Config.RENDER_ORDER_SKYBOX++,this._skyBoxMeshR&&(this._skyBoxMeshR.renderOrder=Config.RENDER_ORDER_SKYBOX++));EffectsManager.inst.updateBackgroundRenderTarget()}}}
class ScormAPIWrapper{constructor(a,e){switch(e){case ScormVersion.SCORM_2004:this._initialize=()=>a.Initialize("");this._terminate=()=>a.Terminate("");this._commit=()=>a.Commit("");this._setValue=(h,m)=>a.SetValue(h,m);this._getValue=h=>a.GetValue(h);this._getLastError=()=>a.GetLastError();this._getErrorString=h=>a.GetErrorString(h);this._getDiagnostic=h=>a.GetDiagnostic(h);break;case ScormVersion.SCORM_1_2:this._initialize=()=>a.LMSInitialize(""),this._terminate=()=>a.LMSFinish(""),this._commit=
()=>a.LMSCommit(""),this._setValue=(h,m)=>a.LMSSetValue(h,m),this._getValue=h=>a.LMSGetValue(h),this._getLastError=()=>a.LMSGetLastError(),this._getErrorString=h=>a.LMSGetErrorString(h),this._getDiagnostic=h=>a.LMSGetDiagnostic(h)}}initialize(){return this._stringToBoolean(this._initialize())}terminate(){return this._stringToBoolean(this._terminate())}commit(){return this._stringToBoolean(this._commit())}setValue(a,e){return this._stringToBoolean(this._setValue(a,e))}getValue(a){return this._getValue(a)}getLastError(){let a=
this._getLastError();return!1===a?0:parseInt(a,10)}getCodeInfo(a){return this._getErrorString(a.toString())}getDiagnostic(a){return this._getDiagnostic(a)}_stringToBoolean(a){switch(typeof a){case "object":case "string":return/(true|1)/i.test(a);case "number":return!!a;case "boolean":return a;case "undefined":return null;default:return!1}}}class ScormCmiCode{constructor(){this.VERSION="cmi._version"}}
class ScormCmiCode12 extends ScormCmiCode{constructor(){super(...arguments);this.COMPLETION_STATUS="cmi.core.lesson_status";this.EXIT="cmi.core.exit";this.LOCATION="cmi.core.lesson_location";this.SCORE_SCALED="";this.SCORE_RAW="cmi.core.score.raw";this.SCORE_MIN="cmi.core.score.min";this.SCORE_MAX="cmi.core.score.max";this.SESSION_TIME="cmi.core.session_time";this.SUCCESS_STATUS="cmi.core.lesson_status"}}
class ScormCmiCode2004 extends ScormCmiCode{constructor(){super(...arguments);this.COMPLETION_STATUS="cmi.completion_status";this.EXIT="cmi.exit";this.LOCATION="cmi.location";this.SCORE_SCALED="cmi.score.scaled";this.SCORE_RAW="cmi.score.raw";this.SCORE_MIN="cmi.score.min";this.SCORE_MAX="cmi.score.max";this.SESSION_TIME="cmi.session_time";this.SUCCESS_STATUS="cmi.success_status"}}var ScormVersion;(function(a){a.SCORM_2004="2004";a.SCORM_1_2="1.2"})(ScormVersion||={});
class Scorm{constructor(){this._data=this._cmi=this._wrapper=this._version=null;this._apiIsActive=this._apiIsFound=this._debug=!1;this._exitStatus=this._completionStatus=null;this._handleExitMode=this._handleCompletionStatus=!1;this._interactionCount=-1}set debug(a){this._debug=a}set handleCompletionStatus(a){this._handleCompletionStatus=a}set handleExitMode(a){this._handleExitMode=a}get duration(){if(null==this._startDate)return"00:00:00";var a=new Date,e=a.getMinutes()-this._startDate.getMinutes();
0>e&&(e+=60);let h=a.getSeconds()-this._startDate.getSeconds();0>h&&(h+=60);a=e.toString();let m=h.toString();10>e&&(a="0"+e);10>h&&(m="0"+h);let t=0;59==e&&59==h&&t++;e=t.toString();10>t&&(e="0"+t);return this._version==ScormVersion.SCORM_2004?"PT"+e+"H"+a+"M"+m+"S":e+":"+a+":"+m}start(){this._startDate=new Date}initialize(){this.setupAPI();if(this._apiIsFound){var a=this._wrapper.initialize(),e=this.getCurrentErrorCode();if(a){if(102==e)return this._initFailed(e);this._apiIsActive=!0;if(null!==
e&&this._handleCompletionStatus&&(a=this.status("get"))){switch(a){case "not attempted":this.status("set","incomplete");break;case "unknown":this.status("set","incomplete")}this.save()}}else this._initFailed(e)}else this.trace("Scorm init failed: API is null.")}_initFailed(a){this._apiIsActive=!1;0==a?this.trace("Initialize failed: No response from server."):this.trace("Initialize failed. \nError code: "+a+" \nError info: "+this.getCodeInfo(a))}setObjectives(){var a,e;if(!this._apiIsActive||!Config.simulationData.trackings)return!1;
this._data=Config.simulationData.trackings[0];if(null===(e=null===(a=this._data)||void 0===a?void 0:a.objectives)||void 0===e||!e.length)return!1;for(a=0;a<this._data.objectives.length;a++){e=this._data.objectives[a];let h=0;e.answers.forEach(m=>{m.value?h=Math.max(h,m.value):m.varUuid&&(h=Math.max(h,100))});e.userScore=null;e.maxScore=h;e.manageScore=0!=h}return!0}calculateScores(){let a=0,e=0,h=!0;this._data.objectives.forEach(m=>{m.manageScore&&(null==m.userScore?h=!1:(++e,a+=m.finalScore=m.userScore/
m.maxScore))});return 0<this._data.objectives.length?h?a/e:NaN:NaN}save(){if(!this._apiIsActive)return!1;this.setToScorm(this._cmi.SESSION_TIME,this.duration);return this._wrapper.commit()}terminate(){if(!this._apiIsActive)return!1;this._handleExitMode&&!this._exitStatus&&this.setToScorm(this._cmi.EXIT,"completed"!==this._completionStatus&&"passed"!==this._completionStatus?"suspend":this._version==ScormVersion.SCORM_2004?"normal":"");let a=this.save();if(a)if(a=this._wrapper.terminate())this._apiIsActive=
!1;else{const e=this.getCurrentErrorCode();this.trace("terminate failed. \nError code: "+e+" \nError info: "+this.getCodeInfo(e))}return a}trackInteraction(a,e){if(this._apiIsActive){var h=ArrayUtils.find(this._data.objectives,"uuid",e.targetUUID);if(h&&(e=ArrayUtils.find(h.answers,"uuid",e.triggerUUID))){if(e.answerType==AnswerType.VARIABLE){var m=VariableRefHolder.inst.getRef(e.varUuid);if(m.type!=VariableType.NUMBER)return;e.value=Math.min(h.maxScore,m.currentValue)}h.userScore=Math.max(h.userScore,
e.value);m=this._version;h="cmi.interactions."+ ++this._interactionCount+".";a=this._interactionCount+"_"+TextUtils.replaceUnicodeChars(a);var t=m==ScormVersion.SCORM_2004?"other":"fill-in";m=m==ScormVersion.SCORM_2004?"PT0H0M0S":"00:00:00";this.setToScorm(h+"id",a);this.setToScorm(h+"type",t);this._version==ScormVersion.SCORM_2004?(this.setToScorm(h+"learner_response",e.description),this.setToScorm(h+"description",e.description)):this.setToScorm(h+"student_response",e.description);this.setToScorm(h+
"result","correct");this.setToScorm(h+"weighting",e.value);this.setToScorm(h+"latency",m);this.save()}}}finalize(a=!1){if(this._apiIsActive){var e=this.calculateScores();this._data.objectives.forEach((h,m)=>{h.manageScore&&(this.setToScorm("cmi.objectives."+m+".id","objective_"+(m+1)),isNaN(e)||(this.setToScorm("cmi.objectives."+m+".score.raw",100*h.finalScore),this.setToScorm("cmi.objectives."+m+".score.min",0),this.setToScorm("cmi.objectives."+m+".score.max",100),this._version==ScormVersion.SCORM_2004&&
this.setToScorm("cmi.objectives."+m+".score.scaled",h.finalScore)),this._version==ScormVersion.SCORM_2004?(this.setToScorm("cmi.objectives."+m+".description",h.name),this.setToScorm("cmi.objectives."+m+".success_status","passed"),this.setToScorm("cmi.objectives."+m+".completion_status","completed")):this.setToScorm("cmi.objectives."+m+".status","completed"))});isNaN(e)?0<this._data.objectives.length?(this.setToScorm(this._cmi.COMPLETION_STATUS,"incomplete"),this.setToScorm(this._cmi.SUCCESS_STATUS,
this._version==ScormVersion.SCORM_2004?"unknown":"failed")):(this.setToScorm(this._cmi.COMPLETION_STATUS,a?"completed":"incomplete"),this.setToScorm(this._cmi.SUCCESS_STATUS,a?"passed":"failed")):(a=100*e,this.setToScorm(this._cmi.SCORE_RAW,a),this.setToScorm(this._cmi.SCORE_MIN,0),this.setToScorm(this._cmi.SCORE_MAX,100),this._version==ScormVersion.SCORM_2004&&this.setToScorm(this._cmi.SCORE_SCALED,e),this.setToScorm(this._cmi.COMPLETION_STATUS,"completed"),a>=this._data.successRate?this.setToScorm(this._cmi.SUCCESS_STATUS,
"passed"):this.setToScorm(this._cmi.SUCCESS_STATUS,"failed"));this.terminate()}}status(a,e=null){let h;if(null===a)return this.trace("Status action was not specified."),null;h=this._cmi.COMPLETION_STATUS;switch(a){case "get":a=this.getFromScorm(h);break;case "set":null!==e?a=this.setToScorm(h,e):(a=!1,this.trace("Setting status : status was not specified."));break;default:a=!1,this.trace("Setting status : no valid action was specified.")}return a}setToScorm(a,e){if(!this._apiIsActive)return!1;let h=
this._wrapper.setValue(a,e);h?a===this._cmi.COMPLETION_STATUS&&(this._completionStatus=e):(a=this.getCurrentErrorCode(),this.trace("setToScorm failed. \nError code: "+a+". \nError info: "+this.getCodeInfo(a)));return h}getFromScorm(a){if(!this._apiIsActive)return this.trace("getFromScorm failed : API connection is inactive"),"";let e=this._wrapper.getValue(a),h=this.getCurrentErrorCode();""!==e||0===h?a==this._cmi.COMPLETION_STATUS?this._completionStatus=e:a==this._cmi.EXIT&&(this._exitStatus=e):
this.trace("getFromScorm failed. \nError code: "+h+"\nError info: "+this.getCodeInfo(h));this.trace("getFromScorm result : "+e);return String(e)}setupAPI(){this.findAPI(window);this._apiIsFound||(window.parent&&window.parent!=window?this.findAPI(window.parent):window.top&&window.top.opener?this.findAPI(window.top.opener):window.top.opener&&window.top.opener.document?this.findAPI(window.top.opener.document):this.trace("Setup of SCORM failed: Can't find the SCORM API!"))}findAPI(a){if(!this._apiIsFound){var e=
0;try{for(;!a.API_1484_11&&!a.API&&a.parent&&a.parent!=a&&500>=e;)e++,a=a.parent;a.API_1484_11?(this._apiIsFound=!0,this._version=ScormVersion.SCORM_2004,this._wrapper=new ScormAPIWrapper(a.API_1484_11,this._version),this._cmi=new ScormCmiCode2004):a.API&&(this._apiIsFound=!0,this._version=ScormVersion.SCORM_1_2,this._wrapper=new ScormAPIWrapper(a.API,this._version),this._cmi=new ScormCmiCode12);this._apiIsFound?this.trace("SCORM API found. Version: "+this._version):this.trace("Error finding API. \nFind attempts: "+
e+". \nFind attempt limit: 500")}catch(h){console.log(h)}}}getCurrentErrorCode(){let a=0;this._apiIsFound?a=this._wrapper.getLastError():this.trace("getCurrentErrorCode failed: API is null.");return a}getCodeInfo(a){let e="";this._apiIsFound?e=this._wrapper.getCodeInfo(a):this.trace("getDebugInfo failed: API is null.");return String(e)}getDiagnosticInfo(a){let e;this._apiIsFound?e=this._wrapper.getDiagnostic(a):this.trace("getDiagnosticInfo failed: API is null.");return String(e)}trace(a){this._debug&&
window.console&&window.console.log&&window.console.log(a)}}
class Tom{constructor(a,e){this._apiIsActive=this._apiIsFound=!1;this.parent=a;this.dataAPI=e}setupAPI(){this.findAPI(window);this._apiIsFound||(window.parent&&window.parent!=window?this.findAPI(window.parent):window.top&&window.top.opener?this.findAPI(window.top.opener):window.top.opener&&window.top.opener.document?this.findAPI(window.top.opener.document):console.log("Setup of ToM failed: Can't find the ToM API!"))}findAPI(a){var e;if(!this._apiIsFound){var h=0;try{for(;!a.ToM&&a.parent&&a.parent!=
a&&500>=h;)h++,a=a.parent;a.ToM&&(this._apiIsFound=!0,this.api=a.ToM,null===(e=this.api)||void 0===e?0:e.utils)&&(this.api.utils.enableWakeLock(),document.getElementById("close").style.display="block",document.getElementById("close").onmousedown=()=>{this.parent.finaliseTracking();this.close();this.dataAPI.onClose()})}catch(m){console.log(m)}}}initialize(){this.setupAPI()}close(){var a;(null===(a=this.api)||void 0===a?0:a.utils)&&this.api.utils.close()}}
class Storyline extends Notifiable{notify(a,e){this._player.SetVar(e.name,e.value)}init(){window.top==window||(this._player=this.getPlayer(window.top))||this.recursiveIframeSearch(window.top);this._player?(Notifier.subscribe(this,ImplicationCommand.SET_STORYLINE_VAR),Device.isInStoryline=!0):Device.isInStoryline=!1}recursiveIframeSearch(a){a=a.document.getElementsByTagName("iframe");for(let e=0;e<a.length;++e)if((this._player=this.getPlayer(a[e].contentWindow))||this.recursiveIframeSearch(a[e].contentWindow))return!0;
return!1}getPlayer(a){return a.GetPlayer?(this.hackMobileStorylineScale(a),a.GetPlayer()):null}hackMobileStorylineScale(a){if(Device.isMobile()&&(a=a.document.getElementsByClassName("webobject"))&&a.length){a=a[0];var e=a.style.transform.match(/[0-9.]+/),h=a.style.width.match(/\d+/),m=a.style.height.match(/\d+/);e&&h&&m&&(e=parseFloat(e[0]),h=parseInt(h[0]),m=parseInt(m[0]),a.style.transform="",a.style.width=h*e+"px",a.style.height=m*e+"px")}}}
class DataApi{constructor(){this.onRawInteractions=a=>{};this.onUserInteraction=a=>{};this.onMediaEndInteraction=a=>{};this.onTracking=(a,e)=>{};this.onTerminate=()=>{};this.onLoaded=()=>{};this.onInitialized=()=>{};this.onStart=()=>{};this.onClose=()=>{}}}
class Traces extends Notifiable{constructor(){super();this._scorm=new Scorm;this._storyline=new Storyline;this._api=new DataApi;this._tom=new Tom(this,this._api);window.sphere=window.traces=this;this._scorm.handleExitMode=!1;this._scorm.handleCompletionStatus=!1;window.addEventListener("DOMContentLoaded",()=>{this._domLoaded()});window.addEventListener("beforeunload",()=>{this.finaliseTracking();this._api.onClose()})}get scorm(){console.info("Getting the .scorm object through traces is not recommended, as you're stepping in uncharted territory.",
"You might want to consider using either implications in your project design,","or simpler public API methods such as .setToScorm() or .finaliseTracking()");return this._scorm}get tomAPI(){return this._tom.api}notify(a,e){switch(a){case ImplicationCommand.RAW_TRACKING_INTERACTION:this._api.onRawInteractions(e);break;case ImplicationCommand.ON_TRACKING_INTERACTION:if(e.trigger==StatementTrigger.CLICK)this._api.onUserInteraction(e.name);else if(e.trigger==StatementTrigger.MEDIA_END)this._api.onMediaEndInteraction(e.name);
break;case ImplicationCommand.MANAGE_TRACKING:this._manageTracking(e.implicationName,e.statement);break;case InitCommand.UNLOCK_FINISHED:Notifier.unsubscribe(this,a);this._initTracking();break;case SceneCommand.LOAD_END:Notifier.unsubscribe(this,a),this._startTime()}}_domLoaded(){this._api.onLoaded();Notifier.subscribe(this,ImplicationCommand.RAW_TRACKING_INTERACTION);Notifier.subscribe(this,ImplicationCommand.ON_TRACKING_INTERACTION);Notifier.subscribe(this,SceneCommand.LOAD_END);Notifier.subscribe(this,
InitCommand.UNLOCK_FINISHED);this._scorm.initialize();this._tom.initialize();this._storyline.init();this._api.onInitialized()}_initTracking(){this._scorm.setObjectives()&&Notifier.subscribe(this,ImplicationCommand.MANAGE_TRACKING)}_startTime(){this._scorm.start();this._api.onStart()}_manageTracking(a,e){e.triggerType==StatementTrigger.SCORM?this._interactionTracking(a,e):this.finaliseTracking(!0)}_interactionTracking(a,e){this._scorm.trackInteraction(a,e);this._api.onTracking(a,e)}finaliseTracking(a=
!1){this._scorm.finalize(a);this._api.onTerminate()}setToScorm(a,e){"string"==typeof a&&(this._scorm.setToScorm(a,e),this._scorm.save(),this._api.onTracking(a,null))}set onRawInteractions(a){"function"==typeof a&&(this._api.onRawInteractions=a)}set onUserInteraction(a){"function"==typeof a&&(this._api.onUserInteraction=a)}set onMediaEndInteraction(a){"function"==typeof a&&(this._api.onMediaEndInteraction=a)}set onTracking(a){"function"==typeof a&&(this._api.onTracking=a)}set onTerminate(a){"function"==
typeof a&&(this._api.onTerminate=a)}set onLoaded(a){"function"==typeof a&&(this._api.onLoaded=a)}set onInitialized(a){"function"==typeof a&&(this._api.onInitialized=a)}set onStart(a){"function"==typeof a&&(this._api.onStart=a)}set onClose(a){"function"==typeof a&&(this._api.onClose=a)}}class Localisation{static get inst(){return this._inst||(this._inst="en"==Config.LANGUAGE?new LocalisationEN:new LocalisationFR)}}
class LocalisationFR extends Localisation{constructor(){super(...arguments);this.PWA_BASE_TEXT="installer l'exp\u00e9rience en tant qu'app sur votre p\u00e9riph\u00e9rique";this.CACHE_BASE_TEXT="pr\u00e9-charger l'exp\u00e9rience sur votre navigateur pour un usage hors-ligne";this.CACHE_UPDATING="Mise \u00e0 jour";this.CACHE_PWA_OFFLINE="Mode hors ligne";this.PWA_INSTALL_PROGRESS="installation en cours...";this.PWA_INSTALL_COMPLETE="installation termin\u00e9e";this.PWA_CACHE_UPDATE_COMPLETE="mise \u00e0 jour termin\u00e9e";
this.CACHE_COMPLETE="pr\u00e9chargement termin\u00e9";this.OCULUS_INFO="Suite au pr\u00e9-chargement, cliquez sur <img src='./static/assets/help/shortcut.png'> pour cr\u00e9er un raccourci pour cette exp\u00e9rience <img src='./static/assets/help/up.png'>";this.CHROME_EDGE_INFO="Cliquez sur <img src='./static/assets/help/plus.png'> pour installer ou <img src='./static/assets/help/launch.png'> pour lancer cette exp\u00e9rience sur votre ordinateur <img src='./static/assets/help/up.png'>";this.PROJECT_ERROR=
"Votre projet comporte des erreurs qui ne permettent pas de l'afficher, ou un bug a caus\u00e9 un export d\u00e9fectueux. Si le probl\u00e8me persiste apr\u00e8s v\u00e9rification de l'\u00e9l\u00e9ment nomm\u00e9 ci-dessous, et si sa reconstruction ne r\u00e8gle pas le probl\u00e8me, merci de nous le signaler via le menu d'aide.";this.ERROR="Une erreur interne est survenue. Si vous continuez \u00e0 utiliser cette exp\u00e9rience, elle risque de ne plus fonctionner correctement.";this.LAUNCH_360=
"Lancer en 360\u00b0";this.LAUNCH_VR="Lancer en RV";this.LAUNCH_AR="Lancer en RA";this.CONTENT_DIV_ERROR="<h3>Contenu Indisponible</h3>L'acc\u00e8s \u00e0 des liens externes via les implications est indisponbile en mode de test.<br/>Merci de r\u00e9essayer apr\u00e8s avoir export\u00e9.<br/><br/><span style=\"font-size:26px;font-style:italic\">Cliquez n'importe o\u00f9 pour fermer la fen\u00eatre</span>";this.NAME_SET_PROMPT="Dites-moi tout...";this.NAME_SET_ERROR="Saisie invalide : nom trop long ou erron\u00e9";
this.LOAD_LABEL="Chargement"}}
class LocalisationEN extends Localisation{constructor(){super(...arguments);this.PWA_BASE_TEXT="install the experience as an app on your device";this.CACHE_BASE_TEXT="preload the experience on the browser for offline usage";this.CACHE_UPDATING="Updating";this.CACHE_PWA_OFFLINE="Offline mode";this.PWA_INSTALL_PROGRESS="install in progress...";this.PWA_INSTALL_COMPLETE="install complete";this.PWA_CACHE_UPDATE_COMPLETE="update complete";this.CACHE_COMPLETE="preloading complete";this.OCULUS_INFO="After preload, click on <img src='./static/assets/help/shortcut.png'> to create a shortcut for this experience <img src='./static/assets/help/up.png'>";
this.CHROME_EDGE_INFO="Click on <img src='./static/assets/help/plus.png'> to install or <img src='./static/assets/help/launch.png'> to launch this experience on your computer <img src='./static/assets/help/up.png'>";this.PROJECT_ERROR="Your project contains errors that prevent it from being read, or a bug lead to a faulty export. If the problem persists after checking and/or rebuilding the aforementioned element, please report it to us via the help menu.";this.ERROR="An internal error occurred. If you continue using this experience, it might no longer work as expected.";
this.LAUNCH_360="Launch in 360\u00b0";this.LAUNCH_VR="Launch in VR";this.LAUNCH_AR="Launch in AR";this.CONTENT_DIV_ERROR='<h3>Content Unavailable</h3>The access to external links through implications cannot work in testing mode.<br/>Please try again after exporting the project.<br/><br/><span style="font-size:26px;font-style:italic">Click anywhere to close the pop-up</span>';this.NAME_SET_PROMPT="Okay, I'm listening...";this.NAME_SET_ERROR="Bad input: name is invalid or too long";this.LOAD_LABEL=
"Loading"}}
class CacheService extends Notifiable{constructor(){super();this._synched=!1;this.synch=document.getElementById("synch");this.divPWA=document.getElementById("pwa-div");this.btnPWA=document.getElementById("btn-install-pwa");this.btnPWAText=document.getElementById("btn-install-pwa-text");this.divDownload=document.getElementById("preload-div");this.btnDownload=document.getElementById("btn-preload");this.btnDownloadProgress=document.getElementById("btn-preload-progress");this.btnDownloadText=document.getElementById("btn-preload-text");
this.domText=document.getElementById("synch-text");this.serviceReady=!1;this.synchIndex=0;this.filePromiseDictionnary=new MessyDictionary;this.fileExist=a=>__awaiter(this,void 0,void 0,function*(){if(this.filePromiseDictionnary.has(a))return this.filePromiseDictionnary.get(a).value;let e,h=new Promise((m,t)=>{e=m;this.registration.active.postMessage({message:"fileexist",uri:a})});this.filePromiseDictionnary.add(a,{promiseresolve:e,value:null});return h});if(null!=CacheService._inst)throw Error("CacheService is a singleton");
Device.isInFrame()||Device.isFirefoxReality()||(this.registerServiceWorker(),Notifier.subscribe(this,InitCommand.DATA_LOADED))}static get inst(){return this._inst||(this._inst=new CacheService)}notify(a,e){Notifier.unsubscribe(this,a);this.init(Config.simulationData.header.uuid)}initCacheReadyService(a,e){this.btnDownloadText.innerText=Localisation.inst.CACHE_BASE_TEXT;this.btnPWAText.innerText=Localisation.inst.PWA_BASE_TEXT;e.postMessage("hi!");this.synch.style.display="block";Config.PWA_APP?(this.divDownload.style.display=
"block",this.divDownload.style.cursor="none",this.btnDownloadText.innerText=Localisation.inst.CACHE_UPDATING,navigator.onLine?this.startSynch(a,e):this.btnDownloadText.innerText=Localisation.inst.CACHE_PWA_OFFLINE):navigator.onLine?this.divDownload.onclick=()=>{this.divDownload.style.cursor="none";this.startSynch(a,e)}:this.btnDownloadText.innerText=Localisation.inst.CACHE_PWA_OFFLINE}init(a){let e;if(!Config.simulationData.header.allowSync||!navigator.serviceWorker||"https:"!=window.location.protocol)return console.info("Service workers are unavailable"),
this.disable();!Config.PWA_APP&&Device.isOculusBrowser?(document.getElementById("synch-info-div").style.display="block",document.getElementById("synch-info-text").style.right="152px",document.getElementById("synch-info-text").innerHTML=Localisation.inst.OCULUS_INFO):!Config.PWA_APP&&Device.isMobile()?(window.addEventListener("beforeinstallprompt",h=>{h.preventDefault();e=h;this.divPWA.style.display="block"}),this.divPWA.onclick=()=>{this.btnPWA.style.backgroundColor="#FFFFFF";this.btnPWA.style.cursor=
"none";this.btnPWAText.innerText=Localisation.inst.PWA_INSTALL_PROGRESS;e.prompt();e.userChoice.then(h=>{"accepted"!==h.outcome&&(this.btnPWA.style.backgroundColor="#6058C5",this.btnPWA.style.cursor="cursor",this.btnPWAText.innerText=Localisation.inst.PWA_BASE_TEXT)})},window.addEventListener("appinstalled",h=>{this.btnPWAText.innerText=Localisation.inst.PWA_INSTALL_COMPLETE})):Config.PWA_APP||!Device.isChrome()&&!Device.isEdge()||(document.getElementById("synch-info-text").style.right=Device.isChrome()?
"175px":"233px",document.getElementById("synch-info-div").style.display="block",document.getElementById("synch-info-text").innerHTML=Localisation.inst.CHROME_EDGE_INFO);try{navigator.serviceWorker.onmessage=h=>{try{let m="string"==typeof h.data?JSON.parse(h.data):h.data;if(m)this.onCacheMessage(m)}catch(m){console.error("Bad cache data")}},navigator.serviceWorker.ready.then(h=>{this.registration=h;console.info("[CacheService] Ready (after simulation loading)");this.initCacheReadyService(a,this.registration.active)}).catch(h=>
{console.warn("[CacheService] Registration ready error",h);this.disable()})}catch(h){console.warn("[CacheService] Worker initialization error",h),this.disable()}}disable(){this.synch.style.display="none";this.registration&&this.registration.unregister().then(a=>{this.registration=null})}registerService(){navigator.serviceWorker.register("./cache.js").then(a=>{this.registration=a;console.info("[CacheService] Registered")}).catch(a=>{console.warn("[CacheService] Registration rejected",a);this.disable()})}registerServiceWorker(){var a;
try{null===(a=navigator.serviceWorker)||void 0===a?void 0:a.getRegistration().then(e=>{e&&(this.registration=e,this.registration.unregister().then(h=>{this.registration=null}));this.registerService()})}catch(e){console.warn("[CacheService] Worker registration error",e),this.disable()}}startSynch(a,e){this.synchIndex=0;e.postMessage({message:"start",uuid:a})}onCacheMessage(a){if("fileexist"==a.message)console.log("fileexist from base channel"),this.filePromiseDictionnary.get(a.uri).promiseresolve(a.value);
else if("synched"==a.message)this.synchIndex=0,this._synched=!0,this.btnDownloadText.innerText=Config.PWA_APP?Localisation.inst.PWA_CACHE_UPDATE_COMPLETE:Localisation.inst.CACHE_COMPLETE,this.btnDownloadProgress.style.width="240px",console.log("[CacheService] Caching complete");else if(this._synched||"synch"!=a.message)"error"==a.message&&a.error&&console.warn("[CacheService]",a.error);else{let e;a.index&&(a=100*a.index/a.len,e=240*a/100,this.btnDownloadText.innerText=a.toFixed(2)+"%",this.btnDownloadProgress.style.width=
e+"px")}}}class UIElement extends Notifiable{constructor(a){super();this.dom=a}setId(a){this.dom.id=a;return this}setClass(a){this.dom.className=a;return this}setStyle(a,e){for(var h=0;h<e.length;h++)this.dom.style[a]=e[h]}setDisabled(a){this.dom.disabled=a;return this}setTextContent(a,e=!1){e?this.dom.appendChild(a):this.dom.textContent=a;return this}}
class Panel extends UIElement{constructor(a=null){null==a&&(a=document.createElement("div"),a.className="Panel");super(a)}add(a){for(let e=0;e<a.length;e++){let h=a[e];h instanceof UIElement?this.dom.appendChild(h.dom):h instanceof HTMLElement?this.dom.appendChild(h):console.error("Panel:",h,"is not an instance of UIElement.")}}remove(a){for(let e=0;e<a.length;e++){let h=a[e],m=0,t=this.dom.childNodes.length;if(h instanceof UIElement)for(;m<t;m++){if(this.dom.childNodes[m]==h.dom){this.dom.removeChild(h.dom);
break}}else if(h instanceof HTMLElement)for(;m<t;m++){if(this.dom.childNodes[m]==h){this.dom.removeChild(h);break}}else console.error("Panel:",h,"is not an instance of UIElement.")}}clear(){for(;this.dom.children.length;)this.dom.removeChild(this.dom.lastChild)}}class ViewContainer extends Panel{constructor(){super();this.setId("viewport")}}
class ExternalUri extends Notifiable{constructor(){super();this.youtubeClassicReg=/https:\/\/www\.youtube\.com\/watch\?v=/i;this.vimeoClassicReg=/https:\/\/vimeo\.com/i;this.youtubeEmbedReg=/https:\/\/youtu\.be/i;this.dailyClassicReg=/https:\/\/www\.dailymotion\.com\/video/i;this.dailyShareReg=/https:\/\/dai\.ly/i;this.httpsReg=/^https/i;this.localFile=/^\.\/.*/i;this.isLocal=/:3000\/mobile/.test(window.location.href)||/chrome-extension:\/\//.test(window.location.href);Notifier.subscribe(this,ImplicationCommand.PROCESS_URL)}notify(a,
e){this.processUri(e.url,e.triggerType==StatementTrigger.URL_POPUP)}processUri(a,e){this.contentDiv||this.generateContentDiv();a=this.checkRegExp(this.youtubeClassicReg,a,"https://www.youtube.com/embed/","?autoplay=1&fs=0&rel=0");a=this.checkRegExp(this.youtubeEmbedReg,a,"https://www.youtube.com/embed/","?autoplay=1&fs=0&rel=0");a=this.checkRegExp(this.vimeoClassicReg,a,"https://player.vimeo.com/video/");a=this.checkRegExp(this.dailyClassicReg,a,"https://www.dailymotion.com/embed/video/");a=this.checkRegExp(this.dailyShareReg,
a,"https://www.dailymotion.com/embed/video/");this.httpsReg.test(a)||this.localFile.test(a)||(e=!1);this.isLocal&&(e=!0);e?(this.contentDiv.style.display="block",this.isLocal||(this.frame.src=a)):(this.contentDiv.style.display="none",window.open(a,"_blank"))}checkRegExp(a,e,h,m=""){let t;(a=e.match(a))&&(t=e.replace(a[0],""));t&&0<t.length&&(e=h+t+m);return e}generateContentDiv(){this.contentDiv=document.createElement("div");this.contentDiv.style.position="absolute";this.contentDiv.style.margin="auto";
this.contentDiv.style.top="0";this.contentDiv.style.bottom="0";this.contentDiv.style.left="0";this.contentDiv.style.right="0";this.contentDiv.style.width="80%";this.contentDiv.style.height="80%";this.contentDiv.style.backgroundColor="#222";this.contentDiv.style.borderRadius="5px";this.contentDiv.style.border="outset 1px #222";this.contentDiv.style.display="block";let a=document.createElement("img");a.src="./static/assets/viewer/close.png";a.style.width="22px";a.style.height="22px";a.style.right="10px";
a.style.top="10px";a.style.position="absolute";a.style.zIndex="10000";a.style.cursor="pointer";a.onclick=()=>{this.contentDiv.style.display="none";this.frame.src=""};this.contentDiv.appendChild(a);this.isLocal?(this.contentDiv.style.fontSize="50px",this.contentDiv.style.cursor="pointer",this.contentDiv.innerHTML=Localisation.inst.CONTENT_DIV_ERROR,this.contentDiv.onclick=()=>{this.contentDiv.style.display="none"}):(this.frame=document.createElement("iframe"),this.frame.style.position="absolute",this.frame.style.width=
"100%",this.frame.style.height="100%",this.frame.style.borderRadius="5px",this.frame.style.backgroundColor="#eee",this.frame.style.border="0px",this.frame.style.display="block",this.frame.type="text/html",this.contentDiv.appendChild(this.frame));document.body.appendChild(this.contentDiv)}}
class DeviceContextParser extends Notifiable{constructor(){super();this._isMovingVR=this._isStaticVR=this._isVR=this._isMobile=this._isComputer=!1;Notifier.subscribe(this,InitCommand.UNLOCK)}notify(a,e){Notifier.unsubscribe(this,InitCommand.UNLOCK);this.parse()}parse(){if(Config.STARTED_IN_VR)return this._isVR=!0,WebVRUtils.hasMovement?this._isMovingVR=!0:this._isStaticVR=!0,this._setContext();Device.isMobile()?this._isMobile=!0:this._isComputer=!0;this._setContext()}_setContext(){this._isComputer?
ImplicationUtils.CONTEXT=VisualizationContext.Computer:this._isMobile?ImplicationUtils.CONTEXT=VisualizationContext.Mobile:this._isStaticVR?ImplicationUtils.CONTEXT=VisualizationContext.StaticHeadset:this._isMovingVR&&(ImplicationUtils.CONTEXT=VisualizationContext.MovingHeadset)}}var HomePageUtils;
(function(a){function e(E){y(C=E)}function h(E,H,O){O!=StartShortcut.WEBAR||!Device.isTablet()&&!Device.isMobile()||WebVRUtils.isMobileHMD||(document.getElementById("divarimg").style.display="inline-block");O!=StartShortcut.WEBAR&&(WebVRUtils.isDualMobileHMD||WebVRUtils.isMobileHMD)?document.getElementById("divwebvrimg").style.display="inline-block":WebVRUtils.hasHMD&&!Device.isMobile()&&(document.getElementById("divwebvrimg").style.display="inline-block");WebVRUtils.hasHMD&&WebVRUtils.isMobileHMD?
document.getElementById("divscreensimg").style.display="none":document.getElementById("divscreensimg").style.display="inline-block";document.getElementById("divarimg").onmousedown=E;document.getElementById("divwebvrimg").onmousedown=E;document.getElementById("divscreensimg").onmousedown=H;document.getElementById("help")&&(document.getElementById("showhelp").onmousedown=()=>{e(1);document.getElementById("activeslideshow").style.display="none";document.getElementById("slideshow").style.display="block"},
document.getElementById("closehelp").onmousedown=()=>{document.getElementById("activeslideshow").style.display="block";document.getElementById("slideshow").style.display="none"},document.getElementById("slideshowcontentbackground").onmousedown=()=>{document.getElementById("activeslideshow").style.display="block";document.getElementById("slideshow").style.display="none"});document.getElementById("screenText").innerText=Localisation.inst.LAUNCH_360;document.getElementById("webvrText").innerText=Localisation.inst.LAUNCH_VR;
document.getElementById("arText").innerText=Localisation.inst.LAUNCH_AR}function m(){let E=document.getElementById("https_warning_btn"),H=window.location.protocol;E.onmousedown=()=>{document.getElementById("warning-text").style.display="block";document.getElementById("https_warning_text_"+Config.LANGUAGE).style.display="block";/:3000\/mobile/.test(window.location.href)&&(document.getElementById("https_warning_extra_"+Config.LANGUAGE).style.display="block")};if(/https/.test(H)||/chrome-extension/.test(H))E.style.display=
"none"}function t(){var E,H;let O=Config.LANGUAGE,R=new RegExp("-"+O+"\\.\\w{2,4}$"),W=document.getElementsByClassName("slide"),ea;if((ea=null===(H=null===(E=W[0])||void 0===E?void 0:E.children[0])||void 0===H?void 0:H.src)&&!R.test(ea))for(E=0;E<W.length;++E)W[E].children[0]&&(W[E].children[0].src=W[E].children[0].src.replace(/-(\w+)\.\w{2,4}$/,(T,fa)=>T.replace(fa,O)))}function y(E){let H=document.getElementsByClassName("slide"),O=document.getElementsByClassName("dot");E>H.length&&(C=1);1>E&&(C=
H.length);O[I-1].className="dot";H[I-1].className="slide fadeout";H[C-1].className="slide fade";O[C-1].className="dot active";I=C}let C=1,I=1;a.initPage=function(E,H,O=null){var R;h(E,H,O);E=Config.simulationData.header;if(null===(R=E.title)||void 0===R?0:R.length)if(R=document.getElementById("title_text"))R.innerHTML=E.title.replace(/(?:\\n|\\\\n)/g,"<br />"),document.title=E.title.replace(/(?:\\n|\\\\n)/g," ");document.getElementById("logocontent")&&(document.getElementById("rightlogo").style.display=
"none",document.getElementById("leftlogo").style.display="none",Config.STATIC_FOLDER&&(1==E.rightLogo&&(document.getElementById("rightlogo").style.display="block",document.getElementById("rightlogo").src=Config.DATA_FOLDER+"logo.png"),1==E.leftLogo&&(document.getElementById("leftlogo").style.display="block",document.getElementById("leftlogo").src=Config.DATA_FOLDER+"leftlogo.png")),R=E.rightLogoUrl,E=E.leftLogoUrl,R&&(H=document.getElementById("rightlogourl"),H.classList.add("pointer"),H.href=R,H.target=
"_blank"),E&&(R=document.getElementById("leftlogourl"),R.classList.add("pointer"),R.href=E,R.target="_blank"));document.getElementById("help")&&t();document.getElementById("https_warning")&&m();document.getElementById("launchscreen").style.display="block"};a.hide=function(){document.getElementById("synch").style.display="none";document.getElementById("help")&&(document.getElementById("help").style.display="none");document.getElementById("launchscreen").style.display="none";0==Config.DUAL_RENDERING&&
(Config.USE_ACCELEROMETER||Device.isInStoryline?(document.getElementById("compass").style.display="none",document.getElementById("fullscreen").style.display="none"):Device.isMobile()?(document.getElementById("compass").style.display="none",Config.PWA_APP?document.getElementById("fullscreen").style.display="none":document.getElementById("fullscreen").style.display="block"):(document.getElementById("compass").style.display="none",document.getElementById("fullscreen").style.display="block"))};a.nextSlide=
function(E){y(C+=E)};a.currentSlide=e})(HomePageUtils||={});
class CheckpointManager extends Notifiable{constructor(){super();Notifier.subscribe(this,StatefulCommand.CHECKPOINT_TRIGGERED)}static get inst(){return this._inst||(this._inst=new CheckpointManager)}notify(a,e){for(a=0;a<e.length;++a)this.execute(e[a])}execute(a){if(a&&(a=UUID.test(a)?Config.simulationData.checkpoints[a]:ArrayUtils.dictionaryFind(Config.simulationData.checkpoints,"name",a)))if(a.goToDefaults){let h=[],m=ArrayUtils.find(Config.simulationData.scenes,"uuid",a.sceneUuid).elements;if(a.targets)for(var e=
0;e<a.targets.length;++e)h.push(ArrayUtils.find(m,"uuid",a.targets[e].uuid));else if(a.exceptions)for(e=0;e<m.length;++e)a.exceptions[m[e].uuid]||h.push(m[e]);else h=m;this.setToValues(h)}else a.targets&&this.setToValues(a.targets)}setToValues(a){let e=ElementsRefHolder.inst,h=LiveElementsRefHolder.inst,m=new ImplicationProcessedData;for(let y=0;y<a.length;++y){let C=a[y],I=e.getRef(C.uuid),E=h.getRef(C.uuid);C.defaultStateUUID&&I.currentStateId!=C.defaultStateUUID&&m.add("state",C.uuid,C.defaultStateUUID);
C.defaultAspectUUID&&I.currentAspectId!=C.defaultAspectUUID&&m.add("aspect",C.uuid,C.defaultAspectUUID);E&&(C.position||C.rotation||C.scale)&&E.placeContainer(C)}let t;(t=m.elements)&&Notifier.unleash(StatefulCommand.STATEFUL_ELEMENT_CHANGE,t)}}var StartShortcut;(function(a){a.CLASSIC="classic";a.WEBVR="webvr";a.WEBAR="ar"})(StartShortcut||={});
class AbstractMain extends Notifiable{constructor(){super();this.REVISION="4.6.2";Debug.inst;console.info("Sphere engine",this.REVISION);Notifier.subscribe(this,InitCommand.VR_INIT_TESTED);Notifier.subscribe(this,InitCommand.MEDIA_TAGS_READY);Notifier.subscribe(this,InitCommand.UNLOCK_FINISHED);Notifier.subscribe(this,InitCommand.DATA_LOADED);new Traces;new ExternalUri;new DeviceContextParser;SimulationLoader.inst;SceneBuilder.inst;View3D.inst;ElementsRefHolder.inst;LiveElementsRefHolder.inst;MediaTagsManager.inst;
CacheService.inst;CheckpointManager.inst;LoadProgressManager.inst;AssetAnimator.init()}notify(a,e){Notifier.unsubscribe(this,a);a==InitCommand.VR_INIT_TESTED?this._startShortcut==StartShortcut.WEBVR||this._startShortcut==StartShortcut.CLASSIC?this.loadSimulationData():this.initLoadingRing():a==InitCommand.MEDIA_TAGS_READY?this._startShortcut==StartShortcut.CLASSIC?this.startClassic():this._startShortcut==StartShortcut.WEBVR?this.startXR():this.initHomePage():a==InitCommand.VR_STARTED?this.activateMedia(!0):
a==InitCommand.UNLOCK_FINISHED?this.hideHomeScreen().then():a==InitCommand.DATA_LOADED&&(Config.basisComrpessed=window.BASIS_COMPRESSED)}sphereCompanionInit(){Config.LAUNCH_FROM_SPHERE_COMPANION=!0}starterFunc(){if(window.matchMedia("(display-mode: standalone)").matches||navigator.standalone)Config.PWA_APP=!0;switch(window.location.search.substring(1)){case "ar":this._startShortcut=StartShortcut.WEBAR;break;case "webvr":this._startShortcut=StartShortcut.WEBVR;break;case "classic":this._startShortcut=
StartShortcut.CLASSIC;break;default:this._startShortcut=null}const a=(new ViewContainer).dom;document.body.appendChild(a);View3D.inst.init(a);console.info("starterFunc init");WebVRUtils.init(View3D.inst.renderer.domElement,this._startShortcut==StartShortcut.WEBAR)}initLoadingRing(){let a=document.getElementById("cylinder");Device.isIE()?a&&(a.classList.add("iecylinder"),a.innerHTML=""):null===a||void 0===a?void 0:a.classList.add("cylinder");null==View3D.inst.renderer.getContext()?document.getElementById("alertwebgl").style.display=
"block":(document.getElementById("divwebvrimg").style.display="none",document.getElementById("divarimg").style.display="none",document.getElementById("divscreensimg").style.display="none",document.getElementById("compass").style.display="none",document.getElementById("fullscreen").style.display="none",this.loadSimulationData())}loadSimulationData(){Device.launchedFromSphereApp()&&(Config.LAUNCH_FROM_SPHERE_COMPANION=!0,Config.SCREEN_ORIENTATION=Device.orientationFromSphereApp());SimulationLoader.inst.loadSimulationData(Config.DATA_FOLDER+
"simulation.sphere")}initHomePage(){HomePageUtils.initPage(()=>{this.startXR()},()=>{this.startClassic()},this._startShortcut)}nextSlide(a){HomePageUtils.nextSlide(a)}currentSlide(a){HomePageUtils.currentSlide(a)}startXR(){Config.STARTED_IN_VR=!0;Notifier.subscribe(this,InitCommand.VR_STARTED);WebVRUtils.start()}startClassic(){Config.STARTED_IN_VR=!1;this.activateMedia(!1)}activateMedia(a){Config.USE_ACCELEROMETER=a;Config.DUAL_RENDERING=a;MediaTagsManager.inst.activateAll()}hideHomeScreen(){return __awaiter(this,
void 0,void 0,function*(){Device.isMobile()&&!Device.isInStoryline&&(this.toggleFullscreen(),window.addEventListener("beforeunload",()=>this.toggleFullscreen(!1),!1));document.getElementById("fullscreen").onclick=()=>{this.toggleFullscreen()};document.getElementById("compass").onclick=()=>{View3D.inst.setControls(!Config.USE_ACCELEROMETER)};HomePageUtils.hide();(yield Connection.init())||SimulationLoader.inst.loadHUDAndFirstScene()})}toggleFullscreen(a){if(!Config.DUAL_RENDERING||!WebVRUtils.hasHMD){var e=
window.document,h=e.documentElement;Device.isIE()&&(h=e.body);var m=h.requestFullscreen||h.mozRequestFullScreen||h.webkitRequestFullScreen||h.msRequestFullscreen,t=e.exitFullscreen||e.mozCancelFullScreen||e.webkitExitFullscreen||e.msExitFullscreen,y=e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement;m&&("undefined"==typeof a?y?t.call(e):m.call(h):a&&!y?m.call(h):y&&t.call(e))}}}
class Main extends AbstractMain{constructor(){super();(window.frameElement?window.frameElement.contentWindow:window).onload=()=>{"undefined"==typeof window.createImageBitmap&&(window.createImageBitmap=function(a){return new Promise((e,h)=>{h=document.createElement("img");h.addEventListener("load",function(){e(this)});h.src=URL.createObjectURL(a)})});"undefined"==typeof window.ImageBitmap&&(window.ImageBitmap=function(){});this.starterFunc()}}}const main=new Main;window.stats=View3D.inst.stats;
